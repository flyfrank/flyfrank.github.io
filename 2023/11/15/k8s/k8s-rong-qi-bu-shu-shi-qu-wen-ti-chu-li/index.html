<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>k8s容器部署时区问题处理 | 逐光の博客</title><meta name="author" content="逐光"><meta name="copyright" content="逐光"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、问题描述在 K8s 环境下部署应用后，发现数据库中记录的时间比北京时间晚了 8 小时，导致按时间查询数据时无法查到正确结果。这是典型的时区不一致问题。 涩及的时区配置点：  MySQL 数据库服务器的时区设置 MySQL 数据库时区配置 JDBC 数据库连接的时区配置 应用服务器时区配置 ..."><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "k8s容器部署时区问题处理",
  "url": "https://www.mpoom.cn/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/",
  "image": "https://www.mpoom.cn/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/k8s.png",
  "datePublished": "2023-11-14T16:00:00.000Z",
  "dateModified": "2023-11-14T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "逐光",
      "url": "https://www.mpoom.cn"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.mpoom.cn/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'k8s容器部署时区问题处理',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">106</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">179</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/categories/book/"><i class="fa-fw fa fa-book"></i><span> 读书</span></a></div><div class="menus_item"><a class="site-page" href="/categories/thought/"><i class="fa-fw fa fa-lightbulb"></i><span> 思考感悟</span></a></div><div class="menus_item"><a class="site-page" href="/skills/"><i class="fa-fw fas fa-code"></i><span> 专业能力</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">逐光の博客</span></a><a class="nav-page-title" href="/"><span class="site-name">k8s容器部署时区问题处理</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/categories/book/"><i class="fa-fw fa fa-book"></i><span> 读书</span></a></div><div class="menus_item"><a class="site-page" href="/categories/thought/"><i class="fa-fw fa fa-lightbulb"></i><span> 思考感悟</span></a></div><div class="menus_item"><a class="site-page" href="/skills/"><i class="fa-fw fas fa-code"></i><span> 专业能力</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">k8s容器部署时区问题处理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-14T16:00:00.000Z" title="发表于 2023-11-15 00:00:00">2023-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-08T06:44:10.672Z" title="更新于 2026-01-08 14:44:10">2026-01-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/k8s/">k8s</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">905</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>3分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h2 id="一、问题描述"><a href="#一、问题描述" class="headerlink" title="一、问题描述"></a>一、问题描述</h2><p>在 K8s 环境下部署应用后，发现数据库中记录的时间比北京时间晚了 8 小时，导致按时间查询数据时无法查到正确结果。这是典型的时区不一致问题。</p>
<p><strong>涩及的时区配置点：</strong></p>
<ul>
<li>MySQL 数据库服务器的时区设置</li>
<li>MySQL 数据库时区配置</li>
<li>JDBC 数据库连接的时区配置</li>
<li>应用服务器时区配置</li>
<li>应用容器的时区配置</li>
</ul>
<h2 id="二、问题排查"><a href="#二、问题排查" class="headerlink" title="二、问题排查"></a>二、问题排查</h2><h3 id="2-1-服务器时区检查"><a href="#2-1-服务器时区检查" class="headerlink" title="2.1 服务器时区检查"></a>2.1 服务器时区检查</h3><p>首先确认各个服务器的时区，使用命令 <code>date</code> 或 <code>date -R</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@host-172 ~<span class="token punctuation">]</span>$ <span class="token function">date</span>
<span class="token number">2023</span>年 <span class="token number">11</span>月 <span class="token number">15</span>日 星期三 <span class="token number">21</span>:19:02 CST
<span class="token punctuation">[</span>root@host-172 ~<span class="token punctuation">]</span>$ <span class="token function">date</span> <span class="token parameter variable">-R</span>
Wed, <span class="token number">15</span> Nov <span class="token number">2023</span> <span class="token number">21</span>:19:06 +0800<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>结果显示服务器时区为 CST（东八区）。</p>
<h3 id="2-2-数据库时区检查"><a href="#2-2-数据库时区检查" class="headerlink" title="2.2 数据库时区检查"></a>2.2 数据库时区检查</h3><p>在确认服务器时区后，进一步确认数据库的时区，在数据库执行下面命令：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%time_zone%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查询结果如下：</p>
<table>
<thead>
<tr>
<th align="left">variable_name</th>
<th align="left">value</th>
</tr>
</thead>
<tbody><tr>
<td align="left">system_time_zone</td>
<td align="left">CST</td>
</tr>
<tr>
<td align="left">time_zone</td>
<td align="left">SYSTEM</td>
</tr>
</tbody></table>
<p>上述查询结果表明，数据库服务器的时区为CST，数据默认使用服务器的时区则也是CST。</p>
<h3 id="2-3-Java-获取时区机制"><a href="#2-3-Java-获取时区机制" class="headerlink" title="2.3 Java 获取时区机制"></a>2.3 Java 获取时区机制</h3><p>在Java代码中我们可以通过一下方式获取系统时区：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 获取默认时区</span>
<span class="token class-name">TimeZone</span> timeZone <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>运行结果如下：</p>
<pre class="line-numbers language-none"><code class="language-none">sun.util.calendar.ZoneInfo[id&#x3D;&quot;Asia&#x2F;Shanghai&quot;,offset&#x3D;28800000,dstSavings&#x3D;0,useDaylight&#x3D;false,transitions&#x3D;29,lastRule&#x3D;null]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-4-Java-默认时区获取逻辑"><a href="#2-4-Java-默认时区获取逻辑" class="headerlink" title="2.4 Java 默认时区获取逻辑"></a>2.4 Java 默认时区获取逻辑</h3><p>Java 获取默认时区的步骤：</p>
<ol>
<li>查找 <code>TZ</code> 环境变量</li>
<li>若未设置，读取 <code>/etc/timezone</code> 文件</li>
<li>若文件不存在，比较 <code>/etc/localtime</code> 与 <code>/usr/share/zoneinfo</code> 目录下的时区文件</li>
<li>都未找到，默认使用 GMT 时区</li>
</ol>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/darange/p/9368245.html">Java读取系统默认时区</a></p>
</blockquote>
<h2 id="三、解决方案"><a href="#三、解决方案" class="headerlink" title="三、解决方案"></a>三、解决方案</h2><h3 id="3-1-挂载时区文件"><a href="#3-1-挂载时区文件" class="headerlink" title="3.1 挂载时区文件"></a>3.1 挂载时区文件</h3><p>将宿主机的<code>/etc/localtime</code>路径挂载到容器，可以保持容器与宿主机时间同步，避免由于时间同步引起的应用层的问题。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
     
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
      <span class="token key atrule">hostPath</span><span class="token punctuation">:</span> 
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>**作用：**将宿主机的 <code>/etc/localtime</code> 路径挂载到容器，保持容器与宿主机时间同步。</p>
<h3 id="3-2-设置环境变量-TZ"><a href="#3-2-设置环境变量-TZ" class="headerlink" title="3.2 设置环境变量 TZ"></a>3.2 设置环境变量 TZ</h3><p>即使挂载了时区文件，如果没有设置 <code>TZ</code> 环境变量，Java 应用可能仍然使用容器的默认时区。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>env<span class="token punctuation">-</span>tz
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>time
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TZ
        <span class="token key atrule">value</span><span class="token punctuation">:</span> Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>**作用：**设置 <code>TZ</code> 环境变量，确保 Java 应用能获取正确的时区。</p>
<h3 id="3-3-完整配置示例"><a href="#3-3-完整配置示例" class="headerlink" title="3.3 完整配置示例"></a>3.3 完整配置示例</h3><p>推荐的容器时区配置方案（同时配置环境变量和挂载时区文件）：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
    <span class="token key atrule">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app<span class="token punctuation">:</span>latest
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TZ
        <span class="token key atrule">value</span><span class="token punctuation">:</span> Asia/Shanghai
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
      <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="四、验证方法"><a href="#四、验证方法" class="headerlink" title="四、验证方法"></a>四、验证方法</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 进入容器</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> -- /bin/bash

<span class="token comment"># 检查容器时区</span>
<span class="token function">date</span>
<span class="token function">date</span> <span class="token parameter variable">-R</span>

<span class="token comment"># 检查 TZ 环境变量</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$TZ</span>

<span class="token comment"># 检查 Java 应用获取的时区（在应用代码中）</span>
TimeZone.getDefault<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="五、注意事项"><a href="#五、注意事项" class="headerlink" title="五、注意事项"></a>五、注意事项</h2><ol>
<li><strong>双重配置</strong>：建议同时配置 <code>TZ</code> 环境变量和挂载 <code>/etc/localtime</code>，确保时区一致</li>
<li><strong>数据库连接</strong>：JDBC 连接串也可以配置时区，如 <code>serverTimezone=Asia/Shanghai</code></li>
<li><strong>镜像构建</strong>：如果在 Dockerfile 中设置时区，可以避免部署时配置</li>
<li><strong>时区文件路径</strong>：不同的 Linux 发行版时区文件路径可能不同，注意适配</li>
</ol>
<h2 id="六、参考文章"><a href="#六、参考文章" class="headerlink" title="六、参考文章"></a>六、参考文章</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/darange/p/9368245.html">Java读取系统默认时区</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903924806189063">k8s pod时区更改</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.mpoom.cn">逐光</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.mpoom.cn/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/">https://www.mpoom.cn/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.mpoom.cn" target="_blank">逐光の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8/">容器</a><a class="post-meta__tags" href="/tags/%E6%97%B6%E5%8C%BA/">时区</a></div><div class="post-share"><div class="social-share" data-image="/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/k8s.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/12/02/java/linux-shang-shi-yong-jmeter-jin-xing-ya-ce/" title="Linux上使用JMeter进行压测"><img class="cover" src="/2023/12/02/java/linux-shang-shi-yong-jmeter-jin-xing-ya-ce/%E6%80%A7%E8%83%BD%E5%8E%8B%E6%B5%8B.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Linux上使用JMeter进行压测</div></div><div class="info-2"><div class="info-item-1">背景简介JMeter是我们日常开发中最常用的压测工具，我们经常会直接在本地启动JMeter对本地或远程应用进行简单的压测。但是这种压测场景下得出的压测结果并不严谨，受以下两方面影响：  本地机器硬件配置差，压测中本机的性能最先达到瓶颈 本地机器和远程服务端网络延时较高，导致压测性能比预期差所以我们做一些简单的验证可以在本地直接启动JMeter进行压测，但是如果要做真实的性能测试，需要使用专用的压测服务器对服务端应用进行压测。而压测服务器一般都是Linux系统，所以需要在Linux系统上使用JMeter进行操作。  JMeter配置下载JMeter压测工具登录Linux压测服务器，下载JMeter压测工具，官网下载地址。 curl -O https:&#x2F;&#x2F;dlcdn.apache.org&#x2F;&#x2F;jmeter&#x2F;binaries&#x2F;apache-jmeter-5.6.2.zip 注意：请确保压测服务器已经安装了JDK1.8 解压并配置JMeter 说明：配置JMeter环境变量是为了方便在任意路劲下使用jmeter命令，如果不配置环境...</div></div></div></a><a class="pagination-related" href="/2023/11/03/k8s/yi-fen-k8s-de-deployment-pei-zhi-wen-jian-xiang-jie/" title="一份k8s的Deployment配置文件详解"><img class="cover" src="/2023/11/03/k8s/yi-fen-k8s-de-deployment-pei-zhi-wen-jian-xiang-jie/k8s.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">一份k8s的Deployment配置文件详解</div></div><div class="info-2"><div class="info-item-1">一、概述本文提供一份 K8s Deployment 配置文件示例，并对关键配置项进行详细说明，方便在实际项目部署时参考和使用。 二、配置示例--- apiVersion: apps/v1 kind: Deployment metadata:   annotations: &#123;&#125;   labels:     app: msmp-mt-server     k8s.kuboard.cn/name: msmp-mt-server-deployment   name: msmp-mt-server-deployment   namespace: hw-msmp   resourceVersion: '10843811' spec:   progressDeadlineSeconds: 600   replicas: 1   revisionHistoryLimit: 10   selector:     matchLabels:       app: msmp-mt-server       env: dev   strategy:     rollingUpdate:...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/05/08/k8s/kube-prometheus-jian-kong-rocketmq/" title="Kube-Prometheus监控RocketMQ（四）"><img class="cover" src="/2023/05/08/k8s/kube-prometheus-jian-kong-rocketmq/k8s.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-08</div><div class="info-item-2">Kube-Prometheus监控RocketMQ（四）</div></div><div class="info-2"><div class="info-item-1">一、概述本文介绍如何使用 Kube-Prometheus 监控 RocketMQ。通过部署 RocketMQ Exporter，将 RocketMQ 的消息队列指标暴露给 Prometheus 进行采集和监控。 核心组件：  RocketMQ Exporter：用于暴露 RocketMQ 指标的 Exporter ServiceMonitor：Prometheus Operator 的 CRD，用于服务发现和指标采集配置  二、部署 RocketMQ Exporter2.1 创建 Deployment通过 Deployment 部署 RocketMQ Exporter，需要配置 NameServer 地址。 apiVersion: apps/v1 kind: Deployment metadata:   labels:    app.kubernetes.io/component: exporter    app.kubernetes.io/name: rocketmq-exporter    app.kubernetes.io/part-of: kube-prometheus ...</div></div></div></a><a class="pagination-related" href="/2023/05/05/k8s/kube-prometheus-jian-kong-zhu-ji-he-zhong-jian-jian/" title="Kube-Prometheus监控主机和中间件（一）"><img class="cover" src="/2023/05/05/k8s/kube-prometheus-jian-kong-zhu-ji-he-zhong-jian-jian/k8s%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-05</div><div class="info-item-2">Kube-Prometheus监控主机和中间件（一）</div></div><div class="info-2"><div class="info-item-1">一、背景简介随着业务向云原生架构迁移，原有的监控系统需要升级以适应容器化环境。本系列文章介绍如何使用 Kube-Prometheus 监控 K8s 集群外部的主机和中间件服务。 核心特点：  支持监控 K8s 集群外部的服务（MySQL、Redis、RocketMQ 等） 通过环境标签（platform）区分不同环境的监控数据 基于 Prometheus Operator 的 ServiceMonitor 机制实现服务发现  二、技术原理2.1 K8s 访问外部服务K8s 集群内的 Pod 访问外部服务的原理：  关键步骤：  创建 Endpoints 资源，指向外部服务的 IP 地址 创建 Service 资源，不配置 selector，关联到手动创建的 Endpoints Pod 通过 Service 名称访问外部服务   2.2 ServiceMonitor 原理Prometheus Operator 通过 ServiceMonitor 实现服务发现：  工作流程：  ServiceMonitor 通过 selector 选择目标 Service Prometheus Op...</div></div></div></a><a class="pagination-related" href="/2023/05/09/k8s/kube-prometheus-jian-kong-nacos/" title="Kube-Prometheus监控Nacos（五）"><img class="cover" src="/2023/05/09/k8s/kube-prometheus-jian-kong-nacos/k8s.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-09</div><div class="info-item-2">Kube-Prometheus监控Nacos（五）</div></div><div class="info-2"><div class="info-item-1">一、概述本文介绍如何使用 Kube-Prometheus 监控 Nacos 服务。Nacos 自带 Prometheus 指标接口，无需额外部署 Exporter，只需通过 Endpoint 和 ServiceMonitor 配置即可实现监控。 监控方式：  Nacos 内置了 Micrometer 指标，通过 /nacos/actuator/prometheus 接口暴露 使用 Endpoints 手动指定 Nacos 集群节点 IP 通过 ServiceMonitor 配置 Prometheus 采集规则  二、配置部署2.1 创建 Endpoints由于 Nacos 通常部署在 K8s 集群外部，需要手动创建 Endpoints 指向 Nacos 服务器。 apiVersion: v1 kind: Endpoints metadata:   name: nacos-exporter   namespace: monitoring subsets: - addresses:   - ip: # 列举 nacos 的机器的ip1   - ip: # 列举 nacos 的机器的i...</div></div></div></a><a class="pagination-related" href="/2023/05/06/k8s/kube-prometheus-jian-kong-mysql/" title="Kube-Prometheus监控MySQL（二）"><img class="cover" src="/2023/05/06/k8s/kube-prometheus-jian-kong-mysql/k8s.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-06</div><div class="info-item-2">Kube-Prometheus监控MySQL（二）</div></div><div class="info-2"><div class="info-item-1">一、概述本文介绍如何使用 Kube-Prometheus 监控 MySQL 数据库。通过部署 MySQL Exporter，将 MySQL 的性能指标暴露给 Prometheus 进行采集和监控。 核心组件：  MySQL Exporter：用于暴露 MySQL 指标的 Exporter（镜像版本：v0.14.0） ServiceMonitor：Prometheus Operator 的 CRD，用于服务发现和指标采集配置  二、部署 MySQL Exporter2.1 创建 Deployment通过 Deployment 部署 MySQL Exporter，需要配置数据库连接信息。 apiVersion: apps/v1 kind: Deployment metadata:   #设置唯一名称，建议添加数据库实例ip   name:  mysql-exporter-172.16.1.77    namespace: monitoring   labels:     app.kubernetes.io/component: exporter     app.kubernetes....</div></div></div></a><a class="pagination-related" href="/2023/05/07/k8s/kube-prometheus-jian-kong-redis/" title="Kube-Prometheus监控Redis（三）"><img class="cover" src="/2023/05/07/k8s/kube-prometheus-jian-kong-redis/k8s.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-07</div><div class="info-item-2">Kube-Prometheus监控Redis（三）</div></div><div class="info-2"><div class="info-item-1">一、概述本文介绍如何使用 Kube-Prometheus 监控 Redis。通过部署 Redis Exporter，将 Redis 的性能指标暴露给 Prometheus 进行采集和监控。 核心组件：  Redis Exporter：用于暴露 Redis 指标的 Exporter（镜像版本：v1.37.0） ServiceMonitor：Prometheus Operator 的 CRD，用于服务发现和指标采集配置  二、部署 Redis Exporter2.1 创建 Deployment通过 Deployment 部署 Redis Exporter，需要配置 Redis 连接信息。 apiVersion: apps/v1 kind: Deployment metadata:   #设置唯一名称，建议添加数据库实例ip   name:  redis-exporter-172.16.1.77   namespace: monitoring   labels:     app.kubernetes.io/component: exporter     app.kubernetes.i...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">一、问题描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">2.</span> <span class="toc-text">二、问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%B6%E5%8C%BA%E6%A3%80%E6%9F%A5"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 服务器时区检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E5%8C%BA%E6%A3%80%E6%9F%A5"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 数据库时区检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Java-%E8%8E%B7%E5%8F%96%E6%97%B6%E5%8C%BA%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Java 获取时区机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Java-%E9%BB%98%E8%AE%A4%E6%97%B6%E5%8C%BA%E8%8E%B7%E5%8F%96%E9%80%BB%E8%BE%91"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Java 默认时区获取逻辑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.</span> <span class="toc-text">三、解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%8C%82%E8%BD%BD%E6%97%B6%E5%8C%BA%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 挂载时区文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-TZ"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 设置环境变量 TZ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 完整配置示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%AA%8C%E8%AF%81%E6%96%B9%E6%B3%95"><span class="toc-number">4.</span> <span class="toc-text">四、验证方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.</span> <span class="toc-text">五、注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">6.</span> <span class="toc-text">六、参考文章</span></a></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By 逐光</span></div><div class="footer_custom_text"><div class="icp"><span><img src="/images/theme/icp_icon.png"/><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/#/Integrated/index">陕ICP备19021337号-1</span></a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'f5WSKiyRgMriw1qIicgn1Dbu-gzGzoHsz',
      appKey: 'c9Jx92rNNJ0RzzaxLNCqu4rR',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine@1.5.3/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>