<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MCP Serveræ·±åº¦è§£æï¼šAIåº”ç”¨çš„æ ‡å‡†åŒ–åè®®</title>
    <url>/2025/01/08/ai-coding/mcp-server-shen-du-jie-xi-ai-ying-yong-de-biao-zhun-hua-xie-yi/</url>
    <content><![CDATA[<h2 id="å¼•è¨€ï¼šAIåº”ç”¨é›†æˆçš„å›°å¢ƒä¸çªç ´"><a href="#å¼•è¨€ï¼šAIåº”ç”¨é›†æˆçš„å›°å¢ƒä¸çªç ´" class="headerlink" title="å¼•è¨€ï¼šAIåº”ç”¨é›†æˆçš„å›°å¢ƒä¸çªç ´"></a>å¼•è¨€ï¼šAIåº”ç”¨é›†æˆçš„å›°å¢ƒä¸çªç ´</h2><p>åœ¨ AI å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œæˆ‘ä»¬çœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„ AI åº”ç”¨æ¶Œç°ï¼šä» Claudeã€ChatGPT åˆ°å„ç±»å‚ç›´é¢†åŸŸçš„ AI åŠ©æ‰‹ã€‚ç„¶è€Œï¼Œæ¯ä¸ª AI åº”ç”¨éƒ½æœ‰è‡ªå·±çš„æ•°æ®æ¥å…¥æ–¹å¼ã€API æ ‡å‡†å’Œé›†æˆæ–¹æ³•ï¼Œè¿™å°±åƒäº’è”ç½‘æ—©æœŸå„å®¶å…¬å¸éƒ½æœ‰è‡ªå·±çš„åè®®æ ‡å‡†ä¸€æ ·ï¼Œå¯¼è‡´å¼€å‘è€…éœ€è¦ä¸ºæ¯ä¸ª AI åº”ç”¨å•ç‹¬é€‚é…ã€‚</p>
<p>Anthropic å…¬å¸åœ¨ 2024 å¹´æ¨å‡ºçš„ <strong>MCP (Model Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®)</strong> æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€ç—›ç‚¹è€Œç”Ÿã€‚å®ƒæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„åè®®ï¼Œè®© AI åº”ç”¨èƒ½å¤Ÿä»¥ç»Ÿä¸€çš„æ–¹å¼è®¿é—®å„ç±»æ•°æ®æºå’Œå·¥å…·ï¼Œå°±åƒ HTTP åè®®ç»Ÿä¸€äº† Web é€šä¿¡ä¸€æ ·ã€‚</p>
<span id="more"></span>

<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯-MCP-Serverï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯-MCP-Serverï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ MCP Serverï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ MCP Serverï¼Ÿ</h2><h3 id="1-1-æ ¸å¿ƒæ¦‚å¿µ"><a href="#1-1-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1.1 æ ¸å¿ƒæ¦‚å¿µ"></a>1.1 æ ¸å¿ƒæ¦‚å¿µ</h3><p><strong>MCP Server</strong> æ˜¯åŸºäº Model Context Protocol åè®®å®ç°çš„æœåŠ¡ç«¯ç¨‹åºï¼Œå®ƒå……å½“ AI åº”ç”¨ä¸å¤–éƒ¨èµ„æºä¹‹é—´çš„æ¡¥æ¢ã€‚</p>
<pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> LR
    A<span class="token text string">[AIåº”ç”¨&lt;br/>Claude/ChatGPT]</span> <span class="token arrow operator">--></span> B<span class="token text string">[MCP Client]</span>
    B <span class="token arrow operator">--></span> C<span class="token text string">[MCP Server]</span>
    C <span class="token arrow operator">--></span> D<span class="token text string">[æ•°æ®åº“]</span>
    C <span class="token arrow operator">--></span> E<span class="token text string">[æ–‡ä»¶ç³»ç»Ÿ]</span>
    C <span class="token arrow operator">--></span> F<span class="token text string">[APIæœåŠ¡]</span>
    C <span class="token arrow operator">--></span> G<span class="token text string">[ä¸šåŠ¡ç³»ç»Ÿ]</span>
    
    <span class="token keyword">style</span> A <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e3f2fd</span>
    <span class="token keyword">style</span> B <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#fff9c4</span>
    <span class="token keyword">style</span> C <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e1f5e1</span>
    <span class="token keyword">style</span> D <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span>
    <span class="token keyword">style</span> E <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span>
    <span class="token keyword">style</span> F <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span>
    <span class="token keyword">style</span> G <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ç±»æ¯”ç†è§£</strong>ï¼š</p>
<ul>
<li>å¦‚æœæŠŠ AI åº”ç”¨æ¯”ä½œæµè§ˆå™¨ï¼ŒMCP Server å°±æ˜¯ Web æœåŠ¡å™¨</li>
<li>å¦‚æœæŠŠ AI åº”ç”¨æ¯”ä½œæ‰‹æœº Appï¼ŒMCP Server å°±æ˜¯åç«¯ API</li>
<li>MCP Protocol å°±æ˜¯å®ƒä»¬ä¹‹é—´çš„â€é€šä¿¡è¯­è¨€â€</li>
</ul>
<h3 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦-MCPï¼Ÿ"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦-MCPï¼Ÿ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦ MCPï¼Ÿ"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦ MCPï¼Ÿ</h3><p><strong>ä¼ ç»Ÿæ–¹å¼çš„é—®é¢˜</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># æ¯ä¸ª AI åº”ç”¨éƒ½éœ€è¦å•ç‹¬å¼€å‘æ’ä»¶</span>
claude_plugin <span class="token operator">=</span> ClaudePlugin<span class="token punctuation">(</span><span class="token punctuation">)</span>
chatgpt_plugin <span class="token operator">=</span> ChatGPTPlugin<span class="token punctuation">(</span><span class="token punctuation">)</span>
gemini_plugin <span class="token operator">=</span> GeminiPlugin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ä»£ç é‡å¤ï¼Œç»´æŠ¤æˆæœ¬é«˜</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ä½¿ç”¨ MCP çš„ä¼˜åŠ¿</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ä¸€æ¬¡å¼€å‘ï¼Œæ‰€æœ‰æ”¯æŒ MCP çš„ AI åº”ç”¨éƒ½èƒ½ä½¿ç”¨</span>
mcp_server <span class="token operator">=</span> MCPServer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Claudeã€ChatGPTã€Gemini ç­‰éƒ½èƒ½ç›´æ¥è¿æ¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>å¯¹æ¯”ç»´åº¦</th>
<th>ä¼ ç»Ÿæ’ä»¶æ–¹å¼</th>
<th>MCP æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å¼€å‘æˆæœ¬</strong></td>
<td>æ¯ä¸ª AI åº”ç”¨å•ç‹¬å¼€å‘</td>
<td>ä¸€æ¬¡å¼€å‘ï¼Œé€šç”¨ä½¿ç”¨</td>
</tr>
<tr>
<td><strong>ç»´æŠ¤æˆæœ¬</strong></td>
<td>å¤šå¥—ä»£ç ï¼Œåˆ†åˆ«ç»´æŠ¤</td>
<td>å•ä¸€ä»£ç åº“ï¼Œç»Ÿä¸€ç»´æŠ¤</td>
</tr>
<tr>
<td><strong>æ‰©å±•æ€§</strong></td>
<td>æ·»åŠ æ–°åŠŸèƒ½éœ€å¤šå¤„ä¿®æ”¹</td>
<td>åœ¨ MCP Server ç»Ÿä¸€æ‰©å±•</td>
</tr>
<tr>
<td><strong>æ ‡å‡†åŒ–</strong></td>
<td>å„è‡ªæ ‡å‡†ï¼Œéš¾ä»¥å¤ç”¨</td>
<td>ç»Ÿä¸€åè®®ï¼Œå¼€ç®±å³ç”¨</td>
</tr>
<tr>
<td><strong>ç”Ÿæ€å‘å±•</strong></td>
<td>ç¢ç‰‡åŒ–</td>
<td>ç¤¾åŒºå…±å»ºï¼Œå¿«é€Ÿå¢é•¿</td>
</tr>
</tbody></table>
<h2 id="äºŒã€MCP-Server-çš„æ ¸å¿ƒèƒ½åŠ›"><a href="#äºŒã€MCP-Server-çš„æ ¸å¿ƒèƒ½åŠ›" class="headerlink" title="äºŒã€MCP Server çš„æ ¸å¿ƒèƒ½åŠ›"></a>äºŒã€MCP Server çš„æ ¸å¿ƒèƒ½åŠ›</h2><p>MCP Server æä¾›ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š<strong>Resourcesï¼ˆèµ„æºï¼‰</strong>ã€<strong>Toolsï¼ˆå·¥å…·ï¼‰</strong> å’Œ <strong>Promptsï¼ˆæç¤ºè¯æ¨¡æ¿ï¼‰</strong>ã€‚</p>
<h3 id="2-1-Resources-èµ„æºè®¿é—®"><a href="#2-1-Resources-èµ„æºè®¿é—®" class="headerlink" title="2.1 Resources - èµ„æºè®¿é—®"></a>2.1 Resources - èµ„æºè®¿é—®</h3><p>Resources è®© AI åº”ç”¨èƒ½å¤Ÿè¯»å–å„ç±»æ•°æ®æºçš„å†…å®¹ã€‚</p>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼šè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"resource"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"uri"</span><span class="token operator">:</span> <span class="token string">"file:///Users/project/README.md"</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"é¡¹ç›®æ–‡æ¡£"</span><span class="token punctuation">,</span>
    <span class="token property">"mimeType"</span><span class="token operator">:</span> <span class="token string">"text/markdown"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å¸¸è§èµ„æºç±»å‹</strong>ï¼š</p>
<ul>
<li>ğŸ“„ <strong>æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼šè®¿é—®æœ¬åœ°æ–‡ä»¶å’Œç›®å½•</li>
<li>ğŸ—„ï¸ <strong>æ•°æ®åº“</strong>ï¼šè¯»å– MySQLã€PostgreSQLã€MongoDB æ•°æ®</li>
<li>ğŸŒ <strong>Web å†…å®¹</strong>ï¼šæŠ“å–ç½‘é¡µã€API æ•°æ®</li>
<li>ğŸ“§ <strong>é‚®ä»¶ç³»ç»Ÿ</strong>ï¼šè®¿é—®é‚®ä»¶å†…å®¹</li>
<li>ğŸ“Š <strong>ä¸šåŠ¡ç³»ç»Ÿ</strong>ï¼šCRMã€ERP ç­‰ä¼ä¸šæ•°æ®</li>
</ul>
<h3 id="2-2-Tools-å·¥å…·è°ƒç”¨"><a href="#2-2-Tools-å·¥å…·è°ƒç”¨" class="headerlink" title="2.2 Tools - å·¥å…·è°ƒç”¨"></a>2.2 Tools - å·¥å…·è°ƒç”¨</h3><p>Tools è®© AI åº”ç”¨èƒ½å¤Ÿæ‰§è¡Œå„ç§æ“ä½œå’ŒåŠŸèƒ½ã€‚</p>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼šæŸ¥è¯¢æ•°æ®åº“</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// MCP Server å®šä¹‰å·¥å…·</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ListToolsRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    tools<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"query_database"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"æ‰§è¡Œ SQL æŸ¥è¯¢"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            sql<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"SQL æŸ¥è¯¢è¯­å¥"</span> <span class="token punctuation">&#125;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// AI åº”ç”¨è°ƒç”¨å·¥å…·</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">callTool</span><span class="token punctuation">(</span><span class="token string">"query_database"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  sql<span class="token operator">:</span> <span class="token string">"SELECT * FROM users WHERE role='admin'"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å¸¸è§å·¥å…·ç±»å‹</strong>ï¼š</p>
<ul>
<li>ğŸ” <strong>æœç´¢å·¥å…·</strong>ï¼šGoogle Searchã€Bing Search</li>
<li>ğŸ’¾ <strong>æ•°æ®æ“ä½œ</strong>ï¼šCRUD æ•°æ®åº“æ“ä½œ</li>
<li>ğŸ“ <strong>æ–‡ä»¶æ“ä½œ</strong>ï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ–‡ä»¶</li>
<li>ğŸŒ <strong>API è°ƒç”¨</strong>ï¼šç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ</li>
<li>ğŸ¤– <strong>è‡ªåŠ¨åŒ–</strong>ï¼šæ‰§è¡Œè„šæœ¬ã€è§¦å‘å·¥ä½œæµ</li>
</ul>
<h3 id="2-3-Prompts-æç¤ºè¯æ¨¡æ¿"><a href="#2-3-Prompts-æç¤ºè¯æ¨¡æ¿" class="headerlink" title="2.3 Prompts - æç¤ºè¯æ¨¡æ¿"></a>2.3 Prompts - æç¤ºè¯æ¨¡æ¿</h3><p>Prompts æä¾›å¯å¤ç”¨çš„æç¤ºè¯æ¨¡æ¿ï¼Œæå‡ AI äº¤äº’æ•ˆç‡ã€‚</p>
<p><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼šä»£ç å®¡æŸ¥æ¨¡æ¿</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ListPromptsRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    prompts<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"code_review"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"ä»£ç å®¡æŸ¥æç¤ºè¯"</span><span class="token punctuation">,</span>
        arguments<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">"language"</span><span class="token punctuation">,</span>
            description<span class="token operator">:</span> <span class="token string">"ç¼–ç¨‹è¯­è¨€"</span><span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">"file_path"</span><span class="token punctuation">,</span>
            description<span class="token operator">:</span> <span class="token string">"æ–‡ä»¶è·¯å¾„"</span><span class="token punctuation">,</span>
            required<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ğŸ“‹ <strong>ä»£ç å®¡æŸ¥</strong>ï¼šè‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æŸ¥</li>
<li>ğŸ“ <strong>æ–‡æ¡£ç”Ÿæˆ</strong>ï¼šæ ¹æ®ä»£ç ç”Ÿæˆæ–‡æ¡£</li>
<li>ğŸ› <strong>Bug åˆ†æ</strong>ï¼šåˆ†æé”™è¯¯æ—¥å¿—å’Œå †æ ˆ</li>
<li>ğŸ¨ <strong>å†…å®¹åˆ›ä½œ</strong>ï¼šåšå®¢ã€æ–‡æ¡ˆç”Ÿæˆæ¨¡æ¿</li>
<li>ğŸ“Š <strong>æ•°æ®åˆ†æ</strong>ï¼šç”Ÿæˆåˆ†ææŠ¥å‘Šæ¨¡æ¿</li>
</ul>
<h2 id="ä¸‰ã€MCP-Server-æ¶æ„ä¸é€šä¿¡æœºåˆ¶"><a href="#ä¸‰ã€MCP-Server-æ¶æ„ä¸é€šä¿¡æœºåˆ¶" class="headerlink" title="ä¸‰ã€MCP Server æ¶æ„ä¸é€šä¿¡æœºåˆ¶"></a>ä¸‰ã€MCP Server æ¶æ„ä¸é€šä¿¡æœºåˆ¶</h2><h3 id="3-1-æ¶æ„è®¾è®¡"><a href="#3-1-æ¶æ„è®¾è®¡" class="headerlink" title="3.1 æ¶æ„è®¾è®¡"></a>3.1 æ¶æ„è®¾è®¡</h3><pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> TB
    <span class="token keyword">subgraph</span> AIåº”ç”¨å±‚
        A1<span class="token text string">[Claude Desktop]</span>
        A2<span class="token text string">[å…¶ä»–AIåº”ç”¨]</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">subgraph</span> MCPå®¢æˆ·ç«¯å±‚
        B<span class="token text string">[MCP Client SDK]</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">subgraph</span> MCPæœåŠ¡ç«¯å±‚
        C1<span class="token text string">[MCP Server 1&lt;br/>æ–‡ä»¶ç³»ç»Ÿ]</span>
        C2<span class="token text string">[MCP Server 2&lt;br/>æ•°æ®åº“]</span>
        C3<span class="token text string">[MCP Server 3&lt;br/>APIé›†æˆ]</span>
    <span class="token keyword">end</span>
    
    <span class="token keyword">subgraph</span> èµ„æºå±‚
        D1<span class="token text string">[æœ¬åœ°æ–‡ä»¶]</span>
        D2<span class="token text string">[MySQL]</span>
        D3<span class="token text string">[REST API]</span>
    <span class="token keyword">end</span>
    
    A1 <span class="token arrow operator">--></span> B
    A2 <span class="token arrow operator">--></span> B
    B <span class="token arrow operator">--></span> C1
    B <span class="token arrow operator">--></span> C2
    B <span class="token arrow operator">--></span> C3
    C1 <span class="token arrow operator">--></span> D1
    C2 <span class="token arrow operator">--></span> D2
    C3 <span class="token arrow operator">--></span> D3
    
    <span class="token keyword">style</span> A1 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e3f2fd</span>
    <span class="token keyword">style</span> A2 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e3f2fd</span>
    <span class="token keyword">style</span> B <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#fff9c4</span>
    <span class="token keyword">style</span> C1 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e1f5e1</span>
    <span class="token keyword">style</span> C2 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e1f5e1</span>
    <span class="token keyword">style</span> C3 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e1f5e1</span>
    <span class="token keyword">style</span> D1 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span>
    <span class="token keyword">style</span> D2 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span>
    <span class="token keyword">style</span> D3 <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-2-é€šä¿¡åè®®"><a href="#3-2-é€šä¿¡åè®®" class="headerlink" title="3.2 é€šä¿¡åè®®"></a>3.2 é€šä¿¡åè®®</h3><p>MCP ä½¿ç”¨ <strong>JSON-RPC 2.0</strong> ä½œä¸ºåº•å±‚é€šä¿¡åè®®ï¼Œæ”¯æŒä¸¤ç§ä¼ è¾“æ–¹å¼ï¼š</p>
<h4 id="æ ‡å‡†è¾“å…¥è¾“å‡º-stdio"><a href="#æ ‡å‡†è¾“å…¥è¾“å‡º-stdio" class="headerlink" title="æ ‡å‡†è¾“å…¥è¾“å‡º (stdio)"></a>æ ‡å‡†è¾“å…¥è¾“å‡º (stdio)</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"jsonrpc"</span><span class="token operator">:</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span>
  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"tools/call"</span><span class="token punctuation">,</span>
  <span class="token property">"params"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"query_database"</span><span class="token punctuation">,</span>
    <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"sql"</span><span class="token operator">:</span> <span class="token string">"SELECT * FROM users"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="HTTP-SSE-Server-Sent-Events"><a href="#HTTP-SSE-Server-Sent-Events" class="headerlink" title="HTTP&#x2F;SSE (Server-Sent Events)"></a>HTTP&#x2F;SSE (Server-Sent Events)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®¢æˆ·ç«¯è¯·æ±‚</span>
POST /mcp HTTP/1.1
Content-Type: application/json

<span class="token punctuation">&#123;</span><span class="token string">"jsonrpc"</span><span class="token builtin class-name">:</span><span class="token string">"2.0"</span>,<span class="token string">"method"</span><span class="token builtin class-name">:</span><span class="token string">"resources/list"</span>,<span class="token string">"id"</span>:1<span class="token punctuation">&#125;</span>

<span class="token comment"># æœåŠ¡ç«¯å“åº”</span>
HTTP/1.1 <span class="token number">200</span> OK
Content-Type: application/json

<span class="token punctuation">&#123;</span><span class="token string">"jsonrpc"</span><span class="token builtin class-name">:</span><span class="token string">"2.0"</span>,<span class="token string">"id"</span>:1,<span class="token string">"result"</span>:<span class="token punctuation">&#123;</span><span class="token string">"resources"</span>:<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-3-æ ¸å¿ƒæ¶ˆæ¯ç±»å‹"><a href="#3-3-æ ¸å¿ƒæ¶ˆæ¯ç±»å‹" class="headerlink" title="3.3 æ ¸å¿ƒæ¶ˆæ¯ç±»å‹"></a>3.3 æ ¸å¿ƒæ¶ˆæ¯ç±»å‹</h3><table>
<thead>
<tr>
<th>æ¶ˆæ¯ç±»å‹</th>
<th>æ–¹å‘</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>initialize</strong></td>
<td>Client â†’ Server</td>
<td>åˆå§‹åŒ–è¿æ¥ï¼Œåå•†èƒ½åŠ›</td>
</tr>
<tr>
<td><strong>resources&#x2F;list</strong></td>
<td>Client â†’ Server</td>
<td>åˆ—å‡ºå¯ç”¨èµ„æº</td>
</tr>
<tr>
<td><strong>resources&#x2F;read</strong></td>
<td>Client â†’ Server</td>
<td>è¯»å–ç‰¹å®šèµ„æºå†…å®¹</td>
</tr>
<tr>
<td><strong>tools&#x2F;list</strong></td>
<td>Client â†’ Server</td>
<td>åˆ—å‡ºå¯ç”¨å·¥å…·</td>
</tr>
<tr>
<td><strong>tools&#x2F;call</strong></td>
<td>Client â†’ Server</td>
<td>è°ƒç”¨ç‰¹å®šå·¥å…·</td>
</tr>
<tr>
<td><strong>prompts&#x2F;list</strong></td>
<td>Client â†’ Server</td>
<td>åˆ—å‡ºæç¤ºè¯æ¨¡æ¿</td>
</tr>
<tr>
<td><strong>prompts&#x2F;get</strong></td>
<td>Client â†’ Server</td>
<td>è·å–æç¤ºè¯å†…å®¹</td>
</tr>
<tr>
<td><strong>notifications</strong></td>
<td>Server â†’ Client</td>
<td>æœåŠ¡ç«¯æ¨é€é€šçŸ¥</td>
</tr>
</tbody></table>
<h2 id="å››ã€å¿«é€Ÿä¸Šæ‰‹ï¼šæ„å»ºç¬¬ä¸€ä¸ª-MCP-Server"><a href="#å››ã€å¿«é€Ÿä¸Šæ‰‹ï¼šæ„å»ºç¬¬ä¸€ä¸ª-MCP-Server" class="headerlink" title="å››ã€å¿«é€Ÿä¸Šæ‰‹ï¼šæ„å»ºç¬¬ä¸€ä¸ª MCP Server"></a>å››ã€å¿«é€Ÿä¸Šæ‰‹ï¼šæ„å»ºç¬¬ä¸€ä¸ª MCP Server</h2><h3 id="4-1-ç¯å¢ƒå‡†å¤‡"><a href="#4-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="4.1 ç¯å¢ƒå‡†å¤‡"></a>4.1 ç¯å¢ƒå‡†å¤‡</h3><p><strong>ç³»ç»Ÿè¦æ±‚</strong>ï¼š</p>
<ul>
<li>Node.js 18+ æˆ– Python 3.10+</li>
<li>æ”¯æŒ MCP çš„ AI åº”ç”¨ï¼ˆå¦‚ Claude Desktopï¼‰</li>
</ul>
<p><strong>å®‰è£… SDK</strong>ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># TypeScript/JavaScript</span>
<span class="token function">npm</span> <span class="token function">install</span> @modelcontextprotocol/sdk

<span class="token comment"># Python</span>
pip <span class="token function">install</span> mcp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-åˆ›å»ºç®€å•çš„-MCP-Serverï¼ˆTypeScriptï¼‰"><a href="#4-2-åˆ›å»ºç®€å•çš„-MCP-Serverï¼ˆTypeScriptï¼‰" class="headerlink" title="4.2 åˆ›å»ºç®€å•çš„ MCP Serverï¼ˆTypeScriptï¼‰"></a>4.2 åˆ›å»ºç®€å•çš„ MCP Serverï¼ˆTypeScriptï¼‰</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Server <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@modelcontextprotocol/sdk/server/index.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> StdioServerTransport <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  ListResourcesRequestSchema<span class="token punctuation">,</span>
  ReadResourceRequestSchema<span class="token punctuation">,</span>
  ListToolsRequestSchema<span class="token punctuation">,</span>
  CallToolRequestSchema<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@modelcontextprotocol/sdk/types.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">"fs/promises"</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»º MCP Server å®ä¾‹</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span>
  <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">"my-first-mcp-server"</span><span class="token punctuation">,</span>
    version<span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    capabilities<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      resources<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      tools<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®ç°èµ„æºåˆ—è¡¨</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ListResourcesRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    resources<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        uri<span class="token operator">:</span> <span class="token string">"file:///Users/project/README.md"</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">"é¡¹ç›®æ–‡æ¡£"</span><span class="token punctuation">,</span>
        mimeType<span class="token operator">:</span> <span class="token string">"text/markdown"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"é¡¹ç›®çš„ README æ–‡ä»¶"</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®ç°èµ„æºè¯»å–</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ReadResourceRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> uri <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>uri<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>uri<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"file://"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> uri<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç§»é™¤ file:// å‰ç¼€</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      contents<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          uri<span class="token punctuation">,</span>
          mimeType<span class="token operator">:</span> <span class="token string">"text/markdown"</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> content<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"ä¸æ”¯æŒçš„ URI æ ¼å¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®ç°å·¥å…·åˆ—è¡¨</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ListToolsRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    tools<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"read_file"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            path<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
              description<span class="token operator">:</span> <span class="token string">"æ–‡ä»¶è·¯å¾„"</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®ç°å·¥å…·è°ƒç”¨</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">"read_file"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> path <span class="token punctuation">&#125;</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>arguments <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> path<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      content<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> content<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"æœªçŸ¥å·¥å…·"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¯åŠ¨æœåŠ¡å™¨</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> transport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdioServerTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>transport<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"MCP Server å·²å¯åŠ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3-åˆ›å»ºç®€å•çš„-MCP-Serverï¼ˆPythonï¼‰"><a href="#4-3-åˆ›å»ºç®€å•çš„-MCP-Serverï¼ˆPythonï¼‰" class="headerlink" title="4.3 åˆ›å»ºç®€å•çš„ MCP Serverï¼ˆPythonï¼‰"></a>4.3 åˆ›å»ºç®€å•çš„ MCP Serverï¼ˆPythonï¼‰</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server <span class="token keyword">import</span> Server
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server<span class="token punctuation">.</span>stdio <span class="token keyword">import</span> stdio_server
<span class="token keyword">from</span> mcp<span class="token punctuation">.</span>types <span class="token keyword">import</span> Resource<span class="token punctuation">,</span> Tool<span class="token punctuation">,</span> TextContent
<span class="token keyword">import</span> asyncio

<span class="token comment"># åˆ›å»º MCP Server å®ä¾‹</span>
app <span class="token operator">=</span> Server<span class="token punctuation">(</span><span class="token string">"my-first-mcp-server"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>list_resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">list_resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>Resource<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""åˆ—å‡ºå¯ç”¨èµ„æº"""</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        Resource<span class="token punctuation">(</span>
            uri<span class="token operator">=</span><span class="token string">"file:///Users/project/README.md"</span><span class="token punctuation">,</span>
            name<span class="token operator">=</span><span class="token string">"é¡¹ç›®æ–‡æ¡£"</span><span class="token punctuation">,</span>
            mimeType<span class="token operator">=</span><span class="token string">"text/markdown"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"é¡¹ç›®çš„ README æ–‡ä»¶"</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>read_resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_resource</span><span class="token punctuation">(</span>uri<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""è¯»å–èµ„æºå†…å®¹"""</span>
    <span class="token keyword">if</span> uri<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"file://"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        file_path <span class="token operator">=</span> uri<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># ç§»é™¤ file:// å‰ç¼€</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"ä¸æ”¯æŒçš„ URI æ ¼å¼"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>list_tools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">list_tools</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>Tool<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""åˆ—å‡ºå¯ç”¨å·¥å…·"""</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        Tool<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"read_file"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"è¯»å–æœ¬åœ°æ–‡ä»¶å†…å®¹"</span><span class="token punctuation">,</span>
            inputSchema<span class="token operator">=</span><span class="token punctuation">&#123;</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
                <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                        <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"æ–‡ä»¶è·¯å¾„"</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>call_tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">call_tool</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> arguments<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>TextContent<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""å¤„ç†å·¥å…·è°ƒç”¨"""</span>
    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">"read_file"</span><span class="token punctuation">:</span>
        path <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>TextContent<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">,</span> text<span class="token operator">=</span>content<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"æœªçŸ¥å·¥å…·"</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""å¯åŠ¨æœåŠ¡å™¨"""</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> stdio_server<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>read_stream<span class="token punctuation">,</span> write_stream<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>read_stream<span class="token punctuation">,</span> write_stream<span class="token punctuation">,</span> app<span class="token punctuation">.</span>create_initialization_options<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-4-é…ç½®-Claude-Desktop-ä½¿ç”¨-MCP-Server"><a href="#4-4-é…ç½®-Claude-Desktop-ä½¿ç”¨-MCP-Server" class="headerlink" title="4.4 é…ç½® Claude Desktop ä½¿ç”¨ MCP Server"></a>4.4 é…ç½® Claude Desktop ä½¿ç”¨ MCP Server</h3><p>åœ¨ Claude Desktop é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä½ çš„ MCP Serverï¼š</p>
<p><strong>macOS</strong>: <code>~/Library/Application Support/Claude/claude_desktop_config.json</code></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"mcpServers"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"my-first-server"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
      <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"/path/to/your/build/index.js"</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é‡å¯ Claude Desktop</strong>ï¼Œä½ çš„ MCP Server å°±ä¼šè‡ªåŠ¨åŠ è½½ï¼</p>
<h2 id="äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºå®ç”¨çš„-MCP-Server"><a href="#äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºå®ç”¨çš„-MCP-Server" class="headerlink" title="äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºå®ç”¨çš„ MCP Server"></a>äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºå®ç”¨çš„ MCP Server</h2><h3 id="5-1-æ¡ˆä¾‹ä¸€ï¼šæ•°æ®åº“æŸ¥è¯¢-MCP-Server"><a href="#5-1-æ¡ˆä¾‹ä¸€ï¼šæ•°æ®åº“æŸ¥è¯¢-MCP-Server" class="headerlink" title="5.1 æ¡ˆä¾‹ä¸€ï¼šæ•°æ®åº“æŸ¥è¯¢ MCP Server"></a>5.1 æ¡ˆä¾‹ä¸€ï¼šæ•°æ®åº“æŸ¥è¯¢ MCP Server</h3><p><strong>åŠŸèƒ½</strong>ï¼šè®© AI èƒ½å¤Ÿè‡ªç„¶è¯­è¨€æŸ¥è¯¢æ•°æ®åº“</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Server <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@modelcontextprotocol/sdk/server/index.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> mysql <span class="token keyword">from</span> <span class="token string">"mysql2/promise"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"database-mcp-server"</span><span class="token punctuation">,</span>
  version<span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ•°æ®åº“è¿æ¥æ± </span>
<span class="token keyword">const</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  host<span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
  user<span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">"password"</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token string">"mydb"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®šä¹‰æŸ¥è¯¢å·¥å…·</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ListToolsRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    tools<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"execute_sql"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"æ‰§è¡Œ SQL æŸ¥è¯¢è¯­å¥ï¼ˆåªè¯»ï¼‰"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            sql<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"SELECT æŸ¥è¯¢è¯­å¥"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"sql"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"list_tables"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span> properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"describe_table"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"æŸ¥çœ‹è¡¨ç»“æ„"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            table<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"è¡¨å"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"table"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å®ç°å·¥å…·è°ƒç”¨</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> arguments<span class="token operator">:</span> args <span class="token punctuation">&#125;</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">"execute_sql"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> sql <span class="token punctuation">&#125;</span> <span class="token operator">=</span> args <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> sql<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token comment">// å®‰å…¨æ£€æŸ¥ï¼šåªå…è®¸ SELECT è¯­å¥</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sql<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"ä»…æ”¯æŒ SELECT æŸ¥è¯¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        content<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">case</span> <span class="token string">"list_tables"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>tables<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"SHOW TABLES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        content<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>tables<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">case</span> <span class="token string">"describe_table"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> table <span class="token punctuation">&#125;</span> <span class="token operator">=</span> args <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> table<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>columns<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">DESCRIBE </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>table<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        content<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>columns<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æœªçŸ¥å·¥å…·: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ä½¿ç”¨æ•ˆæœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">ç”¨æˆ·ï¼šå¸®æˆ‘æŸ¥è¯¢ä¸€ä¸‹æœ€è¿‘ä¸€å‘¨æ³¨å†Œçš„ç”¨æˆ·æ•°é‡
AIï¼šæˆ‘æ¥æŸ¥è¯¢æ•°æ®åº“... [è°ƒç”¨ execute_sql å·¥å…·]
ç»“æœï¼šæœ€è¿‘ä¸€å‘¨å…±æœ‰ 156 ä½ç”¨æˆ·æ³¨å†Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="5-2-æ¡ˆä¾‹äºŒï¼šGitHub-é›†æˆ-MCP-Server"><a href="#5-2-æ¡ˆä¾‹äºŒï¼šGitHub-é›†æˆ-MCP-Server" class="headerlink" title="5.2 æ¡ˆä¾‹äºŒï¼šGitHub é›†æˆ MCP Server"></a>5.2 æ¡ˆä¾‹äºŒï¼šGitHub é›†æˆ MCP Server</h3><p><strong>åŠŸèƒ½</strong>ï¼šè®© AI èƒ½å¤Ÿè®¿é—® GitHub ä»“åº“ä¿¡æ¯</p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Octokit <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@octokit/rest"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> octokit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Octokit</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> auth<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_TOKEN</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>ListToolsRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
    tools<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"list_repos"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"åˆ—å‡ºç”¨æˆ·çš„ GitHub ä»“åº“"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            username<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"GitHub ç”¨æˆ·å"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"get_repo_info"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"è·å–ä»“åº“è¯¦ç»†ä¿¡æ¯"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            owner<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"ä»“åº“æ‰€æœ‰è€…"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            repo<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"ä»“åº“åç§°"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"owner"</span><span class="token punctuation">,</span> <span class="token string">"repo"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">"search_issues"</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">"æœç´¢ Issue"</span><span class="token punctuation">,</span>
        inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
          properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            query<span class="token operator">:</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">"æœç´¢å…³é”®è¯"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          required<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> arguments<span class="token operator">:</span> args <span class="token punctuation">&#125;</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">"list_repos"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username <span class="token punctuation">&#125;</span> <span class="token operator">=</span> args <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> username<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> octokit<span class="token punctuation">.</span>repos<span class="token punctuation">.</span><span class="token function">listForUser</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        content<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
              data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                name<span class="token operator">:</span> repo<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                description<span class="token operator">:</span> repo<span class="token punctuation">.</span>description<span class="token punctuation">,</span>
                stars<span class="token operator">:</span> repo<span class="token punctuation">.</span>stargazers_count<span class="token punctuation">,</span>
                language<span class="token operator">:</span> repo<span class="token punctuation">.</span>language<span class="token punctuation">,</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">null</span><span class="token punctuation">,</span>
              <span class="token number">2</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">case</span> <span class="token string">"get_repo_info"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> owner<span class="token punctuation">,</span> repo <span class="token punctuation">&#125;</span> <span class="token operator">=</span> args <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> owner<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> repo<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> octokit<span class="token punctuation">.</span>repos<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> owner<span class="token punctuation">,</span> repo <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        content<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
              <span class="token punctuation">&#123;</span>
                name<span class="token operator">:</span> data<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                description<span class="token operator">:</span> data<span class="token punctuation">.</span>description<span class="token punctuation">,</span>
                stars<span class="token operator">:</span> data<span class="token punctuation">.</span>stargazers_count<span class="token punctuation">,</span>
                forks<span class="token operator">:</span> data<span class="token punctuation">.</span>forks_count<span class="token punctuation">,</span>
                open_issues<span class="token operator">:</span> data<span class="token punctuation">.</span>open_issues_count<span class="token punctuation">,</span>
                language<span class="token operator">:</span> data<span class="token punctuation">.</span>language<span class="token punctuation">,</span>
                created_at<span class="token operator">:</span> data<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
                updated_at<span class="token operator">:</span> data<span class="token punctuation">.</span>updated_at<span class="token punctuation">,</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
              <span class="token keyword">null</span><span class="token punctuation">,</span>
              <span class="token number">2</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">case</span> <span class="token string">"search_issues"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> query <span class="token punctuation">&#125;</span> <span class="token operator">=</span> args <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> query<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> octokit<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">issuesAndPullRequests</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        q<span class="token operator">:</span> query<span class="token punctuation">,</span>
        per_page<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        content<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
              data<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                title<span class="token operator">:</span> item<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
                state<span class="token operator">:</span> item<span class="token punctuation">.</span>state<span class="token punctuation">,</span>
                url<span class="token operator">:</span> item<span class="token punctuation">.</span>html_url<span class="token punctuation">,</span>
                created_at<span class="token operator">:</span> item<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token keyword">null</span><span class="token punctuation">,</span>
              <span class="token number">2</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æœªçŸ¥å·¥å…·: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-3-æ¡ˆä¾‹ä¸‰ï¼šå¤©æ°”æŸ¥è¯¢-MCP-Server"><a href="#5-3-æ¡ˆä¾‹ä¸‰ï¼šå¤©æ°”æŸ¥è¯¢-MCP-Server" class="headerlink" title="5.3 æ¡ˆä¾‹ä¸‰ï¼šå¤©æ°”æŸ¥è¯¢ MCP Server"></a>5.3 æ¡ˆä¾‹ä¸‰ï¼šå¤©æ°”æŸ¥è¯¢ MCP Server</h3><p><strong>åŠŸèƒ½</strong>ï¼šæä¾›å®æ—¶å¤©æ°”ä¿¡æ¯</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> mcp<span class="token punctuation">.</span>server <span class="token keyword">import</span> Server
<span class="token keyword">import</span> aiohttp
<span class="token keyword">import</span> os

app <span class="token operator">=</span> Server<span class="token punctuation">(</span><span class="token string">"weather-mcp-server"</span><span class="token punctuation">)</span>
WEATHER_API_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"WEATHER_API_KEY"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>list_tools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">list_tools</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>Tool<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        Tool<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"get_weather"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"è·å–åŸå¸‚çš„å®æ—¶å¤©æ°”ä¿¡æ¯"</span><span class="token punctuation">,</span>
            inputSchema<span class="token operator">=</span><span class="token punctuation">&#123;</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
                <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token string">"city"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                        <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"åŸå¸‚åç§°ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰"</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"city"</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        Tool<span class="token punctuation">(</span>
            name<span class="token operator">=</span><span class="token string">"get_forecast"</span><span class="token punctuation">,</span>
            description<span class="token operator">=</span><span class="token string">"è·å–æœªæ¥7å¤©å¤©æ°”é¢„æŠ¥"</span><span class="token punctuation">,</span>
            inputSchema<span class="token operator">=</span><span class="token punctuation">&#123;</span>
                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
                <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token string">"city"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
                        <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"åŸå¸‚åç§°"</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"city"</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">]</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>call_tool</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">call_tool</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> arguments<span class="token punctuation">:</span> <span class="token builtin">dict</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>TextContent<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">"get_weather"</span><span class="token punctuation">:</span>
        city <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token string">"city"</span><span class="token punctuation">]</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
            url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://api.openweathermap.org/data/2.5/weather"</span></span>
            params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"q"</span><span class="token punctuation">:</span> city<span class="token punctuation">,</span>
                <span class="token string">"appid"</span><span class="token punctuation">:</span> WEATHER_API_KEY<span class="token punctuation">,</span>
                <span class="token string">"units"</span><span class="token punctuation">:</span> <span class="token string">"metric"</span><span class="token punctuation">,</span>
                <span class="token string">"lang"</span><span class="token punctuation">:</span> <span class="token string">"zh_cn"</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>
                data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
                weather_info <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"""
åŸå¸‚ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">
å¤©æ°”ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">[</span><span class="token string">'weather'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">
æ¸©åº¦ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">Â°C
ä½“æ„Ÿæ¸©åº¦ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'feels_like'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">Â°C
æ¹¿åº¦ï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'humidity'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">%
é£é€Ÿï¼š</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">[</span><span class="token string">'wind'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'speed'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> m/s
                """</span></span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span>TextContent<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">,</span> text<span class="token operator">=</span>weather_info<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    
    <span class="token keyword">elif</span> name <span class="token operator">==</span> <span class="token string">"get_forecast"</span><span class="token punctuation">:</span>
        city <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token string">"city"</span><span class="token punctuation">]</span>
        <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
            url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"https://api.openweathermap.org/data/2.5/forecast"</span></span>
            params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"q"</span><span class="token punctuation">:</span> city<span class="token punctuation">,</span>
                <span class="token string">"appid"</span><span class="token punctuation">:</span> WEATHER_API_KEY<span class="token punctuation">,</span>
                <span class="token string">"units"</span><span class="token punctuation">:</span> <span class="token string">"metric"</span><span class="token punctuation">,</span>
                <span class="token string">"lang"</span><span class="token punctuation">:</span> <span class="token string">"zh_cn"</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>
                data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
                forecast <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">[</span><span class="token string">'dt_txt'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">[</span><span class="token string">'weather'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">, "</span></span>
                    <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'temp'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">Â°C"</span></span>
                    <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">]</span>  <span class="token comment"># å‰7å¤©æ•°æ®</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span>TextContent<span class="token punctuation">(</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span><span class="token punctuation">,</span> text<span class="token operator">=</span>forecast<span class="token punctuation">)</span><span class="token punctuation">]</span>
    
    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"æœªçŸ¥å·¥å…·"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å…­ã€MCP-Server-æœ€ä½³å®è·µ"><a href="#å…­ã€MCP-Server-æœ€ä½³å®è·µ" class="headerlink" title="å…­ã€MCP Server æœ€ä½³å®è·µ"></a>å…­ã€MCP Server æœ€ä½³å®è·µ</h2><h3 id="6-1-å®‰å…¨æ€§è€ƒè™‘"><a href="#6-1-å®‰å…¨æ€§è€ƒè™‘" class="headerlink" title="6.1 å®‰å…¨æ€§è€ƒè™‘"></a>6.1 å®‰å…¨æ€§è€ƒè™‘</h3><p><strong>1. è¾“å…¥éªŒè¯</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// âŒ ä¸å®‰å…¨çš„åšæ³•</span>
<span class="token keyword">const</span> sql <span class="token operator">=</span> args<span class="token punctuation">.</span>sql<span class="token punctuation">;</span>
<span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯èƒ½å¯¼è‡´ SQL æ³¨å…¥</span>

<span class="token comment">// âœ… å®‰å…¨çš„åšæ³•</span>
<span class="token keyword">const</span> sql <span class="token operator">=</span> args<span class="token punctuation">.</span>sql<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sql<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"ä»…æ”¯æŒ SELECT æŸ¥è¯¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢</span>
<span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users WHERE id = ?"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>args<span class="token punctuation">.</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. æƒé™æ§åˆ¶</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// å®šä¹‰æƒé™çº§åˆ«</span>
<span class="token keyword">const</span> <span class="token constant">PERMISSIONS</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  read<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"resources/read"</span><span class="token punctuation">,</span> <span class="token string">"tools/query"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  write<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"tools/create"</span><span class="token punctuation">,</span> <span class="token string">"tools/update"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  admin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"tools/delete"</span><span class="token punctuation">,</span> <span class="token string">"tools/execute"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// åœ¨å·¥å…·è°ƒç”¨æ—¶æ£€æŸ¥æƒé™</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> userRole <span class="token operator">=</span> request<span class="token punctuation">.</span>context<span class="token operator">?.</span>role <span class="token operator">||</span> <span class="token string">"read"</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> requiredPermission <span class="token operator">=</span> <span class="token function">getRequiredPermission</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">PERMISSIONS</span><span class="token punctuation">[</span>userRole<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>requiredPermission<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"æƒé™ä¸è¶³"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// æ‰§è¡Œå·¥å…·è°ƒç”¨...</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥</span>
<span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">"sk-1234567890abcdef"</span><span class="token punctuation">;</span>

<span class="token comment">// âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡</span>
<span class="token keyword">const</span> apiKey <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_KEY</span><span class="token punctuation">;</span>

<span class="token comment">// âœ… è„±æ•æ—¥å¿—è¾“å‡º</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">API Key: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>apiKey<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">***</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-2-æ€§èƒ½ä¼˜åŒ–"><a href="#6-2-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="6.2 æ€§èƒ½ä¼˜åŒ–"></a>6.2 æ€§èƒ½ä¼˜åŒ–</h3><p><strong>1. è¿æ¥æ± ç®¡ç†</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// âœ… ä½¿ç”¨è¿æ¥æ± è€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºæ–°è¿æ¥</span>
<span class="token keyword">const</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  host<span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
  user<span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">"password"</span><span class="token punctuation">,</span>
  database<span class="token operator">:</span> <span class="token string">"mydb"</span><span class="token punctuation">,</span>
  connectionLimit<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// æœ€å¤§è¿æ¥æ•°</span>
  queueLimit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. ç»“æœç¼“å­˜</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> NodeCache <span class="token keyword">from</span> <span class="token string">"node-cache"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeCache</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> stdTTL<span class="token operator">:</span> <span class="token number">300</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5åˆ†é’Ÿç¼“å­˜</span>

server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> cacheKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
    request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>arguments
  <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token comment">// æ£€æŸ¥ç¼“å­˜</span>
  <span class="token keyword">const</span> cached <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">// æ‰§è¡Œå·¥å…·è°ƒç”¨</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">executeToolCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å­˜å…¥ç¼“å­˜</span>
  cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3. æ‰¹é‡å¤„ç†</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// âœ… æ‰¹é‡æ“ä½œè€Œä¸æ˜¯å¾ªç¯å•æ¬¡æ“ä½œ</span>
server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">"batch_query"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> ids <span class="token punctuation">&#125;</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>arguments <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> ids<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">// ä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰ ID</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * FROM users WHERE id IN (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>ids<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">))</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
      content<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-3-é”™è¯¯å¤„ç†"><a href="#6-3-é”™è¯¯å¤„ç†" class="headerlink" title="6.3 é”™è¯¯å¤„ç†"></a>6.3 é”™è¯¯å¤„ç†</h3><p><strong>1. ç»Ÿä¸€é”™è¯¯æ ¼å¼</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">MCPError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> details<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"MCPError"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ‰§è¡Œå·¥å…·è°ƒç”¨</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">executeToolCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name">MCPError</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// åŒ…è£…æœªçŸ¥é”™è¯¯</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MCPError</span><span class="token punctuation">(</span>
      <span class="token string">"INTERNAL_ERROR"</span><span class="token punctuation">,</span>
      <span class="token string">"å·¥å…·æ‰§è¡Œå¤±è´¥"</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span> original<span class="token operator">:</span> error<span class="token punctuation">.</span>message <span class="token punctuation">&#125;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// âŒ æ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"æ“ä½œå¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// âœ… æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MCPError</span><span class="token punctuation">(</span>
  <span class="token string">"DATABASE_ERROR"</span><span class="token punctuation">,</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    table<span class="token operator">:</span> <span class="token string">"users"</span><span class="token punctuation">,</span>
    operation<span class="token operator">:</span> <span class="token string">"SELECT"</span><span class="token punctuation">,</span>
    sql<span class="token operator">:</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span>sql<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-4-æ—¥å¿—ä¸ç›‘æ§"><a href="#6-4-æ—¥å¿—ä¸ç›‘æ§" class="headerlink" title="6.4 æ—¥å¿—ä¸ç›‘æ§"></a>6.4 æ—¥å¿—ä¸ç›‘æ§</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> winston <span class="token keyword">from</span> <span class="token string">"winston"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> winston<span class="token punctuation">.</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  level<span class="token operator">:</span> <span class="token string">"info"</span><span class="token punctuation">,</span>
  format<span class="token operator">:</span> winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  transports<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">winston</span><span class="token punctuation">.</span>transports<span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> filename<span class="token operator">:</span> <span class="token string">"error.log"</span><span class="token punctuation">,</span> level<span class="token operator">:</span> <span class="token string">"error"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">winston</span><span class="token punctuation">.</span>transports<span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> filename<span class="token operator">:</span> <span class="token string">"combined.log"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">setRequestHandler</span><span class="token punctuation">(</span>CallToolRequestSchema<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å·¥å…·è°ƒç”¨å¼€å§‹"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    tool<span class="token operator">:</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    arguments<span class="token operator">:</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>arguments<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">executeToolCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å·¥å…·è°ƒç”¨æˆåŠŸ"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      tool<span class="token operator">:</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      duration<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å·¥å…·è°ƒç”¨å¤±è´¥"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      tool<span class="token operator">:</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      error<span class="token operator">:</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
      duration<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä¸ƒã€MCP-ç”Ÿæ€ä¸ç¤¾åŒºèµ„æº"><a href="#ä¸ƒã€MCP-ç”Ÿæ€ä¸ç¤¾åŒºèµ„æº" class="headerlink" title="ä¸ƒã€MCP ç”Ÿæ€ä¸ç¤¾åŒºèµ„æº"></a>ä¸ƒã€MCP ç”Ÿæ€ä¸ç¤¾åŒºèµ„æº</h2><h3 id="7-1-å®˜æ–¹èµ„æº"><a href="#7-1-å®˜æ–¹èµ„æº" class="headerlink" title="7.1 å®˜æ–¹èµ„æº"></a>7.1 å®˜æ–¹èµ„æº</h3><table>
<thead>
<tr>
<th>èµ„æºç±»å‹</th>
<th>é“¾æ¥</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>ğŸ“˜ <strong>å®˜æ–¹æ–‡æ¡£</strong></td>
<td><a href="https://modelcontextprotocol.io/">modelcontextprotocol.io</a></td>
<td>å®Œæ•´çš„åè®®è§„èŒƒå’ŒæŒ‡å—</td>
</tr>
<tr>
<td>ğŸ“¦ <strong>SDK ä»“åº“</strong></td>
<td><a href="https://github.com/modelcontextprotocol">github.com&#x2F;modelcontextprotocol</a></td>
<td>TypeScriptã€Python SDK</td>
</tr>
<tr>
<td>ğŸ’¬ <strong>Discord ç¤¾åŒº</strong></td>
<td><a href="https://discord.gg/mcp">MCP Discord</a></td>
<td>å¼€å‘è€…äº¤æµç¤¾åŒº</td>
</tr>
<tr>
<td>ğŸ“ <strong>ç¤ºä¾‹é¡¹ç›®</strong></td>
<td><a href="https://github.com/modelcontextprotocol/servers">MCP Examples</a></td>
<td>å®˜æ–¹ç¤ºä¾‹ MCP Server</td>
</tr>
</tbody></table>
<h3 id="7-2-çƒ­é—¨-MCP-Server-é¡¹ç›®"><a href="#7-2-çƒ­é—¨-MCP-Server-é¡¹ç›®" class="headerlink" title="7.2 çƒ­é—¨ MCP Server é¡¹ç›®"></a>7.2 çƒ­é—¨ MCP Server é¡¹ç›®</h3><p><strong>1. æ–‡ä»¶ç³»ç»Ÿé›†æˆ</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @modelcontextprotocol/server-filesystem</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @modelcontextprotocol/server-filesystem<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åŠŸèƒ½ï¼šè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œè¯»å†™æ–‡ä»¶</p>
<p><strong>2. æ•°æ®åº“é›†æˆ</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @modelcontextprotocol/server-postgres</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @modelcontextprotocol/server-postgres<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åŠŸèƒ½ï¼šè¿æ¥ PostgreSQL æ•°æ®åº“ï¼Œæ‰§è¡Œ SQL æŸ¥è¯¢</p>
<p><strong>3. GitHub é›†æˆ</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @modelcontextprotocol/server-github</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @modelcontextprotocol/server-github<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åŠŸèƒ½ï¼šè®¿é—® GitHub APIï¼Œç®¡ç†ä»“åº“å’Œ Issue</p>
<p><strong>4. Google Drive é›†æˆ</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @modelcontextprotocol/server-gdrive</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @modelcontextprotocol/server-gdrive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åŠŸèƒ½ï¼šè®¿é—® Google Drive æ–‡ä»¶</p>
<p><strong>5. Slack é›†æˆ</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># @modelcontextprotocol/server-slack</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @modelcontextprotocol/server-slack<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åŠŸèƒ½ï¼šå‘é€æ¶ˆæ¯ã€è¯»å–é¢‘é“å†…å®¹</p>
<h3 id="7-3-ç¤¾åŒºè´¡çŒ®é¡¹ç›®"><a href="#7-3-ç¤¾åŒºè´¡çŒ®é¡¹ç›®" class="headerlink" title="7.3 ç¤¾åŒºè´¡çŒ®é¡¹ç›®"></a>7.3 ç¤¾åŒºè´¡çŒ®é¡¹ç›®</h3><ul>
<li><strong>mcp-server-jira</strong>: Jira é¡¹ç›®ç®¡ç†é›†æˆ</li>
<li><strong>mcp-server-notion</strong>: Notion æ•°æ®åº“é›†æˆ</li>
<li><strong>mcp-server-confluence</strong>: Confluence æ–‡æ¡£è®¿é—®</li>
<li><strong>mcp-server-weather</strong>: å¤©æ°”æŸ¥è¯¢æœåŠ¡</li>
<li><strong>mcp-server-translator</strong>: ç¿»è¯‘æœåŠ¡é›†æˆ</li>
</ul>
<h3 id="7-4-å­¦ä¹ èµ„æº"><a href="#7-4-å­¦ä¹ èµ„æº" class="headerlink" title="7.4 å­¦ä¹ èµ„æº"></a>7.4 å­¦ä¹ èµ„æº</h3><p><strong>è§†é¢‘æ•™ç¨‹</strong>ï¼š</p>
<ul>
<li><a href="https://youtube.com/">MCP åè®®å…¥é—¨ - Anthropic å®˜æ–¹æ•™ç¨‹</a></li>
<li><a href="https://youtube.com/">æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª MCP Server</a></li>
</ul>
<p><strong>åšå®¢æ–‡ç« </strong>ï¼š</p>
<ul>
<li><a href="https://blog.example.com/">æ·±å…¥ç†è§£ MCP åè®®è®¾è®¡</a></li>
<li><a href="https://blog.example.com/">MCP vs LangChain Tools: å¦‚ä½•é€‰æ‹©</a></li>
</ul>
<p><strong>å¼€æºé¡¹ç›®</strong>ï¼š</p>
<ul>
<li><a href="https://github.com/awesome-mcp/awesome-mcp">awesome-mcp</a>: MCP èµ„æºæ±‡æ€»</li>
<li><a href="https://mcp-registry.io/">mcp-registry</a>: MCP Server æ³¨å†Œä¸­å¿ƒ</li>
</ul>
<h2 id="å…«ã€MCP-çš„æœªæ¥ä¸å±•æœ›"><a href="#å…«ã€MCP-çš„æœªæ¥ä¸å±•æœ›" class="headerlink" title="å…«ã€MCP çš„æœªæ¥ä¸å±•æœ›"></a>å…«ã€MCP çš„æœªæ¥ä¸å±•æœ›</h2><h3 id="8-1-å‘å±•è¶‹åŠ¿"><a href="#8-1-å‘å±•è¶‹åŠ¿" class="headerlink" title="8.1 å‘å±•è¶‹åŠ¿"></a>8.1 å‘å±•è¶‹åŠ¿</h3><p><strong>1. æ ‡å‡†åŒ–è¿›ç¨‹</strong></p>
<ul>
<li>MCP æ­£åœ¨æˆä¸º AI åº”ç”¨é›†æˆçš„äº‹å®æ ‡å‡†</li>
<li>ä¸»æµ AI åº”ç”¨ï¼ˆClaudeã€ChatGPT ç­‰ï¼‰é™†ç»­æ”¯æŒ</li>
<li>ä¼ä¸šçº§åº”ç”¨åŠ é€Ÿé‡‡ç”¨</li>
</ul>
<p><strong>2. ç”Ÿæ€çˆ†å‘</strong></p>
<pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid"><span class="token keyword">graph</span> LR
    A<span class="token text string">[2024.11&lt;br/>MCP å‘å¸ƒ]</span> <span class="token arrow operator">--></span> B<span class="token text string">[2025 Q1&lt;br/>ç”Ÿæ€åˆå»º]</span>
    B <span class="token arrow operator">--></span> C<span class="token text string">[2025 Q2&lt;br/>å¿«é€Ÿå¢é•¿]</span>
    C <span class="token arrow operator">--></span> D<span class="token text string">[2025 Q4&lt;br/>æˆç†Ÿç”Ÿæ€]</span>
    
    <span class="token keyword">style</span> A <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e3f2fd</span>
    <span class="token keyword">style</span> B <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#fff9c4</span>
    <span class="token keyword">style</span> C <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e1f5e1</span>
    <span class="token keyword">style</span> D <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffebee</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3. åŠŸèƒ½æ‰©å±•</strong></p>
<ul>
<li>æµå¼æ•°æ®ä¼ è¾“æ”¯æŒ</li>
<li>æ›´ä¸°å¯Œçš„èµ„æºç±»å‹</li>
<li>å¢å¼ºçš„æƒé™æ§åˆ¶</li>
<li>è·¨ Server åä½œèƒ½åŠ›</li>
</ul>
<h3 id="8-2-åº”ç”¨åœºæ™¯å±•æœ›"><a href="#8-2-åº”ç”¨åœºæ™¯å±•æœ›" class="headerlink" title="8.2 åº”ç”¨åœºæ™¯å±•æœ›"></a>8.2 åº”ç”¨åœºæ™¯å±•æœ›</h3><p><strong>ä¼ä¸šåº”ç”¨</strong>ï¼š</p>
<ul>
<li>ğŸ“Š <strong>æ•°æ®åˆ†æåŠ©æ‰‹</strong>ï¼šè‡ªç„¶è¯­è¨€æŸ¥è¯¢ä¼ä¸šæ•°æ®</li>
<li>ğŸ¤– <strong>è‡ªåŠ¨åŒ–è¿ç»´</strong>ï¼šAI é©±åŠ¨çš„ç³»ç»Ÿç®¡ç†</li>
<li>ğŸ“ <strong>çŸ¥è¯†ç®¡ç†</strong>ï¼šæ™ºèƒ½æ£€ç´¢ä¼ä¸šæ–‡æ¡£</li>
<li>ğŸ’¼ <strong>å®¢æˆ·æœåŠ¡</strong>ï¼šAI å®¢æœç³»ç»Ÿå‡çº§</li>
</ul>
<p><strong>å¼€å‘è€…å·¥å…·</strong>ï¼š</p>
<ul>
<li>ğŸ”§ <strong>æ™ºèƒ½ä»£ç åŠ©æ‰‹</strong>ï¼šé›†æˆ IDEã€GitHubã€CI&#x2F;CD</li>
<li>ğŸ› <strong>Bug è¯Šæ–­å·¥å…·</strong>ï¼šè‡ªåŠ¨åˆ†ææ—¥å¿—å’Œå †æ ˆ</li>
<li>ğŸ“š <strong>æ–‡æ¡£ç”Ÿæˆå™¨</strong>ï¼šè‡ªåŠ¨åŒ–æŠ€æœ¯æ–‡æ¡£ç¼–å†™</li>
<li>ğŸ§ª <strong>æµ‹è¯•è¾…åŠ©</strong>ï¼šAI ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹</li>
</ul>
<p><strong>ä¸ªäººæ•ˆç‡</strong>ï¼š</p>
<ul>
<li>ğŸ“§ <strong>é‚®ä»¶åŠ©æ‰‹</strong>ï¼šæ™ºèƒ½åˆ†ç±»å’Œå›å¤å»ºè®®</li>
<li>ğŸ“… <strong>æ—¥ç¨‹ç®¡ç†</strong>ï¼šAI é©±åŠ¨çš„æ—¶é—´è§„åˆ’</li>
<li>ğŸ“– <strong>çŸ¥è¯†åº“</strong>ï¼šä¸ªäººç¬”è®°æ™ºèƒ½æ•´ç†</li>
<li>ğŸ’° <strong>è´¢åŠ¡åŠ©æ‰‹</strong>ï¼šè´¦å•åˆ†æå’Œç†è´¢å»ºè®®</li>
</ul>
<h3 id="8-3-ä¸å…¶ä»–æŠ€æœ¯çš„èåˆ"><a href="#8-3-ä¸å…¶ä»–æŠ€æœ¯çš„èåˆ" class="headerlink" title="8.3 ä¸å…¶ä»–æŠ€æœ¯çš„èåˆ"></a>8.3 ä¸å…¶ä»–æŠ€æœ¯çš„èåˆ</h3><p><strong>AI Agent æ¡†æ¶é›†æˆ</strong>ï¼š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># å°† MCP Server é›†æˆåˆ° LangChain</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> Tool
<span class="token keyword">from</span> mcp_client <span class="token keyword">import</span> MCPClient

mcp <span class="token operator">=</span> MCPClient<span class="token punctuation">(</span><span class="token string">"my-mcp-server"</span><span class="token punctuation">)</span>

tools <span class="token operator">=</span> <span class="token punctuation">[</span>
    Tool<span class="token punctuation">(</span>
        name<span class="token operator">=</span><span class="token string">"Database Query"</span><span class="token punctuation">,</span>
        func<span class="token operator">=</span><span class="token keyword">lambda</span> q<span class="token punctuation">:</span> mcp<span class="token punctuation">.</span>call_tool<span class="token punctuation">(</span><span class="token string">"query_db"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"sql"</span><span class="token punctuation">:</span> q<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        description<span class="token operator">=</span><span class="token string">"æŸ¥è¯¢æ•°æ®åº“"</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment"># ä½¿ç”¨ LangChain Agent</span>
<span class="token keyword">from</span> langchain<span class="token punctuation">.</span>agents <span class="token keyword">import</span> initialize_agent
agent <span class="token operator">=</span> initialize_agent<span class="token punctuation">(</span>tools<span class="token punctuation">,</span> llm<span class="token punctuation">,</span> agent<span class="token operator">=</span><span class="token string">"zero-shot-react-description"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å¤šæ¨¡æ€æ”¯æŒ</strong>ï¼š</p>
<ul>
<li>å›¾åƒè¯†åˆ« MCP Server</li>
<li>è¯­éŸ³åˆæˆ MCP Server</li>
<li>è§†é¢‘åˆ†æ MCP Server</li>
</ul>
<h2 id="ä¹ã€æ€»ç»“ä¸è¡ŒåŠ¨æŒ‡å—"><a href="#ä¹ã€æ€»ç»“ä¸è¡ŒåŠ¨æŒ‡å—" class="headerlink" title="ä¹ã€æ€»ç»“ä¸è¡ŒåŠ¨æŒ‡å—"></a>ä¹ã€æ€»ç»“ä¸è¡ŒåŠ¨æŒ‡å—</h2><h3 id="9-1-æ ¸å¿ƒè¦ç‚¹å›é¡¾"><a href="#9-1-æ ¸å¿ƒè¦ç‚¹å›é¡¾" class="headerlink" title="9.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾"></a>9.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3><p>âœ… <strong>MCP è§£å†³äº†ä»€ä¹ˆé—®é¢˜</strong>ï¼š</p>
<ul>
<li>AI åº”ç”¨é›†æˆçš„æ ‡å‡†åŒ–</li>
<li>ä¸€æ¬¡å¼€å‘ï¼Œå¤šå¹³å°å¤ç”¨</li>
<li>é™ä½å¼€å‘å’Œç»´æŠ¤æˆæœ¬</li>
</ul>
<p>âœ… <strong>MCP çš„ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›</strong>ï¼š</p>
<ul>
<li><strong>Resources</strong>ï¼šè®¿é—®å„ç±»æ•°æ®æº</li>
<li><strong>Tools</strong>ï¼šæ‰§è¡Œå„ç§æ“ä½œ</li>
<li><strong>Prompts</strong>ï¼šå¤ç”¨æç¤ºè¯æ¨¡æ¿</li>
</ul>
<p>âœ… <strong>æŠ€æœ¯æ¶æ„</strong>ï¼š</p>
<ul>
<li>åŸºäº JSON-RPC 2.0 åè®®</li>
<li>æ”¯æŒ stdio å’Œ HTTP ä¼ è¾“</li>
<li>å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¨¡å¼</li>
</ul>
<h3 id="9-2-å¿«é€Ÿä¸Šæ‰‹æ­¥éª¤"><a href="#9-2-å¿«é€Ÿä¸Šæ‰‹æ­¥éª¤" class="headerlink" title="9.2 å¿«é€Ÿä¸Šæ‰‹æ­¥éª¤"></a>9.2 å¿«é€Ÿä¸Šæ‰‹æ­¥éª¤</h3><p><strong>ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å®‰è£… Node.js æˆ– Python</span>
<span class="token function">node</span> <span class="token parameter variable">--version</span>  <span class="token comment"># 18+</span>
python <span class="token parameter variable">--version</span>  <span class="token comment"># 3.10+</span>

<span class="token comment"># å®‰è£… SDK</span>
<span class="token function">npm</span> <span class="token function">install</span> @modelcontextprotocol/sdk
<span class="token comment"># æˆ–</span>
pip <span class="token function">install</span> mcp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»º MCP Server</strong></p>
<ul>
<li>é€‰æ‹©ä¸€ä¸ªä½ ç†Ÿæ‚‰çš„åœºæ™¯ï¼ˆæ–‡ä»¶ã€æ•°æ®åº“ã€APIï¼‰</li>
<li>ä½¿ç”¨æœ¬æ–‡æä¾›çš„ä»£ç æ¨¡æ¿</li>
<li>å®ç° Resourcesã€Tools æˆ– Prompts</li>
</ul>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šé…ç½® AI åº”ç”¨</strong></p>
<ul>
<li>ç¼–è¾‘ Claude Desktop é…ç½®æ–‡ä»¶</li>
<li>æ·»åŠ ä½ çš„ MCP Server</li>
<li>é‡å¯åº”ç”¨æµ‹è¯•</li>
</ul>
<p><strong>ç¬¬å››æ­¥ï¼šè¿­ä»£ä¼˜åŒ–</strong></p>
<ul>
<li>æ·»åŠ æ›´å¤šå·¥å…·å’Œèµ„æº</li>
<li>ä¼˜åŒ–æ€§èƒ½å’Œå®‰å…¨æ€§</li>
<li>åˆ†äº«åˆ°ç¤¾åŒº</li>
</ul>
<h3 id="9-3-è¿›é˜¶å­¦ä¹ è·¯å¾„"><a href="#9-3-è¿›é˜¶å­¦ä¹ è·¯å¾„" class="headerlink" title="9.3 è¿›é˜¶å­¦ä¹ è·¯å¾„"></a>9.3 è¿›é˜¶å­¦ä¹ è·¯å¾„</h3><p><strong>åŸºç¡€é˜¶æ®µ</strong>ï¼ˆ1-2 å‘¨ï¼‰ï¼š</p>
<ul>
<li><input disabled type="checkbox"> é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œç†è§£æ ¸å¿ƒæ¦‚å¿µ</li>
<li><input disabled type="checkbox"> å®Œæˆç¬¬ä¸€ä¸ª Hello World MCP Server</li>
<li><input disabled type="checkbox"> åœ¨ Claude Desktop ä¸­æµ‹è¯•ä½¿ç”¨</li>
</ul>
<p><strong>è¿›é˜¶é˜¶æ®µ</strong>ï¼ˆ1 ä¸ªæœˆï¼‰ï¼š</p>
<ul>
<li><input disabled type="checkbox"> å®ç°æ–‡ä»¶ç³»ç»Ÿ MCP Server</li>
<li><input disabled type="checkbox"> å®ç°æ•°æ®åº“é›†æˆ MCP Server</li>
<li><input disabled type="checkbox"> å®ç°ç¬¬ä¸‰æ–¹ API é›†æˆ MCP Server</li>
<li><input disabled type="checkbox"> æŒæ¡é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•</li>
</ul>
<p><strong>é«˜çº§é˜¶æ®µ</strong>ï¼ˆ2-3 ä¸ªæœˆï¼‰ï¼š</p>
<ul>
<li><input disabled type="checkbox"> å®ç°ç”Ÿäº§çº§ MCP Server</li>
<li><input disabled type="checkbox"> ä¼˜åŒ–æ€§èƒ½å’Œå®‰å…¨æ€§</li>
<li><input disabled type="checkbox"> è´¡çŒ®å¼€æºé¡¹ç›®</li>
<li><input disabled type="checkbox"> å‘å¸ƒè‡ªå·±çš„ MCP Server åˆ°ç¤¾åŒº</li>
</ul>
<h3 id="9-4-å®è·µå»ºè®®"><a href="#9-4-å®è·µå»ºè®®" class="headerlink" title="9.4 å®è·µå»ºè®®"></a>9.4 å®è·µå»ºè®®</h3><p><strong>1. ä»å°å¤„ç€æ‰‹</strong></p>
<pre class="line-numbers language-none"><code class="language-none">âŒ ä¸è¦ä¸€å¼€å§‹å°±æƒ³åšå¤æ‚çš„ä¼ä¸šçº§ç³»ç»Ÿ
âœ… ä»ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å–å¼€å§‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>2. æ³¨é‡ç”¨æˆ·ä½“éªŒ</strong></p>
<pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// âœ… æ¸…æ™°çš„å·¥å…·æè¿°</span>
<span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token string">"query_users"</span><span class="token punctuation">,</span>
  description<span class="token operator">:</span> <span class="token string">"æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰å§“åã€é‚®ç®±ã€è§’è‰²ç­›é€‰"</span><span class="token punctuation">,</span>
  <span class="token comment">// è¯¦ç»†çš„å‚æ•°è¯´æ˜</span>
  inputSchema<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    properties<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      name<span class="token operator">:</span> <span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">"ç”¨æˆ·å§“åï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      email<span class="token operator">:</span> <span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">"ç”¨æˆ·é‚®ç®±ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      role<span class="token operator">:</span> <span class="token punctuation">&#123;</span> description<span class="token operator">:</span> <span class="token string">"ç”¨æˆ·è§’è‰²ï¼ˆadmin/user/guestï¼‰"</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3. æŒç»­æ”¹è¿›</strong></p>
<ul>
<li>æ”¶é›†ç”¨æˆ·åé¦ˆ</li>
<li>ç›‘æ§æ€§èƒ½æŒ‡æ ‡</li>
<li>å®šæœŸæ›´æ–°æ–‡æ¡£</li>
</ul>
<h3 id="9-5-å‚ä¸ç¤¾åŒº"><a href="#9-5-å‚ä¸ç¤¾åŒº" class="headerlink" title="9.5 å‚ä¸ç¤¾åŒº"></a>9.5 å‚ä¸ç¤¾åŒº</h3><p><strong>è´¡çŒ®æ–¹å¼</strong>ï¼š</p>
<ul>
<li>ğŸ› æäº¤ Bug æŠ¥å‘Š</li>
<li>ğŸ’¡ åˆ†äº«ä½ çš„ MCP Server</li>
<li>ğŸ“ æ’°å†™æ•™ç¨‹å’Œæ–‡ç« </li>
<li>ğŸ’¬ å¸®åŠ©å…¶ä»–å¼€å‘è€…è§£å†³é—®é¢˜</li>
<li>â­ Star ä¼˜ç§€çš„é¡¹ç›®</li>
</ul>
<p><strong>ç¤¾åŒºèµ„æº</strong>ï¼š</p>
<ul>
<li>GitHub: <a href="https://github.com/modelcontextprotocol">modelcontextprotocol</a></li>
<li>Discord: <a href="https://discord.gg/mcp">MCP å¼€å‘è€…ç¤¾åŒº</a></li>
<li>Twitter: <a href="https://twitter.com/mcp_protocol">@mcp_protocol</a></li>
</ul>
<hr>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>MCP åè®®çš„å‡ºç°ï¼Œæ ‡å¿—ç€ AI åº”ç”¨é›†æˆè¿›å…¥äº†æ ‡å‡†åŒ–æ—¶ä»£ã€‚å°±åƒ HTTP åè®®æ¨åŠ¨äº†äº’è”ç½‘çš„çˆ†å‘å¼å¢é•¿ï¼ŒMCP åè®®ä¹Ÿå°†æ¨åŠ¨ AI åº”ç”¨ç”Ÿæ€çš„ç¹è£å‘å±•ã€‚</p>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œç°åœ¨æ˜¯å‚ä¸è¿™åœºå˜é©çš„æœ€ä½³æ—¶æœºã€‚æ— è®ºä½ æ˜¯æƒ³æå‡ä¸ªäººæ•ˆç‡ï¼Œè¿˜æ˜¯æ„å»ºä¼ä¸šçº§ AI åº”ç”¨ï¼ŒMCP éƒ½ä¸ºä½ æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ã€‚</p>
<p><strong>ä»ä»Šå¤©å¼€å§‹ï¼ŒåŠ¨æ‰‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ª MCP Server å§ï¼</strong> ğŸš€</p>
<p>æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºï¼</p>
]]></content>
      <categories>
        <category>AIç¼–ç¨‹</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>MCP</tag>
        <tag>Claude</tag>
        <tag>åè®®æ ‡å‡†</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€è§„åˆ’ä¹‹é›¶ä¸€èƒŒåŒ…é—®é¢˜</title>
    <url>/2021/03/03/algorithm/dong-tai-gui-hua-zhi-ling-yi-bei-bao-wen-ti/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é¢˜ç›®"><a href="#ä¸€ã€é¢˜ç›®" class="headerlink" title="ä¸€ã€é¢˜ç›®"></a>ä¸€ã€é¢˜ç›®</h1><p>æœ‰ NN ä»¶ç‰©å“å’Œä¸€ä¸ªå®¹é‡ä¸º VV çš„èƒŒåŒ…ï¼Œæ¯ä»¶ç‰©å“æœ‰å„è‡ªçš„ä»·å€¼ï¼Œè¦æ±‚åœ¨æœ‰é™çš„èƒŒåŒ…å®¹é‡ä¸‹ï¼Œè£…å…¥çš„ç‰©å“æ€»ä»·å€¼æœ€å¤§ã€‚</p>
<p>ã€Œ0-1 èƒŒåŒ…ã€æ˜¯è¾ƒä¸ºç®€å•çš„åŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œä¹Ÿæ˜¯å…¶ä½™èƒŒåŒ…é—®é¢˜çš„åŸºç¡€ã€‚</p>
<p>åŠ¨æ€è§„åˆ’æ˜¯ä¸æ–­å†³ç­–æ±‚æœ€ä¼˜è§£çš„è¿‡ç¨‹ï¼Œã€Œ0-1 èƒŒåŒ…ã€å³æ˜¯ä¸æ–­å¯¹ç¬¬ ii ä¸ªç‰©å“çš„åšå‡ºå†³ç­–ï¼Œã€Œ0-1ã€æ­£å¥½ä»£è¡¨ä¸é€‰ä¸é€‰ä¸¤ç§å†³å®šã€‚</p>
<h1 id="äºŒã€é¢˜ç›®åˆ†æ"><a href="#äºŒã€é¢˜ç›®åˆ†æ" class="headerlink" title="äºŒã€é¢˜ç›®åˆ†æ"></a>äºŒã€é¢˜ç›®åˆ†æ</h1><blockquote>
<p>å…³äºåŠ¨æ€ç®—æ³•ï¼Œäº†è§£çš„äººå¯èƒ½éœ€è¦2~3åˆ†é’Ÿï¼Œä¸æ‡‚çš„äººå¯èƒ½éœ€è¦2 ~ 3å¤©ï¼Œäº†è§£åŠ¨æ€ç®—æ³•çš„æ€æƒ³å¾ˆé‡è¦ã€‚</p>
</blockquote>
<h2 id="2-1-äºŒç»´æ•°æ®è§£æ³•"><a href="#2-1-äºŒç»´æ•°æ®è§£æ³•" class="headerlink" title="2.1 äºŒç»´æ•°æ®è§£æ³•"></a>2.1 äºŒç»´æ•°æ®è§£æ³•</h2><p>ï¼ˆ1ï¼‰çŠ¶æ€f[i][j]å®šä¹‰ï¼šå‰ i ä¸ªç‰©å“ï¼ŒèƒŒåŒ…å®¹é‡ j ä¸‹çš„æœ€ä¼˜è§£ï¼ˆæœ€å¤§ä»·å€¼ï¼‰ï¼š</p>
<p>å½“å‰çš„çŠ¶æ€ä¾èµ–äºä¹‹å‰çš„çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºä»åˆå§‹çŠ¶æ€f[0][0] &#x3D; 0å¼€å§‹å†³ç­–ï¼Œæœ‰ N ä»¶ç‰©å“ï¼Œåˆ™éœ€è¦ N æ¬¡å†³ ç­–ï¼Œæ¯ä¸€æ¬¡å¯¹ç¬¬ i ä»¶ç‰©å“çš„å†³ç­–ï¼ŒçŠ¶æ€f[i][j]ä¸æ–­ç”±ä¹‹å‰çš„çŠ¶æ€æ›´æ–°è€Œæ¥ã€‚<br>ï¼ˆ2ï¼‰å½“å‰èƒŒåŒ…å®¹é‡ä¸å¤Ÿï¼ˆj &lt; v[i]ï¼‰ï¼Œæ²¡å¾—é€‰ï¼Œå› æ­¤å‰ i ä¸ªç‰©å“æœ€ä¼˜è§£å³ä¸ºå‰ iâˆ’1 ä¸ªç‰©å“æœ€ä¼˜è§£ï¼š</p>
<p>å¯¹åº”ä»£ç ï¼šf[i][j] &#x3D; f[i - 1][j]ã€‚<br>ï¼ˆ3ï¼‰å½“å‰èƒŒåŒ…å®¹é‡å¤Ÿï¼Œå¯ä»¥é€‰ï¼Œå› æ­¤éœ€è¦å†³ç­–é€‰ä¸ä¸é€‰ç¬¬ i ä¸ªç‰©å“ï¼š</p>
<p>é€‰ï¼šf[i][j] &#x3D; f[i - 1][j - v[i]] + w[i]ã€‚<br>ä¸é€‰ï¼šf[i][j] &#x3D; f[i - 1][j] ã€‚<br>æˆ‘ä»¬çš„å†³ç­–æ˜¯å¦‚ä½•å–åˆ°æœ€å¤§ä»·å€¼ï¼Œå› æ­¤ä»¥ä¸Šä¸¤ç§æƒ…å†µå– max() ã€‚</p>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><pre class="line-numbers language-none"><code class="language-none">public class MyBackpackSolution &#123;
    public static void main(String[] args) &#123;
        int[] weight &#x3D; &#123;2,2,6,5,4&#125;;
        int[] value &#x3D; &#123;6,3,5,4,6&#125;;

        int w &#x3D; 10;

        int n &#x3D; weight.length;
        int[][] maxVal &#x3D; new int[n + 1][w + 1];

        &#x2F;&#x2F; ç”±äºå¾ªç¯ä»1å¼€å§‹ï¼Œæ‰€ä»¥åœ¨éå†weightã€valueæ•°ç»„è·å–æ•°æ®æ—¶åæ ‡éœ€è¦å‡ä¸€
        for(int i&#x3D;1; i&lt;&#x3D;n; i++) &#123;
            for (int j&#x3D;1; j&lt;&#x3D;w; j++) &#123;
                if (j &lt; weight[i-1]) &#123;
                    maxVal[i][j] &#x3D; maxVal[i-1][j];
                &#125; else &#123;
                    maxVal[i][j] &#x3D; Math.max(maxVal[i-1][j], maxVal[i-1][j - weight[i-1]] + value[i-1]);
                &#125;
            &#125;
        &#125;
        System.out.println(maxVal[n][w]);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-2-ä¸€ç»´æ•°ç»„è§£æ³•"><a href="#2-2-ä¸€ç»´æ•°ç»„è§£æ³•" class="headerlink" title="2.2 ä¸€ç»´æ•°ç»„è§£æ³•"></a>2.2 ä¸€ç»´æ•°ç»„è§£æ³•</h2><p>å°†çŠ¶æ€f[i][j]ä¼˜åŒ–åˆ°ä¸€ç»´f[j]ï¼Œå®é™…ä¸Šåªéœ€è¦åšä¸€ä¸ªç­‰ä»·å˜å½¢ã€‚</p>
<p>ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·å˜å½¢å‘¢ï¼Ÿæˆ‘ä»¬å®šä¹‰çš„çŠ¶æ€f[i][j]å¯ä»¥æ±‚å¾—ä»»æ„åˆæ³•çš„iä¸jæœ€ä¼˜è§£ï¼Œä½†é¢˜ç›®åªéœ€è¦æ±‚å¾—æœ€ç»ˆçŠ¶æ€f[n][m]ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ä¸€ç»´çš„ç©ºé—´æ¥æ›´æ–°çŠ¶æ€ã€‚</p>
<p>ï¼ˆ1ï¼‰çŠ¶æ€f[j]å®šä¹‰ï¼šNN ä»¶ç‰©å“ï¼ŒèƒŒåŒ…å®¹é‡jä¸‹çš„æœ€ä¼˜è§£ã€‚</p>
<p>ï¼ˆ2ï¼‰æ³¨æ„æšä¸¾èƒŒåŒ…å®¹é‡jå¿…é¡»ä»må¼€å§‹ã€‚<br>ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆä¸€ç»´æƒ…å†µä¸‹æšä¸¾èƒŒåŒ…å®¹é‡éœ€è¦é€†åºï¼Ÿåœ¨äºŒç»´æƒ…å†µä¸‹ï¼ŒçŠ¶æ€f[i][j]æ˜¯ç”±ä¸Šä¸€è½®i - 1çš„çŠ¶æ€å¾—æ¥çš„ï¼Œf[i][j]ä¸f[i - 1][j]æ˜¯ç‹¬ç«‹çš„ã€‚è€Œä¼˜åŒ–åˆ°ä¸€ç»´åï¼Œå¦‚æœæˆ‘ä»¬è¿˜æ˜¯æ­£åºï¼Œåˆ™æœ‰f[è¾ƒå°ä½“ç§¯]æ›´æ–°åˆ°f[è¾ƒå¤§ä½“ç§¯]ï¼Œåˆ™æœ‰å¯èƒ½æœ¬åº”è¯¥ç”¨ç¬¬i-1è½®çš„çŠ¶æ€å´ç”¨çš„æ˜¯ç¬¬iè½®çš„çŠ¶æ€ã€‚</p>
<p>ï¼ˆ4ï¼‰ä¾‹å¦‚ï¼Œä¸€ç»´çŠ¶æ€ç¬¬iè½®å¯¹ä½“ç§¯ä¸º 33 çš„ç‰©å“è¿›è¡Œå†³ç­–ï¼Œåˆ™f[7]ç”±f[4]æ›´æ–°è€Œæ¥ï¼Œè¿™é‡Œçš„f[4]æ­£ç¡®åº”è¯¥æ˜¯f[i - 1][4]ï¼Œä½†ä»å°åˆ°å¤§æšä¸¾jè¿™é‡Œçš„f[4]åœ¨ç¬¬iè½®è®¡ç®—å´å˜æˆäº†f[i][4]ã€‚å½“é€†åºæšä¸¾èƒŒåŒ…å®¹é‡jæ—¶ï¼Œæˆ‘ä»¬æ±‚f[7]åŒæ ·ç”±f[4]æ›´æ–°ï¼Œä½†ç”±äºæ˜¯é€†åºï¼Œè¿™é‡Œçš„f[4]è¿˜æ²¡æœ‰åœ¨ç¬¬iè½®è®¡ç®—ï¼Œæ‰€ä»¥æ­¤æ—¶å®é™…è®¡ç®—çš„f[4]ä»ç„¶æ˜¯f[i - 1][4]ã€‚</p>
<p>ï¼ˆ5ï¼‰ç®€å•æ¥è¯´ï¼Œä¸€ç»´æƒ…å†µæ­£åºæ›´æ–°çŠ¶æ€f[j]éœ€è¦ç”¨åˆ°å‰é¢è®¡ç®—çš„çŠ¶æ€å·²ç»è¢«ã€Œæ±¡æŸ“ã€ï¼Œé€†åºåˆ™ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼šf[j] &#x3D; max(f[j], f[j - v[i]] + w[i] ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">public class MyBackpackSolution1 &#123;
    public static void main(String[] args) &#123;
        int[] weight &#x3D; &#123;2,2,6,5,4&#125;;
        int[] value &#x3D; &#123;6,3,5,4,6&#125;;

        int w &#x3D; 10;

        int n &#x3D; weight.length;

        int[] maxVal &#x3D; new int[w + 1];

        for (int i &#x3D; 1; i&lt;&#x3D; n; i++) &#123;
            for (int j&#x3D;w; j&gt;&#x3D; 1; j--) &#123;
                if (j &lt; weight[i-1]) &#123;
                    maxVal[j] &#x3D; maxVal[j];
                &#125; else &#123;
                    maxVal[j] &#x3D; Math.max(maxVal[j], maxVal[j - weight[i - 1]] + value[i-1]);
                &#125;
            &#125;
        &#125;
        System.out.println(maxVal[w]);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒè¿˜æ˜¯æ‰¾å­é—®é¢˜çš„æœ€æœ‰è§£ï¼Œç¡®å®šçŠ¶æ€è½¬ç§»å…¬å¼ï¼š<br>f[i][j]  &#x3D; max(f[i - 1][j],  f[i - 1][j - v[i]] + w[i])</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.acwing.com/solution/content/1374/">AcWing 2. 01èƒŒåŒ…é—®é¢˜ï¼ˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹è®²è§£ï¼‰ </a></p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>åŠ¨æ€è§„åˆ’</tag>
        <tag>é›¶ä¸€èƒŒåŒ…é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„ç³»ç»Ÿå¯¼å…¥å¯¼å‡º</title>
    <url>/2019/03/31/design-pattern/shi-yong-ce-lue-mo-shi-chong-gou-xi-tong-dao-ru-dao-chu/</url>
    <content><![CDATA[<p>â€‹     åˆç†çš„ä½¿ç”¨è®¾è®¡æ¨¡å¼èƒ½æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œä½†æ˜¯å¾€å¾€ä¸€å¼€å§‹è®¾è®¡å¼€å‘çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°ä¸šåŠ¡çš„æ‰©å±•æ€§ï¼Œåœ¨åæœŸä¸šåŠ¡æ‰©å±•çš„æ—¶å€™ï¼Œéœ€è¦åœ¨åŸæœ‰ä»£ç é€»è¾‘ä¸Šå¢åŠ æ–°åŠŸèƒ½ï¼Œè¿™å¯¹å¼€å‘äººå‘˜æ¥è¯´æ— ç–‘æ˜¯éå¸¸ç—›è‹¦çš„ã€‚åˆšå¥½æ¥åˆ°äº†åœ¨æ–°çš„ä¸šåŠ¡ç³»ç»Ÿå¢åŠ å¯¼å…¥å¯¼å‡ºåŠŸèƒ½å¼€å‘ä»»åŠ¡ï¼Œåœ¨äº†è§£åˆ°ç³»ç»ŸåŸæœ‰å¯¼å…¥å¯¼å‡ºå¤æ‚çš„é€»è¾‘åï¼Œå†³å®šåˆ©ç”¨ç­–ç•¥æ¨¡å¼æ¥é‡æ„è¿™ä¸€åŠŸèƒ½ï¼Œé™ä½å¼€å‘çš„å¤æ‚åº¦ã€‚</p>
<h1 id="ç³»ç»ŸåŸæœ‰å¯¼å…¥å¯¼å‡º"><a href="#ç³»ç»ŸåŸæœ‰å¯¼å…¥å¯¼å‡º" class="headerlink" title="ç³»ç»ŸåŸæœ‰å¯¼å…¥å¯¼å‡º"></a>ç³»ç»ŸåŸæœ‰å¯¼å…¥å¯¼å‡º</h1><p>â€‹       ç³»ç»ŸåŸæœ‰ä½¿ç”¨å¼‚æ­¥å¯¼å…¥å¯¼å‡ºæ–¹å¼ï¼Œå¯¼å…¥å¯¼å‡ºä»»åŠ¡æäº¤åï¼Œå…ˆå°†ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­å»ï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ä¸æ–­ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–å¾…æ‰§è¡Œçš„ä»»åŠ¡äº¤ç”±ä»»åŠ¡çº¿ç¨‹æ± å»æ‰§è¡Œã€‚</p>
<blockquote>
<p>ç²¾ç®€åçš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
</blockquote>
<p><strong>FileTaskExecutor.java</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä»»åŠ¡åˆ†å‘å™¨çº¿ç¨‹å†…éƒ¨ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Boss</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">FileTask</span> task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
				task <span class="token operator">=</span> taskQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯¼å…¥å¯¼å‡ºä»»åŠ¡å°è£…ä¸ºWorkeräº¤ç”±çº¿ç¨‹æ± æ‰§è¡Œ</span>
				executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">continue</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Get next file task failed,cause by:&#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// ä»»åŠ¡æ‰§è¡Œå™¨çº¿ç¨‹å†…éƒ¨ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token class-name">FileTask</span> task<span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>task <span class="token operator">=</span> task<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
    
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">FileType</span> fileType <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getFileType</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">FileHandler</span> fileHandler <span class="token operator">=</span> <span class="token class-name">FileHandlerFactory</span><span class="token punctuation">.</span><span class="token function">getFileHandler</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">case</span> <span class="token class-name">Import</span><span class="token operator">:</span>
                <span class="token comment">// å¤„ç†å¯¼å…¥</span>
				<span class="token function">handleImport</span><span class="token punctuation">(</span>fileType<span class="token punctuation">,</span> task<span class="token punctuation">,</span> fileHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">commitFileTask</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token class-name">TaskResult<span class="token punctuation">.</span>Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span> <span class="token class-name">Export</span><span class="token operator">:</span>
                <span class="token comment">// å¤„ç†å¯¼å‡º</span>
				<span class="token function">handleExport</span><span class="token punctuation">(</span>fileType<span class="token punctuation">,</span> task<span class="token punctuation">,</span> fileHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">commitFileTask</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token class-name">TaskResult<span class="token punctuation">.</span>Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// TODO å¼‚å¸¸æƒ…å†µä¸‹æ–‡ä»¶ä»»åŠ¡çŠ¶æ€å¤„ç†</span>
			<span class="token function">commitFileTask</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token class-name">TaskResult<span class="token punctuation">.</span>Failed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Execute file task failed,cause by:&#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>	<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å¯¼å…¥å…³é”®æ­¥éª¤"><a href="#å¯¼å…¥å…³é”®æ­¥éª¤" class="headerlink" title="å¯¼å…¥å…³é”®æ­¥éª¤"></a>å¯¼å…¥å…³é”®æ­¥éª¤</h3><p>æ ¹æ®å¯¼å…¥çš„é€»è¾‘ï¼Œå¯¼å…¥ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>1ã€è¯»å–å¯¼å…¥æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶è¡Œå†…å®¹</li>
<li>2ã€å°†æ–‡ä»¶è¡Œå†…å®¹è½¬æ¢ä¸ºå®ä½“ç±»å¯¹è±¡</li>
<li>3ã€å°†å®ä½“ç±»å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“</li>
<li>4ã€å¯¼å…¥å¤±è´¥çš„å¯¹è±¡é‡æ–°å†™å…¥æ–‡ä»¶å¹¶æ³¨æ˜å¤±è´¥åŸå› </li>
</ul>
<h3 id="å¯¼å…¥ä»£ç å®ç°"><a href="#å¯¼å…¥ä»£ç å®ç°" class="headerlink" title="å¯¼å…¥ä»£ç å®ç°"></a>å¯¼å…¥ä»£ç å®ç°</h3><p><strong>FileImporter.java</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchImport</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">,</span> <span class="token class-name">FileHandler</span> fileHandler<span class="token punctuation">,</span> <span class="token class-name">ExportInfo</span> resultInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ImportInfo</span> importInfo <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    task<span class="token punctuation">.</span><span class="token function">addHandledCount</span><span class="token punctuation">(</span>rowList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> headCells <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getDataType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token class-name">Blacklist</span><span class="token operator">:</span>
            headCells <span class="token operator">=</span> <span class="token class-name">FileHead</span><span class="token punctuation">.</span><span class="token function">getImportFailedHead</span><span class="token punctuation">(</span><span class="token class-name">FileHeader</span><span class="token punctuation">.</span><span class="token constant">BLACKLIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            importInfo <span class="token operator">=</span> <span class="token function">importBlacklist</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> rowList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Whitelist</span><span class="token operator">:</span>
            headCells <span class="token operator">=</span> <span class="token class-name">FileHead</span><span class="token punctuation">.</span><span class="token function">getImportFailedHead</span><span class="token punctuation">(</span><span class="token class-name">FileHeader</span><span class="token punctuation">.</span><span class="token constant">WHITELIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            importInfo <span class="token operator">=</span> <span class="token function">importWhitelist</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> rowList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Keyword</span><span class="token operator">:</span>
            headCells <span class="token operator">=</span> <span class="token class-name">FileHead</span><span class="token punctuation">.</span><span class="token function">getImportFailedHead</span><span class="token punctuation">(</span><span class="token class-name">FileHeader</span><span class="token punctuation">.</span><span class="token constant">KEYWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            importInfo <span class="token operator">=</span> <span class="token function">importKeyword</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> rowList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FileImportException</span><span class="token punctuation">(</span><span class="token string">"Invalid data type: "</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">getDataType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// å¯¼å…¥å¤±è´¥çš„è®°å½•å†™å…¥æ–‡ä»¶ï¼Œå¹¶æ³¨æ˜å¤±è´¥åŸå› </span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> cellsList <span class="token operator">=</span> importInfo<span class="token punctuation">.</span><span class="token function">getFailedList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">writeResultInfoFile</span><span class="token punctuation">(</span>headCells<span class="token punctuation">,</span> cellsList<span class="token punctuation">,</span> task<span class="token punctuation">,</span> resultInfo<span class="token punctuation">,</span> fileHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * å¯¼å…¥é»‘åå•
 * @param task
 * @param rowList
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token class-name">ImportInfo</span> <span class="token function">importBlacklist</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">ImportInfo</span> impInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImportInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// æ–‡ä»¶è¡Œå†…å®¹è½¬æ¢ä¸ºå®ä½“ç±»å¯¹è±¡</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Blacklist</span><span class="token punctuation">></span></span> blacklists <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">parseBlacklist</span><span class="token punctuation">(</span>rowList<span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getParamsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ListUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>blacklists<span class="token punctuation">)</span><span class="token punctuation">)</span>
            impInfo <span class="token operator">=</span> importDataService<span class="token punctuation">.</span><span class="token function">importBlacklist</span><span class="token punctuation">(</span>blacklists<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Import blacklist failed,cause by:&#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        impInfo<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">Result<span class="token punctuation">.</span>Failed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> impInfo<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ImportService.java</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ImportInfo</span> <span class="token function">importBlacklist</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Blacklist</span><span class="token punctuation">></span></span> blacklists<span class="token punctuation">,</span> <span class="token class-name">FileTask</span> task<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">ImportInfo</span> importInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImportInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ImportInfoBuild</span> importInfoBuild <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getImportInfoBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// TODO æ ¡éªŒé»‘åå•å±æ€§å€¼æ˜¯å¦åˆæ³•</span>
		blacklistRepo<span class="token punctuation">.</span><span class="token function">addCachePhoneList</span><span class="token punctuation">(</span>blacklist<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// æ›´æ–°æ–‡ä»¶ä»»åŠ¡</span>
		task<span class="token punctuation">.</span><span class="token function">setHandledCount</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		task<span class="token punctuation">.</span><span class="token function">setHanldePercent</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getCurPercent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		fileTaskRepo<span class="token punctuation">.</span><span class="token function">updateHandlingTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// è¿”å›å¯¼å…¥è¯¦æƒ…</span>
		importInfo<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">Result<span class="token punctuation">.</span>Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		importInfo<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">Result<span class="token punctuation">.</span>Failed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span> e<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> importInfo<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>â€‹    ä¸Šé¢ä»£ç æ˜¯å¯¼å…¥é€»è¾‘çš„å…³é”®ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ–°å¢ä¸€ç§å¯¼å…¥ç±»å‹ï¼Œå°±å¿…é¡»æ‰©å±•<strong>FileImporter</strong>ç±»çš„switchåˆ†æ”¯ï¼Œå¢åŠ å¯¹åº”çš„å¯¼å…¥ç±»å‹å’Œæ–¹æ³•ï¼Œå¹¶è°ƒç”¨<strong>ImportService</strong>ç±»ä¸­æ–°å¢çš„å¯¼å…¥æ–¹æ³•ã€‚è¿™æ ·åšçš„ç¼ºç‚¹å°±æ˜¯éšç€ç³»ç»Ÿå¯¼å…¥ç±»å‹å¢å¤šï¼ŒFileImporterç±»ä¸­çš„åˆ†æ”¯è¶Šæ¥è¶Šå¤šï¼ŒImportServiceç±»ä¸­ä»£ç é‡æ€¥å‰§è†¨èƒ€ï¼Œç»™åæœŸå¼€å‘å’Œç»´æŠ¤å¸¦æ¥æ— å°½éº»çƒ¦ã€‚</p>
<p>â€‹    åŒæ—¶ä»è®¾è®¡åŸåˆ™å±‚é¢æ¥è¯´ï¼Œè¿™æ ·è®¾è®¡å®ç°è¿èƒŒäº†<strong>å•ä¸€èŒè´£</strong>ã€<strong>å¼€é—­åŸåˆ™</strong>ï¼Œæ‰€æœ‰çš„å¯¼å…¥æ–¹æ³•éƒ½å†™å…¥ä¸€ä¸ªç±»ä¸­ï¼ŒåæœŸæ‰©å±•éœ€è¦åœ¨åŸæœ‰ç±»çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>
<h1 id="ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¯¼å…¥"><a href="#ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¯¼å…¥" class="headerlink" title="ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¯¼å…¥"></a>ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„å¯¼å…¥</h1><p>æ–‡ä»¶å¯¼å…¥ç±»ä¸­ä½¿ç”¨ç­–ç•¥å·¥å‚è·å–å¯¹åº”çš„å¯¼å…¥ç­–ç•¥ç±»ï¼Œåœ¨ç­–ç•¥ç±»ä¸­å°†å…¬å…±æ–¹æ³•æŠ½è±¡ä¸ºæ¥å£ï¼Œè¿™æ ·åœ¨æ–°å¢ä¸€ç§å¯¼å…¥ç±»å‹æ—¶ï¼Œåªéœ€æ–°å¢ç­–ç•¥ç±»å¹¶å®ç°æŠ½è±¡æ–¹æ³•å³å¯ã€‚</p>
<p>   <strong>FileImporter.java</strong>ï¼ˆæ–‡ä»¶å¯¼å…¥ç±»ï¼‰</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchImport</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">,</span> <span class="token class-name">FileHandler</span> fileHandler<span class="token punctuation">,</span> <span class="token class-name">ExportInfo</span> resultInfo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ ¹æ®å¯¼å…¥ç±»å‹ä½¿ç”¨ç­–ç•¥å·¥å‚è·å–å¯¹åº”çš„å¯¼å…¥ç­–ç•¥</span>
    <span class="token class-name">ImportFileStrategy</span> importFileStrategy <span class="token operator">=</span> importFileStrategyFactory<span class="token punctuation">.</span><span class="token function">fetchStrategy</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getDataType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ImportInfo</span> impInfo <span class="token operator">=</span>  importFileStrategy<span class="token punctuation">.</span><span class="token function">importFile</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> rowList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// å¯¼å…¥å¤±è´¥çš„è®°å½•å†™å…¥æ–‡ä»¶ï¼Œå¹¶æ³¨æ˜å¤±è´¥åŸå› </span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> cellsList <span class="token operator">=</span> importFileStrategy<span class="token punctuation">.</span><span class="token function">dataConvert</span><span class="token punctuation">(</span>impInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">writeResultInfoFile</span><span class="token punctuation">(</span>headCells<span class="token punctuation">,</span> cellsList<span class="token punctuation">,</span> task<span class="token punctuation">,</span> resultInfo<span class="token punctuation">,</span> fileHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>DefaultImportFileStrategyFactory.java</strong>(å¯¼å…¥ç­–ç•¥å·¥å‚ç±»)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultImportFileStrategyFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ImportFileStrategyFactory</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">STRATEGY_SUFFIX</span> <span class="token operator">=</span> <span class="token string">"ImportFileStrategy"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">DefaultImportFileStrategyFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">=</span> applicationContext<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ImportFileStrategy</span> <span class="token function">fetchStrategy</span><span class="token punctuation">(</span><span class="token class-name">String</span> typeName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ImportFileStrategyFactoryException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ImportFileStrategy</span> importFileStrategy <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>typeName <span class="token operator">+</span> <span class="token constant">STRATEGY_SUFFIX</span><span class="token punctuation">,</span> <span class="token class-name">ImportFileStrategy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>importFileStrategy <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Fetch ImportFileStrategy failed,Unknown strategy type:&#123;&#125;"</span><span class="token punctuation">,</span>typeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ImportFileStrategyFactoryException</span><span class="token punctuation">(</span><span class="token class-name">MessageFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Fetch ImportFileStrategy failed,Unknown strategy type:&#123;0&#125;"</span><span class="token punctuation">,</span>typeName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> importFileStrategy<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ImportFileStrategy.java**(å¯¼å…¥ç­–ç•¥æ¥å£)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ImportFileStrategy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token class-name">ImportInfo</span> <span class="token function">importFile</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getImportFileHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token function">dataConvert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>AbstractImportFileStrategy.java</strong>(å¯¼å…¥ç­–ç•¥æŠ½è±¡ç±»)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractImportFileStrategy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">ImportFileStrategy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ImportInfo</span> <span class="token function">importFile</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> params <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">getParamsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> elements <span class="token operator">=</span> <span class="token function">rowList2Objects</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> rowList<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">importList</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">rowList2Objects</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">ImportInfo</span> <span class="token function">importList</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> elements<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>BlacklistImportFileStrategy.java</strong>(é»‘åå•å¯¼å…¥ç­–ç•¥ç±»)</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlacklistImportFileStrategy</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractImportFileStrategy</span><span class="token operator">&lt;</span><span class="token class-name">Blacklist</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Blacklist</span><span class="token punctuation">></span></span> <span class="token function">rowList2Objects</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> rowList<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> params<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// TODO æ–‡ä»¶è¡Œå†…å®¹è½¬æ¢ä¸ºå®ä½“ç±»å¯¹è±¡</span>
        <span class="token keyword">return</span> blacklist<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">ImportInfo</span> <span class="token function">importList</span><span class="token punctuation">(</span><span class="token class-name">FileTask</span> task<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Blacklist</span><span class="token punctuation">></span></span> elements<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// TODO å°†å¯¹è±¡åˆ—è¡¨å­˜å‚¨åˆ°æ•°æ®åº“</span>
        <span class="token keyword">return</span> importInfo<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getImportFileHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è·å–æ–‡ä»¶å¤´ä¿¡æ¯</span>
        <span class="token keyword">return</span> header<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token function">dataConvert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Blacklist</span><span class="token punctuation">></span></span> elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å°†ç±»å¯¹è±¡è½¬æ¢ä¸ºæ–‡ä»¶è¡Œå†…å®¹</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä»ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“æˆ‘ä»¬éœ€è¦æ–°å¢ä¸€ä¸ªå¯¼å‡ºç±»å‹æ—¶ï¼Œåªéœ€æ–°å¢ä¸€ä¸ªå¯¼å‡ºç­–ç•¥ç±»å¹¶ç»§æ‰¿<strong>AbstractImportFileStrategy</strong>æŠ½è±¡ç±»ï¼Œå®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•å³å¯ã€‚</p>
<p>ç³»ç»Ÿå¯¼å‡ºçš„é—®é¢˜ä¸å¯¼å…¥ç±»ä¼¼ï¼Œé‡æ„çš„æ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>ç­–ç•¥æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šä¸€åˆ†é’Ÿç»ç†äººã€‹</title>
    <url>/2022/03/23/book/yi-fen-zhong-jing-li-ren/</url>
    <content><![CDATA[<h1 id="ä¸€ã€ç»å…¸çš„â€œè‡ªä¸Šè€Œä¸‹â€ä¸¥å¯†çš„ç®¡ç†æ–¹å¼å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#ä¸€ã€ç»å…¸çš„â€œè‡ªä¸Šè€Œä¸‹â€ä¸¥å¯†çš„ç®¡ç†æ–¹å¼å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="ä¸€ã€ç»å…¸çš„â€œè‡ªä¸Šè€Œä¸‹â€ä¸¥å¯†çš„ç®¡ç†æ–¹å¼å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>ä¸€ã€ç»å…¸çš„â€œè‡ªä¸Šè€Œä¸‹â€ä¸¥å¯†çš„ç®¡ç†æ–¹å¼å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h1><p>ç»å…¸çš„â€œè‡ªä¸Šè€Œä¸‹â€çš„ä¸¥å¯†çš„ç®¡ç†æ–¹å¼ï¼Œèƒ½å¤Ÿä¸¥æ ¼è§„èŒƒå‘˜å·¥çš„è¡Œä¸ºæ–¹å¼ã€‚ä½†æ˜¯æ”¾åœ¨ä»Šå¤©ï¼Œè¿™ç§æ–¹å¼ä¸èƒ½æ¿€å‘å‘˜å·¥æ½œåŠ›è¿˜æ‰¼æ€åˆ›é€ åŠ›ã€‚</p>
<h1 id="äºŒã€ä¸€åˆ†é’Ÿç®¡ç†æ³•"><a href="#äºŒã€ä¸€åˆ†é’Ÿç®¡ç†æ³•" class="headerlink" title="äºŒã€ä¸€åˆ†é’Ÿç®¡ç†æ³•"></a>äºŒã€ä¸€åˆ†é’Ÿç®¡ç†æ³•</h1><h2 id="2-1-ä¸€åˆ†é’Ÿç›®æ ‡"><a href="#2-1-ä¸€åˆ†é’Ÿç›®æ ‡" class="headerlink" title="2.1 ä¸€åˆ†é’Ÿç›®æ ‡"></a>2.1 ä¸€åˆ†é’Ÿç›®æ ‡</h2><p>è®¾å®šä¸€åˆ†é’Ÿç›®æ ‡ï¼š</p>
<ol>
<li>å…±åŒåˆ¶å®šå·¥ä½œç›®æ ‡ï¼Œ å¹¶æ¸…æ¥šç®€æ´åœ°æè¿°å‡ºæ¥ï¼Œ æ˜ç¡®å¥½çš„å·¥ä½œè¡¨ç°çš„æ ‡<br>å‡†ã€‚</li>
<li>æ¯ä¸ªç›®æ ‡éƒ½å•ç‹¬å†™åœ¨ä¸€å¼ çº¸ä¸Šï¼Œ å¹¶å†™ä¸‹å®ŒæˆæœŸé™ã€‚</li>
<li>è§„å®šæ¯å¤©ç”¨å‡ åˆ†é’Ÿæ—¶é—´ï¼Œ é‡æ¸©è‡ªå·±æœ€é‡è¦çš„ç›®æ ‡ã€‚</li>
<li>é¼“åŠ±äººä»¬ç”¨ä¸€åˆ†é’Ÿæ—¶é—´å®¡è§†è‡ªå·±çš„è¡¨ç°ï¼Œ æ£€æŸ¥æ˜¯å¦ä¸ç›®æ ‡ä¸€è‡´ã€‚</li>
<li>è‹¥ä¸ç›®æ ‡ä¸ä¸€è‡´ï¼Œ åæ€è‡ªå·±çš„å·¥ä½œè¡¨ç°ï¼Œ ä»¥ä¾¿è°ƒæ•´ã€‚</li>
</ol>
<h2 id="2-2-ä¸€åˆ†é’Ÿç§°èµ"><a href="#2-2-ä¸€åˆ†é’Ÿç§°èµ" class="headerlink" title="2.2 ä¸€åˆ†é’Ÿç§°èµ"></a>2.2 ä¸€åˆ†é’Ÿç§°èµ</h2><p>è¿›è¡Œä¸€åˆ†é’Ÿç§°èµï¼š</p>
<h3 id="â—†-å‰åŠåˆ†é’Ÿ"><a href="#â—†-å‰åŠåˆ†é’Ÿ" class="headerlink" title="â—† å‰åŠåˆ†é’Ÿ"></a>â—† å‰åŠåˆ†é’Ÿ</h3><ol>
<li>åŠæ—¶ç§°èµä¸‹å±ã€‚</li>
<li>å‘Šè¯‰ä»–ä»¬å¯¹åœ¨å“ªé‡Œâ€”è¦è¯´å¾—éå¸¸å…·ä½“ã€‚</li>
<li>å‘Šè¯‰ä»–ä»¬è¿™ä»¶äº‹æƒ…åšå¯¹ä¹‹åï¼Œ ä¼šè®©ä½ æ„Ÿåˆ°å¤šä¹ˆé«˜å…´ï¼Œ å¯¹æ•´ä¸ªå›¢é˜Ÿå’Œå…¶ä»–åŒäº‹åˆä¼šæœ‰å¤šä¹ˆå¤§çš„å¸®åŠ©ã€‚</li>
</ol>
<h3 id="â—†-åœé¡¿ä¸€ä¼šå„¿"><a href="#â—†-åœé¡¿ä¸€ä¼šå„¿" class="headerlink" title="â—† åœé¡¿ä¸€ä¼šå„¿"></a>â—† åœé¡¿ä¸€ä¼šå„¿</h3><ol start="4">
<li>æ²‰é»˜å‡ ç§’ï¼Œ è®©ä»–ä»¬é™é™åœ°ä½“ä¼šåšå¯¹äº‹å¸¦æ¥çš„å–œæ‚¦ã€‚</li>
</ol>
<h3 id="â—†-ååŠåˆ†é’Ÿ"><a href="#â—†-ååŠåˆ†é’Ÿ" class="headerlink" title="â—† ååŠåˆ†é’Ÿ"></a>â—† ååŠåˆ†é’Ÿ</h3><ol start="5">
<li>é¼“åŠ±ä»–ä»¬ä»¥åç»§ç»­è¿™æ ·åšã€‚</li>
<li>æ˜ç¡®è¯´æ˜ä½ å¯¹ä»–ä»¬æœ‰ä¿¡å¿ƒï¼Œ å¹¶ä¼šæ”¯æŒä»–ä»¬è·å¾—æˆåŠŸã€‚</li>
</ol>
<h2 id="2-3-ä¸€åˆ†é’Ÿæ›´æ­£"><a href="#2-3-ä¸€åˆ†é’Ÿæ›´æ­£" class="headerlink" title="2.3 ä¸€åˆ†é’Ÿæ›´æ­£"></a>2.3 ä¸€åˆ†é’Ÿæ›´æ­£</h2><p>å¦‚æœç›®æ ‡é˜è¿°æ¸…æ™°ï¼Œ è¿›è¡Œä¸€åˆ†é’Ÿæ›´æ­£ï¼š</p>
<h3 id="â—†-å‰åŠåˆ†é’Ÿ-1"><a href="#â—†-å‰åŠåˆ†é’Ÿ-1" class="headerlink" title="â—† å‰åŠåˆ†é’Ÿ"></a>â—† å‰åŠåˆ†é’Ÿ</h3><ol>
<li>é”™è¯¯å‘ç”Ÿåç«‹åˆ»è¿›è¡Œæ›´æ­£ã€‚</li>
<li>ç¡®è®¤æ—¢æœ‰çš„äº‹å®ï¼Œ åˆ†æé”™åœ¨å“ªé‡Œï¼Œè¦è¯´å¾—éå¸¸å…·ä½“ã€‚</li>
<li>å‘Šè¯‰ä»–ä»¬è¿™ä»¶äº‹å¸¦ç»™ä½ çš„æ„Ÿå—ï¼Œ ä»¥åŠå¯¹å·¥ä½œæˆæœå¯èƒ½é€ æˆçš„å½±å“ã€‚</li>
</ol>
<h3 id="â—†-åœé¡¿ä¸€ä¼šå„¿-1"><a href="#â—†-åœé¡¿ä¸€ä¼šå„¿-1" class="headerlink" title="â—† åœé¡¿ä¸€ä¼šå„¿"></a>â—† åœé¡¿ä¸€ä¼šå„¿</h3><ol start="4">
<li>æ²‰é»˜å‡ ç§’ï¼Œ è®©ä»–ä»¬å®¡è§†æ‰€çŠ¯çš„é”™è¯¯ã€‚</li>
</ol>
<h3 id="â—†-ååŠåˆ†é’Ÿ-1"><a href="#â—†-ååŠåˆ†é’Ÿ-1" class="headerlink" title="â—† ååŠåˆ†é’Ÿ"></a>â—† ååŠåˆ†é’Ÿ</h3><ol start="5">
<li>å‘Šè¯‰å¯¹æ–¹ï¼Œ ä»–ä»¬çš„å®é™…èƒ½åŠ›æ¯”è¿™æ¬¡è¡¨ç°å‡ºæ¥çš„æ›´å¼ºï¼Œ ä½ è®¤ä¸ºä»–ä»¬å¾ˆä¸é”™ã€‚</li>
<li>å‘Šè¯‰å¯¹æ–¹ï¼Œ ä½ å¯¹ä»–ä»¬æœ‰ä¿¡å¿ƒï¼Œ ä»ç„¶ä¿¡ä»»ä»–ä»¬ã€‚</li>
<li>æ›´æ­£è¿‡åï¼Œ æ•´ä»¶äº‹å°±è¿‡å»äº†ã€‚</li>
</ol>
<h1 id="ä¸‰ã€ä¸€åˆ†é’Ÿç®¡ç†æ³•ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"><a href="#ä¸‰ã€ä¸€åˆ†é’Ÿç®¡ç†æ³•ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ" class="headerlink" title="ä¸‰ã€ä¸€åˆ†é’Ÿç®¡ç†æ³•ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"></a>ä¸‰ã€ä¸€åˆ†é’Ÿç®¡ç†æ³•ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</h1><p>åœ¨äº†è§£åˆ°ä¸€åˆ†é’Ÿç®¡ç†æ³•åï¼Œæˆ‘ä»¬åº”è¯¥æ€è€ƒï¼Œä¸ºä»€ä¹ˆä¸€åˆ†é’Ÿç®¡ç†æ³•æœ‰æ•ˆï¼Ÿ</p>
<h2 id="3-1-ä¸€åˆ†é’Ÿç›®æ ‡ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"><a href="#3-1-ä¸€åˆ†é’Ÿç›®æ ‡ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ" class="headerlink" title="3.1 ä¸€åˆ†é’Ÿç›®æ ‡ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"></a>3.1 ä¸€åˆ†é’Ÿç›®æ ‡ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</h2><p>å¯¹æ¯ä¸ªäººæ¥è¯´ï¼Œ ä¸è®ºæˆåŠŸè€…è¿˜æ˜¯æœ‰æˆåŠŸæ½œåŠ›çš„äººï¼Œ è®¾å®šä¸€åˆ†é’Ÿç›®æ ‡éƒ½æ˜¯æé«˜å·¥ä½œæ•ˆç‡çš„ä¸€æ¡æœ€åŸºæœ¬çš„é€”å¾„ã€‚</p>
<h2 id="3-2-ä¸€åˆ†é’Ÿç§°èµä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"><a href="#3-2-ä¸€åˆ†é’Ÿç§°èµä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ" class="headerlink" title="3.2 ä¸€åˆ†é’Ÿç§°èµä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"></a>3.2 ä¸€åˆ†é’Ÿç§°èµä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</h2><p>è®­ç»ƒæˆåŠŸè€…æœ€é‡è¦çš„æ˜¯å‘ç°ä»–ä»¬åšå¯¹äº†çš„äº‹æƒ…â€”â€”å¼€å§‹ä¹Ÿè®¸åªæ˜¯å¤§æ¦‚åšå¯¹ï¼Œ æ¥ç€è¦é€æ¸å¼•å¯¼ä»–ä»¬åšå¾—è¶Šæ¥è¶Šå®Œç¾ã€‚é€šè¿‡ä¸€åˆ†é’Ÿç§°èµå¯ä»¥å¸®åŠ©äººä»¬å»ºç«‹è‡ªä¿¡ï¼Œä»è€Œè¾¾åˆ°éå¸¸å¥½çš„çŠ¶æ€ã€‚</p>
<h2 id="3-3-ä¸€åˆ†é’Ÿæ›´æ­£ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"><a href="#3-3-ä¸€åˆ†é’Ÿæ›´æ­£ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ" class="headerlink" title="3.3 ä¸€åˆ†é’Ÿæ›´æ­£ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ"></a>3.3 ä¸€åˆ†é’Ÿæ›´æ­£ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</h2><p>åé¦ˆåº”è¯¥æ˜¯å³æ—¶çš„ã€‚ ä¸€æ—¦ä½ å‘ç°ä¸‹å±åšé”™äº†äº‹ï¼Œ å°±è¦ç«‹åˆ»æŒ‡å‡ºæ¥ã€‚å¦‚æœæŠŠåé¦ˆé›†ä¸­èµ·æ¥ï¼Œäº‹æƒ…å¤ªå¤šä¹Ÿä¸åˆ©äºå‘˜å·¥ä¿®æ­£é”™è¯¯ï¼Œè€Œä¸”æœ‰ç‚¹ç¿»æ—§è´¦çš„å«Œç–‘ï¼Œæœ€åäº§ç”Ÿäº‰è®ºï¼Œæœ€åè¢«æ‰¹è¯„çš„ä¸€æ–¹å½¢æˆå¿ƒç†æˆ’å¤‡ï¼Œé‚£ä¹ˆæœ€åçš„åé¦ˆæ˜¯æ— æ•ˆçš„ã€‚</p>
<p>å¦‚æœç»ç†äººåŠæ—¶æå‡ºæ„è§ï¼Œè¢«æ›´æ­£çš„ä¸€æ–¹å¯ä»¥æ¥å—åé¦ˆä¿¡æ¯ã€‚ æ¯æ¬¡åªæ›´æ­£ä¸€ä¸ªè¡Œä¸ºï¼Œ ä¼šè®©äººè§‰å¾—æ—¢å…¬å¹³åˆæ˜ç¡®ã€‚å¯¹äºä¸€åˆ†é’Ÿæ›´æ–°æ›´é‡è¦çš„æ˜¯ååŠåˆ†é’Ÿï¼Œæˆ‘ä»¬ç»™å‘˜å·¥åé¦ˆé—®é¢˜æ˜¯å¸Œæœ›ä»–ä»¬ä¿®æ­£é—®é¢˜è·å¾—æˆé•¿ï¼Œè€Œä¸æ˜¯è´¬ä½ä»–ä»¬çš„ä»·å€¼ï¼Œæ‰€ä»¥æ›´æ­£çš„åŒæ—¶ï¼Œä¹Ÿè¦ç»™äºˆè‚¯å®šå’Œå°Šé‡ã€‚</p>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>ä¸€åˆ†é’Ÿç®¡ç†æ³•å’Œä¹‹å‰åœ¨ã€Šåˆ»æ„ç»ƒä¹ ã€‹ä¸€ä¹¦ä¸­æœ‰çœ‹åˆ°çš„3Fï¼ˆFocusï¼Œfeedbackï¼Œfix itï¼‰æ€æƒ³æä¸ºç›¸è¿‘ï¼Œå…¶ä¸­focuså¯¹åº”ç€ä¸€åˆ†é’Ÿç›®æ ‡ï¼Œè€Œfeedbackå’Œfix itåŸåˆ™æ­£æ˜¯ä¸€åˆ†é’Ÿæ›´æ­£çš„ä½“ç°ã€‚ä¸€åˆ†é’Ÿç›®æ ‡ï¼Œå¯ä»¥è®©æˆ‘ä»¬èƒ½å¤Ÿæ˜ç¡®è‡ªå·±çš„å·¥ä½œç›®æ ‡ï¼Œä»è€Œä¸“æ³¨å·¥ä½œï¼›ä¸€åˆ†é’Ÿæ›´æ­£ç»™äºˆæˆ‘ä»¬æˆ‘ä»¬ç»“æœçš„åé¦ˆï¼Œå¹¶ä¿®æ­£å…¶ä¸­çš„é”™è¯¯ï¼Œä»è€Œä¸æ–­æˆé•¿å’Œè¿›æ­¥ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>ä¸€åˆ†é’Ÿç»ç†äºº</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šäººé—´å¤±æ ¼ã€‹</title>
    <url>/2021/05/30/book/ren-jian-shi-ge/</url>
    <content><![CDATA[<p><img src="/images/%E4%BA%BA%E9%97%B4%E5%A4%B1%E6%A0%BC.jpg" alt="äººé—´å¤±æ ¼"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><em><strong>ã€Šäººé—´å¤±æ ¼ã€‹ â€”â€” â€œæ— èµ–æ´¾â€æ–‡å­¦å¤§å¸ˆå¤ªå®°æ²»é¥±å—äº‰è®®çš„ç ´ç­ä¹‹ä¹¦</strong></em></p>
<blockquote>
<p>[æ—¥]å¤ªå®°æ²» â€”â€” è‘—<br>æ¨ä¼Ÿ â€”â€” è¯‘</p>
</blockquote>
<p>ä¹‹å‰å¹¶ä¸äº†è§£å¤ªå®°æ²»ï¼Œæ˜¯è¢«ä¹¦åå¸å¼•çš„æ‰å¼€å§‹è¯»çš„ã€‚åœ¨äº†è§£åˆ°ä½œè€…çš„è¿‡å¾€ç»å†åï¼Œå¯¹è¿™æœ¬çš„ä¹¦çš„å…´è¶£æ„ˆå‘æµ“åšã€‚</p>
<p>å¤ªå®°æ²»çš„ä¸€ç”Ÿå……æ»¡çš„ä¼ å¥‡è‰²å½©ï¼Œä»–å‡ºèº«è±ªé—¨ï¼Œä¸€ç”Ÿç«‹å¿—æ–‡å­¦ï¼Œå¸ˆä»äº•ä¼é³ŸäºŒç­‰å°è¯´åå®¶ï¼›å¤§å­¦æ—¶ä»£æ›¾ç§¯ææŠ•èº«å·¦ç¿¼è¿åŠ¨ï¼Œå´ä¸­é€”é€ƒè„±ï¼›ç”Ÿæ´»æ”¾è¡ä¸ç¾ï¼Œå´çƒ­å¿ƒäºé˜…è¯»ã€Šåœ£ç»ã€‹ï¼›äº”åº¦è‡ªæ€ï¼Œå››åº¦æ®‰æƒ…æœªé‚ï¼Œä¸‰åä¹å²æ—¶ä¸æœ€åä¸€ä½æƒ…äººæŠ•æ°´è‡ªå°½ã€‚ä»¥è‡³äºä»–è¯´â€å›æ”¶å¾€æ˜”ï¼Œæˆ‘çš„äººç”Ÿå……æ–¥ç€è€»è¾±â€ï¼ˆã€Šäººé—´å¤±æ ¼ã€‹ï¼‰ï¼Œâ€ç”Ÿè€Œä¸ºäººï¼Œå¯¹ä¸èµ·â€ï¼ˆã€ŠäºŒåä¸–çºªæ——æ‰‹ã€‹ï¼‰ï¼Œâ€ä¸Šå¸é€‰æ°‘çš„ä¸å®‰ä¸ææƒšä¿±å­˜äºå¾èº«â€ï¼ˆã€Šå¶ã€‹ï¼‰ã€‚è¿™äº›æ ¼è¨€å¼çš„çŸ­è¯­ä¸ƒå·æˆäº†å¤ªå®°æ²»äººç”Ÿå’Œæ–‡å­¦çš„æœ€å¥½æ³¨è„šï¼Œä¹Ÿä»æŸä¸ªè§’åº¦å‹¾å‹’é™¤äº†ä»–ä¸€ç”Ÿçš„å¿ƒç†è½¨è¿¹ã€‚</p>
<p>ã€Šäººé—´å¤±æ ¼ã€‹ä¸€ä¹¦ä¸­çš„ä¸»äººå…¬å¤§åº­å¶è—é€šè¿‡ã€Œæ‰®ä¸‘ã€é€—ç¬‘å‘¨å›´äººçš„æ¥è¿›è¡Œã€Œè‡ªæˆ‘æ•‘èµã€ã€‚ä½†æ˜¯æœ€ç»ˆæ‰¿å—ä¸ä½è¿™æ ·çš„å‹æŠ‘å’Œæ— å¥ˆï¼Œåœ¨åŒå­¦å €æœ¨çš„å½±å“ä¸‹ä¸€æ­¥ä¸€æ­¥èµ°å‘å •è½ï¼Œåˆ©ç”¨é…’ç²¾å’Œæ¯’å“éº»é†‰ç¥ç»ï¼Œç”¨å¥³æ€§çš„è‚‰ä½“å®‰æŠšè‡ªèº«çš„è‚‰ä½“ï¼Œä¾é å¥³äººç»´ç³»åŸºæœ¬ç”Ÿæ´»ã€‚ å¤ªå®°æ²»ä»¥â€ç§å°è¯´â€çš„æ–¹å¼ï¼Œå°†è‡ªå·±çš„ä¸€ç”Ÿçš„æŠ•å½±éƒ½æŠ˜å°„åœ¨å¶è—èº«ä¸Šã€‚</p>
<p> è¯»å®Œè¿™æœ¬ä¹¦åï¼Œå†…å¿ƒä»¿ä½›æœ‰ä»€ä¹ˆä¸œè¥¿è¢«è§¦åŠ¨äº†ï¼Œä½†æ˜¯ä¸€åˆ‡åˆäº†æ— ç—•è¿¹ã€‚ç»†ç»†æƒ³æ¥å¯èƒ½æ˜¯åœ¨ä¹¦ä¸­çœ‹åˆ°äº†è‡ªå·±çš„äº›è®¸é‡å½±ï¼Œå¦‚å¯¹è¿™ä¸ªäººç±»ä¸–ç•Œçš„ææƒ§ã€‚</p>
<blockquote>
<p>æˆ‘ä¸€ç›´å¯¹äººç±»ç•è‘¸ä¸å·²ï¼Œå¹¶å› è¿™ç§ç•è‘¸è€Œæˆ˜æ —ã€‚å¯¹è‡ªå·±ä½œä¸ºäººç±»ä¸€å‘˜çš„è¨€è¡Œä¹Ÿæ¯«æ— è‡ªè¡Œï¼Œåªå¥½å°†ç‹¬è‡ªçš„æ‡Šæ¼æ·±è—è¿›èƒ¸ä¸­çš„å°åŒ£å­é‡Œï¼Œå°†ç²¾ç¥ä¸Šçš„å¿§éƒå’Œè¿‡æ•å°å­˜èµ·æ¥â€ï¼Œä¼ªè£…æˆå¤©çœŸæ— é‚ªçš„ä¹å¤©å¤–è¡¨ï¼ŒæŠŠè‡ªå·±ä¸€æ­¥æ­¥åœ°å½»åº•æ‰“ç£¨æˆæç¬‘çš„ç•¸äººã€‚<br>æ— è®ºå¦‚ä½•ï¼Œåªè¦èƒ½è®©ä»–ä»¬å‘ç¬‘ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æˆ‘å¤„åœ¨äººä»¬æ‰€è°“çš„â€ç”Ÿæ´»â€ä¹‹å¤–ï¼Œä¹Ÿä¸ä¼šå¼•èµ·ä»–ä»¬çš„æ³¨æ„å§ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä¸èƒ½æœ‰ç¢ä»–ä»¬çš„è§†çº¿ã€‚æˆ‘æ˜¯â€æ— â€ï¼Œæ˜¯â€é£â€ï¼Œæ˜¯â€ç©ºâ€ã€‚è¯¸å¦‚æ­¤ç±»çš„æƒ³æ³•æ„ˆæ¼”æ„ˆçƒˆï¼Œæˆ‘åªèƒ½ç”¨æç¬‘æ¥é€—å®¶äººä»¬å¼€ä½ ï¼Œç”šè‡³åœ¨å¿…å®¶äººæ›´è´¹è§£æ›´å¯æ€•çš„ç”·ä¿‘å’Œå¥³ä½£é¢å‰ï¼Œä¹Ÿæ‹¼å‘½çš„æä¾›æç¬‘æœåŠ¡ã€‚</p>
</blockquote>
<p>åœ¨ä¸ç°å®ç”Ÿæ´»çš„æ–—äº‰ä¸­ï¼Œä¸æ–­è´¥åŒ—çš„ä»–ä¸ºè‡ªå·±å¸¦ä¸Šäº†â€ä¸‘è§’â€é¢å…·æ¥æ©ç›–è‡ªå·±çš„çœŸå®é¢ç›®ï¼Œç”¨å°æ—¶å€™å°±æƒ¯ç”¨çš„â€é€—ç¬‘â€ â€œè£…æ¨¡ä½œæ ·â€ç­‰æ‰‹æ³•æ¥ä¼ªè£…è‡ªå·±ï¼Œå–æ‚¦äºä»–äººã€‚ä½†æ˜¯åœ¨ç°å®çš„æ‘§æ®‹ä¸‹ï¼Œé‚£ç§çŸ›ç›¾æ„ˆæ¼”æ„ˆçƒˆï¼Œæœ€åå˜å¾—ä¸å¯è°ƒå’Œï¼Œç›´è‡³æœ€ç»ˆçš„è‡ªæˆ‘æ¯ç­ã€‚</p>
<p>çœ‹åˆ°å¥½å¤šè¯„è®ºè¯´ï¼Œå¿ƒæƒ…å¥½çš„æ—¶å€™ï¼Œä¸è¦çœ‹å¤ªå®°æ²»çš„ä½œå“ï¼Œå› ä¸ºé‚£ä¼šè®©ä½ çš„å¿ƒæƒ…å˜å¾—ä¸å¥½ï¼›å¿ƒæƒ…ä¸å¥½çš„æ—¶å€™æ›´ä¸è¦å»çœ‹å¤ªå®°æ²»çš„ä½œå“ï¼Œé‚£ä¼šè®©ä½ ç³Ÿç³•çš„å¿ƒæƒ…é›ªä¸ŠåŠ éœœã€‚</p>
<p>çœ‹å®Œä¹¦ä¸ç«Ÿæƒ³é—®è‡ªå·±ï¼Œå½“æŸä¸€å¤©ï¼Œç°å®ç”Ÿæ´»å‹çš„ä½ å–˜ä¸è¿‡æ°”æ¥ï¼Œå½“å†…å¿ƒçš„æ€æƒ³ä¸ç°å®äº§ç”Ÿæ¿€çƒˆçš„çŸ›ç›¾åï¼Œæˆ‘åˆè¯¥ä½•å»ä½•ä»å‘¢ï¼Ÿ</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>äººé—´å¤±æ ¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šä½ çš„å–„è‰¯å¿…é¡»æœ‰ç‚¹é”‹èŠ’ã€‹</title>
    <url>/2022/05/15/book/ni-de-shan-liang-bi-xu-you-dian-feng-mang/</url>
    <content><![CDATA[<blockquote>
<p>ä½ çš„å–„è‰¯ï¼Œå¿…é¡»æœ‰ç‚¹é”‹èŠ’ï¼Œå¦åˆ™ç­‰äºé›¶ â€”â€” ã€ç¾ã€‘æ‹‰å°”å¤«Â·ç“¦å°”å¤šÂ·çˆ±é»˜ç”Ÿ</p>
</blockquote>
<p><img src="/images/book/%E4%BD%A0%E7%9A%84%E5%96%84%E8%89%AF%E5%BF%85%E9%A1%BB%E6%9C%89%E7%82%B9%E9%94%8B%E8%8A%92.jpeg" alt="ä½ çš„å–„è‰¯å¿…é¡»æœ‰ç‚¹é”‹èŠ’"></p>
<h1 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h1><p>æ›¾ç»å¬åˆ°è¿‡è¿™æ ·çš„ä¸€å¥è¯ï¼š<code>God helps those who help themselves</code>,ç¿»è¯‘åçš„æ„æ€æ˜¯ï¼šä¸Šå¸åªæ•‘è‡ªæ•‘è€…ã€‚ä½›ç»æœ‰ä¸€å¥ç›¸ä¼¼çš„è¯ï¼šä¼—ç”Ÿçš†è‹¦ï¼Œå”¯æœ‰è‡ªæ¸¡ã€‚éšç€æˆé•¿æˆ‘å¼€å§‹é€æ¸ç†è§£è¿™ä¸¤å¥è¯çš„æ„æ€ï¼Œæƒ³è¦è¿½å¯»å¹¸ç¦çš„äººç”Ÿï¼Œå¿…é¡»è¦å­¦ä¼š<code>è‡ªæ•‘</code>æˆ–è€…<code>è‡ªæ¸¡</code>ã€‚åœ¨æˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¼šé‡è§è®¸å¤šè¿·èŒ«å’Œå›°æƒ‘ï¼Œé˜»ç¢æˆ‘ä»¬çš„å‰è¿›å’Œæˆé•¿ä¹‹è·¯ï¼Œæˆ–è®¸æˆ‘ä»¬éƒ½å¸Œæœ›æœ‰äººèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å…‹æœå›°éš¾ï¼Œä½†æ˜¯é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯æˆ‘ä»¬å§‹ç»ˆè¿‡ä¸å»è‡ªå·±å¿ƒä¸­çš„é‚£ä¸€å…³ï¼Œå°±è¿™æ ·ä¸æ–­é™·å…¥å†…å¿ƒçš„ç…ç†¬ä¹‹ä¸­ã€‚çœ‹åˆ°è¿™æœ¬ä¹¦çš„æ—¶å€™ä¸€ä¸‹å­å°±è¢«è¿™æœ¬ä¹¦çš„åå­—å¸å¼•ï¼Œä½†æ˜¯ä¹¦é˜…è¯»åå‘ç°ï¼Œä¹¦ä¸­çš„å†…å®¹çŠ¹å¦‚ç©ºä¸­æ¥¼é˜ï¼Œè¿™é‡Œæ›´å»ºè®®å¤§å®¶å»è¯»ï¼š<a href="https://www.mpoom.cn/2021/02/10/book/bei-tao-yan-de-yong-qi/">ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹</a>ã€<a href="https://www.mpoom.cn/2021/02/11/book/ke-ai-de-zu-zhou/">ã€Šå¯çˆ±çš„è¯…å’’ã€‹</a>ä»¥åŠã€Šè‡ªå‘ä¸è¶…è¶Šã€‹ï¼Œè¿™äº›ä¹¦ç±ç»“åˆå¿ƒç†å­¦çš„çŸ¥è¯†ï¼Œåˆ†æäº†é—®é¢˜çš„æœ¬è´¨ï¼Œç»“åˆåˆ‡å®çš„æ¡ˆä¾‹æä¾›äº†è§£å†³ä¹‹æ³•ã€‚è™½ç„¶è¿™æœ¬ä¹¦ä¸­æ›´å¤šæ˜¯é¸¡æ±¤ï¼Œä½†æ˜¯ä¹¦ä¸­æåˆ°çš„å¾ˆå¤šç°è±¡å€¼å¾—æˆ‘ä»¬æ€è€ƒæ¢è®¨ä¸€ä¸‹ã€‚</p>
<h1 id="è¯šçŸ¥æ­¤æ¨äººäººæœ‰ï¼Œè´«è´±å¤«å¦»ç™¾äº‹å“€"><a href="#è¯šçŸ¥æ­¤æ¨äººäººæœ‰ï¼Œè´«è´±å¤«å¦»ç™¾äº‹å“€" class="headerlink" title="è¯šçŸ¥æ­¤æ¨äººäººæœ‰ï¼Œè´«è´±å¤«å¦»ç™¾äº‹å“€"></a>è¯šçŸ¥æ­¤æ¨äººäººæœ‰ï¼Œè´«è´±å¤«å¦»ç™¾äº‹å“€</h1><blockquote>
<p>ã€Šé£æ‚²æ€€ä¸‰é¦–Â·å…¶äºŒã€‹</p>
<p>å”Â·å…ƒç¨¹</p>
<p>æ˜”æ—¥æˆè¨€èº«åäº‹ï¼Œä»Šæœéƒ½åˆ°çœ¼å‰æ¥ã€‚</p>
<p>è¡£è£³å·²æ–½è¡Œçœ‹å°½ï¼Œé’ˆçº¿çŠ¹å­˜æœªå¿å¼€ã€‚</p>
<p>å°šæƒ³æ—§æƒ…æ€œå©¢ä»†ï¼Œä¹Ÿæ›¾å› æ¢¦é€é’±è´¢ã€‚</p>
<p>è¯šçŸ¥æ­¤æ¨äººäººæœ‰ï¼Œè´«è´±å¤«å¦»ç™¾äº‹å“€ã€‚</p>
</blockquote>
<p>åœ¨å©šå§»å’Œå®¶åº­è¯é¢˜ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå¬åˆ°ä¸€å¥è¯ï¼š<code>è´«è´±å¤«å¦»ç™¾äº‹å“€</code>ï¼Œè¿™å¥è¯ä»å­—é¢æ„æ€ç†è§£æ˜¯ï¼šå¤«å¦»å®¶åº­ç”Ÿæ´»ç»æµæ¡ä»¶å·®ã€ç”Ÿæ´»çª˜è¿«ï¼Œå› å„ç§çäº‹è€ŒçŸ›ç›¾é‡é‡ã€‚ä½†æ˜¯è¿™å¥è¯—çš„åŸæ–‡å‡ºè‡ªå”ä»£è¯—äººå…ƒç¨¹ã€Šé£æ‚²æ€€ä¸‰é¦–Â·å…¶äºŒã€‹,ã€Šé£æ‚²æ€€ä¸‰é¦–ã€‹æ˜¯ä½œè€…ä¼¤æ‚¼å·²æ•…çš„åŸé…å¦»å­ï¼Œæœ€åä¸€å¥å¤§æ„ä¸ºï¼šè™½ç„¶æˆ‘çŸ¥é“è¿™ç§é˜´é˜³ç›¸éš”çš„æ‚²æ¨äººäººéƒ½ä¼šæœ‰,ä½†ä¸€æƒ³èµ·æˆ‘ä»¬åšè´«è´±å¤«å¦»çš„æ¯ä¸€ä»¶äº‹æƒ…éƒ½ä¼šè®©æˆ‘ç‰¹åˆ«æ‚²å“€ã€‚ä¹‹å‰åœ¨æ²¡æœ‰äº†è§£è¿™å¥è¯—çš„åŸæ–‡å‡ºå¤„çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æœ›æ–‡ç”Ÿä¹‰çš„å»ç”¨ã€‚ç°åœ¨æ¯æ¬¡å¬åˆ°è¿™å¥è¯éƒ½å¿ä¸ä½æƒ³ç»™å¯¹æ–¹å‹æƒ…æç¤ºä¸€ä¸‹ï¼Œä½†æ˜¯æœ‰æ—¶å€™æƒ³æƒ³åˆè§‰å¾—æ²¡å¿…è¦ï¼Œè¯´å‡ºå»æ— éæ˜¯åœ¨å–å¼„çŸ¥è¯†ï¼Œä»å­—é¢ç†è§£ç¡®å®æ²¡æ¯›ç—…ï¼Œè€Œä¸”å¼ºè¡Œè§£é‡Šå¯¹äºæ­£åœ¨äº¤è°ˆçš„è¯é¢˜æœ¬èº«æ— å®è´¨æ€§å¸®åŠ©ã€‚è¿™é‡Œæœ¬ç€åˆ†äº«çš„æ€åº¦ï¼Œå¸Œæœ›å¤§å®¶äº†è§£åˆ°è¿™å¥è¯çš„åŸæ„ã€‚</p>
<h1 id="ä¸€ã€ä½ ä»¥ä¸ºçš„å–„è‰¯ï¼Œå…¶å®çŸ¥è¯†æ‡¦å¼±"><a href="#ä¸€ã€ä½ ä»¥ä¸ºçš„å–„è‰¯ï¼Œå…¶å®çŸ¥è¯†æ‡¦å¼±" class="headerlink" title="ä¸€ã€ä½ ä»¥ä¸ºçš„å–„è‰¯ï¼Œå…¶å®çŸ¥è¯†æ‡¦å¼±"></a>ä¸€ã€ä½ ä»¥ä¸ºçš„å–„è‰¯ï¼Œå…¶å®çŸ¥è¯†æ‡¦å¼±</h1><p>æ¯ä¸ªäººéƒ½æ›¾é‡åˆ°è¿‡ä¸å¥½æ„æ€æ‹’ç»åˆ«äººçš„æƒ…å†µï¼Œå…¶ä¸­åŸå› æœ‰å¾ˆå¤šï¼Œæˆ–æ˜¯æ€•å¯¹æ–¹å¤±æœ›ä¸æƒ³ä¼¤å®³å¯¹æ–¹ï¼Œæˆ–æ˜¯ä¸æƒ³è¿èƒŒå¯¹æ–¹æ„æ„¿ï¼Œæˆ–æ˜¯ä¸æƒ³æ‰“ç ´è‡ªå·±â€œå¥½äººâ€çš„äººè®¾ç­‰ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä»”ç»†å›é¡¾æˆ‘ä»¬å› ä¸ºè‡ªå·±çš„â€œå–„æ„â€æ²¡æœ‰æ‹’ç»åˆ«äººçš„æœ€åç»“æœæ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„å—ï¼Ÿ</p>
<h2 id="1-1-â€å–„æ„â€œçš„æ‹’ç»"><a href="#1-1-â€å–„æ„â€œçš„æ‹’ç»" class="headerlink" title="1.1 â€å–„æ„â€œçš„æ‹’ç»"></a>1.1 â€å–„æ„â€œçš„æ‹’ç»</h2><p>ä½ â€œå–„æ„â€çš„æ‹’ç»å¾€å¾€å¯èƒ½ä¼šçœŸæ­£çš„ä¼¤å®³åˆ°åˆ«äººã€‚æ¯”å¦‚åˆ«äººé‚€è¯·ä½ å‚ä¸ä¸€ä¸ªèšä¼šæ—¶ï¼Œä½ å†…å¿ƒæ˜¯ä¸æƒ³å»çš„ï¼Œä½†æ˜¯åˆä¸å¿ç›´æ¥æ‹’ç»ï¼Œæ‰€ä»¥æ¨è¾è¯´æœ‰ä¸ªé‡è¦çš„äº‹è¦å‚åšæŠ½ä¸å¼€èº«ï¼Œç»“æœåˆ«äººä»¥ä¸ºä½ æƒ³è¦æ¥è€Œæ²¡æœ‰æ—¶é—´ï¼Œå•†é‡è¿‡åæ¨è¿Ÿäº†æ—¶é—´é‡æ–°é‚€è¯·ä½ ï¼Œè¿™æ—¶ä½ å‘ç°ä¸å¿å†æ‰¾ç†ç”±æ‹’ç»ï¼Œä¸å¾—ä¸å»å‚åŠ è¿™ä¸ªä½ ä¸æƒ³å»çš„èšä¼šã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ä½ ç¼–äº†ä¸€ä¸ªè¹©è„šçš„è°è¨€è¯´ä½ å·¥ä½œå¿™å»ä¸äº†ï¼Œå´å› æœºç¼˜å·§åˆï¼Œè¢«åˆ«äººæ’è§äº†è¯´æ˜¯è¦å·¥ä½œä½†æ˜¯å´åœ¨é€›è¡—çš„ä½ ï¼Œè°è¨€è¢«æ— æƒ…çš„æ‹†ç©¿ï¼Œåœ¨å¯¹æ–¹çš„å°è±¡é‡Œï¼Œä½ æ˜¯ä¸€ä¸ªå®æ„¿å»é€›è¡—ä¹Ÿä¸æ„¿å»å‚åŠ ä»–èšä¼šçš„äººã€‚</p>
<p>â€å–„æ„â€œçš„æ‹’ç»æœ‰æ—¶ä¼šç»™å¯¹æ–¹å¸¦æ¥æ›´å¤§çš„ä¼¤å®³ï¼Œæ‰€ä»¥è¡¨è¾¾ä½ çœŸå®çš„æƒ³æ³•ï¼Œç›´æ¥æ‹’ç»æ‰ä¼šæ›´å¥½ã€‚å¦‚æœçœŸçš„æ˜¯å¾ˆå¥½çš„æœ‹å‹ï¼Œä»–ä¼šç«™åœ¨ä½ çš„ç«‹åœºä¸Šæ€è€ƒç†è§£ä½ çš„å†³å®šã€‚åä¹‹å¦‚æœå› ä¸ºä½ çš„ä¸€æ¬¡æ‹’ç»ï¼Œå¯¹æ–¹å°±å’Œä½ æ–­ç»å…³ç³»å¾€æ¥ï¼Œé‚£ä¹ˆä½ å°±æœ‰å¿…è¦æ€è€ƒï¼Œå¯¹æ–¹æ˜¯å¦æ˜¯ä½ çœŸæ­£çš„æœ‹å‹ï¼Œå¯¹æ–¹æ˜¯å¦å€¼å¾—ä½ ä¸ºä»–èŠ±è´¹è¿™äº›æ—¶é—´ï¼Ÿ</p>
<h2 id="1-2-â€æ¶æ„â€œçš„æ‹’ç»"><a href="#1-2-â€æ¶æ„â€œçš„æ‹’ç»" class="headerlink" title="1.2 â€æ¶æ„â€œçš„æ‹’ç»"></a>1.2 â€æ¶æ„â€œçš„æ‹’ç»</h2><p>åœ¨æˆ‘ä»¬æƒ³ç€å¦‚ä½•æ‹’ç»åˆ«äººçš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¹Ÿä¼šé­é‡æ‹’ç»ï¼Œä½†æ˜¯å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯·æ±‚åˆ«äººçš„æ—¶å€™éƒ½ä¼šæœ‰è¢«æ‹’ç»çš„å¿ƒç†é¢„æœŸï¼Œæ‰€ä»¥å³ä½¿è¢«æ‹’ç»ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šå¤ªéš¾è¿‡ã€‚ä½†æ˜¯æœ‰äº›â€æ¶æ„â€œçš„æ‹’ç»ï¼Œä¼šè®©äººæ°”çš„ç«å†’ä¸‰ä¸ˆï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬è¯·æ±‚åˆ«äººåŠäº‹æ—¶ï¼Œå¯¹æ–¹æå‡ºå„ç§å„æ ·çš„è¦æ±‚ï¼Œå½“æˆ‘ä»¬æ’é™¤ä¸‡éš¾è¾¾åˆ°è¦æ±‚ä¹‹åï¼Œå¯¹æ–¹å´è¯´ä»–åŠä¸äº†ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘åªæƒ³é—®å¯¹æ–¹ç¥–åŸåœ¨å“ªï¼Ÿ</p>
<blockquote>
<p>å£°æ˜ä¸€ä¸‹ï¼Œä½œä¸ºä¸€ä¸ªç°ä»£æ–‡æ˜äººï¼Œåˆ¨åˆ«äººç¥–åŸè¿™äº‹æˆ‘å¯åšä¸å‡ºæ¥ï¼Œé™¤éæ˜¯å¤ªç”Ÿæ°”äº†</p>
</blockquote>
<h2 id="1-3-ç»´æŒâ€œå¥½äººâ€äººè®¾"><a href="#1-3-ç»´æŒâ€œå¥½äººâ€äººè®¾" class="headerlink" title="1.3 ç»´æŒâ€œå¥½äººâ€äººè®¾"></a>1.3 ç»´æŒâ€œå¥½äººâ€äººè®¾</h2><p>ä»å°æˆ‘ä»¬å°±è¢«æ•™è‚²è¦æˆä¸ºä¸€ä¸ªâ€œå¥½äººâ€ï¼Œè¦æ‰¶è€å¥¶å¥¶è¿‡é©¬è·¯ï¼Œåœ¨å…¬äº¤è½¦ä¸Šä¸»åŠ¨ç»™æœ‰éœ€è¦çš„äººè®©åº§ç­‰ã€‚ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼Œå½“ä½ åå…¬äº¤è½¦æ—¶ï¼Œè½¦ä¸Šä¸Šæ¥å‡ ä½è€äººç«™åœ¨ä½ çš„æ—è¾¹ã€‚è¦æ˜¯åœ¨å¹³æ—¶ä½ è‚¯å®šä¼šä¸»åŠ¨è®©åº§ï¼Œä½†æ˜¯ç”±äºä»Šå¤©èº«ä½“ä¸èˆ’æœï¼Œä½ ä¹Ÿéœ€è¦è¿™ä¸ªåº§ä½ï¼Œä½†æ˜¯ä¸è®©åº§åˆè¿èƒŒäº†è‡ªå·±å¿ƒä¸­â€œå¥½äººâ€çš„äººè®¾ï¼Œå¬åˆ°å…¬äº¤è½¦ä¸Šæ’­æ”¾çš„å½•éŸ³ï¼šâ€œå°Šè€çˆ±å¹¼æ˜¯ä¸­åæ°‘æ—çš„ä¼ ç»Ÿç¾å¾·â€æ—¶æ›´æ˜¯å¦‚èŠ’åœ¨èƒŒï¼Œé­å—ç€è‚‰ä½“å’Œå¿ƒçµçš„åŒé‡æŠ˜ç£¨ã€‚</p>
<p>â€œå¥½äººâ€æœ€éš¾çš„æ˜¯è·¨è¶Šè‡ªå·±å¿ƒä¸­çš„é‚£é“åï¼Œä½†æ˜¯ä»äº‹å®æ¥çœ‹ï¼Œæˆ‘ä»¬æ˜¯åœ¨åšå¥½äººå¥½äº‹ï¼Œè¿˜æ˜¯åœ¨å§”æ›²æ±‚å…¨ï¼Ÿâ€å¥½äººâ€œå¾€å¾€å®¹æ˜“è¢«é“å¾·æˆ–è§„åˆ™æ‰€æŸç¼šï¼Œæ‰€ä»¥å½“ä½ å‘ç°åšâ€å¥½äººâ€œè¦å§”å±ˆè‡ªå·±çš„æ—¶å€™ï¼Œé‚£ä¹ˆä½ å°±åº”è¯¥åœä¸‹æ¥ï¼Œå°è¯•è¡¨è¾¾è‡ªå·±çœŸå®çš„æ„Ÿå—ï¼Œè€Œä¸æ˜¯å§”å±ˆè‡ªå·±ã€‚</p>
<h2 id="1-4-å¯»æ±‚è®¤åŒ"><a href="#1-4-å¯»æ±‚è®¤åŒ" class="headerlink" title="1.4 å¯»æ±‚è®¤åŒ"></a>1.4 å¯»æ±‚è®¤åŒ</h2><p>ç¤¾ä¼šå¿ƒç†å­¦ä¸­æåˆ°ä¸€ä¸ªç°è±¡ï¼Œå½“æˆ‘ä»¬èº«å¤„ä¸€ä¸ªé›†ä½“ä¹‹ä¸­æ—¶æˆ‘ä»¬ä¸§å¤±è‡ªä¸»æ€ç»´ï¼Œä¼šä¸»åŠ¨å¯»æ±‚é›†ä½“çš„è®¤åŒï¼Œå³ä½¿æœ‰æ—¶å€™ä¸åŒæ„ï¼Œä¹Ÿä¸ä¼šå…¬ç„¶åå¯¹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³æˆä¸ºæœ€ç¢çœ¼çš„é‚£ä¸€ä¸ªã€‚æ‰€ä»¥å½“æˆ‘ä»¬èº«å¤„é›†ä½“ä¹‹ä¸­æ—¶ï¼Œä¸ºäº†å¯»æ±‚è®¤åŒè€Œç­”åº”äº†æˆ‘ä»¬å¹³æ—¶ä¼šæ‹’ç»çš„è¯·æ±‚ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸ªå¼ºå¤§çš„å†…å¿ƒï¼Œæ›´è¦è®¤æ¸…ä¸€ä¸ªäº‹å®ï¼Œæ— è®ºä½ æ€æ ·åšï¼Œä½ éƒ½æ²¡åŠæ³•ä¿è¯é›†ä½“ä¸­çš„æ¯ä¸€ä¸ªäººéƒ½æ»¡æ„ã€‚å³ä½¿æ˜¯ç¾å›½æ€»ç»Ÿï¼Œä»–ä»¬ä¹Ÿæ²¡æœ‰è·å¾—ç™¾åˆ†ç™¾çš„é€‰ç¥¨çš„ã€‚æˆ‘ä»¬å¿…é¡»è¦å¼„æ¸…å“ªä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯ä»¥äº‰å–åˆ°çš„äººï¼Œå“ªä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬æ— è®ºå¦‚æœéƒ½æ— æ³•äº‰å–åˆ°çš„äººï¼ŒæŠŠåŠªåŠ›ç”¨åœ¨å¯ä»¥äº‰å–çš„äººèº«ä¸Šã€‚</p>
<h1 id="äºŒã€åƒäºæ˜¯ç¦"><a href="#äºŒã€åƒäºæ˜¯ç¦" class="headerlink" title="äºŒã€åƒäºæ˜¯ç¦"></a>äºŒã€åƒäºæ˜¯ç¦</h1><p>æˆ‘å¦ˆä»å°æ•™æˆ‘äº†ä¸€ä¸ªé“ç†ï¼›â€å°‘æ²¾å…‰ï¼Œå¤šåƒäºâ€œï¼Œè¿™ä¸ªé“ç†æˆ‘ä»å°è·µè¡Œï¼Œåˆ°ç°åœ¨å¸®æˆ‘ç»“äº¤åˆ°ä¸€ç¾¤å¯ä»¥ä¿¡èµ–çš„æœ‹å‹ã€‚å¦‚ä»Šæˆ‘å¯¹è¿™å¥è¯æœ‰äº†æ›´æ·±å±‚æ¬¡çš„ç†è§£ï¼Œé‚£å°±æ˜¯â€å­¦ä¼šä»˜å‡ºå’Œå¥‰çŒ®â€œã€‚äººé™…äº¤å¾€çš„æœ¬è´¨æ˜¯åˆ©ç›Šäº¤æ¢ï¼Œä¸€å‘³çš„ç´¢å–åªä¼šè®©å‘¨å›´çš„äººè¿œç¦»ä½ ï¼Œæ‰€ä»¥åœ¨æœ€åˆæ—¶çš„äº¤å¾€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è¦å­¦ä¼šä»˜å‡ºï¼Œåœ¨ä»˜å‡ºå’Œç´¢å–ä¹‹é—´å°½é‡è¾¾æˆå¹³è¡¡ï¼Œç›´åˆ°æˆ‘ä»¬åœ¨ä¸æ–­çš„å…¬å¹³äº¤æ˜“ä¸­å»ºç«‹ä¿¡ä»»ä»¥åï¼Œæˆ‘ä»¬æ‰å¯ä»¥æŠ›å¼€ç­‰ä»·äº¤æ¢æ¥ä¿æŒäººé™…äº¤å¾€äº†ã€‚</p>
<p>æ‰€ä»¥åœ¨æ²¡æœ‰å»ºç«‹ä¿¡ä»»å…³ç³»çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°½é‡éµå¾ªç­‰ä»·äº¤æ¢çš„åŸåˆ™è¿›è¡Œç´¢å–å’Œä»˜å‡ºï¼Œå¦åˆ™å¾€å¾€ä¼šå¯¼è‡´å…³ç³»çš„ç ´è£‚ï¼Œç´¢å–çš„å¤ªå¤šå¯¹æ–¹ä¸æ»¡æ„ï¼Œä»˜å‡ºçš„å¤ªå¤šè‡ªå·±ä¸æ»¡æ„ã€‚åœ¨èµ·åˆçš„åˆ©ç›Šäº¤æ¢ä¸­ï¼Œå¦‚æœä½ æ›´æ„¿æ„ä¼˜å…ˆä»˜å‡ºï¼Œé‚£ä¹ˆå¯¹ä¿¡ä»»çš„å»ºç«‹ä»¥åŠä¿¡ä»»çš„ç‰¢å›ºç¨‹åº¦éå¸¸æœ‰ç›Šï¼Œè¿™æ˜¯æˆ‘æ‰€ç†è§£çš„ï¼šâ€å°‘æ²¾å…‰ï¼Œå¤šåƒäºâ€œã€‚</p>
<p>å¯¹äºæˆ‘ä»¬å‘¨å›´é‚£äº›åªçŸ¥é“ä¸€å‘³ç´¢å–çš„äººï¼Œåœ¨æ—©æœŸçš„äº¤å¾€è¿‡ç¨‹ä¸­å‘ç°åï¼Œæ¸…å°½æ—©è¿œç¦»ï¼Œå› ä¸ºè¿™æ³¨å®šæ˜¯ä¸€åœºä¸å…¬å¹³çš„äº¤æ˜“ã€‚</p>
<h1 id="ä¸‰ã€è¿‡åº¦ç‰ºç‰²å¼çš„ä»˜å‡ºä¸æ˜¯çˆ±"><a href="#ä¸‰ã€è¿‡åº¦ç‰ºç‰²å¼çš„ä»˜å‡ºä¸æ˜¯çˆ±" class="headerlink" title="ä¸‰ã€è¿‡åº¦ç‰ºç‰²å¼çš„ä»˜å‡ºä¸æ˜¯çˆ±"></a>ä¸‰ã€è¿‡åº¦ç‰ºç‰²å¼çš„ä»˜å‡ºä¸æ˜¯çˆ±</h1><p>ä¸€ä¸ªå¥³äººä¸ºäº†æ”¯æŒä¸ˆå¤«æ±‚å­¦æ·±é€ æ”¾å¼ƒäº†è‡ªå·±çš„æ™‹å‡æœºä¼šï¼Œåé¢ä¸ºäº†æ”¯æŒä¸ˆå¤«çš„å·¥ä½œæ¯…ç„¶è¾å»äº†å·¥ä½œæˆä¸ºå®¶åº­ä¸»å¦‡ï¼Œä½†æ˜¯æœ€ç»ˆå´æ¢æ¥äº†ä¸ˆå¤«çš„ç¦»å©šè¯·æ±‚ã€‚åœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬ä¹Ÿç»å¸¸å¬åˆ°è¿™æ ·çš„è¯ï¼šâ€œæˆ‘ä¸ºä½ ä»˜å‡ºäº†è¿™ä¹ˆå¤šï¼Œä½ å´è¿™ä¹ˆå¯¹æˆ‘â€ã€‚ä¹‹å‰æˆ‘æ˜¯ä¸€ç›´ä¸æ‡‚ï¼Œä½†æ˜¯å¦‚ä»Šæˆ‘æœ‰äº†ä¸€äº›ç†è§£ï¼Œé‚£å°±æ˜¯ â€”â€” å¿ƒçµä¸èƒ½æ‰¿å—ä¹‹é‡ã€‚å¾ˆå¤šæ—¶å€™ç‰ºç‰²å¼çš„ä»˜å‡ºï¼Œæˆä¸ºäº†æ¥å—ä»˜å‡ºè€…çš„å¿ƒç†è´Ÿæ‹…ï¼Œä½¿å¾—åŒå‘ä¸èƒ½å†ä»¥å¹³ç­‰çš„æ–¹å¼ç›¸å¤„ï¼Œåè€Œå˜å¾—åƒè€æ¿ä¸å‘˜å·¥çš„å…³ç³»ã€‚ä»˜å‡ºçš„ä¸€æ–¹åœ¨æƒ³æˆ‘ä¸ºä½ ä»˜å‡ºäº†é‚£ä¹ˆå¤šï¼Œä½ çš„è¡¨ç°å¿…é¡»ç¬¦åˆæˆ‘çš„é¢„æœŸï¼›è€Œæ¥å—ä»˜å‡ºçš„ä¸€æ–¹å†…å¿ƒé™¤äº†æ„Ÿæ¿€ï¼Œåè€Œä¼šæ‰¿æ‹…æ›´å¤§çš„å‹åŠ›ã€‚ä¸€æ–¹é¢å› ä¸ºä½ çš„ä»˜å‡ºä¼šäº§ç”Ÿäº†æŒ«è´¥æ„Ÿï¼Œå¦ä¸€æ–¹é¢ä»–å¿…é¡»å¤„åœ¨é«˜å‹ä¹‹ä¸‹åŠªåŠ›å¥‹æ–—ï¼Œé˜²æ­¢ä½ çš„ç‰ºç‰²å’Œä»˜å‡ºç™½è´¹ã€‚</p>
<blockquote>
<p>ä½œä¸ºä¸€ä¸ªåŒ—æ–¹äººï¼Œå’Œæœ‹å‹ä¸€èµ·å‡ºå»åƒé¥­ä¸€èˆ¬éƒ½æ˜¯ä½ ä¹°ä¸€æ¬¡å•æˆ‘ä¹°ä¸€æ¬¡å•ï¼Œè½®æµç€æ¥ï¼Œå¤§è‡´å…¬å¹³å³å¯ã€‚ç„¶è€Œæ¯æ¬¡å’Œå¤§å­¦å®¤å‹å‡ºå»åƒé¥­ä¹°å•åï¼Œä»–æ€»è¦AAè½¬ç»™æˆ‘ï¼Œæˆ‘è¯´ä¸‹æ¬¡ä»–ä¹°å•å°±è¡Œï¼Œä¸ç”¨è½¬äº†ï¼Œä½†æ˜¯ä»–å°±æ˜¯ä¸åŒæ„ï¼Œå¯æ¶ï¼Œæ¯æ¬¡éƒ½è¢«ä»–AAäº†ï¼Œå¥½ä¸ç”˜å•Šã€‚åæ¥åƒé¥­æ—¶ï¼Œä¹Ÿå’Œä»–èŠåˆ°è¿™ä¸ªé—®é¢˜ï¼Œä¸ºå•¥éè¦AAå‘¢ï¼Ÿä»–è¯´å¦‚æœæ²¡æœ‰AAè¿˜å¾—è®°åœ¨å¿ƒé‡Œï¼Œä¸‹æ¬¡åƒé¥­æŒ‡ä¸å®šæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘¢ï¼ŸAAåå°±ä¸ç”¨é‚£ä¹ˆéº»çƒ¦äº†ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä½ çš„ä»˜å‡ºåè€Œä¼šæˆä¸ºåˆ«äººçš„å¿ƒé‡Œè´Ÿæ‹…ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ç¡®å®åº”è¯¥åƒæˆ‘çš„å®¤å‹å­¦ä¹ ä¸€ä¸‹ï¼Œä¸è¦â€œä¸‹æ¬¡ä¸€å®šâ€ï¼Œè€Œæ˜¯è¿™æ¬¡ä¸€å®šã€‚</p>
</blockquote>
<p>è¿‡åº¦ç‰ºç‰²å¼çš„ä»˜å‡ºä¸æ˜¯çˆ±ï¼Œåè€Œåƒç»‘æ¶ä¸€èˆ¬ï¼Œç»“å±€å¾€å¾€æ˜¯ä¸€ä¸ªæ‚²å‰§ã€‚ä¹‹å‰ä¹Ÿå’Œå¼ è‹±ä¿ŠåŒå­¦è®¨è®ºè¿‡è¿™ä¸ªè¯é¢˜ï¼Œä»˜å‡ºçš„æ—¶å€™ä½ éœ€è¦è€ƒè™‘å¯¹æ–¹æ˜¯å¦èƒ½å¤Ÿå¦ç„¶çš„æ¥å—ä½ çš„ä»˜å‡ºï¼Œå…¶ä¸­çš„æ ¸å¿ƒæ˜¯ä½ çš„ä»˜å‡ºèƒ½å¦è®©ä½ ä»¬ä¿æŒä¸€ä¸ªå¹³ç­‰çš„å…³ç³»ç›¸å¤„ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ¢æ¥çš„åˆ™æ˜¯å¯¹æ–¹çš„æ„Ÿæ¿€ï¼Œå¦åˆ™æ¢æ¥çš„æ˜¯å¯¹æ–¹çš„æŒ«è´¥æ„Ÿè€Œä¸”ä½¿å¯¹æ–¹äº§ç”Ÿå¿ƒé‡Œè´Ÿæ‹…ã€‚</p>
<h1 id="å››ã€è®¤è¯†è‡ªæˆ‘"><a href="#å››ã€è®¤è¯†è‡ªæˆ‘" class="headerlink" title="å››ã€è®¤è¯†è‡ªæˆ‘"></a>å››ã€è®¤è¯†è‡ªæˆ‘</h1><p>ä¹‹å‰çœ‹åˆ°è¿‡ä¸€å¥è¯å«ï¼šå’Œè¿‡å»çš„è‡ªå·±å’Œè§£ï¼Œæƒ³è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å…ˆè¦å»è®¤è¯†è‡ªå·±ï¼Œç›²ç›®çš„å’Œè§£æˆ–æ”¾ä¸‹åªæ˜¯åœ¨é€ƒé¿è€Œå·²ã€‚æˆ‘ä»¬å¾ˆå¤šæ—¶å€™éƒ½ä»»ç”±æƒ…ç»ªæŠŠæ§è‡ªå·±ï¼Œåšå‡ºäº†è¿èƒŒæˆ‘ä»¬å†…å¿ƒæƒ³æ³•çš„è¡Œä¸ºã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æœ¬ä¹¦æƒ³è¡¨è¾¾çš„æ˜¯è¦æˆä¸ºä¸€ä¸ªæœ‰åŸåˆ™çš„äººï¼Œå½“æˆ‘ä»¬çš„åŸåˆ™å—åˆ°æŒ‘æˆ˜æˆ–è¢«æ‰“ç ´æ—¶ï¼Œæˆ‘ä»¬å°±è¦è¿›è¡Œ<code>fight</code>ã€‚å½“æˆ‘ä»¬è¿˜ç¼ºå¤±æŸäº›åŸåˆ™çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å°è¯•å»å»ºç«‹è¿™äº›çš„åŸåˆ™ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™æœ¬ä¹¦æ˜¯ä¸€æœ¬å¿ƒçµé¸¡æ±¤ç±»çš„ä¹¦ç±ï¼Œèƒ½å¼•èµ·ä½ çš„å…±é¸£ï¼Œä½†æ˜¯æ— æ³•åˆ‡å®çš„å¸®åŠ©ä½ è§£å†³é—®é¢˜ã€‚è€Œä¸”æˆ‘å‘ç°å¿ƒçµé¸¡æ±¤ç±»çš„ä¹¦ç±çš„ç¼ºç‚¹æ˜¯å¾€å¾€åªåˆ†æäº†ç°è±¡ï¼Œè€Œä¸”æ˜¯é¢å‘ç»“æœçš„ï¼Œæ‰€ä»¥å¾€å¾€èƒ½å¼•èµ·ä½ çš„å…±é¸£ï¼Œä½†æ˜¯ä¸èƒ½å¸®åŠ©ä½ è§£å†³å®é™…é—®é¢˜ã€‚è€Œå½“ä½ æ¢å¤å†·é™ååˆè¦é¢å¯¹ç°å®ä¸ä¹¦ä¸­ç»“æœçš„å·¨å¤§è½å·®ï¼Œä»è€Œäº§ç”Ÿæ·±æ·±çš„æŒ«è´¥æ„Ÿã€‚è€Œæˆ‘æ‰€çœ‹è¿‡çš„å¹²è´§ä¹¦ç±ï¼Œå®ƒä»¬æ˜¯åˆ†æç°è±¡åŠåŸå› ï¼Œå¹¶ä¸”é¢å‘è¿‡ç¨‹æä¾›äº†åˆ‡å®å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥å¿ƒçµé¸¡æ±¤è¿˜æ˜¯è¦å°‘è¯»ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>ä½ çš„å–„è‰¯å¿…é¡»æœ‰ç‚¹é”‹èŠ’</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿã€‹</title>
    <url>/2022/09/07/book/ni-yao-ru-he-heng-liang-ni-de-ren-sheng/</url>
    <content><![CDATA[<p><img src="/images/book/%E4%BD%A0%E8%A6%81%E5%A6%82%E4%BD%95%E8%A1%A1%E9%87%8F%E4%BD%A0%E7%9A%84%E4%BA%BA%E7%94%9F.jpg" alt="ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿ"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><em><strong>ã€Šã€Šä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿã€‹ â€”â€” å“ˆä½›å•†å­¦é™¢æ¯•ä¸šå‰æœ€é‡è¦çš„ä¸€å ‚è¯¾</strong></em></p>
<blockquote>
<p>å…‹è±é¡¿Â·å…‹é‡Œæ–¯å¦æ£® å‡¯ä¼¦Â·è¿ªä¼¦ è©¹å§†æ–¯Â·å¥¥æ²ƒæ–¯</p>
</blockquote>
<h1 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯é˜…è¯»æœ¬ä¹¦æ—¶å‘è¡¨çš„ä¸€äº›æƒ³æ³•ï¼Œä»Šå¤©å¶ç„¶çœ‹åˆ°å…¶ä¸­çš„ä¸€äº›æƒ³æ³•è¢«åˆ«äººè®¤åŒï¼Œé‡æ–°ç¿»å¼€çœ‹çœ‹ï¼Œå…¶ä¸­æ€æƒ³å’Œè§‚ç‚¹ä»å€¼å¾—åå¤æ€è€ƒå’Œå­¦ä¹ ã€‚æˆ‘ä»¬éœ€è¦äº†è§£è¿™ä¸ªä¸–ç•Œï¼Œæ›´éœ€è¦äº†è§£è‡ªå·±ã€‚</p>
<h1 id="â€œæ€è€ƒä»€ä¹ˆâ€å’Œâ€œå¦‚ä½•æ€è€ƒâ€çš„åŒºåˆ«"><a href="#â€œæ€è€ƒä»€ä¹ˆâ€å’Œâ€œå¦‚ä½•æ€è€ƒâ€çš„åŒºåˆ«" class="headerlink" title="â€œæ€è€ƒä»€ä¹ˆâ€å’Œâ€œå¦‚ä½•æ€è€ƒâ€çš„åŒºåˆ«"></a>â€œæ€è€ƒä»€ä¹ˆâ€å’Œâ€œå¦‚ä½•æ€è€ƒâ€çš„åŒºåˆ«</h1><h2 id="2021-11-02å‘è¡¨æƒ³æ³•"><a href="#2021-11-02å‘è¡¨æƒ³æ³•" class="headerlink" title="2021&#x2F;11&#x2F;02å‘è¡¨æƒ³æ³•"></a>2021&#x2F;11&#x2F;02å‘è¡¨æƒ³æ³•</h2><p>æ›¾ä»Šæˆ‘ä¹Ÿçƒ­è¡·äºå‘ä¸“å®¶æˆ–äº‹ä¸šæœ‰æ‰€æˆå°±çš„äººå¯»æ±‚æˆåŠŸçš„ç­”æ¡ˆï¼Œä½†æ˜¯è¿™äº›ç­”æ¡ˆå¾€å¾€å±€é™äºä»–ä»¬è‡ªå·±çš„èƒ½åŠ›åŠæ‰€å¤„ç¯å¢ƒï¼Œå¾ˆå°‘èƒ½å¤Ÿç”¨äºå·±èº«ç­”æ¡ˆï¼Œé‚è½¬è€Œå‘ä¸‹ä¸€ä½æˆåŠŸè€…å¯»æ±‚ç­”æ¡ˆã€‚éšç€ç»å†çš„äº‹æƒ…è¶Šæ¥è¶Šå¤šï¼Œé€æ¸å‘ç°è¿™ç§æ–¹å¼æ˜¯ä¸é€‚å½“çš„ï¼Œä¸åŒçš„äººä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œç»“å±€æ˜¯å¤§ä¸ç›¸åŒçš„ã€‚åæ¥æ€»ç»“æç‚¼é€è¿™äº›äººçš„ç­”æ¡ˆï¼Œä»ä¸­æ‰¾åˆ°äº†ä¸€äº›å…±åŒç‚¹ï¼Œè¿™äº›å…±åŒç‚¹å°±æ˜¯ä¸€äº›åŸåˆ™ï¼Œè€Œå°†è¿™äº›åŸåˆ™åœ¨è‡ªå·±èº«ä¸Šå®è·µï¼Œä¼šæ›´æœ‰æˆæ•ˆã€‚</p>
<blockquote>
<p>å¦‚ä»Šï¼Œæœ‰ä¸€ç¾¤æ‰€è°“çš„ä¸“å®¶åªæ˜¯æä¾›ä¸€äº›ç­”æ¡ˆï¼Œå‘Šè¯‰ä½ å¦‚ä½•è·å¾—å¹¸ç¦å’Œå¯»æ‰¾åˆ°ç”Ÿå‘½çš„æ„ä¹‰ï¼Œä½†æ˜¯è¿™äº›ç­”æ¡ˆæ˜¯å¦é€‚åˆä½ å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚</p>
</blockquote>
<h1 id="ç¬¬ä¸€ç« -çœŸæ­£æ¿€åŠ±ä½ çš„æ˜¯ä»€ä¹ˆ"><a href="#ç¬¬ä¸€ç« -çœŸæ­£æ¿€åŠ±ä½ çš„æ˜¯ä»€ä¹ˆ" class="headerlink" title="ç¬¬ä¸€ç«  çœŸæ­£æ¿€åŠ±ä½ çš„æ˜¯ä»€ä¹ˆ"></a>ç¬¬ä¸€ç«  çœŸæ­£æ¿€åŠ±ä½ çš„æ˜¯ä»€ä¹ˆ</h1><blockquote>
<p>é‚£ä¹ˆï¼ŒçœŸæ­£è®©æˆ‘ä»¬éå¸¸æ»¡æ„å¹¶çˆ±ä¸Šå·¥ä½œçš„å› ç´ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£å°±æ˜¯èµ«èŒ¨ä¼¯æ ¼ç ”ç©¶ä¸­çš„â€œåŠ¨åŠ›å› ç´ â€ã€‚åŠ¨åŠ›å› ç´ åŒ…æ‹¬ï¼šæœ‰æŒ‘æˆ˜æ€§ã€è·å¾—è®¤å¯ã€è´£ä»»æ„Ÿã€ä¸ªäººæˆé•¿ã€‚</p>
</blockquote>
<h2 id="2022-09-03å‘è¡¨æƒ³æ³•"><a href="#2022-09-03å‘è¡¨æƒ³æ³•" class="headerlink" title="2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•</h2><p>å½“æˆ‘ä»¬é™·å…¥ç¼ºé’±çš„ç´§è¿«æ€ç»´ä¹‹åï¼Œä¼šåŠªåŠ›ç”¨å°½ä¸€åˆ‡æ–¹å¼èµšé’±ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­é€æ¸å­¦ä¼šç”¨é’±å»è¡¡é‡ä¸€åˆ‡å¾—å¤±ï¼Œæœ€åå¾—å‡ºä¸€ä¸ªç»“è®ºï¼Œæˆ‘ä»¬ç›®å‰èµšçš„é’±è¿˜ä¸å¤Ÿå¤šï¼Œç­‰æˆ‘ä»¬èµšåˆ°è¶³å¤Ÿå¤šçš„é’±åï¼Œé—®é¢˜å°±ä¼šè§£å†³ã€‚ä½†æ˜¯ç”Ÿæ´»ä¸­çš„å¾ˆå¤šæ¡ˆä¾‹å¹¶å‘Šè¯‰æˆ‘ä»¬äº‹å®å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œäººä¸äººä¹‹é—´çš„å…³ç³»ï¼Œä¸æ˜¯é ç®€å•çš„é‡‘é’±å…³ç³»ç»´æŠ¤çš„ï¼Œè€Œæ˜¯æˆ‘ä»¬éœ€è¦ä»˜å‡ºè¡ŒåŠ¨ã€ä»˜å‡ºç²¾åŠ›å»ç»´ç³»çš„ï¼Œé•¿ä¹…çš„äººé™…å…³ç³»çš„ç–è¿œï¼Œå³ä½¿åæœŸç”¨æ›´å¤šçš„é‡‘é’±ä¹Ÿæ˜¯æ— æ³•æŒ½å›çš„ã€‚èƒŒåæµ…æ˜¾çš„é“ç†æ˜¯äººä»¬æ›´éœ€è¦çš„æ˜¯é›ªä¸­é€ç‚­ï¼Œè€Œä¸æ˜¯é”¦ä¸Šæ·»èŠ±ã€‚</p>
<blockquote>
<p>æˆ‘çš„è§‚ç‚¹å¹¶ä¸æ˜¯è¯´é’±æ˜¯æ²¡æœ‰èŒä¸šå¹¸ç¦æ„Ÿçš„æ ¹æœ¬åŸå› ï¼Œæˆ‘è¦è¯´çš„æ˜¯ï¼Œå½“èµšé’±æˆäº†é«˜äºå…¶ä»–ä¸€åˆ‡äº‹æƒ…çš„é‡ç‚¹æ—¶ï¼Œå½“åŸºç¡€å› ç´ å¾—åˆ°äº†æ»¡è¶³ã€è¿½æ±‚ä»åœç•™åœ¨èµšæ›´å¤šçš„é’±æ—¶ï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚å³ä¾¿æ˜¯ä¸€äº›ä¸“é—¨ä»äº‹è·Ÿé’±æ‰“äº¤é“çš„èŒä¸šï¼Œæ¯”å¦‚åšé”€å”®å‘˜å’Œäº¤æ˜“å‘˜ï¼Œä¹Ÿè¦éµå¾ªåŠ¨åŠ›å› ç´ è§„åˆ™ã€‚åªä¸è¿‡åœ¨è¿™äº›èŒä¸šä¸­ï¼Œé’±æˆäº†è¡¡é‡æˆåŠŸä¸å¦çš„å°ºåº¦ç½¢äº†</p>
</blockquote>
<h2 id="2022-08-30å‘è¡¨æƒ³æ³•"><a href="#2022-08-30å‘è¡¨æƒ³æ³•" class="headerlink" title="2022&#x2F;08&#x2F;30å‘è¡¨æƒ³æ³•"></a>2022&#x2F;08&#x2F;30å‘è¡¨æƒ³æ³•</h2><p>æ¯ä¸ªäººçš„äººç”Ÿç»å†å„ä¸ç›¸åŒï¼Œæ‰€çœ‹é‡çš„ä»·å€¼æ’åºä¹Ÿæ˜¯ä¸åŒçš„ï¼Œä¸è¦æŠŠè‡ªå·±çš„ä»·å€¼è§‚å¼ºåŠ ç»™åˆ«äººï¼Œå­¦ä¼šæ±‚åŒå­˜å¼‚</p>
<blockquote>
<p>æˆ‘ä»¬åº”è¯¥æ˜ç™½ï¼Œä¸æ˜¯æœ‰äº›äººä¸æˆ‘ä»¬æœ‰ä»€ä¹ˆæ ¹æœ¬çš„ä¸åŒï¼Œåªä¸è¿‡æ˜¯äººä»¬è¡¡é‡æ˜¯å¦æœ‰æ„ä¹‰æˆ–å¼€å¿ƒçš„æ ‡å‡†æœ‰å·®å¼‚ï¼Œè¿™ä¸ªç†è®ºå¯¹æ¯ä¸ªäººéƒ½é€‚ç”¨ã€‚</p>
</blockquote>
<h2 id="2022-09-03å‘è¡¨æƒ³æ³•-1"><a href="#2022-09-03å‘è¡¨æƒ³æ³•-1" class="headerlink" title="2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•</h2><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åšå®ŒæŸä»¶äº‹åï¼Œäº‹æƒ…çš„ç»“æœå¹¶ä¸ä¼šè®©æˆ‘ä»¬å…´å¥‹å¾ˆä¹…ï¼Œåè€Œæ˜¯åšäº‹çš„è¿‡ç¨‹è®©æˆ‘ä»¬å°¤å…¶äº«å—ï¼Œè¿™ä¸ªç°è±¡åœ¨é™ªä¼´å°å­©å­ç©è€çš„è¿‡ç¨‹ä¸­æ›´å¸¸è§ã€‚</p>
<blockquote>
<p>æˆ‘åŸæ¥ä»¥ä¸ºé‡è¦çš„æ˜¯ç›®çš„ï¼Œç°åœ¨æ‰å‘ç°è¿‡ç¨‹æ›´é‡è¦</p>
</blockquote>
<h1 id="ç¬¬äºŒç« -å‘¨å¯†è®¡åˆ’ä¸å¶ç„¶æœºä¼šçš„å¹³è¡¡"><a href="#ç¬¬äºŒç« -å‘¨å¯†è®¡åˆ’ä¸å¶ç„¶æœºä¼šçš„å¹³è¡¡" class="headerlink" title="ç¬¬äºŒç«  å‘¨å¯†è®¡åˆ’ä¸å¶ç„¶æœºä¼šçš„å¹³è¡¡"></a>ç¬¬äºŒç«  å‘¨å¯†è®¡åˆ’ä¸å¶ç„¶æœºä¼šçš„å¹³è¡¡</h1><h2 id="2022-09-03å‘è¡¨æƒ³æ³•-2"><a href="#2022-09-03å‘è¡¨æƒ³æ³•-2" class="headerlink" title="2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•</h2><p>å¾ˆå¤šæ—¶å€™ä»…å‡­å€Ÿå¤§è„‘æ€è€ƒï¼Œæ˜¯æ— æ³•å¾—å‡ºé—®é¢˜çš„ç­”æ¡ˆçš„ï¼Œè¿™éœ€è¦æˆ‘ä»¬ä¸æ–­å‘å¤–ç•Œè·å–ä¿¡æ¯ï¼Œæ‰èƒ½åšå‡ºæœ€æœ‰åˆ©çš„åˆ¤æ–­</p>
<blockquote>
<p>éšç€èŒä¸šç»å†çš„ç§¯ç´¯ï¼Œä½ ä¼šæ‰¾åˆ°è‡ªå·±çƒ­çˆ±çš„å·¥ä½œé¢†åŸŸï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨è¿™ä¸ªé¢†åŸŸåšå¾—å¾ˆå‡ºè‰²ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä»¥ä¸ºåªè¦ååœ¨è±¡ç‰™å¡”é‡Œï¼ŒæŠŠé—®é¢˜ä»å¤´åˆ°å°¾ä»”ç»†åœ°è€ƒè™‘ä¸€éï¼Œæœ‰ä¸€å¤©ç­”æ¡ˆå°±ä¼šçªç„¶è·³å‡ºæ¥ï¼Œé‚£ç­‰å¾…ä½ çš„åªä¼šæ˜¯å¤±è´¥</p>
</blockquote>
<h2 id="2022-09-03å‘è¡¨æƒ³æ³•-3"><a href="#2022-09-03å‘è¡¨æƒ³æ³•-3" class="headerlink" title="2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•</h2><p>è¿™ä¸€ç‚¹æ·±æœ‰ä½“ä¼šï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¯¹äºä¸åšé¥­çš„äººæ¥è¯´ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ¯å¤©åƒä»€ä¹ˆå˜æˆäº†ä¸€ä¸ªå›°éš¾çš„é€‰æ‹©é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨å®¶é‡Œçº ç»“è¦åƒä»€ä¹ˆçš„æ—¶å€™ï¼Œä¸å¦‚å…ˆåœˆå®šä¸€ä¸ªèŒƒå›´ï¼Œç„¶åèµ°åˆ°å¤–é¢ï¼Œæ ¹æ®åœˆå®šçš„èŒƒå›´åšå»åšæ’é™¤æ³•ï¼Œå¾ˆå¤šæ—¶å€™å½“æˆ‘ä»¬èµ°åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œé—»åˆ°ä¸€ç§å‘³é“ï¼Œçœ‹åˆ°ä¸€äº›è‰²é¦™å‘³ä¿±å…¨çš„é£Ÿç‰©ï¼Œæˆ‘ä»¬å¿ƒé‡Œå·²ç»çŸ¥é“ä»Šå¤©è¦åƒä»€ä¹ˆäº†ã€‚è€Œæˆ‘ä»¬çš„é€‰æ‹©æœ‰æ—¶å€™ä¼šåœ¨æˆ‘ä»¬çš„é¢„å…ˆåœˆå®šçš„èŒƒå›´å†…ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº›æ–°å‡ºç°çš„é£Ÿç‰©ã€‚è¿™ä¸ªç»“æœæ¯”æˆ‘ä»¬åœ¨å®¶é‡Œçº ç»“è¦åƒä»€ä¹ˆä¼šæ›´æœ‰æ•ˆã€‚</p>
<blockquote>
<p>å‡ ä¹æ‰€æœ‰æˆ˜ç•¥éƒ½æ˜¯å‘¨å¯†æˆ˜ç•¥å’Œæ„å¤–æœºé‡ç»“åˆçš„äº§ç‰©ï¼Œå…³é”®æ˜¯è¦èµ°å‡ºå»ï¼Œå¹¶è¡ŒåŠ¨èµ·æ¥ï¼Œä¸€ç›´åˆ°ä½ æ˜ç™½å°†è‡ªå·±çš„èªæ˜æ‰æ™ºã€å…´è¶£å’Œé‡ç‚¹æ”¾åœ¨å“ªé‡Œã€‚å½“ä½ çœŸæ­£æ‰¾åˆ°äº†é€‚åˆè‡ªå·±çš„å·¥ä½œï¼Œå°±åº”è¯¥ç«‹å³å°†åº”æ€¥æˆ˜ç•¥è½¬åŒ–æˆå‘¨å¯†æˆ˜ç•¥ã€‚</p>
</blockquote>
<h2 id="2022-09-03å‘è¡¨æƒ³æ³•-4"><a href="#2022-09-03å‘è¡¨æƒ³æ³•-4" class="headerlink" title="2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;03å‘è¡¨æƒ³æ³•</h2><p>ä¸ä¹ æƒ¯å»è¡¨ç°è‡ªå·±ï¼Œé‡åˆ°è¡¨ç°çš„æœºä¼šå‘ç°è‡ªå·±æ€»æ˜¯åœ¨é€ƒé¿ï¼Œæ²¡æ³•æ•å¼€å¤§é—¨æ‹¥æŠ±æœºä¼šï¼Œè¿™ä¸€ä¹ æƒ¯éœ€è¦ä¸æ–­å»æ”¹å˜ã€‚</p>
<blockquote>
<p>â€œæˆ‘éšæ—¶ä¼šæ•å¼€å¤§é—¨ï¼Œæ‹¥æŠ±æœºä¼šã€‚â€å½“ç„¶è¿™å¥è¯è¯´èµ·æ¥å®¹æ˜“ï¼Œåšèµ·æ¥å¹¶ä¸ç®€å•</p>
</blockquote>
<h1 id="ç¬¬ä¸‰ç« -ä½ çš„æˆ˜ç•¥ä¸ä½ æ‰€è¯´çš„ä¸€è‡´å—"><a href="#ç¬¬ä¸‰ç« -ä½ çš„æˆ˜ç•¥ä¸ä½ æ‰€è¯´çš„ä¸€è‡´å—" class="headerlink" title="ç¬¬ä¸‰ç«  ä½ çš„æˆ˜ç•¥ä¸ä½ æ‰€è¯´çš„ä¸€è‡´å—"></a>ç¬¬ä¸‰ç«  ä½ çš„æˆ˜ç•¥ä¸ä½ æ‰€è¯´çš„ä¸€è‡´å—</h1><h2 id="2022-09-04å‘è¡¨æƒ³æ³•"><a href="#2022-09-04å‘è¡¨æƒ³æ³•" class="headerlink" title="2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•</h2><p>ä¸€ä¸ªè®¡åˆ’çš„è½åœ°éœ€è¦å……åˆ†è€ƒè™‘å„ç§å› ç´ ï¼Œå¾ˆå¤šæ–¹æ¡ˆçš„å‡ºå‘ç‚¹æ˜¯å¥½çš„ï¼Œä½†æ˜¯åœ¨å®æ–½çš„è¿‡ç¨‹ä¸­æ²¡æœ‰è€ƒè™‘å¥½æ”¿æ²»ã€äººæ–‡ã€åœ°ç†ã€ç¯å¢ƒç­‰å› ç´ ï¼Œæœ€åå¯¼è‡´è®¡åˆ’çš„å¤±è´¥ã€‚åœ¨ä¸­å›½çš„å†å²ä¸Šï¼Œç‹è½æ–°æ”¿ã€ç‹å®‰çŸ³å˜æ³•çš†æ˜¯å¦‚æ­¤ã€‚</p>
<blockquote>
<p>ä¸€è¾¹è¢«å‘ŠçŸ¥ä»€ä¹ˆæ‰æ˜¯é‡ç‚¹ï¼Œä¸€è¾¹åˆè¢«é¼“åŠ±å»åšçœ¼å‰çš„äº‹</p>
</blockquote>
<h2 id="2022-09-04å‘è¡¨æƒ³æ³•-1"><a href="#2022-09-04å‘è¡¨æƒ³æ³•-1" class="headerlink" title="2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•</h2><p>çœ‹ä¸€ä¸ªäººåšäº†ä»€ä¹ˆï¼Œæ¯”å¬ä»–è¦åšä»€ä¹ˆæ›´é‡è¦</p>
<blockquote>
<p>çœ‹ä¸€ä¸ªäººçš„ä»·å€¼è§‚å°±è¦çœ‹ä»–çš„æ”¯ç¥¨ç°¿å­˜æ ¹ï¼Œä»æ”¯ç¥¨å­˜æ ¹ä¸Šå¯ä»¥çœ‹å‡ºä»–èµ„æºåˆ†é…çš„å€¾å‘ï¼Œä»è€Œåˆ¤æ–­è¿™ä¸ªäººçš„ä»·å€¼å–å‘ã€‚æŠŠé’±ç”¨åœ¨äº†å“ªäº›æ–¹é¢ä»æ”¯ç¥¨å­˜æ ¹ä¸Šä¸€çœ‹ä¾¿çŸ¥</p>
</blockquote>
<h2 id="2022-09-04å‘è¡¨æƒ³æ³•-2"><a href="#2022-09-04å‘è¡¨æƒ³æ³•-2" class="headerlink" title="2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•</h2><p>æˆ‘ä»¬å¦‚ä½•åˆ¤æ–­æˆ‘ä»¬å®æ–½çš„æˆ˜ç•¥æ˜¯æˆ‘ä»¬æƒ³è¦çš„å‘¢ï¼Ÿé‚£å°±éœ€è¦çœ‹çœ‹æˆ‘ä»¬çš„èµ„æºé…ç½®ï¼Œæˆ‘ä»¬æ€»æ˜¯å£å£å£°å£°è¯´æˆ‘ä»¬è¦æ€ä¹ˆæ€ä¹ˆåšã€è¦å¦‚ä½•å¦‚ä½•ã€‚ä½†æ˜¯å›è¿‡å¤´æ¥çœ‹ï¼Œæˆ‘ä»¬æ˜¯å¦çœŸæ­£çš„æœ‰æŠŠæ—¶é—´ã€ç²¾åŠ›ã€é‡‘é’±ç”¨åˆ°æˆ‘ä»¬åˆ¶å®šçš„æˆ˜ç•¥ä¸Šå‘¢ï¼Ÿæ‰€ä»¥åˆ†ææˆ‘ä»¬çš„èµ„æºé…ç½®è¿‡ç¨‹å¯¹æˆ‘ä»¬åˆ¤æ–­è‡ªå·±çš„æˆ˜ç•¥å®æ–½éå¸¸é‡è¦ã€‚</p>
<blockquote>
<p>æ€æ ·ç¡®ä¿å®æ–½çš„æˆ˜ç•¥æ˜¯ä½ çœŸæ­£æƒ³è¦çš„å‘¢ï¼Ÿé‚£å°±çœ‹çœ‹ä½ çš„èµ„æºæµå‘å“ªé‡Œå»äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èµ„æºé…ç½®è¿‡ç¨‹æ¥æ¢ç©¶è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚å¦‚æœè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰æ”¯æŒä½ å†³å®šäº†çš„æˆ˜ç•¥ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å‡ºç°ä¸¥é‡é—®é¢˜çš„é£é™©ã€‚æˆ–è®¸ä½ è®¤ä¸ºè‡ªå·±æ˜¯ä¸€ä¸ªä»æ…ˆçš„äººï¼Œä½†æ˜¯ä½ å¤šä¹…æ‰ä¼šæœ‰ä¸€æ¬¡æŠŠæ—¶é—´å’Œé‡‘é’±æŠ•å…¥åˆ°æ…ˆå–„äº‹ä¸šæˆ–æ…ˆå–„ç»„ç»‡çš„ç»å†å‘¢ï¼Ÿå¦‚æœå®¶åº­å¯¹ä½ æ˜¯æœ€é‡è¦çš„ï¼Œå½“ä½ è€ƒè™‘åœ¨å„ç§è‡ªç”±æ”¯é…çš„æ—¶é—´ï¼ˆæˆ–éè‡ªç”±æ”¯é…çš„æ—¶é—´ï¼‰é‡Œåšé€‰æ‹©æ—¶ï¼Œå¯¹å®¶äººçš„è€ƒè™‘æ˜¯ä¸æ˜¯ä½ çš„ä¼˜å…ˆé€‰æ‹©å‘¢ï¼Ÿå¦‚æœä½ åšäº†å†³å®šï¼Œæƒ³æŠŠè¡€æ±—å’Œçœ¼æ³ªæŠ•å…¥åˆ°æŸä¸ªæ–¹é¢ï¼Œä½†è¿™ä¸ä½ æ¸´æœ›å˜æˆçš„äººä¸ç›¸ç¬¦ï¼Œä½ å°±æ— æ³•æˆä¸ºä½ æ¸´æœ›å˜æˆçš„é‚£ä¸ªäººã€‚</p>
</blockquote>
<h1 id="PART-2-å¦‚ä½•ç¡®å®šä¸äº²æœ‹å¥½å‹çš„å…³ç³»æ˜¯ä½ å¹¸ç¦çš„æºæ³‰"><a href="#PART-2-å¦‚ä½•ç¡®å®šä¸äº²æœ‹å¥½å‹çš„å…³ç³»æ˜¯ä½ å¹¸ç¦çš„æºæ³‰" class="headerlink" title="PART 2 å¦‚ä½•ç¡®å®šä¸äº²æœ‹å¥½å‹çš„å…³ç³»æ˜¯ä½ å¹¸ç¦çš„æºæ³‰"></a>PART 2 å¦‚ä½•ç¡®å®šä¸äº²æœ‹å¥½å‹çš„å…³ç³»æ˜¯ä½ å¹¸ç¦çš„æºæ³‰</h1><h2 id="2022-09-04å‘è¡¨æƒ³æ³•-3"><a href="#2022-09-04å‘è¡¨æƒ³æ³•-3" class="headerlink" title="2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•</h2><p>å¯¹äºæˆ‘ä»¬å·¥ä½œä¸­æ‰€è·å¾—çš„æˆå°±æ„Ÿï¼Œæœ€åè¿˜æ˜¯è¦æºè‡ªä½ å‘¨å›´çš„äººå¯¹ä½ çš„è®¤åŒï¼Œæ‰€ä»¥ä»é•¿è¿œæ¥çœ‹ï¼Œä½ çš„äººé™…å…³ç³»æ¯”ä½ çš„æˆå°±æ›´ä¸ºé‡è¦</p>
<blockquote>
<p>å·¥ä½œèƒ½ç»™ä½ å¸¦æ¥æˆå°±æ„Ÿï¼Œä½†æ˜¯ä¸å®¶äººã€å¥½å‹åŸ¹å…»å‡ºçš„äº²å¯†å…³ç³»å¸¦ç»™æˆ‘ä»¬çš„é•¿ä¹…å¹¸ç¦æ„Ÿç›¸æ¯”ï¼Œå°±ä¼šæ˜¾å¾—å¾ˆè‹ç™½</p>
</blockquote>
<h2 id="2022-09-04å‘è¡¨æƒ³æ³•-4"><a href="#2022-09-04å‘è¡¨æƒ³æ³•-4" class="headerlink" title="2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•</h2><p>å½“æˆ‘ä»¬åšé”™æŸäº‹å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¤±è´¥äº†ï¼Œåªæ˜¯è¯´æ˜æˆ‘ä»¬æ›¾å°†é¢„æƒ³çš„æŸäº›äº‹æƒ…æ˜¯è¡Œä¸é€šçš„ï¼Œæ‰€ä»¥æ‰ä¼šå°è¯•å…¶ä»–æ–¹æ³•ã€‚</p>
<blockquote>
<p>å¦‚æœè¯¦ç»†çœ‹è¿‡æˆ‘ä»¬å…³äºåº”æ€¥æˆ˜ç•¥å’Œå‘¨å¯†æˆ˜ç•¥çš„è®¨è®ºâ€”â€”åœ¨è®¡åˆ’å’Œæ„å¤–æœºé‡ä¹‹é—´æ‰¾åˆ°å¹³è¡¡â€”â€”é‚£ä¹ˆä½ å°±ä¼šçŸ¥é“åŠé”™æŸäº‹å¹¶ä¸æ„å‘³ç€å¤±è´¥ã€‚ç›¸åï¼Œä½ åªæœ‰çŸ¥é“äº†ä»€ä¹ˆä¸œè¥¿è¡Œä¸é€šï¼Œæ‰ä¼šå»å°è¯•åˆ«çš„åŠæ³•ã€‚</p>
</blockquote>
<h1 id="ç¬¬å››ç« -æ—¶å…‰åœ¨æµé€ï¼Œè€Œä½ ä¸¢å¤±äº†ä»€ä¹ˆ"><a href="#ç¬¬å››ç« -æ—¶å…‰åœ¨æµé€ï¼Œè€Œä½ ä¸¢å¤±äº†ä»€ä¹ˆ" class="headerlink" title="ç¬¬å››ç«  æ—¶å…‰åœ¨æµé€ï¼Œè€Œä½ ä¸¢å¤±äº†ä»€ä¹ˆ"></a>ç¬¬å››ç«  æ—¶å…‰åœ¨æµé€ï¼Œè€Œä½ ä¸¢å¤±äº†ä»€ä¹ˆ</h1><h2 id="2022-09-04å‘è¡¨æƒ³æ³•-5"><a href="#2022-09-04å‘è¡¨æƒ³æ³•-5" class="headerlink" title="2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;04å‘è¡¨æƒ³æ³•</h2><p>åœ¨é•¿è¿œæˆ˜ç•¥å‘å±•ä¸­ï¼Œå¾ˆå°‘æœ‰èƒ½å¤ŸæŒ‰ç…§åŸè®¡åˆ’å®Œæˆçš„</p>
<blockquote>
<p>æ¢è¨€ä¹‹ï¼ŒæˆåŠŸçš„ä¼ä¸šå¹¶éä¸€å¼€å§‹å°±ç…§ç€æ­£ç¡®çš„ç­–ç•¥æ¨è¿›æ‰æˆåŠŸçš„ï¼Œè€Œæ˜¯æœ€åˆç­–ç•¥å¤±è´¥ä¹‹åï¼Œè¿˜æœ‰å¤šä½™çš„é’±å¯ä»¥å°è¯•å…¶ä»–åšæ³•ã€‚åä¹‹ï¼Œå¤§å¤šæ•°å¤±è´¥çš„ä¼ä¸šä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰é’±æŠ•æ³¨åœ¨æœ€åˆçš„ç­–ç•¥ä¸Šï¼Œå°±åƒæŠŠæ‰€æœ‰é¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œä¸€æ ·ï¼Œå‘ç°ç­–ç•¥é”™è¯¯æ—¶ï¼Œå·²æ— æ³•æŒ½æ•‘æˆ–é‡æ–°å¼€å§‹ã€‚</p>
</blockquote>
<h1 id="ç¬¬äº”ç« -å¥¶æ˜”è¢«é›‡æ¥åšä»€ä¹ˆ"><a href="#ç¬¬äº”ç« -å¥¶æ˜”è¢«é›‡æ¥åšä»€ä¹ˆ" class="headerlink" title="ç¬¬äº”ç«  å¥¶æ˜”è¢«é›‡æ¥åšä»€ä¹ˆ"></a>ç¬¬äº”ç«  å¥¶æ˜”è¢«é›‡æ¥åšä»€ä¹ˆ</h1><blockquote>
<p>äººä¹‹æ‰€æ¬²ï¼Œæ–½ä¹‹äºäººâ€æ‰æ˜¯æ­£ç¡®çš„æ–¹æ³•</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•"><a href="#2022-09-05å‘è¡¨æƒ³æ³•" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>çŸ¥é“å¯¹æ–¹æƒ³è¦ä»€ä¹ˆï¼Œæ¯”æˆ‘ä»¬å…¨èº«å¿ƒçš„ä»˜å‡ºæ›´é‡è¦ã€‚æ‰€ä»¥åœ¨å‘æˆ‘ä»¬æ‰€çˆ±çš„äººä»˜å‡ºæ—¶ï¼Œä¸€å®šè¦å…ˆææ¸…æ¥šä»–ä»¬çš„çœŸæ­£æƒ³è¦ä»€ä¹ˆï¼Œè‡ªæˆ‘æ„ŸåŠ¨å¼çš„ä»˜å‡ºå¾€å¾€å¿½ç•¥çš„å¯¹æ–¹çš„æ„Ÿå—ï¼Œæœ€ååè€Œå¯¼è‡´å…³ç³»çš„æ¶åŒ–ã€‚</p>
<blockquote>
<p>å¸Œæœ›ä½ çˆ±çš„äººè¿‡å¾—å¹¸ç¦ï¼Œè¿™æ˜¯è‡ªç„¶çš„äº‹æƒ…ï¼Œä½†å¾€å¾€éš¾å°±éš¾åœ¨æˆ‘ä»¬ä¸çŸ¥é“åº”è¯¥åœ¨å…¶ä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ã€‚è¦äº†è§£å¯¹ä½ æœ€åœ¨ä¹çš„äººè€Œè¨€ä»€ä¹ˆä¸œè¥¿æœ€é‡è¦ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯ä»â€œéœ€è¦å®Œæˆçš„å·¥ä½œâ€è§’åº¦å»è€ƒè™‘ï¼Œå®ƒèƒ½ä½¿ä½ å‘å±•å‡ºçœŸæ­£çš„åŒæƒ…ã€‚é—®é—®è‡ªå·±ï¼šâ€œæˆ‘çš„ä¼´ä¾£æœ€éœ€è¦æˆ‘åšçš„æ˜¯ä»€ä¹ˆï¼Ÿâ€è¿™ä¼šç»™ä½ æä¾›ä»æ­£ç¡®è§’åº¦åˆ†æé—®é¢˜çš„èƒ½åŠ›ã€‚å½“ä½ ä»è¿™ç§è§’åº¦å¤„ç†äººé™…å…³ç³»æ—¶ï¼Œç­”æ¡ˆä¼šæ›´æ¸…æ™°ï¼Œæ¯”åªæ˜¯æ¨æµ‹æ€ä¹ˆåšæ‰å¯¹è¦æ¸…æ™°å¾—å¤š</p>
</blockquote>
<h1 id="ç¬¬å…­ç« -ä½ çš„å­©å­è¿˜æ˜¯ä½ çš„å—"><a href="#ç¬¬å…­ç« -ä½ çš„å­©å­è¿˜æ˜¯ä½ çš„å—" class="headerlink" title="ç¬¬å…­ç«  ä½ çš„å­©å­è¿˜æ˜¯ä½ çš„å—"></a>ç¬¬å…­ç«  ä½ çš„å­©å­è¿˜æ˜¯ä½ çš„å—</h1><h2 id="2022-09-05å‘è¡¨æƒ³æ³•-1"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-1" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>è¦æ¸…æ¥šè‡ªå·±çš„èƒ½åŠ›ï¼Œæ›´è¦æ¸…æ¥šä»€ä¹ˆæ˜¯æˆ‘ä»¬æ ¸å¿ƒçš„æ”¯æŸ±åŠ›é‡ã€‚</p>
<blockquote>
<p>è¦æ¸…æ¥šè‡ªå·±çš„èƒ½åŠ›ã€‚ä½ éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯èƒ½åŠ›ï¼Œå“ªä¸ªå¯¹ä½ çš„æœªæ¥è€Œè¨€æ›´å…³é”®ï¼ŒçŸ¥é“å“ªä¸ªåº”è¯¥è‡ªå·±ä¿ç•™ï¼Œå“ªä¸ªä¸å¤ªé‡è¦</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•-2"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-2" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>èµ„æºæ˜¯æœ€åŸºæœ¬çš„é©±åŠ¨åŠ›</p>
<blockquote>
<p>è®¸å¤šäººè®¤ä¸ºèµ„æºæ˜¯ä½¿ä¼ä¸šå–å¾—æˆåŠŸçš„åŸå› ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºèµ„æºä»…æ˜¯é©±åŠ¨ä¼ä¸šçš„ä¸‰ä¸ªå…³é”®å› ç´ ä¹‹ä¸€</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•-3"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-3" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>å¤–åŒ…ç¼ºå¤±å¯ä»¥è¿…é€Ÿè·å–è½»æ¾è·å–åˆ©ç›Šï¼Œä½†æ˜¯ä¹Ÿä¼šè®©æˆ‘ä»¬å¤±å»ä¸€äº›èƒ½åŠ›ï¼Œæ‰€ä»¥å¿…é¡»æ¸…æ¥šæˆ‘ä»¬å¿…é¡»è¦å…·å¤‡çš„èƒ½åŠ›èŒƒå›´ï¼Œæ–¹èƒ½ç¡®å®šæ˜¯å¦è¦å°†è¿™é¡¹ä¸šåŠ¡è¿›è¡Œå¤–åŒ…ã€‚</p>
<blockquote>
<p>å°†æµç¨‹å¤–åŒ…å—åˆ°é‡‘èå®¶ã€å’¨è¯¢é¡¾é—®ä»¥åŠä¸€äº›å­¦è€…çš„é¼“åŠ±ï¼Œä»–ä»¬çœ‹åˆ°çš„æ˜¯é€šè¿‡å¤–åŒ…å¯ä»¥è¿…é€Ÿä¸”è½»æ¾åœ°è·å¾—åˆ©ç›Šï¼Œä½†æ˜¯ä»–ä»¬çœ‹ä¸åˆ°å¤–åŒ…çš„æˆæœ¬â€”â€”å®ƒä¼šä½¿ä¼ä¸šå¤±å»ä¸€äº›èƒ½åŠ›</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•-4"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-4" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>å¯¹äºå­©å­æ¥è¯´ï¼Œå­¦ä¼šå­¦ä¹ çš„æ–¹å¼ï¼Œæ¯”å­¦åˆ°çŸ¥è¯†æœ¬èº«æ›´é‡è¦ã€‚æŒæ¡å­¦ä¹ çš„æ–¹å¼åï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¿«æ›´è½»æ¾çš„å­¦ä¼šä»»ä½•çŸ¥è¯†ï¼ŒæŒ‘æˆ˜å›°éš¾ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ä»…ä»…å­¦ä¼šçŸ¥è¯†æœ¬èº«ï¼Œæ˜¯ä¸è¶³ä»¥åº”å¯¹æœªæ¥æ›´åºå¤§ã€æ›´å¤æ‚çš„çŸ¥è¯†çš„ã€‚ä»å°åŸ¹å…»å­©å­çš„å­¦ä¹ èƒ½åŠ›å°¤å…¶é‡è¦ã€‚</p>
<blockquote>
<p>å­©å­ä»¬ä»è¿™äº›æ´»åŠ¨ä¸­åŸ¹å…»äº†è¯¸å¦‚å›¢é˜Ÿç²¾ç¥ã€ä¼ä¸šå®¶ç²¾ç¥ï¼Œä»¥åŠé¢†æ‚Ÿåˆ°åšäº‹åº”è¯¥äº‹å…ˆæœ‰æ‰€å‡†å¤‡äº†å—ï¼Ÿè¿˜æ˜¯ä»–ä»¬ä»…ä»…æ˜¯åº”ä»˜äº†äº‹ï¼Ÿå½“æˆ‘ä»¬ä¸“æ³¨äºä¸ºå­©å­æä¾›èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é—®è‡ªå·±ä¸€äº›é—®é¢˜ï¼šæˆ‘çš„å­©å­æŒæ¡äº†åŸ¹å…»æ–°æŠ€èƒ½çš„æ–¹æ³•äº†å—ï¼Ÿå­¦åˆ°å‘å±•æ›´åŠ æ·±å…¥æ¢ç´¢çŸ¥è¯†çš„èƒ½åŠ›äº†å—ï¼ŸæŒæ¡äº†ä»ç»å†ä¸­è·å–ç»éªŒçš„æ–¹æ³•äº†å—ï¼Ÿè¿™äº›å¯¹äºåŸ¹å…»å­©å­çš„â€œåº”ç”¨æµç¨‹â€èƒ½åŠ›æ˜¯éå¸¸é‡è¦çš„ã€‚åŸºäºæ­¤ï¼Œæˆ‘æœ€æ‹…å¿ƒçš„æ˜¯å®¶åº­çš„å¤–åŒ…</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•-5"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-5" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>çˆ¶æ¯çš„ç¾å¥½æ„å›¾å¯¼è‡´çš„æœ€ç»ˆç»“æœå°±æ˜¯ï¼šå­©å­ä»¬åœ¨æˆé•¿è¿‡ç¨‹ä¸­å¾ˆå°‘æœ‰æœºä¼šæ‹…è´Ÿé‡è¦çš„è´£ä»»ï¼Œä¹Ÿå¾ˆå°‘æœ‰æœºä¼šèƒ½ä¸ºè‡ªå·±æˆ–ä»–äººè§£å†³å¤æ‚çš„é—®é¢˜</p>
<blockquote>
<p>å­©å­ä»¬åœ¨æˆé•¿è¿‡ç¨‹ä¸­å¾ˆå°‘æœ‰æœºä¼šæ‹…è´Ÿé‡è¦çš„è´£ä»»ï¼Œä¹Ÿå¾ˆå°‘æœ‰æœºä¼šèƒ½ä¸ºè‡ªå·±æˆ–ä»–äººè§£å†³å¤æ‚çš„é—®é¢˜</p>
</blockquote>
<blockquote>
<p>å›é¡¾æˆ‘çš„ç”Ÿæ´»æ—¶ï¼Œæˆ‘æ„è¯†åˆ°çˆ¶æ¯ç»™æˆ‘æœ€å¥½çš„ç¤¼ç‰©ä¸æ˜¯ä»–ä»¬ä¸ºæˆ‘åšäº†ä»€ä¹ˆï¼Œè€Œæ˜¯ä»–ä»¬æ²¡æœ‰ä¸ºæˆ‘åšä»€ä¹ˆ</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•-6"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-6" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>å­©å­ä»¬åœ¨è‡ªå·±å‡†å¤‡å¥½å­¦ä¹ æ—¶æ‰èƒ½å­¦åˆ°ä¸œè¥¿ï¼Œè€Œä¸æ˜¯åœ¨æˆ‘ä»¬å‡†å¤‡å¥½æ•™å¯¼ä»–ä»¬çš„æ—¶å€™</p>
<blockquote>
<p>å­©å­ä»¬åœ¨è‡ªå·±å‡†å¤‡å¥½å­¦ä¹ æ—¶æ‰èƒ½å­¦åˆ°ä¸œè¥¿ï¼Œè€Œä¸æ˜¯åœ¨æˆ‘ä»¬å‡†å¤‡å¥½æ•™å¯¼ä»–ä»¬çš„æ—¶å€™</p>
</blockquote>
<h2 id="2022-09-05å‘è¡¨æƒ³æ³•-7"><a href="#2022-09-05å‘è¡¨æƒ³æ³•-7" class="headerlink" title="2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;05å‘è¡¨æƒ³æ³•</h2><p>ä¸€ä¸ªäººä»·å€¼å–å‘çš„æˆé•¿æ˜¯äººç”Ÿä¸­æœ€å®è´µçš„ä¸œè¥¿</p>
<blockquote>
<p>å­©å­ä»¬ä¼šåœ¨è‡ªå·±å‡†å¤‡å¥½å­¦ä¹ çš„æ—¶å€™å­¦ä¹ ï¼Œè€Œä¸æ˜¯åœ¨ä½ å‡†å¤‡å¥½æ•™ä»–ä»¬çš„æ—¶å€™ï¼›å¦‚æœå½“ä»–ä»¬é‡åˆ°ç”Ÿæ´»ä¸­çš„æŒ‘æˆ˜æ—¶ä½ æ²¡æœ‰åœ¨ä»–ä»¬èº«è¾¹ï¼Œé‚£ä¹ˆä½ å°±å¤±å»äº†å¡‘é€ ä»–ä»¬çš„ä»·å€¼å–å‘çš„é‡è¦æœºä¼š</p>
</blockquote>
<h1 id="ç¬¬ä¸ƒç« -ç»éªŒå­¦æ ¡"><a href="#ç¬¬ä¸ƒç« -ç»éªŒå­¦æ ¡" class="headerlink" title="ç¬¬ä¸ƒç«  ç»éªŒå­¦æ ¡"></a>ç¬¬ä¸ƒç«  ç»éªŒå­¦æ ¡</h1><h2 id="2022-09-07å‘è¡¨æƒ³æ³•"><a href="#2022-09-07å‘è¡¨æƒ³æ³•" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>èƒ½åŠ›æ˜¯ä»ç»å†ä¸­è·å–çš„ï¼Œè¿™äº›ç»å†æˆ–è®¸æˆåŠŸï¼Œæˆ–è®¸å¤±è´¥ã€‚</p>
<blockquote>
<p>ä»–è®¤ä¸ºç®¡ç†èƒ½åŠ›æ˜¯åœ¨ç”Ÿæ´»ä¸­åŸ¹å…»å’Œå¡‘é€ çš„ã€‚ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ã€ä¸€æ¬¡é¢†å¯¼é¡¹ç›®çš„å¤±è´¥ã€ä¸€æ¬¡æ–°é¢†åŸŸçš„ä»»åŠ¡ï¼Œéƒ½æ˜¯ç»éªŒå­¦æ ¡çš„â€œè¯¾ç¨‹â€ã€‚é¢†å¯¼è€…å…·æœ‰æˆ–è€…ç¼ºä¹çš„æŠ€èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºä»–ä»¬ä¸Šè¿‡æˆ–è€…æ²¡ä¸Šè¿‡çš„â€œè¯¾ç¨‹â€ã€‚</p>
</blockquote>
<h2 id="2022-09-07å‘è¡¨æƒ³æ³•-1"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-1" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>ä¸è¦æŠ¢å¤ºå­©å­æ‰‹ä¸­çš„æ–¹å‘ç›˜ï¼Œå› ä¸ºç»ˆæœ‰ä¸€å¤©çˆ¶æ¯éœ€è¦æ”¾æ‰‹ï¼Œè¿‡å¤šçš„ä»‹å…¥åè€Œä¼šè®©å­©å­æ²¡æœ‰è‡ªå·±çš„æ€æƒ³ï¼Œæœ€åè„±ç¦»çˆ¶æ¯åæ— æ‰€é€‚ä»ã€‚</p>
<blockquote>
<p>å®é™…ä¸Šï¼Œå¯¹äºè®¸å¤šå®¶é•¿æ¥è¯´ï¼Œä»¥è‡ªå·±çš„ä»‹å…¥æ¥ç¡®ä¿å­©å­ä»¬æ€»èƒ½å–å¾—æˆåŠŸæ˜¯ä¸€ä»¶è¯±äººçš„äº‹ï¼Œä½†æ˜¯å¯¹äºå­©å­æ¥è¯´ï¼Œä»–ä»¬ä»ä¸­å¾—åˆ°äº†ä»€ä¹ˆå‘¢ï¼Ÿ</p>
</blockquote>
<h1 id="ç¬¬å…«ç« -å®¶åº­ä¸­é‚£åªçœ‹ä¸è§çš„æ‰‹â€”â€”å®¶åº­æ–‡åŒ–"><a href="#ç¬¬å…«ç« -å®¶åº­ä¸­é‚£åªçœ‹ä¸è§çš„æ‰‹â€”â€”å®¶åº­æ–‡åŒ–" class="headerlink" title="ç¬¬å…«ç«  å®¶åº­ä¸­é‚£åªçœ‹ä¸è§çš„æ‰‹â€”â€”å®¶åº­æ–‡åŒ–"></a>ç¬¬å…«ç«  å®¶åº­ä¸­é‚£åªçœ‹ä¸è§çš„æ‰‹â€”â€”å®¶åº­æ–‡åŒ–</h1><h2 id="2022-09-07å‘è¡¨æƒ³æ³•-2"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-2" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>æ–‡åŒ–ï¼Œæ˜¯äººä»¬æœç€ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ä¸€èµ·å·¥ä½œçš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸€ç›´ä»¥æ¥è¢«å¤§å®¶æ‰€æ²¿ç”¨å¹¶ä¸”ä¸€ç›´è¡Œä¹‹æœ‰æ•ˆï¼Œä»¥è‡³äºäººä»¬æ ¹æœ¬ä¸ä¼šæƒ³åˆ°è¦ä»¥å¦ä¸€ç§æ–¹å¼å»åšäº‹ã€‚ç‰¹å®šæ–‡åŒ–ä¸€ç»å½¢æˆï¼Œäººä»¬å°±è‡ªåŠ¨åœ°å»åšè¦å–å¾—æˆåŠŸéœ€è¦åšçš„äº‹</p>
<blockquote>
<p>æ–‡åŒ–ï¼Œæ˜¯äººä»¬æœç€ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ä¸€èµ·å·¥ä½œçš„æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸€ç›´ä»¥æ¥è¢«å¤§å®¶æ‰€æ²¿ç”¨å¹¶ä¸”ä¸€ç›´è¡Œä¹‹æœ‰æ•ˆï¼Œä»¥è‡³äºäººä»¬æ ¹æœ¬ä¸ä¼šæƒ³åˆ°è¦ä»¥å¦ä¸€ç§æ–¹å¼å»åšäº‹ã€‚ç‰¹å®šæ–‡åŒ–ä¸€ç»å½¢æˆï¼Œäººä»¬å°±è‡ªåŠ¨åœ°å»åšè¦å–å¾—æˆåŠŸéœ€è¦åšçš„äº‹</p>
</blockquote>
<h1 id="ç¬¬ä¹ç« -ä»…æ­¤ä¸€æ¬¡çš„é”™è¯¯"><a href="#ç¬¬ä¹ç« -ä»…æ­¤ä¸€æ¬¡çš„é”™è¯¯" class="headerlink" title="ç¬¬ä¹ç«  ä»…æ­¤ä¸€æ¬¡çš„é”™è¯¯"></a>ç¬¬ä¹ç«  ä»…æ­¤ä¸€æ¬¡çš„é”™è¯¯</h1><h2 id="2022-09-07å‘è¡¨æƒ³æ³•-3"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-3" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>çŸ­æœŸåˆ©ç›Šä¸é•¿æœŸåˆ©ç›Šçš„æŠ‰æ‹©éœ€è¦å“è¶Šçš„åˆ¤æ–­åŠ›ã€‚</p>
<blockquote>
<p>å¦‚æœä½ éœ€è¦ä¸€å°æœºå™¨ï¼Œä½†æ˜¯ä½ ä¸æ„¿æ„è´­ä¹°å®ƒï¼Œé‚£ä¹ˆæœ€ç»ˆä½ ä¼šå‘ç°ï¼Œä½ ä»˜äº†è¶³ä»¥è´­ä¹°å®ƒçš„é’±å´æ²¡æœ‰æ‹¥æœ‰å®ƒ</p>
</blockquote>
<h2 id="2022-09-07å‘è¡¨æƒ³æ³•-4"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-4" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>â€œä»…æ­¤ä¸€æ¬¡â€å¦‚åŒåƒé‡Œä¹‹å ¤æºƒäºèšç©´ä¹‹ä¸­çš„èšç©´ï¼Œçœ‹ä¼¼å¾®ä¸è¶³é“ï¼Œå®åˆ™æ˜¯è‡´å‘½çš„å±é™©ã€‚</p>
<blockquote>
<p>ä»¥100%çš„åšæŒæ¥ä¿æŒåŸåˆ™è¦æ¯”ä»¥98%çš„åšæŒæ¥ä¿æŒå®ƒæ›´å®¹æ˜“å®ç°ã€‚å¦‚æœä½ ä»æœªè¶Šç•Œï¼Œé‚£ä¹ˆä½ çš„é“å¾·ç•Œé™å°±è¶³å¤Ÿå¼ºå¤§ï¼›å¦‚æœä½ ç ´ä¾‹ä¸€æ¬¡ï¼Œé‚£ä¹ˆæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ä½ ä¸€è€Œå†å†è€Œä¸‰åœ°ç ´ä¾‹</p>
</blockquote>
<h2 id="2022-09-07å‘è¡¨æƒ³æ³•-5"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-5" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>ä¸€ä¸ªåœ†ä¸Šä»»æ„ä¸€ä¸ªç‚¹è¢«æ“¦å»åï¼Œå³ä½¿è¿™ä¸ªç‚¹å†å°ï¼Œè¿™ä¸ªåœ†å·²ç»ä¸æ˜¯ä¸€ä¸ªå®Œæˆçš„åœ†äº†ï¼Œè€Œæ˜¯ä¸€æ¡æ›²çº¿ï¼Œè¿™æ˜¯ä¸€ç§è´¨çš„æ”¹å˜ã€‚</p>
<blockquote>
<p>é¿å…äººç”Ÿä¸­å‡ºç°é“å¾·è®©æ­¥å¸¦æ¥çš„åæœçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯åšå†³ä¸è®©å®ƒå¼€å§‹â€”â€”è·¨è¿‡åº•çº¿çš„ç¬¬ä¸€æ­¥å°±æ˜¯ä½¿ä½ èµ°ä¸Šåæ‚”é“è·¯çš„é‚£ä¸€æ­¥ã€‚é¿å…è‡ªå·±åæ‚”çš„æœ€å¥½åŠæ³•æ˜¯ä»€ä¹ˆï¼Ÿé‚£å°±æ˜¯å¤šå¹´å‰ï¼Œå½“ä½ ç¬¬ä¸€æ¬¡é¢ä¸´é€‰æ‹©æ—¶ï¼Œä¸è¦è·¨å‡ºç¬¬ä¸€æ­¥</p>
</blockquote>
<h2 id="2022-09-07å‘è¡¨æƒ³æ³•-6"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-6" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>é¢ä¸´å›°å¢ƒçš„æ—¶å€™æˆ‘ä»¬ä¸€é€€å†é€€ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡åŸåˆ™çš„åº•çº¿ï¼Œä¸€æ—¦è¶…è¿‡ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ›¾ç»çš„æˆ‘ä»¬ã€‚</p>
<blockquote>
<p>é¢ä¸´é€‰æ‹©æ—¶ï¼Œæƒ³è±¡ä½ æ‰€åšçš„æ¯ä¸ªå†³å®šéƒ½ç¬¦åˆå½“åˆä¸‹å®šå†³å¿ƒè¦æ°¸è¿œåšæŒçš„åŸåˆ™ï¼Œå¯ä»¥æ›´å®¹æ˜“é˜»æ­¢ä½ åšå‡ºæœ€ç»ˆè®©è‡ªå·±åæ‚”çš„å†³å®šã€‚</p>
</blockquote>
<h1 id="ç»“æŸè¯­-ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿ"><a href="#ç»“æŸè¯­-ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿ" class="headerlink" title="ç»“æŸè¯­ ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿ"></a>ç»“æŸè¯­ ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿ</h1><h2 id="2022-09-07å‘è¡¨æƒ³æ³•-7"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-7" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>æ²¡æœ‰è®¤çœŸè€ƒè™‘ç›®æ ‡å’Œä½¿å‘½å¯èƒ½æ˜¯å¯¼è‡´ä¼ä¸šæŒ«æŠ˜å’Œå¤±è´¥æœ€é‡è¦çš„åŸå› ã€‚æ²¡æœ‰è®¤è¯è€ƒè™‘äººç”Ÿçš„ç›®æ ‡å’Œä½¿å‘½ï¼ŒåŒæ ·ä¼šå¯¼è‡´é™·å…¥è®¤è¯†å’Œé”™åˆ™çš„äººç”Ÿï¼Œæœ€åéšæ³¢é€æµã€‚</p>
<blockquote>
<p>æ²¡æœ‰è®¤çœŸè€ƒè™‘ç›®æ ‡å’Œä½¿å‘½å¯èƒ½æ˜¯å¯¼è‡´ä¼ä¸šæŒ«æŠ˜å’Œå¤±è´¥æœ€é‡è¦çš„åŸå› </p>
</blockquote>
<h1 id="å¦‚ä½•ç¡®å®šä½ çš„äººç”Ÿç›®æ ‡"><a href="#å¦‚ä½•ç¡®å®šä½ çš„äººç”Ÿç›®æ ‡" class="headerlink" title="å¦‚ä½•ç¡®å®šä½ çš„äººç”Ÿç›®æ ‡"></a>å¦‚ä½•ç¡®å®šä½ çš„äººç”Ÿç›®æ ‡</h1><h2 id="2022-09-07å‘è¡¨æƒ³æ³•-8"><a href="#2022-09-07å‘è¡¨æƒ³æ³•-8" class="headerlink" title="2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•"></a>2022&#x2F;09&#x2F;07å‘è¡¨æƒ³æ³•</h2><p>äººç”Ÿç¼ºå°‘ç›®æ ‡æ—¶ï¼Œåˆ™ç¼ºå°‘åŠ¨åŠ›ã€‚</p>
<blockquote>
<p>åŒæ ·é“ç†ï¼Œè¦å°†æœ¬ä¹¦ä¸­å»ºè®®çš„ä»·å€¼æœ€å¤§åŒ–ï¼Œä½ å¿…é¡»ä¸ºè‡ªå·±çš„äººç”Ÿè®¾å®šç›®æ ‡</p>
</blockquote>
<h1 id="å†™åœ¨æœ€åçš„è¯"><a href="#å†™åœ¨æœ€åçš„è¯" class="headerlink" title="å†™åœ¨æœ€åçš„è¯"></a>å†™åœ¨æœ€åçš„è¯</h1><p>å›é¡¾è‡ªå·±çœŸæœ¬ä¹¦çš„ç¬”è®°ï¼Œè¢«è‡ªå·±æ›¾ç»å†™ä¸‹çš„æƒ³æ³•éœ‡æƒŠã€‚äººç”Ÿæ˜¯å¿™ç¢Œçš„ï¼Œæˆ‘ä»¬æ¯å¤©è¦å¿™ç€åšå„ç§å„æ ·çš„äº‹ï¼ŒåŒæ—¶ä¹Ÿé”™è¿‡äº†å¾ˆå¤šæƒ³è¦åšçš„äº‹ã€‚äººç”Ÿå¾ˆé•¿ï¼Œå¯ä»¥æœ‰ä¸€è¾ˆå­çš„å…‰é˜´å»æŒ¥éœå»äº«å—ï¼›äººç”Ÿä¹Ÿå¾ˆçŸ­ï¼Œæš®ç„¶å›é¦–æœ‹å‹å’Œäº²äººå·²ç»åˆ°äº†è¯´å‘Šåˆ«çš„æ—¶å€™äº†ã€‚åœ¨æˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬æ˜¯å¦æ¸…æ™°äº†è‡ªå·±äººç”Ÿçš„ç›®æ ‡ï¼Ÿåˆè¯¥å¦‚ä½•åŠªåŠ›å®ç°æˆ‘ä»¬äººç”Ÿçš„ç›®æ ‡ï¼Ÿå½“ç”Ÿå‘½è¡Œè‡³å°½å¤´æ—¶ä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿï¼Ÿ</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>ã€Šä½ è¦å¦‚ä½•è¡¡é‡ä½ çš„äººç”Ÿã€‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ŠåŸç”Ÿå®¶åº­ã€‹</title>
    <url>/2021/02/11/book/yuan-sheng-jia-ting/</url>
    <content><![CDATA[<p><img src="/images/%E5%8E%9F%E7%94%9F%E5%AE%B6%E5%BA%AD.jpeg" alt="åŸç”Ÿå®¶åº­"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><em><strong>ã€ŠåŸç”Ÿå®¶åº­ã€‹ â€”â€” å¦‚ä½•ä¿®è¡¥è‡ªå·±çš„æ€§æ ¼ç¼ºé™·</strong></em></p>
<blockquote>
<p>[ç¾]è‹çŠÂ·ç¦æ²ƒå¾· å…‹é›·æ ¼Â·å·´å…‹ â€”â€” è‘—<br>é»„å§ ç‹å©· â€”â€” è¯‘</p>
</blockquote>
<h1 id="ä¹¦åº"><a href="#ä¹¦åº" class="headerlink" title="ä¹¦åº"></a>ä¹¦åº</h1><p> ä½ çš„æ‰€æœ‰çš„æ„Ÿå—éƒ½æ˜¯æœ‰é“ç†çš„ï¼Œå°¤å…¶æ˜¯é‚£äº›ç°æš—çš„æ„Ÿå—ã€‚å†…å¿ƒå……æ»¡ç—›è‹¦çš„äººï¼Œåªè¦èƒ½å‘ç°è¿™æ ·ä¸€ä¸ªç®€å•çš„é“ç†ï¼Œä»–ä»¬çš„ç—›è‹¦å°±ä¼šå‡è½»å¾ˆå¤šã€‚å¹¶ä¸”è¿™ä¸ªé“ç†çš„æ ¸å¿ƒæ˜¯ï¼Œä½ é‚£äº›ç°æš—çš„ã€ä¸€ç›´ä»¥æ¥éš¾ä»¥è¢«åˆ«äººå’Œè‡ªå·±ç†è§£æ¥çº³ã€ä¼¼ä¹æ— å¤„å®‰æ”¾çš„æ„Ÿå—ï¼Œå…¶å®å°±æ˜¯æ¥è‡ªä½ çš„å®¶åº­ï¼Œè€Œä¸”ä¸»è¦æ˜¯æ¥è‡ªä½ ä¸çˆ¶æ¯çš„å…³ç³»ã€‚è¿™æ˜¯ä¸€ä¸ªçœŸç›¸ï¼Œæˆ‘ä»¬å¿…é¡»å°Šé‡çš„çœŸç›¸ã€‚ â€”â€” æ­¦å¿—çº¢ [å¿ƒé‡Œå­¦å®¶ã€ä½œå®¶]</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>åŸç”Ÿå®¶åº­</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šå¯çˆ±çš„è¯…å’’ã€‹</title>
    <url>/2021/02/11/book/ke-ai-de-zu-zhou/</url>
    <content><![CDATA[<p><img src="/images/%E5%8F%AF%E7%88%B1%E7%9A%84%E8%AF%85%E5%92%92.jpeg" alt="å¯çˆ±çš„è¯…å’’"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><em><strong>ã€Šå¯çˆ±çš„è¯…å’’ã€‹â€”â€” åœ£æ¯å‹äººæ ¼å¿ƒé‡Œè‡ªåŠ©æ‰‹å†Œ</strong></em></p>
<blockquote>
<p>[è‹±]é›…åŸºÂ·é©¬æ£® â€”â€” è‘—<br>ç‹ä¸½ â€”â€” è¯‘</p>
</blockquote>
<h1 id="ä¹¦åº"><a href="#ä¹¦åº" class="headerlink" title="ä¹¦åº"></a>ä¹¦åº</h1><p>ç”Ÿæ´»ä¸­æ€»ä¼šæœ‰ä¸€äº›è¿™æ ·çš„äººï¼Œä»–ï¼ˆå¥¹ï¼‰ä»¬å°†å¤§éƒ¨åˆ†ç²¾åŠ›éƒ½èŠ±åœ¨å®¶äººã€æœ‹å‹å’ŒåŒäº‹èº«ä¸Šï¼Œç”šè‡³å¯¹é™Œç”Ÿäººä¹Ÿæœ‰æ±‚å¿…åº”ï¼Œä¸€æ—¦åœæ­¢è¿™æ ·åšï¼Œå°±ä¼šè§‰å¾—éå¸¸å†…ç–šï¼Œä»¿ä½›å—äº†ä¸€åœºâ€å¯çˆ±çš„è¯…å’’â€ã€‚åœ¨ä»–ä»¬çœ‹æ¥ï¼Œå¾ˆå¤šäº‹æƒ…çš„ä¼˜å…ˆçº§éƒ½é«˜äºè‡ªå·±çš„èº«å¿ƒå¥åº·ï¼Œç»“æœï¼Œæ”¯æŒäº†æ‰€æœ‰äººï¼Œå´è®©è‡ªå·±å´©æºƒã€‚</p>
<h1 id="ç²¾å½©æ®µè½"><a href="#ç²¾å½©æ®µè½" class="headerlink" title="ç²¾å½©æ®µè½"></a>ç²¾å½©æ®µè½</h1><h2 id="ç¬¬ä¸€ç« -æœŸæœ›çš„ç‰¢ç¬¼"><a href="#ç¬¬ä¸€ç« -æœŸæœ›çš„ç‰¢ç¬¼" class="headerlink" title="ç¬¬ä¸€ç«  æœŸæœ›çš„ç‰¢ç¬¼"></a>ç¬¬ä¸€ç«  æœŸæœ›çš„ç‰¢ç¬¼</h2><p>æˆ‘ä»¬é€šå¸¸éƒ½ä¼šè§‰å¾—è‡ªå·±è¢«æ·¹æ²¡åœ¨åˆ«äººçš„æœŸæœ›ä¸­ï¼Œè€Œä¸”å®Œå…¨ä¸çŸ¥é“è¯¥å¦‚ä½•ä»¥å…¶å®ƒæ–¹å¼ç”Ÿæ´»ã€‚äº‹å®ä¸Šï¼Œå°±è¿æƒ³åˆ°æ”¹å˜ï¼Œæ¯”å¦‚æ‹’ç»æŸä¸ªè¯·æ±‚ï¼Œéƒ½ä¼šè§‰å¾—å®³æ€•ã€‚</p>
<h2 id="ç¬¬å››ç« -èº«ä½“çš„æ„Ÿå—ä¸æƒ…ç»ªçš„è§‰å¯Ÿ"><a href="#ç¬¬å››ç« -èº«ä½“çš„æ„Ÿå—ä¸æƒ…ç»ªçš„è§‰å¯Ÿ" class="headerlink" title="ç¬¬å››ç«  èº«ä½“çš„æ„Ÿå—ä¸æƒ…ç»ªçš„è§‰å¯Ÿ"></a>ç¬¬å››ç«  èº«ä½“çš„æ„Ÿå—ä¸æƒ…ç»ªçš„è§‰å¯Ÿ</h2><p>æˆ‘ä»¬ä¸æ•¢è¯´å‡ºæˆ‘ä»¬ä¸åˆ«äººä¸åŒçš„æ„è§ã€‚è¿™è¿˜æ˜¯â€å®³æ€•å†²çªâ€çš„é—®é¢˜ï¼šå½“ä½ èƒ½å¤Ÿå¿½ç•¥è‡ªå·±çš„çœŸå®æƒ³æ³•å¹¶äº«å—å’Œç¦æ—¶ï¼Œä½ åˆä½•å¿…å†’é™©å¼•èµ·æ„¤æ€’ä¸ä¸å’Œå‘¢ï¼Ÿä½†æ˜¯ï¼Œè¿™æ˜¯éœ€è¦æˆ‘ä»¬è‡ªå·±ä»˜å‡ºä»£ä»·çš„ã€‚å†æ¬¡é‡ç”³ï¼Œæˆ‘ä»¬ä¸æ•¢æ˜¾éœ²çœŸå®çš„è‡ªå·±ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„ä»·å€¼è§‚ã€ä¿¡ä»°ã€å“å‘³åŠæ„è§ï¼Œæ‰€ä»¥å…¶ä»–äººä¹Ÿå°±æ°¸è¿œæ— æ³•äº†è§£çœŸå®çš„æˆ‘ä»¬æ˜¯ä»€ä¹ˆæ ·å­ã€‚è¿™ç§æƒ…å†µä¸‹ç»´æŒçš„å…³ç³»ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºå®ƒå¹¶éç™¾åˆ†ç™¾çœŸå®ã€‚æˆ‘ä»¬çš„è‡ªæˆ‘æ„ŸçŸ¥ä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸ç›¸ä¿¡åˆ«äººæ˜¯å› ä¸ºæˆ‘ä»¬è‡ªèº«çš„æ ·å­è€Œå–œæ¬¢æˆ‘ä»¬ï¼Œè€Œæ˜¯ä»¥ä¸ºä»–ä»¬å–œæ¬¢æˆ‘ä»¬åªæ˜¯å› ä¸ºæˆ‘ä»¬ä¸ä»–ä»¬çš„æ„è§ä¸€è‡´ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»æ˜¯æƒ³æˆä¸ºåˆ«äººçœ¼ä¸­çš„â€å¥½å­©å­â€ï¼Œä¸€ç›´åŠªåŠ›åšä¸€ä¸ªå¯¹åˆ«äººâ€æœ‰ç”¨â€çš„äººï¼Œå¿½ç•¥è‡ªå·±çœŸå®çš„æ„Ÿå—ï¼Œé€šè¿‡â€åˆ é™¤â€è‡ªå·±çœŸå®çš„æƒ³æ³•å»èµæˆåˆ«äººçš„è§‚ç‚¹æ¥è·å¾—è®¤åŒï¼Œæˆ‘ä»¬å¯èƒ½éƒ½æœ‰ä¸€å°å—è¢«â€å¯çˆ±çš„è¯…å’’â€æ–½äº†æ³•çš„è„†å¼±åŒºåŸŸï¼Œè€Œæˆ‘å¯èƒ½æœ‰ä¸€å¤§ç‰‡ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>å¯çˆ±çš„è¯…å’’</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šå…³é”®å¯¹è¯ï¼šå¦‚ä½•é«˜æ•ˆèƒ½æ²Ÿé€šã€‹</title>
    <url>/2023/07/03/book/guan-jian-dui-hua/</url>
    <content><![CDATA[<p><img src="/2023/07/03/book/guan-jian-dui-hua/%E5%85%B3%E9%94%AE%E5%AF%B9%E8%AF%9D%E7%AB%A0%E8%8A%82.png" alt="å…³é”®å¯¹è¯"></p>
<blockquote>
<h1 id="ç¬¬1ç« -ä½•è°“å…³é”®å¯¹è¯"><a href="#ç¬¬1ç« -ä½•è°“å…³é”®å¯¹è¯" class="headerlink" title="ç¬¬1ç« ã€€ä½•è°“å…³é”®å¯¹è¯"></a>ç¬¬1ç« ã€€ä½•è°“å…³é”®å¯¹è¯</h1></blockquote>
<h2 id="å…³é”®å¯¹è¯çš„ä»·å€¼"><a href="#å…³é”®å¯¹è¯çš„ä»·å€¼" class="headerlink" title="å…³é”®å¯¹è¯çš„ä»·å€¼"></a>å…³é”®å¯¹è¯çš„ä»·å€¼</h2><p>æ²Ÿé€šæœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œäººä»¬æƒ³å½“ç„¶åœ°è®¤ä¸ºå·²ç»æ²Ÿé€šäº†ã€‚å½“ç»“æœå……æ»¡é£é™©ã€è§‚ç‚¹èƒŒé“è€Œé©°ã€åŒæ–¹æƒ…ç»ªæ¿€çƒˆæ—¶ï¼Œæ™®é€šçš„å¯¹è¯ä¾¿ä¼šå‡çº§ä¸ºå…³é”®å¯¹è¯ã€‚å……æ»¡è®½åˆºæ„å‘³çš„æ˜¯ï¼Œå¯¹è¯å†…å®¹è¶Šå…³é”®ï¼Œæˆ‘ä»¬æ­£ç¡®å¤„ç†é—®é¢˜çš„èƒ½åŠ›å°±è¶Šå·®ã€‚äº‹å®è¯æ˜ï¼Œé€ƒé¿å¯¹è¯æˆ–æ˜¯æŠŠå¯¹è¯æç ¸éƒ½ä¼šå¸¦æ¥éå¸¸ä¸¥é‡çš„åæœã€‚å½“æˆ‘ä»¬æ— æ³•æ­£ç¡®å¤„ç†å…³é”®å¯¹è¯æ—¶ï¼Œç”Ÿæ´»ä¸­æ‰€æœ‰é‡è¦çš„æ–¹é¢éƒ½ä¼šå› æ­¤å—åˆ°ä¸åˆ©å½±å“ï¼Œå…¶ä¸­åŒ…æ‹¬æˆ‘ä»¬çš„äº‹ä¸šã€åœˆå­ã€äººé™…å…³ç³»ï¼Œç”šè‡³æ˜¯æˆ‘ä»¬çš„èº«ä½“å¥åº·ã€‚</p>
<h2 id="å…³é”®å¯¹è¯çš„å®šä¹‰"><a href="#å…³é”®å¯¹è¯çš„å®šä¹‰" class="headerlink" title="å…³é”®å¯¹è¯çš„å®šä¹‰"></a>å…³é”®å¯¹è¯çš„å®šä¹‰</h2><p>å…³é”®å¯¹è¯æŒ‡çš„æ˜¯ä¸¤äººæˆ–å¤šäººä¹‹é—´çš„ä¸€ç§è®¨è®ºï¼Œè¿™ç§è®¨è®ºå…·æœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>é«˜é£é™©</li>
<li>ä¸åŒè§‚ç‚¹</li>
<li>æ¿€çƒˆæƒ…ç»ª</li>
</ol>
<h2 id="å…³é”®å¯¹è¯çš„éš¾ç‚¹"><a href="#å…³é”®å¯¹è¯çš„éš¾ç‚¹" class="headerlink" title="å…³é”®å¯¹è¯çš„éš¾ç‚¹"></a>å…³é”®å¯¹è¯çš„éš¾ç‚¹</h2><p>è¿™å°±æ˜¯æˆ‘ä»¬åœ¨é¢å¯¹å…³é”®å¯¹è¯æ—¶çš„çœŸå®çŠ¶æ€â€”â€”æ£˜æ‰‹çš„é—®é¢˜ã€ä¸ä¾ä¸é¥¶çš„å¯¹æ‰‹ã€é«˜åº¦ç¼ºè¡€çš„å¤§è„‘å’Œæ— æ³•æ­£å¸¸å·¥ä½œçš„æ€ç»´ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¹³ç´ è¡¨ç°å¾—æ­£å¸¸å¾—ä½“ï¼Œå¯é¢å¯¹å…³é”®å¯¹è¯æ—¶å´ä¼šå˜æˆåè¶³çš„ç™½ç—´ã€‚</p>
<p>å½“é¢å¯¹å……æ»¡æŒ‘æˆ˜çš„å…³é”®å¯¹è¯æ—¶ï¼Œä½ çš„æ™ºåŠ›æ°´å¹³è·Ÿä¸€åªæ’æ²³çŒ´å·®ä¸äº†å¤šå°‘ã€‚ä½ çš„èº«ä½“å‡†å¤‡åº”å¯¹çš„æ˜¯ä¸€åªå‰‘é½¿è™çš„æ”»å‡»ï¼Œè€Œä¸æ˜¯ä»€ä¹ˆè€æ¿ã€é‚»å±…æˆ–è€å…¬çš„æ‰¹è¯„æŒ‡è´£ã€‚</p>
<blockquote>
<h1 id="ç¬¬2ç« -æŒæ¡å…³é”®å¯¹è¯"><a href="#ç¬¬2ç« -æŒæ¡å…³é”®å¯¹è¯" class="headerlink" title="ç¬¬2ç« ã€€æŒæ¡å…³é”®å¯¹è¯"></a>ç¬¬2ç« ã€€æŒæ¡å…³é”®å¯¹è¯</h1></blockquote>
<h2 id="æ¢ç´¢äººä»¬ç”¨æ¥è¥é€ å¯¹è¯ç¯å¢ƒçš„æŠ€å·§"><a href="#æ¢ç´¢äººä»¬ç”¨æ¥è¥é€ å¯¹è¯ç¯å¢ƒçš„æŠ€å·§" class="headerlink" title="æ¢ç´¢äººä»¬ç”¨æ¥è¥é€ å¯¹è¯ç¯å¢ƒçš„æŠ€å·§"></a>æ¢ç´¢äººä»¬ç”¨æ¥è¥é€ å¯¹è¯ç¯å¢ƒçš„æŠ€å·§</h2><p>æˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯å¦‚ä½•çœ‹å¾…é—®é¢˜æƒ…å½¢ä»¥åŠè¯¥æ€æ ·åšå¥½å¯¹è¯å‡†å¤‡ã€‚é€šè¿‡è‡ªæˆ‘æ£€è§†ã€è§‚å¯Ÿé—®é¢˜ã€æ€ç»´åˆ†æã€æ–¹å¼ç ”ç©¶ã€æŠ“ä½æ ¸å¿ƒï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¯¹è¯åŒæ–¹éƒ½ä¼šå› æ­¤å—ç›Šã€‚</p>
<h2 id="è®²è¿°ã€è†å¬å’Œè¡ŒåŠ¨çš„æŠ€å·§"><a href="#è®²è¿°ã€è†å¬å’Œè¡ŒåŠ¨çš„æŠ€å·§" class="headerlink" title="è®²è¿°ã€è†å¬å’Œè¡ŒåŠ¨çš„æŠ€å·§"></a>è®²è¿°ã€è†å¬å’Œè¡ŒåŠ¨çš„æŠ€å·§</h2><p>æˆ‘è¯¥æ€æ ·è¡¨è¾¾å¾®å¦™ä¿¡æ¯ï¼Ÿæ€æ ·é™ˆè¿°è§‚ç‚¹æœ‰è¯´æœåŠ›ï¼Œä¸ä¼šä»¤äººè®¨åŒï¼Ÿå¦‚ä½•è†å¬å¯¹æ–¹çš„è¡¨è¾¾ï¼Ÿæ›´é‡è¦çš„æ˜¯ï¼Œæ€æ ·åšæ‰èƒ½è®©å¯¹æ–¹åœ¨ç´§å¼ ä¸å®‰çš„æƒ…å†µä¸‹è¯´å‡ºå†…å¿ƒçœŸå®æƒ³æ³•ï¼Ÿæ€æ ·æ‰èƒ½æŠŠæ€æƒ³è½¬å˜æˆè¡ŒåŠ¨ï¼Ÿè¿™äº›æŠ€å·§ä»¬éƒ½ä¼šä¸€ä¸€å‘å¤§å®¶è®²è¿°ã€‚</p>
<blockquote>
<h1 id="ç¬¬3ç« -ä»â€œå¿ƒâ€å¼€å§‹-å¦‚ä½•ç¡®å®šç›®æ ‡"><a href="#ç¬¬3ç« -ä»â€œå¿ƒâ€å¼€å§‹-å¦‚ä½•ç¡®å®šç›®æ ‡" class="headerlink" title="ç¬¬3ç« ã€€ä»â€œå¿ƒâ€å¼€å§‹ã€€å¦‚ä½•ç¡®å®šç›®æ ‡"></a>ç¬¬3ç« ã€€ä»â€œå¿ƒâ€å¼€å§‹ã€€å¦‚ä½•ç¡®å®šç›®æ ‡</h1></blockquote>
<p>ä»â€œâ¼¼â€å¼€å§‹ï¼Œå³å®¡è§†ä½ çš„å†… â¼¼ã€‚å¦‚æœä½ â½†æ³•æ­£ç¡®è®¤è¯†â¾ƒæˆ‘ï¼Œé‚£è‚¯å®šâ½†æ³•å±•å¼€æ­£ç¡®çš„å¯¹è¯ã€‚å½“â¾¯å¯¹ å…³é”®å¯¹è¯æ—¶ï¼Œä½ ä¼šä¸‹æ„è¯†åœ°é‡‡â½¤å¤šå¹´æ¥å½¢æˆçš„æ²Ÿé€šä¹ æƒ¯â€”â€”äº‰è¾©ä¸ ä¼‘ã€æ²‰é»˜ä¸è¯­ã€â¾ƒä»¥ä¸ºæ˜¯â€¦â€¦</p>
<h2 id="å…³é”®å¯¹è¯çš„â€œç¬¬ä¸€ä¸ªé—®é¢˜â€"><a href="#å…³é”®å¯¹è¯çš„â€œç¬¬ä¸€ä¸ªé—®é¢˜â€" class="headerlink" title="å…³é”®å¯¹è¯çš„â€œç¬¬ä¸€ä¸ªé—®é¢˜â€"></a>å…³é”®å¯¹è¯çš„â€œç¬¬ä¸€ä¸ªé—®é¢˜â€</h2><p>æˆ‘ä»¬çš„é—®é¢˜å¹¶ä¸æ˜¯è¡Œä¸ºæœ¬èº«æ˜¯é”™è¯¯çš„ï¼Œè€Œæ˜¯æˆ‘ä»¬çš„åŠ¨æœºæœ‰é—®é¢˜ï¼Œå³æˆ‘ä»¬å¸¸å¸¸å¼„é”™è¦é¢å¯¹çš„ç›®æ ‡ã€‚<br>å› æ­¤ï¼Œè¦æƒ³è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€æ­¥æ˜¯æ”¹å˜é”™è¯¯çš„è§‚ç‚¹ï¼Œå³è®¤ä¸ºæˆ‘ä»¬çš„è‹¦æ¼æ˜¯ç”±ä»–äººå¯¼è‡´çš„ã€‚æˆ‘ä»¬æ€»æ˜¯ç®€å•åœ°è®¤ä¸ºï¼šâ€œåªè¦èƒ½æ å®šâ€˜â¿‡çƒ¦åˆ¶é€ è€…â€™ï¼Œâ¼€åˆ‡é—®é¢˜éƒ½ä¼šå¥½èµ·æ¥ã€‚â€å®é™…ä¸Šï¼Œæ­£æ˜¯è¿™ç§é”™è¯¯çš„å¿µ å¤´åœ¨é˜»â½Œæˆ‘ä»¬åˆ©â½¤å¯¹è¯â½…å¼è§£å†³é—®é¢˜ã€‚æ˜â½©äº†è¿™â¼€ç‚¹ï¼Œä½ å°±ä¸ä¼šå¥‡æ€ª ä¸ºä»€ä¹ˆå¯¹è¯â¾¼â¼¿æ€»æ˜¯èƒ½åˆ¶é€ å¥‡è¿¹äº†ã€‚è¿™æ˜¯å› ä¸ºä»–ä»¬åšä¿¡ï¼Œè¦æƒ³è§£å†³ å¥½â€œåŒâ½…â€çš„é—®é¢˜ï¼Œåªèƒ½ä»â€œâ¾ƒâ¼°â€å¼€å§‹ï¼Œåœ¨â¾ƒæˆ‘â¾ä¸Šæ‰¾åŸå› ã€‚</p>
<h2 id="å®¡è§†â¾ƒæˆ‘çš„æ„ä¹‰"><a href="#å®¡è§†â¾ƒæˆ‘çš„æ„ä¹‰" class="headerlink" title="å®¡è§†â¾ƒæˆ‘çš„æ„ä¹‰"></a>å®¡è§†â¾ƒæˆ‘çš„æ„ä¹‰</h2><p>è¯šç„¶ï¼Œâ¾¯å¯¹â½£æ´»ä¸­â½†ç©·â½†å°½çš„å„ç§æ­£â¾¯å†²çªï¼Œæœ‰æ—¶æˆ‘ä»¬åªæ˜¯æ¯«ä¸ç›¸â¼²çš„æ—è§‚è€…ï¼Œä½†è¿™å¹¶ä¸è¡¨â½°æˆ‘ä»¬â¼€ç‚¹è´£ä»»éƒ½æ²¡æœ‰ã€‚å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå…¶å®æˆ‘ä»¬æ­£æ˜¯ç»™â¾ƒâ¼°å¸¦æ¥çƒ¦æ¼çš„åŸå› ä¹‹â¼€ã€‚ </p>
<p>å¯¹è¯â¾¼â¼¿ä»¬â¾®å¸¸æ˜â½©è¿™â¼€ç‚¹ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå½¢æˆäº†å®¡è§†â¾ƒæˆ‘çš„åŸåˆ™ã€‚ä»–ä»¬ä¸ä½†è®¤è¯†åˆ°å®è·µè¿™æ¡åŸåˆ™èƒ½è®©â¾ƒâ¼°å—ç›Šï¼Œâ½½ä¸”æ·±çŸ¥èƒ½å¤Ÿæ”¹å˜çš„â¼ˆåªæœ‰ä»–ä»¬â¾ƒâ¼°ã€‚æ­£å¦‚æˆ‘ä»¬è®¤ä¸ºåˆ«â¼ˆåº”è¯¥åšå‡ºæ”¹å˜â¼€æ ·ï¼Œå®é™…ä¸Šæˆ‘ä»¬èƒ½å¤ŸæˆåŠŸå¯å‘ã€æ¿€åŠ±å’Œå¡‘é€ çš„â¼ˆåªæœ‰â¼€ä¸ªï¼Œå°±æ˜¯é•œâ¼¦ä¸­çš„â¾ƒâ¼°ã€‚ </p>
<p>è™½ç„¶è¿™åªæ˜¯â¼€ä¸ªç®€å•çš„äº‹å®ï¼Œä½†å…¶ä¸­å´é¥±å«ç€æŸç§è®½åˆºæ„å‘³ï¼Œå³åªæœ‰é‚£äº›ç›¸ä¿¡â€œæ”¹å˜ä»â¾ƒæˆ‘åšèµ·â€çš„â¼ˆæ‰ä¼šçœŸæ­£å®è·µè¿™æ¡åŸåˆ™ã€‚å½“ä»–ä»¬ è¿™æ ·å»åšæ—¶ï¼Œç»“æœâ½†â¼€ä¾‹å¤–åœ°éƒ½æˆäº†æŠ€å·§â¾¼è¶…çš„å¯¹è¯â¾¼â¼¿ã€‚çœ‹ï¼Œè¿™å°± æ˜¯è®½åˆºä¹‹å¤„ï¼Œé‚£äº›åŠªâ¼’æâ¾¼å¯¹è¯æŠ€å·§çš„â¼ˆæ°æ°æ˜¯æœ€æœ‰å¤©åˆ†ã€å–„äºè§£å†³é—®é¢˜çš„â¼ˆï¼Œâ½½ä¸æ˜¯èƒ½â¼’ä¸â¾œçš„é—®é¢˜è§£å†³è€…ã€‚è¿™å°±åƒâ½¼è¯æ‰€è¯´çš„é‚£æ ·ï¼Œ å¯Œè€…è¶Šå¯Œï¼Œè´«è€…è¶Šè´«ï¼ŒåŸå› æ˜¯å¯Œè£•è€…ä¼šæ›´åŠ åŠªâ¼’ï¼Œâ½½è´«ç©·è€…å·²ç»ä¹ æƒ¯äº†å¾—è¿‡ä¸”è¿‡ã€‚</p>
<h2 id="ä»â€œå¿ƒâ€å¼€å§‹"><a href="#ä»â€œå¿ƒâ€å¼€å§‹" class="headerlink" title="ä»â€œå¿ƒâ€å¼€å§‹"></a>ä»â€œå¿ƒâ€å¼€å§‹</h2><p>å°½ç®¡æˆ‘ä»¬å¾ˆéš¾æŠŠâ¼ˆé™…äº’åŠ¨ä¸­è¯¸å¤šäº‹ä»¶çš„ç‰¹å®šé¡ºåºæè¿°å¾—åƒå…³é”®å¯¹è¯é‚£æ ·æ¸…æ™°æµç•…ï¼Œä½†æœ‰â¼€ç‚¹æˆ‘ä»¬æ˜¯ç¡®å®šâ½†ç–‘çš„ï¼Œå³å¯¹è¯â¾¼â¼¿æ€»æ˜¯èƒ½åšåˆ°ä»â€œâ¼¼â€å¼€å§‹ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨å±•å¼€â¾¼â»›é™©å¯¹è¯æ—¶ï¼Œä»–ä»¬æ€»æ˜¯â¾¸å…ˆæ˜ç¡®â½¬çš„å’ŒåŠ¨æœºï¼Œâ½†è®ºå‡ºç°ä»€ä¹ˆæƒ…å†µè¿™ä¸ªâ½¬çš„éƒ½ä¸ä¼šåŠ¨æ‘‡ã€‚</p>
<h3 id="å…³æ³¨â½¬æ ‡çš„ä¸¤ä¸ªè¡¨ç°"><a href="#å…³æ³¨â½¬æ ‡çš„ä¸¤ä¸ªè¡¨ç°" class="headerlink" title="å…³æ³¨â½¬æ ‡çš„ä¸¤ä¸ªè¡¨ç°"></a>å…³æ³¨â½¬æ ‡çš„ä¸¤ä¸ªè¡¨ç°</h3><blockquote>
<p>â¾¸å…ˆï¼Œä»–ä»¬â¾®å¸¸æ¸…æ¥šâ¾ƒâ¼°å¸Œ æœ›é€šè¿‡å¯¹è¯è·å¾—ä»€ä¹ˆã€‚åœ¨å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œâ½†è®ºå‡ºç°å¤šå°‘å¯èƒ½è½¬ç§»æ³¨æ„â¼’çš„æƒ…å†µï¼Œä»–ä»¬ä¾ç„¶èƒ½åšå®ˆâ¾ƒâ¼°çš„â½¬æ ‡ã€‚<br>å…¶æ¬¡ï¼Œå¯¹è¯â¾¼â¼¿ä»æ¥ä¸åšâ€œå‚»â½ å¼é€‰æ‹©â€ï¼ˆå³â¾®æ­¤å³å½¼ã€â¾®â¿Šå³â½©å¼çš„é€‰æ‹©ï¼‰ã€‚</p>
</blockquote>
<p>å’Œé‚£äº›é”™è¯¯åœ°è®¤ä¸ºåªèƒ½â€œé€ƒé¿æˆ–å¯¹æŠ—â€çš„é—®é¢˜è§£å†³è€…ä¸åŒï¼Œå¯¹è¯â¾¼â¼¿è®¤ä¸ºï¼Œâ½†è®ºå‡ºç°å¤šä¹ˆæ£˜ â¼¿çš„æƒ…å†µï¼Œå¯¹è¯æ°¸è¿œéƒ½æ˜¯â¼€ç§å¯â¾çš„é€‰æ‹©ã€‚</p>
<h2 id="çœŸå®æ¡ˆä¾‹"><a href="#çœŸå®æ¡ˆä¾‹" class="headerlink" title="çœŸå®æ¡ˆä¾‹"></a>çœŸå®æ¡ˆä¾‹</h2><blockquote>
<h3 id="æˆ˜èƒœå¯¹æ–¹"><a href="#æˆ˜èƒœå¯¹æ–¹" class="headerlink" title="æˆ˜èƒœå¯¹æ–¹"></a>æˆ˜èƒœå¯¹æ–¹</h3><p>â½£æ´»å°±æ˜¯â¼€ä¸ªå·¨â¼¤çš„ç«æŠ€åœºï¼Œâ¾¥â¾¯æœ‰â½†ç©·â½†å°½çš„â½èµ›ï¼Œæˆ‘ä»¬å¿…é¡»æ—¶åˆ»ä¸åœåœ°å’Œâ¾è¾¹ çš„â¼ˆå±•å¼€ç«äº‰ã€‚å¯ä»¥è¯´ï¼Œæˆ‘ä»¬æ—©åœ¨æ‡µæ‡‚æœªçŸ¥çš„å¹´çºªå°±å·²ç»å½¢æˆäº†è¦æˆ˜ èƒœä»–â¼ˆçš„æ¬²æœ›ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸å¹¸çš„æ˜¯ï¼Œéšç€æˆ‘ä»¬æ…¢æ…¢â»“â¼¤ï¼Œâ¼¤å¤šæ•°â¼ˆå¹¶æ²¡æœ‰æ„è¯†åˆ°è¿™ç§æ¬²æœ› æ­£æŠŠæˆ‘ä»¬æ‹‰å¾—è¶Šæ¥è¶Šè¿œï¼Œæ—©å·²å¿˜è®°äº†åˆ©â½¤å¥åº·å¯¹è¯è§£å†³é—®é¢˜çš„â½…å¼ã€‚ çš„ç¡®ï¼Œæˆ‘ä»¬çš„åˆå§‹â½¬æ ‡æ˜¯æƒ³è§£å†³é—®é¢˜ï¼Œä½†æ¯æ¬¡åªè¦æœ‰â¼ˆæå‡ºåå¯¹æˆ–è´¨ ç–‘çš„å£°â¾³ï¼Œæˆ‘ä»¬è½¬çœ¼é—´ä¾¿ä¼šæŠŠåˆå§‹â½¬æ ‡å¿˜å¾—â¼€â¼²â¼†å‡€ã€‚</p>
</blockquote>
<blockquote>
<h3 id="æƒ©ç½šå¯¹â½…"><a href="#æƒ©ç½šå¯¹â½…" class="headerlink" title="æƒ©ç½šå¯¹â½…"></a>æƒ©ç½šå¯¹â½…</h3><p>æœ‰æ—¶å€™ï¼Œéšç€æ„¤æ€’æƒ…ç»ªçš„å¢â»“ï¼Œæˆ‘ä»¬çš„â¼¼æ€ä¼šä»å¸Œæœ› æˆ˜èƒœå¯¹â½…è½¬å˜ä¸ºè“„æ„ä¼¤å®³å¯¹â½…ã€‚ä¾‹å¦‚ï¼Œæ ¼ç‘å¡”å°±æ˜¯è¿™ä¹ˆæƒ³çš„ï¼šâ€œå»ä»–çš„ å¦è¯šæ²Ÿé€šå§ï¼Œçœ‹æˆ‘ä¸å¥½å¥½ä¿®ç†ä½ è¿™ä¸ªâ½¬ä¸­â½†â¼ˆçš„â½©ç—´ï¼â€å½“è¿™ç§è´Ÿâ¾¯æƒ…ç»ªè¾¾åˆ°é¡¶å³°æ—¶ï¼Œæˆ‘ä»¬çš„â½¬æ ‡ä¼šå˜å¾—â¾®å¸¸é‚ªæ¶ã€‚æ­¤æ—¶æ­¤åˆ»ï¼Œæˆ‘ä»¬æ—©å°±æŠŠ ä»€ä¹ˆå…±äº«è§‚ç‚¹åº“æŠ›åˆ°äº†ä¹éœ„äº‘å¤–ï¼Œâ¼€â¼¼åªæƒ³ç€ç»™å¯¹â½…åˆ¶é€ ç—›è‹¦ã€‚</p>
</blockquote>
<h2 id="å…³æ³¨ä½ çš„çœŸæ­£ç›®çš„"><a href="#å…³æ³¨ä½ çš„çœŸæ­£ç›®çš„" class="headerlink" title="å…³æ³¨ä½ çš„çœŸæ­£ç›®çš„"></a>å…³æ³¨ä½ çš„çœŸæ­£ç›®çš„</h2><ul>
<li>å‘ç°è‡ªå·±å³å°†é™·å…¥æ²‰é»˜æˆ–æš´åŠ›çŠ¶æ€æ—¶ï¼Œåœæ­¢å¯¹è¯ï¼Œå†·é™æ€è€ƒä½ çš„åŠ¨æœºã€‚</li>
<li>é—®è‡ªå·±è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šâ€œæˆ‘ç°åœ¨çš„è¡Œä¸ºæ˜¾ç¤ºå‡ºæˆ‘çš„åŠ¨æœºæ˜¯ä»€ä¹ˆï¼Ÿâ€</li>
<li>æ˜ç¡®ä½ çš„çœŸæ­£ç›®çš„ï¼Œé—®è‡ªå·±ï¼šâ€œæˆ‘æƒ³ä¸ºè‡ªå·±ã€ä»–äººå’Œäººé™…å…³ç³»åšäº›ä»€ä¹ˆï¼Ÿâ€</li>
<li>æœ€åï¼Œé—®è‡ªå·±ï¼šâ€œå¦‚æœè¿™æ˜¯æˆ‘çš„çœŸæ­£ç›®çš„ï¼Œæˆ‘è¯¥æ€ä¹ˆåšï¼Ÿâ€</li>
</ul>
<h2 id="æ‹’ç»â€œå‚»ç“œå¼é€‰æ‹©â€"><a href="#æ‹’ç»â€œå‚»ç“œå¼é€‰æ‹©â€" class="headerlink" title="æ‹’ç»â€œå‚»ç“œå¼é€‰æ‹©â€"></a>æ‹’ç»â€œå‚»ç“œå¼é€‰æ‹©â€</h2><ul>
<li>åœ¨åˆ†æè¡Œä¸ºç›®çš„æ—¶ï¼Œç•™æ„åœ¨å“ªäº›æƒ…å†µä¸‹ä½ ä¼šè¯´æœè‡ªå·±åšå‡ºâ€œå‚»ç“œå¼é€‰æ‹©â€ã€‚</li>
<li>ç•™æ„ä½ æ˜¯å¦æ€»æ˜¯å‘Šè¯‰è‡ªå·±å¿…é¡»åœ¨è¯´å®è¯å’Œé¡¾é¢å­ä¹‹é—´ã€åœ¨æˆä¸è´¥ä¹‹é—´åšå‡ºä¸¤æåŒ–é€‰æ‹©ã€‚</li>
<li>åˆ©ç”¨å¯¹æ¯”è¯´æ˜çš„æ–¹å¼æ¶ˆé™¤â€œå‚»ç“œå¼é€‰æ‹©â€çš„å½±å“ã€‚</li>
<li>è¯´å‡ºä½ å¸Œæœ›çš„ç›®çš„ä¹‹åï¼Œæ˜ç¡®ä½ ä¸å¸Œæœ›å®ç°çš„ç›®çš„ï¼Œç„¶åå¼€åŠ¨è„‘ç­‹å¯»æ‰¾å¯ä»¥å®ç°å¯¹è¯çš„å¥åº·æ–¹å¼ã€‚</li>
</ul>
<blockquote>
<h1 id="ç¬¬4ç« -æ³¨æ„è§‚å¯Ÿ-å¦‚ä½•åˆ¤æ–­å¯¹è¯æ°›å›´æ˜¯å¦å®‰å…¨"><a href="#ç¬¬4ç« -æ³¨æ„è§‚å¯Ÿ-å¦‚ä½•åˆ¤æ–­å¯¹è¯æ°›å›´æ˜¯å¦å®‰å…¨" class="headerlink" title="ç¬¬4ç« ã€€æ³¨æ„è§‚å¯Ÿã€€å¦‚ä½•åˆ¤æ–­å¯¹è¯æ°›å›´æ˜¯å¦å®‰å…¨"></a>ç¬¬4ç« ã€€æ³¨æ„è§‚å¯Ÿã€€å¦‚ä½•åˆ¤æ–­å¯¹è¯æ°›å›´æ˜¯å¦å®‰å…¨</h1></blockquote>
<h2 id="ç•™æ„å¯¹è¯æ°”æ°›"><a href="#ç•™æ„å¯¹è¯æ°”æ°›" class="headerlink" title="ç•™æ„å¯¹è¯æ°”æ°›"></a>ç•™æ„å¯¹è¯æ°”æ°›</h2><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¾ˆå¤šâ¼ˆéƒ½ä¸å…·å¤‡â€œåŒè·¯å¤„ç†â€èƒ½â¼’ï¼ˆå³åŒæ—¶å…³æ³¨å¯¹è¯ å†…å®¹å’Œå¯¹è¯â½“æ°›ä¸¤â½…â¾¯ï¼‰ï¼Œå½“å¯¹è¯â»›é™©å¾ˆâ¾¼ã€åŒâ½…æƒ…ç»ªæ¿€åŠ¨çš„æ—¶å€™æ›´æ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬å¾€å¾€æ·±é™·äºå¯¹è¯å†…å®¹â½†æ³•â¾ƒæ‹”ï¼Œâ¼ä¹ä¸å¯èƒ½è…¾å‡ºç²¾â¼’å» è§‚å¯Ÿâ¾ƒâ¼°å’Œå¯¹â½…ä¼šæœ‰å“ªäº›ç»†å¾®çš„å˜åŒ–ã€‚<br>åœ¨å…³é”®å¯¹è¯è¿‡ç¨‹ä¸­ä½ å¿…é¡»å…³æ³¨ä»¥ä¸‹ä¸‰ç§å› ç´ ï¼š</p>
<ol>
<li>å¯¹è¯é™·å…¥å±æœºçš„æ—¶åˆ»ï¼Œ</li>
<li>å¯¹æ–¹å¤±å»å®‰å…¨æ„Ÿçš„ä¿¡å·ï¼ˆå³è¡¨ç°å‡ºæ²‰é»˜æˆ–æš´åŠ›å€¾å‘ï¼‰</li>
<li>ä»¥åŠä½ åº”å¯¹å‹åŠ›çš„æ–¹å¼</li>
</ol>
<h2 id="å­¦ä¼šè¯†åˆ«å…³é”®å¯¹è¯"><a href="#å­¦ä¼šè¯†åˆ«å…³é”®å¯¹è¯" class="headerlink" title="å­¦ä¼šè¯†åˆ«å…³é”®å¯¹è¯"></a>å­¦ä¼šè¯†åˆ«å…³é”®å¯¹è¯</h2><p>â¾¸å…ˆï¼Œå½“å¯¹è¯ä»æ­£å¸¸è®¨è®ºå˜æˆæ¿€çƒˆäº‰æ‰§æ—¶ï¼Œä½ å°±å¿…é¡»ç•™æ„äº†ã€‚åŒæ ·ï¼Œåœ¨å’Œå¯¹â½…å±•å¼€æ£˜â¼¿çš„å¯¹è¯æ—¶ï¼Œä½ å¿…é¡»â¼©â¼¼ç¿¼ç¿¼åœ°åº”å¯¹ï¼Œå°±å¥½åƒè¿›â¼Šå¸ƒæ»¡åœ°é›·çš„å±é™©åœ°å¸¦â¼€æ ·ã€‚<br>ä¸ºäº†å°½æ—©å‘ç°é—®é¢˜ï¼Œä½ åº”å½“è°ƒæ•´â¾ƒâ¼°çš„æ€è·¯ï¼Œæ³¨æ„é‚£äº›æ ‡å¿—å…³é”® å¯¹è¯çš„ä¿¡å·ã€‚ä¾‹å¦‚ï¼Œâ¾¯å¯¹å…³é”®å¯¹è¯æ—¶ï¼Œæœ‰äº›â¼ˆä¼šå‡ºç°â½£ç†ä¿¡å·ï¼Œå¦‚èƒƒéƒ¨ä¸é€‚ã€åŒçœ¼å‘â¼²ç­‰ã€‚ä½ å¯ä»¥æƒ³æƒ³çœ‹ï¼Œå½“å¯¹è¯é™·â¼Šå±æœºæ—¶ä½ çš„â¾ä½“ä¼šæœ‰ä»€ä¹ˆååº”ã€‚åœ¨â½£ç†ååº”â½…â¾¯ï¼Œæ¯ä¸ªâ¼ˆçš„è¡¨ç°éƒ½ä¸å¤ªâ¼€æ ·ï¼Œä½ ä¼šæ˜¯å“ªç§ååº”å‘¢ï¼Ÿä¸ç®¡æ˜¯å“ªç§æƒ…å†µï¼Œä½ éƒ½åº”å½“å°†å…¶è§†ä¸ºå±é™©ä¿¡å·ï¼Œå‘½ä»¤â¾ƒâ¼°æš‚æ—¶åé€€ï¼Œæ”¾æ…¢èŠ‚å¥ï¼Œåœ¨é‡æ–°æŒæ§å±€â¾¯ä¹‹å‰è®¤çœŸå®¡è§†â¾ƒæˆ‘ã€‚ </p>
<p>æœ‰äº›â¼ˆå–„äºå…³æ³¨â¾ƒâ¼°çš„æƒ…ç»ªååº”ï¼Œéšåæ‰ä¼šç•™æ„â½£ç†ä¸Šçš„å˜åŒ–ã€‚ ä»–ä»¬ä¼šæ„Ÿåˆ°å®³æ€•ã€å—ä¼¤æˆ–æ„¤æ€’ï¼Œç„¶ååŠªâ¼’åšå‡ºååº”æˆ–æ˜¯æŠ‘åˆ¶è¿™äº›æ„Ÿ å—ã€‚è¿™äº›æƒ…ç»ªä¹Ÿæ˜¯å¾ˆå¥½çš„æŒ‡â½°å™¨ï¼Œèƒ½å‘Šè¯‰ä½ ä»€ä¹ˆæ—¶å€™è¯¥åé€€ã€æ”¾æ…¢èŠ‚å¥ï¼Œè®©â¼¤è„‘å›å½’ç†æ€§æ€è€ƒã€‚ </p>
<p>è¿˜æœ‰äº›â¼ˆå–„äºå…³æ³¨â¾ä¸ºâ½…å¼çš„ç»†å¾®å˜åŒ–ã€‚å¯¹ä»–ä»¬æ¥è¯´ï¼Œè¿™äº›å˜åŒ– æ›´åƒæ˜¯â¼€ç§ä½“å¤–æ„Ÿå—ã€‚ä»–ä»¬ä¼šå‘ç°â¾ƒâ¼°æâ¾¼å—“é—¨ï¼Œå¯¹åˆ«â¼ˆæŒ‡â¼¿ç”»è„šï¼Œ æˆ–æ˜¯å˜å¾—â¾®å¸¸å®‰é™ã€‚åªæœ‰å½“æ„è¯†åˆ°è¿™äº›ä¿¡å·æ—¶ï¼Œä»–ä»¬æ‰è®¤è¯†åˆ°â¾ƒâ¼°çš„æ„Ÿå—å‘â½£äº†å˜åŒ–ã€‚</p>
<h2 id="å­¦ä¼šå…³æ³¨å®‰å…¨é—®é¢˜çš„ä¿¡å·"><a href="#å­¦ä¼šå…³æ³¨å®‰å…¨é—®é¢˜çš„ä¿¡å·" class="headerlink" title="å­¦ä¼šå…³æ³¨å®‰å…¨é—®é¢˜çš„ä¿¡å·"></a>å­¦ä¼šå…³æ³¨å®‰å…¨é—®é¢˜çš„ä¿¡å·</h2><p>å½“å¯¹è¯é™·â¼Šå±æœºæ—¶ï¼Œå¦‚æœä½ èƒ½åŠæ—¶å‘ç°ç›¸å…³çš„ä¿¡å·ï¼Œæ‘†è„±å¯¹å¯¹è¯å†…å®¹â½†ä¼‘â½Œçš„äº‰è®ºï¼Œè¿™æ—¶ä½ å°±å¯ä»¥åŒæ—¶å…³æ³¨å¯¹è¯çš„ä¸¤ä¸ªâ½…â¾¯äº†ã€‚<br>åªæœ‰åœ¨å®‰å…¨çš„å¯¹è¯â½“æ°›ä¸­ï¼Œä½ æ‰å¯ä»¥ç•…æ‰€æ¬²â¾”ã€‚è¿™å°±æ˜¯å¯¹è¯â¾¼â¼¿ æ€»æ˜¯å¯†åˆ‡å…³æ³¨å®‰å…¨é—®é¢˜çš„åŸå› ã€‚é¡¾åæ€ä¹‰ï¼Œå¯¹è¯éœ€è¦åŒâ½…å®ç°è§‚ç‚¹çš„â¾ƒç”±äº¤æµã€‚</p>
<p>ä½ ä¸ä½†èƒ½æ„è¯†åˆ°å¯¹è¯ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹é™·å…¥å±æœºï¼Œè€Œä¸”èƒ½è°ƒåŠ¨è‡ªå·±çš„å¤§è„‘è§£å†³é—®é¢˜ã€‚å¦‚å‰æ‰€è¿°ï¼Œå½“æˆ‘ä»¬å‡ºç°æ¿€çƒˆæƒ…ç»ªæ—¶ï¼Œé‡è¦çš„å¤§è„‘æœºèƒ½ä¼šåœæ­¢å·¥ä½œï¼Œä½“å†…çš„åŒ–å­¦æ¿€ç´ ä¼šè¿«ä½¿ä½ åšå‡ºé€ƒè·‘å‡†å¤‡ï¼Œå°±è¿ä½ çš„è§†é‡èŒƒå›´ä¹Ÿä¼šå˜å¾—éå¸¸ç‹­éš˜ã€‚å®é™…ä¸Šï¼Œå½“ä½ æ„Ÿåˆ°å—åˆ°ä¸¥é‡å¨èƒæ—¶ï¼Œé™¤äº†è‡ªæˆ‘é˜²å¾¡ä¹‹å¤–ä½ é¡¾ä¸äº†å…¶ä»–ã€‚</p>
<h2 id="å­¦ä¼šå…³æ³¨å‹åŠ›åº”å¯¹æ–¹å¼"><a href="#å­¦ä¼šå…³æ³¨å‹åŠ›åº”å¯¹æ–¹å¼" class="headerlink" title="å­¦ä¼šå…³æ³¨å‹åŠ›åº”å¯¹æ–¹å¼"></a>å­¦ä¼šå…³æ³¨å‹åŠ›åº”å¯¹æ–¹å¼</h2><p>åœ¨å’Œä»–äººé™·å…¥æ¿€çƒˆäº‰è®ºæ—¶ï¼Œå¤§éƒ¨åˆ†äººéƒ½å¾ˆéš¾æ‘†è„±è¯é¢˜çš„ç‰µå¼•ï¼Œæ¯•ç«Ÿä½ åˆä¸èƒ½è·³å‡ºè‡ªå·±çš„èº«ä½“å®¢è§‚åœ°è§‚å¯Ÿè‡ªæˆ‘ï¼Œè°è®©æˆ‘ä»¬çš„çœ¼ç›æ— æ³•å®¡è§†è‡ªå·±å‘¢ã€‚ </p>
<h2 id="æ³¨æ„è§‚å¯Ÿ"><a href="#æ³¨æ„è§‚å¯Ÿ" class="headerlink" title="æ³¨æ„è§‚å¯Ÿ"></a>æ³¨æ„è§‚å¯Ÿ</h2><ul>
<li>è§‚å¯Ÿå¯¹è¯å†…å®¹å’Œå¯¹è¯æ°”æ°›ã€‚</li>
<li>è§‚å¯Ÿå¯¹è¯å†…å®¹å’Œå¯¹è¯æ°”æ°›ã€‚</li>
<li>è§‚å¯Ÿå®‰å…¨é—®é¢˜ã€</li>
<li>è§‚å¯Ÿå¯¹æ–¹æ˜¯å¦è¿›å…¥æ²‰é»˜æˆ–æš´åŠ›åº”å¯¹çš„çŠ¶æ€</li>
<li>è§‚å¯Ÿä½ çš„é”™è¯¯åº”å¯¹æ–¹å¼ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°</li>
</ul>
<blockquote>
<h1 id="ç¬¬5ç« -ä¿è¯å®‰å…¨-å¦‚ä½•è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€"><a href="#ç¬¬5ç« -ä¿è¯å®‰å…¨-å¦‚ä½•è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€" class="headerlink" title="ç¬¬5ç« ã€€ä¿è¯å®‰å…¨ã€€å¦‚ä½•è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€"></a>ç¬¬5ç« ã€€ä¿è¯å®‰å…¨ã€€å¦‚ä½•è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€</h1></blockquote>
<h2 id="åŠªåŠ›å…³æ³¨å…±åŒç›®çš„å‡ºç°å±æœºçš„ä¿¡å·ã€‚"><a href="#åŠªåŠ›å…³æ³¨å…±åŒç›®çš„å‡ºç°å±æœºçš„ä¿¡å·ã€‚" class="headerlink" title="åŠªåŠ›å…³æ³¨å…±åŒç›®çš„å‡ºç°å±æœºçš„ä¿¡å·ã€‚"></a>åŠªåŠ›å…³æ³¨å…±åŒç›®çš„å‡ºç°å±æœºçš„ä¿¡å·ã€‚</h2><p>å¯»æ‰¾å…±åŒæ€§ï¼Œç›¸äº’å°Šé‡â€”â€”å¯¹è¯æŒç»­å› ç´ <br>è¯šç„¶ï¼Œç¼ºå°‘å…±åŒç›®çš„æ— æ³•å¯åŠ¨å…³é”®å¯¹è¯ï¼Œä½†äº’ç›¸å°Šé‡ä¹ŸåŒæ ·é‡è¦ï¼Œæ²¡æœ‰å®ƒæˆ‘ä»¬å°±æ— æ³•ç»´æŒå…³é”®å¯¹è¯<br>å› æ­¤ï¼Œäº’ç›¸å°Šé‡å¯ä»¥è¯´æ˜¯å¯¹è¯çš„æŒç»­å› ç´ ã€‚å¦‚æœç”¨ä¸€ä¸ªå½¢è±¡çš„æ¯”å–»æ¥è¯´ï¼Œå°Šé‡æ„Ÿå°±åƒç©ºæ°”ï¼Œå½“å®ƒå­˜åœ¨æ—¶ï¼Œæ²¡æœ‰äººä¼šæƒ³åˆ°å®ƒã€‚ä½†æ˜¯ï¼Œå½“ä½ æŠŠå®ƒæ‹¿èµ°ï¼Œäººä»¬è„‘è¢‹é‡Œé¢æƒ³çš„å°±åªæœ‰å°Šé‡ã€‚</p>
<h2 id="æš‚åœå¯¹è¯"><a href="#æš‚åœå¯¹è¯" class="headerlink" title="æš‚åœå¯¹è¯"></a>æš‚åœå¯¹è¯</h2><p>å½“å¯¹æ–¹å‡ºç°æ²‰é»˜æˆ–æš´åŠ›åº”å¯¹çš„æƒ…å†µæ—¶ï¼Œä½ åº”å½“æš‚åœå¯¹è¯ï¼Œè¥é€ å®‰å…¨æ°”æ°›ã€‚å®‰å…¨æ„Ÿä¸€æ—¦æ¢å¤ï¼Œä½ å°±å¯ä»¥ç»§ç»­è¿›è¡Œå¯¹è¯äº†<br>å…¶ä¸­æƒ…ç»ªå˜åŒ–æ˜¯ä¸€ä¸ªå…³é”®çº¿ç´¢ã€‚å½“äººä»¬æ„Ÿåˆ°ä¸å—å°Šé‡æ—¶ï¼Œä»–ä»¬ä¼šå˜å¾—éå¸¸æƒ…ç»ªåŒ–ï¼Œä»ææƒ§å˜å¾—æ„¤æ€’å¼‚å¸¸</p>
<h2 id="æ€æ ·æ‰èƒ½å®ç°è¿™äº›ç›®æ ‡å‘¢ï¼Ÿ"><a href="#æ€æ ·æ‰èƒ½å®ç°è¿™äº›ç›®æ ‡å‘¢ï¼Ÿ" class="headerlink" title="æ€æ ·æ‰èƒ½å®ç°è¿™äº›ç›®æ ‡å‘¢ï¼Ÿ"></a>æ€æ ·æ‰èƒ½å®ç°è¿™äº›ç›®æ ‡å‘¢ï¼Ÿ</h2><p>ä»‹ç»ä¸‰ç§éå¸¸æœ‰æ•ˆçš„åº”å¯¹æŠ€å·§ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>é“æ­‰</li>
<li>å¯¹æ¯”è¯´æ˜</li>
<li>åˆ›å»ºå…±åŒç›®çš„</li>
</ul>
<h3 id="å…±åŒç›®çš„"><a href="#å…±åŒç›®çš„" class="headerlink" title="å…±åŒç›®çš„"></a>å…±åŒç›®çš„</h3><ul>
<li>å¯¹æ–¹æ˜¯å¦è§‰å¾—ä½ åœ¨å¯¹è¯è¿‡ç¨‹ä¸­å…³æ³¨ä»–ä»¬çš„ç›®çš„ï¼Ÿæ˜¯å¦è®¤åŒä½ çš„å¯¹è¯åŠ¨æœºï¼Ÿ</li>
<li>åœ¨è¾¾æˆå…±åŒç›®çš„ä¹‹å‰ï¼Œä½ å¿…é¡»é¦–å…ˆäº†è§£å¯¹æ–¹çš„çœŸæ­£ç›®çš„æ˜¯ä»€ä¹ˆã€‚å› æ­¤ï¼Œä½ åº”å½“æš‚åœå…ˆå‰çš„å¯¹è¯å†…å®¹ï¼ˆå› ä¸ºå®ƒå…³æ³¨çš„æ˜¯ç­–ç•¥ï¼‰ï¼Œè½¬è€Œæ¢ç´¢ç­–ç•¥èƒŒåéšè—çš„ç›®çš„</li>
<li>å½“ä½ æˆåŠŸåŒºåˆ†ç­–ç•¥å’Œç›®çš„ä¹‹åï¼Œæ–°çš„é€‰æ‹©è‡ªç„¶å°±ä¼šå‡ºç°ã€‚æ”¾æ¾å¯¹è¡ŒåŠ¨ç­–ç•¥çš„å…³æ³¨ï¼Œå¼ºè°ƒä½ çš„çœŸæ­£ç›®çš„ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©ä½ æ‹“å±•æ€ç»´ç©ºé—´ï¼Œæ‰¾åˆ°å¯¹åŒæ–¹éƒ½æœ‰åˆ©çš„é€‰æ‹©æ–¹æ¡ˆ</li>
</ul>
<h3 id="å¯¹æ¯”æ³•"><a href="#å¯¹æ¯”æ³•" class="headerlink" title="å¯¹æ¯”æ³•"></a>å¯¹æ¯”æ³•</h3><ul>
<li>å¯¹æ¯”æ³•å¯æä¾›èƒŒæ™¯å’Œå¹³è¡¡</li>
<li>å¯¹æ¯”æ³•å¯é¢„é˜²æˆ–æ•‘æ€¥</li>
</ul>
<h3 id="çœŸè¯šé“æ­‰"><a href="#çœŸè¯šé“æ­‰" class="headerlink" title="çœŸè¯šé“æ­‰"></a>çœŸè¯šé“æ­‰</h3><p>å½“ç„¶ï¼Œå¦‚æœå†…å¿ƒæ²¡æœ‰çœŸæ­£æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œå£å¤´ä¸Šçš„é“æ­‰å¹¶ä¸æ˜¯çœŸè¯šçš„é“æ­‰ã€‚è¦æƒ³åšå‡ºçœŸè¯šé“æ­‰ï¼Œä½ å¿…é¡»æ”¹å˜è‡ªå·±çš„åŠ¨æœºï¼Œæ”¾å¼ƒä»€ä¹ˆé¢å­ã€äº‰å¼ºå¥½èƒœä»¥åŠâ€œåªæœ‰æˆ‘æ˜¯æ­£ç¡®çš„â€ä¹‹ç±»çš„é”™è¯¯æƒ³æ³•ï¼Œå­¦ä¼šå…³æ³¨è‡ªå·±çš„çœŸæ­£ç›®çš„<br>åˆ©ç”¨å¯¹æ¯”æ³•æ¶ˆé™¤è¯¯ä¼š</p>
<h3 id="è¥é€ å®‰å…¨æ°›å›´æ°¸è¿œæ˜¯ç¬¬ä¸€ä½çš„"><a href="#è¥é€ å®‰å…¨æ°›å›´æ°¸è¿œæ˜¯ç¬¬ä¸€ä½çš„" class="headerlink" title="è¥é€ å®‰å…¨æ°›å›´æ°¸è¿œæ˜¯ç¬¬ä¸€ä½çš„"></a>è¥é€ å®‰å…¨æ°›å›´æ°¸è¿œæ˜¯ç¬¬ä¸€ä½çš„</h3><ul>
<li>ç§¯æå¯»æ‰¾å…±åŒç›®çš„</li>
<li>ç§¯æå¯»æ‰¾å…±åŒç›®çš„</li>
<li>ç§¯æå¯»æ‰¾å…±åŒç›®çš„</li>
<li>å’Œå¯¹æ–¹å…±åŒæ„æ€æ–°ç­–ç•¥</li>
</ul>
<blockquote>
<h1 id="ç¬¬6ç« -æ§åˆ¶æƒ³æ³•-å¦‚ä½•åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯"><a href="#ç¬¬6ç« -æ§åˆ¶æƒ³æ³•-å¦‚ä½•åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯" class="headerlink" title="ç¬¬6ç« ã€€æ§åˆ¶æƒ³æ³•ã€€å¦‚ä½•åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯"></a>ç¬¬6ç« ã€€æ§åˆ¶æƒ³æ³•ã€€å¦‚ä½•åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯</h1></blockquote>
<h2 id="æŒæ§æƒ…ç»ª"><a href="#æŒæ§æƒ…ç»ª" class="headerlink" title="æŒæ§æƒ…ç»ª"></a>æŒæ§æƒ…ç»ª</h2><p>å®é™…ä¸Šå…¶ä»–äººæ˜¯æ— æ³•è®©ä½ é™·å…¥æŸç§æƒ…ç»ªçš„ï¼Œæ˜¯ä½ åˆ¶é€ äº†è‡ªå·±çš„æƒ…ç»ªï¼Œæ˜¯ä½ è®©è‡ªå·±æ„Ÿåˆ°å®³æ€•ã€çƒ¦æ¼æˆ–æ°”æ„¤ï¼Œäº§ç”Ÿè´Ÿé¢æƒ…ç»ªåä½ åªæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆæ§åˆ¶å®ƒï¼Œè¦ä¹ˆè¢«å®ƒæ§åˆ¶ã€‚<br>ä½ åº”å½“åšä¿¡çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ä½†èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œè€Œä¸”å¿…é¡»åšåˆ°è¿™ä¸€ç‚¹ã€‚ä¸–äº‹æœ¬æ— å¥½åï¼Œçš†å› æ€æƒ³ä½¿ç„¶ã€‚<br>æ¯«æ— ç–‘é—®ï¼Œäº†è§£è‡ªå·±çš„æ„Ÿå—è‡³å…³é‡è¦ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ åº”å½“å­¦ä¼šç”¨æ›´å‡†ç¡®çš„è¯æ±‡æ¥å½¢å®¹æƒ…ç»ªæ„Ÿå—</p>
<h2 id="æƒ…ç»ªæ¨¡å¼"><a href="#æƒ…ç»ªæ¨¡å¼" class="headerlink" title="æƒ…ç»ªæ¨¡å¼"></a>æƒ…ç»ªæ¨¡å¼</h2><p>ç¬¬ä¸€ç§å°èªæ˜æ˜¯å—å®³è€…æƒ³æ³•ï¼šå¤§åæ´¾æƒ³æ³•â€”â€”â€œè¿™éƒ½æ˜¯ä½ é€ æˆçš„<br>ç¬¬äºŒç§æ— åŠ©è€…æƒ³æ³•ï¼šå½“ä½ ä¸å†æŠŠè‡ªå·±è§†ä¸ºæ— åŠ©è€…æ—¶ï¼Œå°±å¯ä»¥ç§¯ææ‰¿æ‹…å¯¹è¯è´£ä»»ï¼Œè€Œä¸æ˜¯ä¸€å‘³æŠ±æ€¨é—®é¢˜äº†</p>
<h2 id="è¡Œä¸ºæ–¹å¼å›é¡¾"><a href="#è¡Œä¸ºæ–¹å¼å›é¡¾" class="headerlink" title="è¡Œä¸ºæ–¹å¼å›é¡¾"></a>è¡Œä¸ºæ–¹å¼å›é¡¾</h2><h3 id="æˆ‘æ˜¯å¦é™·å…¥äº†æ²‰é»˜æˆ–æš´åŠ›åº”å¯¹æ–¹å¼ï¼Ÿ"><a href="#æˆ‘æ˜¯å¦é™·å…¥äº†æ²‰é»˜æˆ–æš´åŠ›åº”å¯¹æ–¹å¼ï¼Ÿ" class="headerlink" title="æˆ‘æ˜¯å¦é™·å…¥äº†æ²‰é»˜æˆ–æš´åŠ›åº”å¯¹æ–¹å¼ï¼Ÿ"></a>æˆ‘æ˜¯å¦é™·å…¥äº†æ²‰é»˜æˆ–æš´åŠ›åº”å¯¹æ–¹å¼ï¼Ÿ</h3><p>ç¡®å®šè¡Œä¸ºèƒŒåçš„æ„Ÿå—ã€‚å­¦ä¼šå‡†ç¡®è¯†åˆ«è¡Œä¸ºèƒŒåçš„æƒ…ç»ªã€‚</p>
<h3 id="å¯¼è‡´è¿™ç§è¡Œä¸ºçš„æƒ…ç»ªæ„Ÿå—æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¯¼è‡´è¿™ç§è¡Œä¸ºçš„æƒ…ç»ªæ„Ÿå—æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¯¼è‡´è¿™ç§è¡Œä¸ºçš„æƒ…ç»ªæ„Ÿå—æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¯¼è‡´è¿™ç§è¡Œä¸ºçš„æƒ…ç»ªæ„Ÿå—æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>åˆ†ææ„Ÿå—èƒŒåçš„æƒ³æ³•ã€‚å­¦ä¼šè´¨ç–‘ä½ çš„ç»“è®ºï¼Œå¯»æ‰¾æ„Ÿå—èƒŒåå…¶ä»–çš„å¯èƒ½è§£é‡Šã€‚</p>
<h3 id="é€ æˆè¿™ç§æƒ…ç»ªå‡ºç°çš„æƒ³æ³•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#é€ æˆè¿™ç§æƒ…ç»ªå‡ºç°çš„æƒ³æ³•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="é€ æˆè¿™ç§æƒ…ç»ªå‡ºç°çš„æƒ³æ³•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>é€ æˆè¿™ç§æƒ…ç»ªå‡ºç°çš„æƒ³æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å¯»æ‰¾æƒ³æ³•èƒŒåçš„äº‹å®ã€‚å›åˆ°äº‹å®æœ¬èº«ï¼Œæ”¾å¼ƒç»å¯¹è¡¨è¾¾ï¼ŒåŒºåˆ«å®¢è§‚äº‹å®å’Œä¸»è§‚æƒ³æ³•çš„åŒºåˆ«ã€‚</p>
<h3 id="å½¢æˆè¿™ç§æƒ³æ³•çš„äº‹å®ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å½¢æˆè¿™ç§æƒ³æ³•çš„äº‹å®ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å½¢æˆè¿™ç§æƒ³æ³•çš„äº‹å®ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å½¢æˆè¿™ç§æƒ³æ³•çš„äº‹å®ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æ³¨æ„ä¼¼æ˜¯è€Œéçš„â€œå°èªæ˜â€å¼æƒ³æ³•ã€‚å°¤å…¶æ˜¯å—å®³è€…æƒ³æ³•ã€å¤§åæ´¾æƒ³æ³•å’Œæ— åŠ©è€…æƒ³æ³•ã€‚</p>
<h2 id="æ”¹å˜ä¸»è§‚è‡†æ–­"><a href="#æ”¹å˜ä¸»è§‚è‡†æ–­" class="headerlink" title="æ”¹å˜ä¸»è§‚è‡†æ–­"></a>æ”¹å˜ä¸»è§‚è‡†æ–­</h2><ul>
<li>æˆ‘æ˜¯å¦æ•…æ„å¿½ç•¥è‡ªå·±åœ¨è¿™ä¸ªé—®é¢˜ä¸­çš„è´£ä»»ï¼Ÿ</li>
<li>ä¸€ä¸ªç†æ™ºè€Œæ­£å¸¸çš„äººä¸ºä»€ä¹ˆä¼šè¿™æ ·åšï¼Ÿ</li>
<li>æˆ‘çš„çœŸå®ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>è¦æƒ³å®ç°è¿™äº›ç›®çš„ç°åœ¨æˆ‘è¯¥æ€ä¹ˆåšï¼Ÿ</li>
</ul>
<blockquote>
<h1 id="ç¬¬7ç« -é™ˆè¿°è§‚ç‚¹-å¦‚ä½•å¾ªå¾ªå–„è¯±è€Œéç‹¬æ–­ä¸“è¡Œ"><a href="#ç¬¬7ç« -é™ˆè¿°è§‚ç‚¹-å¦‚ä½•å¾ªå¾ªå–„è¯±è€Œéç‹¬æ–­ä¸“è¡Œ" class="headerlink" title="ç¬¬7ç« ã€€é™ˆè¿°è§‚ç‚¹ã€€å¦‚ä½•å¾ªå¾ªå–„è¯±è€Œéç‹¬æ–­ä¸“è¡Œ"></a>ç¬¬7ç« ã€€é™ˆè¿°è§‚ç‚¹ã€€å¦‚ä½•å¾ªå¾ªå–„è¯±è€Œéç‹¬æ–­ä¸“è¡Œ</h1></blockquote>
<h2 id="ä¿è¯å…³é”®å¯¹è¯å®‰å…¨"><a href="#ä¿è¯å…³é”®å¯¹è¯å®‰å…¨" class="headerlink" title="ä¿è¯å…³é”®å¯¹è¯å®‰å…¨"></a>ä¿è¯å…³é”®å¯¹è¯å®‰å…¨</h2><p>é¦–å…ˆè®¤çœŸå®¡è§†è‡ªæˆ‘ï¼Œå¯†åˆ‡å…³æ³¨å…³é”®å¯¹è¯ï¼ˆç‰¹åˆ«æ˜¯å½“å¯¹æ–¹æ„Ÿåˆ°å¤±å»å®‰å…¨æ„Ÿæ—¶ï¼‰ï¼Œåœ¨å¿…è¦çš„æ—¶å€™æ¢å¤å®‰å…¨æ°”æ°›ï¼Œè¿˜æœ‰å°±æ˜¯åƒä¸‡ä¸è¦ä¸ºè‡ªå·±çš„æƒ…ç»ªå¯»æ‰¾é”™è¯¯çš„å€Ÿå£</p>
<h2 id="é‡‡ç”¨ç»¼åˆé™ˆè¿°æ³•"><a href="#é‡‡ç”¨ç»¼åˆé™ˆè¿°æ³•" class="headerlink" title="é‡‡ç”¨ç»¼åˆé™ˆè¿°æ³•"></a>é‡‡ç”¨ç»¼åˆé™ˆè¿°æ³•</h2><ol>
<li>åˆ†äº«äº‹å®ç»è¿‡ã€‚ä»æœ€å°‘äº‰è®®ã€æœ€æœ‰è¯´æœåŠ›çš„äº‹å®è°ˆèµ·ã€‚</li>
<li>è¯´å‡ºä½ çš„æƒ³æ³•ã€‚è¯´æ˜ä½ æ ¹æ®è¿™äº›äº‹å®å¾—å‡ºçš„ç»“è®ºã€‚</li>
<li>å¾è¯¢å¯¹æ–¹è§‚ç‚¹ã€‚é¼“åŠ±å¯¹æ–¹è¯´å‡ºä»–ä»¬çœ‹åˆ°çš„äº‹å®å’Œäº§ç”Ÿçš„æƒ³æ³•ã€‚Â·</li>
<li>åšå‡ºè¯•æ¢è¡¨è¿°ã€‚æ‰¿è®¤è¿™äº›ç»“è®ºåªæ˜¯ä½ çš„æƒ³æ³•ï¼Œä¸è¦å‡è£…æ˜¯äº‹å®ã€‚é¼“åŠ±åšå‡ºå°è¯•ã€‚</li>
<li>åˆ›å»ºå®‰å…¨æ„Ÿï¼Œé¼“åŠ±å¯¹æ–¹è¯´å‡ºä¸åŒç”šè‡³å¯¹ç«‹çš„è§‚ç‚¹ã€‚</li>
</ol>
<blockquote>
<h1 id="ç¬¬8ç« -äº†è§£åŠ¨æœº-å¸®åŠ©å¯¹æ–¹æ‘†è„±æ²‰é»˜æˆ–æš´åŠ›çŠ¶ä½“"><a href="#ç¬¬8ç« -äº†è§£åŠ¨æœº-å¸®åŠ©å¯¹æ–¹æ‘†è„±æ²‰é»˜æˆ–æš´åŠ›çŠ¶ä½“" class="headerlink" title="ç¬¬8ç« ã€€äº†è§£åŠ¨æœºã€€å¸®åŠ©å¯¹æ–¹æ‘†è„±æ²‰é»˜æˆ–æš´åŠ›çŠ¶ä½“"></a>ç¬¬8ç« ã€€äº†è§£åŠ¨æœºã€€å¸®åŠ©å¯¹æ–¹æ‘†è„±æ²‰é»˜æˆ–æš´åŠ›çŠ¶ä½“</h1></blockquote>
<h2 id="äº†è§£åŠ¨æœº"><a href="#äº†è§£åŠ¨æœº" class="headerlink" title="äº†è§£åŠ¨æœº"></a>äº†è§£åŠ¨æœº</h2><p>è¦æƒ³é¼“åŠ±è§‚ç‚¹çš„è‡ªç”±äº¤æµï¼Œå¸®åŠ©å¯¹æ–¹æ‘†è„±æ²‰é»˜æˆ–æš´åŠ›çš„é”™è¯¯åº”å¯¹æ–¹å¼ï¼Œä½ åº”å½“äº†è§£ä»–ä»¬çš„è¡Œä¸ºåŠ¨æœºï¼Œåº”å½“åœ¨å¯¹è¯ä¸­è¡¨ç°å‡ºå·¨å¤§çš„å¥½å¥‡å¿ƒå’Œè€å¿ƒï¼Œåªæœ‰è¿™æ ·æ‰èƒ½æ¢å¤å®‰å…¨æ„Ÿã€‚</p>
<h2 id="å››ç§æœ‰æ•ˆçš„å€¾å¬æŠ€å·§"><a href="#å››ç§æœ‰æ•ˆçš„å€¾å¬æŠ€å·§" class="headerlink" title="å››ç§æœ‰æ•ˆçš„å€¾å¬æŠ€å·§"></a>å››ç§æœ‰æ•ˆçš„å€¾å¬æŠ€å·§</h2><ol>
<li>è¯¢é—®è§‚ç‚¹ã€‚è¡¨æ˜ä½ å¾ˆæœ‰å…´è¶£äº†è§£å¯¹æ–¹çš„çœ‹æ³•ã€‚</li>
<li>ç¡®è®¤æ„Ÿå—ã€‚é€šè¿‡è¡¨ç¤ºé«˜åº¦ç†è§£å¯¹æ–¹çš„æ„Ÿå—å¢å¼ºå®‰å…¨æ„Ÿã€‚</li>
<li>é‡æ–°æè¿°ã€‚å½“å¯¹æ–¹è¯´å‡ºè‡ªå·±çš„çœ‹æ³•æ—¶ï¼Œä½ åº”å½“é‡è¿°ä»–ä»¬çš„è¡¨è¾¾ï¼Œè¡¨æ˜è‡ªå·±ä¸ä½†ç†è§£å…¶è§‚ç‚¹ï¼Œè€Œä¸”é¼“åŠ±ä»–ä»¬åˆ†äº«å†…å¿ƒçš„æƒ³æ³•ã€‚</li>
<li>ä¸»åŠ¨å¼•å¯¼ã€‚å¦‚æœå¯¹æ–¹è¿˜æ˜¯é€€ç¼©è¿Ÿç–‘ï¼Œä½ åº”å½“â€œå…ˆå‘åˆ¶äººâ€ï¼Œå¯¹ä»–ä»¬çš„æƒ³æ³•æˆ–æ„Ÿå—åšå‡ºæœ€ç¬¦åˆæƒ…å†µçš„çŒœæµ‹ã€‚</li>
</ol>
<h2 id="å€¾å¬çš„æ³¨æ„äº‹é¡¹"><a href="#å€¾å¬çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="å€¾å¬çš„æ³¨æ„äº‹é¡¹"></a>å€¾å¬çš„æ³¨æ„äº‹é¡¹</h2><ul>
<li>èµåŒã€‚åœ¨åˆ†äº«è§‚ç‚¹æ—¶å¯¹ä»–äººè¡¨ç¤ºèµåŒã€‚</li>
<li>è¡¥å……ã€‚å¦‚æœå¯¹æ–¹çš„è§‚ç‚¹æœ‰é—æ¼ä¹‹å¤„ï¼ŒèµåŒä½ ä»¬å…±äº«çš„éƒ¨åˆ†ï¼Œç„¶ååšå‡ºè¡¥å……ã€‚</li>
<li>æ¯”è¾ƒã€‚å½“ä½ ä»¬çš„è§‚ç‚¹ç›¸å·®ç”šè¿œæ—¶ï¼Œä¸è¦ç®€å•åœ°è®¤ä¸ºå¯¹æ–¹æ˜¯é”™è¯¯çš„ï¼Œè€Œåº”å½“æŠŠä½ ä»¬çš„çœ‹æ³•è¿›è¡Œæ¯”è¾ƒã€‚</li>
</ul>
<blockquote>
<h1 id="ç¬¬9ç« -å¼€å§‹è¡ŒåŠ¨-å¦‚ä½•æŠŠå…³é”®å¯¹è¯å˜æˆè¡ŒåŠ¨ç»“æœ"><a href="#ç¬¬9ç« -å¼€å§‹è¡ŒåŠ¨-å¦‚ä½•æŠŠå…³é”®å¯¹è¯å˜æˆè¡ŒåŠ¨ç»“æœ" class="headerlink" title="ç¬¬9ç« ã€€å¼€å§‹è¡ŒåŠ¨ã€€å¦‚ä½•æŠŠå…³é”®å¯¹è¯å˜æˆè¡ŒåŠ¨ç»“æœ"></a>ç¬¬9ç« ã€€å¼€å§‹è¡ŒåŠ¨ã€€å¦‚ä½•æŠŠå…³é”®å¯¹è¯å˜æˆè¡ŒåŠ¨ç»“æœ</h1></blockquote>
<h2 id="å¼€å§‹è¡ŒåŠ¨"><a href="#å¼€å§‹è¡ŒåŠ¨" class="headerlink" title="å¼€å§‹è¡ŒåŠ¨"></a>å¼€å§‹è¡ŒåŠ¨</h2><p>è¦æƒ³æŠŠæˆåŠŸçš„å…³é”®å¯¹è¯è½¬å˜æˆä¼˜ç§€çš„å†³ç­–å’Œä¸€è‡´çš„è¡ŒåŠ¨ï¼Œä½ åº”å½“åŠªåŠ›é¿å…é”™è¯¯æœŸæœ›å’Œä¸ä½œä¸ºä¸¤ç§é™·é˜±ã€‚</p>
<h2 id="å†³å®šå¦‚ä½•å†³ç­–"><a href="#å†³å®šå¦‚ä½•å†³ç­–" class="headerlink" title="å†³å®šå¦‚ä½•å†³ç­–"></a>å†³å®šå¦‚ä½•å†³ç­–</h2><ul>
<li>å‘½ä»¤å¼ã€‚æ— é¡»å‚ä¸çš„å†³ç­–æ–¹å¼ã€‚</li>
<li>é¡¾é—®å¼ã€‚å¹¿æ³›å¾é›†æ„è§ï¼Œç”±å°‘æ•°äººå†³å®šçš„å†³ç­–æ–¹å¼ã€‚</li>
<li>æŠ•ç¥¨å¼ã€‚ä»¥æ”¯æŒç‡ä¸ºåŸºç¡€çš„å†³ç­–æ–¹å¼ã€‚</li>
<li>å…±è¯†å¼ã€‚äººäººéƒ½å¿…é¡»å¯¹æœ€ç»ˆç»“æœè¡¨ç¤ºåŒæ„çš„å†³ç­–æ–¹å¼ã€‚</li>
</ul>
<h2 id="æ˜ç¡®æ‰§è¡Œç»†èŠ‚"><a href="#æ˜ç¡®æ‰§è¡Œç»†èŠ‚" class="headerlink" title="æ˜ç¡®æ‰§è¡Œç»†èŠ‚"></a>æ˜ç¡®æ‰§è¡Œç»†èŠ‚</h2><p>åœ¨å†³ç­–æ‰§è¡Œç¯èŠ‚ï¼Œä½ å¿…é¡»æ˜ç¡®è¯´æ˜è¡ŒåŠ¨äººã€è¡ŒåŠ¨ç›®æ ‡å’Œæˆªæ­¢æ—¶é—´ç­‰è¦ç´ ã€‚æ˜ç¡®è¡Œä¸ºç›®æ ‡ï¼Œè®¾å®šæ£€æŸ¥æ—¶é—´ï¼Œè®°å½•ä»»åŠ¡ç»†èŠ‚å¹¶æŒ‰æ—¶è¿›è¡Œæ£€æŸ¥ã€‚æœ€åï¼Œä½ åº”å½“ç£ä¿ƒäººä»¬å¯¹å…¶åšå‡ºçš„æ‰¿è¯ºè´Ÿè´£ã€‚</p>
<blockquote>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸‹ç»“åˆä¸ªäººçš„æƒ³æ³•ã€è®¤çŸ¥å’Œæ„Ÿå—è¯´è¯´å…³é”®å¯¹è¯æ ¸å¿ƒè¦ç‚¹åœ¨æ²Ÿé€šä¸­çš„æ„ä¹‰åŠä½œç”¨ã€‚</p>
</blockquote>
<h2 id="ç¡®å®šç›®æ ‡"><a href="#ç¡®å®šç›®æ ‡" class="headerlink" title="ç¡®å®šç›®æ ‡"></a>ç¡®å®šç›®æ ‡</h2><p>æ˜ç¡®æ²Ÿé€šçš„ç›®æ ‡ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆé˜²æ­¢æ²Ÿé€šå†…å®¹å‘æ•£ã€é—®é¢˜å‡çº§ã€æƒ…ç»ªå¤±æ§ã€‚</p>
<h2 id="åˆ›é€ å®‰å…¨å¯¹è¯æ°›å›´"><a href="#åˆ›é€ å®‰å…¨å¯¹è¯æ°›å›´" class="headerlink" title="åˆ›é€ å®‰å…¨å¯¹è¯æ°›å›´"></a>åˆ›é€ å®‰å…¨å¯¹è¯æ°›å›´</h2><p>æ²Ÿé€šæ˜¯åŒæ–¹è§‚ç‚¹çš„äº¤æµï¼Œæœ€åå¹¶è¾¾æˆä¸€è‡´ï¼Œè€Œä¸æ˜¯å‘å·æ–½ä»¤ã€‚è€Œå¦‚ä½•èƒ½å¤Ÿè®©å¯¹æ–¹åœ¨é‡è¦é—®é¢˜ä¸Šè¡¨è¾¾è‡ªå·±çš„æƒ³æ³•å’Œè§‚ç‚¹ï¼Œæ˜¯æ²Ÿé€šæˆåŠŸçš„å…³é”®ã€‚é¦–å…ˆæˆ‘ä»¬å¿…é¡»ç¡®ä¿åˆ›å»ºå®‰å…¨çš„å¯¹è¯æ°›å›´ï¼Œåªæœ‰åœ¨å®‰å…¨çš„æ°›å›´ä¸‹æ²Ÿé€šè€…æ‰ä¼šè¯´å‡ºè‡ªå·±çš„çœŸæ˜¯æƒ³æ³•ã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½åˆ›å»ºå®‰å…¨çš„å¯¹è¯æ°›å›´ï¼Œè¦ä¹ˆå¯¹æ–¹æƒ…ç»ªæ¿€åŠ¨è€Œè¨€ä¸ç”±è¡·ï¼Œè¦ä¹ˆæ²‰é»˜åº”å¯¹ï¼Œæœ€åå¯¼è‡´æ²Ÿé€šå¤±è´¥ã€‚</p>
<h2 id="è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€"><a href="#è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€" class="headerlink" title="è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€"></a>è®©å¯¹æ–¹ç•…æ‰€æ¬²è¨€</h2><p>å½“å¯¹è¯å‡ºç°ä¸å®‰å…¨çš„ä¿¡å·æ—¶ï¼Œä¸‰ç§éå¸¸æœ‰æ•ˆçš„åº”å¯¹æŠ€å·§å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¢å¤å®‰å…¨å¯¹è¯çš„æ°›å›´ï¼š</p>
<ul>
<li>é“æ­‰</li>
<li>åˆ›å»ºå…±åŒç›®çš„</li>
<li>å¯¹æ¯”è¯´æ˜</li>
</ul>
<h2 id="é¿å…åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯"><a href="#é¿å…åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯" class="headerlink" title="é¿å…åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯"></a>é¿å…åœ¨æ„¤æ€’ã€ææƒ§æˆ–å—ä¼¤çš„æƒ…å†µä¸‹å±•å¼€å¯¹è¯</h2><p>æ²Ÿé€šä¸­å…¶å®æœ€éš¾æ§åˆ¶çš„æ˜¯æ¿€çƒˆçš„æƒ…ç»ªï¼Œä¸€æ—¦è¿›å…¥æ¿€åŠ¨çš„çŠ¶æ€ä»¥åï¼Œè‚¾ä¸Šè…ºç´ ç‹‚é£™ï¼Œäººä»¬ä¼šè¿›å…¥ä¸€ç§åº”æ¿€é˜²å¾¡çŠ¶æ€ï¼Œè¿™æ—¶å¾€å¾€è¯´å‡ºä¸€äº›è¨€ä¸ç”±è¡·çš„è¯ï¼Œäº‹ååˆ™åæ‚”ä¸å·²ã€‚å¯¹äºè¿™ä¸€ç‚¹ï¼Œæœ‰ä¸¤ä¸ªæ–¹å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼Œä¸€æ˜¯æˆ‘ä»¬è¦æœ‰å®¡è§†è‡ªæˆ‘çš„æ„è¯†ï¼ŒäºŒæ˜¯è¦ç‰¢è®°æ²Ÿé€šå¯¹è¯çš„ç›®çš„ã€‚</p>
<p>å®é™…ä¸Šå…¶ä»–äººæ˜¯æ— æ³•è®©ä½ é™·å…¥æŸç§æƒ…ç»ªçš„ï¼Œæ˜¯ä½ åˆ¶é€ äº†è‡ªå·±çš„æƒ…ç»ªï¼Œæ˜¯ä½ è®©è‡ªå·±æ„Ÿåˆ°å®³æ€•ã€çƒ¦æ¼æˆ–æ°”æ„¤ï¼Œäº§ç”Ÿè´Ÿé¢æƒ…ç»ªåä½ åªæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆæ§åˆ¶å®ƒï¼Œè¦ä¹ˆè¢«å®ƒæ§åˆ¶ã€‚</p>
<h2 id="ç»¼åˆé™ˆè¿°æ³•"><a href="#ç»¼åˆé™ˆè¿°æ³•" class="headerlink" title="ç»¼åˆé™ˆè¿°æ³•"></a>ç»¼åˆé™ˆè¿°æ³•</h2><p>ç»¼åˆé™ˆè¿°æ³•æ˜¯æˆ‘ä»¬è¡¨è¾¾è‡ªå·±è§‚ç‚¹çš„é‡è¦çš„æ–¹å¼ï¼Œæ˜¯æœ€ä¸ºåŸºç¡€ä¹Ÿæ˜¯æœ€ä¸ºé‡è¦çš„ï¼Œæˆ‘ä»¬è¦åŸºäºå®¢è§‚äº‹å®é™ˆè¿°ï¼Œé¿å…ä»¥åæ¦‚å…¨æˆ–è¯¯è§£çš„æƒ…å†µã€‚</p>
<ul>
<li>åˆ†äº«äº‹å®ç»è¿‡ã€‚ä»æœ€å°‘äº‰è®®ã€æœ€æœ‰è¯´æœåŠ›çš„äº‹å®è°ˆèµ·ã€‚</li>
<li>è¯´å‡ºä½ çš„æƒ³æ³•ã€‚è¯´æ˜ä½ æ ¹æ®è¿™äº›äº‹å®å¾—å‡ºçš„ç»“è®ºã€‚</li>
<li>å¾è¯¢å¯¹æ–¹è§‚ç‚¹ã€‚é¼“åŠ±å¯¹æ–¹è¯´å‡ºä»–ä»¬çœ‹åˆ°çš„äº‹å®å’Œäº§ç”Ÿçš„æƒ³æ³•ã€‚</li>
<li>åšå‡ºè¯•æ¢è¡¨è¿°ã€‚æ‰¿è®¤è¿™äº›ç»“è®ºåªæ˜¯ä½ çš„æƒ³æ³•ï¼Œä¸è¦å‡è£…æ˜¯äº‹å®ã€‚é¼“åŠ±åšå‡ºå°è¯•ã€‚</li>
<li>åˆ›å»ºå®‰å…¨æ„Ÿï¼Œé¼“åŠ±å¯¹æ–¹è¯´å‡ºä¸åŒç”šè‡³å¯¹ç«‹çš„è§‚ç‚¹ã€‚</li>
</ul>
<h2 id="äº†è§£åŠ¨æœº-1"><a href="#äº†è§£åŠ¨æœº-1" class="headerlink" title="äº†è§£åŠ¨æœº"></a>äº†è§£åŠ¨æœº</h2><p>è¦æƒ³é¼“åŠ±è§‚ç‚¹çš„è‡ªç”±äº¤æµï¼Œå¸®åŠ©å¯¹æ–¹æ‘†è„±æ²‰é»˜æˆ–æš´åŠ›çš„é”™è¯¯åº”å¯¹æ–¹å¼ï¼Œä½ åº”å½“äº†è§£ä»–ä»¬çš„è¡Œä¸ºåŠ¨æœºï¼Œåº”å½“åœ¨å¯¹è¯ä¸­è¡¨ç°å‡ºå·¨å¤§çš„å¥½å¥‡å¿ƒå’Œè€å¿ƒï¼Œåªæœ‰è¿™æ ·æ‰èƒ½æ¢å¤å®‰å…¨æ„Ÿ.</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>å…³é”®å¯¹è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šæç®€ä¸»ä¹‰ã€‹</title>
    <url>/2021/02/16/book/ji-jian-zhu-yi/</url>
    <content><![CDATA[<p><img src="/images/%E6%9E%81%E7%AE%80%E4%B8%BB%E4%B9%89.jpg" alt="æç®€ä¸»ä¹‰"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><em><strong>ã€Šæç®€ä¸»ä¹‰ã€‹â€”â€” æ´»å‡ºç”Ÿå‘½çœŸæ„</strong></em></p>
<blockquote>
<p>[ç¾]ä¹”èˆ’äºšÂ·è²å°”èŒ¨Â·ç±³å°”æœ¬ ç‘å®‰Â·å°¼ç§‘è¿ªé»˜æ–¯ â€”â€” è‘—<br>æç´« â€”â€” è¯‘</p>
</blockquote>
<h1 id="ä¹¦åº"><a href="#ä¹¦åº" class="headerlink" title="ä¹¦åº"></a>ä¹¦åº</h1><p>æç®€ä¸»ä¹‰ä¸æ˜¯è¦ä½ ä¸€æ— æ‰€æœ‰ï¼Œè€Œæ˜¯è¦ä½ ç©¿è¶Šç‰©è´¨çš„æµ·æ´‹ï¼Œæ‰¾åˆ°çœŸæ­£é‡è¦çš„ä¸œè¥¿ã€‚åœ¨ã€Šæç®€ä¸»ä¹‰ã€‹ä¸€ä¹¦ä¸­ï¼Œæ”¾å¼ƒé«˜è–ªä¸»ç®¡å·¥ä½œã€è½¬èº«æˆä¸ºç¾å›½æç®€ä¸»ä¹‰ç”Ÿæ´»å…ˆé”‹çš„ä¹”èˆ’äºšå’Œç‘å®‰ï¼Œåˆ†äº«äº†ä»–ä»¬è‡ªå·±çš„äººç”Ÿæ•…äº‹å’Œæç®€ä¸»ä¹‰çš„ç”Ÿæ´»ç†å¿µã€‚é€šè¿‡èˆå¼ƒç”Ÿæ´»ä¸­å¤šä½™çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å¾—ä»¥è¶…è¶Šç‰©è´¨ï¼Œé›†ä¸­ç²¾åŠ›è¿½æ±‚ç”Ÿå‘½ä¸­æœ€é‡è¦çš„ äº”ç§ä»·å€¼ï¼šå¥åº·ã€äººé™…å…³ç³»ã€çƒ­æƒ…ã€æˆé•¿å’Œå¥‰çŒ®ã€‚ </p>
<h1 id="ç²¾å½©å†…å®¹"><a href="#ç²¾å½©å†…å®¹" class="headerlink" title="ç²¾å½©å†…å®¹"></a>ç²¾å½©å†…å®¹</h1><p>å¹¸ç¦æºè‡ªå†…éƒ¨ï¼Œæºè‡ªå†…å¿ƒï¼Œæºè‡ªå……æ»¡æ„ä¹‰çš„ç”Ÿæ´»ã€‚</p>
<blockquote>
<p>ä¸æ˜¯è½¬ç¬å³é€çš„æ¬¢æ„‰ï¼Œè€Œæ˜¯é•¿ä¹…çš„æ»¡è¶³ï¼Œæ¥è‡ªè‡ªå¾‹ã€ä¸“æ³¨ã€è§‰çŸ¥ã€ç›®çš„æ˜ç¡®çš„ç”Ÿæ´»ã€‚å¿«ä¹åªæ˜¯ä¸€ä¸ªå‰¯äº§å“è€Œå·²ã€‚</p>
</blockquote>
<p>å¿«ä¹æ˜¯æˆ‘ä»¬ä¸“æ³¨äºæŸä¸ªäº‹æƒ…æ—¶çš„å‰¯äº§å“ï¼Œå¦‚æœç›´æ¥å»å¯»æ±‚å¿«ä¹ï¼Œåè€Œéš¾ä»¥æ‰¾åˆ°ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬åœ¨è¿™ä¸–ä¸Šåªæœ‰æœ‰é™çš„æ—¶é—´ï¼Œè¿™äº›æ—¶é—´å¯ä»¥ç”¨æ¥ç§¯æ”’é‡‘é’±è´¢å¯Œï¼Œä¹Ÿå¯ä»¥èŠ±åœ¨æœ‰æ„ä¹‰çš„äº‹æƒ…ä¸Šâ€”â€”åè€…ä¸ä¸€å®šä¼šå¦¨ç¢äººä»¬è¿½æ±‚å‰è€…ï¼Œä½†å¯¹è´¢å¯Œæ°¸æ— æ­¢å¢ƒçš„è¿½æ±‚å¹¶ä¸èƒ½å°†æˆ‘ä»¬å¸¦å‘æœ‰æ„ä¹‰çš„ç”Ÿæ´»ã€‚</p>
</blockquote>
<p>ç”Ÿå‘½æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆå»å¯»æ‰¾æœ‰æ„ä¹‰çš„äº‹æƒ…ä¸Šã€‚é‡‘é’±åªæ˜¯åœ¨æˆ‘ä»¬å¯»æ‰¾æœ‰æ„ä¹‰äº‹æƒ…è·¯ä¸Šçš„ä¸€ç§é‡è¦å·¥å…·ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ç›®æ ‡ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬ä¸æ‰“ç®—ç»ƒå¾—åƒä¸ªå¥ç¾è¿åŠ¨å‘˜ã€‚æˆ‘ä»¬å…³å¿ƒçš„æ˜¯èº«ä½“å¥åº·ï¼Œä½“å½¢åŒ€ç§°ï¼Œå¯¹è‡ªå·±çš„èº«ä½“çŠ¶å†µæ„Ÿè§‰è‰¯å¥½ã€‚åœ¨è¿‡å»çš„å‡ å¹´é—´ï¼Œæˆ‘ä»¬è¯•éªŒäº†ä¸€äº›å¯¹æˆ‘ä»¬æœ‰æ•ˆçš„æ–¹æ³•ï¼ˆå…¶ä»–å¾ˆå¤šä¸œè¥¿å¯¹æˆ‘ä»¬æ²¡ä»€ä¹ˆç”¨ï¼‰ï¼Œè€Œåœ¨æ­¤æœŸé—´ï¼Œæˆ‘ä»¬å‘è§‰è¯„ä»·æˆåŠŸä¸å¦çš„æœ€é‡è¦æ ‡å‡†ä¸åœ¨äºä½“é‡ç§¤ä¸Šçš„æ•°å€¼ï¼Œè€Œæ˜¯ä»¥ä¸‹ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>1ï¼æˆ‘ä»¬æ˜¯å¦åœ¨æŒç»­åœ°æ”¹å–„å¥åº·ï¼Ÿ</li>
<li>2ï¼æˆ‘ä»¬å¯¹è‡ªå·±çš„è¿›æ­¥æ˜¯å¦æ»¡æ„ï¼Ÿ</li>
</ul>
</blockquote>
<p>äººç”Ÿæ˜¯ä¸€æ¬¡é•¿è·‘ï¼Œåªè¦æˆ‘ä»¬ä¸æ”¾å¼ƒå°±ä¸€å®šä¼šåˆ°è¾¾ç»ˆç‚¹ã€‚æ‰€ä»¥æœ€ç»ˆçš„æˆåŠŸä¸åœ¨é˜¶æ®µæ€§çš„æˆæœï¼Œè€Œæ˜¯åœ¨äºä½ æ˜¯å¦ä¸€ç›´åœ¨åšæŒï¼Œä¸€ç›´åœ¨è¿›æ­¥ã€‚</p>
<blockquote>
<p>è¦åœæ­¢å«‰å¦’ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åœæ­¢æ€è€ƒä»–äººçš„æ„å›¾ã€‚æˆ‘ä»¬ä¼šå«‰å¦’ï¼Œå¾€å¾€æ˜¯å› ä¸ºè®¤ä¸ºæŸäººçš„è¡Œä¸ºæ„å‘³ç€ä»€ä¹ˆï¼Œè€Œäº‹å®ä¸Šä»–å¹¶æ²¡æœ‰é‚£ä¸ªæ„æ€ã€‚ç„¶è€Œä½ æ°¸è¿œä¸ä¼šçŸ¥é“åˆ«äººçš„çœŸå®æ„å›¾ï¼Œæ‰€ä»¥æ€è€ƒè¿™äº›æ ¹æœ¬å°±æ˜¯æµªè´¹æ—¶é—´ã€‚</p>
</blockquote>
<p>ä»¥è‡ªæˆ‘ä¸ºä¸­å¿ƒï¼Œå»æ£æµ‹åˆ«äººçš„æ„å›¾å¾€å¾€ä¼šå¼•èµ·è¯¯è§£ã€å«‰å¦’ç­‰è´Ÿé¢æƒ…ç»ªã€‚ä¿æŒè‰¯å¥½çš„æ²Ÿé€šå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦é¿å…è¿™äº›é—®é¢˜</p>
<blockquote>
<p>å¦‚æœé‡‘é’±ä¸æˆé—®é¢˜ï¼Œä½ çš„äººç”Ÿé‡Œä½ æƒ³åšäº›ä»€ä¹ˆï¼Ÿ</p>
</blockquote>
<p>å¾ˆæ—©å°±å‘ç°ï¼Œç”Ÿæ´»ä¸­ç¼ºå°‘çœŸæ­£çƒ­çˆ±çš„äº‹æƒ….</p>
<blockquote>
<p>æ¢å¥è¯è¯´ï¼Œæˆ‘äººç”Ÿçš„æ„ä¹‰å°±æ˜¯æˆé•¿ä¸ºä¸€ä¸ªç‹¬ç«‹ä¸ªä½“ï¼Œå¹¶ä»¥æœ‰æ„ä¹‰çš„æ–¹å¼ä¸ºä»–äººåšè´¡çŒ®ã€‚è€Œå¥½æ¶ˆæ¯å°±æ˜¯ä½ å¯ä»¥å†³å®šè‡ªå·±è¯¥å¦‚ä½•å®Œæˆè¿™ä¸¤ä»¶äº‹ã€‚</p>
</blockquote>
<p>åœ¨ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹ä¸€ä¹¦ä¸­ï¼Œç”Ÿå‘½çš„æ„ä¹‰å¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹ä¸‰ç‚¹ï¼š</p>
<ul>
<li>1.ä»äº‹ä¸€ä»½ä½ å–œæ¬¢çš„å·¥ä½œå¹¶æŠ•å…¥å…¶ä¸­ </li>
<li>2.çˆ±ï¼Œå»çˆ±ä¸€ä¸ªäººäº†è§£ä»–çš„å…¨éƒ¨ </li>
<li>3.æ·±å¤„ç»å¢ƒä»èƒ½å…‹æœå›°éš¾ï¼Œå‹‡æ•¢çš„é¢å¯¹</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨è¿™ä¸ªç‰©æ¬²æ¨ªæµçš„æ—¶ä»£ï¼Œæç®€ä¸»ä¹‰æˆ–è®¸æ˜¯ä¸€ç§å€¼å¾—æˆ‘ä»¬æ¢ç´¢çš„ç”Ÿæ´»æ–¹å¼ã€‚æç®€ä¸»ä¹‰ä¸æ˜¯è®©ä½ èˆå¼ƒç”Ÿæ´»ä¸­çš„å¤§å¤šæ•°ä¸œè¥¿è¿‡åªæ‹¥æœ‰æå°‘ç‰©è´¨çš„ç”Ÿæ´»ï¼Œè€Œæ˜¯è®©ä½ ä¸“æ³¨äºç”Ÿå‘½ä¸­é‡è¦çš„ã€æœ‰æ„ä¹‰çš„ä¸œè¥¿ï¼Œæ‹¥æœ‰æå°‘ç‰©è´¨åªæ˜¯æˆ‘ä»¬è·µè¡Œæç®€ä¸»ä¹‰çš„ç»“æœè€Œå·²ã€‚æç®€ä¸»ä¹‰æ˜¯ä¸€ç§å·¥å…·ï¼Œå¸®åŠ©æˆ‘ä»¬è¿½æ±‚ç”Ÿå‘½ä¸­äº”ç§é‡è¦çš„ä»·å€¼ï¼šå¥åº·ã€äººé™…å…³ç³»ã€çƒ­æƒ…ã€æˆé•¿ã€å¥‰çŒ®ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>è¯»ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹</title>
    <url>/2021/04/11/book/huo-chu-sheng-ming-de-yi-yi/</url>
    <content><![CDATA[<p><em><strong>ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹ï¼ˆManâ€™s Search for Meaningï¼‰â€”â€” å€Ÿç€æ„ä¹‰çš„å¯»æ‰¾ï¼Œå°†è‡ªå·±è¶…æ‹”å‡ºæ¥å»é‡æ–°çˆ±ã€‚</strong></em><br><img src="/images/%E6%B4%BB%E5%87%BA%E7%94%9F%E5%91%BD%E7%9A%84%E6%84%8F%E4%B9%89.png" alt="æ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><strong>ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹ï¼ˆManâ€™s Search for Meaningï¼‰</strong></p>
<blockquote>
<p>[ç¾]ç»´å…‹å¤šÂ·å¼—å…°å…‹å°” â€”â€” è‘—<br>å•å¨œ â€”â€” è¯‘</p>
</blockquote>
<p>è‘—åçš„å¿ƒé‡Œå­¦å®¶å¼—å…°å…‹å°”æ˜¯20ä¸–çºªçš„ä¸€ä¸ªå¥‡è¿¹ã€‚çº³ç²¹æ—¶æœŸï¼Œä½œä¸ºçŠ¹å¤ªäººï¼Œä»–çš„å…¨å®¶éƒ½è¢«å…³è¿›å¥¥æ–¯ç»´è¾›é›†ä¸­è¥ï¼Œä»–çš„çˆ¶æ¯ã€å¦»å­ã€å“¥å“¥å…¨éƒ½æ­»äºæ¯’æ°”å®¤ä¸­ï¼Œåªæœ‰ä»–å’Œå¦¹å¦¹å¹¸å­˜ã€‚å¼—å…°å…‹å°”ä¸ä½†è¶…è¶Šäº†è¿™ç‚¼ç‹±åŠçš„ç—›è‹¦,æ›´å°†è‡ªå·±çš„ç»éªŒä¸å­¦æœ¯ç»“åˆï¼Œå¼€åˆ›äº†æ„ä¹‰ç–—æ³•ï¼Œæ›¿äººä»¬æ‰¾åˆ°ç»å¤„å†ç”Ÿçš„æ„ä¹‰ï¼Œä¹Ÿç•™ä¸‹äº†äººæ€§å²ä¸Šæœ€å¯Œå…‰å½©çš„è§è¯ã€‚</p>
<p>å¼—å…°å…‹å°”ä¸€ç”Ÿå¯¹ç”Ÿå‘½å……æ»¡äº†æå¤§çš„çƒ­æƒ…ï¼Œ67å²ä»å¼€å§‹å­¦ä¹ é©¾é©¶é£æœºï¼Œå¹¶åœ¨å‡ ä¸ªæœˆåé¢†åˆ°é©¾ç…§ã€‚ä¸€ç›´åˆ°80å²è¿˜ç™»ä¸Šäº†é˜¿å°”å‘æ–¯å±±ã€‚è¿™ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹æ›¾ç»æ„ŸåŠ¨åƒåƒä¸‡ä¸‡çš„äººï¼Œå®ƒè¢«ç¾å›½å›½ä¼šå›¾ä¹¦é¦†è¯„é€‰ä¸ºå…·æœ‰å½±å“åŠ›çš„åæœ¬è‘—ä½œä¹‹ä¸€ã€‚åˆ°ä»Šå¤©ï¼Œè¿™éƒ¨ä½œå“é”€å”®å·²è¾¾1200ä¸‡å†Œï¼Œè¢«ç¿»è¯‘æˆ24ç§è¯­è¨€ã€‚ä»–å¹¶ä¸æ˜¯å½“å¹´é›†ä¸­è¥é‡Œè¢«ç¼–å·ä¸º119104çš„å¾…å†³å›šå¾’ï¼Œè€Œæ˜¯è®©äººçš„å¯èƒ½æ€§å¾—ä»¥æ‰©å¤§çš„åœ£è€…ã€‚</p>
<h1 id="åŸæ–‡æ‘˜å½•"><a href="#åŸæ–‡æ‘˜å½•" class="headerlink" title="åŸæ–‡æ‘˜å½•"></a>åŸæ–‡æ‘˜å½•</h1><p>è¿™æœ¬ä¹¦ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¹¦çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯è‡ªä¼ éƒ¨åˆ†ï¼ˆé›†ä¸­è¥çš„ç»å†ï¼‰ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç†è®ºéƒ¨åˆ†ï¼ˆå­˜åœ¨æ„ä¹‰åˆ†ææ²»ç–—ï¼‰ï¼Œæµ“ç¼©äº†ç¬¬ä¸€éƒ¨åˆ†çš„ç²¾åã€‚ç¬¬ä¸€éƒ¨åˆ†çš„è‡ªä¼ æ˜¯å¯¹ä½œè€…ç†è®ºå­˜åœ¨çš„è¯æ˜ï¼Œä¸¤éƒ¨åˆ†å…±åŒåŠ å¼ºäº†æœ¬ä¹¦çš„å¯ä¿¡åº¦ã€‚</p>
<h2 id="è¿½æ±‚æ„ä¹‰"><a href="#è¿½æ±‚æ„ä¹‰" class="headerlink" title="è¿½æ±‚æ„ä¹‰"></a>è¿½æ±‚æ„ä¹‰</h2><blockquote>
<p>äººç±»å¯¹ç”Ÿå‘½æ„ä¹‰çš„è¿½æ±‚æ˜¯å…¶ä¸»è¦çš„åŠ¨æœºï¼Œè€Œä¸æ˜¯ä»€ä¹ˆæœ¬èƒ½é©±åŠ¨çš„â€æ¬¡çº§åˆç†åŒ–â€ã€‚è¿™ç§ç”Ÿå‘½æ„ä¹‰æ˜¯ç‹¬ç‰¹çš„ï¼Œå› ä¸ºåªæ˜¯å¹¶ä¸”åªèƒ½æ˜¯ç”±ç‰¹å®šçš„æŸä¸ªäººæ¥å®Œæˆã€‚ä¹Ÿåªæœ‰è¿™æ ·ï¼Œä»–æ‰æ»¡è¶³äº†è‡ªå·±è¿½æ±‚æ„ä¹‰çš„ç‹¬ç‰¹æ„¿æœ›ã€‚äººï¼Œèƒ½å¤Ÿä¸ºäº†è‡ªå·±çš„ç†æƒ³å’Œä»·å€¼è€Œæ´»ï¼Œç”šè‡³ä¸ºæ­¤ä»˜å‡ºç”Ÿå‘½ï¼</p>
</blockquote>
<h2 id="å­˜åœ¨ä¹‹è™šæ— "><a href="#å­˜åœ¨ä¹‹è™šæ— " class="headerlink" title="å­˜åœ¨ä¹‹è™šæ— "></a>å­˜åœ¨ä¹‹è™šæ— </h2><blockquote>
<p>äººç±»åœ¨æˆä¸ºçœŸæ­£çš„äººçš„è¿‡ç¨‹ä¸­ç»å†äº†åŒé‡ä¸§å¤±ã€‚åœ¨äººç±»å†å²ä¹‹åˆï¼Œäººä¸§å¤±äº†èµ–ä»¥æŒ‡å¯¼å…¶è¡Œä¸ºå¹¶å› æ­¤äº§ç”Ÿå®‰å…¨æ„Ÿçš„æŸäº›åŠ¨ç‰©æœ¬èƒ½ã€‚æ­¤å¤–ï¼Œåœ¨æœ€è¿‘æ—¶æœŸï¼Œäººç±»è¿˜ç»å†äº†å¦å¤–ä¸€ç§ä¸§å¤±ï¼Œé‚£å°±æ˜¯åŸæœ¬ä½œä¸ºå…¶è¡Œä¸ºæ ¹åŸºçš„ä¼ ç»Ÿè¿…é€Ÿçš„æ¶ˆå‡ã€‚ä¸§å¤±äº†å‘Šè¯‰ä»–å¿…é¡»åšä»€ä¹ˆçš„æœ¬èƒ½ï¼Œä¸§å¤±äº†å‘Šè¯‰ä»–åº”è¯¥åšä»€ä¹ˆçš„ä¼ ç»Ÿï¼Œæœ‰æ—¶ç”šè‡³è¿è‡ªå·±æƒ³åšä»€ä¹ˆéƒ½ä¸çŸ¥é“ã€‚è¿™æ ·ï¼Œä»–è¦ä¹ˆå»åšåˆ«äººæ‰€åšçš„äº‹ï¼ˆéšå¤§æµï¼‰ï¼Œè¦ä¹ˆåº§åˆ«äººå¸Œæœ›ä»–åšçš„äº‹ï¼ˆé›†æƒä¸»ä¹‰ï¼‰ã€‚<br>ç®€å•ç†è§£ï¼Œäººç±»ç¤¾ä¼šå‘å±•åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å¿…å†ä¸ºé£Ÿç‰©å‘æ„ï¼Œä¸å¿…å†æ‹…å¿ƒå®³æ€•è‡ªç„¶ç•Œçš„çŒ›å…½ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå› æ­¤å¤±å»æŸäº›åŠ¨ç‰©æ€§æœ¬èƒ½ã€‚<br>å­˜åœ¨ä¹‹è™šæ— çš„è¡¨å•ä¸»è¦æ˜¯åŒå€¦ã€‚ç°åœ¨æˆ‘ä»¬èƒ½ç†è§£å”æœ¬åçš„è¯äº†ï¼šäººæ³¨å®šè¦å¾˜å¾Šåœ¨ç„¦è™‘å’ŒåŒå€¦è¿™ä¸¤æä¹‹é—´ã€‚</p>
</blockquote>
<h2 id="ç”Ÿå‘½ä¹‹æ„ä¹‰"><a href="#ç”Ÿå‘½ä¹‹æ„ä¹‰" class="headerlink" title="ç”Ÿå‘½ä¹‹æ„ä¹‰"></a>ç”Ÿå‘½ä¹‹æ„ä¹‰</h2><blockquote>
<p>ç”Ÿå‘½çš„æ„ä¹‰åœ¨æ¯ä¸ªäººã€æ¯ä¸€å¤©ã€æ¯ä¸€åˆ»éƒ½æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥é‡è¦çš„ä¸æ˜¯æ˜¯ç”Ÿå‘½ä¹‹æ„ä¹‰çš„æ™®éæ€§ï¼Œè€Œæ˜¯åœ¨ç‰¹å®šæ—¶åˆ»æ¯ä¸ªäººç‰¹æ®Šçš„ç”Ÿå‘½æ„ä¹‰ã€‚è¿™ä¸ªé—®é¢˜å°±å¥½æ¯”é—®ä¸€ä¸ªæ£‹æ‰‹ï¼šâ€å‘Šè¯‰æˆ‘ï¼Œå¤§å¸ˆï¼Œä¸–ç•Œä¸Šæœ€å‰å®³çš„æ‹›æ³•æ˜¯ä»€ä¹ˆï¼Ÿâ€ç¦»å¼€ç‰¹å®šçš„æ£‹å±€å’Œç‰¹å®šçš„å¯¹æ‰‹ï¼Œå‹æ ¹ä¸å­˜åœ¨ä»€ä¹ˆæœ€å‰å®³çš„æ‹›æ³•ï¼Œç”šè‡³è¿è¾ƒå¥½çš„æ‹›æ³•ä¹Ÿä¸å­˜åœ¨ï¼Œäººçš„å­˜åœ¨ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚ä½ ä¸åº”è¯¥è¿½é—®æŠ½è±¡çš„ç”Ÿå‘½æ„ä¹‰ã€‚æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„ä½¿å‘½ã€‚è¿™ä¸ªä½¿å‘½æ˜¯ä»–äººæ— æ³•æ›¿ä»£çš„ï¼Œå¹¶ä¸”ä½ çš„ç”Ÿå‘½ä¹Ÿä¸å¯èƒ½é‡æ¥ä¸€æ¬¡ã€‚</p>
</blockquote>
<h2 id="å‘ç°ç”Ÿå‘½æ„ä¹‰çš„ä¸‰ç§æ–¹å¼"><a href="#å‘ç°ç”Ÿå‘½æ„ä¹‰çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="å‘ç°ç”Ÿå‘½æ„ä¹‰çš„ä¸‰ç§æ–¹å¼"></a>å‘ç°ç”Ÿå‘½æ„ä¹‰çš„ä¸‰ç§æ–¹å¼</h2><p>äººä»¬æ´»ç€æ˜¯ä¸ºäº†å¯»æ‰¾ç”Ÿå‘½çš„æ„ä¹‰ï¼Œè¿™ä¹Ÿæ˜¯äººä»¬ä¸€ç”Ÿä¸­è¢«èµ‹äºˆçš„æœ€è‰°å·¨çš„ä½¿å‘½ã€‚å¼—å…°å…‹å°”å‘ç°å¯èƒ½æ‰¾å¯»åˆ°ç”Ÿå‘½æ„ä¹‰çš„ä¸‰ä¸ªé€”å¾„ã€‚<br>ï¼ˆ1ï¼‰ç¬¬ä¸€æ˜¯é€šè¿‡åˆ›ç«‹æŸé¡¹å·¥ä½œæˆ–ä»äº‹æŸç§äº‹ä¸šã€‚<br>ï¼ˆ2ï¼‰ç¬¬äºŒæ˜¯ç»å†æŸç§äº‹æƒ…æˆ–è€…é¢å¯¹æŸä¸ªäººï¼Œæ¢å¥è¯è¯´ï¼Œä¸ä»…èƒ½ä»å·¥ä½œä¸­ä¹Ÿèƒ½ä»çˆ±ä¸­æ‰¾åˆ°æ„ä¹‰ã€‚<br>ï¼ˆ3ï¼‰ç¬¬ä¸‰æ˜¯åœ¨å¿å—ä¸å¯é¿å…çš„è‹¦éš¾æ—¶é‡‡å–æŸç§æ€åº¦ã€‚</p>
<h2 id="å­˜åœ¨ä¹‹æœ¬è´¨"><a href="#å­˜åœ¨ä¹‹æœ¬è´¨" class="headerlink" title="å­˜åœ¨ä¹‹æœ¬è´¨"></a>å­˜åœ¨ä¹‹æœ¬è´¨</h2><blockquote>
<p>äººä¹‹æ‰€ä»¥ä¸ºäººï¼Œæ˜¯å› ä¸ºä»–æ€»æ˜¯æŒ‡å‘æŸç§äº‹ç‰©æˆ–æŸäººï¼ˆä»–è‡ªå·±ä»¥å¤–çš„æŸäººï¼‰â€”â€”ä¸è®ºæ˜¯ä½œä¸ºæœ‰å¾…å®ç°çš„æ„ä¹‰è¿˜æ˜¯éœ€è¦é¢å¯¹çš„äººã€‚äººè¶Šæ˜¯å¿˜è®°è‡ªå·±â€”â€”æŠ•èº«äºæŸç§äº‹ä¸šæˆ–çŒ®èº«äºæ‰€çˆ±çš„äººâ€”â€”ä»–å°±è¶Šæœ‰äººæ€§ï¼Œè¶Šèƒ½å®ç°è‡ªå·±çš„ä»·å€¼ã€‚æ‰€è°“è‡ªæˆ‘å®ç°ï¼Œç»ä¸æ˜¯åªæŸç§å¯ä»¥å®ç°çš„ç›®æ ‡ï¼Œå› ä¸ºäººè¶Šæ˜¯è¿½æ±‚è¿™ä¸ªç›®æ ‡ï¼Œå°±æ˜¯è¶Šå®¹æ˜“å¤±å»å®ƒã€‚æ¢å¥è¯è¯´ï¼Œè‡ªæˆ‘å®ç°æ˜¯è‡ªæˆ‘è¶…è¶Šå”¯ä¸€çš„å‰¯äº§å“ã€‚</p>
</blockquote>
<h2 id="çˆ±ä¹‹æ„ä¹‰"><a href="#çˆ±ä¹‹æ„ä¹‰" class="headerlink" title="çˆ±ä¹‹æ„ä¹‰"></a>çˆ±ä¹‹æ„ä¹‰</h2><blockquote>
<p>çˆ±æ˜¯ç›´è¾¾å¦ä¸€ä¸ªäººå†…å¿ƒæ·±å¤„çš„å”¯ä¸€é€”å¾„ã€‚åªæœ‰åœ¨æ·±çˆ±å¦ä¸€ä¸ªäººæ—¶ï¼Œä½ æ‰èƒ½å®Œå…¨äº†è§£å¦ä¸€ä¸ªäººçš„æœ¬è´¨ã€‚é€šè¿‡çˆ±ï¼Œä½ æ‰èƒ½çœ‹åˆ°æ‰€çˆ±çš„äººçš„æœ¬è´¨ç‰¹æ€§ï¼Œç”šè‡³èƒ½å¤Ÿçœ‹åˆ°ä»–æ½œåœ¨çš„ä¸œè¥¿å³ä»–åº”å½“å®ç°è€Œå°šæœªå®ç°çš„ä¸œè¥¿æ˜¯ä»€ä¹ˆã€‚åªæœ‰é€šè¿‡çˆ±ï¼Œæ‰èƒ½æ˜¯ä½ æ‰€çˆ±çš„äººå®ç°ä»–çš„å…¨éƒ¨æ½œèƒ½ã€‚é€šè¿‡ä½¿ä»–è®¤è¯†åˆ°è‡ªå·±çš„æ‰€èƒ½å’Œåº”ä¸ºï¼Œä»–å°±ä¼šå®ç°è‡ªå·±çš„æ½œèƒ½ã€‚</p>
</blockquote>
<h2 id="è‹¦éš¾ä¹‹æ„ä¹‰"><a href="#è‹¦éš¾ä¹‹æ„ä¹‰" class="headerlink" title="è‹¦éš¾ä¹‹æ„ä¹‰"></a>è‹¦éš¾ä¹‹æ„ä¹‰</h2><blockquote>
<p>æˆ‘ä»¬ä¸€å®šä¸èƒ½å¿˜è®°ï¼Œå³ä½¿åœ¨çœ‹ä¼¼æ¯«æ— å¸Œæœ›çš„å¢ƒåœ°ï¼Œå³ä½¿é¢å¯¹æ— å¯æ”¹å˜çš„å„è¿ï¼Œäººä»¬ä¹Ÿèƒ½æ‰¾åˆ°ç”Ÿå‘½ä¹‹æ„ä¹‰ã€‚é‚£æ—¶é‡è¦çš„çš„æ˜¯ï¼Œèƒ½å¤Ÿè§è¯äººç±»æ½œèƒ½ä¹‹æé™ï¼Œå³äººèƒ½å¤Ÿå°†ç¾éš¾è½¬åŒ–ä¸ºèƒœåˆ©ï¼Œå°†ä¸ªäººçš„å„è¿è½¬åŒ–ä¸ºäººç±»ä¹‹æˆå°±ã€‚</p>
</blockquote>
<blockquote>
<p>æ„ä¹‰ç–—æ³•çš„è¦ä¹‰ä¹‹ä¸€ï¼šäººä¸»è¦å…³æ³¨çš„ä¸æ˜¯è·å¾—å¿«ä¹æˆ–é¿å…ç—›è‹¦ï¼Œè€Œæ˜¯çœ‹åˆ°å…¶ç”Ÿå‘½çš„æ„ä¹‰ã€‚è¿™ä¹Ÿæ˜¯<br>äººä»¬ä¸ºä»€ä¹ˆç”šè‡³å‡†å¤‡ç€å»å—è‹¦ï¼Œåœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œä»–çš„ç—›è‹¦æœ‰äº†æ„ä¹‰ã€‚</p>
</blockquote>
<p>ä½œè€…åœ¨ä¹¦ä¸­è®²äº†ä¸€ä¸ªä¾‹å­ï¼šä¸€åå¹´è¿ˆçš„ã€æ‚£æœ‰ä¸¥é‡æŠ‘éƒç—‡çš„å…¨ç§‘åŒ»ç”Ÿæ¥å‘ä½œè€…å’¨è¯¢ï¼Œä»–æ— æ³•æ¥å—å¦»å­çš„æ­»äº¡ï¼ˆå¥¹åœ¨ä¸¤å¹´å‰å»ä¸–ï¼Œä»–çˆ±å¥¹èƒœè¿‡ä¸–ä¸Šçš„ä¸€åˆ‡ï¼‰ã€‚é¢å¯¹è¿™ä¸ªé—®é¢˜ï¼Œä½œè€…æ€è™‘è¿‡åå¯¹è¿™ä½å¤±å»çˆ±å¦»çš„åŒ»ç”Ÿæå‡ºè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šâ€åŒ»ç”Ÿï¼Œå¦‚æœä½ å…ˆå¥¹è€Œå»ï¼Œè€Œä½ å¤ªå¤ªåœ¨ä½ æ­»åè¿˜æ´»ç€ï¼Œé‚£ä¼šæ€æ ·å•Šï¼Ÿâ€ â€œå•Šï¼Œâ€ä»–è¯´ï¼Œâ€é‚£å¥¹å¯å°±å—è‹¦äº†ï¼Œå¥¹æ€ä¹ˆå—å¾—äº†å•Šï¼â€ã€‚æˆ‘é©¬ä¸Šå›ç­”ï¼šâ€ä½ çœ‹åŒ»ç”Ÿï¼Œå¥¹å…é™¤äº†è¿™æ ·çš„ç—›è‹¦ï¼Œä½ æ›¿ä»£äº†å¥¹çš„ç—›è‹¦â€”â€”å½“ç„¶ä»£ä»·æ˜¯ä½ ç°åœ¨è¿˜æ´»ç€ï¼Œå¹¶ä¸”é™·å…¥äº†æ·±æ·±çš„ç—›è‹¦ä¸­ã€‚â€</p>
<blockquote>
<p>å‡å¦‚ç—›è‹¦æ˜¯ä¸å¯é¿å…çš„ï¼Œé‚£ä¹ˆåœ¨é­é‡ç—›è‹¦æ—¶ï¼Œäººä»¬ä¹Ÿæœ‰å¯èƒ½æ‰¾åˆ°æ„ä¹‰ã€‚åœ¨ä¸€å®šæ„ä¹‰ä¸Šï¼Œä¸€æ—¦æ‰¾åˆ°äº†æ„ä¹‰ï¼ˆæ¯”å¦‚ç‰ºç‰²çš„æ„ä¹‰ï¼‰ï¼Œç—›è‹¦å°±ä¸å†æ˜¯ç—›è‹¦äº†ã€‚</p>
</blockquote>
<blockquote>
<p>ä½†æ˜¯é­å—ç—›è‹¦ä¸æ˜¯å¯»æ‰¾æ„ä¹‰çš„å¿…è¦æ–¹å¼ã€‚å¦‚æœç—›è‹¦æ˜¯å¯ä»¥é¿å…çš„ï¼Œé‚£ä¹ˆæœ‰æ„ä¹‰çš„äº‹å°±æ˜¯å»æ¶ˆé™¤ç—›è‹¦çš„æ ¹æºï¼Œä¸è®ºè¿™ç§åŸå› æ˜¯å¿ƒç†çš„ã€ç”Ÿç†çš„æˆ–æ”¿æ²»çš„ã€‚é­å—ä¸å¿…è¦çš„ç—›è‹¦ä¸å…¶è¯´æ˜¯è‹±é›„è¡Œä¸ºï¼Œä¸å¦‚è¯´æ˜¯è‡ªè™ã€‚</p>
</blockquote>
<h2 id="ç”Ÿå‘½ä¹‹çŸ­æš‚"><a href="#ç”Ÿå‘½ä¹‹çŸ­æš‚" class="headerlink" title="ç”Ÿå‘½ä¹‹çŸ­æš‚"></a>ç”Ÿå‘½ä¹‹çŸ­æš‚</h2><blockquote>
<p>ä½¿ç”Ÿå‘½ä¸§å¤±æ„ä¹‰çš„äº‹æƒ…ï¼Œä¸ä»…åŒ…æ‹¬ç—›è‹¦ï¼Œè¿˜åŒ…æ‹¬æ­»äº¡ã€‚æ„ä¹‰ç–—æ³•å› ä¸ºç‰¢è®°äººç±»å­˜åœ¨çš„çŸ­æš‚æ€§ï¼Œæ‰€ä»¥ä¸æ˜¯æ¶ˆææ‚²è§‚çš„ï¼Œè€Œæ˜¯ç§¯æå‘ä¸Šçš„ã€‚</p>
</blockquote>
<blockquote>
<p>æ„ä¹‰ç–—æ³•å› ä¸ºç‰¢è®°äººç±»å­˜åœ¨çš„çŸ­æš‚æ€§ï¼Œæ‰€ä»¥ä¸æ˜¯æ¶ˆææ‚²è§‚çš„ï¼Œè€Œæ˜¯ç§¯æå‘ä¸Šçš„ã€‚æˆ‘ä»¬å½¢è±¡åœ°è¡¨è¾¾è¿™ä¸ªæ„æ€:æ‚²è§‚ä¸»ä¹‰è€…å¥½æ¯”ä¸€ä¸ªææƒ§è€Œæ‚²ä¼¤åœ°çœ‹ç€å¢™ä¸Šçš„æŒ‚å†æ¯å¤©éƒ½è¢«æ’•æ‰ä¸€å¼ ï¼ŒæŒ‚å†è¶Šå˜è¶Šè–„çš„äºº;è€Œç§¯æåœ°åº”å¯¹ç”Ÿæ´»é—®é¢˜çš„äººå¥½æ¯”ä¸€ä¸ªæ¯æ’•æ‰ä¸€å¼ å°±æŠŠå®ƒæ•´æ•´é½é½åœ°æ‘åœ¨ä¸€èµ·ï¼Œè¿˜è¦åœ¨èƒŒé¢è®°å‡ è¡Œæ—¥è®°çš„äººã€‚ä»–å¯ä»¥è‡ªè±ªè€Œå¿«ä¹åœ°å›å¿†æ—¥è®°ä¸­æ‰€è®°ä¸‹çš„æ‰€æœ‰å……å®çš„æ—¥å­ï¼Œé‚£äº›ä»–æ›¾ç»æœ‰è¿‡çš„å…¨éƒ¨ç”Ÿæ´»ã€‚å³ä¾¿ä»–æ„è¯†åˆ°è‡ªå·±è€äº†ï¼Œé‚£åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢?ä»–æ²¡æœ‰å¿…è¦å«‰å¦’å¹´è½»äººï¼Œæ›´æ²¡æœ‰å¿…è¦ä¸ºè™šåº¦çš„é’æ˜¥æ‡Šæ‚”ã€‚ä»–ä¸ºä»€ä¹ˆè¦å«‰å¦’å¹´è½»äººå‘¢?å«‰å¦’å¹´è½»äººæ‰€æ‹¥æœ‰çš„å¯èƒ½æ€§å’Œæ½œåœ¨çš„è¿œå¤§å‰ç¨‹å—?â€œä¸ï¼Œè°¢è°¢ä½ â€ï¼Œä»–ä¼šè¿™ä¹ˆæƒ³ï¼Œâ€œæˆ‘æ‹¥æœ‰çš„ä¸ä»…ä»…æ˜¯å¯èƒ½æ€§ï¼Œè€Œæ˜¯ç°å®æ€§ï¼Œæˆ‘åšè¿‡äº†ï¼Œçˆ±è¿‡äº†ï¼Œä¹Ÿå‹‡æ•¢åœ°æ‰¿å—è¿‡ç—›è‹¦ã€‚è¿™äº›ç—›è‹¦ç”šè‡³æ˜¯æˆ‘æœ€çè§†çš„ï¼Œå°½ç®¡å®ƒä»¬ä¸ä¼šå¼•èµ·åˆ«äººçš„å«‰å¦’â€</p>
</blockquote>
<h2 id="é›†ä½“æ€§ç¥ç»å®˜èƒ½ç—‡"><a href="#é›†ä½“æ€§ç¥ç»å®˜èƒ½ç—‡" class="headerlink" title="é›†ä½“æ€§ç¥ç»å®˜èƒ½ç—‡"></a>é›†ä½“æ€§ç¥ç»å®˜èƒ½ç—‡</h2><blockquote>
<p>æ¯ä¸ªæ—¶ä»£éƒ½æœ‰å®ƒçš„é›†ä½“ç¥ç»å®˜èƒ½ç—‡ï¼Œå› æ­¤æ¯ä¸ªæ—¶ä»£éƒ½éœ€è¦ç›¸åº”çš„ç‰¹å®šå¿ƒç†æ²»ç–—æ–¹æ³•æ¥è¿›è¡Œæ²»ç–—ã€‚ç°åœ¨çš„é›†ä½“å®˜èƒ½ç—‡â€”â€”å­˜åœ¨ä¹‹è™šæ— â€”â€”å¯ä»¥è¢«è¡¨è¿°ä¸ºç§äººå’Œä¸ªäººçš„è™šæ— ä¸»ä¹‰ï¼Œè™šæ— ä¸»ä¹‰è®¤ä¸ºç”Ÿå‘½æ¯«æ— æ„ä¹‰ã€‚</p>
</blockquote>
<blockquote>
<p>é¦–å…ˆï¼Œå…³äºäººç±»â€œæ— è°“â€â€”â€”å³äººä¸è¿‡æ˜¯ç”Ÿç‰©ã€å¿ƒç†å’Œç¤¾ä¼šæ¡ä»¶çš„äº§ç‰©ï¼Œæˆ–æ˜¯é—ä¼ ä¸ç¯å¢ƒç›¸ç»“åˆçš„äº§ç‰©çš„ç†è®ºæ˜¯å¾ˆå±é™©çš„ã€‚å®ƒä½¿ç¥ç»å®˜èƒ½ç—‡æ‚£è€…æ›´æ„¿æ„ç›¸ä¿¡è‡ªå·±ä¸è¿‡æ˜¯å¤–éƒ¨å½±å“çš„å·¥å…·å’Œç‰ºç‰²å“ï¼Œè®¤ä¸ºäººç±»ä¸è‡ªç”±çš„å¿ƒç†ç–—æ³•å¼ºåŒ–äº†è¿™ç§ç¥ç»å®˜èƒ½ç—‡çš„å®¿å‘½è®ºã€‚<br>å½“ç„¶ï¼Œäººçš„ç”Ÿå‘½æ˜¯æœ‰é™çš„ï¼Œè‡ªç”±ä¹Ÿæ˜¯æœ‰é™çš„ã€‚äººçš„è‡ªç”±ä¸æ˜¯æ— æ¡ä»¶çš„è‡ªç”±ï¼Œè€Œæ˜¯é’ˆå¯¹ç‰¹å®šæ¡ä»¶é‡‡å–æŸç§ç«‹åœºçš„è‡ªç”±ã€‚</p>
</blockquote>
<blockquote>
<p>ç¥ç»ç—‡ï¼ˆè‹±è¯­ï¼šneurosisã€psychoneurosisæˆ–neurotic disorderï¼‰ï¼Œé¦™æ¸¯ã€æ¾³é—¨ã€æ–°åŠ å¡ã€å°æ¹¾è¯‘ä½œç²¾ç¥å®˜èƒ½ç—‡ï¼Œåœ¨å¹¿æ³›çš„æ„ä¹‰ä¸Šå¯ä»¥æŒ‡ä»»ä½•å¼•èµ·æ²®ä¸§çš„ç²¾ç¥å¤±è¡¡ã€‚ç¥ç»ç—‡å±äºåŠŸèƒ½æ€§å¿ƒç†éšœç¢ï¼ˆfunctional mental disorderï¼‰çš„ä¸€ç±»ï¼Œç—…äººæœ‰ç—›è‹¦ï¼ˆdistressï¼‰çš„æ„Ÿè§‰ä½†ä¸åŒ…æ‹¬å¦„æƒ³ä¸å¹»è§‰ä¸å¹»å¬ï¼Œå…¶è¡Œä¸ºä¹Ÿä¸ä¼šè®©äººåœ¨ç¤¾ä¼šä¸Šéš¾ä»¥æ¥å—ã€‚ä¸åƒç²¾ç¥ç—…æˆ–è€…äººæ ¼è¿å¸¸ï¼Œç¥ç»ç—‡å¹¶ä¸å½±å“æˆ–è€…é˜»ç¢æ­£å¸¸çš„æ€è€ƒã€‚åœ¨è¥¿æ–¹ï¼Œâ€œç¥ç»ç—‡â€æ˜¯ä¸€ä¸ªåœ¨ç²¾ç¥åˆ†æé¢†åŸŸé‡Œå¸¸å¸¸æåŠçš„æœ¯è¯­ï¼Œè€Œåœ¨ç²¾ç¥åŒ»å­¦é‡Œå·²ç»åºŸæ­¢ä¸å†ä½¿ç”¨ã€‚ è€Œåœ¨ã€Šä¸­å›½ç²¾ç¥ç–¾ç—…åˆ†ç±»æ–¹æ¡ˆä¸è¯Šæ–­æ ‡å‡†ã€‹ç¬¬ä¸‰ç‰ˆï¼ˆCCMD-IIIï¼‰ä¸­ï¼Œåˆ™æŠŠç¥ç»ç—‡å®šä¹‰ä¸ºä¸€ç§å…·ä½“çš„ç²¾ç¥ç–¾ç—…ï¼Œå¹¶å°†å…¶åˆ†ä¸ºç„¦è™‘ç—‡ã€ææƒ§ç—‡ã€ç¥ç»è¡°å¼±ã€èº«å¿ƒç—‡ï¼ˆsomatoform disorderï¼‰ã€å¼ºè¿«ç—‡ã€å…¶ä»–æˆ–å¾…åˆ†ç±»çš„ç¥ç»ç—‡ç­‰å…­ä¸ªäºšå‹ã€‚<br>è§<a href="https://zh.wikipedia.org/wiki/%E7%A5%9E%E7%BB%8F%E7%97%87">ç»´åŸºç™¾ç§‘</a></p>
</blockquote>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="å¦‚ä½•å¯»æ‰¾ç”Ÿå‘½çš„æ„ä¹‰ï¼Ÿ"><a href="#å¦‚ä½•å¯»æ‰¾ç”Ÿå‘½çš„æ„ä¹‰ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¯»æ‰¾ç”Ÿå‘½çš„æ„ä¹‰ï¼Ÿ"></a>å¦‚ä½•å¯»æ‰¾ç”Ÿå‘½çš„æ„ä¹‰ï¼Ÿ</h2><p>äººä»¬æ´»ç€æ˜¯ä¸ºäº†å¯»æ‰¾ç”Ÿå‘½çš„æ„ä¹‰ï¼Œè¿™ä¹Ÿæ˜¯äººä»¬ä¸€ç”Ÿä¸­è¢«èµ‹äºˆçš„æœ€è‰°å·¨çš„ä½¿å‘½ã€‚å¼—å…°å…‹å°”å‘ç°å¯èƒ½æ‰¾å¯»åˆ°ç”Ÿå‘½æ„ä¹‰çš„ä¸‰ä¸ªé€”å¾„ã€‚ç¬¬ä¸€æ˜¯åˆ›é€ æˆ–ä»äº‹æŸç§å·¥ä½œã€‚ç¬¬äºŒæ˜¯ç»å†æŸç§äº‹æƒ…æ´»ç€é¢å¯¹æŸä¸ªäººï¼Œæ¢å¥è¯è¯´ï¼Œä¸ä»…èƒ½ä»å·¥ä½œä¸­ä¹Ÿèƒ½ä»çˆ±ä¸­æ‰¾åˆ°æ„ä¹‰ã€‚æœ€é‡è¦çš„æ˜¯ç¬¬ä¸‰ä¸ªé€”å¾„ï¼šå³ä½¿æ˜¯å¤„äºç»å¢ƒçš„æ— åŠ©å—å®³äººï¼Œé¢å¯¹æ— æ³•æ”¹å˜çš„å„è¿ï¼Œä»èƒ½è‡ªæˆ‘è¶…è¶Šï¼Œå¹¶ä¸”ä»¥æ­¤æ”¹å˜è‡ªå·±ã€‚ä»–èƒ½å¤ŸæŠŠä¸ªäººçš„æ‚²å‰§è½¬åŒ–ä¸ºèƒœåˆ©ã€‚éš¾ã€‚å³ä½¿æ˜¯å¤„äºç»å¢ƒä¹‹ä¸­ï¼Œé¢å¯¹æ— æ³•æ”¹å˜çš„å„è¿ï¼Œä»èƒ½è‡ªæˆ‘è¶…è¶Šï¼Œå¹¶ä¸”ä»¥æ­¤æ”¹å˜è‡ªå·±ï¼ŒæŠŠä¸ªäººçš„æ‚²å‰§è½¬åŒ–ä¸ºèƒœåˆ©ã€‚</p>
<h2 id="å…³äºæˆåŠŸ"><a href="#å…³äºæˆåŠŸ" class="headerlink" title="å…³äºæˆåŠŸ"></a>å…³äºæˆåŠŸ</h2><p>èµ·åˆä½œè€…å‡ºä¹¦çš„åˆè¡·æ˜¯é€šè¿‡å…·ä½“çš„äº‹ä¾‹å‘è¯»è€…ä¼ é€’ä¸€ç§è§‚ç‚¹â€”â€”ç”Ÿå‘½åœ¨ä»»ä½•æ¡ä»¶ä¸‹éƒ½æœ‰æ„ä¹‰ï¼Œå³ä¾¿æ˜¯åœ¨æœ€æ¶åŠ£çš„æƒ…å½¢ä¸‹ã€‚ç„¶è€Œè®©ä½œè€…æ„Ÿåˆ°æƒŠè®¶å’ŒéåŒå¯»å¸¸çš„æ˜¯ï¼Œåœ¨ä»–çš„ä¼—å¤šè‘—ä½œå½“ä¸­ï¼Œæ°æ°æ˜¯çœŸç¬¨ä»–æ‰“ç®—åŒ¿åå‡ºç‰ˆçš„ä¹¦å‡ºä¹æ„æ–™åœ°ç»™ä»–å¸¦æ¥äº†æå¤§çš„æˆåŠŸã€‚ å› æ­¤ï¼Œä»–å†ä¸‰å®å˜±ä»–çš„å­¦ç”Ÿï¼šâ€ä¸è¦åªæƒ³ç€æˆåŠŸâ€”â€”ä½ è¶Šæƒ³æˆåŠŸï¼Œå°±è¶Šå®¹æ˜“å¤±è´¥ã€‚æˆåŠŸå°±åƒå¹¸ç¦ä¸€æ ·ï¼Œå¯é‡è€Œä¸å¯æ±‚ã€‚å®ƒæ˜¯ä¸€ç§è‡ªç„¶è€Œç„¶çš„äº§ç‰©ï¼Œæ˜¯ä¸€ä¸ªäººæ— æ„è¯†åœ°æŠ•èº«äºæŸä¸€ä¼Ÿå¤§çš„äº‹ä¸šæ—¶äº§ç”Ÿçš„è¡ç”Ÿå“ã€‚æˆ‘å¸Œæœ›ä½ ä»¬ä¸€åˆ‡æœä»è‰¯å¿ƒï¼Œå¹¶ç”¨åªæ˜¯å»å®ç°å®ƒã€‚æ€»æœ‰ä¸€å¤©ä½ ä¼šå‘ç°ï¼Œå½“ç„¶æ˜¯ç›¸å½“é•¿çš„æ—¶é—´ä¹‹åâ€”â€”æ³¨æ„ï¼Œæˆ‘è¯´çš„æ˜¯å¾ˆé•¿æ—¶é—´ä¹‹åï¼â€”â€”æ­£æ˜¯ç”±äºè¿™ç§ä¸å…³æ³¨ï¼ŒæˆåŠŸå°†é™ä¸´äºä½ ã€‚â€</p>
<p>è¿™ä¸ªæ€æƒ³å’Œé“å®¶çš„æ€æƒ³å¾ˆç›¸è¿‘ï¼Œé“å®¶è®²é¡ºåº”è‡ªç„¶ï¼Œä¸è¦è¿‡äºåˆ»æ„ã€‚ç®€å•ç†è§£å°±æ˜¯è¦é¡ºåº”äº‹ç‰©å‘å±•çš„å®¢è§‚è§„å¾‹ã€‚å°±åƒç”°é‡ä¸­çš„æœæ ‘æ€»æ˜¯åœ¨æ˜¥å¤©å¼€èŠ±ç»“æœå¾…åˆ°ç§‹å¤©æˆç†Ÿï¼Œå½“ä½ ç€æ€¥æƒ³åƒåˆ°æœå­è€Œå‹¤åŠ³çš„ç»™æœæ ‘æµ‡æ°´æ–½è‚¥ï¼Œæœå­æ˜¯ä¸ä¼šæå‰åœ¨å¤å¤©æˆç†Ÿï¼Œä½ å¹¶ä¸èƒ½æå‰åƒåˆ°æˆç†Ÿçš„æœå­ã€‚ä½†æ˜¯å¦‚æœä½ åšæŒæµ‡æ°´æ–½è‚¥å¹¶åŠ ä»¥æŠ¤ç†ï¼Œå¾…åˆ°ç§‹å¤©æ—¶ï¼Œæˆ‘æƒ³ä½ ä¸€å®šèƒ½åƒåˆ°æˆç†Ÿçš„é¦™å–·å–·çš„æœå­ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>æ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹</title>
    <url>/2021/02/10/book/bei-tao-yan-de-yong-qi/</url>
    <content><![CDATA[<p><img src="/images/%E8%A2%AB%E8%AE%A8%E5%8E%8C%E7%9A%84%E5%8B%87%E6%B0%94.jpg" alt="è¢«è®¨åŒçš„å‹‡æ°”"></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><em><strong>ã€Šè¢«è®¨åŒçš„å‹‡æ°”ã€‹ â€”â€” â€œè‡ªæˆ‘å¯å‘ä¹‹çˆ¶â€é˜¿å¾·å‹’çš„å“²å­¦è¯¾</strong></em></p>
<blockquote>
<p>[æ—¥]æ¡ˆè§ä¸€éƒï¼Œ å¤è´ºå²å¥<br>æ¸ æµ·éœ â€”â€” è¯‘</p>
</blockquote>
<h1 id="ä¹¦åº"><a href="#ä¹¦åº" class="headerlink" title="ä¹¦åº"></a>ä¹¦åº</h1><p>å°å¿ƒæ£€è§†ï¼Œä½ çš„æˆåŠŸæ˜¯å¦åªæ˜¯ä»¥å®³æ€•è¢«ä»–äººè®¨åŒè€Œæ¢æ¥çš„ã€‚è‹¥æ˜¯å¦‚æ­¤ï¼Œé‚£ä½ çš„æˆåŠŸä¸å¹¸åªä»£è¡¨â€ä½ ä¸ºä»–äººæ´»äº†ä¸€è¾ˆå­â€ â€”â€” é™ˆæ–‡èŒœ</p>
<h1 id="å¿ƒé‡Œåˆ›ä¼¤å¹¶ä¸å­˜åœ¨"><a href="#å¿ƒé‡Œåˆ›ä¼¤å¹¶ä¸å­˜åœ¨" class="headerlink" title="å¿ƒé‡Œåˆ›ä¼¤å¹¶ä¸å­˜åœ¨"></a>å¿ƒé‡Œåˆ›ä¼¤å¹¶ä¸å­˜åœ¨</h1><p>é˜¿å¾·å‹’åœ¨å¦å®šå¿ƒç†åˆ›ä¼¤å­¦è¯´çš„æ—¶å€™è¯´äº†ä¸‹é¢è¿™æ®µè¯ï¼šâ€œä»»ä½•ç»å†æœ¬èº«å¹¶ä¸æ˜¯æˆåŠŸæˆ–è€…å¤±è´¥çš„åŸå› ã€‚æˆ‘ä»¬å¹¶éå› ä¸ºè‡ªèº«ç»å†ä¸­çš„åˆºæ¿€â€”â€”æ‰€è°“çš„å¿ƒç†åˆ›ä¼¤â€”â€”è€Œç—›è‹¦ï¼Œäº‹å®ä¸Šæˆ‘ä»¬ä¼šä»ç»å†ä¸­å‘ç°ç¬¦åˆè‡ªå·±ç›®çš„çš„å› ç´ ã€‚å†³å®šæˆ‘ä»¬è‡ªèº«çš„ä¸æ˜¯è¿‡å»çš„ç»å†ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±èµ‹äºˆç»å†çš„æ„ä¹‰ã€‚â€</p>
<p>é˜¿å¾·å‹’è¯´ï¼Œå†³å®šæˆ‘ä»¬è‡ªå·±çš„ä¸æ˜¯â€œç»éªŒæœ¬èº«â€è€Œæ˜¯â€œèµ‹äºˆç»éªŒçš„æ„ä¹‰â€ã€‚è¯·ä½ æ³¨æ„è¿™ä¸€ç‚¹ã€‚å¹¶ä¸æ˜¯è¯´é­é‡å¤§çš„ç¾å®³æˆ–è€…å¹¼å¹´å—åˆ°è™å¾…ä¹‹ç±»çš„äº‹ä»¶å¯¹äººæ ¼å½¢æˆæ¯«æ— å½±å“ã€‚ç›¸åï¼Œå½±å“ä¼šå¾ˆå¤§ã€‚ä½†å…³é”®æ˜¯ç»å†æœ¬èº«ä¸ä¼šå†³å®šä»€ä¹ˆã€‚æˆ‘ä»¬ç»™è¿‡å»çš„ç»å†â€œèµ‹äºˆäº†ä»€ä¹ˆæ ·çš„æ„ä¹‰â€ï¼Œè¿™ç›´æ¥å†³å®šäº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚äººç”Ÿä¸æ˜¯ç”±åˆ«äººèµ‹äºˆçš„ï¼Œè€Œæ˜¯ç”±è‡ªå·±é€‰æ‹©çš„ï¼Œæ˜¯è‡ªå·±é€‰æ‹©è‡ªå·±å¦‚ä½•ç”Ÿæ´»ã€‚</p>
<h1 id="ä¸€åˆ‡çƒ¦æ¼éƒ½æ¥è‡ªäººé™…å…³ç³»"><a href="#ä¸€åˆ‡çƒ¦æ¼éƒ½æ¥è‡ªäººé™…å…³ç³»" class="headerlink" title="ä¸€åˆ‡çƒ¦æ¼éƒ½æ¥è‡ªäººé™…å…³ç³»"></a>ä¸€åˆ‡çƒ¦æ¼éƒ½æ¥è‡ªäººé™…å…³ç³»</h1><p>åœ¨äººé™…å…³ç³»ä¸­æ ¹æœ¬ä¸å¯èƒ½ä¸å—ä¼¤ã€‚åªè¦æ¶‰å…¥äººé™…å…³ç³»å°±ä¼šæˆ–å¤§æˆ–å°åœ°å—ä¼¤ï¼Œä¹Ÿä¼šä¼¤å®³åˆ«äººã€‚é˜¿å¾·å‹’æ›¾è¯´â€œè¦æƒ³æ¶ˆé™¤çƒ¦æ¼ï¼Œåªæœ‰ä¸€ä¸ªäººåœ¨å®‡å®™ä¸­ç”Ÿå­˜â€ã€‚ä½†æ˜¯ï¼Œé‚£ç§äº‹æƒ…æ ¹æœ¬å°±æ— æ³•åšåˆ°ã€‚</p>
<h1 id="è‡ªå‘æ„Ÿ"><a href="#è‡ªå‘æ„Ÿ" class="headerlink" title="è‡ªå‘æ„Ÿ"></a>è‡ªå‘æ„Ÿ</h1><p>è‡ªå‘æ„Ÿçš„é—®é¢˜æ˜¯æˆ‘å¦‚ä½•çœ‹å¾…è¿™ç§è‡ªå·±ä»¥åŠèµ‹äºˆå®ƒä»€ä¹ˆæ ·çš„ä»·å€¼ã€‚å›°æ‰°æˆ‘ä»¬çš„è‡ªå‘æ„Ÿä¸æ˜¯â€å®¢è§‚æ€§çš„äº‹å®â€è€Œæ˜¯â€ä¸»è§‚æ€§çš„è§£é‡Šâ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»·å€¼å¿…é¡»å»ºç«‹åœ¨ç¤¾ä¼šæ„ä¹‰ä¹‹ä¸Šã€‚ä¸ä»–äººæ¯”è¾ƒã€è‡ªå·±èµ‹äºˆè‡ªå·±çš„æ„ä¹‰ï¼Œå¸¦æ¥äº†è‡ªå‘æ„Ÿã€‚</p>
<h1 id="ä¼˜è¶Šæ€§"><a href="#ä¼˜è¶Šæ€§" class="headerlink" title="ä¼˜è¶Šæ€§"></a>ä¼˜è¶Šæ€§</h1><p>äººéƒ½å¤„äºè¿½æ±‚ä¼˜è¶Šæ€§è¿™ä¸€â€å¸Œæœ›è¿›æ­¥çš„çŠ¶æ€â€ä¹‹ä¸­ï¼Œæ ‘ç«‹æŸäº›ç†æƒ³æˆ–ç›®æ ‡å¹¶åŠªåŠ›ä¸ºä¹‹å¥‹æ–—ã€‚åŒæ—¶ï¼Œå¯¹äºæ— æ³•è¾¾æˆç†æƒ³çš„è‡ªå·±å°±ä¼šäº§ç”Ÿä¸€ç§è‡ªå‘æ„Ÿã€‚è€Œè¶Šè‡ªè´Ÿçš„äººè¶Šè‡ªå‘ï¼Œè¡¨ç°å¾—è‡ªå·±å¥½åƒå¾ˆä¼˜ç§€ï¼Œç»§è€Œæ²‰æµ¸åœ¨ä¸€ç§è™šå‡çš„ä¼˜è¶Šæ„Ÿä¹‹ä¸­ã€‚å¥å…¨çš„è‡ªå‘æ„Ÿä¸æ˜¯æ¥è‡ªä¸åˆ«äººçš„æ¯”è¾ƒï¼Œè€Œæ˜¯æ¥è‡ªä¸â€ç†æƒ³çš„è‡ªå·±â€çš„æ¯”è¾ƒã€‚</p>
<h1 id="å¯»æ±‚ä»–äººçš„è®¤å¯"><a href="#å¯»æ±‚ä»–äººçš„è®¤å¯" class="headerlink" title="å¯»æ±‚ä»–äººçš„è®¤å¯"></a>å¯»æ±‚ä»–äººçš„è®¤å¯</h1><p>é˜¿å¾·å‹’å¿ƒç†å­¦å¦å®šå¯»æ±‚ä»–äººçš„è®¤å¯ã€‚æˆ‘ä»¬å¹¶ä¸æ˜¯ä¸ºäº†æ»¡è¶³åˆ«äººçš„æœŸå¾…è€Œæ´»ç€ï¼Œä»–äººä¹Ÿä¸æ˜¯ä¸ºäº†æ»¡è¶³ä½ çš„æœŸå¾…è€Œæ´»ã€‚å¦‚æœä¸€å‘³å¯»æ±‚åˆ«äººçš„è®¤å¯ã€åœ¨ä¸€åˆ«äººçš„è¯„ä»·ï¼Œé‚£æœ€ç»ˆå°±ä¼šæ´»åœ¨åˆ«äººçš„äººç”Ÿä¸­ã€‚</p>
<h1 id="è‡ªç”±"><a href="#è‡ªç”±" class="headerlink" title="è‡ªç”±"></a>è‡ªç”±</h1><p>â€œè‡ªç”±å°±æ˜¯è¢«åˆ«äººè®¨åŒâ€ã€‚æ¯«ä¸åœ¨æ„åˆ«äººçš„è¯„ä»·ã€ä¸å®³æ€•è¢«åˆ«äººè®¨åŒã€ä¸è¿½æ±‚è¢«ä»–äººè®¤å¯ï¼Œå¦‚æœä¸ä»˜å‡ºä»¥ä¸Šè¿™äº›ä»£ä»·ï¼Œé‚£å°±æ— æ³•è´¯å½»è‡ªå·±çš„ç”Ÿæ´»æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è·å¾—è‡ªç”±ã€‚</p>
<h1 id="æœ€å¤§çš„ä¸å¹¸"><a href="#æœ€å¤§çš„ä¸å¹¸" class="headerlink" title="æœ€å¤§çš„ä¸å¹¸"></a>æœ€å¤§çš„ä¸å¹¸</h1><p>å¯¹äººè€Œè¨€ï¼Œæœ€å¤§çš„ä¸å¹¸å°±æ˜¯ä¸å–œæ¬¢è‡ªå·±ã€‚å¹¸ç¦å°±æ˜¯â€è´¡çŒ®æ„Ÿâ€ã€‚äººåªæœ‰åœ¨èƒ½å¤Ÿæ„Ÿè§‰åˆ°â€æˆ‘å¯¹åˆ«äººæœ‰ç”¨â€çš„æ—¶å€™æ‰èƒ½ä½“ä¼šåˆ°è‡ªå·±çš„ä»·å€¼ã€‚ä½†æ˜¯ï¼Œè¿™ç§è´¡çŒ®ä¹Ÿå¯ä»¥ç«¥å·¥çœ‹ä¸è§çš„å½¢å¼å®ç°ã€‚åªè¦æœ‰â€å¯¹åˆ«äººæœ‰ç”¨â€çš„ä¸»ç®¡æ„Ÿè§‰ï¼Œå³â€è´¡çŒ®æ„Ÿâ€å°±å¯ä»¥ã€‚</p>
<h1 id="ç”˜äºå¹³å‡¡çš„å‹‡æ°”"><a href="#ç”˜äºå¹³å‡¡çš„å‹‡æ°”" class="headerlink" title="ç”˜äºå¹³å‡¡çš„å‹‡æ°”"></a>ç”˜äºå¹³å‡¡çš„å‹‡æ°”</h1><p>æ— è®ºæ˜¯å¸Œæœ›ç‰¹åˆ«ä¼˜ç§€è¿˜æ˜¯å¸Œæœ›ç‰¹åˆ«å·®åŠ²ï¼Œå…¶ç›®çš„éƒ½ä¸€æ ·â€”â€”å¼•èµ·ä»–äººçš„å…³æ³¨ã€è„±ç¦»â€æ™®é€šâ€çš„çŠ¶æ€ã€æˆä¸ºâ€ç‰¹åˆ«çš„å­˜åœ¨â€ã€‚é˜¿å¾·å‹’å¿ƒç†å­¦ç§°ä¹‹ä¸ºâ€å»‰ä»·çš„ä¼˜è¶Šæ€§è¿½æ±‚â€ã€‚æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰å¿…è¦ç‰¹æ„ç‚«è€€è‡ªå·±çš„ä¼˜è¶Šæï¼Œè¦æœ‰ç”˜äºå¹³å‡¡çš„å‹‡æ°”ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬ç»å¸¸æƒ³ç€è¦æ˜¯æˆ‘å»åšæŸäº‹æˆ–æˆ‘æœ‰ä»€ä¹ˆæ ·çš„æ¡ä»¶æˆ‘ä¹Ÿå¯ä»¥å–å¾—æˆåŠŸï¼Œä½†æ˜¯æˆ‘ä»¬å¾€å¾€ç¼ºä¹è¸å‡ºé‚£ä¸€æ­¥çš„å‹‡æ°”ï¼Œæ›´æ„¿æ„ä»¥å„ç§å‡æƒ³æ¡ä»¶æ¥å®‰æ…°è‡ªå·±ï¼Œæ´»åœ¨è‡ªå·±æƒ³è±¡çš„â€å¯èƒ½æ€§â€ä¹‹ä¸‹ã€‚ä¹Ÿè®¸æ˜¯æ‹…å¿ƒæ¢¦å¯èƒ½ä¼šç ´ç­ï¼Œä½†æ˜¯åªæœ‰æ¢¦æƒ³ç ´ç­æ—¶æˆ‘ä»¬æ‰ä¼šæœ‰æ‰€æˆé•¿å§ï½</p>
<p>è¯»å®Œè¿™æœ¬ä¹¦ï¼Œå¯¹è‡ªå·±çš„å¿ƒç†è®¤çŸ¥åˆæœ‰äº†æ–°çš„æ€è€ƒï¼Œå…¶ä¸­æœ€è®©æˆ‘å°è±¡æ·±åˆ»çš„æ˜¯é˜¿å¾·å‹’å¿ƒç†å­¦å¦å®šäº†å¿ƒç†åˆ›ä¼¤ã€‚å…³äºå¿ƒç†åˆ›ä¼¤ï¼Œç”¨é˜¿å¾·å‹’çš„è§‚ç‚¹ç®€å•ç†è§£å°±æ˜¯æˆ‘ä»¬é¢å¯¹çœ¼å‰çš„å›°éš¾ä¸æƒ³åšå‡ºæ”¹å˜ï¼Œæ‰€ä»¥æ¬å‡ºå¿ƒç†åˆ›ä¼¤è¿™ä¸ªç†ç”±æ¥é€ƒé¿çœ¼å‰çš„å›°éš¾ã€‚è€Œä½›æ´›ä¼Šå¾·æ˜¯å¿ƒç†åˆ›ä¼¤ç†è®ºçš„æ‹¥æŠ¤è€…ï¼Œä»–è®¤ä¸ºæ˜¯ç”±äºå¿ƒç†åˆ›ä¼¤çš„å­˜åœ¨ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•é¢å¯¹çœ¼å‰çš„å›°éš¾ã€‚è¿™ä¸¤ç§è§‚ç‚¹çš„æœ¬è´¨å°±æ˜¯ç›®çš„è®ºå’ŒåŸå› è®ºçš„åŒºåˆ«ã€‚<br>ä»ä¸ªäººè§‚ç‚¹å‡ºå‘ï¼Œæˆ‘ä¸ªäººå€¾å‘äºé˜¿å¾·å‹’çš„ç›®çš„è®ºï¼Œå› ä¸ºå°†å¿ƒç†åˆ›ä¼¤ç†è§£ä¸ºç›®çš„è®ºæœ‰åŠ©äºæˆ‘ä»¬åšå‡ºç§¯æçš„æ”¹å˜ï¼Œå…‹æœå›°éš¾ã€‚è€Œå¦‚æœå°†å¿ƒç†åˆ›ä¼¤ç†è§£ä¸ºåŸå› è®ºï¼Œæˆ‘ä»¬è¦ä¹ˆé€ƒé¿è¦ä¹ˆåŸåœ°è¸æ­¥ï¼Œæ— æ³•ç§¯æåšå‡ºæ”¹å˜åº”å¯¹å›°éš¾ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è§£å†³é—®é¢˜çš„æ–¹å¼æˆä¸ºäº†é—®é¢˜æ‰€åœ¨ã€‚<br>ä»¥ä¸Šä»…ä¸ºä¸ªäººçš„æµ…è–„è§è§£ï¼Œå› ä¸ºå¯¹å¿ƒç†å­¦è¿™å—æ²¡æœ‰æ·±å…¥çš„å­¦ä¹ äº†è§£ï¼Œæ²¡æœ‰å¤ªå¤šçš„å‘è¨€æƒï¼Œæœ‰æ—¶å€™åœ¨æƒ³å¿ƒç†åˆ›ä¼¤æ˜¯å¦ä¼šå¯¼è‡´æˆ‘ä»¬èº«ä½“å‡ºç°åº”æ€¥ååº”ï¼Œå¯¼è‡´æˆ‘ä»¬æ ¹æœ¬æ— æ³•åšå‡ºç§¯æçš„æ”¹å˜ï¼Œä½›æ´›ä¼Šå¾·çš„åŸå› è®ºä¹Ÿå¹¶ä¸æ— é“ç†ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>è¢«è®¨åŒçš„å‹‡æ°”</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šèƒ½åŠ›é™·é˜±ã€‹</title>
    <url>/2022/05/04/book/neng-li-xian-jing/</url>
    <content><![CDATA[<p><em><strong>ã€Šèƒ½åŠ›é™·é˜±ã€‹ï¼ˆAct Like A Leader, Think Like A Leaderï¼‰â€”â€” åƒé¢†å¯¼è€…ä¸€æ ·è¡ŒåŠ¨ï¼Œåƒé¢†å¯¼è€…ä¸€æ ·æ€è€ƒã€‚</strong></em></p>
<p><img src="/images/book/%E8%83%BD%E5%8A%9B%E9%99%B7%E9%98%B1.jpeg" alt="èƒ½åŠ›é™·é˜±"></p>
<h1 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h1><p>è¿™æœ¬ä¹¦å¾ˆæ—©å°±åœ¨æ¨Šç™»è¯»ä¹¦çš„APPä¸Šå¬è¿‡ä¸€æ¬¡ï¼Œå½“æ—¶å¬å®Œåå¹¶æœªç•™ä¸‹æ·±åˆ»çš„å°è±¡ã€‚éšç€è‡ªå·±å·¥ä½œç»å†çš„å¢åŠ ï¼Œå¼€å§‹ä¸æ–­åæ€è‡ªå·±çš„äººç”Ÿï¼Œå‘ç°è‡ªå·±åƒæ˜¯æ‰å…¥æ³¥æ½­ä¹‹ä¸­ï¼Œä¸æ–­æŒ£æ‰ï¼Œä½†å´æ‰¾ä¸åˆ°æ–¹æ³•å’Œæ–¹å‘ã€‚æœ‰å¤©åœ¨ä¸‹ç­çš„è·¯ä¸Šï¼Œæƒ³èµ·äº†è¿™æœ¬ä¹¦äºæ˜¯é‡æ–°æŠŠè¿™æœ¬ä¹¦å¬äº†ä¸€éï¼Œä»ä¸­ä»¿ä½›æ‰¾åˆ°äº†æ–¹å‘ã€‚äºæ˜¯ä¹°äº†å®ä½“ä¹¦æ¥çœ‹ï¼Œåˆšå¼€å§‹ç¿»çœ‹äº†ä¸€éƒ¨åˆ†ï¼Œç„¶åç”±äºè¿™æ ·é‚£æ ·çš„åŸå› ä¸€ç›´æ— æ³•é™ä¸‹å¿ƒæ¥å»è¯»å®Œï¼Œç›´è‡³ä»Šå¹´äº”ä¸€å‡æœŸï¼Œä¸€é¼“ä½œæ°”è¯»å®Œäº†è¿™æœ¬ä¹¦ã€‚èµ·åˆæˆ‘ä»¥ä¸ºè¿™æ˜¯é¢å‘é¢†å¯¼è€…çš„ä¹¦ç±ï¼Œè¯»å®Œåå‘ç°ï¼Œè¿™æœ¬ä¹¦é€‚åˆæ¯ä¸ªæƒ³è¦åœ¨èŒä¸šç”Ÿæ¶¯ä¸­æ›´è¿›ä¸€æ­¥çš„äººã€‚æˆ‘è‡ªå·±ä»Šå¹´åœ¨å·¥ä½œä¸­æ‹…ä»»äº†å°ç»„é•¿çš„è§’è‰²ï¼Œéœ€è¦è¿›è¡Œä¸€äº›è‡ªæˆ‘è½¬å˜ï¼Œè¿™æœ¬ä¹¦å¸®æˆ‘åˆ†ææ¸…äº†è‡ªæˆ‘è½¬å˜çš„è¿‡ç¨‹ä»¥åŠè¿‡ç¨‹ä¸­ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œå¹¶æä¾›äº†è®¸å¤šæ–¹æ³•ã€‚åŒæ—¶è¿™æœ¬ä¹¦è®©æˆ‘å­¦ä¼šäº†é‡æ–°å®šä¹‰è‡ªå·±ï¼Œæ‰“ç ´è‡ªå·±æ›¾ç»çš„æ€ç»´å›°å¢ƒï¼Œèµ°å‡ºæ³¥æ½­ã€‚</p>
<p>â€œæœ‰äº›ä¹¦ä½ å¯èƒ½æ—©æ—©çš„ä¹°æ¥äº†ï¼Œä½†æ˜¯ç¿»çœ‹äº†å‡ é¡µç”±äºæœªèƒ½æèµ·ä½ çš„å…´è‡´ï¼Œå°±æç½®åœ¨ä¹¦æ¶ä¸Šå»äº†ï¼Œç›´åˆ°æœ‰ä¸€å¤©ä½ ä»ä¹¦æ¶ä¸Šçœ‹åˆ°äº†å®ƒå¹¶æ‹¿èµ·ç¿»çœ‹äº†ä¸€ä¸‹ï¼Œç„¶åä¸€ä¸‹å­è¢«å†…å®¹å¸å¼•ä¸€é¼“ä½œæ°”è¯»å®Œäº†ã€‚å½“æˆ‘ä»¬çš„äººç”Ÿç»å†æ— æ³•å’Œä¹¦ä¸­çš„å†…å®¹äº§ç”Ÿå…±é¸£æ—¶ï¼Œå¾ˆéš¾æœ‰å…´è‡´ç»§ç»­è¯»ä¸‹å»ï¼Œå³ä½¿åšæŒè¯»å®Œä¹Ÿæ˜¯è¯»çš„ä¼¼æ‡‚éæ‡‚ã€‚å½“æˆ‘ä»¬ç»å†äº†è¶³å¤Ÿå¤šçš„äº‹æƒ…åï¼Œå†æ‹¿èµ·è¿™æœ¬ä¹¦æ—¶ï¼Œæœ‰ä¸€ç§è±ç„¶å¼€æœ—çš„æ„Ÿè§‰ï¼Œè¯»çš„å¦‚ç—´å¦‚é†‰ã€‚æ‰€ä»¥ä¸å¿…ç€æ€¥æ¸…ç†ä½ çš„ä¹¦æ¶ä¸Šè¿˜æœªæ›¾è¯»å®Œçš„ä¹¦ï¼Œä¹Ÿè®¸ä½ ä»¬çš„ç¼˜åˆ†è¦è¿Ÿä¸€ç‚¹åˆ°â€œã€‚è¿™æ˜¯æˆ‘æ›¾åœ¨å¦ä¸€æœ¬ä¹¦ä¸­çœ‹åˆ°çš„ä¸€æ®µè¯ï¼Œå®Œå…¨å°è¯äº†æˆ‘è¯»è¿™æœ¬ä¹¦çš„ç»å†ã€‚</p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote>
<p>[ç¾]åŸƒç±³å°¼äºšÂ·ä¼Šè´æ‹‰ â€”â€” è‘— &#x2F; ç‹è‡» â€”â€” è¯‘</p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬å¾ˆä¹äºå»åšæˆ‘ä»¬æ“…é•¿çš„äº‹ï¼Œäºæ˜¯å°±ä¼šä¸€ç›´å»åšï¼Œæœ€ç»ˆå°±ä½¿å¾—æˆ‘ä»¬ä¼šä¸€ç›´æ“…é•¿é‚£äº›äº‹ã€‚åšçš„è¶Šå¤šï¼Œå°±è¶Šæ“…é•¿ï¼Œè¶Šæ“…é•¿å°±è¶Šæ„¿æ„å»åšã€‚è¿™æ ·çš„ä¸€ä¸ªå¾ªç¯èƒ½è®©æˆ‘ä»¬åœ¨è¿™æ–¹é¢è·å¾—æ›´å¤šçš„ç»éªŒï¼Œä½†å´å®¹æ˜“é™·å…¥èƒ½åŠ›é™·é˜±ï¼Œåœ¨å…¶å®ƒæ–¹é¢æ— æ³•çªç ´ã€‚</p>
</blockquote>
<blockquote>
<p>æ¯ä¸ªäººéƒ½è¦ç‰¹åˆ«è­¦æƒ•è¿™ç§èƒ½åŠ›é™·é˜±ï¼Œé¿å…æŠŠå¤§é‡æ—¶é—´èŠ±åœ¨æ—¥å¸¸çäº‹ä¸Šã€‚å¦‚æœä½ æƒ³è·å¾—æ›´å¤šæ›´å¥½çš„å‘å±•ï¼Œå°±è¦ä»æ—¥å¸¸çäº‹ä¸­è§£è„±å‡ºæ¥ï¼Œè½¬å˜åˆ°æ›´å¤šç­–ç•¥æ€§æ€è€ƒã€åœ¨æ—¥å¸¸å·¥ä½œå¤–å»ºç«‹äººé™…å…³ç³»ç½‘ç»œã€æå‡å½±å“åŠ›ç­‰èƒ½å¤Ÿç»™ä½ å¸¦æ¥æŒç»­ä»·å€¼çš„å·¥ä½œä¸Šï¼Œè¿™æ ·ä½ æ‰èƒ½åœ¨å„é¢†åŸŸè·å¾—æ›´å¥½çš„å‘å±•ã€‚</p>
</blockquote>
<p>è¿™ä¸æ˜¯ä¸€æœ¬é¸¡æ±¤åŠ±å¿—ä¹¦ç±ï¼Œæœ¬ä¹¦ä½œè€…åŸƒç±³å°¼äºšÂ·ä¼Šè´æ‹‰æ˜¯æ¬§æ´²å·¥å•†ç®¡ç†å­¦é™¢ï¼ˆINSEADï¼‰ç»„ç»‡è¡Œä¸ºå­¦æ•™æˆå…¼é¢†å¯¼ä¸å­¦ä¹ é¦–å¸­æ•™æˆã€‚åœ¨åŠ å…¥INSEADå‰ï¼Œå¥¹åœ¨å“ˆä½›å•†å­¦é™¢å·¥ä½œäº†13å¹´ã€‚ä¹¦ä¸­ç»“åˆäº†å¤§é‡çš„ç ”ç©¶åŠæ•™å­¦æ¡ˆä¾‹ï¼Œæ˜¯ä½œè€…æ•°åå¹´ç ”ç©¶çš„ç²¾åæ‰€åœ¨ï¼Œå†…å®¹é€šä¿—æ˜“æ‡‚ï¼Œæ»¡æ»¡çš„å…¨æ˜¯å¹²è´§ã€‚</p>
<h1 id="ä¸€ã€é¢†å¯¼è€…çš„èƒ½åŠ›é™·é˜±"><a href="#ä¸€ã€é¢†å¯¼è€…çš„èƒ½åŠ›é™·é˜±" class="headerlink" title="ä¸€ã€é¢†å¯¼è€…çš„èƒ½åŠ›é™·é˜±"></a>ä¸€ã€é¢†å¯¼è€…çš„èƒ½åŠ›é™·é˜±</h1><h2 id="1-1-æ”¹å˜æ€æƒ³ä»è¡ŒåŠ¨å¼€å§‹"><a href="#1-1-æ”¹å˜æ€æƒ³ä»è¡ŒåŠ¨å¼€å§‹" class="headerlink" title="1.1 æ”¹å˜æ€æƒ³ä»è¡ŒåŠ¨å¼€å§‹"></a>1.1 æ”¹å˜æ€æƒ³ä»è¡ŒåŠ¨å¼€å§‹</h2><blockquote>
<p>å¾ˆå¤šä¼ ç»Ÿçš„é¢†å¯¼åŠ›åŸ¹è®­æˆ–è¾…å¯¼çš„ç›®çš„æ˜¯æ”¹å˜ä½ æ€è€ƒçš„æ–¹å¼ï¼Œæ•™ä½ å­¦ä¼šåæ€ä½ æ˜¯è°ä»¥åŠä½ è¦æˆä¸ºè°çš„é—®é¢˜ã€‚çš„ç¡®ï¼Œè‡ªçœå’Œåæ€æ˜¯æˆä¸ºä¸€ä¸ªé¢†å¯¼è€…çš„é»„é‡‘æ³•åˆ™ã€‚é¦–å…ˆè¦æé«˜è‡ªæˆ‘æ„è¯†ï¼Œè®¤è¯†è‡ªå·±ã€‚å¦‚æœä½ å°è¯•è¿‡è¿™äº›æ–¹æ³•ï¼Œä½ å°±ä¼šå‘ç°å®ƒä»¬æ˜¯éå¸¸æœ‰å±€é™æ€§çš„ã€‚è™½ç„¶åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œå®ƒä»¬èƒ½å¸®åŠ©ä½ è®¤è¯†åˆ°ä½ å½“å‰çš„èƒ½åŠ›ä»¥åŠé¢†å¯¼æ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°ï¼Œå½“å‰çš„æƒ³æ³•æ°æ°æ˜¯é˜»ç¢ä½ ç»§ç»­å‰è¡Œçš„ç»Šè„šçŸ³ã€‚æ‰€ä»¥ä½ éœ€è¦æ”¹å˜çš„æ˜¯ä½ çš„æ€è€ƒæ–¹å¼ï¼Œè€Œåªæœ‰ä¸€ç§æ–¹æ³•èƒ½æ”¹å˜å®ƒï¼šæ”¹å˜ä½ çš„åšäº‹æ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>äºšé‡Œå£«å¤šå¾·å‘ç°ï¼Œä¸€ä¸ªäººå¦‚æœè¡¨ç°å¾—å¾ˆæœ‰ç¾å¾·ï¼Œé‚£ä»–æœ€ç»ˆä¼šæˆä¸ºä¸€ä¸ªæœ‰ç¾å¾·çš„äººï¼Œå³å¤šåšå¥½äº‹å°±ä¼šå˜æˆå¥½äººã€‚ä»–çš„è¿™ä¸€è¯´æ³•å¾—åˆ°å¾ˆå¤šç¤¾ä¼šå¿ƒç†å­¦å®¶çš„è¯å®ï¼Œç ”ç©¶è¡¨æ˜ä¸€ä¸ªäººè‹¥æ”¹å˜äº†ä»–çš„æƒ³æ³•ï¼Œæ˜¯å› ä¸ºä»–çš„è¡Œä¸ºå…ˆå‘ç”Ÿäº†æ”¹å˜ã€‚ç®€å•æ¥è¯´ï¼Œæ”¹å˜æ˜¯ç”±å¤–è€Œå†…ï¼Œè€Œå¹¶éç”±å†…è€Œå¤–äº§ç”Ÿçš„ã€‚æ­£å¦‚ç®¡ç†ä¸“å®¶ç†æŸ¥å¾·Â·å¸•æ–¯å¡å°”ï¼ˆRichard Pascaleï¼‰æ‰€è¯´ï¼šâ€œæˆå¹´äººæ›´å€¾å‘äºå…ˆåšè€Œåäº§ç”Ÿæ–°çš„æƒ³æ³•ï¼Œè€Œä¸æ˜¯å…ˆæƒ³å†ä»¥ä¸€ç§æ–°çš„æ–¹å¼å»åšã€‚â€</p>
</blockquote>
<p>å¤è¯­æœ‰äº‘ï¼šä¸‰æ€è€Œåè¡Œã€‚åœ¨åšä¸€ä»¶äº‹å‰ï¼Œæˆ‘ä»¬ä»”ç»†æ€è€ƒç„¶ååšå¥½è¯¦ç»†è®¡åˆ’ï¼Œè¿™åœ¨æ­£å¸¸æƒ…å†µä¸‹é€šå¸¸éƒ½éå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯å½“æˆ‘ä»¬å»åšæ–°çš„äº‹æƒ…ã€é¢å¯¹æ–°çš„æŒ‘æˆ˜çš„æ—¶å€™ï¼Œç”±äºä»æœªæœ‰è¿‡ç»éªŒï¼Œæˆ‘ä»¬ä¼šçŠ¹è±«å†ä¸‰ï¼ŒåŠªåŠ›æ€è€ƒæˆ‘ä»¬çš„æ–¹æ¡ˆæˆ–è®¡åˆ’æ˜¯å¦å¯è¡Œï¼Œå¾ˆå¤šæ—¶å€™åœ¨æ€è€ƒä¸­é”™è¿‡äº†æœ€ä½³æ—¶æœºã€‚æ‰€ä»¥å½“é¢å¯¹æ–°çš„äº‹ç‰©ï¼Œæˆ–è€…é¢ä¸´æ”¹å˜çš„æ—¶å€™ï¼Œæ€æƒ³ä»ç„¶åœç•™åœ¨è¿‡å»ï¼Œå¿…é¡»å…ˆè¡ŒåŠ¨å†æ€è€ƒã€‚</p>
<p>æ­¤å¤–æˆ‘è¿˜å‘ç°ä¸€ä¸ªè§„å¾‹ï¼š<code>å®Œç¾çš„è¡¨ç° = é€‚å½“çš„çŠ¶æ€ + æ°å½“çš„æ—¶æœº</code>ï¼Œä¸€ç›´ä»¥æ¥æˆ‘æŠ±ç€â€œåå¹´ç£¨ä¸€å‰‘â€çš„å¿ƒæ€ï¼Œå¸¸å¸¸å¸Œæœ›è‡ªå·±è¾¾åˆ°æœ€ä½³çŠ¶æ€å†è¡ŒåŠ¨ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå½“æˆ‘ä»¬å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œä½†æ˜¯å´é”™è¿‡äº†æœ€ä½³çš„æ—¶æœºï¼Œç»“æœåä¸å¦‚æå‰è¡ŒåŠ¨çš„æ•ˆæœå¥½ã€‚</p>
<h2 id="1-2-ç”±å¤–è€Œå†…çš„è½¬å˜"><a href="#1-2-ç”±å¤–è€Œå†…çš„è½¬å˜" class="headerlink" title="1.2 ç”±å¤–è€Œå†…çš„è½¬å˜"></a>1.2 ç”±å¤–è€Œå†…çš„è½¬å˜</h2><blockquote>
<p>å¦‚æœæˆ‘ä»¬åƒä¸€ä¸ªé¢†å¯¼è€…ä¸€æ ·åšäº‹ï¼šå¦‚ä¸æ–­æå‡ºæ–°è§‚ç‚¹ï¼Œåœ¨ä¸“ä¸šé¢†åŸŸä¹‹å¤–åšå‡ºè´¡çŒ®ï¼Œæˆ–æ˜¯é›†åˆäººåŠ›ç‰©åŠ›åšæˆä¸€ä»¶å¾ˆæœ‰ä»·å€¼çš„äº‹ï¼Œç­‰ç­‰ã€‚èº«è¾¹çš„å…¶ä»–äººä¹Ÿå°±ä¼šè§‰å¾—æˆ‘ä»¬è¶Šæ¥è¶Šåƒä¸€ä¸ªçœŸæ­£çš„é¢†å¯¼è€…ã€‚ç ”ç©¶å‘ç°ï¼Œç¤¾ä¼šè®¤åŒåŠä¸ªäººåå£°ç»™å¿ƒç†å­¦å®¶æ‰€è°“çš„é¢†å¯¼è€…èº«ä»½å†…åœ¨åŒ–ï¼ˆInternalizingï¼Œå³æŠŠè‡ªå·±çœ‹ä½œä¸€ä¸ªé¢†å¯¼è€…ï¼‰æä¾›äº†æ¡ä»¶ï¼Œä»è€Œä½¿ä»–ä»¬èƒ½æŠ“ä½æ›´å¤šçš„æœºä¼šæ¥å±•ç°è‡ªå·±çš„é¢†å¯¼æ‰èƒ½ã€‚</p>
</blockquote>
<blockquote>
<p>å…ˆåƒé¢†å¯¼è€…ä¸€æ ·åšäº‹ï¼Œè€Œåæ‰èƒ½åƒé¢†å¯¼è€…ä¸€æ ·æ€è€ƒï¼Œè¿™æ ·çš„ä¸€ä¸ªå¾ªç¯â€”â€”å¤–åœ¨æ”¹å˜å¼•èµ·çš„å†…åœ¨æ”¹å˜â€”â€”ä¹Ÿå°±æ˜¯æˆ‘æ‰€è°“çš„â€œç”±å¤–è€Œå†…â€ï¼ˆOutsightï¼‰ã€‚</p>
</blockquote>
<h2 id="1-3-â€œç”±å¤–è€Œå†…â€œåŸåˆ™"><a href="#1-3-â€œç”±å¤–è€Œå†…â€œåŸåˆ™" class="headerlink" title="1.3 â€œç”±å¤–è€Œå†…â€œåŸåˆ™"></a>1.3 â€œç”±å¤–è€Œå†…â€œåŸåˆ™</h2><blockquote>
<p>ä¸€ä¸ªäººçš„æ€ç»´æ–¹å¼æ˜¯å¾ˆéš¾æ”¹å˜çš„ï¼Œå› ä¸ºæ”¹å˜éœ€è¦å¤–åœ¨ç»å†ã€‚å¦‚æœä¸æ˜¯ç”±å¤–è€Œå†…åœ°æ”¹å˜ï¼Œæˆ‘ä»¬çš„è‡ªæˆ‘è®¤çŸ¥ä¼šè¢«è¿‡å»æ‰€ç¦é”¢ï¼Œä»è€Œå¯¼è‡´æ€æƒ³å’Œè¡Œä¸ºä¹Ÿæ— æ³•æ”¹å˜ã€‚æ²¡æœ‰äººä¼šæ¯”æˆ‘ä»¬è‡ªå·±æ›´é€‚åˆç»™è‡ªå·±è¿›è¡Œå®šä½ã€‚æ”¹å˜çš„çŸ›ç›¾åœ¨äºï¼Œæ”¹å˜æƒ³æ³•çš„å”¯ä¸€åŠæ³•å°±æ˜¯è¦åšä¸€äº›ä¹‹å‰æ²¡æœ‰åšè¿‡çš„äº‹ï¼Œè€Œè¿™äº›äº‹æ­£æ˜¯ä¹‹å‰çš„æƒ³æ³•æ‰€ä¸è®¤åŒçš„äº‹ã€‚</p>
</blockquote>
<blockquote>
<p>å…ˆåƒé¢†å¯¼è€…ä¸€æ ·è¡Œäº‹ï¼Œå¦‚ç§¯æå‚ä¸æ–°é¡¹ç›®ä»¥åŠæ–°æ´»åŠ¨ï¼Œä¸å„å¼å„æ ·çš„äººæ‰“äº¤é“ä»¥åŠå°è¯•é‡‡ç”¨æ–°æ–¹æ³•åšäº‹ç­‰ã€‚é‚£äº›å……æ»¡æŒ‘æˆ˜çš„æ–°ç»å†ä»¥åŠå®ƒä»¬æ‰€å¸¦æ¥çš„æˆå°±ä¼šæ”¹å˜é‚£äº›ä¸€ç›´é™åˆ¶ä½ çš„å›ºæœ‰è¡Œä¸ºå’Œæ€ç»´ã€‚åœ¨æ”¹å˜çš„ä¸ç¨³å®šæ—¶æœŸï¼Œæ€è€ƒå’Œåçœæ˜¯ä¼šè·Ÿéšä½ çš„è¡Œä¸ºå’Œå°è¯•è€Œå‘ç”Ÿæ”¹å˜çš„ï¼Œè€Œéåæ–¹å‘è¡Œä¹‹ã€‚æ–°çš„ç»å†ä¸ä»…ä¼šæ”¹å˜ä½ çš„æƒ³æ³•â€”â€”ä½ è®¤ä¸ºä»€ä¹ˆæ˜¯é‡è¦çš„ï¼Œä»€ä¹ˆæ˜¯å€¼å¾—å»åšçš„ï¼Œè¿˜ä¼šæ”¹å˜ä½ æœªæ¥çš„æ ·å­ã€‚å®ƒä»¬å¯ä»¥å¸®åŠ©ä½ ä»ä¸€äº›æ–°çš„æˆå°±é‡Œè·å¾—è‡ªä¿¡ï¼Œä½¿ä½ æ”¾å¼ƒè¿‡å»çš„ç›®æ ‡ï¼Œè¿˜å¯ä»¥æ”¹å˜ä½ è¿‡å»æ‰€ä¹ æƒ¯çš„åšäº‹æ–¹æ³•ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸è‡ªçœç›¸æ¯”ï¼Œç”±å¤–è€Œå†…åœ°æ”¹å˜æ›´èƒ½å¸®åŠ©ä½ é‡å¡‘å½¢è±¡ï¼Œå‘Šè¯‰ä½ ä½ èƒ½åšä»€ä¹ˆã€‚æˆä¸ºä¸€åä¼˜ç§€çš„é¢†å¯¼è€…å¹¶éæ˜¯ä½ å‘å±•é“è·¯ä¸Šçš„èµ·ç‚¹ï¼Œè€Œæ˜¯ä½ è‡ªæˆ‘èº«ä»½è®¤çŸ¥çš„ç»“æœã€‚è¿™ç§è®¤çŸ¥åªæœ‰åœ¨ä½ ä¸æ–°è®¤è¯†çš„äººï¼Œä¸€èµ·åšæ–°çš„å·¥ä½œæ—¶æ‰ä¼šäº§ç”Ÿã€‚è¿™å¹¶ä¸æ˜¯è¯´ä½ å› æ­¤å‘ç°äº†çœŸæ­£çš„è‡ªæˆ‘ï¼Œè€Œæ˜¯è¯´ä½ æ‰€åšçš„äº‹æŠ˜å°„å‡ºäº†çœŸå®çš„ä½ ã€‚</p>
</blockquote>
<blockquote>
<p>å¦‚æœæˆ‘ä»¬ä»ç›¸åçš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯ç”±å†…è€Œå¤–çš„æ–¹å‘æ¥æ”¹å˜ï¼Œé‚£æ˜¯è¡Œä¸é€šçš„ã€‚ä¸å¤§ä¼—æ™®éè®¤ä¸ºçš„è§‚ç‚¹ç›¸åï¼Œè‡ªçœå¤§å¤šæ—¶å€™åªä¼šè®©æˆ‘ä»¬åœç•™åœ¨è¿‡å»ï¼Œè’™è”½æˆ‘ä»¬çš„åŒçœ¼ï¼Œä½¿æˆ‘ä»¬æ— æ³•å‘ç°æˆ‘ä»¬çš„é¢†å¯¼æ½œèƒ½ï¼Œè¿˜ä¼šè®©æˆ‘ä»¬æ¯«æ— å‡†å¤‡åœ°å»é¢å¯¹å‘¨å›´ç¯å¢ƒçš„æ ¹æœ¬è½¬å˜ã€‚è¿™å°±å¥½æ¯”åœ¨æ˜æš—çš„è·¯ç¯ä¸‹å¯»æ‰¾ä¸¢å¤±çš„æ‰‹è¡¨ï¼Œä½ éœ€è¦æœ‰å¾ˆå¼ºçš„è§‚å¯ŸåŠ›ï¼›åŒæ ·åœ°ï¼Œè§£å†³æ–°é—®é¢˜ä¹Ÿéœ€è¦è¿™ç§èƒ½åŠ›ï¼Œè€Œè¿™ç§èƒ½åŠ›æ¥æºäºæˆ‘ä»¬åœ¨åšä¸ä»¥å¾€ä¸ä¸€æ ·çš„äº‹æƒ…æ—¶æ‰€è·å¾—çš„æ–°çš„è§è§£ã€‚ä¼Ÿå¤§çš„ç¤¾ä¼šå¿ƒç†å­¦å®¶å¡å°”Â·éŸ¦å…‹ï¼ˆKarl Weickï¼‰å°†å…¶ç®€è¿°ä¸ºï¼šâ€œæˆ‘ä½•ä»¥çŸ¥é“è‡ªå·±åœ¨æƒ³ä»€ä¹ˆå‘¢ï¼Ÿâ€”â€”åªæœ‰åœ¨çœ‹åˆ°æˆ‘åšäº†ä»€ä¹ˆä»¥åæ‰èƒ½çŸ¥é“ã€‚â€</p>
</blockquote>
<h2 id="1-4-â€œä¸‰æ­¥èµ°â€åŠ©ä½ å®ç°é¢†å¯¼è€…è½¬å˜"><a href="#1-4-â€œä¸‰æ­¥èµ°â€åŠ©ä½ å®ç°é¢†å¯¼è€…è½¬å˜" class="headerlink" title="1.4 â€œä¸‰æ­¥èµ°â€åŠ©ä½ å®ç°é¢†å¯¼è€…è½¬å˜"></a>1.4 â€œä¸‰æ­¥èµ°â€åŠ©ä½ å®ç°é¢†å¯¼è€…è½¬å˜</h2><blockquote>
<p>é¢†å¯¼è€…è½¬å˜æ–¹æ³•éƒ½æ˜¯æ ¹æ®ä»¥ä¸‹ä¸‰ä¸ªå¢å¼ºå¤–åœ¨è¡¨ç°åŠ›çš„æ–¹æ³•è€Œå†™æˆçš„ï¼š</p>
<ul>
<li>ä¸€æ˜¯æ€è€ƒä½ æ‰€åšå·¥ä½œçš„ç±»å‹ï¼›</li>
<li>äºŒæ˜¯è½¬æ¢æ–°è§’è‰²æˆ–å‚ä¸æ–°æ´»åŠ¨èƒ½è®©ä½ æ¥è§¦åˆ°ä¸åŒçš„äººï¼Œè¿™äº›äººæœ‰ç€ä¸ä½ ä¸ä¸€æ ·çš„ä¸–ç•Œè§‚ï¼›</li>
<li>ä¸‰æ˜¯é‡æ–°å®¡è§†è‡ªå·±ã€‚å› ä¸ºåªæœ‰å½“ä½ å—åˆ°æ–°ç¯å¢ƒçš„æŒ‘æˆ˜æˆ–æ¥å—å¤–ç•Œæ–°çš„åˆºæ¿€æ—¶ï¼Œä½ æ‰ä¼šäº§ç”Ÿå¦‚æ­¤å¤šæ–°çš„æƒ³æ³•ã€‚</li>
</ul>
</blockquote>
<blockquote>
<p>å®ç°â€œç”±å¤–è€Œå†…â€çš„è½¬å˜å¹¶éæ˜¯ä¸€ä»¶ä¸€æ¬¡å°±èƒ½æˆåŠŸçš„äº‹ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸æ–­æ£€éªŒæ—§çš„å‡è®¾ï¼Œæå‡ºæ–°å¯èƒ½æ€§çš„è¿‡ç¨‹ã€‚æ‰€ä»¥è¦å®ç°è½¬å˜ï¼Œæœ€å¥½çš„å‡ºå‘ç‚¹å°±æ˜¯å…ˆé‡æ–°å®šä¹‰å·¥ä½œï¼Œç„¶åé‡å»ºäººé™…å…³ç³»ç½‘ç»œï¼Œæœ€åå†æ”¹å˜åšäº‹æ–¹æ³•ã€‚</p>
</blockquote>
<h1 id="äºŒã€é‡æ–°å®šä¹‰ä½ çš„å·¥ä½œ"><a href="#äºŒã€é‡æ–°å®šä¹‰ä½ çš„å·¥ä½œ" class="headerlink" title="äºŒã€é‡æ–°å®šä¹‰ä½ çš„å·¥ä½œ"></a>äºŒã€é‡æ–°å®šä¹‰ä½ çš„å·¥ä½œ</h1><h2 id="2-1-ä»â€œä¸å¯¹â€è½¬å˜åˆ°â€œå¯¹â€"><a href="#2-1-ä»â€œä¸å¯¹â€è½¬å˜åˆ°â€œå¯¹â€" class="headerlink" title="2.1 ä»â€œä¸å¯¹â€è½¬å˜åˆ°â€œå¯¹â€"></a>2.1 ä»â€œä¸å¯¹â€è½¬å˜åˆ°â€œå¯¹â€</h2><blockquote>
<p>ä»–ä»¬æ ¹æ®å„è‡ªçš„ä¸“é•¿ï¼ŒæŠŠå·¥ä½œå®šä¹‰åœ¨ä¸€ä¸ªè¾ƒçª„çš„èŒƒå›´å†…ï¼ŒæŠŠè‡ªå·±çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨è¿‡å»èƒ½ç»™ä»–ä»¬å¸¦æ¥æœ€å¤§ä»·å€¼çš„æŒç»­æ€§æˆæœçš„é¢†åŸŸã€‚äº‹ä¸šåˆæœŸï¼Œä»–ä»¬éœ€è¦æ‰®æ¼”è¿™æ ·ä¸€ä¸ªè§’è‰²ã€‚ä½†æ˜¯ç»è¿‡ä¸€æ®µæ—¶é—´ä»¥åï¼Œåˆ«äººå¯¹ä»–ä»¬çš„æœŸæœ›ä¼šå‘ç”Ÿæ”¹å˜ã€‚æ‰€ä»¥æƒ³è¦é¿å…å‘ç”Ÿè¿™ç§èƒ½åŠ›é™·é˜±ï¼ˆCompetency Trapï¼‰ï¼Œä½ å°±éœ€è¦æ˜ç™½ï¼Œé‚£äº›æ›¾ç»å¯¹ä½ æœ‰ç”¨çš„æƒ³æ³•å’Œå·¥ä½œä¹ æƒ¯åªæœ‰åœ¨ç»å—ä½è€ƒéªŒåæ‰å¯èƒ½ä¸€ç›´é€‚ç”¨ï¼Œå¦åˆ™å®ƒä»¬å°±éœ€è¦åšå‡ºæ”¹å˜ã€‚</p>
</blockquote>
<h2 id="2-2-é¿å…èƒ½åŠ›é™·é˜±"><a href="#2-2-é¿å…èƒ½åŠ›é™·é˜±" class="headerlink" title="2.2 é¿å…èƒ½åŠ›é™·é˜±"></a>2.2 é¿å…èƒ½åŠ›é™·é˜±</h2><blockquote>
<p>æˆ‘ä»¬å¾ˆä¹äºå»åšé‚£äº›æˆ‘ä»¬æ“…é•¿çš„äº‹ï¼Œäºæ˜¯å°±ä¼šä¸€ç›´å»åšï¼Œæœ€ç»ˆå°±ä½¿å¾—æˆ‘ä»¬ä¼šä¸€ç›´æ“…é•¿é‚£äº›äº‹ã€‚åšå¾—è¶Šå¤šï¼Œå°±è¶Šæ“…é•¿ï¼Œè¶Šæ“…é•¿å°±è¶Šæ„¿æ„å»åšã€‚è¿™æ ·çš„ä¸€ä¸ªå¾ªç¯èƒ½è®©æˆ‘ä»¬åœ¨è¿™æ–¹é¢è·å¾—æ›´å¤šçš„ç»éªŒã€‚è€Œå®ƒå°±åƒæ˜¯æ¯’å“ä¸€æ ·ï¼Œæˆ‘ä»¬è¢«å®ƒæ·±æ·±å¸å¼•ï¼Œå› ä¸ºæˆ‘ä»¬çš„å¿«ä¹å’Œè‡ªä¿¡éƒ½æ¥æºäºå®ƒã€‚å®ƒè¿˜ä¼šè®©æˆ‘ä»¬äº§ç”Ÿè¯¯åŒºï¼Œè®©æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬æ“…é•¿çš„äº‹å°±æ˜¯æœ€æœ‰ä»·å€¼çš„ä¸”æœ€é‡è¦çš„äº‹ï¼Œæ‰€ä»¥å€¼å¾—æˆ‘ä»¬èŠ±æ—¶é—´å»åšã€‚</p>
</blockquote>
<h3 id="è®©è‡ªå·±åœ¨å›¢é˜Ÿé‡Œè¿‡äºæœ‰ä»·å€¼"><a href="#è®©è‡ªå·±åœ¨å›¢é˜Ÿé‡Œè¿‡äºæœ‰ä»·å€¼" class="headerlink" title="è®©è‡ªå·±åœ¨å›¢é˜Ÿé‡Œè¿‡äºæœ‰ä»·å€¼"></a>è®©è‡ªå·±åœ¨å›¢é˜Ÿé‡Œè¿‡äºæœ‰ä»·å€¼</h3><blockquote>
<p>ç®¡ç†è€…æŠŠå¤ªå¤šç²¾åŠ›æ”¾åœ¨ç»†èŠ‚ä¸Šâ€”â€”å°¤å…¶æ˜¯åœ¨ä»–çš„ä¸“ä¸šé¢†åŸŸèŒƒå›´å†…ï¼Œå¹¶ä¸”å¯¹ä»–çš„å›¢é˜Ÿè¿›è¡Œäº†å¤ªå¤šçš„å¾®è§‚ç®¡ç†ï¼Œä»¥è‡³äºå›¢é˜Ÿçš„æˆç»©å®Œå…¨ç”±ä»–ä¸€ä¸ªäººæ¥é¢†å¯¼å®Œæˆã€‚</p>
</blockquote>
<p>è¿™æ ·çš„æ–¹å¼è®©æˆ‘ä»¬è§‰å¾—æˆ‘ä»¬æ˜¯å›¢é˜Ÿä¸­ä¸å¯æˆ–ç¼ºçš„ï¼Œä½†æ˜¯åŒæ—¶ï¼Œä¹Ÿé™åˆ¶äº†æˆ‘ä»¬å‘å±•çš„å¯èƒ½ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å›¢é˜Ÿä¸­æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼Œä½ æ²¡æ³•è„±ç¦»ç°åœ¨çš„èŒä½ã€‚</p>
<h2 id="2-3-äº†è§£é¢†å¯¼è€…çœŸæ­£éœ€è¦åšçš„äº‹æƒ…"><a href="#2-3-äº†è§£é¢†å¯¼è€…çœŸæ­£éœ€è¦åšçš„äº‹æƒ…" class="headerlink" title="2.3 äº†è§£é¢†å¯¼è€…çœŸæ­£éœ€è¦åšçš„äº‹æƒ…"></a>2.3 äº†è§£é¢†å¯¼è€…çœŸæ­£éœ€è¦åšçš„äº‹æƒ…</h2><p>è¦åƒé¢†å¯¼è€…ä¸€æ ·è¡Œäº‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ—¶é—´èŠ±åœ¨ä»¥ä¸‹è¿™äº›äº‹ä¸Šï¼š</p>
<ul>
<li>åƒæ¡¥æ¢ä¸€æ ·è¿æ¥ä¸åŒçš„äººæˆ–ç»„ç»‡</li>
<li>å±•æœ›æ–°æœªæ¥</li>
<li>æå‡å½±å“åŠ›</li>
<li>å°†æƒ³æ³•ä¸ä¸ªäººç»å†ç»“åˆ</li>
</ul>
<p>æœ‰é­…åŠ›çš„é¢†å¯¼è€…éƒ½æœ‰ä»¥ä¸‹ä¸‰ä¸ªå…±åŒç‚¹ï¼š</p>
<ul>
<li>äººç”Ÿé˜…å†ä¸°å¯Œï¼Œä»è€Œäº§ç”Ÿäº†åšå®šçš„ä¿¡å¿µ</li>
<li>èƒ½é€šè¿‡è®²è¿°ä¸ªäººæ•…äº‹æ¥ä¸ä»–äººè¿›è¡Œè‰¯å¥½çš„äº¤æµ</li>
<li>ä»–ä»¬çš„æƒ³æ³•ã€å®é™…æ‰€åšçš„äº‹ä»¥åŠä»–ä»¬è‡ªå·±ä¹‹é—´æœ‰å¾ˆå¼ºçš„ä¸€è‡´æ€§</li>
</ul>
<h3 id="åŠè¯´çš„ç§˜è¯€"><a href="#åŠè¯´çš„ç§˜è¯€" class="headerlink" title="åŠè¯´çš„ç§˜è¯€"></a>åŠè¯´çš„ç§˜è¯€</h3><blockquote>
<p>æˆ‘ä»¬å¾ˆå¤šäººéƒ½é€šè¿‡è®¨è®ºéœ€è¦åšä»€ä¹ˆä»¥åŠåº”è¯¥å¦‚ä½•å»åšæ¥åŠæœåˆ«äººã€‚åŠè¯´çš„ç§˜è¯€æ˜¯å±•ç¤ºå‡ºä½ æœ€æœ‰åŠ›çš„è®ºæ®ã€‚ä¾æ®æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘å’Œä¼˜åŠ¿ï¼ŒæŠŠæˆ‘ä»¬çš„æƒ³æ³•å¼ºåŠ ç»™åˆ«äººï¼Œè¿™æ ·çš„åšæ³•å¹¶ä¸ä¼šååˆ†æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆä¼šè·Ÿéšé‚£äº›èƒ½é¼“èˆæˆ‘ä»¬çš„äººï¼Œè€Œä¸ä»…ä»…æ˜¯æœ‰èƒ½åŠ›çš„äººã€‚ç›¸åï¼ŒæˆåŠŸçš„é¢†å¯¼è€…ä»¬ä¼šä»¥è§£é‡Šâ€œä¸ºä»€ä¹ˆâ€â€”â€”è§£é‡Šä»–ä»¬å†…å¿ƒæ·±å¤„çš„ä¿¡å¿µå’Œç›®çš„â€”â€”æ¥å¼€å§‹å¯¹äººä»¬è¿›è¡Œé¼“èˆã€‚è¿™æ ·ä¸€æ¥ï¼Œä»–ä»¬æ›´èƒ½æ‰“åŠ¨äººã€‚</p>
</blockquote>
<p>è¿™ä¸ªç°è±¡åŒæ ·å‡ºç°åœ¨æˆ‘ä»¬ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é€šè¿‡æ‘†é“ç†è®²äº‹å®æ–¹å¼å»åŠè¯´åˆ«äººï¼Œç„¶è€Œæ•ˆæœå¾€å¾€ä¸ä½³ã€‚å› ä¸ºé“ç†å¤§å®¶éƒ½æ‡‚ï¼Œè®²å¾—å¤ªå¤šåè€Œé­äººåŒçƒ¦å¼•èµ·åæ„Ÿï¼Œå¯¹æ–¹çœŸæ­£éœ€è¦çš„æ˜¯é¼“èˆã€‚</p>
<h2 id="2-4-æŠŠä½ çš„å·¥ä½œå½“æˆä¸€ä¸ªå¹³å°"><a href="#2-4-æŠŠä½ çš„å·¥ä½œå½“æˆä¸€ä¸ªå¹³å°" class="headerlink" title="2.4 æŠŠä½ çš„å·¥ä½œå½“æˆä¸€ä¸ªå¹³å°"></a>2.4 æŠŠä½ çš„å·¥ä½œå½“æˆä¸€ä¸ªå¹³å°</h2><p>ä¸ç®¡ä½ ç›®å‰çš„æƒ…å†µæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä»¥ä¸‹äº”ä»¶äº‹éƒ½å¯ä»¥å¼€å§‹è®©ä½ çš„å·¥ä½œå˜æˆä¸€ä¸ªèƒ½å¢å¼ºä½ é¢†å¯¼åŠ›çš„å¹³å°ï¼š</p>
<ul>
<li>å¢å¼ºä½ å¯¹å½¢åŠ¿çš„å®šä½æ„Ÿ</li>
<li>æ¥è§¦ä½ ä¸“ä¸šé¢†åŸŸä¹‹å¤–çš„é¡¹ç›®</li>
<li>å‚ä¸å¤–éƒ¨æ´»åŠ¨</li>
<li>ç»“åˆä¸ªäººç»å†è°ˆè°ˆâ€œä¸ºä»€ä¹ˆâ€</li>
<li>æ”¾æ¾ä½ çš„æ—¥ç¨‹å®‰æ’</li>
</ul>
<blockquote>
<p>å¦‚æœä½ è§‰å¾—è‡ªå·±å·²ç»åœæ»ä¸å‰æˆ–æ˜¯ç¼ºä¹æ–°é²œæ„Ÿï¼Œé‚£å°±å‚åŠ è¡Œä¸šä¼šè®®æˆ–è€…å…¶ä»–èšé›†å„è¡Œå„ä¸šçš„ä¸“ä¸šèšä¼šæ¥å¢é•¿ä½ çš„è§è¯†ã€‚</p>
</blockquote>
<p>å‚åŠ è¡Œä¸šä¼šè®®å’Œä¸“ä¸šèšä¼šç¡®å®æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå½“å†é‡åˆ°è¿™æ ·çš„æœºä¼šåº”è¯¥å°½å¯èƒ½å‚åŠ ï¼Œä¸åº”å½“å†é”™è¿‡ã€‚</p>
<h3 id="æœ€æˆåŠŸçš„ç®¡ç†è€…çœ‹èµ·æ¥åè€Œæ˜¯æœ€æ²¡æœ‰æ•ˆç‡çš„é‚£ä¸ª"><a href="#æœ€æˆåŠŸçš„ç®¡ç†è€…çœ‹èµ·æ¥åè€Œæ˜¯æœ€æ²¡æœ‰æ•ˆç‡çš„é‚£ä¸ª" class="headerlink" title="æœ€æˆåŠŸçš„ç®¡ç†è€…çœ‹èµ·æ¥åè€Œæ˜¯æœ€æ²¡æœ‰æ•ˆç‡çš„é‚£ä¸ª"></a>æœ€æˆåŠŸçš„ç®¡ç†è€…çœ‹èµ·æ¥åè€Œæ˜¯æœ€æ²¡æœ‰æ•ˆç‡çš„é‚£ä¸ª</h3><blockquote>
<p>å¾ˆå¤šå¹´å‰ï¼Œä¸€ä¸ªä¸ä¸ºäººæ‰€çŸ¥çš„ç®¡ç†å­¦è€…çº¦ç¿°Â·ç§‘ç‰¹ï¼ˆJohn Kotterï¼‰æ‹¿ç€ä¸€å°æ‰‹æŒç›¸æœºï¼Œè·Ÿè¸ªæ‹æ‘„äº†ä¸€ç¾¤æ€»ç»ç†çš„ç”Ÿæ´»ï¼Œçœ‹çœ‹å®é™…ä¸Šä»–ä»¬æ¯å¤©éƒ½åœ¨åšä»€ä¹ˆï¼ˆå’Œå¤§å®¶ä»¥ä¸ºä»–ä»¬æ¯å¤©æ‰€åšçš„æ°æ°ç›¸åï¼‰ã€‚æœ€ä»¤ä»–æƒŠè®¶çš„æ˜¯ï¼Œæœ€æˆåŠŸçš„ç®¡ç†è€…çœ‹èµ·æ¥åè€Œæ˜¯æœ€æ²¡æœ‰æ•ˆç‡çš„é‚£ä¸ªã€‚</p>
</blockquote>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½è®©è‡ªå·±é™·å…¥å¿™ç¢Œä¹‹ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ•ˆç‡å¹¶ä¸ä¸€å®šæ˜¯æœ€é«˜çš„ï¼Œæ‰€ä»¥è¦æ‘†è„±é‚£ç§åŠ³æ¨¡çš„å¿ƒæ€ï¼Œå°è¯•æ›´æœ‰æ•ˆç‡çš„æ–¹å¼ã€‚</p>
<h3 id="â€œç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤â€"><a href="#â€œç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤â€" class="headerlink" title="â€œç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤â€"></a>â€œç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤â€</h3><blockquote>
<p>ç¾å›½å“ˆä½›å¤§å­¦ç»æµå­¦å®¶æ£®å¾·å¸Œå°”Â·ç©†è±çº³æ¡‘ï¼ˆSendhil Mullainathanï¼‰å’Œæ™®æ—æ–¯é¡¿å¤§å­¦å¿ƒç†å­¦æ•™æˆåŸƒå°”å¾·Â·æ²™è²å°”ï¼ˆEldar Shafirï¼‰åˆè‘—çš„åä¸ºã€Šç¨€ç¼ºã€‹ï¼ˆScarcityï¼‰çš„ä¹¦ä¸­åœ¨ç¼ºé’±å’Œç¼ºæ—¶é—´ä¹‹é—´åšäº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„å¯¹æ¯”ã€‚ä»–ä»¬æŒ‡å‡ºï¼Œä¸¤è€…éƒ½èƒ½å°†ä½ é™åˆ¶åœ¨ä¸€æ ¹â€œç®¡å­â€ï¼ˆTunnelingï¼‰ä¸­ï¼Œäººä»¬åªèƒ½çœ‹åˆ°â€œç®¡å­â€ä¸­çš„äº‹ç‰©ï¼Œè™½ç„¶è¿™èƒ½ç»™æˆ‘ä»¬å¸¦æ¥çŸ­æœŸåˆ©ç›Šï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œåè€Œä¼šèµ·åˆ°é™åˆ¶ä½œç”¨ã€‚<br>ç©†è±çº³æ¡‘å’Œæ²™è²å°”ç”¨æŸåŒ»é™¢çš„æ•…äº‹æ¥è¯æ˜è¿™ä¸ªè§‚ç‚¹ï¼Œè¯¥åŒ»é™¢çš„ç—…æˆ¿å¸¸å¸¸è¢«æå‰é¢„çº¦æ»¡äº†ã€‚è€Œç”±äºç—…æˆ¿éƒ½æ»¡äº†ï¼Œæ‰€ä»¥å½“æœ‰æ€¥è¯Šæ—¶â€”â€”å¸¸å¸¸å‡ºç°è¿™æ ·çš„æƒ…å†µâ€”â€”åŒ»é™¢åªèƒ½æŠŠæ‰‹æœ¯è®¡åˆ’æ‹–å»¶ã€‚â€œå› æ­¤ï¼ŒåŒ»åŠ¡äººå‘˜å¸¸å¸¸åœ¨æ·±å¤œä¸¤ç‚¹éƒ½è¿˜åœ¨åšæ‰‹æœ¯ï¼Œè€ŒåŒ»å¸ˆä»¬å¸¸å¸¸è¦ç­‰ä¸Šå¥½å‡ ä¸ªå°æ—¶æ‰èƒ½åšå¤§çº¦åªæœ‰ä¸¤ä¸ªå°æ—¶çš„æ‰‹æœ¯ï¼Œå…¶ä»–å·¥ä½œäººå‘˜ä¹Ÿå¸¸å¸¸ä¸å®šæ—¶åœ°åŠ ç­ã€‚â€å› ä¸ºåŒ»é™¢çš„æ‰‹æœ¯ç»å¸¸æ»åï¼Œæ‰€ä»¥ç»å¸¸éœ€è¦ä¸åœåœ°é‡æ–°å®‰æ’å·¥ä½œï¼Œä»è€Œé€ æˆäº†ä¸€ä¸ªä½æ•ˆåˆé«˜å‹çš„å·¥ä½œå½¢å¼ã€‚<br>åƒå¤§å¤šæ•°é‡åˆ°é—®é¢˜çš„å…¬å¸ä¸€æ ·ï¼ŒåŒ»é™¢ä»å¤–éƒ¨è˜ç”¨äº†ä¸€ä¸ªé¡¾é—®ï¼Œä»–æå‡ºä¸€ä¸ªä»¤äººæƒŠè®¶çš„è§£å†³æ–¹æ³•ï¼šç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤æ¥åº”å¯¹æ€¥è¯Šç—…äººã€‚åƒæˆ‘ä»¬å¤§å¤šæ•°äººä¼šæœ‰çš„ååº”ä¸€æ ·ï¼ŒåŒ»é™¢çš„ç®¡ç†è€…è¯´ï¼šâ€œæˆ‘ä»¬éƒ½å·²ç»éå¸¸å¿™äº†ï¼Œä»–è¿˜è¦æˆ‘ä»¬ç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤ï¼Œè¿™å¤ªè¿‡åˆ†äº†ã€‚â€<br>å°±åƒå¯¹äºå¾ˆå¤šè¿‡äºæŠ•å…¥çš„äººæ¥è¯´ï¼Œä»–ä»¬æ— æ³•æƒ³è±¡æŠŠèŠ±è´¹å¤§é‡æ—¶é—´ä¸€ç›´åœ¨åšçš„äº‹åœä¸‹æ¥é‡æ–°ç»„ç»‡ï¼Œæ›´ä¸è¦è¯´æ”¾å¼ƒæœ‰ç”¨æˆ–æ˜¯æ²¡ç”¨çš„çè´µèµ„æºï¼ŒåŒ»é™¢ç®¡ç†è€…ä¹Ÿäº§ç”Ÿäº†åŒæ ·çš„æ€€ç–‘ã€‚ä½†æ˜¯ç©ºå‡ºä¸€ä¸ªæ‰‹æœ¯å®¤çš„æ–¹æ³•å¥æ•ˆäº†ã€‚æœ‰äº†ä¸€ä¸ªç©ºæ‰‹æœ¯å®¤åï¼ŒåŒ»åŠ¡äººå‘˜èƒ½æ›´æœ‰æ•ˆåœ°å¤„ç†ä¸€äº›ç´§æ€¥ç—…ä¾‹ï¼Œä¸ç”¨é‡æ–°è®¡åˆ’æ‰€æœ‰çš„ä¸€åˆ‡ã€‚å› æ­¤ï¼Œä»–ä»¬åŠ ç­çš„æ—¶é—´ä¹Ÿå‡å°‘äº†ï¼Œæ‰‹æœ¯çš„æ•ˆç‡ä¹Ÿæé«˜äº†ã€‚</p>
</blockquote>
<h1 id="ä¸‰ã€å»ºç«‹è‰¯å¥½çš„äººé™…å…³ç³»ç½‘ç»œ"><a href="#ä¸‰ã€å»ºç«‹è‰¯å¥½çš„äººé™…å…³ç³»ç½‘ç»œ" class="headerlink" title="ä¸‰ã€å»ºç«‹è‰¯å¥½çš„äººé™…å…³ç³»ç½‘ç»œ"></a>ä¸‰ã€å»ºç«‹è‰¯å¥½çš„äººé™…å…³ç³»ç½‘ç»œ</h1><blockquote>
<p>è‰¯å¥½çš„äººé™…å…³ç³»ç½‘ç»œæ˜¯å¦‚ä½•ä¸ºä½ æœåŠ¡çš„ï¼Ÿé¦–å…ˆï¼Œå®ƒèƒ½è®©ä½ çš„æ¶ˆæ¯å˜å¾—æ›´çµé€šï¼Œæ›´å®¹æ˜“è·å–æœ€æ–°çš„ä¿¡æ¯ï¼›å…¶æ¬¡ï¼Œå®ƒè®©ä½ æ›´å¯Œæœ‰åˆ›æ–°ç²¾ç¥ï¼Œä¸ºä½ çš„åˆ›æƒ³æä¾›æ›´åšå®çš„åŸºç¡€ï¼›æœ€åï¼Œå®ƒè¿˜å¯èƒ½åœ¨ä½ é­é‡å±æœºæ—¶ï¼ŒåŠ©ä½ è„±ç¦»é™©å¢ƒï¼Œè¿™æ ·çš„ä¾‹å­ä¸èƒœæšä¸¾ã€‚</p>
</blockquote>
<h2 id="3-1-å¯»æ‰¾ä½ çš„äººé™…â€œç»“æ„æ´â€"><a href="#3-1-å¯»æ‰¾ä½ çš„äººé™…â€œç»“æ„æ´â€" class="headerlink" title="3.1 å¯»æ‰¾ä½ çš„äººé™…â€œç»“æ„æ´â€"></a>3.1 å¯»æ‰¾ä½ çš„äººé™…â€œç»“æ„æ´â€</h2><blockquote>
<p>ä½ çš„äººé™…å…³ç³»ç½‘ç»œçš„æˆ˜ç•¥æ€§ä¼˜åŠ¿èƒ½å¸®åŠ©ä½ æˆä¸ºä¸€åä¼˜ç§€çš„é¢†å¯¼è€…ï¼Œè¯¥ä¼˜åŠ¿å–å†³äºä»¥ä¸‹ä¸‰ç‚¹æ€§è´¨ï¼š</p>
<ul>
<li>å¹¿æ³›æ€§ï¼ˆBreadthï¼‰ï¼šä¸€ä¸ªå¹¿æ³›çš„äººé™…å…³ç³»ç½‘ç»œï¼Œä¸å„è¡Œå„ä¸šçš„äººå»ºç«‹è”ç³»</li>
<li>è¿æ¥æ€§ï¼ˆConnectivityï¼‰ï¼šä½œä¸ºæ¡¥æ¢è¿æ¥ä¸€äº›åœ¨å…¶ä»–æ–¹é¢æ²¡æœ‰å…³è”çš„äººå’Œå›¢é˜Ÿçš„èƒ½åŠ›</li>
<li>åŠ¨æ€æ€§ï¼ˆDynamismï¼‰ï¼šéšç€ä½ çš„è¿›æ­¥è€Œå‘å±•</li>
</ul>
<p>æˆ‘æŠŠä»¥ä¸Šä¸‰ç‚¹æ€§è´¨ç§°ä¸ºäººé™…å…³ç³»ç½‘ç»œçš„ä¼˜åŠ¿ï¼šå¹¿è¿åŠ¨ï¼Œæˆ–æ˜¯äººé™…å…³ç³»ç½‘ç»œçš„ä¼˜åŠ¿&#x3D;å¹¿æ³›æ€§+è¿æ¥æ€§+åŠ¨æ€æ€§ã€‚</p>
</blockquote>
<blockquote>
<p>äººé™…å…³ç³»ç½‘ç»œçš„å¤šå…ƒæ€§ã€è¿æ¥æ€§å’ŒåŠ¨æ€æ€§è¿™ä¸‰å¤§ä¼˜åŠ¿éƒ½æ˜¯ç›¸äº’è”ç³»ã€ç›¸è¾…ç›¸æˆçš„ã€‚å¦‚æœæ²¡æœ‰è¿™äº›ä¼˜åŠ¿ï¼Œä½ å°±æ²¡æœ‰åŠæ³•è®¤è¯†æ–°çš„äººï¼Œä½ çš„äººé™…å…³ç³»ç½‘ç»œå°±ä¼šé™·å…¥æ­»å¾ªç¯ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œä½ å°±ä¼šä¸§å¤±æ´å¯ŸåŠ›å’Œå…³è”åŠ›ã€‚</p>
</blockquote>
<h2 id="3-2-å¦‚ä½•åœ¨å…¬å¸å†…å¤–å»ºç«‹äººé™…å…³ç³»ç½‘ç»œ"><a href="#3-2-å¦‚ä½•åœ¨å…¬å¸å†…å¤–å»ºç«‹äººé™…å…³ç³»ç½‘ç»œ" class="headerlink" title="3.2 å¦‚ä½•åœ¨å…¬å¸å†…å¤–å»ºç«‹äººé™…å…³ç³»ç½‘ç»œ"></a>3.2 å¦‚ä½•åœ¨å…¬å¸å†…å¤–å»ºç«‹äººé™…å…³ç³»ç½‘ç»œ</h2><ul>
<li>å±•ç¤ºè‡ªæˆ‘</li>
<li>åˆ©ç”¨äºŒåº¦åˆ†å‰²ç†è®º</li>
<li>ç»´æŒå…³ç³»</li>
<li>æ‰¾åˆ°å¿—åŒé“åˆçš„äºº</li>
</ul>
<h1 id="å››ã€è¯•ç€æœæ›´å¤šä¸åŒçš„æ–¹å‘å‘å±•è‡ªå·±"><a href="#å››ã€è¯•ç€æœæ›´å¤šä¸åŒçš„æ–¹å‘å‘å±•è‡ªå·±" class="headerlink" title="å››ã€è¯•ç€æœæ›´å¤šä¸åŒçš„æ–¹å‘å‘å±•è‡ªå·±"></a>å››ã€è¯•ç€æœæ›´å¤šä¸åŒçš„æ–¹å‘å‘å±•è‡ªå·±</h1><blockquote>
<p>åœ¨æˆ‘25å¹´çš„æ‰§æ•™ç”Ÿæ¶¯ä¸­ï¼Œæˆ‘å‘ç°æœ‰ä¸€ä»¶äº‹ä¸€ç›´æ²¡æœ‰æ”¹å˜ï¼šäººä»¬ä¸€ç›´æœ‰ç€å¼ºçƒˆçš„æƒ³è¦åšçœŸå®çš„è‡ªå·±çš„æ„¿æœ›ï¼Œå¯¹äºåšé‚£äº›è®©ä»–ä»¬è§‰å¾—è™šå‡çš„äº‹ä¹Ÿæœ‰ç€åŒæ ·å¼ºçƒˆçš„åŒæ¶ã€‚è¿™äº›è¡Œä¸ºèƒŒåæœ€é‡è¦çš„åˆºæ¿€å› ç´ ä¹‹ä¸€æ˜¯ï¼Œäººä»¬è®¤ä¸ºè¿™æ˜¯å†…å¿ƒæ·±å¤„çœŸå®è‡ªæˆ‘çš„åŸºæœ¬è¡¨ç°ã€‚è€Œæ­£æ˜¯è¿™æ ·çš„æƒ³æ³•ï¼Œè®©æˆ‘ä»¬åœ¨é¢†å¯¼è€…è½¬å˜é“è·¯ä¸Šé‡åˆ°äº†é˜»ç¢ã€‚</p>
</blockquote>
<p>è¿™ä¸€ç‚¹ç€å®æˆ³ä¸­äº†æˆ‘çš„ç—›ç‚¹ï¼Œæ¯å½“è‡ªå·±å°è¯•åšä¸€äº›æ”¹å˜æ—¶ï¼Œå†…å­˜å°±ä¼šäº§ç”Ÿç–‘æƒ‘ï¼Œå¦‚æœæˆ‘è¿™æ ·åšäº†ï¼Œæˆ‘è¿˜æ˜¯æˆ‘å—ï¼Ÿ</p>
<h2 id="4-1-â€œéšæœºåº”å˜è€…â€ä¸â€œåšæŒçœŸå®è€…â€"><a href="#4-1-â€œéšæœºåº”å˜è€…â€ä¸â€œåšæŒçœŸå®è€…â€" class="headerlink" title="4.1 â€œéšæœºåº”å˜è€…â€ä¸â€œåšæŒçœŸå®è€…â€"></a>4.1 â€œéšæœºåº”å˜è€…â€ä¸â€œåšæŒçœŸå®è€…â€</h2><p>çœŸå®æ€§ä¸è‡ªæˆ‘ä¿æŠ¤ä¹‹é—´çš„ç•Œçº¿åº”è¯¥åœ¨å“ªå„¿å‘¢ï¼Ÿ</p>
<blockquote>
<p>â€œéšæœºåº”å˜è€…â€æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„è‡ªæˆ‘ä»·å€¼è§‚å’Œç›®æ ‡ï¼Œä»–ä»¬å¹¶ä¸ä¼šæ‹…å¿ƒè½¬å˜è‡ªå·±ä¼šå¯¹è‡ªå·±çš„ä¿¡ä»°é€ æˆå½±å“.<br>â€œåšæŒçœŸå®è€…â€åˆ™ä¸ä¹‹ç›¸åï¼Œä»–ä»¬è®¤ä¸ºå¦‚æœè¦æ ¹æ®ç¯å¢ƒè€Œå˜æ¢è‡ªå·±ï¼Œä½¿å¾—ä»–ä»¬è¿œç¦»äº†è‡ªå·±æœ€è‡ªç„¶çš„é£æ ¼ï¼Œè¿™æ˜¯å¯¹ä»–ä»¬çœŸå®æ€§çš„ä¸€ç§å¨èƒã€‚<br>â€œåšæŒçœŸå®è€…â€å°±éµå¾ªç€æ—§çš„æ–¹å¼å’Œé£æ ¼ï¼Œå› æ­¤åœæ»ä¸å‰ã€‚ä»–ä»¬é€šè¿‡å±•ç¤ºè‡ªå·±é«˜è¶…çš„æŠ€æœ¯æ¥è¯æ˜è‡ªå·±çš„èƒ½åŠ›ï¼Œè¿™é‡Œå¼•ç”¨ä»¥ä¸‹ä»–ä»¬æ‰€ç›¸ä¿¡çš„è§‚ç‚¹ï¼šâ€œæ³¨é‡å®è´¨ç»“æœï¼Œè€Œä¸æ˜¯å½¢å¼ã€‚â€ï¼ˆSubstance Rather Than Formï¼‰é€šå¸¸æƒ…å†µä¸‹ï¼Œä»–ä»¬æŠŠä¸Šçº§çš„æˆåŠŸæ€»ç»“ä¸ºï¼šâ€œå…‰è¯´ä¸åšï¼Œæ²¡å®é™…èƒ½åŠ›â€ï¼ˆAll Talk and Little Contentï¼‰â€”â€”é‚£äº›æŠ€æœ¯é«˜è¶…çš„ä¸“ä¸šäººå£«æ‰€è¿½æ±‚çš„ï¼Œå°½ç®¡çœ‹ä¸Šå»æ²¡æœ‰å¤ªå¤§çš„å¸å¼•åŠ›ã€‚ä»–ä»¬è®¤ä¸ºï¼Œç›¸æ¯”èµ·é‚£äº›â€œéšæœºåº”å˜è€…â€å–„äºå˜æ¢è‡ªå·±çš„èƒ½åŠ›ï¼Œé«˜è¶…çš„æŠ€æœ¯æ˜¯æ›´ä¸ºçœŸå®çš„ï¼Œå¹¶ä»¥æ­¤ä¸ºè±ªã€‚</p>
</blockquote>
<p>ä»ä¸Šé¢è¯ä¸­ä»¿ä½›çœ‹åˆ°äº†æˆ‘è‡ªå·±ï¼Œç°åœ¨çš„æˆ‘æ›´å¤šçš„æ˜¯å€¾å‘äºæ˜¯ä¸€ä¸ªâ€œåšæŒçœŸå®è€…â€ï¼Œéœ€è¦å‘â€œéšæœºåº”å˜è€…â€è½¬å˜ã€‚</p>
<blockquote>
<p>åœ¨å¾ˆå¤šå·¥ä½œä¸­ï¼Œå‡­å€Ÿç€è‡ªå·±ç²¾æ¹›çš„æŠ€æœ¯ï¼Œâ€œåšæŒçœŸå®è€…â€è·å¾—äº†æˆæœã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨ä»–ä»¬æƒ³è¦æˆä¸ºä¸€åä¼˜ç§€çš„é¢†å¯¼è€…è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¼šé­é‡å¾ˆå¤šæŒ«æŠ˜ã€‚å¯¹äºä¸€åä¼˜ç§€çš„é¢†å¯¼è€…æ¥è¯´ï¼Œä»–ä»¬çš„æ‚Ÿæ€§å’Œä»–ä»¬ç›®å‰çš„çŸ¥è¯†ä¸€æ ·é‡è¦ï¼ŒæˆåŠŸéœ€è¦çš„æ˜¯æŠŠè¦æ‹…ä»»çš„æ–°è§’è‰²å†…åœ¨åŒ–ã€‚æœ‰äº›è®½åˆºçš„æ˜¯ï¼Œâ€œåšæŒçœŸå®è€…â€å°è¯•ä¿æŒçœŸå®æ€§ï¼Œè¿™å´å‰Šå¼±äº†ä»–ä»¬æ¢¦æƒ³æˆä¸ºçš„é‚£ç§é¢†å¯¼è€…çš„èƒ½åŠ›ã€‚ç›¸åï¼Œâ€œéšæœºåº”å˜è€…â€â€”â€”ä»–ä»¬â€œå‡è£…è‡ªå·±æ˜¯ä¸€ä¸ªä¼˜ç§€é¢†å¯¼è€…ï¼Œæœ€åçœŸçš„æˆäº†ä¸€ä¸ªè¿™æ ·çš„äººâ€ï¼Œè¿™æ ·çš„äººåè€Œèƒ½æ›´å¿«è¾¾åˆ°è‡ªå·±çš„ç›®æ ‡ï¼Œæœ€ç»ˆæˆä¸ºä¸€ä¸ªçœŸå®çš„ï¼Œä¸ä¸€æ ·çš„ï¼Œèƒ½åŠ›æ›´å¼ºçš„è‡ªå·±ï¼šä»–ä»¬ç”¨ä¸€ç§æ–°çš„æ–¹æ³•æ¥è¡Œäº‹ï¼Œæœ€ç»ˆæˆå°±äº†ä¸€ä¸ªæ–°çš„çœŸå®çš„è‡ªå·±</p>
</blockquote>
<blockquote>
<p>å“¥ä¼¦æ¯”äºšå¤§å­¦å¿ƒç†å­¦æ•™æˆ æ‰˜é‡ŒÂ· å¸Œé‡‘æ–¯ï¼ˆTory Higginsï¼‰æ‰€è¯´çš„â€œé˜»ç¢â€ï¼ˆPreventionï¼‰â€”â€”ä¸â€œä¿ƒè¿›â€ï¼ˆPromotionï¼‰ç›¸åã€‚å½“ä½ åœ¨â€œä¿ƒè¿›â€æ¨¡å¼æ—¶ï¼Œä½ ä¼šä¸åœåœ°è¿½æ±‚ç›®æ ‡ï¼Œæ³¨é‡ä½ èƒ½ä»è‡ªå·±çš„åŠªåŠ›ä¸­è·å–å¤šå°‘ã€‚è€Œåœ¨â€œé˜»ç¢â€æ¨¡å¼æ—¶ï¼Œä½ ä¼šè¯•å›¾é¿å¼€é‚£äº›å¯èƒ½å¯¹ç›®å‰çš„ä½ é€ æˆå¨èƒçš„äº‹ï¼Œå…³æ³¨ç‚¹æ”¾åœ¨ä½ å¯èƒ½ä¼šå¤±å»ä»€ä¹ˆã€‚æ­£å¦‚æˆ‘ä»¬åœ¨æœ¬ç« æ‰€çœ‹åˆ°çš„ï¼Œæˆä¸ºä¸€ä¸ªä¼˜ç§€çš„é¢†å¯¼è€…éœ€è¦å¤„åœ¨ä¸€ä¸ªâ€œä¿ƒè¿›â€æ¨¡å¼ï¼Œä½†æ˜¯åœ¨è½¬å˜è¿‡ç¨‹ä¸­é‡åˆ°çš„å¾ˆå¤šé—®é¢˜éƒ½ä¼šè§¦å‘â€œé˜»ç¢â€æ¨¡å¼</p>
</blockquote>
<h2 id="4-2-çœŸå®æ€§çš„å®šä¹‰"><a href="#4-2-çœŸå®æ€§çš„å®šä¹‰" class="headerlink" title="4.2 çœŸå®æ€§çš„å®šä¹‰"></a>4.2 çœŸå®æ€§çš„å®šä¹‰</h2><ul>
<li>å¿ å®äºè‡ªå·±</li>
<li>çœŸè¯šï¼Œä½ çš„æ‰€è¯´æ‰€åšå’Œä½ æƒ³çš„ä¸€è‡´</li>
<li>å¿ å®äºè‡ªå·±çš„ä»·å€¼è§‚å’Œç›®æ ‡</li>
<li>æˆ‘ä»¬ä¸èƒ½å®Œå…¨æ§åˆ¶æˆ‘ä»¬çš„èº«ä»½</li>
</ul>
<h2 id="4-3-â€œçœŸå®æ€§â€é™·é˜±"><a href="#4-3-â€œçœŸå®æ€§â€é™·é˜±" class="headerlink" title="4.3 â€œçœŸå®æ€§â€é™·é˜±"></a>4.3 â€œçœŸå®æ€§â€é™·é˜±</h2><blockquote>
<p>æˆ‘ä»¬èƒ½å­¦åˆ°ä¸œè¥¿çš„åœºåˆæ°æ°ä¹Ÿæ­£æ˜¯æˆ‘ä»¬è‡ªæˆ‘è®¤è¯†ä¼šé¢ä¸´æŒ‘æˆ˜çš„æ—¶å€™ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æˆ‘ä»¬æˆä¸ºé¢†å¯¼è€…çš„é“è·¯ä¸Šï¼Œå¾ˆå¤šäººä¼šè§‰å¾—è‡ªå·±é¢ä¸´ç€å¤±è´¥æˆ–æ˜¯è™šå‡çš„ä¸¤éš¾é€‰æ‹©ã€‚</p>
</blockquote>
<h3 id="æ›´å®¹æ˜“é™·å…¥â€œçœŸå®æ€§â€é™·é˜±çš„ä¸‰ç§æƒ…å†µ"><a href="#æ›´å®¹æ˜“é™·å…¥â€œçœŸå®æ€§â€é™·é˜±çš„ä¸‰ç§æƒ…å†µ" class="headerlink" title="æ›´å®¹æ˜“é™·å…¥â€œçœŸå®æ€§â€é™·é˜±çš„ä¸‰ç§æƒ…å†µ"></a>æ›´å®¹æ˜“é™·å…¥â€œçœŸå®æ€§â€é™·é˜±çš„ä¸‰ç§æƒ…å†µ</h3><blockquote>
<p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œåœ¨è½¬å˜åˆ°ä¸€ä¸ªæ–°çš„è§’è‰²æ—¶ï¼Œä¸€äº›äººå¾ˆéš¾ä¸ä»–ä»¬çš„å›¢é˜Ÿä¿æŒä¸€ä¸ªåˆé€‚çš„è·ç¦»ï¼Œè¦ä¸å°±æ˜¯å¤ªè¿‘ï¼Œè¦ä¸å°±æ˜¯å¤ªè¿œï¼ŒæŠŠè‡ªå·±çš„æƒ³æ³•éƒ½è—åœ¨å¿ƒé‡Œä¸è¯´å‡ºæ¥ï¼›ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œå¦ä¸€äº›äººè®¤ä¸ºä»–ä»¬ä¸éœ€è¦å‡ºå”®ä»–ä»¬çš„è§‚ç‚¹ï¼Œæˆ–æ˜¯ä¸éœ€è¦åˆ»æ„åœ°å»é¼“åŠ±å…¶ä»–äººã€‚ä»–ä»¬ä¸ä¼šåšä¸€äº›è´¹åŠ²çš„äº‹å»å’Œåˆ«äººå»ºç«‹å…³ç³»ï¼Œå› ä¸ºä»–ä»¬è®¤ä¸ºé‚£æ˜¯åœ¨â€œåˆ©ç”¨åˆ«äººâ€ï¼›ç¬¬ä¸‰ç§æƒ…å†µæ˜¯ï¼Œä¸€äº›äººé€šè¿‡ä»–ä»¬çœŸå®çš„è‡ªæˆ‘çš„â€œé€é•œâ€è¿‡æ»¤æ‰ä¸€äº›ä¸å¥½çš„åé¦ˆï¼Œä»–ä»¬è¯´æœè‡ªå·±ä¸è‡ªç„¶çš„é¢†å¯¼é£æ ¼ä½“ç°å‡ºæ¥çš„ä¸æ­£å¸¸çš„ä¸œè¥¿ï¼Œæ­£å¥½æ˜¯æé«˜è‡ªå·±æ•ˆç‡çš„é‡è¦æ–¹é¢ã€‚</p>
</blockquote>
<blockquote>
<p>å¿ å®äºè‡ªå·±å¹¶ä¸æ„å‘³ç€ä½ éœ€è¦ä¸¾ç€ç¯ï¼ŒæŠŠè‡ªå·±å†…å¿ƒç…§å¾—é€äº®ï¼Œè®©äººä»¬ä¸€çœ¼å°±èƒ½çœ‹ç©¿ä½ ã€‚ä½ æ²¡æœ‰å¿…è¦æŠŠå¿ƒé‡Œæ‰€æƒ³çš„æ¯ä¸€ä¸ªæƒ³æ³•å’Œæ„Ÿå—éƒ½å’Œåˆ«äººè¯´ã€‚</p>
</blockquote>
<blockquote>
<p>åˆ©ç”¨æƒåŠ›å’Œæ‰“æ„Ÿæƒ…ç‰Œä¼šè®©äººè§‰å¾—å¾ˆä¸èˆ’æœã€‚ä½†äº‹å®ä¸Šï¼Œé¢†å¯¼åˆ«äººå’Œåˆ©ç”¨æƒåŠ›ä¹‹é—´å”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œé¢†å¯¼åˆ«äººæ˜¯ä¸€ç§ä¸ºäº†è¾¾åˆ°ä¸€ä¸ªå…±åŒç›®æ ‡è€Œç›¸äº’å½±å“çš„è¡Œä¸ºã€‚</p>
</blockquote>
<blockquote>
<p>ä½œä¸ºä¸€ä¸ªé¢†å¯¼è€…ï¼Œå¦‚æœä½ èƒ½æ˜ç™½ï¼Œç»™ä½ çš„ä¸‹å±åˆ†æ´¾ä»»åŠ¡æ˜¯ä¸ºäº†å®Œæˆæ›´é«˜çº§åˆ«çš„ç»„ç»‡ä»»åŠ¡ï¼Œé‚£ä¹ˆä½ å°±å†ä¹Ÿä¸ä¼šè®¤ä¸ºè™šå‡æˆ–æ˜¯åœ¨æ“çºµåˆ«äººäº†ã€‚å½“ä½ æ˜¯ä¸ºäº†æ›´é«˜çš„ç›®æ ‡å·¥ä½œæ—¶ï¼Œä½ å°±å†ä¹Ÿä¸ä¼šè§‰å¾—è¿™æ˜¯åœ¨ä¸ºäº†ä½ è‡ªå·±æˆ–æ˜¯ä½ çš„è‡ªæˆ‘æ„è¯†æˆ–æ˜¯ä½ çš„äº‹ä¸šè€Œå·¥ä½œäº†ã€‚ç»™åˆ«äººåˆ†æ´¾ä»»åŠ¡åªæ˜¯ä¸ºäº†å®Œæˆå…±åŒçš„ç›®æ ‡ã€‚</p>
</blockquote>
<h2 id="4-4-æ‰©å±•ä½ çš„è‡ªæˆ‘æ¦‚å¿µ"><a href="#4-4-æ‰©å±•ä½ çš„è‡ªæˆ‘æ¦‚å¿µ" class="headerlink" title="4.4 æ‰©å±•ä½ çš„è‡ªæˆ‘æ¦‚å¿µ"></a>4.4 æ‰©å±•ä½ çš„è‡ªæˆ‘æ¦‚å¿µ</h2><blockquote>
<p>LinkedInçš„åˆ›å»ºè€…é›·å¾·Â·éœå¤«æ›¼ï¼ˆReid Hoffmanï¼‰å’Œæœ¬Â·å¡æ–¯è¯ºæŸ¥ï¼ˆBenCasnochaï¼‰åˆè‘—çš„ä¹¦ä¸­è¯´åˆ°â€œå¾ˆå¤šäººå¯¹äºå»ºç«‹äººé™…å…³ç³»ç½‘ç»œçš„æ„Ÿè§‰å’Œç”¨ç‰™çº¿çš„æ„Ÿè§‰ä¸€æ ·ï¼šå¯¹ä½ æ˜¯æœ‰ç›Šçš„ï¼Œä½†ä¸æœ‰è¶£â€ã€‚æˆ‘å‘ç°å½“ä½ å‘å±•è‡ªå·±çš„æ—¶å€™ï¼Œä¹Ÿä¼šæœ‰åŒæ ·çš„æ„Ÿè§‰ã€‚ä½ å¸¸å¸¸ä¼šè§‰å¾—è¿™å¾ˆè´¹åŠ²ã€‚</p>
</blockquote>
<h3 id="åƒè‰ºæœ¯å®¶ä¸€æ ·å·å¸ˆå­¦è‰º"><a href="#åƒè‰ºæœ¯å®¶ä¸€æ ·å·å¸ˆå­¦è‰º" class="headerlink" title="åƒè‰ºæœ¯å®¶ä¸€æ ·å·å¸ˆå­¦è‰º"></a>åƒè‰ºæœ¯å®¶ä¸€æ ·å·å¸ˆå­¦è‰º</h3><blockquote>
<p>å¦‚æœè¯´æœ‰ä¸€é—¨èŒä¸šæ˜¯æ³¨é‡çœŸå®æ€§çš„ï¼Œé‚£å°±æ˜¯è‰ºæœ¯ã€‚åŒæ—¶ï¼Œé™¤äº†ä¸€ä¸ªè‰ºæœ¯å®¶ï¼Œæ²¡æœ‰ä»»ä½•äººæ›´æ¸…æ¥šæ²¡æœ‰ä»€ä¹ˆæ˜¯åŸåˆ›çš„ã€‚<br>æ¨¡ä»¿åˆ«äººè¿™ä»¶äº‹å¯¹äºä»–ä»¬æ¥è¯´å¾ˆå›°éš¾ï¼Œè¿˜ä¼šè®©ä»–ä»¬è§‰å¾—è‡ªå·±ä¸çœŸå®ã€‚å°±åƒä½œå®¶å¨å°”é€ŠÂ·ç±³èŒ¨çº³ï¼ˆWilson Miznerï¼‰æ‰€è¯´çš„ï¼Œå¦‚æœä½ æ¨¡ä»¿ä¸€ä¸ªä½œå®¶ï¼Œé‚£å°±æ˜¯å‰½çªƒï¼Œä½†æ˜¯å¦‚æœä½ æ¨¡ä»¿å¾ˆå¤šä¸ªä½œå®¶ï¼Œé‚£å°±æ˜¯ç ”ç©¶ã€‚</p>
</blockquote>
<p>çœŸæ­£é‡è¦çš„ä¸æ˜¯â€œå·â€åˆ«äººçš„é£æ ¼ï¼Œè€Œæ˜¯â€œå·â€éšè—åœ¨é£æ ¼èƒŒåçš„æ€æƒ³ã€‚</p>
<h2 id="4-5-ä¸ºä»€ä¹ˆè¦åƒæ°´ä¸€æ ·"><a href="#4-5-ä¸ºä»€ä¹ˆè¦åƒæ°´ä¸€æ ·" class="headerlink" title="4.5 ä¸ºä»€ä¹ˆè¦åƒæ°´ä¸€æ ·"></a>4.5 ä¸ºä»€ä¹ˆè¦åƒæ°´ä¸€æ ·</h2><blockquote>
<p>æå°é¾™è®¤ä¸ºä½ åº”è¯¥â€œåˆ©ç”¨ä¸€åˆ‡ä½ èƒ½åˆ©ç”¨çš„èµ„æºâ€ã€‚ä»–æ‰€è¯´çš„â€œåƒæ°´ä¸€æ ·â€ï¼Œæ˜¯æŒ‡ä¸è¦ä»…ä»…å±€é™åœ¨ä¸€ä¸ªå½¢è±¡é‡Œï¼Œè¦èƒ½é€‚åº”æ–°çš„ç¯å¢ƒï¼Œåœ¨æ–°çš„ç¯å¢ƒé‡Œå¡‘é€ ä¸€ä¸ªæ–°çš„è‡ªæˆ‘å½¢è±¡ï¼ˆä¾‹å¦‚ï¼ŒæŠŠæ°´å€’è¿›æ¯å­é‡Œï¼Œå®ƒå°±æ˜¯æ¯å­çš„å½¢çŠ¶ï¼›æŠŠæ°´å€’è¿›ç“¶å­é‡Œï¼Œå®ƒå°±æ˜¯ç“¶å­çš„å½¢çŠ¶ï¼‰</p>
</blockquote>
<blockquote>
<p>äººç±»æ‰€å…·æœ‰çš„ä¸€é¡¹å¾ˆç¥å¥‡çš„ç¼ºç‚¹å°±æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•å®Œå…¨æ¨¡ä»¿åˆ«äººã€‚åœ¨æˆ‘ä»¬æœªèƒ½æˆåŠŸæ¨¡ä»¿æˆ‘ä»¬çš„å¶åƒæ—¶ï¼Œä¾¿ä¼šå‘ç°çœŸå®çš„è‡ªå·±ã€‚è¿™å°±æ˜¯è¿›æ­¥è¿‡ç¨‹ã€‚</p>
</blockquote>
<h1 id="äº”ã€åˆç†çš„è§„åˆ’å‰è¿›çš„é“è·¯"><a href="#äº”ã€åˆç†çš„è§„åˆ’å‰è¿›çš„é“è·¯" class="headerlink" title="äº”ã€åˆç†çš„è§„åˆ’å‰è¿›çš„é“è·¯"></a>äº”ã€åˆç†çš„è§„åˆ’å‰è¿›çš„é“è·¯</h1><blockquote>
<p>è¦æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„é¢†å¯¼è€…ï¼Œå¹¶ä¸æ˜¯ä¸€ä»¶çªç„¶å°±å‘ç”Ÿçš„äº‹ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¼«é•¿çš„ç§¯ç´¯è¿‡ç¨‹ã€‚é‡‡å–æ–°çš„è¡ŒåŠ¨å¾ˆé‡è¦ï¼Œå³ä½¿æœ‰æ—¶å€™åšä¸€äº›æ–°çš„äº‹æƒ…ä¼šè®©æˆ‘ä»¬è§‰å¾—è™šå‡ï¼Œå› ä¸ºå®ƒä»¬å¾ˆå¿«å°±èƒ½å¸¦æ¥æˆæœï¼Œå¹¶ä¸æ–­åˆ·æ–°å¯èƒ½æ€§ï¼Œä½†æ˜¯å¾ˆå°‘ä¼šæœ‰ä¸€æ¡æ¸…æ™°çš„å®Œæˆç•Œçº¿ã€‚</p>
</blockquote>
<h2 id="5-1-ç…§é£Ÿè°±åšèœå¹¶ä¸èƒ½è®©ä½ æˆä¸ºä¸€ä¸ªå¥½å¨å¸ˆ"><a href="#5-1-ç…§é£Ÿè°±åšèœå¹¶ä¸èƒ½è®©ä½ æˆä¸ºä¸€ä¸ªå¥½å¨å¸ˆ" class="headerlink" title="5.1 ç…§é£Ÿè°±åšèœå¹¶ä¸èƒ½è®©ä½ æˆä¸ºä¸€ä¸ªå¥½å¨å¸ˆ"></a>5.1 ç…§é£Ÿè°±åšèœå¹¶ä¸èƒ½è®©ä½ æˆä¸ºä¸€ä¸ªå¥½å¨å¸ˆ</h2><blockquote>
<p>å¾ˆå¤šæ”¹å˜çš„æ–¹æ³•å‘Šè¯‰ä½ å¼€å§‹çš„æ—¶å€™è¦æƒ³å¥½ï¼Œæ”¹å˜ä»¥åè·å¾—çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚ä½†å®é™…ä¸Šï¼Œå¼„æ¸…æ¥šä½ æƒ³è¦æˆä¸ºä»€ä¹ˆæ ·çš„é¢†å¯¼è€…æ˜¯æ”¹å˜ä¸­æœ€åä¸€ä»¶éœ€è¦åšçš„äº‹ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä»¶ã€‚</p>
</blockquote>
<h3 id="â€œè¿›æ­¥çš„è¿‡ç¨‹â€"><a href="#â€œè¿›æ­¥çš„è¿‡ç¨‹â€" class="headerlink" title="â€œè¿›æ­¥çš„è¿‡ç¨‹â€"></a>â€œè¿›æ­¥çš„è¿‡ç¨‹â€</h3><blockquote>
<p>æˆ‘æ‰€è¯´çš„â€œè¿›æ­¥è¿‡ç¨‹â€ï¼ˆStepping-upProcessï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨Aï¼ˆç°åœ¨çš„ä½ ï¼‰ä¸Bï¼ˆæœªæ¥çš„ä½ ï¼‰ä¹‹é—´ï¼ˆå¦‚å›¾5-1ï¼‰ã€‚è¿›æ­¥æ˜¯ä¸€ç§è½¬å˜ï¼Œè¿™ç§è½¬å˜æ— æ³•é¢„æµ‹ï¼Œæ··ä¹±ä¸æ¸…ï¼Œæ›²æ›²æŠ˜æŠ˜ï¼Œå¹¶å—æƒ…ç»ªçš„æ§åˆ¶ï¼Œä¹‹æ‰€ä»¥ä¼šè¿™æ ·ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š</p>
<ul>
<li>Bæ˜¯æœªçŸ¥å’Œä¸ç¡®å®šçš„</li>
<li>Aå·²ç»ä¸å†é€‚ç”¨äº†</li>
<li>Bæœ‰å¾ˆå¤šç§å¯èƒ½æ€§</li>
<li>å½“æˆ‘ä»¬æ¥è¿‘å®ƒçš„æ—¶å€™ï¼ŒBå‘ç”Ÿäº†æ”¹å˜</li>
</ul>
<p>æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„å¨å¸ˆå–å†³äºå¢åŠ ä½ åˆ›é€ æ–°é£Ÿç‰©å¯èƒ½æ€§çš„æ¡ä»¶ï¼Œæ¯”å¦‚å—åˆ°ä¸€ä¸ªä¼˜ç§€å¨å¸ˆçš„æŒ‡å¯¼ï¼Œå»è¿œæ–¹æ—…æ¸¸å¯»æ‰¾æ–°é£Ÿæï¼Œå¶é‡ä¸€ä½è‘—åçš„ç¾é£Ÿè¯„è®ºå®¶æˆ–æ˜¯ä¸æœ€å¥½çš„é£Ÿç‰©ä¾›åº”å•†å»ºç«‹è‰¯å¥½çš„äººé™…å…³ç³»ã€‚ä½†æ˜¯è¿™äº›ä¸œè¥¿éƒ½ä¸ä¼šä¿è¯ä½ èƒ½è¾¾åˆ°è‡ªå·±çš„ç›®æ ‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæˆåŠŸå–å†³äºä½ æ˜¯å¦æˆäº†ä¸€ä¸ªä¸ä¸€æ ·çš„è‡ªå·±ã€‚æˆä¸ºä¸€åä¼˜ç§€çš„é¢†å¯¼è€…çš„è¿›æ­¥è¿‡ç¨‹æ›´åƒæ˜¯æˆä¸ºä¸€ä¸ªä¼˜ç§€çš„å¨å¸ˆçš„è¿‡ç¨‹ï¼Œè€Œä¸ä»…ä»…æ˜¯ç…§ç€é£Ÿè°±åšå‡ºå¥½åƒçš„ä¸œè¥¿ã€‚è¿›æ­¥è¿‡ç¨‹ä¸­æœ‰ä¸€äº›ä½ å¯èƒ½æ²¡æœ‰é¢„æƒ³åˆ°çš„æ–¹å¼æ”¹å˜äº†ä½ ã€‚</p>
</blockquote>
<h2 id="5-2-è½¬å˜è¿‡ç¨‹çš„å¯èƒ½é˜¶æ®µ"><a href="#5-2-è½¬å˜è¿‡ç¨‹çš„å¯èƒ½é˜¶æ®µ" class="headerlink" title="5.2 è½¬å˜è¿‡ç¨‹çš„å¯èƒ½é˜¶æ®µ"></a>5.2 è½¬å˜è¿‡ç¨‹çš„å¯èƒ½é˜¶æ®µ</h2><p>æˆä¸ºä¸€åä¼˜ç§€é¢†å¯¼è€…çš„è¿›æ­¥é˜¶æ®µ</p>
<blockquote>
<p>é˜¶æ®µ1ï¼šå‘ç°å·®å¼‚</p>
</blockquote>
<p>â— å‘ç°ç›®å‰çš„ä½ æ˜¯è°å’Œä½ æƒ³è¦æˆä¸ºä»€ä¹ˆæ ·çš„äººä¹‹é—´çš„å·®å¼‚<br>â— å¢åŠ é‡‡å–è¡ŒåŠ¨çš„ç´§è¿«æ„Ÿ</p>
<blockquote>
<p>é˜¶æ®µ2ï¼šåªåŠ ä¸å‡</p>
</blockquote>
<p>â— å¢åŠ æ–°çš„è§’è‰²æˆ–è¡Œä¸ºæ–¹å¼ï¼ˆä¸ä¼šæ”¾å¼ƒæ—§çš„è§’è‰²æˆ–è¡Œä¸ºæ–¹å¼ï¼‰<br>â— å¢åŠ å¤–åœ¨è¡¨ç°åŠ›ï¼Œè·å¾—ä¸€äº›å®¹æ˜“å¾—åˆ°çš„æˆæœ</p>
<blockquote>
<p>é˜¶æ®µ3ï¼šæ··ä¹±è¿·èŒ«</p>
</blockquote>
<p>â— é­é‡æŒ«æŠ˜<br>â— æŠŠæ—¶é—´å’Œç²¾åŠ›èŠ±åœ¨æ–°æ—§è§’è‰²è½¬æ¢æˆ–è¡Œä¸ºæ–¹å¼ä¸Šï¼Œæ„Ÿåˆ°ç­‹ç–²åŠ›å°½ï¼›å—åˆ°å‘¨å›´äººå¯¹äºä»¥å‰çš„é‚£ä¸ªä½ çš„è‚¯å®šï¼Œä»è€Œè¿›æ­¥ä¹‹è·¯å—åˆ°é˜»ç¢</p>
<blockquote>
<p>é˜¶æ®µ4ï¼šé‡æ–°è®¾å®šå‰è¿›æ–¹å‘</p>
</blockquote>
<p>â— æŒ«æŠ˜ï¼Œå¸¦æ¥æ›´å¤§çš„èŒä½é—®é¢˜<br>â— æ˜¯æ—¶å€™å°†å¤–åœ¨è¡¨ç°å†…åœ¨åŒ–äº†ï¼šåæ€æ–°çš„ç»å†æ¥é‡æ–°æ£€éªŒè¿‡å»çš„ç›®æ ‡ï¼Œä»è€Œæå‡ºæ–°çš„ç›®æ ‡</p>
<blockquote>
<p>é˜¶æ®µ5ï¼šå†…åœ¨åŒ–</p>
</blockquote>
<p>â— ä½ çš„æ–°èº«ä»½ä¼šä½¿æ”¹å˜ç»§ç»­è¿›è¡Œä¸‹å»</p>
<h2 id="5-3-äººçš„ä¸€ç”Ÿéƒ½åœ¨ä¸åœåœ°æ”¹å˜"><a href="#5-3-äººçš„ä¸€ç”Ÿéƒ½åœ¨ä¸åœåœ°æ”¹å˜" class="headerlink" title="5.3 äººçš„ä¸€ç”Ÿéƒ½åœ¨ä¸åœåœ°æ”¹å˜"></a>5.3 äººçš„ä¸€ç”Ÿéƒ½åœ¨ä¸åœåœ°æ”¹å˜</h2><blockquote>
<p>äº‹ä¸šä¸­æœŸè½¬å˜ä¸€ä¸ªæœ€å¤§çš„æŒ‘æˆ˜ä¹‹ä¸€æ˜¯å¼„æ¸…æ¥šè¯¥æ”¹å˜ä»€ä¹ˆä»¥åŠè¯¥ä¿æŒä»€ä¹ˆã€‚æœ‰æ—¶å€™è¯±æƒ‘ä¼šè®©ä¸€åˆ‡é©¬ä¸Šæ”¹å˜ã€‚ä½†æ˜¯åƒæ”¹å˜å·¥ä½œæˆ–æ˜¯äº‹ä¸šè¿™æ ·é‡è¦çš„äº‹æƒ…ä¸ä¸€å®šä¼šç»™æˆ‘ä»¬å¸¦æ¥å¥½çš„ç»“æœã€‚</p>
</blockquote>
<h1 id="å…­ã€è¡ŒåŠ¨èµ·æ¥"><a href="#å…­ã€è¡ŒåŠ¨èµ·æ¥" class="headerlink" title="å…­ã€è¡ŒåŠ¨èµ·æ¥"></a>å…­ã€è¡ŒåŠ¨èµ·æ¥</h1><blockquote>
<p>èº«è¾¹çš„æ¯ä¸€ä¸ªäººéƒ½ä¼šå‘Šè¯‰ä½ ï¼Œå¦‚æœæƒ³æˆä¸ºä¸€åä¼˜ç§€çš„é¢†å¯¼è€…ï¼Œé‚£å°±éœ€è¦å­¦ä¼šè‡ªçœåæ€ï¼Œæ¸…æ¥šåœ°çŸ¥é“è‡ªå·±æƒ³è¦ä»€ä¹ˆï¼Œå¢å¼ºè‡ªæˆ‘æ„è¯†ã€‚è¿™äº›å»ºè®®éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯è¿™åªä¼šåœ¨æ”¹å˜åæœŸèµ·åˆ°ä½œç”¨ï¼Œè€Œä¸€å¼€å§‹ä½ å¿…é¡»è¦å…ˆæœ‰ä¸€äº›æ–°çš„ç»å†ï¼Œè¦ä¸ç„¶ä½ æ‰€åæ€çš„ç»“æœåªä¼šåœç•™åœ¨è¿‡å»ã€‚å†…åœ¨æ´å¯ŸåŠ›æ˜¯å¤–åœ¨è¡¨ç°åŠ›çš„åæ˜ ï¼Œè€Œå¹¶ä¸æ˜¯åˆ›é€ å¤–åœ¨è¡¨ç°åŠ›çš„æºæ³‰ã€‚å¼„æ¸…æ¥šä½ æƒ³è¦æˆä¸ºä»€ä¹ˆæ ·çš„é¢†å¯¼è€…å¹¶ä¸æ˜¯ä½ æˆé•¿ä¹‹è·¯ä¸Šçš„èµ·ç‚¹ï¼Œè€Œæ˜¯åœ¨æ”¹å˜ä½ å¤–åœ¨è¡¨ç°åŠ›çš„æ—¶å€™è·å¾—çš„ç»“æœã€‚ä½ å¿…é¡»æŠŠä¼ ç»Ÿçš„â€œå…ˆæ€è€ƒåè¡ŒåŠ¨â€çš„è§‚ç‚¹åè¿‡æ¥ï¼Œè¿™æ ·æ‰èƒ½æˆåŠŸåœ°å®ç°è½¬å˜ã€‚</p>
</blockquote>
<h2 id="è¿‡å»çš„ç»å†æœ‰ç”¨å—ï¼Ÿ"><a href="#è¿‡å»çš„ç»å†æœ‰ç”¨å—ï¼Ÿ" class="headerlink" title="è¿‡å»çš„ç»å†æœ‰ç”¨å—ï¼Ÿ"></a>è¿‡å»çš„ç»å†æœ‰ç”¨å—ï¼Ÿ</h2><blockquote>
<p>ä¹”å¸ƒæ–¯åœ¨ä»–è‘—åçš„æ–¯å¦ç¦å¤§å­¦æ¯•ä¸šæ¼”è®²ä¸­è¯´é“ï¼Œä»–åœ¨å¤§å­¦æ—¶è¾å­¦å»åšäº†å…¶ä»–äº‹ï¼Œæ¯”å¦‚å»ä¸Šç¾æœ¯è¯¾ï¼Œè€Œè¿™ä¸ªç»å†å¯¹å¤šå¹´ä»¥åä»–æ‰€ç”Ÿäº§çš„è‹¹æœäº§å“çš„å¤–è§‚åŠè§¦æ„Ÿäº§ç”Ÿäº†å¾ˆå¤§çš„å½±å“ã€‚ä»–ä»æ¥æ²¡æœ‰æƒ³è¿‡è¿™ä¸ªå…´è¶£çˆ±å¥½ä¼šå¯¹åæ¥æ‰€å–å¾—çš„æˆç»©äº§ç”Ÿè‡³å…³é‡è¦çš„ä½œç”¨ã€‚â€œå‘å‰å±•æœ›æ—¶ä½ ä¸èƒ½æŠŠç‚¹ç‚¹æ»´æ»´çš„ç»å†è”ç³»åœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨å‘åå›é¡¾æ—¶æ‰èƒ½å‘ç°å®ƒä»¬ä¹‹é—´çš„è”ç³»ã€‚â€</p>
</blockquote>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æœ¬ä¹¦è§£ç­”äº†å¥½å¤šæˆ‘åœ¨æ”¹å˜è¿‡ç¨‹ä¸­é‡åˆ°çš„å›°æƒ‘ï¼Œè¿™äº›æ€æƒ³çŠ¹å¦‚ç¯å¡”ï¼Œä¸ºä¸ªäººè½¬å˜ä¹‹è·¯æŒ‡æ˜äº†æ–¹å‘ã€‚è¿™é‡Œåˆ—ä¸¾æˆ‘å°è±¡æ·±åˆ»çš„å‡ ä¸ªè§‚ç‚¹ï¼š</p>
<ul>
<li>æ”¹å˜æ€æƒ³ä»è¡ŒåŠ¨å¼€å§‹</li>
<li>â€œç”±å¤–åˆ°å†…â€è½¬å˜</li>
<li>é‡æ–°å®šä¹‰ä½ çš„å·¥ä½œã€äººé™…å…³ç³»ç½‘ç»œã€ä½ è‡ªå·±</li>
<li>åŠè¯´çš„ç§˜è¯€</li>
<li>â€œç©ºå‡ºä¸€é—´æ‰‹æœ¯å®¤â€</li>
<li>â€œéšæœºåº”å˜è€…â€</li>
<li>â€œçœŸå®æ€§â€çš„é™·é˜±</li>
<li>åƒè‰ºæœ¯å®¶ä¸€æ ·å·å¸ˆ</li>
<li>â€œåƒæ°´ä¸€æ ·â€</li>
<li>è½¬å˜è¿‡ç¨‹çš„é˜¶æ®µ</li>
</ul>
<p>éš¾å¾—åœ¨äº”ä¸€å‡æœŸé™ä¸‹å¿ƒæ¥è¯»å®Œäº†è¿™æœ¬ä¹¦ï¼Œè¯»å®Œåæ”¶è·è‰¯å¤šï¼Œå¿½ç„¶æƒ³èµ·äº†æ›¾ç»å¬åˆ°è¿‡çš„ä¸€å¥è¯ï¼šâ€œå­¤ç‹¬æ˜¯ä¸€ä¸ªäººçš„ç‹‚æ¬¢â€ï¼Œæ­¤åˆ»æˆ‘ä»¿ä½›çœŸæ­£é¢†æ‚Ÿåˆ°äº†è¿™å¥è¯çš„çœŸæ„ã€‚</p>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>èƒ½åŠ›é™·é˜±</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šé‚“å°å¹³æ—¶ä»£ã€‹</title>
    <url>/2021/06/08/book/deng-xiao-ping-shi-dai/</url>
    <content><![CDATA[<p><em><strong>ã€Šé‚“å°å¹³æ—¶ä»£ã€‹â€”â€” è¿™æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€æœ¬å…¨é¢ç ”ç©¶å’Œè®°è¿°é‚“å°å¹³æ”¿æ²»ç”Ÿæ¶¯çš„è‘—ä½œ</strong></em><br><img src="/images/%E9%82%93%E5%B0%8F%E5%B9%B3%E6%97%B6%E4%BB%A3.png" alt="é‚“å°å¹³æ—¶ä»£"></p>
<p>ä¸çŸ¥ä¸è§‰ä¸­å‘ç°è‡ªå·±å¯¹å†å²çš„å…´è¶£è¶Šæ¥è¶Šæµ“åšï¼Œä¸ä½†æŠŠã€Šæ˜æœé‚£äº›äº‹å„¿ã€‹è¯»äº†ç¬¬äºŒéï¼Œè€Œä¸”ä¸ºäº†å¯¹ä¸­å›½å†å²æœ‰ä¸€ä¸ªæ›´å…¨é¢çš„è®¤è¯†ï¼Œå»çœ‹äº†æœ‹å‹æ¨èçš„ã€Šä¸­å›½é€šå²ã€‹è¿™éƒ¨ç™¾é›†çºªå½•ç‰‡ï¼Œç›´åˆ°ç°åœ¨ç”¨äº†åŠå¹´æ—¶é—´çœ‹å®Œäº†è¿™æœ¬ã€Šé‚“å°å¹³æ—¶ä»£ã€‹ã€‚<br>å”å¤ªå®—æ›¾è¯´è¿‡ï¼šâ€œä»¥é“œä¸ºé•œï¼Œå¯ä»¥æ­£è¡£å† ï¼›ä»¥å²ä¸ºé•œï¼Œå¯ä»¥çŸ¥å…´æ›¿ï¼›ä»¥äººä¸ºé•œï¼Œå¯ä»¥æ˜å¾—å¤±â€ã€‚åœ¨å†å²çš„é•¿æ²³ä¸­ï¼Œå¯ä»¥å‘ç°äººç±»ç¤¾ä¼šåœ¨ä¸åŒæ—¶æœŸä»æœ‰è®¸å¤šå…±åŒç‚¹ï¼Œä»è€Œçª¥æ¢åˆ°æˆ‘ä»¬ç”Ÿæ´»çš„ç¤¾ä¼šçš„ä¸€äº›è¿è¡Œè§„å¾‹ã€‚</p>
<p>çœ‹å®Œè¿™æœ¬ä¹¦åå¾ˆå¤šä¸æ›¾æ˜ç™½çš„äº‹æƒ…é¡¿æ—¶è±ç„¶å¼€æœ—ï¼Œè€Œé‚“å°å¹³è·Œå®•èµ·ä¼çš„äººç”Ÿä»¥åŠå…¶ä¸ªäººå“è´¨æ·±æ·±çš„æŠ˜æœäº†æˆ‘ï¼Œåœ¨æˆ‘è¿·èŒ«ä¸çŸ¥æ‰€æªçš„æ—¶å€™ï¼Œåˆå¤šäº†ä¸€ç›æŒ‡å¼•çš„æ˜ç¯ã€‚</p>
<p>æœ¬æƒ³åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹é‚“å°å¹³çš„ä¸€ç”Ÿä»¥åŠå¯¹ä¸­å›½ä¹ƒè‡³ä¸–ç•Œçš„å½±å“ï¼Œä½†æ˜¯å‘ç°è‡ªå·±çŸ¥è¯†æµ…è–„ï¼Œå¯¹äºä»‹ç»é‚“å°å¹³çš„ä¹¦ç±åŠæ–‡çŒ®ä»…è¯»è¿‡æ­¤ä¹¦ã€‚æ¯›ä¸»å¸­æ›¾è¯´ï¼šâ€œæ²¡æœ‰è°ƒæŸ¥ï¼Œæ²¡æœ‰å‘è¨€æƒâ€ã€‚äºæ˜¯ä½œç½¢ï¼Œå°±å•å•å†™å†™è‡ªå·±åœ¨æ­¤ä¹¦ä¸­çš„æ”¶è·å§ã€‚</p>
<h1 id="ä¸äº‰è®ºï¼Œå…ˆå°è¯•ï¼Œè§æ•ˆä¹‹åå†æ¨å¹¿"><a href="#ä¸äº‰è®ºï¼Œå…ˆå°è¯•ï¼Œè§æ•ˆä¹‹åå†æ¨å¹¿" class="headerlink" title="ä¸äº‰è®ºï¼Œå…ˆå°è¯•ï¼Œè§æ•ˆä¹‹åå†æ¨å¹¿"></a>ä¸äº‰è®ºï¼Œå…ˆå°è¯•ï¼Œè§æ•ˆä¹‹åå†æ¨å¹¿</h1><p>é‚“å°å¹³è¢«ç§°ä¸ºæ”¹é©å¼€æ”¾çš„æ€»è®¾è®¡å¸ˆï¼Œä½†æ˜¯åœ¨æ”¹é©å¼€æ”¾çš„å·¥ä½œä¸­å¹¶ä¸æ˜¯ä¸€å¸†é£é¡ºçš„ï¼Œåœ¨æ¨è¡Œæ”¹é©å¼€æ”¾ä¸»è¦é¢ä¸´çš„é˜»åŠ›æ¥è‡ªäºå½“æ—¶çš„ä¿å®ˆæ´¾ï¼Œä»–ä»¬æ‹…å¿ƒæ”¹é©å¼€æ”¾ä¼šä½¿èµ„æœ¬ä¸»ä¹‰å¤è¾Ÿã€‚åœ¨è¿™ä¸ªæ–¹é¢ï¼Œé‚“å°å¹³çš„åšæ³•å°±æ˜¯ï¼šâ€œä¸äº‰è®ºï¼Œå…ˆå°è¯•ï¼Œè§æ•ˆä¹‹åå†æ¨å¹¿â€ã€‚<br>åœ¨ç”Ÿæ´»ä¸­ï¼Œå¾ˆå¤šäº‹æƒ…éƒ½å¯ä»¥é‡‡å–è¿™ç§åšæ³•ï¼Œé€šè¿‡è¯•éªŒç»“æœå†åšé€‰æ‹©ï¼Œå®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†ï¼Œæ²¡å¿…è¦ä¸€å¼€å§‹å¤§å®¶å°±äº‰å¾—å¤´ç ´è¡€æµã€‚</p>
<h1 id="å‘ç¾å›½ã€æ—¥æœ¬å¼€æ”¾"><a href="#å‘ç¾å›½ã€æ—¥æœ¬å¼€æ”¾" class="headerlink" title="å‘ç¾å›½ã€æ—¥æœ¬å¼€æ”¾"></a>å‘ç¾å›½ã€æ—¥æœ¬å¼€æ”¾</h1><p>ç”Ÿæ´»åœ¨å½“ä»£çš„æˆ‘ä»¬æ²¡æœ‰ç»å†è¿‡æˆ˜äº‰ï¼Œå¯¹äºæˆ˜äº‰çš„è®¤è¯†ä»…é™äºä¹¦æœ¬ä¸Šçš„å†å²äº‹ä»¶ã€‚è€Œä¸”ä»…ä»…æ˜¯é€šè¿‡å†å²æˆ‘ä»¬éƒ½éš¾ä»¥å¿˜å´ä¸­åæ°‘æ—é­å—ä¾µç•¥ï¼Œå¯¹äºäº²èº«ç»å†è¿‡æˆ˜äº‰çš„é‚“å°å¹³æ¥è¯´ï¼Œä»–ä»¬æ„Ÿå—æ›´ä¸ºå¼ºçƒˆã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆåœ¨æ”¹é©å¼€æ”¾ä¸­è¦ç§¯æä¸ç¾å›½æ—¥æœ¬å»ºäº¤ï¼Ÿ<br>ä»é‚“å°å¹³ä¸ªäººçš„æƒ…æ„Ÿå’Œç»å†æ¥è¯´ï¼Œæˆ˜äº‰è™½ç„¶è¿‡å»äº†ï¼Œä½†æ˜¯ä¼¤ç—›ä¾æ—§ã€‚ä½†æ˜¯ä»–ä½œä¸ºå›½å®¶é¢†å¯¼ä»–ï¼Œå¿…é¡»ä¸ºå›½å®¶å’Œäººæ°‘åˆ©ç›Šç€æƒ³ï¼Œå½“æ—¶çš„ä¸­å›½éœ€è¦ç¾å›½ã€æ—¥æœ¬å…ˆè¿›çš„å·¥ä¸šæŠ€æœ¯æ¥ä¿ƒè¿›è‡ªèº«çš„å‘å±•ï¼Œåœ¨ä¸ªäººæƒ…æ„Ÿå’Œå›½å®¶åˆ©ç›Šä¸Šä»–é€‰æ‹©äº†åè€…ã€‚</p>
<h1 id="åºŸé™¤å¹²éƒ¨é¢†å¯¼èŒåŠ¡ç»ˆèº«åˆ¶"><a href="#åºŸé™¤å¹²éƒ¨é¢†å¯¼èŒåŠ¡ç»ˆèº«åˆ¶" class="headerlink" title="åºŸé™¤å¹²éƒ¨é¢†å¯¼èŒåŠ¡ç»ˆèº«åˆ¶"></a>åºŸé™¤å¹²éƒ¨é¢†å¯¼èŒåŠ¡ç»ˆèº«åˆ¶</h1><p>åœ¨æˆ‘å›½ä¸¤åƒå¤šå¹´çš„å¸ç‹ç»Ÿæ²»ä¸­ï¼Œå›½å®¶å¹²éƒ¨é¢†å¯¼å’ŒèŒåŠ¡ä¸€ç›´éƒ½æ˜¯ç»ˆèº«åˆ¶ã€‚é‚“å°å¹³ç»ˆç»“äº†æ¯›æ³½ä¸œæ—¶ä»£çš„é¢†å¯¼äººç»ˆèº«åˆ¶ï¼Œå»ºç«‹èµ·ä»»æœŸåˆ¶å’Œé€€ä¼‘åˆ¶åº¦ã€‚è€Œä¸”ä»–è‡ªå·±å¸¦å¤´æ‰§è¡Œé€€ä¼‘åˆ¶åº¦ï¼Œé‚“å°å¹³äº1989å¹´11æœˆåº•è¾èŒï¼ˆäº1997å¹´2æœˆé€ä¸–ï¼‰ï¼Œå°†æƒåˆ©è¿‡åº¦åˆ°äº†æ±Ÿæ³½æ˜æ‰‹ä¸­ã€‚<br>é€€ä¼‘åˆ¶èƒ½ä¿è¯æ”¿åºœæƒåˆ©è¿‡åº¦çš„ç¨³å®šï¼Œè¿™ä¸€ç‚¹ï¼Œåœ¨æ•´ä¸ªä¸­å›½å†å²ä¸Šæ˜¯å²æ— å‰ä¾‹çš„ã€‚</p>
<h1 id="ä¸‰è½ä¸‰èµ·"><a href="#ä¸‰è½ä¸‰èµ·" class="headerlink" title="ä¸‰è½ä¸‰èµ·"></a>ä¸‰è½ä¸‰èµ·</h1><p>åœ¨æˆ‘è¿·èŒ«ä¸çŸ¥æ‰€æªçš„æ—¶å€™ï¼Œæƒ³èµ·é‚“å°å¹³ä¸‰è½ä¸‰èµ·çš„äººç”Ÿç»å†ï¼Œåˆä¼šé‡æ–°åšå®šè‡ªå·±çš„ä¿¡å¿µã€‚ç»™æˆ‘å°è±¡æœ€æ·±åˆ»çš„æ˜¯é‚“å°å¹³åœ¨æ–‡é©æœŸé—´ç¬¬äºŒæ¬¡è¢«æ‰“å€’ï¼Œä¸‹æ”¾åˆ°æ±Ÿè¥¿åŠ³æ”¹ã€‚<br>åœ¨æ–‡é©æœŸé—´ï¼Œä¸ä»…é‚“å°å¹³æœ¬äººå—åˆ°äº†æ‰¹æ–—ï¼Œä»–çš„å®¶åº­æˆå‘˜ä¹Ÿå—åˆ°äº†è¿«å®³ã€‚é‚“å°å¹³çš„å¼Ÿå¼Ÿé‚“èœ€å¹³åœ¨æ–‡é©ä¸­å› ä¸ºç»æœ›è€Œè‡ªæ€ï¼Œé‚“å°å¹³é•¿å­é‚“æœ´æ–¹åœ¨æ–‡é©æœŸé—´ä»å››æ¥¼æ‘”ä¸‹æ¥å¯¼è‡´è…°éƒ¨ä»¥ä¸‹ç˜«ç—ªã€‚ä»–æœ¬äººå…ˆæ˜¯è¢«è½¯ç¦ï¼Œååˆè¢«å…è®¸åœ¨æ‹–æ‹‰æœºå‚åŠ³åŠ¨ã€‚<br>è¿™æ®µæ—¶é—´è¢«é‚“å°å¹³è§†ä¸ºäººç”Ÿæœ€ç—›è‹¦çš„æ—¶æœŸï¼Œç„¶è€Œå°±æ˜¯åœ¨è¿™æ ·çš„å¤„å¢ƒä¹‹ä¸‹ï¼Œé‚“å°å¹³ä»æ²¡æœ‰æ”¾å¼ƒè‡ªå·±çš„ä¿¡å¿µï¼Œä»–å†™ä¿¡ç»™æ¯›ä¸»å¸­ï¼Œè¡¨ç¤ºæ„¿æ„ä¸ºå…šå’Œäººæ°‘å†åšä¸€äº›å·¥ä½œã€‚</p>
<h1 id="ä¸‰å‰¯ä¸€é•¿"><a href="#ä¸‰å‰¯ä¸€é•¿" class="headerlink" title="ä¸‰å‰¯ä¸€é•¿"></a>ä¸‰å‰¯ä¸€é•¿</h1><p>1978å¹´12æœˆï¼Œé‚“å°å¹³åœ¨ä¸­å…±åä¸€å±Šä¸‰ä¸­å…¨ä¼šä¸Šç¡®ç«‹é¢†å¯¼åœ°ä½ï¼Œå–ä»£æ—¶ä»»ä¸­å…±ä¸­å¤®ä¸»å¸­ã€å›½åŠ¡é™¢æ€»ç†åå›½é”‹æˆä¸ºä¸­å›½å®é™…ä¸Šçš„æœ€é«˜é¢†å¯¼äººã€‚è™½ç„¶é‚“å°å¹³åœ¨1978å¹´ä¹‹åæˆä¸ºå®é™…çš„æœ€é«˜é¢†å¯¼äººï¼Œä½†æ˜¯åœ¨ä»»èŒæœŸé—´ï¼Œå¹¶æ²¡æœ‰ç™»ä¸Šå›½å®¶æœ€é«˜é¢†å¯¼äººçš„èŒä½ã€‚<br>é‚“å°å¹³äº1977å¹´ä¸­å…±åå±Šä¸‰ä¸­å…¨ä¼šä¸­ç¬¬ä¸‰æ¬¡å¤å‡ºæ”¿å›ï¼Œä»»ä¸­å…±ä¸­å¤®å‰¯ä¸»å¸­ã€å›½åŠ¡é™¢å‰¯æ€»ç†ã€ä¸­å¤®å†›å§”å‰¯ä¸»å¸­å’Œè§£æ”¾å†›æ€»å‚è°‹é•¿ç­‰å…šæ”¿å†›èŒåŠ¡ï¼Œåˆç§°ä¸‰å‰¯ä¸€é•¿ã€‚</p>
<h1 id="ç™¾ä¸‡å¤§è£å†›"><a href="#ç™¾ä¸‡å¤§è£å†›" class="headerlink" title="ç™¾ä¸‡å¤§è£å†›"></a>ç™¾ä¸‡å¤§è£å†›</h1><p> åœ¨1985å¹´ä¸­â€”1987å¹´åº•æœŸé—´ï¼Œåœ¨å½“æ—¶çš„ä¸­å›½å…±äº§å…šä¸­å¤®å†›äº‹å§”å‘˜ä¼šä¸»å¸­é‚“å°å¹³é¢†å¯¼ä¸‹ï¼Œä¸­å›½äººæ°‘è§£æ”¾å†›è£å†›ä¸€ç™¾ä¸‡äººã€‚<br> é‚“å°å¹³æå‡ºè£å†›100ä¸‡ï¼Œç†ç”±ä¸»è¦æœ‰äºŒã€‚ç¬¬ä¸€æ˜¯å› ä¸ºè§£æ”¾å†›æœºæ„è‡ƒè‚¿ï¼Œæ¯ä¸ªå†›åŒºçš„é¢†å¯¼ç­å­æœ‰åå‡ åäºŒååä¹‹å¤šï¼Œè€Œä¸”ç»“æ„ä¸åˆç†ï¼Œå®˜å…µæ¯”ä¾‹æ˜¯ 1:2.6ï¼Œè¿œè¿œé«˜äºå…¶ä»–å›½å®¶ã€‚<br> å½“æ—¶ä¸­å›½å†›è´¹å¾ˆå°‘ï¼Œè€Œå†›é˜Ÿäººæ•°å¤ªå¤šï¼Œç›´æ¥é™åˆ¶äº†å†›é˜Ÿæ­¦å™¨è£…å¤‡çš„å‘å±•å’Œæˆ˜æ–—åŠ›çš„æé«˜ã€‚è£å†›å¯ä»¥èŠ‚çœå¼€æ”¯ã€æ”¹å–„è£…å¤‡ã€æé«˜å†›é˜Ÿç´ è´¨ã€‚å¦ä¸€ä¸ªè£å†›çš„ç†ç”±æ˜¯åŸºäºå¯¹å›½é™…å½¢åŠ¿çš„åˆ¤æ–­ï¼ŒçŸ­æœŸå†…ä¸ä¼šå‘ç”Ÿå¤§çš„æˆ˜äº‰ï¼Œè¦è…¾å‡ºæ›´å¤šçš„é’±æ¥æå»ºè®¾ï¼Œè€Œä¸”â€œå³ä½¿æˆ˜äº‰çˆ†å‘ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ¶ˆè‚¿â€ã€‚</p>
<p> æŒ‰ç…§ä¸­å¤®å†›å§”çš„å†³ç­–éƒ¨ç½²ï¼Œä»1985å¹´ä¸‹åŠå¹´å¼€å§‹ï¼ŒæŒ‰ç…§å…ˆæœºå…³ï¼Œåéƒ¨é˜Ÿã€é™¢æ ¡å’Œä¿éšœå•ä½çš„é¡ºåºï¼Œè§£æ”¾å†›è‡ªä¸Šè€Œä¸‹åœ°ç»„ç»‡å®æ–½äº†ç™¾ä¸‡å¤§è£å†›ã€‚åˆ°1987å¹´ï¼Œä¸­å›½äººæ°‘è§£æ”¾å†›çš„æ€»å‘˜é¢ç”±423.8ä¸‡äººå‡åˆ°323.5ä¸‡äººã€‚ä¹‹åï¼Œåˆä½œäº†è¿›ä¸€æ­¥çš„è£å‡ï¼Œè‡³1990å¹´ï¼Œå…¨å†›æ€»å‘˜é¢å‡åˆ°319.9ä¸‡äººï¼Œå…±è£å‡å‘˜é¢103.9ä¸‡äººã€‚                   </p>
<h1 id="é‚“å°å¹³å—å·¡"><a href="#é‚“å°å¹³å—å·¡" class="headerlink" title="é‚“å°å¹³å—å·¡"></a>é‚“å°å¹³å—å·¡</h1><p>é‚“å°å¹³å—å·¡ï¼Œåˆç§°ä¹äºŒå—å·¡ï¼Œæ˜¯æŒ‡1992å¹´1æœˆ18æ—¥è‡³2æœˆ21æ—¥æœŸé—´ï¼Œé‚“å°å¹³åœ¨ä¸­å›½å—æ–¹çš„æ·±åœ³ã€ç æµ·ã€å¹¿å·ã€ä¸Šæµ·ç­‰åœ°æ‰€åšçš„å·¡è§†ä»¥åŠè®²è¯ï¼Œé‡ç”³ä¸æ”¹é©å¼€æ”¾ç›¸å…³çš„é‚“å°å¹³ç†è®ºï¼Œå¹¶æœŸè®¸å¹¿ä¸œèƒ½æŒ‰å…¶â€œç”Ÿäº§åŠ›ä¸ºåŸºç¡€çš„å‘å±•è§‚â€å‘å±•ç»æµåœ¨20å¹´å†…è¿½ä¸Šäºšæ´²å››å°é¾™ã€‚<br>é‚“å°å¹³çš„ä¹äºŒå—å·¡åœ¨ä¸­åäººæ°‘å…±å’Œå›½å†å²ä¸Šå…·æœ‰é‡è¦åœ°ä½ï¼Œå› å…­å››äº‹ä»¶è€Œæ”¾ç¼“ç”šè‡³åœæ»çš„ä¸­å›½æ”¹é©å¼€æ”¾è‡ªæ­¤é‡æ–°æé€Ÿï¼Œè€Œä¹äºŒå—å·¡è¿˜æ‹¯æ•‘äº†å½“æ—¶ä¸­å›½æ–°å…´çš„èµ„æœ¬å¸‚åœºã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ã€Šé‚“å°å¹³æ—¶ä»£ã€‹ä¸€ä¹¦æ˜¯ä½œè€…ç»“åˆé‚“å°å¹³è·Œå®•èµ·ä¼çš„æ”¿æ²»ç”Ÿæ¶¯å’Œä¸­å›½æ”¹é©é£äº‘å˜å¹»çš„æ”¹é©å¼€æ”¾è¿›ç¨‹çš„å…¨æ™¯å¼çš„æè¿°ã€‚åœ¨è¯»å®Œæ•´æœ¬ä¹¦åï¼Œè¶Šå‘ç°è‡ªå·±çš„æ— çŸ¥ã€‚<br>è¿™é‡Œç”¨ä¹‹å‰çœ‹åˆ°çš„ä¸€æ®µè¯æ¥å‹‰åŠ±è‡ªå·±ã€‚</p>
<blockquote>
<p>å¦‚æœä½ è§‰å¾—ä½ çš„ç¥–å›½ä¸å¥½ï¼Œä½ å°±å»å»ºè®¾å®ƒï¼Œå¦‚æœä½ è§‰å¾—æ”¿åºœä¸å¥½ï¼Œä½ å°±å»è€ƒå…¬åŠ¡å‘˜å»åšå®˜ï¼Œå¦‚æœä½ è§‰å¾—äººæ°‘æ²¡ç´ è´¨ï¼Œå°±ä»ä½ å¼€å§‹åšä¸€ä¸ªé«˜ç´ è´¨çš„å…¬æ°‘ï¼Œå¦‚æœä½ è§‰å¾—åŒèƒæ„šæ˜§æ— çŸ¥ï¼Œå°±ä»ä½ å¼€å§‹å­¦ä¹ å¹¶æ”¹å˜èº«è¾¹çš„äººï¼Œè€Œä¸æ˜¯ä¸€æ˜§çš„è°©éª‚ï¼ŒæŠ±æ€¨ï¼Œé€ƒç¦»ã€‚æ¨ªçœ‰å†·å¯¹åƒå¤«æŒ‡ï¼Œä¿¯é¦–ç”˜ä¸ºå­ºå­ç‰›ã€‚<br>ä½ æ‰€ç«™ç«‹çš„åœ°æ–¹ï¼Œæ­£æ˜¯ä½ çš„ä¸­å›½ï¼›ä½ æ€ä¹ˆæ ·ï¼Œä¸­å›½ä¾¿æ€ä¹ˆæ ·ï¼›ä½ æ˜¯ä»€ä¹ˆï¼Œä¸­å›½ä¾¿æ˜¯ä»€ä¹ˆï¼›ä½ è‹¥å…‰æ˜ï¼Œä¸­å›½ä¾¿ä¸é»‘æš—ã€‚æ„¿ä¸­å›½é’å¹´éƒ½æ‘†è„±å†·æ°”ï¼Œåªæ˜¯å‘ä¸Šèµ°ï¼Œä¸å¿…å¬è‡ªæš´è‡ªå¼ƒè€…æµçš„è¯ã€‚èƒ½åšäº‹çš„åšäº‹ï¼Œèƒ½å‘å£°çš„å‘å£°ã€‚æœ‰ä¸€åˆ†çƒ­ï¼Œå‘ä¸€åˆ†å…‰ï¼Œå°±ä»¤è¤ç«ä¸€èˆ¬ï¼Œä¹Ÿå¯ä»¥åœ¨é»‘æš—é‡Œå‘ä¸€ç‚¹å…‰ï¼Œä¸å¿…ç­‰å€™ç‚¬ç«ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>é‚“å°å¹³æ—¶ä»£</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Šé‡‘å­—å¡”åŸç†ã€‹</title>
    <url>/2022/08/20/book/jin-zi-ta-yuan-li/</url>
    <content><![CDATA[<p><img src="/images/book/%E9%87%91%E5%AD%97%E5%A1%94%E5%8E%9F%E7%90%86.jpeg" alt="é‡‘å­—å¡”åŸç†"></p>
<blockquote>
<p>éº¦è‚¯é”¡40å¹´ç»å…¸åŸ¹è®­æ•™æã€‚æ€è€ƒã€è¡¨è¾¾å’Œè§£å†³é—®é¢˜çš„é€»è¾‘ â€”â€” ã€ç¾ã€‘èŠ­èŠ­æ‹‰Â·æ˜æ‰˜</p>
</blockquote>
<h1 id="å†™åœ¨å‰é¢çš„è¯"><a href="#å†™åœ¨å‰é¢çš„è¯" class="headerlink" title="å†™åœ¨å‰é¢çš„è¯"></a>å†™åœ¨å‰é¢çš„è¯</h1><p>è¿™æ˜¯ä¸€æœ¬è®²â€œé‡‘å­—å¡”åŸç†â€çš„ä¹¦ç±ï¼Œå…¶ä¸­çš„æ€æƒ³å¯¹æˆ‘ä»¬æ€è€ƒã€è¡¨è¾¾æœ‰å¾ˆæ·±çš„æŒ‡å¯¼æ„ä¹‰ã€‚æœ¬ä¹¦çš„æ ¸å¿ƒæ€æƒ³ä¸æ˜¯å¾ˆå¤šï¼Œä½†ç”±äºæ˜¯ä¹¦ç±è½½ä½“çš„å½¢å¼ï¼Œè€Œä¸”ä¹¦ä¸­å­˜åœ¨å¤§é‡æ¡ˆä¾‹ï¼Œæ‰€ä»¥å†…å®¹ç•¥æ˜¾å•°å—¦ï¼Œè¯»èµ·æ¥æœ‰ç‚¹ä¹å‘³ã€‚å¦‚æœåªæ˜¯æƒ³äº†è§£ä»€ä¹ˆæ˜¯â€œé‡‘å­—å¡”åŸç†â€ï¼Œåˆ™é˜…è¯»è¿™æœ¬ä¹¦çš„åºè¨€éƒ¨åˆ†å³å¯ï¼Œè¿™æœ¬ä¹¦çš„åºè¨€å¯¹æœ¬ä¹¦ä¸­çš„å†…å®¹åšäº†å…¨é¢å’Œé«˜åº¦çš„æ€»ç»“ã€‚å¦‚æœä½ è¿˜æƒ³äº†è§£é‡‘å­—å¡”åŸç†çš„ä¸€äº›æ–¹å¼æ–¹æ³•ï¼Œè¯·ç»§ç»­å‘ä¸‹é˜…è¯»ã€‚</p>
<p>ä½¿ç”¨é‡‘å­—å¡”åŸç†çš„æœ€ç»ˆæƒ³è¦è¾¾åˆ°çš„ç›®çš„æ˜¯â€œé€»è¾‘æ¸…æ™°â€ï¼Œæˆ–è®¸æˆ‘ä»¬æ²¡æœ‰è¯»è¿‡è¿™æœ¬ä¹¦ï¼Œä½†æ˜¯åœ¨å­¦ä¹ å’Œå·¥ä½œä¸­æˆ‘ä»¬æˆ–å¤šæˆ–å°‘å·²ç»ä½¿ç”¨è¿‡ä¸€äº›æ–¹å¼æ–¹æ³•ã€‚ä¸‹é¢è„‘å›¾æ˜¯è¿™æœ¬ä¹¦çš„ä¸»è¦çš„ç›®å½•ç»“æ„ï¼š<br><img src="/2022/08/20/book/jin-zi-ta-yuan-li/%E9%87%91%E5%AD%97%E5%A1%94%E5%8E%9F%E7%90%86%E8%84%91%E5%9B%BE.png" alt="é‡‘å­—å¡”åŸç†è„‘å›¾"></p>
<blockquote>
<h1 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h1><p>â€œæƒ³æ¸…æ¥šï¼Œè¯´æ˜ç™½ï¼ŒçŸ¥é“è¯´ä»€ä¹ˆã€æ€ä¹ˆè¯´â€ï¼Œæ˜¯æˆ‘ä»¬å¸Œæœ›è¾¾åˆ°çš„å¢ƒç•Œã€‚å½“æˆ‘ä»¬ä¸äººæ²Ÿé€šæ—¶ï¼Œéœ€è¦æƒ³æ¸…æ¥š3ä»¶äº‹ï¼šè°æ˜¯æˆ‘çš„å¬ä¼—ï¼Ÿä»–ä»¬æƒ³å¬ä»€ä¹ˆï¼Ÿä»–ä»¬æƒ³æ€æ ·å¬ï¼Ÿ</p>
<p>ã€Šé‡‘å­—å¡”åŸç†ã€‹ä»‹ç»äº†ä¸€ç§èƒ½æ¸…æ™°åœ°å±•ç°æ€è·¯çš„æœ‰æ•ˆæ–¹æ³•ã€‚æŒæ¡äº†é‡‘å­—å¡”åŸç†ï¼Œå°±èƒ½é‡ç‚¹çªå‡ºï¼Œé€»è¾‘æ¸…æ™°ã€‚ä¸ç®¡æ˜¯åœ¨æ”¿ç•Œã€å•†ç•Œã€å­¦ç•Œï¼Œè¿˜æ˜¯åœ¨ä¼äº‹ä¸šå•ä½ï¼Œæ‰€æœ‰é«˜ã€ä¸­ã€åŸºå±‚èŒåœºäººå£«ï¼Œåªè¦ä½ éœ€è¦æ€è€ƒå’Œæ²Ÿé€šï¼Œå°±ä¼šä»é‡‘å­—å¡”åŸç†å—ç›Šã€‚é‡‘å­—å¡”ç»“æ„æ€è€ƒåŠ›æ˜¯é¢†å¯¼åŠ›çš„å¿…è¦ç´ è´¨ï¼Œæœ¬ä¹¦æ˜¯è®­ç»ƒæ€è€ƒã€ä½¿è¡¨è¾¾å‘ˆç°é€»è¾‘æ€§çš„å®ç”¨å®å…¸ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦å­¦ä¹ é‡‘å­—å¡”åŸç†"><a href="#ä¸ºä»€ä¹ˆè¦å­¦ä¹ é‡‘å­—å¡”åŸç†" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å­¦ä¹ é‡‘å­—å¡”åŸç†"></a>ä¸ºä»€ä¹ˆè¦å­¦ä¹ é‡‘å­—å¡”åŸç†</h2><p>æˆ‘ä»¬éƒ½å¸Œæœ›åœ¨æ€è€ƒã€æ²Ÿé€šäº¤æµã€ç®¡ç†ä¸‹å±å’Œè§£å†³é—®é¢˜æ—¶ï¼Œé‡ç‚¹çªå‡ºï¼Œæ€è·¯æ¸…æ™°ï¼Œå±‚æ¬¡åˆ†æ˜ã€‚æˆ‘ä»¬è¯„ä»·äººæ—¶ï¼Œæœ‰ä¸€ä¸ªæ ‡å‡†æ˜¯é€»è¾‘æ€ç»´èƒ½åŠ›ï¼Œè€Œé€»è¾‘æ€ç»´èƒ½åŠ›çš„æ ‡å‡†åˆæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æŒ‡å¯¼åˆ«äººâ€œè¦é€»è¾‘æ¸…æ™°ã€æ¡ç†åˆ†æ˜â€ï¼Œå¯æ€æ ·æ‰èƒ½åšåˆ°â€œé€»è¾‘æ¸…æ™°â€ï¼Ÿæ€æ ·æ‰èƒ½æé«˜æ€è€ƒèƒ½åŠ›ï¼Œå…»æˆè‰¯å¥½çš„æ€ç»´ä¹ æƒ¯ï¼Ÿ</p>
<p>æˆ‘ä»¬å¸Œæœ›åœ¨è¡¨è¾¾ï¼ˆå†™ä½œã€è®²è¯å’ŒåŸ¹è®­ï¼‰æ—¶â€œï¼Œèƒ½è¯´åˆ°ç‚¹å­ä¸Šï¼Œæ­£é¢å›ç­”å—ä¼—ï¼ˆè¯»è€…ã€å¬ä¼—å’Œå­¦å‘˜ï¼‰çš„é—®é¢˜ã€‚é‚£ä¹ˆä½ çŸ¥é“å¦‚ä½•æ­å»ºæ¡†æ¶ç»“æ„ã€ç»„ç»‡è¯­å¥çš„é¡ºåºï¼Œç”¨æœ€çŸ­æ—¶é—´è®²æ¸…è§‚ç‚¹ï¼Œè®©å—ä¼—æœ‰å…´è¶£ã€èƒ½ç†è§£ã€è®°å¾—ä½ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿˜å¸Œæœ›ï¼Œç»„ç»‡ä¸­çš„å…¨ä½“æˆå‘˜èƒ½ç”¨ç»Ÿä¸€çš„é€»è¾‘ã€ç»“æ„å’Œæ–¹å¼äº¤æµï¼Œå¿«é€Ÿäº§ç”Ÿå…±é¸£ï¼Œè¾¾æˆå…±è¯†ï¼Œé‚£ä¹ˆæ˜¯å¦æœ‰è§„èŒƒå¯å¯»ï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯â€”â€”ä½¿ç”¨é€»è¾‘æ¸…æ™°çš„é‡‘å­—å¡”ç»“æ„ï¼</p>
<h2 id="é‡‘å­—å¡”åŸç†çš„åŸºæœ¬æ¦‚å¿µ"><a href="#é‡‘å­—å¡”åŸç†çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="é‡‘å­—å¡”åŸç†çš„åŸºæœ¬æ¦‚å¿µ"></a>é‡‘å­—å¡”åŸç†çš„åŸºæœ¬æ¦‚å¿µ</h2><p>â— é‡‘å­—å¡”åŸç†æ˜¯ä¸€ç§é‡ç‚¹çªå‡ºã€é€»è¾‘æ¸…æ™°ã€å±‚æ¬¡åˆ†æ˜ã€ç®€å•æ˜“æ‡‚çš„æ€è€ƒæ–¹å¼ã€æ²Ÿé€šæ–¹å¼ã€è§„èŒƒåŠ¨ä½œã€‚</p>
<p>â— é‡‘å­—å¡”åŸç†çš„åŸºæœ¬ç»“æ„æ˜¯ï¼šç»“è®ºå…ˆè¡Œï¼Œä»¥ä¸Šç»Ÿä¸‹ï¼Œå½’ç±»åˆ†ç»„ï¼Œé€»è¾‘é€’è¿›ã€‚å…ˆé‡è¦åæ¬¡è¦ï¼Œå…ˆæ€»ç»“åå…·ä½“ï¼Œå…ˆæ¡†æ¶åç»†èŠ‚ï¼Œå…ˆç»“è®ºååŸå› ï¼Œå…ˆç»“æœåè¿‡ç¨‹ï¼Œå…ˆè®ºç‚¹åè®ºæ®ã€‚</p>
<p>â— é‡‘å­—å¡”åŸç†è®­ç»ƒè¡¨è¾¾è€…ï¼šå…³æ³¨ã€æŒ–æ˜å—ä¼—çš„æ„å›¾ã€éœ€æ±‚ç‚¹ã€åˆ©ç›Šç‚¹ã€å…³æ³¨ç‚¹å’Œå…´è¶£ç‚¹ï¼Œæƒ³æ¸…è¯´ä»€ä¹ˆï¼ˆå†…å®¹ï¼‰ï¼Œæ€ä¹ˆè¯´ï¼ˆæ€è·¯ã€ç»“æ„ï¼‰ï¼ŒæŒæ¡æ²Ÿé€šçš„æ ‡å‡†ç»“æ„ã€è§„èŒƒåŠ¨ä½œã€‚</p>
<p>â— é‡‘å­—å¡”èƒ½å¤Ÿè¾¾åˆ°çš„æ²Ÿé€šæ•ˆæœï¼šè§‚ç‚¹é²œæ˜ã€é‡ç‚¹çªå‡ºã€æ€è·¯æ¸…æ™°ã€å±‚æ¬¡åˆ†æ˜ã€ç®€å•æ˜“æ‡‚ï¼Œè®©å—ä¼—æœ‰å…´è¶£ï¼Œèƒ½ç†è§£ï¼Œè®°å¾—ä½ã€‚</p>
<p>â— æ­å»ºé‡‘å­—å¡”ç»“æ„çš„å…·ä½“åšæ³•æ˜¯ï¼šè‡ªä¸Šè€Œä¸‹è¡¨è¾¾ï¼Œè‡ªä¸‹è€Œä¸Šæ€è€ƒï¼Œçºµå‘æ€»ç»“æ¦‚æ‹¬ï¼Œæ¨ªå‘å½’ç±»åˆ†ç»„ï¼Œåºè¨€è®²æ•…äº‹ï¼Œæ ‡é¢˜æç‚¼æ€æƒ³ç²¾åã€‚</p>
<h2 id="é‡‘å­—å¡”åŸç†èƒ½å¤Ÿå¸®åŠ©ä½ è§£å†³å“ªäº›é—®é¢˜"><a href="#é‡‘å­—å¡”åŸç†èƒ½å¤Ÿå¸®åŠ©ä½ è§£å†³å“ªäº›é—®é¢˜" class="headerlink" title="é‡‘å­—å¡”åŸç†èƒ½å¤Ÿå¸®åŠ©ä½ è§£å†³å“ªäº›é—®é¢˜"></a>é‡‘å­—å¡”åŸç†èƒ½å¤Ÿå¸®åŠ©ä½ è§£å†³å“ªäº›é—®é¢˜</h2><p>å­¦ä¹ é‡‘å­—å¡”åŸç†è¯¾ç¨‹ï¼Œä¼šä½¿ç”¨é‡‘å­—å¡”ç»“æ„æ€è€ƒã€è¡¨è¾¾ã€ç®¡ç†ä¸‹å±å’Œè§£å†³é—®é¢˜ï¼Œæé«˜é€»è¾‘æ€§ã€æ¡ç†æ€§ï¼Œå‡†ç¡®é«˜æ•ˆé˜è¿°æ€æƒ³ã€‚æŒæ¡è§„èŒƒåŠ¨ä½œï¼Œç»„ç»‡ä¸­æ‰€æœ‰äººç”¨ç›¸åŒæ€è·¯å’Œè¡¨è¾¾æ–¹å¼äº¤æµï¼Œæ²Ÿé€šæ•ˆæœå¥½ã€æ•ˆç‡é«˜ã€‚</p>
<p>â— æ€è€ƒï¼šå­¦ä¼šç”¨å³è„‘ã€å·¦è„‘å…¨è„‘æ€ç»´ï¼Œæé«˜ç»“æ„åŒ–æ€ç»´èƒ½åŠ›ï¼Œæ€è€ƒå…¨ã€å‡†ã€å¿«ã€‚</p>
<p>â— ä¹¦é¢è¡¨è¾¾ã€å…¬æ–‡å†™ä½œï¼šä¼šæŒ–æ˜è¯»è€…çš„å…³æ³¨ç‚¹ã€å…´è¶£ç‚¹ã€éœ€æ±‚ç‚¹ã€åˆ©ç›Šç‚¹ï¼Œèƒ½ä½¿ç”¨é‡‘å­—å¡”çš„4ä¸ªåŸåˆ™ï¼Œæ­å»ºé€»è¾‘æ¸…æ™°çš„å¸¸ç”¨å…¬æ–‡æ¡†æ¶ç»“æ„ï¼ˆé€šçŸ¥ã€è¯·ç¤ºã€å·¥ä½œè®¡åˆ’ã€å·¥ä½œæ€»ç»“ã€ä¼šè®®çºªè¦ã€æŠ¥é“ï¼‰ï¼ŒæŒæ¡å†™åºè¨€çš„å››è¦ç´ ã€å½’ç±»åˆ†ç»„çš„MECEåŸåˆ™ï¼Œèƒ½å¤Ÿé‡ç‚¹çªå‡ºã€é€»è¾‘æ¸…æ™°ã€ç®€æ˜æ‰¼è¦ï¼Œè®©äººçœ‹å¾—æ‡‚ã€æ„¿æ„çœ‹ã€è®°å¾—ä½ã€‚å¿«é€Ÿå†™æ–‡ç« ï¼Œç¼©çŸ­å†™ä½œæ—¶é—´ï¼Œå‡å°‘ä¿®æ”¹æ¬¡æ•°ã€‚</p>
<p>â— å£å¤´è¡¨è¾¾ï¼šè¯´è¯ã€æ¼”è®²ã€è®²è¯¾ï¼Œèƒ½å¤Ÿä½¿ç”¨é‡‘å­—å¡”çš„åŸºæœ¬åŸåˆ™ï¼Œå›ç­”å¬ä¼—æœ€å¸¸æœ‰çš„4ç±»ç–‘é—®ï¼šâ€œæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•åšï¼Ÿå¥½ä¸å¥½ï¼Ÿâ€è¡¨è¾¾æ—¶é‡ç‚¹çªå‡ºã€æ¡ç†æ¸…æ™°ï¼Œè®©äººæ„¿æ„å¬ã€å¬å¾—æ‡‚ã€è®°å¾—ä½ï¼Œæˆä¸ºæ€è·¯æ¸…æ™°ã€è¨€ç®€æ„èµ…çš„äººã€‚</p>
<p>â— ç®¡ç†ä¸‹å±ï¼šèƒ½å¤Ÿè¿ç”¨é‡‘å­—å¡”åŸç†ï¼Œè€ƒè™‘å…¨é¢ã€å‘¨åˆ°ã€ä¸¥è°¨ï¼Œåˆ†é…ä»»åŠ¡ã€è®¾è®¡æµç¨‹ä¸é‡å æ— é—æ¼ã€‚</p>
<p>â— åŸ¹è®­å¸ˆå¼€å‘è¯¾ç¨‹å’Œè®²è¯¾ï¼šä¼šä½¿ç”¨é‡‘å­—å¡”æ­å»ºæ¡†æ¶ç»“æ„ã€ç»„ç»‡ç´ æã€é‡ç‚¹çªå‡ºã€é€»è¾‘æ¸…æ™°ã€é€šä¿—æ˜“æ‡‚ã€‚</p>
</blockquote>
<center><h1>ç¬¬1ç¯‡ï¼šè¡¨è¾¾çš„é€»è¾‘</h1></center>

<h1 id="ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨é‡‘å­—å¡”ç»“æ„"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨é‡‘å­—å¡”ç»“æ„" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨é‡‘å­—å¡”ç»“æ„"></a>ä¸€ã€ä¸ºä»€ä¹ˆè¦ç”¨é‡‘å­—å¡”ç»“æ„</h1><p>å½“æˆ‘ä»¬è¯•å›¾é€šè¿‡æ–‡ç« ã€æ¼”è®²æˆ–åŸ¹è®­å‘å—ä¼—ä¼ è¾¾æˆ‘ä»¬å¯¹é—®é¢˜çš„è§‚ç‚¹æ—¶ï¼Œé‚£ä¹ˆä»–å°†é¢ä¸´ä¸€é¡¹å¤æ‚çš„ä»»åŠ¡ã€‚å› ä¸ºå³ä½¿ä½ çš„æ–‡ç« ç¯‡å¹…å¾ˆçŸ­ï¼Œæ¯”å¦‚åªæœ‰ä¸¤é¡µçº¸ï¼Œæ–‡ç« ä¹Ÿä¼šåŒ…æ‹¬å¤§çº¦100ä¸ªå¥å­ï¼Œè¯»è€…å¿…é¡»é˜…è¯»ç†è§£æ¯ä¸€å¥è¯ï¼Œå¹¶ä¸”å¯»æ‰¾æ¯ä¸€å¥è¯ä¹‹é—´çš„è”ç³»ï¼Œå‰å‰åååå¤æ€è€ƒã€‚å¦‚æœä½ çš„æ–‡ç« ç»“æ„å‘ˆé‡‘å­—å¡”å½¢ï¼Œæ–‡ç« çš„æ€è·¯è‡ªé¡¶éƒ¨é€æ¸å‘ä¸‹å±•å¼€åˆ™ä¼šæ¯”è¾ƒæ˜“è¯»ã€‚è¿™ä¸€ç°è±¡ä½“ç°äº†äººç±»æ€ç»´çš„åŸºæœ¬è§„å¾‹ï¼š</p>
<blockquote>
<ul>
<li>å¤§è„‘è‡ªåŠ¨å°†ä¿¡æ¯å½’çº³åˆ°é‡‘å­—å¡”ç»“æ„çš„å„ç»„ä¸­ï¼Œä»¥ä¾¿äºç†è§£å’Œè®°å¿†</li>
<li>é¢„å…ˆå½’çº³åˆ°é‡‘å­—å¡”ç»“æ„ä¸­çš„æ²Ÿé€šå†…å®¹ï¼Œéƒ½æ›´å®¹æ˜“è¢«äººç†è§£å’Œè®°å¿†</li>
<li>ä½ åº”æœ‰æ„è¯†çš„å°†æ²Ÿé€šå†…å®¹ç»„ç»‡æˆé‡‘å­—å¡”ç»“æ„ï¼ŒåŒ…æ‹¬å£å¤´è¡¨è¾¾å’Œä¹¦é¢è¡¨è¾¾</li>
</ul>
</blockquote>
<h2 id="1-1-å¦‚ä½•å°†æ€æƒ³ç»„ç»‡æˆé‡‘å­—å¡”"><a href="#1-1-å¦‚ä½•å°†æ€æƒ³ç»„ç»‡æˆé‡‘å­—å¡”" class="headerlink" title="1.1 å¦‚ä½•å°†æ€æƒ³ç»„ç»‡æˆé‡‘å­—å¡”"></a>1.1 å¦‚ä½•å°†æ€æƒ³ç»„ç»‡æˆé‡‘å­—å¡”</h2><h3 id="å¥‡å¦™çš„æ•°å­—â€œ7â€"><a href="#å¥‡å¦™çš„æ•°å­—â€œ7â€" class="headerlink" title="å¥‡å¦™çš„æ•°å­—â€œ7â€"></a>å¥‡å¦™çš„æ•°å­—â€œ7â€</h3><p>è®ºæ–‡ã€Šå¥‡å¦™çš„æ•°å­—7Â±2ã€‹æå‡ºå¤§è„‘çš„çŸ­æœŸè®°å¿†æ— æ³•ä¸€æ¬¡å®¹çº³7ä¸ªä»¥ä¸Šçš„è®°å¿†é¡¹ç›®ã€‚æœ‰çš„äººå¯èƒ½ä¸€æ¬¡èƒ½è®°ä½9ä¸ªé¡¹ç›®ï¼Œæœ‰çš„äººåˆ™åªèƒ½è®°ä½5ä¸ªã€‚å¤§è„‘æ¯”è¾ƒå®¹æ˜“è®°ä½çš„æ˜¯3ä¸ªé¡¹ç›®ï¼Œå½“ç„¶æœ€å®¹æ˜“è®°ä½çš„æ˜¯ä¸€ä¸ªé¡¹ç›®ã€‚å½“å¤§è„‘å‘ç°éœ€è¦å¤„ç†çš„è®°å¿†é¡¹ç›®è¶…è¿‡4ä¸ªæˆ–5ä¸ªæ—¶ï¼Œå°±ä¼šå¼€å§‹å°†å…¶å½’ç±»åˆ°ä¸åŒçš„é€»è¾‘èŒƒç•´ä¸­ï¼Œä»¥ä¾¿äºè®°å¿†ã€‚</p>
<h3 id="æ­å»ºé‡‘å­—å¡”ç»“æ„çš„ä¸¤ä¸ªæ­¥éª¤"><a href="#æ­å»ºé‡‘å­—å¡”ç»“æ„çš„ä¸¤ä¸ªæ­¥éª¤" class="headerlink" title="æ­å»ºé‡‘å­—å¡”ç»“æ„çš„ä¸¤ä¸ªæ­¥éª¤"></a>æ­å»ºé‡‘å­—å¡”ç»“æ„çš„ä¸¤ä¸ªæ­¥éª¤</h3><ul>
<li>å½’ç±»åˆ†ç»„ï¼š æ ¹æ®é€»è¾‘å°†æ€æƒ³æˆ–æ¦‚å¿µåˆ†ç»„</li>
<li>æŠ½è±¡æ¦‚æ‹¬ï¼š æ‰¾å‡ºåˆ†ç»„åçš„é€»è¾‘å…³ç³»ï¼Œæé«˜ä¸€ä¸ªæŠ½è±¡å±‚æ¬¡</li>
</ul>
<h2 id="1-2-è‡ªä¸Šè€Œä¸‹è¡¨è¾¾ï¼Œç»“è®ºå…ˆè¡Œ"><a href="#1-2-è‡ªä¸Šè€Œä¸‹è¡¨è¾¾ï¼Œç»“è®ºå…ˆè¡Œ" class="headerlink" title="1.2 è‡ªä¸Šè€Œä¸‹è¡¨è¾¾ï¼Œç»“è®ºå…ˆè¡Œ"></a>1.2 è‡ªä¸Šè€Œä¸‹è¡¨è¾¾ï¼Œç»“è®ºå…ˆè¡Œ</h2><blockquote>
<p>ç ”ç©¶å‘ç°ï¼Œæœ€æœ‰æ•ˆçš„è¡¨è¾¾æ–¹å¼æ˜¯ï¼šå…ˆæå‡ºæ€»çš„æ¦‚å¿µï¼Œå†åˆ—å‡ºå…·ä½“é¡¹ç›®ï¼Œå³è¦è‡ªä¸Šè€Œä¸‹çš„è¡¨è¾¾æ€æƒ³ã€‚</p>
</blockquote>
<h3 id="éç»“æ„åŒ–è¡¨è¾¾å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"><a href="#éç»“æ„åŒ–è¡¨è¾¾å­˜åœ¨çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="éç»“æ„åŒ–è¡¨è¾¾å­˜åœ¨çš„é—®é¢˜ï¼Ÿ"></a>éç»“æ„åŒ–è¡¨è¾¾å­˜åœ¨çš„é—®é¢˜ï¼Ÿ</h3><ul>
<li>å—ä¼—éœ€è¦é€å¥ç†è§£ä½ è¦è¡¨è¾¾çš„æ€æƒ³ï¼Œå¹¶è‡ªåŠ¨ä»ä¸­å¯»æ‰¾å…±åŒç‚¹ï¼Œé€ æˆç†è§£å›°éš¾</li>
<li>ç”±äºç”¨æˆ·æ— æ³•æå‰çŸ¥é“ä½ çš„æ ¸å¿ƒæ€æƒ³ï¼Œå¯èƒ½ä¼šé€ æˆé”™è¯¯æ¨è®ºï¼Œé€ æˆè¯¯è§£</li>
</ul>
<blockquote>
<p>è¯»è€…åœ¨æ¥å—ä¿¡æ¯æ—¶ï¼Œæ€»æ˜¯åœ¨å¯»æ‰¾ä¸€ç§èƒ½å¤Ÿå°†æ‰€æ‘„å…¥ä¿¡æ¯è”ç³»èµ·æ¥çš„ç»“æ„ã€‚ä¸ºä¿è¯è¯»è€…æ‰¾åˆ°ä½ å¸Œæœ›çš„ç»“æ„ï¼Œä½ å¿…é¡»æå‰æŠŠè¿™ç§ç»“æ„å‘Šè¯‰ä»–ã€‚</p>
</blockquote>
<h2 id="1-3-è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼Œæ€»ç»“æ¦‚æ‹¬"><a href="#1-3-è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼Œæ€»ç»“æ¦‚æ‹¬" class="headerlink" title="1.3 è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼Œæ€»ç»“æ¦‚æ‹¬"></a>1.3 è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼Œæ€»ç»“æ¦‚æ‹¬</h2><p>å°†ä¿¡æ¯è¿›è¡Œå½’ç±»åˆ†ç»„ã€æŠ½è±¡æ¦‚æ‹¬ï¼Œå¹¶ä»¥è‡ªä¸Šè€Œä¸‹çš„æ–¹å¼è¡¨è¾¾å‡ºæ¥ï¼Œé‚£ä¹ˆç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸­é—´æ¯ä¸€ä¸ªæ·±è‰²æ–¹æ¡†ä»£è¡¨ä½ æƒ³è¡¨è¾¾çš„ä¸€ä¸ªæ€æƒ³ã€‚<br><img src="/2022/08/20/book/jin-zi-ta-yuan-li/%E9%87%91%E5%AD%97%E5%A1%94%E7%BB%93%E6%9E%84.png" alt="é‡‘å­—å¡”ç»“æ„"></p>
<center>æ–‡ç« ä¸­çš„æ€æƒ³åº”ç»„æˆå•ä¸€æ€æƒ³ç»Ÿé¢†ä¸‹çš„é‡‘å­—å¡”ç»“æ„</center>
ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ˜¯è‡ªä¸Šè€Œä¸‹çš„è¡¨è¾¾çš„ï¼Œä½†æ˜¯ä»”ç»†æƒ³ä¸€æƒ³ï¼Œæˆ‘ä»¬åœ¨å†™ä½œæ—¶çš„å®é™…æ€è€ƒè¿‡ç¨‹ä¸­ä¼šå‘ç°ï¼Œåœ¨æ€»ç»“ä¸»è¦æ€æƒ³æ—¶ä½¿ç”¨çš„æ˜¯è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼ã€‚
åœ¨é‡‘å­—å¡”ç»“æ„çš„æœ€åº•å±‚ï¼Œå¯¹æ¯ä¸€ä¸ªå•ä¸€æ€æƒ³è¿›è¡Œåˆ†ç»„ç„¶ååˆ†æé€»è¾‘å…³ç³»è¿›è¡ŒæŠ½è±¡æ¦‚æ‹¬ï¼Œå½¢æˆé«˜ä¸€å±‚çš„å•ä¸€æ€æƒ³ã€‚

<h3 id="é‡‘å­—å¡”ä¸­çš„æ€æƒ³3ä¸­ç›¸äº’å…³è”çš„æ–¹å¼"><a href="#é‡‘å­—å¡”ä¸­çš„æ€æƒ³3ä¸­ç›¸äº’å…³è”çš„æ–¹å¼" class="headerlink" title="é‡‘å­—å¡”ä¸­çš„æ€æƒ³3ä¸­ç›¸äº’å…³è”çš„æ–¹å¼"></a>é‡‘å­—å¡”ä¸­çš„æ€æƒ³3ä¸­ç›¸äº’å…³è”çš„æ–¹å¼</h3><p>é‡‘å­—å¡”ä¸­çš„æ€æƒ³ä»¥3ç§æ–¹å¼é¡¹ç›®å…³è”â€”â€”â€”â€”å‘ä¸Šã€å‘ä¸‹ã€æ¨ªå‘ã€‚ä½äºä¸€ç»„æ€æƒ³çš„ä¸Šä¸€ä¸ªå±‚æ¬¡çš„æ€æƒ³æ˜¯å¯¹è¿™ä¸€ç»„æ€æƒ³çš„æ¦‚æ‹¬ï¼Œè¿™ä¸€ç»„æ€æƒ³æ˜¯å¯¹å…¶ä¸Šä¸€å±‚æ¬¡æ€æƒ³çš„è§£é‡Šå’Œæ”¯æŒã€‚</p>
<p>æ–‡ç« ä¸­çš„æ€æƒ³å¿…é¡»ç¬¦åˆä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>çºµå‘ï¼š æ–‡ç« ç”¨ä»»ä¸€å±‚æ¬¡ä¸Šçš„æ€æƒ³å¿…é¡»æ˜¯å…¶ä¸‹ä¸€å±‚æ¬¡æ€æƒ³çš„æ¦‚æ‹¬</li>
<li>æ¨ªå‘ï¼š æ¯ç»„ä¸­çš„æ€æƒ³å¿…é¡»å±äºåŒä¸€é€»è¾‘èŒƒç•´</li>
<li>æ¨ªå‘ï¼š æ¯ç»„ä¸­çš„æ€æƒ³å¿…é¡»æŒ‰ç…§é€»è¾‘é¡ºåºç»„ç»‡</li>
</ul>
<h1 id="äºŒã€é‡‘å­—å¡”å†…éƒ¨çš„ç»“æ„"><a href="#äºŒã€é‡‘å­—å¡”å†…éƒ¨çš„ç»“æ„" class="headerlink" title="äºŒã€é‡‘å­—å¡”å†…éƒ¨çš„ç»“æ„"></a>äºŒã€é‡‘å­—å¡”å†…éƒ¨çš„ç»“æ„</h1><p>å¦‚æœåœ¨å†™ä½œä¹‹å‰ä½ å·²ç»å®Œå…¨æ¸…æ¥šäº†ä½ æƒ³è¡¨è¾¾çš„æ€æƒ³ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“çš„å°†è¦è¡¨è¾¾çš„æ€æƒ³ç»„æˆè§„èŒƒçš„é‡‘å­—å¡”ç»“æ„ã€‚ä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬åˆšå¼€å§‹å†™ä½œæ—¶ï¼Œå¯èƒ½å¯¹è‡ªå·±æƒ³è¦è¡¨è¾¾çš„æ€æƒ³è¿˜åªæœ‰æ¨¡ç³Šçš„æƒ³æ³•ï¼Œç”šè‡³æ„Ÿè§‰æ— ä»ä¸‹ç¬”ã€‚<br>æˆ‘ä»¬æ˜¯æ— æ³•åšåˆ°ä¸€ä¸‹å­å°±å°†æ€æƒ³ç»„æˆé‡‘å­—å¡”ï¼Œå› æ­¤æˆ‘ä»¬å…ˆå¿…é¡»æ¢³ç†ä½ æƒ³è¦è¡¨è¾¾çš„æ€æƒ³ã€‚</p>
<blockquote>
<h3 id="é‡‘å­—å¡”ä¸­çš„å­—ç»“æ„"><a href="#é‡‘å­—å¡”ä¸­çš„å­—ç»“æ„" class="headerlink" title="é‡‘å­—å¡”ä¸­çš„å­—ç»“æ„"></a>é‡‘å­—å¡”ä¸­çš„å­—ç»“æ„</h3><p>é‡‘å­—å¡”ä¸­çš„å­—ç»“æ„èƒ½å¤ŸåŠ å¿«ä½ æ¢³ç†æ€æƒ³çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>ä¸»é¢˜ä¸å­ä¸»é¢˜ä¹‹é—´çš„çºµå‘å…³ç³»</li>
<li>å„å­ä¸»é¢˜ä¹‹é—´çš„æ¨ªå‘å…³ç³»</li>
<li>åºè¨€çš„å™è¿°æ–¹å¼</li>
</ul>
</blockquote>
<h2 id="2-1-çºµå‘å…³ç³»"><a href="#2-1-çºµå‘å…³ç³»" class="headerlink" title="2.1 çºµå‘å…³ç³»"></a>2.1 çºµå‘å…³ç³»</h2><p>æ–‡ç« ä¸­çš„å¤§ä¸»é¢˜ä¸‹çš„æ€æƒ³éƒ½åŒæ—¶ä¸æ–‡ç« ä¸­çš„å…¶å®ƒæ€æƒ³å‘ç”Ÿæˆçºµå‘æˆ–æ¨ªå‘çš„è”ç³»ã€‚çºµå‘å…³ç³»èƒ½å¤Ÿå¾ˆå¥½çš„å¸å¼•è¯»è€…æ³¨æ„åŠ›ï¼Œé€šè¿‡çºµå‘å…³ç³»å¯ä»¥å¼•å¯¼ä¸€ç§ç–‘é—®&#x2F;å›ç­”å¼çš„å¯¹è¯ï¼Œä»è€Œä½¿è¯»è€…å¸¦ç€æå¤§çš„å…´è¶£äº†è§£ä½ çš„æ€è·¯è¿›å±•ã€‚<br><img src="/2022/08/20/book/jin-zi-ta-yuan-li/%E7%BA%B5%E5%90%91%E5%85%B3%E7%B3%BB%E6%A1%88%E4%BE%8B.png" alt="é‡‘å­—å¡”çºµå‘å…³ç³»æ¡ˆä¾‹"></p>
<center>çºµå‘å…³ç³»æ¡ˆä¾‹â€”â€”â€”â€”å…·æœ‰ç–‘é—®/å›ç­”å¼å¯¹è¯ç»“æ„</center>
é‡‘å­—å¡”ç»“æ„å·¨å¤§çš„ä»·å€¼åœ¨äºè¿«ä½¿ä½ åœ¨ç†æ¸…æ€è·¯æ—¶ï¼Œä»è§†è§‰ä¸Šä½¿ç”¨çºµå‘çš„ç–‘é—®/å›ç­”å¼å¯¹è¯å…³ç³»æ¸…æ™°åŒ–ã€‚æ¯ä¸€ä¸ªè¡¨è¿°éƒ½åº”å½“å¼•èµ·è¯»è€…çš„ç–‘é—®ï¼Œè€Œä½ ä¹Ÿå¿…é¡»åœ¨è¿™ä¸€è¡¨è¿°ä¸‹çš„æ¨ªå‘ç»“æ„å±‚æ¬¡ä¸Šé€ä¸ªå›ç­”è¯»è€…çš„ç–‘é—®ã€‚

<h2 id="2-2-æ¨ªå‘å…³ç³»"><a href="#2-2-æ¨ªå‘å…³ç³»" class="headerlink" title="2.2 æ¨ªå‘å…³ç³»"></a>2.2 æ¨ªå‘å…³ç³»</h2><p>åœ¨è€ƒè™‘ä¸‹ä¸€ç»“æ„å±‚æ¬¡å¦‚ä½•è¡¨è¿°æ—¶ï¼Œå¿…é¡»ä¿è¯ä½ çš„è¡¨è¿°èƒ½å¤Ÿå›ç­”åœ¨å…¶ä¸Šä¸€å±‚æ¬¡ä¸Šçš„è¡¨è¿°å¼•èµ·çš„ç–‘é—®ï¼ŒåŒæ—¶ä¿è¯è¡¨è¿°å¿…é¡»ç¬¦åˆé€»è¾‘ã€‚æ‰€ä»¥è¡¨è¿°å¿…é¡»å…·æœ‰æ˜ç¡®çš„å½’çº³æˆ–æ¼”ç»å…³ç³»ã€‚</p>
<ul>
<li>æ¼”ç»å…³ç³»ï¼š æ¼”ç»æ€§æ€æƒ³ç»„åˆæ˜¯ç”±å‡ ä¸ªæ‰¿å‰å¯åçš„è®ºè¿°ç»„æˆçš„ã€‚ç¬¬ä¸€ä¸ªæ€æƒ³æ˜¯å¯¹å½“ä»Šä¸–ç•Œä¸ŠæŸç§ç°è±¡çš„è¡¨è¿°ï¼›ç¬¬äºŒä¸ªæ€æƒ³æ˜¯å¯¹è¯¥å¥å­çš„ä¸»è¯­æˆ–è°“è¯­æ‰€åšçš„è¡¨è¿°ï¼›ç¬¬ä¸‰ä¸ªæ€æƒ³åˆ™è¯´æ˜äº†ä»¥ä¸Šä¸¤ç§è¡¨è¿°åŒæ—¶åœ¨ä¸–ç•Œå­˜åœ¨æ—¶æ‰€å…·æœ‰çš„éšå«æ„ä¹‰ã€‚æ¼”ç»å…³ç³»æ¡ˆä¾‹ï¼š<ul>
<li>æ‰€æœ‰çš„äººéƒ½ä¼šæ­»ã€‚</li>
<li>è‹æ ¼æ‹‰åº•æ˜¯ä¸€ä¸ªäººã€‚</li>
<li>å› æ­¤è‹æ ¼æ‹‰åº•ä¼šæ­»ã€‚</li>
</ul>
</li>
<li>å½’çº³å…³ç³»ï¼šå½’çº³æ€§æ€æƒ³ç»„åˆä¸­çš„æ€æƒ³äº’ç›¸å…³è”ï¼Œä½ å¯ä»¥ç”¨åŒä¸€ä¸ªåæ¬¡è¡¨ç¤ºç»„ä¸­æ‰€æœ‰æ€æƒ³ï¼Œå¦‚æ”¯æŒçš„åŸå› ã€è¿”å›çš„åŸå› ã€æ­¥éª¤ã€é—®é¢˜ï¼Œç­‰ç­‰ã€‚å½’çº³å…³ç³»æ¡ˆä¾‹ï¼š<ul>
<li>æ³•å›½å¦å…‹å·²æŠµè¾¾æ³¢å…°è¾¹å¢ƒ</li>
<li>å¾·å›½å¦å…‹å·²æŠµè¾¾æ³¢å…°è¾¹å¢ƒ</li>
<li>ä¿„å›½å¦å…‹å·²æŠµè¾¾æ³¢å…°è¾¹å¢ƒ</li>
</ul>
</li>
</ul>
<p>æé«˜ä¸€ä¸ªæŠ½è±¡å±‚æ¬¡ï¼Œæ ¹æ®ä»¥ä¸Šæ¡ˆä¾‹çš„å…±åŒç‚¹ï¼Œå¯ä»¥å¾—å‡ºä¸€ä¸ªæ¨è®ºï¼šâ€œæ³¢å…°å°†å—åˆ°å¦å…‹å…¥ä¾µâ€æˆ–ç±»ä¼¼çš„æ€æƒ³ã€‚</p>
<h1 id="ä¸‰ã€å¦‚ä½•æ„å»ºé‡‘å­—å¡”"><a href="#ä¸‰ã€å¦‚ä½•æ„å»ºé‡‘å­—å¡”" class="headerlink" title="ä¸‰ã€å¦‚ä½•æ„å»ºé‡‘å­—å¡”"></a>ä¸‰ã€å¦‚ä½•æ„å»ºé‡‘å­—å¡”</h1><p>å¯ä»¥é€šè¿‡è‡ªä¸Šè€Œä¸‹æˆ–è‡ªä¸‹è€Œä¸Šåœ°æ„å»ºæ–‡ç« çš„é‡‘å­—å¡”ç»“æ„ï¼Œè‡ªä¸Šè€Œä¸‹çš„æ–¹æ³•é€šå¸¸æ¯”è‡ªä¸‹è€Œä¸Šçš„æ–¹æ³•æ›´å®¹æ˜“ã€‚</p>
<h2 id="3-1-è‡ªä¸Šè€Œä¸‹æ³•"><a href="#3-1-è‡ªä¸Šè€Œä¸‹æ³•" class="headerlink" title="3.1 è‡ªä¸Šè€Œä¸‹æ³•"></a>3.1 è‡ªä¸Šè€Œä¸‹æ³•</h2><h3 id="è‡ªä¸Šè€Œä¸‹æ³•æ„å»ºé‡‘å­—å¡”çš„æ­¥éª¤ï¼š"><a href="#è‡ªä¸Šè€Œä¸‹æ³•æ„å»ºé‡‘å­—å¡”çš„æ­¥éª¤ï¼š" class="headerlink" title="è‡ªä¸Šè€Œä¸‹æ³•æ„å»ºé‡‘å­—å¡”çš„æ­¥éª¤ï¼š"></a>è‡ªä¸Šè€Œä¸‹æ³•æ„å»ºé‡‘å­—å¡”çš„æ­¥éª¤ï¼š</h3><ul>
<li>æå‡ºä¸»é¢˜æ€æƒ³</li>
<li>è®¾æƒ³å—ä¼—çš„ä¸»è¦ç–‘é—®</li>
<li>å†™åºè¨€ï¼šèƒŒæ™¯-å†²çªâ€”â€”ç–‘é—®-å›ç­”ã€‚</li>
<li>ä¸å—ä¼—è¿›è¡Œç–‘é—®&#x2F;å›ç­”å¼å¯¹è¯</li>
<li>å¯¹å—ä¼—çš„æ–°ç–‘é—®ï¼Œé‡å¤è¿›è¡Œç–‘é—®&#x2F;å›ç­”å¼å¯¹è¯ã€‚</li>
</ul>
<h2 id="3-2-è‡ªä¸‹è€Œä¸Šæ³•"><a href="#3-2-è‡ªä¸‹è€Œä¸Šæ³•" class="headerlink" title="3.2 è‡ªä¸‹è€Œä¸Šæ³•"></a>3.2 è‡ªä¸‹è€Œä¸Šæ³•</h2><h3 id="è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼š"><a href="#è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼š" class="headerlink" title="è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼š"></a>è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼š</h3><ul>
<li>åˆ—å‡ºä½ æƒ³è¡¨è¾¾çš„æ‰€æœ‰æ€æƒ³è¦ç‚¹ã€‚</li>
<li>æ‰¾å‡ºå„è¦ç‚¹ä¹‹é—´çš„é€»è¾‘å…³ç³»ã€‚</li>
<li>å¾—å‡ºç»“è®ºã€‚</li>
</ul>
<h2 id="3-3-åˆå­¦è€…æ³¨æ„äº‹é¡¹"><a href="#3-3-åˆå­¦è€…æ³¨æ„äº‹é¡¹" class="headerlink" title="3.3 åˆå­¦è€…æ³¨æ„äº‹é¡¹"></a>3.3 åˆå­¦è€…æ³¨æ„äº‹é¡¹</h2><ul>
<li>ä¸€å®šå…ˆæ­ç»“æ„ï¼Œå…ˆå°è¯•è‡ªä¸Šè€Œä¸‹æ³•</li>
<li>åºè¨€å…ˆå†™èƒŒæ™¯ï¼Œå°†èƒŒæ™¯ä½œä¸ºåºè¨€çš„èµ·ç‚¹</li>
<li>å…ˆå¤šèŠ±æ—¶é—´æ€è€ƒåºè¨€ï¼Œä¸è¦çœç•¥</li>
<li>å°†å†å²èƒŒæ™¯æ”¾åœ¨åºè¨€ä¸­</li>
<li>åºè¨€ä»…è®¾è®¡è¯»è€…ä¸ä¼šå¯¹å…¶çœŸå®æ€§æå‡ºè´¨ç–‘çš„å†…å®¹</li>
<li>åœ¨å…³é”®å¥å±‚æ¬¡ä¸Šï¼Œæ›´å®œé€‰æ‹©è§„åˆ’æ¨ç†æ³•è€Œéæ¼”ç»æ¨ç†æ³•ï¼ˆå½’çº³æ³•æ›´å®¹æ˜“è¢«äººç†è§£ï¼‰</li>
</ul>
<h1 id="å››ã€åºè¨€çš„å…·ä½“å†™æ³•"><a href="#å››ã€åºè¨€çš„å…·ä½“å†™æ³•" class="headerlink" title="å››ã€åºè¨€çš„å…·ä½“å†™æ³•"></a>å››ã€åºè¨€çš„å…·ä½“å†™æ³•</h1><p>æ–‡ç« çš„åºè¨€ï¼ˆå‰è¨€ã€å¼•è¨€ã€å¯¼è¨€ï¼‰æ¦‚è¿°è¯»è€…å·²çŸ¥çš„ä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¸æ–‡ç« å°†è¦å›ç­”çš„ç–‘é—®å»ºç«‹è”ç³»ï¼Œç„¶åä½œè€…å°±å¯ä»¥å°†å…¨éƒ¨ç²¾åŠ›æ”¾åœ¨è§£ç­”ç–‘é—®ä¸Šã€‚æ–‡ç« çš„åºè¨€å¿…é¡»ç”¨è®²æ•…äº‹çš„ç»“æ„ï¼Œå…ˆä»‹ç»èƒŒæ™¯ï¼Œå†è¯´æ˜å†²çªï¼Œç”±æ­¤å¼•å‘è¯»è€…çš„ç–‘é—®ï¼Œç„¶åé’ˆå¯¹è¯¥â€œç–‘é—®â€ç»™å‡ºâ€œç­”æ¡ˆâ€ã€‚</p>
<blockquote>
<p>åºè¨€è¦ç”¨è®²æ•…äº‹çš„å½¢å¼ï¼Œæ˜¯ä¸ºäº†è®©è¯»è€…æŠ›å¼€å¤æ‚çš„æ€æƒ³ï¼Œä¸“æ³¨äºä½ çš„è¯é¢˜ã€‚æ¿€å‘è¯»è€…å…´è¶£ï¼Œå¸å¼•æ³¨æ„åŠ›ï¼šæ–°å¥‡ã€æ‚¬å¿µã€ä¸è¯»è€…æœ¬äººç›¸å…³ã€‚</p>
</blockquote>
<h2 id="4-1-å¸¸è§çš„4ç§ç–‘é—®å½¢å¼"><a href="#4-1-å¸¸è§çš„4ç§ç–‘é—®å½¢å¼" class="headerlink" title="4.1 å¸¸è§çš„4ç§ç–‘é—®å½¢å¼"></a>4.1 å¸¸è§çš„4ç§ç–‘é—®å½¢å¼</h2><table>
<thead>
<tr>
<th>èƒŒæ™¯ï¼ˆå…³äºæ–‡ç« ä¸»é¢˜çš„å…¬è®¤äº‹å®ï¼‰</th>
<th>å†²çªï¼ˆæ¨åŠ¨æƒ…èŠ‚å‘å±•å¹¶å¼•å‘è¯»è€…æå‡ºç–‘é—®çš„å› ç´ ï¼‰</th>
<th>è¯»è€…çš„ç–‘é—®</th>
</tr>
</thead>
<tbody><tr>
<td>éœ€è¦å®ŒæˆæŸé¡¹ä»»åŠ¡</td>
<td>å‘ç”Ÿäº†å¦¨ç¢å®Œæˆè¯¥ä»»åŠ¡çš„äº‹æƒ…</td>
<td>æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿ</td>
</tr>
<tr>
<td>å­˜åœ¨æŸä¸ªé—®é¢˜</td>
<td>çŸ¥é“è§£å†³é—®é¢˜çš„æ–¹æ¡ˆ</td>
<td>å¦‚ä½•å®æ–½è§£å†³æ–¹æ¡ˆï¼Ÿ</td>
</tr>
<tr>
<td>å­˜åœ¨æŸä¸ªé—®é¢˜</td>
<td>æœ‰äººæå‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ</td>
<td>æ”¹æ–¹æ¡ˆæ˜¯å¦æ­£ç¡®ï¼Ÿ</td>
</tr>
<tr>
<td>é‡‡å–äº†æŸé¡¹è¡ŒåŠ¨</td>
<td>è¡ŒåŠ¨æœªè¾¾åˆ°é¢„æœŸæ•ˆæœ</td>
<td>ä¸ºä»€ä¹ˆæ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœï¼Ÿ</td>
</tr>
</tbody></table>
<h2 id="4-2-å¸¸è§åºè¨€ç»“æ„é¡ºåº"><a href="#4-2-å¸¸è§åºè¨€ç»“æ„é¡ºåº" class="headerlink" title="4.2 å¸¸è§åºè¨€ç»“æ„é¡ºåº"></a>4.2 å¸¸è§åºè¨€ç»“æ„é¡ºåº</h2><p>åºè¨€å¿…é¡»é‡‡ç”¨â€œèƒŒæ™¯-å†²çª-ç–‘é—®-è§£å†³æ–¹æ¡ˆâ€çš„ç»“æ„ï¼Œä½†æ˜¯å„éƒ¨åˆ†çš„é¢é¡ºåºå¯ä»¥æœ‰æ‰€å˜åŒ–ã€‚</p>
<ul>
<li>æ ‡å‡†å¼ï¼šèƒŒæ™¯â€”â€”å†²çªâ€”â€”ç­”æ¡ˆ</li>
<li>å¼€é—¨è§å±±å¼ï¼š ç­”æ¡ˆâ€”â€”èƒŒæ™¯â€”â€”å†²çª</li>
<li>çªå‡ºå¿§è™‘å¼ï¼šå†²çªâ€”â€”èƒŒæ™¯â€”â€”ç­”æ¡ˆ</li>
<li>çªå‡ºä¿¡å¿ƒå¼ï¼šç–‘é—®â€”â€”èƒŒæ™¯â€”â€”å†²çªâ€”â€”ç­”æ¡ˆ</li>
</ul>
<h2 id="4-3-å…³é”®å¥è¦ç‚¹"><a href="#4-3-å…³é”®å¥è¦ç‚¹" class="headerlink" title="4.3 å…³é”®å¥è¦ç‚¹"></a>4.3 å…³é”®å¥è¦ç‚¹</h2><p>å…³é”®å¥è¦ç‚¹ï¼ˆæˆ–ç§°è¦ç‚¹ã€æ ¸å¿ƒè§‚ç‚¹ã€ä¸€çº§ç»“è®ºã€ä¸€çº§è®ºç‚¹ã€é‡è¦ç»“è®ºï¼‰ï¼Œä¸ä»…è¦ä¼šå‘ç”±æ–‡ç« ä¸»é¢˜å¼•èµ·çš„å—ä¼—çš„ç–‘é—®ï¼Œè¿˜è¦å‘ˆç°æ–‡ç« çš„æ¡†æ¶ç»“æ„ã€‚<br>åˆ—å‡ºå…³é”®å¥è¦ç‚¹å¯ä»¥è®©è¯»è€…åœ¨å¼€å§‹é˜…è¯»çš„æœ€åˆ30ç§’å°±èƒ½äº†è§£ä½ çš„å…¨éƒ¨æ€è·¯ã€‚</p>
<h2 id="4-4-åºè¨€çš„å¸¸è§æ¨¡å¼"><a href="#4-4-åºè¨€çš„å¸¸è§æ¨¡å¼" class="headerlink" title="4.4 åºè¨€çš„å¸¸è§æ¨¡å¼"></a>4.4 åºè¨€çš„å¸¸è§æ¨¡å¼</h2><ul>
<li>å‘å‡ºæŒ‡ç¤ºå¼</li>
<li>è¯·æ±‚æ”¯æŒå¼</li>
<li>è§£é‡Šåšæ³•å¼</li>
<li>æ¯”è¾ƒé€‰æ‹©å¼</li>
</ul>
<h2 id="4-5-åºè¨€4è¦ç´ SCQA"><a href="#4-5-åºè¨€4è¦ç´ SCQA" class="headerlink" title="4.5 åºè¨€4è¦ç´ SCQA"></a>4.5 åºè¨€4è¦ç´ SCQA</h2><ul>
<li>ä»‹ç»èƒŒæ™¯ï¼ˆSï¼ŒSituationï¼‰</li>
<li>æŒ‡å‡ºå†²çªï¼ˆCï¼ŒComplicationï¼‰</li>
<li>å¼•å‘ç–‘é—®ï¼ˆQï¼Œ Questionï¼‰</li>
<li>ç»™å‡ºç­”æ¡ˆï¼ˆAï¼ŒAnswerï¼‰</li>
</ul>
<h1 id="äº”ã€æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†"><a href="#äº”ã€æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†" class="headerlink" title="äº”ã€æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†"></a>äº”ã€æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†</h1><h2 id="5-1-æ¼”ç»æ¨ç†çš„3ä¸ªæ­¥éª¤"><a href="#5-1-æ¼”ç»æ¨ç†çš„3ä¸ªæ­¥éª¤" class="headerlink" title="5.1 æ¼”ç»æ¨ç†çš„3ä¸ªæ­¥éª¤"></a>5.1 æ¼”ç»æ¨ç†çš„3ä¸ªæ­¥éª¤</h2><ul>
<li>å‡ºç°çš„é—®é¢˜æˆ–å­˜åœ¨ç°è±¡</li>
<li>äº§ç”Ÿé—®é¢˜çš„æ ¹æºã€åŸå› </li>
<li>è§£å†³é—®é¢˜çš„æ–¹æ¡ˆ</li>
</ul>
<blockquote>
<p>æ¼”ç»æ¨ç†å¦‚æœéå¸¸ç®€å•ç›´æ¥ï¼Œåˆ™ç”¨æ¼”ç»æ¨ç†ã€‚é‡‘å­—å¡”ç»“æ„çš„å…³é”®å¥å±‚æ¬¡å°½é‡ç”¨å½’çº³æ³•ç»„ç»‡ï¼Œå°†æ¼”ç»æ¨ç†æ”¾åœ¨é‡‘å­—å¡”ç»“æ„ä¸­è¾ƒä½çš„å±‚æ¬¡ä¸Šï¼Œå‡å°‘æ¨ç†è¿‡ç¨‹ä¸­æ’å…¥å…¶å®ƒå¹²æ‰°ä¿¡æ¯ã€‚<br>æŸä¸ªæ®µè½ä¸­ä½¿ç”¨æ¼”ç»æ³•å¼åˆé€‚çš„ï¼Œè¯»è€…ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚ä½†æ˜¯åœ¨è¾ƒé«˜çš„å±‚æ¬¡ä¸Šï¼Œå½’çº³æ³•æ€»æ˜¯æ¯”æ¼”ç»æ³•æ›´å®¹æ˜“ç†è§£ã€‚</p>
</blockquote>
<h2 id="5-2-å½’çº³æ¨ç†çš„2ä¸ªæ­¥éª¤"><a href="#5-2-å½’çº³æ¨ç†çš„2ä¸ªæ­¥éª¤" class="headerlink" title="5.2 å½’çº³æ¨ç†çš„2ä¸ªæ­¥éª¤"></a>5.2 å½’çº³æ¨ç†çš„2ä¸ªæ­¥éª¤</h2><ul>
<li>æ­£ç¡®å®šä¹‰è¯¥ç»„æ€æƒ³ï¼Œæ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿè¡¨ç¤ºè¯¥ç»„æ‰€æœ‰æ€æƒ³å…±åŒç‚¹çš„åè¯ã€‚</li>
<li>æ¯”åˆ«å¹¶å‰”é™¤è¯¥ç»„æ€æƒ³ä¸­ä¸å…¶å®ƒæ€æƒ³ä¸ç›¸ç§°çš„æ€æƒ³ã€‚</li>
</ul>
<h2 id="5-3-æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†çš„åŒºåˆ«ï¼š"><a href="#5-3-æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†çš„åŒºåˆ«ï¼š" class="headerlink" title="5.3 æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†çš„åŒºåˆ«ï¼š"></a>5.3 æ¼”ç»æ¨ç†ä¸å½’çº³æ¨ç†çš„åŒºåˆ«ï¼š</h2><ul>
<li>æ¼”ç»æ¨ç†ï¼šç¬¬äºŒç‚¹æ˜¯å¯¹ç¬¬ä¸€ç‚¹ä¸»è¯­æˆ–è°“è¯­çš„è®ºè¿°ã€‚</li>
<li>å½’çº³æ¨ç†ï¼š åŒç»„ä¸­çš„æ€æƒ³å…·æœ‰ç±»ä¼¼çš„ä¸»è¯­æˆ–è°“è¯­ã€‚</li>
</ul>
<center><h1>ç¬¬2ç¯‡ï¼šæ€è€ƒçš„é€»è¾‘</h1></center>

<h1 id="å…­ã€åº”ç”¨é€»è¾‘é¡ºåº"><a href="#å…­ã€åº”ç”¨é€»è¾‘é¡ºåº" class="headerlink" title="å…­ã€åº”ç”¨é€»è¾‘é¡ºåº"></a>å…­ã€åº”ç”¨é€»è¾‘é¡ºåº</h1><p>åœ¨å½’çº³æ€§çš„æ€æƒ³ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æŒæ¡é€‰æ‹©é€»è¾‘çš„é¡ºåºã€‚</p>
<h2 id="6-1-ä¸‰ç§é€»è¾‘é¡ºåº"><a href="#6-1-ä¸‰ç§é€»è¾‘é¡ºåº" class="headerlink" title="6.1 ä¸‰ç§é€»è¾‘é¡ºåº"></a>6.1 ä¸‰ç§é€»è¾‘é¡ºåº</h2><ul>
<li>æ—¶é—´é¡ºåºï¼šæŒ‰ç…§é‡‡å–è¡ŒåŠ¨çš„é¡ºåºï¼ˆç¬¬ä¸€æ­¥ã€ç¬¬äºŒæ­¥ã€ç¬¬ä¸‰æ­¥ï¼‰ä¾æ¬¡è¡¨è¿°è¾¾åˆ°æŸä¸€ç»“æœå¿…é¡»é‡‡å–çš„è¡ŒåŠ¨ã€‚</li>
<li>ç»“æ„é¡ºåºï¼šä½¿ç”¨ç¤ºæ„å›¾ã€åœ°å›¾ã€å›¾ç”»æˆ–ç…§ç‰‡æƒ³è±¡æŸäº‹ç‰©æ—¶çš„é¡ºåºï¼Œå¦‚ç»„ç»‡ç»“æ„å›¾ã€å…³é”®æˆåŠŸè¦ç´ ç¤ºæ„å›¾ç­‰ã€‚</li>
<li>é‡è¦æ€§é¡ºåºï¼šæ˜ç¡®æŒ‡æ˜æ¯ç»„çš„æ€æƒ³å…·æœ‰å…±åŒç‰¹æ€§ï¼Œç¡®ä¿å°†æ‰€æœ‰å…·æœ‰è¯¥ç‰¹æ€§çš„æ€æƒ³åˆ—å…¥è¯¥ç»„ã€‚åœ¨æ¯ç»„ä¸­ï¼Œæ ¹æ®å„ä¸ªé—®é¢˜æ‰€å…·æœ‰ç‰¹æ€§çš„å¼ºå¼±ã€ä¸»æ¬¡é¡ºåºè¿›è¡Œæ’åºã€‚</li>
</ul>
<h2 id="6-2-MECEåŸåˆ™"><a href="#6-2-MECEåŸåˆ™" class="headerlink" title="6.2 MECEåŸåˆ™"></a>6.2 MECEåŸåˆ™</h2><p>åˆ†ç»„çš„MECEåŸåˆ™ä¿è¯åˆ’åˆ†åçš„å„éƒ¨åˆ†ç¬¦åˆä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>å„éƒ¨åˆ†ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ˆmutually exclusiveï¼‰ï¼Œç›¸äº’æ’æ–¥ï¼Œæ²¡æœ‰é‡å ã€‚</li>
<li>æ‰€æœ‰éƒ¨åˆ†å®Œå…¨ç©·å°½ï¼ˆcollectively exhaustiveï¼‰ï¼Œæ²¡æœ‰é—æ¼ã€‚</li>
</ul>
<h1 id="ä¸ƒã€æ¦‚æ‹¬å„ç»„æ€æƒ³"><a href="#ä¸ƒã€æ¦‚æ‹¬å„ç»„æ€æƒ³" class="headerlink" title="ä¸ƒã€æ¦‚æ‹¬å„ç»„æ€æƒ³"></a>ä¸ƒã€æ¦‚æ‹¬å„ç»„æ€æƒ³</h1><p>é‡‘å­—å¡”åŸç†çš„è§„åˆ™ï¼šä½äºé‡‘å­—å¡”ç»“æ„æ¯ä¸€ä¸ªå±‚æ¬¡ä¸Šçš„æ€æƒ³ï¼Œéƒ½å¿…é¡»æ˜¯å¯¹ä¸‹é¢ä¸€ä¸ªå±‚æ¬¡æ€æƒ³çš„æç‚¼ã€æ¦‚æ‹¬ï¼Œ</p>
<h2 id="7-1-æ¦‚æ‹¬å„ç»„æ€æƒ³çš„æ–¹æ³•"><a href="#7-1-æ¦‚æ‹¬å„ç»„æ€æƒ³çš„æ–¹æ³•" class="headerlink" title="7.1 æ¦‚æ‹¬å„ç»„æ€æƒ³çš„æ–¹æ³•"></a>7.1 æ¦‚æ‹¬å„ç»„æ€æƒ³çš„æ–¹æ³•</h2><ul>
<li>æ€»ç»“å¥é¿å…ä½¿ç”¨â€œç¼ºä¹æ€æƒ³â€çš„å¥å­</li>
<li>æ€»ç»“å¥è¦è¯´æ˜è¡ŒåŠ¨äº§ç”Ÿçš„ç»“æœ&#x2F;ç›®æ ‡</li>
<li>æ€»ç»“å¥è¦ä½¿ç”¨æ˜ç¡®çš„è¯æ±‡&#x2F;è¯­å¥</li>
<li>åŒºåˆ†è¡ŒåŠ¨æ­¥éª¤çš„å±‚æ¬¡</li>
<li>ç›´æ¥æ¦‚æ‹¬è¡ŒåŠ¨çš„ç»“æœ</li>
<li>æ‰¾å‡ºå„ç»“è®ºä¹‹é—´çš„å…±æ€§</li>
<li>æ‰¾å‡ºç»“æ„ä¸Šçš„å…±æ€§</li>
<li>å¯»æ‰¾æ›´å¯†åˆ‡çš„å…³ç³»</li>
<li>å®Œæˆæç‚¼æ€»ç»“æ¦‚æ‹¬çš„å®Œæˆæ€è€ƒè¿‡ç¨‹</li>
</ul>
<center><h1>ç¬¬3ç¯‡ï¼šè§£å†³é—®é¢˜çš„é€»è¾‘</h1></center>

<h1 id="å…«ã€ç•Œå®šé—®é¢˜"><a href="#å…«ã€ç•Œå®šé—®é¢˜" class="headerlink" title="å…«ã€ç•Œå®šé—®é¢˜"></a>å…«ã€ç•Œå®šé—®é¢˜</h1><h2 id="8-1-ç•Œå®šé—®é¢˜çš„æ¡†æ¶"><a href="#8-1-ç•Œå®šé—®é¢˜çš„æ¡†æ¶" class="headerlink" title="8.1 ç•Œå®šé—®é¢˜çš„æ¡†æ¶"></a>8.1 ç•Œå®šé—®é¢˜çš„æ¡†æ¶</h2><p>é—®é¢˜æ˜¯æŒ‡ä½ å·²æœ‰çš„ï¼ˆç°çŠ¶ï¼‰ä¸ä½ æƒ³è¦çš„ï¼ˆç›®æ ‡ï¼‰ä¹‹é—´å­˜åœ¨çš„å·®è·ï¼Œè¿™ç§å·®è·æ˜¯è‡ªæŸä¸€èƒŒæ™¯ä¸‹ä¸€ç³»åˆ—ç‰¹å®šæ¡ä»¶ä¸‹äº§ç”Ÿçš„ã€‚äº†è§£é—®é¢˜çš„å‘å±•å†å²å¯¹æˆ‘ä»¬åˆ†æå·®è·éå¸¸é‡è¦ã€‚</p>
<ul>
<li>å±•å¼€è¯´æ˜æ¡†æ¶ä¸­çš„å„è¦ç´ </li>
<li>æŠŠâ€œç•Œå®šçš„é—®é¢˜â€å†™æˆåºè¨€</li>
</ul>
<p>ç•Œå®šé—®é¢˜çš„æ¡†æ¶æ˜¯è§£å†³é—®é¢˜çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯å»ºç«‹é‡‘å­—å¡”ç»“æ„ã€äº¤æµè§£å†³æ–¹æ¡ˆçš„ç¬¬ä¸€æ­¥ã€‚</p>
<h2 id="8-2-å±•å¼€é—®é¢˜çš„å„è¦ç´ "><a href="#8-2-å±•å¼€é—®é¢˜çš„å„è¦ç´ " class="headerlink" title="8.2 å±•å¼€é—®é¢˜çš„å„è¦ç´ "></a>8.2 å±•å¼€é—®é¢˜çš„å„è¦ç´ </h2><p>ç•Œå®šé—®é¢˜çš„4ä¸ªè¦ç´ ï¼š</p>
<ul>
<li>åˆ‡å…¥ç‚¹&#x2F;åºå¹•ï¼ˆStarting Point&#x2F;Opening Seneï¼‰</li>
<li>å›°æ‰°&#x2F;å›°æƒ‘ï¼ˆDisturbing Eventï¼‰</li>
<li>ç°çŠ¶ï¼ŒéæœŸæœ›ç»“æœï¼ˆR1ï¼Œ Undesired Resultï¼‰</li>
<li>ç›®æ ‡ï¼ŒæœŸæœ›ç»“æœï¼ˆR2ï¼Œ Desired Resultï¼‰</li>
</ul>
<h1 id="ä¹ã€ç»“æ„åŒ–åˆ†æé—®é¢˜"><a href="#ä¹ã€ç»“æ„åŒ–åˆ†æé—®é¢˜" class="headerlink" title="ä¹ã€ç»“æ„åŒ–åˆ†æé—®é¢˜"></a>ä¹ã€ç»“æ„åŒ–åˆ†æé—®é¢˜</h1><p>åˆ†æé—®é¢˜çš„æ ‡å‡†æµç¨‹æ˜¯ï¼š</p>
<blockquote>
<p>æ”¶é›†ä¿¡æ¯ â€”â€”&gt; æè¿°å‘ç° â€”â€”&gt; å¾—å‡ºç»“è®º â€”â€”&gt; æå‡ºæ–¹æ¡ˆ</p>
</blockquote>
<p>ä»ä¿¡æ¯èµ„æ–™å…¥æ‰‹ï¼Œè·å–å®Œæˆæ•°æ®ï¼Œè®¾è®¡è¯Šæ–­æ¡†æ¶è¿›è¡Œåˆ†æã€‚</p>
<h2 id="9-1-è®¾è®¡è¯Šæ–­æ¡†æ¶"><a href="#9-1-è®¾è®¡è¯Šæ–­æ¡†æ¶" class="headerlink" title="9.1 è®¾è®¡è¯Šæ–­æ¡†æ¶"></a>9.1 è®¾è®¡è¯Šæ–­æ¡†æ¶</h2><p>ä½¿ç”¨è¯Šæ–­æ¡†æ¶å¯ä»¥æ­ç¤ºåˆ†æåº”è¯¥å…³æ³¨çš„è¦ç´ æˆ–é¢†åŸŸï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç•Œå®šé—®é¢˜ã€‚</p>
<h2 id="9-2-ç»“æ„åŒ–åˆ†æçš„3ç§æ–¹æ³•"><a href="#9-2-ç»“æ„åŒ–åˆ†æçš„3ç§æ–¹æ³•" class="headerlink" title="9.2 ç»“æ„åŒ–åˆ†æçš„3ç§æ–¹æ³•"></a>9.2 ç»“æ„åŒ–åˆ†æçš„3ç§æ–¹æ³•</h2><ul>
<li>å‘ˆç°æœ‰å½¢çš„ç»“æ„</li>
<li>å¯»æ‰¾å› æœå…³ç³»</li>
<li>å½’ç±»åˆ†ç»„</li>
</ul>
<h2 id="9-3-å»ºç«‹é€»è¾‘æ ‘"><a href="#9-3-å»ºç«‹é€»è¾‘æ ‘" class="headerlink" title="9.3 å»ºç«‹é€»è¾‘æ ‘"></a>9.3 å»ºç«‹é€»è¾‘æ ‘</h2><p> é€»è¾‘æ ‘çš„ä½œç”¨ï¼š</p>
<ul>
<li>å¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼šä»é€»è¾‘ä¸Šæ‰¾å‡ºè§£å†³é—®é¢˜çš„æ–¹æ¡ˆã€‚</li>
<li>å¯»æ‰¾å„ç»„çš„æ€æƒ³ç¼ºé™·ï¼šæ‰¾å‡ºå„ä¸ªç»„çš„è§‚ç‚¹çš„ç¼ºé™·ã€‚</li>
</ul>
<center><h1>ç¬¬4ç¯‡ï¼šæ¼”ç¤ºçš„é€»è¾‘</h1></center>

<h1 id="åã€åœ¨ä¹¦é¢ä¸Šå‘ˆç°é‡‘å­—å¡”"><a href="#åã€åœ¨ä¹¦é¢ä¸Šå‘ˆç°é‡‘å­—å¡”" class="headerlink" title="åã€åœ¨ä¹¦é¢ä¸Šå‘ˆç°é‡‘å­—å¡”"></a>åã€åœ¨ä¹¦é¢ä¸Šå‘ˆç°é‡‘å­—å¡”</h1><p>ç†æƒ³çš„æ–‡ç« ï¼Œåº”è¯¥è®©è¯»è€…åœ¨30ç§’å†…ç†è§£ä½œè€…çš„æ•´ä½“æ€ç»´æ¶æ„ï¼ŒåŒ…æ‹¬åºè¨€ã€ä¸­å¿ƒæ€æƒ³å’Œå…³é”®å¥è¦ç‚¹ã€‚</p>
<h2 id="10-1-çªå‡ºæ˜¾ç¤ºæ–‡ç« çš„æ¡†æ¶ç»“æ„"><a href="#10-1-çªå‡ºæ˜¾ç¤ºæ–‡ç« çš„æ¡†æ¶ç»“æ„" class="headerlink" title="10.1 çªå‡ºæ˜¾ç¤ºæ–‡ç« çš„æ¡†æ¶ç»“æ„"></a>10.1 çªå‡ºæ˜¾ç¤ºæ–‡ç« çš„æ¡†æ¶ç»“æ„</h2><p>é•¿ç¯‡æ–‡ç« åœ¨é¡µé¢ä¸Šå‘ˆç°é‡‘å­—å¡”å±‚çº§çš„å¸¸è§æ–¹æ³•ï¼š</p>
<ul>
<li>å¤šçº§æ ‡é¢˜æ³•</li>
<li>ä¸‹åˆ’çº¿æ³•</li>
<li>æ•°å­—æ ‡å·æ³•</li>
<li>è¡Œé¦–ç¼©è¿›æ³•</li>
<li>é¡¹ç›®ç¬¦å·æ³•</li>
</ul>
<p>æ— è®ºé‡‡ç”¨å“ªç§æ ¼å¼ï¼Œç›®çš„éƒ½æ˜¯ä¾¿äºè¯»è€…ç†è§£æ–‡ç« çš„ä¸»è¦è§‚ç‚¹ï¼Œä»¥åŠæ‰€æœ‰å„ç§ç±»å‹çš„æ”¯æŒæ€§è§‚ç‚¹ã€‚</p>
<h3 id="10-1-1-ä½¿ç”¨æ ‡é¢˜æ³¨æ„ç‚¹"><a href="#10-1-1-ä½¿ç”¨æ ‡é¢˜æ³¨æ„ç‚¹" class="headerlink" title="10.1.1 ä½¿ç”¨æ ‡é¢˜æ³¨æ„ç‚¹"></a>10.1.1 ä½¿ç”¨æ ‡é¢˜æ³¨æ„ç‚¹</h3><ul>
<li>æ¯ä¸€å±‚çº§çš„æ ‡é¢˜ä¸å¯èƒ½åªæœ‰ä¸€ä¸ª</li>
<li>ç›¸åŒçš„æ€æƒ³åº”ä½¿ç”¨ç›¸åŒçš„å¥å‹</li>
<li>æ ‡é¢˜ç”¨è¯åº”æç‚¼æ€æƒ³çš„ç²¾é«“ï¼ˆæ ‡é¢˜çš„ä½œç”¨æ˜¯æç¤ºï¼Œè€Œä¸æ˜¯ç»Ÿé¢†ä¸‹æ–‡ï¼‰</li>
<li>æ ‡é¢˜ä¸æ­£æ–‡åº”åˆ†å¼€è€ƒè™‘ï¼ˆæ ‡é¢˜æ›´å¤šæ˜¯ä¸ºçœ¼çƒè€Œå†™ï¼Œè€Œä¸æ˜¯ä¸ºå¤´è„‘è€Œå†™ï¼‰</li>
<li>æ¯ç»„æ ‡é¢˜åº”æå‰é›†ä¸­ä»‹ç»ï¼ˆåœ¨å¤§æ ‡é¢˜ä¸‹åº”æœ‰ä¸€æ®µè¯ï¼Œé›†ä¸­ä»‹ç»æ ‡é¢˜çš„ä¸»è¦å†…å®¹ï¼‰</li>
<li>ä¸è¦æ»¥ç”¨æ ‡é¢˜</li>
</ul>
<h2 id="10-2-ä¸Šä¸‹æ–‡ä¹‹é—´è¦æœ‰è¿‡æ¸¡"><a href="#10-2-ä¸Šä¸‹æ–‡ä¹‹é—´è¦æœ‰è¿‡æ¸¡" class="headerlink" title="10.2 ä¸Šä¸‹æ–‡ä¹‹é—´è¦æœ‰è¿‡æ¸¡"></a>10.2 ä¸Šä¸‹æ–‡ä¹‹é—´è¦æœ‰è¿‡æ¸¡</h2><p>åœ¨æ¯ä¸€ç« æˆ–èŠ‚çš„å¼€å§‹ï¼Œå¯ä»¥é‡‡ç”¨è®²æ•…äº‹æˆ–æ‰¿ä¸Šå¯ä¸‹çš„æ–¹æ³•åšé“ºå«ã€‚å¸¸ç”¨è¿‡æ¸¡æ–¹å¼ï¼š</p>
<ul>
<li>è®²æ•…äº‹</li>
<li>æ‰¿ä¸Šå¯ä¸‹</li>
<li>æ€»ç»“å„éƒ¨åˆ†å†…å®¹</li>
<li>å¾—å‡ºå®Œæ•´ç»“è®ºè¯´æ˜ä¸‹ä¸€æ­¥è¡ŒåŠ¨</li>
</ul>
<h1 id="åä¸€ã€åœ¨PPTæ¼”ç¤ºæ–‡ç¨¿ä¸­å‘ˆç°é‡‘å­—å¡”"><a href="#åä¸€ã€åœ¨PPTæ¼”ç¤ºæ–‡ç¨¿ä¸­å‘ˆç°é‡‘å­—å¡”" class="headerlink" title="åä¸€ã€åœ¨PPTæ¼”ç¤ºæ–‡ç¨¿ä¸­å‘ˆç°é‡‘å­—å¡”"></a>åä¸€ã€åœ¨PPTæ¼”ç¤ºæ–‡ç¨¿ä¸­å‘ˆç°é‡‘å­—å¡”</h1><p>è®¾è®¡PPTæ¼”ç¤ºæ–‡ç¨¿å¿…é¡»äº†è§£å’ŒæŒæ¡çš„åŸºæœ¬è§„åˆ™ï¼š</p>
<ul>
<li>æ–‡å­—å¹»ç¯ç‰‡åº”åªåŒ…å«æœ€é‡è¦çš„ã€ç»è¿‡é€‚å½“åˆ†ç»„å’Œæ€»ç»“çš„æ€æƒ³ï¼Œå™è¿°æ—¶åº”å°½é‡ç®€æ´ï¼›</li>
<li>æ¼”ç¤ºæ–‡ç¨¿åº”å›¾æ–‡å¹¶èŒ‚ï¼Œä½¿ç”¨å„ç§å›¾è¡¨ç›¸é…åˆï¼›</li>
<li>æ¼”ç¤ºæ–‡ç¨¿åº”å‘ˆç°ç»è¿‡æ·±æ€ç†Ÿè™‘åçš„é¢æ•…äº‹æ¢—æ¦‚å’Œå‰§æœ¬</li>
</ul>
<p>æ¼”ç¤ºæ–‡ç¨¿åŒ…æ‹¬ä¸¤ç±»å¹»ç¯ç‰‡â€”â€”æ–‡å­—å’Œå›¾è¡¨ï¼Œç†æƒ³çš„æ¯”ä¾‹æ˜¯å›¾è¡¨å 90%ï¼Œæ–‡å­—å 10%ï¼Œå…¶å„è‡ªçš„ä½œç”¨ï¼š</p>
<ul>
<li>æ–‡å­—å¹»ç¯ç‰‡ï¼š<ul>
<li>è¯´æ˜æ¼”ç¤ºæ–‡ç¨¿çš„æ¡†æ¶ç»“æ„</li>
<li>å¼ºè°ƒé‡è¦çš„æ€æƒ³ã€è§‚ç‚¹ã€ç»“è®ºã€è®ºç‚¹ã€å»ºè®®æˆ–è¦é‡‡å–çš„æªæ–½ç­‰</li>
</ul>
</li>
<li>å›¾è¡¨å¹»ç¯ç‰‡ï¼š é˜æ˜æ–‡å­—éš¾ä»¥è¯´æ¸…æ¥šçš„æ•°æ®ã€å…³ç³»</li>
</ul>
<h2 id="11-1-è®¾è®¡æ–‡å­—PPTå¹»ç¯ç‰‡"><a href="#11-1-è®¾è®¡æ–‡å­—PPTå¹»ç¯ç‰‡" class="headerlink" title="11.1 è®¾è®¡æ–‡å­—PPTå¹»ç¯ç‰‡"></a>11.1 è®¾è®¡æ–‡å­—PPTå¹»ç¯ç‰‡</h2><h3 id="æ¸…æ¥šä½ è¦è¯´çš„å†…å®¹"><a href="#æ¸…æ¥šä½ è¦è¯´çš„å†…å®¹" class="headerlink" title="æ¸…æ¥šä½ è¦è¯´çš„å†…å®¹"></a>æ¸…æ¥šä½ è¦è¯´çš„å†…å®¹</h3><p>ä¸¾ä¾‹è¯´æ˜å®é™…æ¼”è®²ç¨¿å’Œæ–‡å­—å¹»ç¯ç‰‡çš„å·®åˆ«ï¼Œâ€œå®é™…è®²ç¨¿å¦‚ä¸‹ï¼š</p>
<blockquote>
<h4 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h4><p>æ°å…‹é€Šé£Ÿå“å…¬å¸çš„æœªäº¤è®¢è´§çš„æ•°é‡ä¸€ç›´éå¸¸é«˜ã€‚åœ¨PMGä¸šåŠ¡é¢†åŸŸï¼Œä¸èƒ½å®Œå…¨æŒ‰è®¢å•ä¾›è´§ï¼Œå°†ä¸å¯é¿å…åœ°å¯¼è‡´å¸‚åœºä»½é¢ä¸‹é™ã€‚</p>
<ul>
<li>ç”Ÿäº§é—®é¢˜æ˜¯é€ æˆç›®å‰çŠ¶å†µçš„åŸå› ä¹‹ä¸€ã€‚</li>
<li>ä¾›åº”é“¾æµç¨‹ä¸è¿è´¯å’Œç®¡ç†ä¸å–„ï¼Œä½¿ç”Ÿäº§é—®é¢˜æ›´åŠ å¤æ‚ã€‚</li>
<li>ä¾›åº”é“¾å’Œç”Ÿäº§æµç¨‹ç¼ºä¹ç´§å¯†é…åˆï¼Œéš¾ä»¥è§£å†³æœªäº¤è®¢è´§é—®é¢˜ï¼Œä¹Ÿä¸èƒ½é›†ä¸­ä¿è¯é‡ç‚¹å®¢æˆ·å’Œé‡ç‚¹äº§å“ã€‚</li>
</ul>
</blockquote>
<p>æ–‡å­—å¹»ç¯ç‰‡å¦‚ä¸‹ï¼š</p>
<blockquote>
<h4 id="ç°çŠ¶-1"><a href="#ç°çŠ¶-1" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h4><p>å°šæœªäº¤ä»˜çš„è®¢è´§ç›¸å½“å¤š</p>
<ul>
<li>ç”Ÿäº§å­˜åœ¨é—®é¢˜</li>
<li>ä¾›åº”é“¾æµç¨‹ä¸åˆç†</li>
<li>ç”Ÿäº§&#x2F;ä¾›åº”é“¾ç¼ºä¹é…åˆ</li>
</ul>
</blockquote>
<h3 id="æ¸…æ¥šä½ è¦æ¼”ç¤ºçš„å†…å®¹"><a href="#æ¸…æ¥šä½ è¦æ¼”ç¤ºçš„å†…å®¹" class="headerlink" title="æ¸…æ¥šä½ è¦æ¼”ç¤ºçš„å†…å®¹"></a>æ¸…æ¥šä½ è¦æ¼”ç¤ºçš„å†…å®¹</h3><ul>
<li>æ¯æ¬¡åªæ¼”ç¤ºå’Œè¯´æ˜ä¸€ä¸ªè®ºç‚¹</li>
<li>è®ºç‚¹åº”ä½¿ç”¨å®Œæˆçš„é™ˆè¿°å¥ï¼Œè€Œä¸æ˜¯æ ‡é¢˜æ€§è¯­è¨€</li>
<li>æ–‡å­—å°½é‡ç®€çŸ­</li>
<li>ä½¿ç”¨ç®€å•çš„è¯æ±‡å’Œæ•°å­—</li>
<li>å­—å·åº”è¶³å¤Ÿå¤§</li>
<li>æ³¨æ„å¹»ç¯ç‰‡çš„è¶£å‘³æ€§</li>
<li>ç”¨é€çº§å±•å¼€å‘ˆç°ï¼Œæé«˜è¶£å‘³æ€§</li>
</ul>
<h2 id="11-2-è®¾è®¡å›¾è¡¨PPTå¹»ç¯ç‰‡"><a href="#11-2-è®¾è®¡å›¾è¡¨PPTå¹»ç¯ç‰‡" class="headerlink" title="11.2 è®¾è®¡å›¾è¡¨PPTå¹»ç¯ç‰‡"></a>11.2 è®¾è®¡å›¾è¡¨PPTå¹»ç¯ç‰‡</h2><p>å›¾è¡¨å¹»ç¯ç‰‡é‡‡ç”¨è§†è§‰å…³ç³»å¯ä»¥ç”¨æ¥å‘è§‚ä¼—ä»‹ç»å¤§é‡çš„æ•°æ®å’Œå•å‡­æ–‡å­—æ— æ³•ä¼ è¾¾çš„å¤æ‚å…³ç³»ã€‚å›¾è¡¨å¹»ç¯ç‰‡ä¼ é€’çš„ä¿¡æ¯åº”è¯¥å°½é‡ç®€å•æ˜“æ‡‚ï¼Œå› ä¸ºè§‚ä¼—æ²¡æœ‰å¤ªå¤šæ—¶é—´å’Œæœºä¼šä»”ç»†ç ”ç©¶å„éƒ¨åˆ†çš„å«ä¹‰ã€‚åˆ¶ä½œå›¾è¡¨å¹»ç¯ç‰‡çš„è¯€çªæ˜¯ï¼šç¡®å®šä½ æƒ³ç”¨å›¾è¡¨å›ç­”çš„é—®é¢˜ï¼ŒæŠŠç­”æ¡ˆä½œä¸ºå›¾è¡¨çš„æ ‡é¢˜ï¼Œç„¶åé€‰æ‹©æœ€é€‚åˆçš„å›¾è¡¨æ ·å¼ã€‚</p>
<blockquote>
<p>æ¼”ç¤ºæ˜¯å‚ä¸è€…ç»™äºˆæ¼”è®²è€…çš„ä¸€ç§æ©æƒ â€”â€”ã€Šæ–°æ¼”è®²æœ¯ã€‹</p>
</blockquote>
<h1 id="åäºŒã€åœ¨å­—é‡Œè¡Œé—´å‘ˆç°é‡‘å­—å¡”"><a href="#åäºŒã€åœ¨å­—é‡Œè¡Œé—´å‘ˆç°é‡‘å­—å¡”" class="headerlink" title="åäºŒã€åœ¨å­—é‡Œè¡Œé—´å‘ˆç°é‡‘å­—å¡”"></a>åäºŒã€åœ¨å­—é‡Œè¡Œé—´å‘ˆç°é‡‘å­—å¡”</h1><p>åšåˆ°æ¡ç†æ¸…æ™°éœ€è¦ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆå†³å®šè¦è¯´æ˜çš„æ€æƒ³æˆ–è¦è¯æ˜çš„è®ºç‚¹ï¼Œç„¶åç”¨æ–‡å­—è¡¨ç°ã€‚å¦‚ä½•åœ¨æ–‡å­—ä¸­ä½¿ç”¨é‡‘å­—å¡”ç»“æ„å‘¢ï¼Ÿ</p>
<ul>
<li>ç”»è„‘å›¾ï¼ˆåœ¨å¤§è„‘ä¸­ç”»å›¾åƒï¼‰</li>
<li>æŠŠå›¾åƒå¤åˆ¶æˆæ–‡å­—</li>
</ul>
<center><h1>æ€»ç»“</h1></center>
æœ¬ä¹¦æ ¸å¿ƒå†…å®¹åœ¨å‰4ç« ï¼Œä¸»è¦æ˜¯è§£ç­”äº†ä¸¤ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨é‡‘å­—å¡”åŸç†ï¼Ÿä»¥åŠå¦‚ä½•æ„å»ºé‡‘å­—å¡”ï¼Ÿ

<h3 id="1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é‡‘å­—å¡”åŸç†ï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é‡‘å­—å¡”åŸç†ï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é‡‘å­—å¡”åŸç†ï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é‡‘å­—å¡”åŸç†ï¼Ÿ</h3><p>å› ä¸ºäººçš„å¤§è„‘çŸ­æ—¶é—´åªèƒ½è®°ä½7Â±2ä¸ªé¡¹ç›®ï¼Œå¤§è„‘æ¯”è¾ƒå®¹æ˜“è®°ä½3ä¸ªé¡¹ç›®ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°†å†…å®¹åˆ†ç»„å½’ç±»ã€æŠ½è±¡æ¦‚æ‹¬ã€æ€»ç»“å½’çº³ï¼Œæ„å»ºæˆé‡‘å­—å¡”ç»“æ„ï¼Œè®©å—ä¼—æ›´å®¹æ˜“ç†è§£å’Œè®°ä½æˆ‘ä»¬æƒ³è¦è¡¨è¾¾çš„å†…å®¹ã€‚</p>
<h3 id="2-ä»€ä¹ˆæ˜¯é‡‘å­—å¡”åŸç†ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯é‡‘å­—å¡”åŸç†ï¼Ÿ" class="headerlink" title="2. ä»€ä¹ˆæ˜¯é‡‘å­—å¡”åŸç†ï¼Ÿ"></a>2. ä»€ä¹ˆæ˜¯é‡‘å­—å¡”åŸç†ï¼Ÿ</h3><ul>
<li><strong>è‡ªä¸Šè€Œä¸‹è¡¨è¾¾ï¼Œç»“è®ºå…ˆè¡Œ</strong><br>å…ˆæå‡ºæ€»çš„æ¦‚å¿µï¼Œå†åˆ—å‡ºå…·ä½“é¡¹ç›®ï¼Œå³è¦è‡ªä¸Šè€Œä¸‹çš„è¡¨è¾¾æ€æƒ³</li>
<li><strong>è‡ªä¸‹è€Œä¸Šæ€è€ƒï¼Œæ€»ç»“æ¦‚æ‹¬</strong><br>å¦‚æœä¸èƒ½æå‰æ„æ€å¥½é‡‘å­—å¡”çš„ä¸Šå±‚ç»“æ„ï¼Œå¯ä»¥å…ˆä»é‡‘å­—å¡”ç»“æ„çš„æœ€åº•å±‚ï¼Œå¯¹æ¯ä¸€ä¸ªå•ä¸€æ€æƒ³è¿›è¡Œåˆ†ç»„ç„¶ååˆ†æé€»è¾‘å…³ç³»è¿›è¡ŒæŠ½è±¡æ¦‚æ‹¬ï¼Œå½¢æˆé«˜ä¸€å±‚çš„å•ä¸€æ€æƒ³ã€‚</li>
</ul>
<p>æ­¤å¤–åœ¨é‡‘å­—å¡”çš„ä¸Šå±‚ç»“æ„ä¸­æ›´é€‚åˆä½¿ç”¨å½’çº³æ¨ç†ï¼Œåœ¨é‡‘å­—å¡”åº•å±‚èƒ½æ›´é€‚åˆä½¿ç”¨æ¼”ç»æ¨ç†ã€‚</p>
<h3 id="3-ä½¿ç”¨é‡‘å­—å¡”åŸç†èƒ½å¤Ÿè¾¾åˆ°çš„æ²Ÿé€šæ•ˆæœï¼Ÿ"><a href="#3-ä½¿ç”¨é‡‘å­—å¡”åŸç†èƒ½å¤Ÿè¾¾åˆ°çš„æ²Ÿé€šæ•ˆæœï¼Ÿ" class="headerlink" title="3. ä½¿ç”¨é‡‘å­—å¡”åŸç†èƒ½å¤Ÿè¾¾åˆ°çš„æ²Ÿé€šæ•ˆæœï¼Ÿ"></a>3. ä½¿ç”¨é‡‘å­—å¡”åŸç†èƒ½å¤Ÿè¾¾åˆ°çš„æ²Ÿé€šæ•ˆæœï¼Ÿ</h3><p>è§‚ç‚¹é²œæ˜ã€é‡ç‚¹çªå‡ºã€æ€è·¯æ¸…æ™°ã€å±‚æ¬¡åˆ†æ˜ã€ç®€å•æ˜“æ‡‚ï¼Œè®©å—ä¼—æœ‰å…´è¶£ï¼Œèƒ½ç†è§£ï¼Œè®°å¾—ä½ã€‚</p>
<h3 id="4-SCQAåŸåˆ™"><a href="#4-SCQAåŸåˆ™" class="headerlink" title="4. SCQAåŸåˆ™"></a>4. SCQAåŸåˆ™</h3><p>æ–‡ç« çš„åºè¨€å¿…é¡»ç”¨è®²æ•…äº‹çš„ç»“æ„ï¼Œå…ˆä»‹ç»èƒŒæ™¯ï¼Œå†è¯´æ˜å†²çªï¼Œç”±æ­¤å¼•å‘è¯»è€…çš„ç–‘é—®ï¼Œç„¶åé’ˆå¯¹è¯¥â€œç–‘é—®â€ç»™å‡ºâ€œç­”æ¡ˆâ€ã€‚<br>åºè¨€è¦ç”¨è®²æ•…äº‹çš„å½¢å¼ï¼Œæ˜¯ä¸ºäº†è®©è¯»è€…æŠ›å¼€å¤æ‚çš„æ€æƒ³ï¼Œä¸“æ³¨äºä½ çš„è¯é¢˜ã€‚æ¿€å‘è¯»è€…å…´è¶£ï¼Œå¸å¼•æ³¨æ„åŠ›ï¼šæ–°å¥‡ã€æ‚¬å¿µã€ä¸è¯»è€…æœ¬äººç›¸å…³ã€‚<br>SCQAçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»‹ç»èƒŒæ™¯ï¼ˆSï¼ŒSituationï¼‰</li>
<li>æŒ‡å‡ºå†²çªï¼ˆCï¼ŒComplicationï¼‰</li>
<li>å¼•å‘ç–‘é—®ï¼ˆQï¼Œ Questionï¼‰</li>
<li>ç»™å‡ºç­”æ¡ˆï¼ˆAï¼ŒAnswerï¼‰</li>
</ul>
<h3 id="5-MECEåŸåˆ™"><a href="#5-MECEåŸåˆ™" class="headerlink" title="5. MECEåŸåˆ™"></a>5. MECEåŸåˆ™</h3><p>åˆ†ç»„çš„MECEåŸåˆ™ä¿è¯åˆ’åˆ†åçš„å„éƒ¨åˆ†ç¬¦åˆä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>å„éƒ¨åˆ†ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ˆmutually exclusiveï¼‰ï¼Œç›¸äº’æ’æ–¥ï¼Œæ²¡æœ‰é‡å ã€‚</li>
<li>æ‰€æœ‰éƒ¨åˆ†å®Œå…¨ç©·å°½ï¼ˆcollectively exhaustiveï¼‰ï¼Œæ²¡æœ‰é—æ¼ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>book</category>
      </categories>
      <tags>
        <tag>é‡‘å­—å¡”åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</title>
    <url>/2019/10/06/distributed/yi-zhi-xing-ha-xi-suan-fa/</url>
    <content><![CDATA[<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œ</h2><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ˆConsistent Hashingï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³•ï¼Œåœ¨ç§»é™¤æˆ–æ·»åŠ æœåŠ¡å™¨æ—¶ï¼Œèƒ½å¤Ÿå°½å¯èƒ½å°åœ°æ”¹å˜å·²å­˜åœ¨çš„é”®å€¼æ˜ å°„å…³ç³»ã€‚ä¸»è¦åº”ç”¨äºåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œè§£å†³èŠ‚ç‚¹åŠ¨æ€å¢å‡æ—¶çš„æ•°æ®é‡æ–°åˆ†é…é—®é¢˜ã€‚</p>
<h3 id="ä¼ ç»Ÿå“ˆå¸Œçš„é—®é¢˜"><a href="#ä¼ ç»Ÿå“ˆå¸Œçš„é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿå“ˆå¸Œçš„é—®é¢˜"></a>ä¼ ç»Ÿå“ˆå¸Œçš„é—®é¢˜</h3><p>å‡è®¾æœ‰ 3 å°ç¼“å­˜æœåŠ¡å™¨ï¼Œä½¿ç”¨ä¼ ç»Ÿå–æ¨¡æ–¹å¼åˆ†é…æ•°æ®ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> serverIndex <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> serverCount<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å½“æœåŠ¡å™¨æ•°é‡å˜åŒ–æ—¶ï¼š</p>
<ul>
<li><strong>å¢åŠ èŠ‚ç‚¹</strong>ï¼šserverCount ä» 3 å˜ä¸º 4ï¼Œå¤§éƒ¨åˆ†æ•°æ®çš„æ˜ å°„å…³ç³»éƒ½ä¼šæ”¹å˜</li>
<li><strong>åˆ é™¤èŠ‚ç‚¹</strong>ï¼šserverCount ä» 3 å˜ä¸º 2ï¼ŒåŒæ ·å¯¼è‡´å¤§é‡æ•°æ®é‡æ–°åˆ†é…</li>
</ul>
<p>è¿™ä¼šå¯¼è‡´ç¼“å­˜å¤§é¢ç§¯å¤±æ•ˆï¼Œå¼•å‘<strong>ç¼“å­˜é›ªå´©</strong>ã€‚</p>
<h2 id="äºŒã€ä¸€è‡´æ€§å“ˆå¸ŒåŸç†"><a href="#äºŒã€ä¸€è‡´æ€§å“ˆå¸ŒåŸç†" class="headerlink" title="äºŒã€ä¸€è‡´æ€§å“ˆå¸ŒåŸç†"></a>äºŒã€ä¸€è‡´æ€§å“ˆå¸ŒåŸç†</h2><h3 id="2-1-å“ˆå¸Œç¯"><a href="#2-1-å“ˆå¸Œç¯" class="headerlink" title="2.1 å“ˆå¸Œç¯"></a>2.1 å“ˆå¸Œç¯</h3><p>ä¸€è‡´æ€§å“ˆå¸Œå°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼ˆHash Ringï¼‰ï¼ŒèŒƒå›´ä¸º 0 ~ 2^32-1ï¼š</p>
<ol>
<li><strong>æœåŠ¡å™¨èŠ‚ç‚¹æ˜ å°„</strong>ï¼šå¯¹æ¯å°æœåŠ¡å™¨çš„ IP æˆ–ä¸»æœºåè¿›è¡Œå“ˆå¸Œï¼Œæ˜ å°„åˆ°ç¯ä¸Šçš„æŸä¸ªä½ç½®</li>
<li><strong>æ•°æ®æ˜ å°„</strong>ï¼šå¯¹æ•°æ®çš„ key è¿›è¡Œå“ˆå¸Œï¼Œæ˜ å°„åˆ°ç¯ä¸Šçš„æŸä¸ªä½ç½®</li>
<li><strong>æŸ¥æ‰¾è§„åˆ™</strong>ï¼šä»æ•°æ®ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾ï¼Œé‡åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹å³ä¸ºå­˜å‚¨ä½ç½®</li>
</ol>
<h3 id="2-2-èŠ‚ç‚¹å¢å‡çš„å½±å“"><a href="#2-2-èŠ‚ç‚¹å¢å‡çš„å½±å“" class="headerlink" title="2.2 èŠ‚ç‚¹å¢å‡çš„å½±å“"></a>2.2 èŠ‚ç‚¹å¢å‡çš„å½±å“</h3><p><strong>åˆ é™¤èŠ‚ç‚¹</strong>ï¼š</p>
<ul>
<li>åªå½±å“è¯¥èŠ‚ç‚¹åˆ°å…¶å‰ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®</li>
<li>è¿™äº›æ•°æ®ä¼šè¿ç§»åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li>
</ul>
<p><strong>æ·»åŠ èŠ‚ç‚¹</strong>ï¼š</p>
<ul>
<li>åªå½±å“æ–°èŠ‚ç‚¹åˆ°å…¶å‰ä¸€ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®</li>
<li>éƒ¨åˆ†æ•°æ®ä»ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿ç§»åˆ°æ–°èŠ‚ç‚¹</li>
</ul>
<p>ç›¸æ¯”ä¼ ç»Ÿæ–¹å¼ï¼Œæ•°æ®è¿ç§»é‡å¤§å¹…å‡å°‘ã€‚</p>
<h2 id="ä¸‰ã€è™šæ‹ŸèŠ‚ç‚¹"><a href="#ä¸‰ã€è™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="ä¸‰ã€è™šæ‹ŸèŠ‚ç‚¹"></a>ä¸‰ã€è™šæ‹ŸèŠ‚ç‚¹</h2><h3 id="3-1-æ•°æ®å€¾æ–œé—®é¢˜"><a href="#3-1-æ•°æ®å€¾æ–œé—®é¢˜" class="headerlink" title="3.1 æ•°æ®å€¾æ–œé—®é¢˜"></a>3.1 æ•°æ®å€¾æ–œé—®é¢˜</h3><p>å½“æœåŠ¡å™¨èŠ‚ç‚¹è¾ƒå°‘æ—¶ï¼Œå¯èƒ½å‡ºç°æ•°æ®åˆ†å¸ƒä¸å‡çš„æƒ…å†µã€‚ä¾‹å¦‚ 3 å°æœåŠ¡å™¨åœ¨ç¯ä¸Šçš„ä½ç½®å¯èƒ½å¾ˆæ¥è¿‘ï¼Œå¯¼è‡´æŸå°æœåŠ¡å™¨æ‰¿è½½äº†å¤§éƒ¨åˆ†æ•°æ®ã€‚</p>
<h3 id="3-2-è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ–¹æ¡ˆ"><a href="#3-2-è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.2 è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ–¹æ¡ˆ"></a>3.2 è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ–¹æ¡ˆ</h3><p>ä¸ºæ¯å°ç‰©ç†æœåŠ¡å™¨åˆ›å»ºå¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ˆVirtual Nodeï¼‰ï¼Œå‡åŒ€åˆ†å¸ƒåœ¨å“ˆå¸Œç¯ä¸Šï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¸ºæ¯å°æœåŠ¡å™¨åˆ›å»º 150 ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">150</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> virtualNodeName <span class="token operator">=</span> <span class="token string">"Server1#"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">getHash</span><span class="token punctuation">(</span>virtualNodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    virtualNodes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> <span class="token string">"Server1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>è™šæ‹ŸèŠ‚ç‚¹è¶Šå¤šï¼Œæ•°æ®åˆ†å¸ƒè¶Šå‡åŒ€</li>
<li>ä¸€èˆ¬ 100-200 ä¸ªè™šæ‹ŸèŠ‚ç‚¹å³å¯è¾¾åˆ°è‰¯å¥½æ•ˆæœ</li>
</ul>
<h2 id="å››ã€Java-å®ç°"><a href="#å››ã€Java-å®ç°" class="headerlink" title="å››ã€Java å®ç°"></a>å››ã€Java å®ç°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsistentHash</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// è™šæ‹ŸèŠ‚ç‚¹æ•°é‡</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> virtualNodeCount<span class="token punctuation">;</span>
    <span class="token comment">// å“ˆå¸Œç¯</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SortedMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> ring <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ConsistentHash</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtualNodeCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>virtualNodeCount <span class="token operator">=</span> virtualNodeCount<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * æ·»åŠ æœåŠ¡å™¨èŠ‚ç‚¹
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addNode</span><span class="token punctuation">(</span><span class="token class-name">T</span> node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> virtualNodeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> virtualNodeName <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">getHash</span><span class="token punctuation">(</span>virtualNodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ring<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * åˆ é™¤æœåŠ¡å™¨èŠ‚ç‚¹
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token class-name">T</span> node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> virtualNodeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> virtualNodeName <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">getHash</span><span class="token punctuation">(</span>virtualNodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ring<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * è·å–æ•°æ®åº”è¯¥å­˜å‚¨çš„èŠ‚ç‚¹
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ring<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">getHash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é¡ºæ—¶é’ˆæŸ¥æ‰¾ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
        <span class="token class-name">SortedMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> tailMap <span class="token operator">=</span> ring<span class="token punctuation">.</span><span class="token function">tailMap</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå½¢æˆç¯ï¼‰</span>
        <span class="token keyword">int</span> nodeHash <span class="token operator">=</span> tailMap<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> ring<span class="token punctuation">.</span><span class="token function">firstKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> tailMap<span class="token punctuation">.</span><span class="token function">firstKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nodeHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * FNV1_32_HASH ç®—æ³•
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getHash</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">16777619</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token number">2166136261L</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            hash <span class="token operator">=</span> <span class="token punctuation">(</span>hash <span class="token operator">^</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> p<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        hash <span class="token operator">+=</span> hash <span class="token operator">&lt;&lt;</span> <span class="token number">13</span><span class="token punctuation">;</span>
        hash <span class="token operator">^=</span> hash <span class="token operator">>></span> <span class="token number">7</span><span class="token punctuation">;</span>
        hash <span class="token operator">+=</span> hash <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
        hash <span class="token operator">^=</span> hash <span class="token operator">>></span> <span class="token number">17</span><span class="token punctuation">;</span>
        hash <span class="token operator">+=</span> hash <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åˆ›å»ºä¸€è‡´æ€§å“ˆå¸Œï¼Œæ¯ä¸ªèŠ‚ç‚¹ 150 ä¸ªè™šæ‹ŸèŠ‚ç‚¹</span>
<span class="token class-name">ConsistentHash</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> consistentHash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsistentHash</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ·»åŠ æœåŠ¡å™¨èŠ‚ç‚¹</span>
consistentHash<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span><span class="token string">"192.168.1.1:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consistentHash<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span><span class="token string">"192.168.1.2:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consistentHash<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span><span class="token string">"192.168.1.3:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æŸ¥æ‰¾æ•°æ®åº”è¯¥å­˜å‚¨çš„èŠ‚ç‚¹</span>
<span class="token class-name">String</span> server <span class="token operator">=</span> consistentHash<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span><span class="token string">"user:1001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº”è¯¥å­˜å‚¨åœ¨: "</span> <span class="token operator">+</span> server<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ·»åŠ æ–°èŠ‚ç‚¹</span>
consistentHash<span class="token punctuation">.</span><span class="token function">addNode</span><span class="token punctuation">(</span><span class="token string">"192.168.1.4:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ é™¤èŠ‚ç‚¹</span>
consistentHash<span class="token punctuation">.</span><span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token string">"192.168.1.2:8080"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="äº”ã€åº”ç”¨åœºæ™¯"><a href="#äº”ã€åº”ç”¨åœºæ™¯" class="headerlink" title="äº”ã€åº”ç”¨åœºæ™¯"></a>äº”ã€åº”ç”¨åœºæ™¯</h2><h3 id="5-1-åˆ†å¸ƒå¼ç¼“å­˜"><a href="#5-1-åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="5.1 åˆ†å¸ƒå¼ç¼“å­˜"></a>5.1 åˆ†å¸ƒå¼ç¼“å­˜</h3><ul>
<li><strong>Memcached å®¢æˆ·ç«¯</strong>ï¼šä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œåˆ†é…ç¼“å­˜æ•°æ®</li>
<li><strong>Redis Cluster</strong>ï¼šä½¿ç”¨å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰çš„å˜ç§å®ç°</li>
</ul>
<h3 id="5-2-è´Ÿè½½å‡è¡¡"><a href="#5-2-è´Ÿè½½å‡è¡¡" class="headerlink" title="5.2 è´Ÿè½½å‡è¡¡"></a>5.2 è´Ÿè½½å‡è¡¡</h3><ul>
<li><strong>Nginx</strong>ï¼šconsistent hash æ¨¡å—å®ç°ä¼šè¯ç²˜æ»</li>
<li><strong>Dubbo</strong>ï¼šConsistentHashLoadBalance è´Ÿè½½å‡è¡¡ç­–ç•¥</li>
</ul>
<h3 id="5-3-åˆ†å¸ƒå¼å­˜å‚¨"><a href="#5-3-åˆ†å¸ƒå¼å­˜å‚¨" class="headerlink" title="5.3 åˆ†å¸ƒå¼å­˜å‚¨"></a>5.3 åˆ†å¸ƒå¼å­˜å‚¨</h3><ul>
<li><strong>Cassandra</strong>ï¼šä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œåˆ†é…æ•°æ®åˆ°ä¸åŒèŠ‚ç‚¹</li>
<li><strong>DynamoDB</strong>ï¼šåŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„åˆ†åŒºç­–ç•¥</li>
</ul>
<h2 id="å…­ã€ä¼˜ç¼ºç‚¹åˆ†æ"><a href="#å…­ã€ä¼˜ç¼ºç‚¹åˆ†æ" class="headerlink" title="å…­ã€ä¼˜ç¼ºç‚¹åˆ†æ"></a>å…­ã€ä¼˜ç¼ºç‚¹åˆ†æ</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol>
<li><strong>å•è°ƒæ€§</strong>ï¼šèŠ‚ç‚¹å¢å‡æ—¶ï¼Œå·²æœ‰æ˜ å°„å…³ç³»ä¸ä¼šæ”¹å˜ï¼Œåªä¼šå¢åŠ æ–°æ˜ å°„</li>
<li><strong>åˆ†æ•£æ€§</strong>ï¼šæ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Š</li>
<li><strong>å¹³è¡¡æ€§</strong>ï¼šé€šè¿‡è™šæ‹ŸèŠ‚ç‚¹é¿å…æ•°æ®å€¾æ–œ</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ–¹ä¾¿åŠ¨æ€å¢å‡èŠ‚ç‚¹</li>
</ol>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ol>
<li><strong>æ•°æ®å€¾æ–œ</strong>ï¼šèŠ‚ç‚¹è¾ƒå°‘æ—¶å¯èƒ½åˆ†å¸ƒä¸å‡ï¼ˆè™šæ‹ŸèŠ‚ç‚¹å¯è§£å†³ï¼‰</li>
<li><strong>å®ç°å¤æ‚</strong>ï¼šç›¸æ¯”ç®€å•å–æ¨¡æ–¹å¼ï¼Œå®ç°å’Œç»´æŠ¤æˆæœ¬è¾ƒé«˜</li>
<li><strong>è™šæ‹ŸèŠ‚ç‚¹å¼€é”€</strong>ï¼šéœ€è¦ç»´æŠ¤å¤§é‡è™šæ‹ŸèŠ‚ç‚¹</li>
</ol>
<h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•é€šè¿‡å¼•å…¥å“ˆå¸Œç¯å’Œè™šæ‹ŸèŠ‚ç‚¹çš„æ¦‚å¿µï¼Œæœ‰æ•ˆè§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­èŠ‚ç‚¹åŠ¨æ€å¢å‡å¯¼è‡´çš„æ•°æ®å¤§è§„æ¨¡è¿ç§»é—®é¢˜ã€‚åœ¨åˆ†å¸ƒå¼ç¼“å­˜ã€è´Ÿè½½å‡è¡¡ã€åˆ†å¸ƒå¼å­˜å‚¨ç­‰åœºæ™¯ä¸­æœ‰å¹¿æ³›åº”ç”¨ã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ul>
<li>å“ˆå¸Œç¯å°†æ•°æ®å’ŒèŠ‚ç‚¹æ˜ å°„åˆ°åŒä¸€ç©ºé—´</li>
<li>é¡ºæ—¶é’ˆæŸ¥æ‰¾è§„åˆ™ç¡®å®šæ•°æ®å­˜å‚¨ä½ç½®</li>
<li>è™šæ‹ŸèŠ‚ç‚¹ä¿è¯æ•°æ®åˆ†å¸ƒå‡åŒ€</li>
<li>èŠ‚ç‚¹å˜åŒ–æ—¶åªå½±å“ç›¸é‚»èŠ‚ç‚¹çš„æ•°æ®</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>è´Ÿè½½å‡è¡¡</tag>
      </tags>
  </entry>
  <entry>
    <title>å››ç§ç»å…¸çš„é™æµç®—æ³•</title>
    <url>/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/</url>
    <content><![CDATA[<p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ç»å¸¸é‡åˆ°é™æµåœºæ™¯ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»å››ç§ç»å…¸çš„é™æµç®—æ³•ï¼šå›ºå®šçª—å£è®¡æ•°å™¨ã€æ»‘åŠ¨çª—å£è®¡æ•°å™¨ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œåœ¨åšé™æµçš„åœºæ™¯æ—¶å¯ä»¥å€Ÿé‰´è¿™å‡ ç§ç»å…¸çš„é™æµç®—æ³•ï¼ŒæŒæ¡å…¶ä½¿ç”¨åœºæ™¯çº§ä¼˜ç¼ºç‚¹ã€‚</p>
<h1 id="ä¸€ã€å›ºå®šçª—å£è®¡æ•°å™¨ï¼ˆFixed-Windowï¼‰"><a href="#ä¸€ã€å›ºå®šçª—å£è®¡æ•°å™¨ï¼ˆFixed-Windowï¼‰" class="headerlink" title="ä¸€ã€å›ºå®šçª—å£è®¡æ•°å™¨ï¼ˆFixed Windowï¼‰"></a>ä¸€ã€å›ºå®šçª—å£è®¡æ•°å™¨ï¼ˆFixed Windowï¼‰</h1><p>å›ºå®šçª—å£è®¡æ•°å™¨(Fixed Window)ç®—æ³•çš„å®ç°æ€è·¯éå¸¸ç®€å•ï¼Œç»´æŠ¤ä¸€ä¸ªå›ºå®šå•ä½æ—¶é—´å†…çš„è®¡æ•°å™¨ï¼Œå¦‚æœæ£€æµ‹åˆ°å•ä½æ—¶é—´å·²ç»è¿‡å»å°±é‡ç½®è®¡æ•°å™¨ä¸ºé›¶ã€‚è®¡æ•°é™é¦–å…ˆç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå°†å•ä½æ—¶é—´æ®µå½“åšä¸€ä¸ªçª—å£ï¼Œè®¡æ•°å™¨è®°å½•è¿™ä¸ªçª—å£æ¥æ”¶è¯·æ±‚çš„æ¬¡æ•°ã€‚</p>
<ul>
<li>å½“æ¬¡æ•°å°‘äºé™æµé˜€å€¼ï¼Œå°±å…è®¸è®¿é—®ï¼Œå¹¶ä¸”è®¡æ•°å™¨+1</li>
<li>å½“æ¬¡æ•°å¤§äºé™æµé˜€å€¼ï¼Œå°±æ‹’ç»è®¿é—®</li>
<li>å½“å‰çš„æ—¶é—´çª—å£è¿‡å»ä¹‹åï¼Œè®¡æ•°å™¨æ¸…é›¶</li>
</ul>
<p><img src="/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/%E5%9B%BA%E5%AE%9A%E7%AA%97%E5%8F%A3%E8%AE%A1%E6%95%B0%E5%99%A8.png" alt="å›ºå®šçª—å£è®¡æ•°å™¨"></p>
<h1 id="äºŒã€-å›ºå®šçª—å£ç®—æ³•çš„ä¼˜ç¼ºç‚¹"><a href="#äºŒã€-å›ºå®šçª—å£ç®—æ³•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="äºŒã€ å›ºå®šçª—å£ç®—æ³•çš„ä¼˜ç¼ºç‚¹"></a>äºŒã€ å›ºå®šçª—å£ç®—æ³•çš„ä¼˜ç¼ºç‚¹</h1><ul>
<li>ä¼˜ç‚¹ï¼šå›ºå®šçª—å£ç®—æ³•éå¸¸ç®€å•ï¼Œæ˜“äºå®ç°å’Œç†è§£ï¼Œæ€§èƒ½é«˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šå­˜åœ¨<strong>æ˜æ˜¾çš„ä¸´ç•Œé—®é¢˜</strong>ã€‚</li>
</ul>
<h2 id="1-2-ä¸´ç•Œé—®é¢˜"><a href="#1-2-ä¸´ç•Œé—®é¢˜" class="headerlink" title="1.2 ä¸´ç•Œé—®é¢˜"></a>1.2 ä¸´ç•Œé—®é¢˜</h2><p>ä¸´ç•Œé—®é¢˜ï¼šå‡è®¾é™æµé˜€å€¼ä¸º5ä¸ªè¯·æ±‚ï¼Œå•ä½æ—¶é—´çª—å£æ˜¯1s,å¦‚æœæˆ‘ä»¬åœ¨å•ä½æ—¶é—´å†…çš„å‰0.8-1så’Œ1-1.2sï¼Œåˆ†åˆ«å¹¶å‘5ä¸ªè¯·æ±‚ã€‚è™½ç„¶éƒ½æ²¡æœ‰è¶…è¿‡é˜€å€¼ï¼Œä½†æ˜¯å¦‚æœç®—0.8-1.2s,åˆ™å¹¶å‘æ•°é«˜è¾¾10ï¼Œå·²ç»è¶…è¿‡å•ä½æ—¶é—´1sä¸è¶…è¿‡5é˜€å€¼çš„å®šä¹‰ã€‚<br><img src="/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/%E5%9B%BA%E5%AE%9A%E7%AA%97%E5%8F%A3%E4%B8%B4%E7%95%8C%E9%97%AE%E9%A2%98.png" alt="å›ºå®šçª—å£ä¸´ç•Œé—®é¢˜"></p>
<h2 id="2-2-æ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼ˆSliding-Windowï¼‰"><a href="#2-2-æ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼ˆSliding-Windowï¼‰" class="headerlink" title="2.2 æ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼ˆSliding Windowï¼‰"></a>2.2 æ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼ˆSliding Windowï¼‰</h2><blockquote>
<p>æ»‘åŠ¨çª—å£é™æµç®—æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„é™æµç®—æ³•ï¼Œç”¨äºæ§åˆ¶ç³»ç»Ÿå¯¹å¤–æä¾›æœåŠ¡çš„é€Ÿç‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¢«è¿‡å¤šçš„è¯·æ±‚å‹å®ã€‚å®ƒå°†å•ä½æ—¶é—´å‘¨æœŸåˆ†ä¸ºnä¸ªå°å‘¨æœŸï¼Œåˆ†åˆ«è®°å½•æ¯ä¸ªå°å‘¨æœŸå†…æ¥å£çš„è®¿é—®æ¬¡æ•°ï¼Œå¹¶ä¸”æ ¹æ®æ—¶é—´æ»‘åŠ¨åˆ é™¤è¿‡æœŸçš„å°å‘¨æœŸã€‚<strong>å®ƒå¯ä»¥è§£å†³å›ºå®šçª—å£ä¸´ç•Œå€¼çš„é—®é¢˜ã€‚</strong></p>
</blockquote>
<p><img src="/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3.png" alt="æ»‘åŠ¨çª—å£"></p>
<p>å‡è®¾å•ä½æ—¶é—´è¿˜æ˜¯1sï¼Œæ»‘åŠ¨çª—å£ç®—æ³•æŠŠå®ƒåˆ’åˆ†ä¸º5ä¸ªå°å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯æ»‘åŠ¨çª—å£ï¼ˆå•ä½æ—¶é—´ï¼‰è¢«åˆ’åˆ†ä¸º5ä¸ªå°æ ¼å­ã€‚æ¯æ ¼è¡¨ç¤º0.2sã€‚æ¯è¿‡0.2sï¼Œæ—¶é—´çª—å£å°±ä¼šå¾€å³æ»‘åŠ¨ä¸€æ ¼ã€‚æ¯ä¸ªå°å‘¨æœŸï¼Œéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è®¡æ•°å™¨ã€‚</p>
<h2 id="2-1-æ»‘åŠ¨çª—å£é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹"><a href="#2-1-æ»‘åŠ¨çª—å£é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="2.1 æ»‘åŠ¨çª—å£é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹"></a>2.1 æ»‘åŠ¨çª—å£é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>ç®€å•æ˜“æ‡‚</li>
<li>ç²¾åº¦é«˜ï¼ˆé€šè¿‡è°ƒæ•´æ—¶é—´çª—å£çš„å¤§å°æ¥å®ç°ä¸åŒçš„é™æµæ•ˆæœï¼‰</li>
<li>å¯æ‰©å±•æ€§å¼ºï¼ˆå¯ä»¥éå¸¸å®¹æ˜“åœ°ä¸å…¶ä»–é™æµç®—æ³•ç»“åˆä½¿ç”¨ï¼‰</li>
</ul>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>çªå‘æµé‡æ— æ³•å¤„ç†ï¼ˆæ— æ³•åº”å¯¹çŸ­æ—¶é—´å†…çš„å¤§é‡è¯·æ±‚ï¼Œä½†æ˜¯ä¸€æ—¦åˆ°è¾¾é™æµåï¼Œè¯·æ±‚éƒ½ä¼šç›´æ¥æš´åŠ›è¢«æ‹’ç»ã€‚ä¼šæŸå¤±ä¸€éƒ¨åˆ†è¯·æ±‚ï¼Œå¯¹äºäº§å“ä¸å¤ªå‹å¥½ï¼‰ï¼Œéœ€è¦åˆç†è°ƒæ•´æ—¶é—´çª—å£å¤§å°ã€‚</li>
</ul>
<blockquote>
<p>TIPS:å½“æ»‘åŠ¨çª—å£çš„æ ¼å­å‘¨æœŸåˆ’åˆ†çš„è¶Šå¤šï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚</p>
</blockquote>
<h1 id="ä¸‰ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky-Bucketï¼‰"><a href="#ä¸‰ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky-Bucketï¼‰" class="headerlink" title="ä¸‰ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰"></a>ä¸‰ã€æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰</h1><p>æ¼æ¡¶é™æµç®—æ³•ï¼ˆLeaky Bucket Algorithmï¼‰æ˜¯ä¸€ç§æµé‡æ§åˆ¶ç®—æ³•ï¼Œç”¨äºæ§åˆ¶æµå…¥ç½‘ç»œçš„æ•°æ®é€Ÿç‡ï¼Œä»¥é˜²æ­¢ç½‘ç»œæ‹¥å¡ã€‚å®ƒçš„æ€æƒ³æ˜¯å°†æ•°æ®åŒ…çœ‹ä½œæ˜¯æ°´æ»´ï¼Œæ¼æ¡¶çœ‹ä½œæ˜¯ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ°´æ¡¶ï¼Œæ•°æ®åŒ…åƒæ°´æ»´ä¸€æ ·ä»æ¡¶çš„é¡¶éƒ¨æµå…¥æ¡¶ä¸­ï¼Œå¹¶é€šè¿‡æ¡¶åº•çš„ä¸€ä¸ªå°å­”ä»¥ä¸€å®šçš„é€Ÿåº¦æµå‡ºï¼Œä»è€Œé™åˆ¶äº†æ•°æ®åŒ…çš„æµé‡ã€‚<br><img src="/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/%E6%BC%8F%E6%A1%B6%E7%AE%97%E6%B3%95.png" alt="æ¼æ¡¶ç®—æ³•"></p>
<p>æ¼æ¡¶é™æµç®—æ³•çš„åŸºæœ¬å·¥ä½œåŸç†æ˜¯ï¼šå¯¹äºæ¯ä¸ªåˆ°æ¥çš„æ•°æ®åŒ…ï¼Œéƒ½å°†å…¶åŠ å…¥åˆ°æ¼æ¡¶ä¸­ï¼Œå¹¶æ£€æŸ¥æ¼æ¡¶ä¸­å½“å‰çš„æ°´é‡æ˜¯å¦è¶…è¿‡äº†æ¼æ¡¶çš„å®¹é‡ã€‚å¦‚æœè¶…è¿‡äº†å®¹é‡ï¼Œå°±å°†å¤šä½™çš„æ•°æ®åŒ…ä¸¢å¼ƒã€‚å¦‚æœæ¼æ¡¶ä¸­è¿˜æœ‰æ°´ï¼Œå°±ä»¥ä¸€å®šçš„é€Ÿç‡ä»æ¡¶åº•è¾“å‡ºæ•°æ®åŒ…ï¼Œä¿è¯è¾“å‡ºçš„é€Ÿç‡ä¸è¶…è¿‡é¢„è®¾çš„é€Ÿç‡ï¼Œä»è€Œè¾¾åˆ°é™æµçš„ç›®çš„ã€‚</p>
<h2 id="3-1-æ¼æ¡¶é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹"><a href="#3-1-æ¼æ¡¶é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3.1 æ¼æ¡¶é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹"></a>3.1 æ¼æ¡¶é™æµç®—æ³•çš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å¯ä»¥å¹³æ»‘é™åˆ¶è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ï¼Œé¿å…ç¬é—´è¯·æ±‚è¿‡å¤šå¯¼è‡´ç³»ç»Ÿå´©æºƒæˆ–è€…é›ªå´©ã€‚</li>
<li>å¯ä»¥æ§åˆ¶è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ï¼Œä½¿å¾—ç³»ç»Ÿå¯ä»¥é€‚åº”ä¸åŒçš„æµé‡éœ€æ±‚ï¼Œé¿å…è¿‡è½½æˆ–è€…è¿‡åº¦é—²ç½®ã€‚</li>
<li>å¯ä»¥é€šè¿‡è°ƒæ•´æ¡¶çš„å¤§å°å’Œæ¼å‡ºé€Ÿç‡æ¥æ»¡è¶³ä¸åŒçš„é™æµéœ€æ±‚ï¼Œå¯ä»¥çµæ´»åœ°é€‚åº”ä¸åŒçš„åœºæ™¯ã€‚</li>
</ul>
<h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>éœ€è¦å¯¹è¯·æ±‚è¿›è¡Œç¼“å­˜ï¼Œä¼šå¢åŠ æœåŠ¡å™¨çš„å†…å­˜æ¶ˆè€—ã€‚</li>
<li>å¯¹äºæµé‡æ³¢åŠ¨æ¯”è¾ƒå¤§çš„åœºæ™¯ï¼Œéœ€è¦è¾ƒä¸ºçµæ´»çš„å‚æ•°é…ç½®æ‰èƒ½è¾¾åˆ°è¾ƒå¥½çš„æ•ˆæœã€‚</li>
<li>æ— æ³•åº”å¯¹çªå‘æµé‡çš„åœºæ™¯ã€‚æµé‡å˜çªå‘æ—¶ï¼Œæˆ‘ä»¬è‚¯å®šå¸Œæœ›ç³»ç»Ÿå°½é‡å¿«ç‚¹å¤„ç†è¯·æ±‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œä½†æ˜¯æ¼æ¡¶ç®—æ³•åªèƒ½ä»¥å›ºå®šé€Ÿåº¦å¤„ç†ã€‚</li>
</ul>
<h1 id="å››ã€ä»¤ç‰Œæ¡¶ç®—æ³•-Token-Bucket"><a href="#å››ã€ä»¤ç‰Œæ¡¶ç®—æ³•-Token-Bucket" class="headerlink" title="å››ã€ä»¤ç‰Œæ¡¶ç®—æ³•(Token Bucket)"></a>å››ã€ä»¤ç‰Œæ¡¶ç®—æ³•(Token Bucket)</h1><p>ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„é™æµç®—æ³•ï¼Œå¯ä»¥ç”¨äºé™åˆ¶å•ä½æ—¶é—´å†…è¯·æ±‚çš„æ•°é‡ã€‚è¯¥ç®—æ³•ç»´æŠ¤ä¸€ä¸ªå›ºå®šå®¹é‡çš„ä»¤ç‰Œæ¡¶ï¼Œæ¯ç§’é’Ÿä¼šå‘ä»¤ç‰Œæ¡¶ä¸­æ”¾å…¥ä¸€å®šæ•°é‡çš„ä»¤ç‰Œã€‚å½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¦‚æœä»¤ç‰Œæ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œåˆ™è¯·æ±‚è¢«å…è®¸é€šè¿‡å¹¶ä»ä»¤ç‰Œæ¡¶ä¸­æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œï¼Œå¦åˆ™è¯·æ±‚è¢«æ‹’ç»ã€‚<br><img src="/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95.png" alt="ä»¤ç‰Œæ¡¶ç®—æ³•"></p>
<h2 id="4-1-ä»¤ç‰Œæ¡¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹"><a href="#4-1-ä»¤ç‰Œæ¡¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="4.1 ä»¤ç‰Œæ¡¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹"></a>4.1 ä»¤ç‰Œæ¡¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹</h2><h3 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>ç¨³å®šæ€§é«˜ï¼šä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥æ§åˆ¶è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿçš„è´Ÿè½½å˜å¾—ç¨³å®šã€‚</li>
<li>ç²¾åº¦é«˜ï¼šä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥æ ¹æ®å®é™…æƒ…å†µåŠ¨æ€è°ƒæ•´ç”Ÿæˆä»¤ç‰Œçš„é€Ÿç‡ï¼Œå¯ä»¥å®ç°è¾ƒé«˜ç²¾åº¦çš„é™æµã€‚</li>
<li>å¼¹æ€§å¥½ï¼šä»¤ç‰Œæ¡¶ç®—æ³•å¯ä»¥å¤„ç†çªå‘æµé‡ï¼Œå¯ä»¥åœ¨çŸ­æ—¶é—´å†…æä¾›æ›´å¤šçš„å¤„ç†èƒ½åŠ›ï¼Œä»¥å¤„ç†çªå‘æµé‡ã€‚</li>
</ul>
<p>Guavaçš„RateLimiteré™æµç»„ä»¶ï¼Œå°±æ˜¯åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•å®ç°çš„ã€‚</p>
<h3 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>å®ç°å¤æ‚ï¼šç›¸å¯¹äºå›ºå®šçª—å£ç®—æ³•ç­‰å…¶ä»–é™æµç®—æ³•ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°è¾ƒä¸ºå¤æ‚ã€‚å¯¹çŸ­æ—¶è¯·æ±‚éš¾ä»¥å¤„ç†ï¼šåœ¨çŸ­æ—¶é—´å†…æœ‰å¤§é‡è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œè¢«å¿«é€Ÿæ¶ˆè€—å®Œï¼Œä»è€Œé™æµã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ¼æ¡¶ç®—æ³•ã€‚</li>
<li>æ—¶é—´ç²¾åº¦è¦æ±‚é«˜ï¼šä»¤ç‰Œæ¡¶ç®—æ³•éœ€è¦åœ¨å›ºå®šçš„æ—¶é—´é—´éš”å†…ç”Ÿæˆä»¤ç‰Œï¼Œå› æ­¤è¦æ±‚æ—¶é—´ç²¾åº¦è¾ƒé«˜ï¼Œå¦‚æœç³»ç»Ÿæ—¶é—´ä¸å‡†ç¡®ï¼Œå¯èƒ½ä¼šå¯¼è‡´é™æµæ•ˆæœä¸ç†æƒ³ã€‚</li>
</ul>
<p>æ€»ä½“æ¥è¯´ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•å…·æœ‰è¾ƒé«˜çš„ç¨³å®šæ€§å’Œç²¾åº¦ï¼Œä½†å®ç°ç›¸å¯¹å¤æ‚ï¼Œé€‚ç”¨äºå¯¹ç¨³å®šæ€§å’Œç²¾åº¦è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://juejin.cn/post/7000152990501847048">å¾®æœåŠ¡ â€”â€” å¸¸è§çš„5ç§é™æµæ–¹æ¡ˆï½œ8æœˆæ›´æ–‡æŒ‘æˆ˜</a><br><a href="https://juejin.cn/post/7339544833999110170">åŸºäºredisçš„ç®€æ˜“æ»‘åŠ¨çª—å£å®ç°</a><br><a href="https://heapdump.cn/article/5480577">é¢è¯•å¿…å¤‡ï¼šå››ç§ç»å…¸é™æµç®—æ³•è®²è§£</a></p>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é«˜å¹¶å‘</tag>
        <tag>é™æµç®—æ³•</tag>
        <tag>å›ºå®šæ—¶é—´çª—å£</tag>
        <tag>æ»‘åŠ¨æ—¶é—´çª—å£</tag>
        <tag>æ¼æ´ç®—æ³•</tag>
        <tag>ä»¤ç‰Œæ¡¶ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>ç³»ç»Ÿç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœçš„æ€è€ƒ</title>
    <url>/2022/02/24/distributed/xi-tong-wen-ding-xing-yu-gao-ke-yong-bao-zhang-de-si-kao/</url>
    <content><![CDATA[<blockquote>
<p>åŸæ–‡åœ°å€ï¼š<a href="%E7%A8%B3%E5%AE%9A%E6%80%A7%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8%E4%BF%9D%E9%9A%9C%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%80%9D%E8%B7%AF">ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœçš„å·¥ä½œæ€è·¯</a>ï¼Œ æœ¬æ–‡åœ¨åŸæ–‡çš„åŸºç¡€ä¸Šåšäº†ä¸€äº›è¡¥å……å’Œåˆ å‡ã€‚</p>
</blockquote>
<h1 id="ä¸€ã€æ·±å…¥ç†è§£ç¨³å®šæ€§ä¸é«˜å¯ç”¨"><a href="#ä¸€ã€æ·±å…¥ç†è§£ç¨³å®šæ€§ä¸é«˜å¯ç”¨" class="headerlink" title="ä¸€ã€æ·±å…¥ç†è§£ç¨³å®šæ€§ä¸é«˜å¯ç”¨"></a>ä¸€ã€æ·±å…¥ç†è§£ç¨³å®šæ€§ä¸é«˜å¯ç”¨</h1><blockquote>
<p>ç»´åŸºç™¾ç§‘ä¸Šç¨³å®šæ€§ä¸é«˜å¯ç”¨æ€§çš„å®šä¹‰</p>
</blockquote>
<h2 id="ç¨³å®šæ€§"><a href="#ç¨³å®šæ€§" class="headerlink" title="ç¨³å®šæ€§"></a>ç¨³å®šæ€§</h2><blockquote>
<p>ç¨³å®šæ€§æ˜¯æ•°å­¦æˆ–å·¥ç¨‹ä¸Šçš„ç”¨è¯­ï¼Œåˆ¤åˆ«ä¸€ç³»ç»Ÿåœ¨æœ‰ç•Œçš„è¾“å…¥æ˜¯å¦ä¹Ÿäº§ç”Ÿæœ‰ç•Œçš„è¾“å‡ºã€‚è‹¥æ˜¯ï¼Œç§°ç³»ç»Ÿä¸ºç¨³å®šï¼›è‹¥å¦ï¼Œåˆ™ç§°ç³»ç»Ÿä¸ºä¸ç¨³å®šã€‚</p>
</blockquote>
<p>å…³äºç¨³å®šæ€§çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥æ€»ç»“å½’çº³ä¸º â€“ å½“ç³»ç»Ÿæ¥æ”¶è¾“å…¥åï¼Œèƒ½å¤Ÿäº§ç”Ÿæ­£ç¡®çš„ã€ç¬¦åˆé¢„æœŸçš„è¾“å‡ºï¼Œç§°ç³»ç»Ÿä¸ºç¨³å®šï¼›å¦åˆ™ï¼Œç§°ç³»ç»Ÿä¸ºä¸ç¨³å®šã€‚</p>
<p>ç¨³å®šæ€§æè¿°çš„æ˜¯ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä¸€ä¸ªç³»ç»Ÿæ˜¯å¦ç¨³å®šï¼Œå¾ˆéš¾è¿›è¡Œé‡åŒ–ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å¦å®šçš„æ–¹å¼è¿›è¡Œå¿«é€Ÿåœ°åˆ¤æ–­ã€‚ä¿éšœç³»ç»Ÿçš„ç¨³å®šæ€§æˆ–è€…è¯´æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§éœ€è¦é€šè¿‡å„ç§æ–¹æ³•æ¥é¿å…é‚£äº›ä¸ç¨³å®šçš„æƒ…å†µå‘ç”Ÿã€‚æ‰€è°“çš„æ›´ç¨³å®šï¼Œå®¢è§‚ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œæ˜¯ä¸»è§‚ä¸Šå¸Œæœ›é¿å…æˆ–è€…å‡å°‘ä¸ç¨³å®šçš„æƒ…å†µå‘ç”Ÿã€‚</p>
<h2 id="é«˜å¯ç”¨æ€§"><a href="#é«˜å¯ç”¨æ€§" class="headerlink" title="é«˜å¯ç”¨æ€§"></a>é«˜å¯ç”¨æ€§</h2><blockquote>
<p>é«˜å¯ç”¨æ€§ï¼ˆè‹±è¯­ï¼šhigh availabilityï¼Œç¼©å†™ä¸º HAï¼‰ï¼ŒITæœ¯è¯­ï¼ŒæŒ‡ç³»ç»Ÿæ— ä¸­æ–­åœ°æ‰§è¡Œå…¶åŠŸèƒ½çš„èƒ½åŠ›ï¼Œä»£è¡¨ç³»ç»Ÿçš„å¯ç”¨æ€§ç¨‹åº¦ã€‚æ˜¯è¿›è¡Œç³»ç»Ÿè®¾è®¡æ—¶çš„å‡†åˆ™ä¹‹ä¸€ã€‚é«˜å¯ç”¨æ€§ç³»ç»Ÿä¸æ„æˆè¯¥ç³»ç»Ÿçš„å„ä¸ªç»„ä»¶ç›¸æ¯”å¯ä»¥æ›´é•¿æ—¶é—´è¿è¡Œã€‚</p>
</blockquote>
<p>ä¸ç¨³å®šæ€§ä¸åŒï¼Œå¯ç”¨æ€§ä¸€ä¸ªå¯ä»¥é‡åŒ–çš„æŒ‡æ ‡ï¼Œè®¡ç®—å…¬å¼åœ¨ç»´åŸºç™¾ç§‘ä¸­æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>æ ¹æ®ç³»ç»ŸæŸå®³ã€æ— æ³•ä½¿ç”¨çš„æ—¶é—´ï¼Œä»¥åŠç”±æ— æ³•è¿ä½œæ¢å¤åˆ°å¯è¿ä½œçŠ¶æ€çš„æ—¶é—´ï¼Œä¸ç³»ç»Ÿæ€»è¿ä½œæ—¶é—´çš„æ¯”è¾ƒã€‚<br>è®¡ç®—å…¬å¼ï¼š<br><img src="/2022/02/24/distributed/xi-tong-wen-ding-xing-yu-gao-ke-yong-bao-zhang-de-si-kao/formula.svg" alt="é«˜å¯ç”¨è®¡ç®—å…¬å¼"></p>
</blockquote>
<ul>
<li>Aï¼ˆå¯ç”¨æ€§ï¼‰</li>
<li>MTTR(Mean Time To Repair): å¹³å‡ä¿®å¤æ—¶é—´ï¼ŒæŒ‡ç³»ç»Ÿä»å‘ç”Ÿæ•…éšœåˆ°ç»´ä¿®ç»“æŸä¹‹é—´çš„æ—¶é—´æ®µçš„å¹³å‡å€¼ï¼Œ MTTRè¶ŠçŸ­ï¼Œè¡¨ç¤ºæ˜“æ¢å¤æ€§è¶Šå¥½ã€‚</li>
<li>MTTF(å³ Mean Time To Failure): å¹³å‡æ— æ•…éšœæ—¶é—´ã€‚æŒ‡ç³»ç»Ÿæ— æ•…éšœè¿è¡Œçš„å¹³å‡æ—¶é—´ï¼Œå–æ‰€æœ‰ä»ç³»ç»Ÿå¼€å§‹æ­£å¸¸è¿è¡Œåˆ°å‘ç”Ÿæ•…éšœä¹‹é—´çš„æ—¶é—´æ®µçš„å¹³å‡å€¼ï¼ŒMTTFè¶Šé•¿ï¼Œè¡¨ç¤ºç³»ç»Ÿå¯é æ€§è¶Šé«˜ã€‚</li>
<li>MTBF(Mean Time Between Failures):å¹³å‡æ•…éšœé—´éš”ï¼ŒæŒ‡ç³»ç»Ÿä¸¤æ¬¡æ•…éšœå‘ç”Ÿæ—¶é—´ä¹‹é—´çš„æ—¶é—´æ®µçš„å¹³å‡å€¼ï¼ŒMTBFè¶Šé•¿ï¼Œè¡¨ç¤ºå‡ºç°æ•…éšœå‡ºç°çš„è¶Šä¸é¢‘ç¹ã€‚</li>
</ul>
<p> <img src="/2022/02/24/distributed/xi-tong-wen-ding-xing-yu-gao-ke-yong-bao-zhang-de-si-kao/MTTR-MTBF-and-MTTF.jpg" alt="MTTR-MTBF-and-MTTF"><br>ä»å®šä¹‰è¿˜å¯ä»¥çœ‹å‡ºï¼Œ<code>MTBF = MTTR + MTTF</code>ã€‚</p>
<p>åœ¨çº¿ç³»ç»Ÿå’Œæ‰§è¡Œå…³é”®ä»»åŠ¡çš„ç³»ç»Ÿé€šå¸¸è¦æ±‚å…¶å¯ç”¨æ€§è¦è¾¾åˆ°5ä¸ª9æ ‡å‡†(99.999%)ã€‚</p>
<table>
<thead>
<tr>
<th>å¯ç”¨æ€§</th>
<th>å¹´æ•…éšœæ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>99.9999%</td>
<td>32ç§’</td>
</tr>
<tr>
<td>99.999%</td>
<td>5åˆ†15ç§’</td>
</tr>
<tr>
<td>99.99%</td>
<td>52åˆ†34ç§’</td>
</tr>
<tr>
<td>99.9%</td>
<td>8å°æ—¶46åˆ†</td>
</tr>
<tr>
<td>99%</td>
<td>3å¤©15å°æ—¶36åˆ†</td>
</tr>
</tbody></table>
<blockquote>
<p>ä»¥ä¸Šå†…å®¹å‡ºè‡ª:<a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E5%8F%AF%E7%94%A8%E6%80%A7#cite_note-snia-1">ç»´åŸºç™¾ç§‘-é«˜å¯ç”¨æ€§</a></p>
</blockquote>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¿éšœç³»ç»Ÿçš„ç¨³å®šç³»åŠé«˜å¯ç”¨çš„ç›®æ ‡æ˜¯ä½¿ç³»ç»Ÿå¤„äºç¨³å®šçš„å·¥ä½œçŠ¶æ€ï¼Œé¿å…çº¿ä¸Šé—®é¢˜åŠæ•…éšœå‘ç”Ÿã€‚å…¶æ¬¡ï¼Œå‡ºç°éç¨³å®šçŠ¶æ€æ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿå‘ç°å¹¶å°†å…¶æ¢å¤åˆ°ç¨³å®šå¯ç”¨çš„çŠ¶æ€ã€‚</p>
<h1 id="äºŒã€ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœçš„æ ¸å¿ƒæ€è·¯"><a href="#äºŒã€ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœçš„æ ¸å¿ƒæ€è·¯" class="headerlink" title="äºŒã€ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœçš„æ ¸å¿ƒæ€è·¯"></a>äºŒã€ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœçš„æ ¸å¿ƒæ€è·¯</h1><p><img src="/2022/02/24/distributed/xi-tong-wen-ding-xing-yu-gao-ke-yong-bao-zhang-de-si-kao/%E9%AB%98%E5%8F%AF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.png" alt="é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ"></p>
<h2 id="2-1-åº”ç”¨ç³»ç»Ÿä¸­å¸¸è§éç¨³å®šçš„æƒ…å†µ"><a href="#2-1-åº”ç”¨ç³»ç»Ÿä¸­å¸¸è§éç¨³å®šçš„æƒ…å†µ" class="headerlink" title="2.1 åº”ç”¨ç³»ç»Ÿä¸­å¸¸è§éç¨³å®šçš„æƒ…å†µ"></a>2.1 åº”ç”¨ç³»ç»Ÿä¸­å¸¸è§éç¨³å®šçš„æƒ…å†µ</h2><ul>
<li><p>åŠŸèƒ½ï¼šåº”ç”¨ç¨‹åºæ‰§è¡Œçš„åŠŸèƒ½å‡ºç°é”™è¯¯ï¼Œä¸ç¬¦åˆé¢„æœŸã€‚</p>
</li>
<li><p>å®¹é‡ï¼šå½“ç³»ç»Ÿæ¥æ”¶çš„è¯·æ±‚æ•°é‡å¢åŠ æ—¶ï¼Œåº”ç”¨ç¨‹åºæ— æ³•æ­£å¸¸å¤„ç†ï¼Œå‡ºç°å¼‚å¸¸æˆ–è¶…æ—¶ï¼Œå¯¼è‡´æœåŠ¡å¤±æ•ˆã€‚</p>
</li>
<li><p>å®‰å…¨ï¼šå½“ç³»ç»Ÿæ¥æ”¶åˆ°çš„æ²¡æœ‰æˆæƒçš„æˆ–è€…æ¶æ„æ”»å‡»çš„è¯·æ±‚æ—¶ï¼Œåº”ç”¨ç¨‹åºå‡ºç°å¼‚å¸¸ç”šè‡³æœåŠ¡å¤±æ•ˆã€‚</p>
</li>
<li><p>å®¹é”™ï¼šå¯¹äºç”¨æˆ·é”™è¯¯çš„ä½¿ç”¨æ–¹å¼, åº”ç”¨ç¨‹åºæ— æ³•åˆé€‚åœ°å¤„ç†ã€‚</p>
</li>
</ul>
<h2 id="2-2-è½¯ä»¶ç³»ç»Ÿé—®é¢˜åŸå› å½’ç±»"><a href="#2-2-è½¯ä»¶ç³»ç»Ÿé—®é¢˜åŸå› å½’ç±»" class="headerlink" title="2.2 è½¯ä»¶ç³»ç»Ÿé—®é¢˜åŸå› å½’ç±»"></a>2.2 è½¯ä»¶ç³»ç»Ÿé—®é¢˜åŸå› å½’ç±»</h2><ul>
<li><p>äººä¸ºæ•…éšœï¼šåœ¨å¼€å‘è½¯ä»¶çš„å„ä¸ªç¯èŠ‚ä¸­æ€è€ƒä¸å……åˆ†ï¼Œæˆ–è€…æ‰§è¡Œæ—¶ç²—å¿ƒå¯¼è‡´çš„å„ç±»é—®é¢˜ã€‚</p>
</li>
<li><p>ç¡¬ä»¶æ•…éšœï¼šç½‘ç»œä¸é€šï¼Œç¡¬ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå†…å­˜å´©æºƒç­‰ã€‚</p>
</li>
<li><p>è½¯ä»¶æ•…éšœï¼šçº¿ç¨‹æ± å¼‚å¸¸ï¼ŒJVMå¼‚å¸¸ï¼Œä¸­é—´ä»¶æˆ–å…¶ä»–ä¾èµ–çš„åº”ç”¨æœåŠ¡å¼‚å¸¸ã€‚</p>
</li>
</ul>
<p>å¯¹äºä¸€ä¸ªåŠ¨æ€æ¼”è¿›çš„ç³»ç»Ÿè€Œè¨€ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•å°†æ•…éšœå‘ç”Ÿçš„æ¦‚ç‡é™ä¸º0ï¼Œåªèƒ½é€šè¿‡åœ¨è½¯ä»¶ç”Ÿäº§çš„è¿‡ç¨‹ä¸­ï¼Œå»ºç«‹æµç¨‹è§„èŒƒå’Œæœºåˆ¶æ¥å°½é‡å‡å°‘å…¶å‘ç”Ÿã€‚å…¶æ¬¡å¯¹äºä¸€ä¸ªè¿è¡Œçš„ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹å¹¶å®Œå–„ç›‘æ§å’Œé¢„è­¦æœºåˆ¶æ¥åŠæ—¶å‘ç°ç³»ç»Ÿä¸­çš„æ•…éšœï¼Œå¹¶é€šè¿‡æ‰§è¡Œé¢„æ¡ˆä½¿ç³»ç»Ÿå¿«é€Ÿæ¢å¤ã€‚åŸºäºä¸Šè¿°ç»“è®ºï¼Œä¸ºäº†æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œéœ€è¦ä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢å…¥æ‰‹å¼€å±•å·¥ä½œï¼šæ•…éšœé¢„é˜²ï¼Œæ•…éšœå‘ç°å’Œæ•…éšœæ¢å¤ã€‚</p>
<p><img src="/2022/02/24/distributed/xi-tong-wen-ding-xing-yu-gao-ke-yong-bao-zhang-de-si-kao/%E6%95%85%E9%9A%9C%E7%B1%BB%E5%9E%8B%E5%8F%8A%E9%A2%84%E9%98%B2%E6%8E%AA%E6%96%BD.png" alt="æ•…éšœç±»å‹åŠé¢„é˜²æªæ–½"></p>
<p>äººçŠ¯é”™çš„å‡ ç‡æ˜¯è¿œè¿œå¤§äºæœºå™¨çš„ï¼Œå› æ­¤æ•…éšœé¢„é˜²æœ€é‡è¦çš„æ˜¯å»ºç«‹ä¸€å¥—æœºåˆ¶ï¼Œåœ¨å›¢é˜Ÿå†…è¾¾æˆå…±è¯†å¹¶æŒç»­æŒ‰ç…§æ­¤æµç¨‹å¼€å±•ç ”å‘å·¥ä½œï¼Œä»è€Œå‡å°‘ä¸ªäººå› ç´ ï¼ˆæ€è€ƒã€æ‰§è¡Œã€çŠ¶æ€ç­‰æ–¹é¢ï¼‰å¯¹ç³»ç»Ÿç¨³å®šæ€§çš„å½±å“ã€‚è€Œæ•…éšœå‘ç°ä»¥åŠæ•…éšœæ¢å¤ï¼Œåˆ™æ˜¯éœ€è¦é€šè¿‡ç³»ç»Ÿç›‘æ§å’Œåº”æ€¥æ–¹æ¡ˆæ¥å¿«é€Ÿå‘ç°ç³»ç»Ÿå¼‚å¸¸å¹¶æ¢å¤ï¼Œä»è€Œå°½é‡å‡è½»æ•…éšœçš„å½±å“é¢ã€‚</p>
<h2 id="2-3-ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœæ–¹æ¡ˆ"><a href="#2-3-ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœæ–¹æ¡ˆ" class="headerlink" title="2.3 ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœæ–¹æ¡ˆ"></a>2.3 ç¨³å®šæ€§ä¸é«˜å¯ç”¨ä¿éšœæ–¹æ¡ˆ</h2><p>ä¸‹é¢ä»¥èš‚èšæ—¥å¸¸çš„äº§å“ç ”å‘æµç¨‹ä¸ºä¾‹ï¼Œä»åŠŸèƒ½ã€å®¹é‡ã€å®‰å…¨ã€å®¹é”™è¿™4ä¸ªæ ¸å¿ƒè¦ç´ å‡ºå‘ï¼Œç»™å‡ºä¸€å¥—æ–¹æ¡ˆä»…ä¾›å‚è€ƒã€‚<br><img src="/2022/02/24/distributed/xi-tong-wen-ding-xing-yu-gao-ke-yong-bao-zhang-de-si-kao/%E7%A8%B3%E5%AE%9A%E6%80%A7%E4%BF%9D%E9%9A%9C%E5%8F%8A%E9%AB%98%E5%8F%AF%E7%94%A8.png" alt="ç¨³å®šæ€§ä¿éšœåŠé«˜å¯ç”¨"></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç¨³å®šæ€§å’Œé«˜å¯ç”¨æ˜¯ä¸€ä¸ªå¾ˆåºå¤§çš„å‘½é¢˜ï¼Œåº•å±‚å¼€å‘è€…æ¥åœ¨è®¾è®¡å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç¼ºä¹ä¸€å¥—ç³»ç»Ÿçš„æ¡†æ¶æ€è·¯ï¼Œç¼ºå°‘å¯¹äºç¨³å®šæ€§å’Œé«˜å¯ç”¨çš„æ–¹æ¡ˆç³»ç»Ÿå…¨é¢çš„è€ƒé‡ã€‚é€šè¿‡å¯¹ä¸Šè¿°ç¨³å®šæ€§å’Œé«˜å¯ç”¨çš„ç†è§£ï¼Œå¯ä»¥ä»æ•…éšœé¢„é˜²ã€æ•…éšœå‘ç°ã€æ•…éšœæ¢å¤ä¸‰ä¸ªå±‚é¢è¿›è¡Œç¨³å®šæ€§å’Œé«˜å¯ç”¨ä¿éšœã€‚è€Œå¯¹äºå…·ä½“çš„æ–¹æ¡ˆå¯ä»¥ä»ç ”å‘è§„èŒƒã€å®¹é‡ä¿éšœã€ç›‘æ§å‘Šè­¦ã€åº”æ€¥å¿«åè¿™å››ä¸ªæ ¸å¿ƒè¦ç´ åˆ¶å®šç›¸å…³è§„èŒƒï¼Œä»å®ç°ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨çš„ä¿éšœã€‚</p>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>ç¨³å®šæ€§</tag>
        <tag>é«˜å¯ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ</title>
    <url>/2022/01/17/distributed/fen-bu-shi-id-sheng-cheng-fang-an/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>ç”±äºMySQLçš„å•è¡¨æ•°æ®é‡è¶…è¿‡äº†åƒä¸‡çº§åˆ«ï¼Œéœ€è¦æ ¹æ®æ—¥æœŸå¯¹æ•°æ®åº“è¿›è¡Œæ°´å¹³åˆ†è¡¨ï¼Œåˆ†è¡¨åéœ€è¦ä¿è¯æ¯ä¸ªåˆ†è¡¨Idçš„å…¨å±€å”¯ä¸€æ€§ï¼ŒåŸæ¥å•è¡¨ä½¿ç”¨è‡ªå¢ä¿è¯Idçš„æœ‰åºæ€§å’Œå”¯ä¸€æ€§ï¼Œåˆ†è¡¨åéœ€è¦ç”Ÿæˆå…¨å±€å”¯ä¸€çš„Idã€‚</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥è®¨è®ºä¸€ä¸‹åˆ†å¸ƒå¼Idçš„ç”Ÿæˆæ–¹æ¡ˆï¼Œä»¥åŠå„ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ç­‰ã€‚</p>
<h1 id="äºŒã€åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ"><a href="#äºŒã€åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ" class="headerlink" title="äºŒã€åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ"></a>äºŒã€åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ</h1><h2 id="2-1-UUID"><a href="#2-1-UUID" class="headerlink" title="2.1 UUID"></a>2.1 UUID</h2><blockquote>
<p>A universally unique identifier (UUID) is a 128-bit label used for information in computer systems. The term globally unique identifier (GUID) is also used<br>é€šç”¨å”¯ä¸€è¯†åˆ«ç ï¼ˆè‹±è¯­ï¼šUniversally Unique Identifierï¼Œç¼©å†™ï¼šUUIDï¼‰æ˜¯ç”¨äºè®¡ç®—æœºä½“ç³»ä¸­ä»¥è¯†åˆ«ä¿¡æ¯çš„ä¸€ä¸ª128ä½æ ‡è¯†ç¬¦ã€‚</p>
</blockquote>
<p>æ ¹æ®æ ‡å‡†æ–¹æ³•ç”Ÿæˆï¼Œä¸ä¾èµ–ä¸­å¤®æœºæ„çš„æ³¨å†Œå’Œåˆ†é…ï¼ŒUUIDå…·æœ‰å”¯ä¸€æ€§ï¼Œè¿™ä¸å…¶ä»–å¤§å¤šæ•°ç¼–å·æ–¹æ¡ˆä¸åŒã€‚é‡å¤UUIDç æ¦‚ç‡æ¥è¿‘é›¶ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚<a href="https://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E5%94%AF%E4%B8%80%E8%AF%86%E5%88%AB%E7%A0%81">é€šç”¨å”¯ä¸€è¯†åˆ«ç -ç»´åŸºç™¾ç§‘</a></p>
<h3 id="2-1-1-UUIDå®šä¹‰"><a href="#2-1-1-UUIDå®šä¹‰" class="headerlink" title="2.1.1 UUIDå®šä¹‰"></a>2.1.1 UUIDå®šä¹‰</h3><p>UUIDæ˜¯ç”±ä¸€ä¸ª16è¿›åˆ¶ä¸‹çš„32ä½æ•°æ‰€æ„æˆï¼Œæ•…UUIDç†è®ºä¸Šçš„æ€»æ•°ä¸º16çš„32æ¬¡æ–¹&#x3D;2çš„128æ¬¡æ–¹ï¼Œçº¦ç­‰äº3.4 x 10çš„38æ¬¡æ–¹ã€‚ä¹Ÿå°±æ˜¯è¯´è‹¥æ¯çº³ç§’ï¼ˆnsï¼‰äº§ç”Ÿ1ä¸‡äº¿ä¸ªUUIDï¼Œè¦èŠ±100äº¿å¹´æ‰ä¼šå°†æ‰€æœ‰UUIDç”¨å®Œã€‚</p>
<p>UUIDçš„æ ‡å‡†å‹å¼åŒ…å«32ä¸ª16è¿›åˆ¶æ•°å­—ï¼Œä»¥è¿å­—å·åˆ†ä¸ºäº”æ®µï¼Œå½¢å¼ä¸º 8-4-4-4-12 çš„32ä¸ªå­—ç¬¦ã€‚ç¤ºä¾‹ï¼š<code>550e8400-e29b-41d4-a716-446655440000</code></p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>ç”Ÿæˆå®¹æ˜“ã€é€Ÿåº¦å¿«</li>
<li>IDå”¯ä¸€ï¼ˆå‡ ä¹ä¸ä¼šäº§ç”Ÿé‡å¤IDï¼Œéƒ¨åˆ†å®ç°ä¾èµ–äºMACç¡¬ä»¶åœ°å€ï¼‰</li>
<li>æ— éœ€ä¸­å¿ƒåŒ–æœåŠ¡å™¨</li>
<li>ä¸ä¼šæ³„éœ²å•†ä¸šæœºå¯†</li>
</ul>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>å¯è¯»æ€§å·®</li>
<li>å ç”¨ç©ºé—´å¤ªå¤šï¼ˆ16ä¸ªå­—èŠ‚ï¼‰</li>
<li>ä½œä¸ºæ•°æ®åº“ä¸»é”®æ—¶ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½</li>
</ul>
<blockquote>
<h4 id="ä¸ºä»€ä¹ˆUUIDä¸å»ºè®®ä½œä¸ºMySQLæ•°æ®åº“è¡¨çš„ä¸»é”®ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆUUIDä¸å»ºè®®ä½œä¸ºMySQLæ•°æ®åº“è¡¨çš„ä¸»é”®ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆUUIDä¸å»ºè®®ä½œä¸ºMySQLæ•°æ®åº“è¡¨çš„ä¸»é”®ï¼Ÿ"></a>ä¸ºä»€ä¹ˆUUIDä¸å»ºè®®ä½œä¸ºMySQLæ•°æ®åº“è¡¨çš„ä¸»é”®ï¼Ÿ</h4><p>MySQLæ•°æ®åº“InnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨äº†èšç°‡ç´¢å¼•ï¼Œåº•å±‚ä½¿ç”¨B+æ ‘æ¥å­˜å‚¨æ•°æ®ï¼ŒB+æ ‘çš„éå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨å…·ä½“çš„è¡Œæ•°æ®ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°é»˜è®¤ä¸º<code>16KB</code>ã€‚<br>å…¶ä¸­å¶å­èŠ‚ç‚¹å†…éƒ¨çš„è®°å½•æ ¹æ®ä¸»é”®å¤§å°è¿›è¡Œæ’åºï¼Œå¶å­èŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨åŒå‘é“¾è¡¨è¿›è¡Œè¿æ¥ã€‚</p>
<p>å¦‚æœä½¿ç”¨UUIDä½œä¸ºä¸»é”®ï¼Œç”±äºUUIDæ˜¯æ— åºçš„ï¼Œåœ¨è¿›è¡Œæ’å…¥æ“ä½œçš„æ—¶å€™ï¼Œå­˜å‚¨å¼•æ“éœ€è¦ç»´æŠ¤ä¸»é”®ç´¢å¼•çš„é¡ºåº,ä¸€æ¡æ–°çš„è®°å½•æ’å…¥è¿›æ¥ï¼Œå¯èƒ½ä¼šè¢«æ’å…¥åˆ°ä¹‹å‰å·²ç»å­˜æ”¾æ»¡çš„å¶å­ç»“ç‚¹å†…ï¼Œæ­¤æ—¶å°†ä¼šäº§ç”Ÿé¡µåˆ†è£‚ï¼Œå¸¦æ¥æ€§èƒ½æŸè€—ã€‚<br>æ ¹æ®MySQL InnoDbå­˜å‚¨å¼•æ“çš„èšç°‡ç´¢å¼•çš„ç‰¹æ€§ï¼Œå»ºè®®ä¸»é”®é€‰å–ä¸ºé€’å¢æœ‰åºçš„å­—æ®µã€‚</p>
</blockquote>
<h2 id="2-2-åŸºäºæ•°æ®åº“è‡ªå¢ID"><a href="#2-2-åŸºäºæ•°æ®åº“è‡ªå¢ID" class="headerlink" title="2.2 åŸºäºæ•°æ®åº“è‡ªå¢ID"></a>2.2 åŸºäºæ•°æ®åº“è‡ªå¢ID</h2><p>é€šè¿‡å…³ç³»å‹æ•°æ®åº“è‡ªå¢ä¸»é”®äº§ç”Ÿå”¯ä¸€çš„IDï¼Œç°åœ¨æµè¡Œçš„å•†ä¸šæ•°æ®åº“éƒ½æ”¯æŒè‡ªå¢ä¸»é”®çš„ç‰¹æ€§ï¼Œæ¯”å¦‚MySQLç­‰ã€‚</p>
<h3 id="ä¼˜ç‚¹-1"><a href="#ä¼˜ç‚¹-1" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å®¹æ˜“äº§ç”Ÿ</li>
<li>IDå•è°ƒé€’å¢</li>
<li>å­˜å‚¨å¾ˆå°ï¼ˆintç±»å‹å ç”¨4ä¸ªå­—èŠ‚ï¼Œbigintç±»å‹å ç”¨8ä¸ªå­—èŠ‚ï¼‰</li>
</ul>
<h3 id="ç¼ºç‚¹-1"><a href="#ç¼ºç‚¹-1" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>ä¾èµ–äºæ•°æ®åº“ã€è€Œä¸”éœ€è¦å¤„ç†å•ç‚¹é—®é¢˜ï¼Œè€Œä¸”å•ç‚¹æœ‰æ€§èƒ½ç“¶é¢ˆé—®é¢˜</li>
<li>æ¯æ¬¡ç”Ÿæˆä¸€ä¸ªIDéƒ½éœ€è¦è®¿é—®ä¸€æ¬¡æ•°æ®åº“</li>
</ul>
<blockquote>
<p>å…³äºæ•°æ®åº“å•ç‚¹é£é™©çš„é—®é¢˜å¯ä»¥é€šè¿‡æ•°æ®åº“é›†ç¾¤æ¨¡å¼å»ä¼˜åŒ–ï¼Œéƒ¨ç½²å¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹å‡å¯äº§ç”ŸIdï¼Œæ¯ä¸ªæ•°æ®åº“å®ä¾‹è®¾ç½®ä¸é€šè¿‡çš„èµ·å§‹å€¼å’Œè‡ªå¢æ­¥é•¿ã€‚<br>è¿™ç§æ–¹å¼è™½å¯ä»¥è§£å†³ç‚¹å•ç‚¹é—®é¢˜ï¼Œä½†æ˜¯ä¸åˆ©äºåç»­çš„æ‰©å®¹ã€‚</p>
</blockquote>
<h2 id="2-3-åŸºäºæ•°æ®åº“çš„åˆ†æ®µå‘å·æ–¹æ¡ˆ"><a href="#2-3-åŸºäºæ•°æ®åº“çš„åˆ†æ®µå‘å·æ–¹æ¡ˆ" class="headerlink" title="2.3 åŸºäºæ•°æ®åº“çš„åˆ†æ®µå‘å·æ–¹æ¡ˆ"></a>2.3 åŸºäºæ•°æ®åº“çš„åˆ†æ®µå‘å·æ–¹æ¡ˆ</h2><p>å·æ®µæ–¹æ¡ˆæ˜¯å½“ä¸‹åˆ†å¸ƒå¼IDç”Ÿæˆå™¨çš„ä¸»æµå®ç°æ–¹å¼ä¹‹ä¸€ï¼Œåˆ†æ®µæ–¹æ¡ˆä½¿ç”¨æ•°æ®åº“è¡¨æ¥å­˜å‚¨æœ€å¤§IDï¼Œæ¯æ¬¡è·å–ä¸€ä¸ªèŒƒå›´æ®µçš„IDï¼Œè·å–åæ›´æ–°æ•°æ®åº“è¡¨ï¼Œå¹¶å°†è¿™ä¸€æ®µIDåŠ è½½åˆ°å†…ä»ä¸­ï¼Œåœ¨å†…å­˜ä¸­è¿›è¡Œåˆ†é…ï¼Œå†…å­˜ä¸­çš„IDå·æ®µä½¿ç”¨å®Œæˆåï¼Œå†ä»æ•°æ®åº“ä¸­è·å–ã€‚</p>
<h3 id="æ•°æ®åº“è¡¨ç»“æ„ç¤ºä¾‹ï¼š"><a href="#æ•°æ®åº“è¡¨ç»“æ„ç¤ºä¾‹ï¼š" class="headerlink" title="æ•°æ®åº“è¡¨ç»“æ„ç¤ºä¾‹ï¼š"></a>æ•°æ®åº“è¡¨ç»“æ„ç¤ºä¾‹ï¼š</h3><pre class="line-numbers language-none"><code class="language-none">CREATEÂ TABLEÂ id_generatorÂ (Â Â &#96;id&#96;Â int(10)Â NOTÂ NULL,Â Â 
&#96;max_id&#96;Â bigint(20)Â NOTÂ NULLÂ COMMENTÂ &#39;å½“å‰æœ€å¤§id&#39;,Â Â 
&#96;step&#96;Â int(20)Â NOTÂ NULLÂ COMMENTÂ &#39;å·æ®µçš„æ­¥é•¿&#39;,Â Â 
&#96;biz_type&#96;Â Â Â Â int(20)Â NOTÂ NULLÂ COMMENTÂ &#39;ä¸šåŠ¡ç±»å‹&#39;,Â Â 
&#96;version&#96;Â int(20)Â NOTÂ NULLÂ COMMENTÂ &#39;ç‰ˆæœ¬å·&#39;,Â Â 
PRIMARYÂ KEYÂ (&#96;id&#96;)
)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>max_id ï¼šå½“å‰æœ€å¤§çš„å¯ç”¨id</li>
<li>step ï¼šä»£è¡¨å·æ®µçš„é•¿åº¦</li>
<li>biz_type ï¼šä»£è¡¨ä¸åŒä¸šåŠ¡ç±»å‹</li>
<li>version ï¼šæ˜¯ä¸€ä¸ªä¹è§‚é”ï¼Œæ¯æ¬¡éƒ½æ›´æ–°versionï¼Œä¿è¯å¹¶å‘æ—¶æ•°æ®çš„æ­£ç¡®æ€§</li>
</ul>
<h3 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>ç›¸å¯¹äºæ•°æ®åº“è‡ªå¢çš„Idï¼Œæœ‰æ•ˆå‡è½»äº†æ•°æ®åº“å‹åŠ›</li>
</ul>
<h3 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>ä¾èµ–äºæ•°æ®åº“</li>
<li>æ¯ä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„Idå·æ®µå†…é€’å¢</li>
</ul>
<h2 id="2-4-åŸºäºRedisçš„åŸå­æ€§é€’å¢"><a href="#2-4-åŸºäºRedisçš„åŸå­æ€§é€’å¢" class="headerlink" title="2.4 åŸºäºRedisçš„åŸå­æ€§é€’å¢"></a>2.4 åŸºäºRedisçš„åŸå­æ€§é€’å¢</h2><blockquote>
<h3 id="INCR-key"><a href="#INCR-key" class="headerlink" title="INCR key"></a>INCR key</h3><h4 id="Available-since-1-0-0"><a href="#Available-since-1-0-0" class="headerlink" title="Available since 1.0.0."></a>Available since 1.0.0.</h4></blockquote>
<blockquote>
<h4 id="Time-complexity-O-1"><a href="#Time-complexity-O-1" class="headerlink" title="Time complexity: O(1)"></a>Time complexity: O(1)</h4></blockquote>
<blockquote>
<p>Increments the number stored at key by one. If the key does not exist, it is set to 0 before performing the operation. An error is returned if the key contains a value of the wrong type or contains a string that can not be represented as integer. This operation is limited to 64 bit signed integers.</p>
</blockquote>
<blockquote>
<p>Note: this is a string operation because Redis does not have a dedicated integer type. The string stored at the key is interpreted as a base-10 64 bit signed integer to execute the operation.</p>
</blockquote>
<blockquote>
<p>Redis stores integers in their integer representation, so for string values that actually hold an integer, there is no overhead for storing the string representation of the integer.</p>
</blockquote>
<p>Redisæä¾›äº†<code>incr</code>æŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¯ä»¥å¯¹keyä¸­å­˜å‚¨çš„å€¼è¿›è¡Œ<code>+1</code>æ“ä½œï¼ˆRedisä¸æ”¯æŒIntegerç±»å‹ï¼Œkeyä¸­å­˜å‚¨çš„stringå€¼å°†ä¼šè¢«è½¬ä¸ºä¸€ä¸ª64ä½çš„æœ‰ç¬¦å·æ•´æ•°è¿›è¡Œæ“ä½œï¼‰ã€‚</p>
<h3 id="ä¼˜ç‚¹-3"><a href="#ä¼˜ç‚¹-3" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å®ç°ç®€å•</li>
<li>ç”Ÿæˆidæ•ˆç‡é«˜</li>
</ul>
<h3 id="ç¼ºç‚¹-3"><a href="#ç¼ºç‚¹-3" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>å¼ºä¾èµ–äºæ•°æ®åº“</li>
<li>éœ€è¦è€ƒè™‘RedisæŒä¹…åŒ–çš„é—®é¢˜</li>
</ul>
<h2 id="2-5-åŸºäºé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"><a href="#2-5-åŸºäºé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰" class="headerlink" title="2.5 åŸºäºé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰"></a>2.5 åŸºäºé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</h2><p>snowflakeæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç”Ÿæˆçš„ç»“æœæ˜¯ä¸€ä¸ªLongç±»å‹çš„IDã€‚</p>
<p>snowflakeä½¿ç”¨64bitæ¥ç”ŸæˆIDï¼Œç”±é«˜ä½åˆ°ä½ä½æˆéƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<ul>
<li>1bitä½œä¸ºä¿ç•™ä½ï¼Œæ²¡æœ‰ä½¿ç”¨ï¼Œæ°¸è¿œæ˜¯0</li>
<li>41bitä½œä¸ºæ—¶é—´æˆ³ï¼Œè¡¨ç¤ºä»1970-01-01å¹´ä»¥æ¥çš„æ¯«ç§’æ•°</li>
<li>10bitä½œä¸ºæœºå™¨IDï¼ˆ5bitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5bitæ˜¯æœºå™¨IDï¼‰</li>
<li>12bitä½œä¸ºæ¯«ç§’å†…çš„æµæ°´å·ï¼Œæ¯æ¯«ç§’å¯ä»¥ç”Ÿæˆ4096ä¸ªID</li>
</ul>
<p>é›ªèŠ±ç®—æ³•æ¯ç§’å¯ä»¥ç”Ÿæˆ400ä¸‡+çš„IDï¼Œç”±äºé«˜ä½41ä½ä½¿ç”¨äº†æ—¶é—´æˆ³ï¼Œæ‰€ä»¥å„èŠ‚ç‚¹ç”Ÿæˆçš„IDéƒ½æ˜¯å¤§è‡´æœ‰åºçš„ã€‚</p>
<h3 id="ä¼˜ç‚¹-4"><a href="#ä¼˜ç‚¹-4" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å®ç°ç®€å•</li>
<li>ä¸ä¾èµ–å…¶å®ƒç»„ä»¶</li>
<li>ç”ŸæˆIDé€Ÿåº¦å¿«</li>
</ul>
<h3 id="ç¼ºç‚¹-4"><a href="#ç¼ºç‚¹-4" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>ç”Ÿæˆçš„Idæ˜¯è¶‹åŠ¿é€’å¢çš„ï¼ˆç»å¯¹é€’å¢ä¼šå¯¼è‡´ä¸šåŠ¡ä¿¡æ¯æ³„éœ²ï¼‰</li>
<li>ä¾èµ–æœºå™¨æ—¶é—´ï¼Œéœ€è¦å¤„ç†æ—¶é’Ÿå›æ‹¨çš„é—®é¢˜</li>
</ul>
<h2 id="2-6-ç™¾åº¦-UidGenerator"><a href="#2-6-ç™¾åº¦-UidGenerator" class="headerlink" title="2.6 ç™¾åº¦(UidGenerator)"></a>2.6 ç™¾åº¦(UidGenerator)</h2><p>UidGeneratoræ˜¯Javaå®ç°çš„, åŸºäºSnowflakeç®—æ³•çš„å”¯ä¸€IDç”Ÿæˆå™¨ã€‚UidGeneratorä»¥ç»„ä»¶å½¢å¼å·¥ä½œåœ¨åº”ç”¨é¡¹ç›®ä¸­, æ”¯æŒè‡ªå®šä¹‰workerIdä½æ•°å’Œåˆå§‹åŒ–ç­–ç•¥, ä»è€Œé€‚ç”¨äºdockerç­‰è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹å®ä¾‹è‡ªåŠ¨é‡å¯ã€æ¼‚ç§»ç­‰åœºæ™¯ã€‚ åœ¨å®ç°ä¸Š, UidGeneratoré€šè¿‡å€Ÿç”¨æœªæ¥æ—¶é—´æ¥è§£å†³sequenceå¤©ç„¶å­˜åœ¨çš„å¹¶å‘é™åˆ¶; é‡‡ç”¨RingBufferæ¥ç¼“å­˜å·²ç”Ÿæˆçš„UID, å¹¶è¡ŒåŒ–UIDçš„ç”Ÿäº§å’Œæ¶ˆè´¹, åŒæ—¶å¯¹CacheLineè¡¥é½ï¼Œé¿å…äº†ç”±RingBufferå¸¦æ¥çš„ç¡¬ä»¶çº§ã€Œä¼ªå…±äº«ã€é—®é¢˜. æœ€ç»ˆå•æœºQPSå¯è¾¾600ä¸‡ã€‚</p>
<p>ä¾èµ–ç‰ˆæœ¬ï¼šJava8åŠä»¥ä¸Šç‰ˆæœ¬, MySQL(å†…ç½®WorkerIDåˆ†é…å™¨, å¯åŠ¨é˜¶æ®µé€šè¿‡DBè¿›è¡Œåˆ†é…; å¦‚è‡ªå®šä¹‰å®ç°, åˆ™DBéå¿…é€‰ä¾èµ–ï¼‰</p>
<table>
<thead>
<tr>
<th>sign</th>
<th>delta seconds</th>
<th>worker node id</th>
<th>sequence</th>
</tr>
</thead>
<tbody><tr>
<td>1bit</td>
<td>28bits</td>
<td>22bits</td>
<td>13bits</td>
</tr>
</tbody></table>
<p>Snowflakeç®—æ³•æè¿°ï¼šæŒ‡å®šæœºå™¨ &amp; åŒä¸€æ—¶åˆ» &amp; æŸä¸€å¹¶å‘åºåˆ—ï¼Œæ˜¯å”¯ä¸€çš„ã€‚æ®æ­¤å¯ç”Ÿæˆä¸€ä¸ª64 bitsçš„å”¯ä¸€IDï¼ˆlongï¼‰ã€‚é»˜è®¤é‡‡ç”¨ä¸Šå›¾å­—èŠ‚åˆ†é…æ–¹å¼ï¼š</p>
<ul>
<li>sign(1bit)<br>å›ºå®š1bitç¬¦å·æ ‡è¯†ï¼Œå³ç”Ÿæˆçš„UIDä¸ºæ­£æ•°ã€‚</li>
<li>delta seconds (28 bits)<br>å½“å‰æ—¶é—´ï¼Œç›¸å¯¹äºæ—¶é—´åŸºç‚¹â€2016-05-20â€çš„å¢é‡å€¼ï¼Œå•ä½ï¼šç§’ï¼Œæœ€å¤šå¯æ”¯æŒçº¦8.7å¹´</li>
<li>worker id (22 bits)<br>æœºå™¨idï¼Œæœ€å¤šå¯æ”¯æŒçº¦420wæ¬¡æœºå™¨å¯åŠ¨ã€‚å†…ç½®å®ç°ä¸ºåœ¨å¯åŠ¨æ—¶ç”±æ•°æ®åº“åˆ†é…ï¼Œé»˜è®¤åˆ†é…ç­–ç•¥ä¸ºç”¨åå³å¼ƒï¼Œåç»­å¯æä¾›å¤ç”¨ç­–ç•¥ã€‚</li>
<li>sequence (13 bits)<br>æ¯ç§’ä¸‹çš„å¹¶å‘åºåˆ—ï¼Œ13 bitså¯æ”¯æŒæ¯ç§’8192ä¸ªå¹¶å‘ã€‚<br>ä»¥ä¸Šå‚æ•°å‡å¯é€šè¿‡Springè¿›è¡Œè‡ªå®šä¹‰ã€‚</li>
</ul>
<h3 id="ä¼˜ç‚¹-5"><a href="#ä¼˜ç‚¹-5" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å¯ä»¥æ ¹æ®ä¸šåŠ¡è°ƒæ•´<code>delta seconds</code>ã€<code>worker id</code>ã€<code>sequence</code>çš„é•¿åº¦</li>
</ul>
<h3 id="ç¼ºç‚¹-5"><a href="#ç¼ºç‚¹-5" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>ä¾èµ–äºæ•°æ®åº“è¡¨</li>
</ul>
<p><a href="https://github.com/baidu/uid-generator/blob/master/README.zh_cn.md">UidGenerator</a></p>
<h2 id="2-7-ç¾å›¢-Leaf"><a href="#2-7-ç¾å›¢-Leaf" class="headerlink" title="2.7 ç¾å›¢(Leaf)"></a>2.7 ç¾å›¢(Leaf)</h2><p>Leafè¿™ä¸ªåå­—æ˜¯æ¥è‡ªå¾·å›½å“²å­¦å®¶ã€æ•°å­¦å®¶è±å¸ƒå°¼èŒ¨çš„ä¸€å¥è¯ï¼š &gt;There are no two identical leaves in the world &gt; â€œä¸–ç•Œä¸Šæ²¡æœ‰ä¸¤ç‰‡ç›¸åŒçš„æ ‘å¶â€</p>
<h3 id="Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ"><a href="#Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ" class="headerlink" title="Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ"></a>Leaf-segmentæ•°æ®åº“æ–¹æ¡ˆ</h3><p>ç¬¬ä¸€ç§Leaf-segmentæ–¹æ¡ˆï¼Œåœ¨ä½¿ç”¨æ•°æ®åº“çš„æ–¹æ¡ˆä¸Šï¼Œåšäº†å¦‚ä¸‹æ”¹å˜ï¼š - åŸæ–¹æ¡ˆæ¯æ¬¡è·å–IDéƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å¤§ã€‚æ”¹ä¸ºåˆ©ç”¨proxy serveræ‰¹é‡è·å–ï¼Œæ¯æ¬¡è·å–ä¸€ä¸ªsegment(stepå†³å®šå¤§å°)å·æ®µçš„å€¼ã€‚ç”¨å®Œä¹‹åå†å»æ•°æ®åº“è·å–æ–°çš„å·æ®µï¼Œå¯ä»¥å¤§å¤§çš„å‡è½»æ•°æ®åº“çš„å‹åŠ›ã€‚</p>
<h3 id="Leaf-snowflakeæ–¹æ¡ˆ"><a href="#Leaf-snowflakeæ–¹æ¡ˆ" class="headerlink" title="Leaf-snowflakeæ–¹æ¡ˆ"></a>Leaf-snowflakeæ–¹æ¡ˆ</h3><p>Leaf-segmentæ–¹æ¡ˆå¯ä»¥ç”Ÿæˆè¶‹åŠ¿é€’å¢çš„IDï¼ŒåŒæ—¶IDå·æ˜¯å¯è®¡ç®—çš„ï¼Œä¸é€‚ç”¨äºè®¢å•IDç”Ÿæˆåœºæ™¯ï¼Œæ¯”å¦‚ç«å¯¹åœ¨ä¸¤å¤©ä¸­åˆ12ç‚¹åˆ†åˆ«ä¸‹å•ï¼Œé€šè¿‡è®¢å•idå·ç›¸å‡å°±èƒ½å¤§è‡´è®¡ç®—å‡ºå…¬å¸ä¸€å¤©çš„è®¢å•é‡ï¼Œè¿™ä¸ªæ˜¯ä¸èƒ½å¿å—çš„ã€‚é¢å¯¹è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›äº† Leaf-snowflakeæ–¹æ¡ˆã€‚<br>Leaf-snowflakeæ–¹æ¡ˆå®Œå…¨æ²¿ç”¨snowflakeæ–¹æ¡ˆçš„bitä½è®¾è®¡ï¼Œå³æ˜¯â€œ1+41+10+12â€çš„æ–¹å¼ç»„è£…IDå·ã€‚å¯¹äºworkerIDçš„åˆ†é…ï¼Œå½“æœåŠ¡é›†ç¾¤æ•°é‡è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå®Œå…¨å¯ä»¥æ‰‹åŠ¨é…ç½®ã€‚LeafæœåŠ¡è§„æ¨¡è¾ƒå¤§ï¼ŒåŠ¨æ‰‹é…ç½®æˆæœ¬å¤ªé«˜ã€‚æ‰€ä»¥ä½¿ç”¨ZookeeperæŒä¹…é¡ºåºèŠ‚ç‚¹çš„ç‰¹æ€§è‡ªåŠ¨å¯¹snowflakeèŠ‚ç‚¹é…ç½®wokerIDã€‚Leaf-snowflakeæ˜¯æŒ‰ç…§ä¸‹é¢å‡ ä¸ªæ­¥éª¤å¯åŠ¨çš„ï¼š</p>
<ul>
<li>å¯åŠ¨Leaf-snowflakeæœåŠ¡ï¼Œè¿æ¥Zookeeperï¼Œåœ¨leaf_foreverçˆ¶èŠ‚ç‚¹ä¸‹æ£€æŸ¥è‡ªå·±æ˜¯å¦å·²ç»æ³¨å†Œè¿‡ï¼ˆæ˜¯å¦æœ‰è¯¥é¡ºåºå­èŠ‚ç‚¹ï¼‰ã€‚</li>
<li>å¦‚æœæœ‰æ³¨å†Œè¿‡ç›´æ¥å–å›è‡ªå·±çš„workerIDï¼ˆzké¡ºåºèŠ‚ç‚¹ç”Ÿæˆçš„intç±»å‹IDå·ï¼‰ï¼Œå¯åŠ¨æœåŠ¡ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ³¨å†Œè¿‡ï¼Œå°±åœ¨è¯¥çˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸€ä¸ªæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸåå–å›é¡ºåºå·å½“åšè‡ªå·±çš„workerIDå·ï¼Œå¯åŠ¨æœåŠ¡ã€‚</li>
</ul>
<p><a href="https://tech.meituan.com/2017/04/21/mt-leaf.html">Leafâ€”â€”ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ</a></p>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>ä¸Šé¢ä»‹ç»äº†6ç§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆï¼š</p>
<ul>
<li>UUID</li>
<li>åŸºäºæ•°æ®åº“è‡ªå¢ID</li>
<li>åŸºäºæ•°æ®åº“çš„åˆ†æ®µå‘å·æ–¹æ¡ˆ</li>
<li>åŸºäºRedisçš„åŸå­æ€§é€’å¢</li>
<li>åŸºäºé›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰</li>
<li>ç™¾åº¦(UidGenerator)</li>
<li>ç¾å›¢(Leaf)</li>
</ul>
<p>ä»¥ä¸Šåˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆåˆå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>UUIDç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼ŒåŸºæœ¬å¯ä»¥ä¿è¯å…¨å±€å”¯ä¸€ï¼Œè¿™ç±»æ–¹æ³•ç”Ÿæˆçš„IDå ç”¨ç©ºé—´è¾ƒå¤§ï¼ˆ16å­—èŠ‚ï¼‰,è€Œä¸”ç”Ÿæˆçš„IDæ— åºã€‚</li>
<li>åŸºäºæ•°æ®åº“ç”Ÿæˆçš„å•è°ƒé€’å¢çš„IDï¼Œéœ€è¦è§£å†³å•ç‚¹åŠæ€§èƒ½é—®é¢˜ï¼Œè€Œä¸”å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡æ•°æ®æ³„éœ²ã€‚<br>æ¯”å¦‚ï¼šé€šè¿‡è®¢å•IDæ¨æµ‹å‡ºä¸šåŠ¡ç³»ç»Ÿæ¯å¤©çš„è®¢å•é‡</li>
<li>snowflakeç®—æ³•ç±»ï¼Œå¯¹IDè¿›è¡Œåˆ†æ®µï¼Œåˆ†æ®µè¡¨ç¤ºæ—¶é—´ã€æœºå™¨èŠ‚ç‚¹ã€åºåˆ—å·ç­‰ï¼Œæ­¤ç±»ç®—æ³•ä¸­ç”±äºåŒ…å«æ—¶é—´æ®µï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘æ—¶é’Ÿå›æ‹¨çš„é—®é¢˜ã€‚</li>
</ul>
<blockquote>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://colobu.com/2020/02/21/ID-generator/">åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ</a></p>
<p><a href="https://juejin.cn/post/6854573222290161672">9ç§åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹å¼ï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆä½ </a></p>
</blockquote>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼ID</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache SkyWalkingç®€ä»‹åŠä½¿ç”¨</title>
    <url>/2020/05/20/framework/apache-skywalking-jian-jie-ji-shi-yong/</url>
    <content><![CDATA[<h2 id="ä¸€ã€SkyWalking-ç®€ä»‹"><a href="#ä¸€ã€SkyWalking-ç®€ä»‹" class="headerlink" title="ä¸€ã€SkyWalking ç®€ä»‹"></a>ä¸€ã€SkyWalking ç®€ä»‹</h2><p>Apache SkyWalking æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰å’Œå¯è§‚æµ‹æ€§åˆ†æå¹³å°ï¼Œä¸“ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿã€å¾®æœåŠ¡ã€äº‘åŸç”Ÿå’ŒåŸºäºå®¹å™¨çš„æ¶æ„è€Œè®¾è®¡ã€‚</p>
<h3 id="æ ¸å¿ƒç‰¹æ€§"><a href="#æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h3><ul>
<li><strong>åˆ†å¸ƒå¼è¿½è¸ª</strong>ï¼šè‡ªåŠ¨é‡‡é›†æœåŠ¡é—´è°ƒç”¨é“¾è·¯ï¼Œæä¾›ç«¯åˆ°ç«¯çš„è¯·æ±‚è¿½è¸ª</li>
<li><strong>æ€§èƒ½æŒ‡æ ‡ç›‘æ§</strong>ï¼šå®æ—¶æ”¶é›†åº”ç”¨æ€§èƒ½æŒ‡æ ‡ï¼ˆååé‡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰ï¼‰</li>
<li><strong>æœåŠ¡æ‹“æ‰‘åˆ†æ</strong>ï¼šè‡ªåŠ¨å‘ç°æœåŠ¡ä¾èµ–å…³ç³»ï¼Œç”ŸæˆæœåŠ¡æ‹“æ‰‘å›¾</li>
<li><strong>å‘Šè­¦æœºåˆ¶</strong>ï¼šæ”¯æŒåŸºäºè§„åˆ™çš„æ™ºèƒ½å‘Šè­¦</li>
<li><strong>å¤šè¯­è¨€æ”¯æŒ</strong>ï¼šJavaã€.NET Coreã€PHPã€NodeJSã€Golangã€Pythonã€Lua ç­‰</li>
<li><strong>æœåŠ¡ç½‘æ ¼æ”¯æŒ</strong>ï¼šä¸ Istioã€Envoy ç­‰æœåŠ¡ç½‘æ ¼é›†æˆ</li>
</ul>
<p><img src="/2020/05/20/framework/apache-skywalking-jian-jie-ji-shi-yong/frame.jpeg" alt="SkyWalkingæ¶æ„å›¾"></p>
<h3 id="æ¶æ„ç»„ä»¶"><a href="#æ¶æ„ç»„ä»¶" class="headerlink" title="æ¶æ„ç»„ä»¶"></a>æ¶æ„ç»„ä»¶</h3><p>SkyWalking ä¸»è¦ç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„æˆï¼š</p>
<ol>
<li><strong>Agentï¼ˆæ¢é’ˆï¼‰</strong>ï¼šéƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œè´Ÿè´£æ•°æ®é‡‡é›†</li>
<li><strong>OAP Serverï¼ˆåˆ†æå¹³å°ï¼‰</strong>ï¼šæ¥æ”¶ã€åˆ†æã€èšåˆæ•°æ®</li>
<li><strong>Storageï¼ˆå­˜å‚¨ï¼‰</strong>ï¼šæ”¯æŒ ElasticSearchã€H2ã€MySQL ç­‰å¤šç§å­˜å‚¨æ–¹æ¡ˆ</li>
<li><strong>UIï¼ˆç•Œé¢ï¼‰</strong>ï¼šæä¾›å¯è§†åŒ–å±•ç¤ºå’Œåˆ†æèƒ½åŠ›</li>
</ol>
<h2 id="äºŒã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#äºŒã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="äºŒã€æ ¸å¿ƒæ¦‚å¿µ"></a>äºŒã€æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="1-Traceï¼ˆè°ƒç”¨é“¾ï¼‰"><a href="#1-Traceï¼ˆè°ƒç”¨é“¾ï¼‰" class="headerlink" title="1. Traceï¼ˆè°ƒç”¨é“¾ï¼‰"></a>1. Traceï¼ˆè°ƒç”¨é“¾ï¼‰</h3><p>ä¸€æ¬¡å®Œæ•´çš„åˆ†å¸ƒå¼è¯·æ±‚è°ƒç”¨è¿‡ç¨‹ï¼Œç”±å¤šä¸ª Span ç»„æˆã€‚æ¯ä¸ª Trace æœ‰å”¯ä¸€çš„ TraceIdã€‚</p>
<h3 id="2-Spanï¼ˆè·¨åº¦ï¼‰"><a href="#2-Spanï¼ˆè·¨åº¦ï¼‰" class="headerlink" title="2. Spanï¼ˆè·¨åº¦ï¼‰"></a>2. Spanï¼ˆè·¨åº¦ï¼‰</h3><p>Trace ä¸­çš„ä¸€ä¸ªæ“ä½œå•å…ƒï¼Œä»£è¡¨ä¸€æ¬¡æ–¹æ³•è°ƒç”¨ã€è¿œç¨‹è°ƒç”¨æˆ–æ•°æ®åº“è®¿é—®ç­‰ã€‚åŒ…å«ï¼š</p>
<ul>
<li><strong>SpanId</strong>ï¼šå½“å‰ Span çš„å”¯ä¸€æ ‡è¯†</li>
<li><strong>ParentSpanId</strong>ï¼šçˆ¶ Span çš„æ ‡è¯†</li>
<li><strong>æ“ä½œåç§°</strong>ï¼šå¦‚ HTTP è¯·æ±‚è·¯å¾„ã€æ•°æ®åº“ SQL ç­‰</li>
<li><strong>æ—¶é—´æˆ³</strong>ï¼šå¼€å§‹å’Œç»“æŸæ—¶é—´</li>
<li><strong>Tags</strong>ï¼šé”®å€¼å¯¹å½¢å¼çš„å…ƒæ•°æ®</li>
<li><strong>Logs</strong>ï¼šäº‹ä»¶æ—¥å¿—</li>
</ul>
<h3 id="3-Serviceï¼ˆæœåŠ¡ï¼‰"><a href="#3-Serviceï¼ˆæœåŠ¡ï¼‰" class="headerlink" title="3. Serviceï¼ˆæœåŠ¡ï¼‰"></a>3. Serviceï¼ˆæœåŠ¡ï¼‰</h3><p>æä¾›ä¸€ç»„ç›¸åŒåŠŸèƒ½çš„åº”ç”¨å®ä¾‹çš„é›†åˆã€‚</p>
<h3 id="4-Endpointï¼ˆç«¯ç‚¹ï¼‰"><a href="#4-Endpointï¼ˆç«¯ç‚¹ï¼‰" class="headerlink" title="4. Endpointï¼ˆç«¯ç‚¹ï¼‰"></a>4. Endpointï¼ˆç«¯ç‚¹ï¼‰</h3><p>æœåŠ¡ä¸­çš„å…·ä½“è·¯å¾„æˆ– URIï¼Œä»£è¡¨ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½å…¥å£ã€‚</p>
<h2 id="ä¸‰ã€Java-Agent-ä½¿ç”¨"><a href="#ä¸‰ã€Java-Agent-ä½¿ç”¨" class="headerlink" title="ä¸‰ã€Java Agent ä½¿ç”¨"></a>ä¸‰ã€Java Agent ä½¿ç”¨</h2><h3 id="1-ä¸‹è½½-SkyWalking-Agent"><a href="#1-ä¸‹è½½-SkyWalking-Agent" class="headerlink" title="1. ä¸‹è½½ SkyWalking Agent"></a>1. ä¸‹è½½ SkyWalking Agent</h3><p>ä» <a href="https://skywalking.apache.org/downloads/">Apache SkyWalking å®˜ç½‘</a> ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ Agentã€‚</p>
<h3 id="2-Agent-ç›®å½•ç»“æ„"><a href="#2-Agent-ç›®å½•ç»“æ„" class="headerlink" title="2. Agent ç›®å½•ç»“æ„"></a>2. Agent ç›®å½•ç»“æ„</h3><pre class="line-numbers language-none"><code class="language-none">skywalking-agent&#x2F;
â”œâ”€â”€ activations&#x2F;          # å¯é€‰æ’ä»¶
â”œâ”€â”€ config&#x2F;              # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ agent.config
â”œâ”€â”€ plugins&#x2F;             # æ ¸å¿ƒæ’ä»¶
â”œâ”€â”€ optional-plugins&#x2F;    # å¯é€‰æ’ä»¶
â”œâ”€â”€ bootstrap-plugins&#x2F;   # å¯åŠ¨æ’ä»¶
â””â”€â”€ skywalking-agent.jar # Agent æ ¸å¿ƒåŒ…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-åº”ç”¨æ¥å…¥"><a href="#3-åº”ç”¨æ¥å…¥" class="headerlink" title="3. åº”ç”¨æ¥å…¥"></a>3. åº”ç”¨æ¥å…¥</h3><h4 id="æ–¹å¼ä¸€ï¼šJVM-å‚æ•°æ–¹å¼"><a href="#æ–¹å¼ä¸€ï¼šJVM-å‚æ•°æ–¹å¼" class="headerlink" title="æ–¹å¼ä¸€ï¼šJVM å‚æ•°æ–¹å¼"></a>æ–¹å¼ä¸€ï¼šJVM å‚æ•°æ–¹å¼</h4><p>åœ¨åº”ç”¨å¯åŠ¨æ—¶æ·»åŠ  JVM å‚æ•°ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> -javaagent:/path/to/skywalking-agent.jar <span class="token punctuation">\</span>
     <span class="token parameter variable">-Dskywalking.agent.service_name</span><span class="token operator">=</span>your-service-name <span class="token punctuation">\</span>
     <span class="token parameter variable">-Dskywalking.collector.backend_service</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:11800 <span class="token punctuation">\</span>
     <span class="token parameter variable">-jar</span> your-application.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="æ–¹å¼äºŒï¼šç¯å¢ƒå˜é‡æ–¹å¼"><a href="#æ–¹å¼äºŒï¼šç¯å¢ƒå˜é‡æ–¹å¼" class="headerlink" title="æ–¹å¼äºŒï¼šç¯å¢ƒå˜é‡æ–¹å¼"></a>æ–¹å¼äºŒï¼šç¯å¢ƒå˜é‡æ–¹å¼</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">SW_AGENT_NAME</span><span class="token operator">=</span>your-service-name
<span class="token builtin class-name">export</span> <span class="token assign-left variable">SW_AGENT_COLLECTOR_BACKEND_SERVICES</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1:11800
<span class="token function">java</span> -javaagent:/path/to/skywalking-agent.jar <span class="token parameter variable">-jar</span> your-application.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="4-æ ¸å¿ƒé…ç½®è¯´æ˜"><a href="#4-æ ¸å¿ƒé…ç½®è¯´æ˜" class="headerlink" title="4. æ ¸å¿ƒé…ç½®è¯´æ˜"></a>4. æ ¸å¿ƒé…ç½®è¯´æ˜</h3><p>ç¼–è¾‘ <code>agent.config</code> æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># æœåŠ¡åç§°ï¼ˆå¿…å¡«ï¼‰</span>
<span class="token key attr-name">agent.service_name</span><span class="token punctuation">=</span><span class="token value attr-value">$&#123;SW_AGENT_NAME:your-application&#125;</span>

<span class="token comment"># OAP Server åœ°å€ï¼ˆå¿…å¡«ï¼‰</span>
<span class="token key attr-name">collector.backend_service</span><span class="token punctuation">=</span><span class="token value attr-value">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:127.0.0.1:11800&#125;</span>

<span class="token comment"># é‡‡æ ·ç‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºè´Ÿæ•°è¡¨ç¤ºå…¨é‡é‡‡é›†ï¼‰</span>
<span class="token comment"># agent.sample_n_per_3_secs=$&#123;SW_AGENT_SAMPLE:-1&#125;</span>

<span class="token comment"># æ˜¯å¦å¿½ç•¥ç‰¹å®šåç¼€çš„ Trace</span>
<span class="token comment"># agent.ignore_suffix=$&#123;SW_AGENT_IGNORE_SUFFIX:.jpg,.jpeg,.js,.css,.png,.bmp,.gif,.ico,.mp3,.mp4&#125;</span>

<span class="token comment"># é™åˆ¶ Span æ•°é‡</span>
<span class="token comment"># agent.span_limit_per_segment=$&#123;SW_AGENT_SPAN_LIMIT:300&#125;</span>

<span class="token comment"># æ’ä»¶é…ç½®</span>
<span class="token comment"># plugin.jdbc.trace_sql_parameters=$&#123;SW_JDBC_TRACE_SQL_PARAMETERS:false&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€æ’ä»¶æœºåˆ¶"><a href="#å››ã€æ’ä»¶æœºåˆ¶" class="headerlink" title="å››ã€æ’ä»¶æœºåˆ¶"></a>å››ã€æ’ä»¶æœºåˆ¶</h2><h3 id="1-æ ¸å¿ƒæ’ä»¶ï¼ˆé»˜è®¤åŠ è½½ï¼‰"><a href="#1-æ ¸å¿ƒæ’ä»¶ï¼ˆé»˜è®¤åŠ è½½ï¼‰" class="headerlink" title="1. æ ¸å¿ƒæ’ä»¶ï¼ˆé»˜è®¤åŠ è½½ï¼‰"></a>1. æ ¸å¿ƒæ’ä»¶ï¼ˆé»˜è®¤åŠ è½½ï¼‰</h3><p>SkyWalking é»˜è®¤åŠ è½½çš„æ’ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>HTTP æ¡†æ¶</strong>ï¼šTomcatã€Jettyã€Spring MVCã€Spring WebFlux</li>
<li><strong>RPC æ¡†æ¶</strong>ï¼šDubboã€gRPCã€Motan</li>
<li><strong>æ•°æ®åº“</strong>ï¼šMySQLã€Oracleã€PostgreSQLã€MongoDBã€Redis</li>
<li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šKafkaã€RabbitMQã€RocketMQã€ActiveMQ</li>
<li><strong>ç¼“å­˜</strong>ï¼šJedisã€Lettuceã€Redisson</li>
<li><strong>æ—¥å¿—æ¡†æ¶</strong>ï¼šLogbackã€Log4jã€Log4j2</li>
</ul>
<h3 id="2-å¯é€‰æ’ä»¶"><a href="#2-å¯é€‰æ’ä»¶" class="headerlink" title="2. å¯é€‰æ’ä»¶"></a>2. å¯é€‰æ’ä»¶</h3><p>ä½äº <code>optional-plugins/</code> ç›®å½•ï¼Œéœ€è¦æ‰‹åŠ¨å¤åˆ¶åˆ° <code>plugins/</code> ç›®å½•æ‰ä¼šç”Ÿæ•ˆï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯ç”¨ Spring Cloud Gateway æ’ä»¶</span>
<span class="token function">cp</span> optional-plugins/apm-spring-cloud-gateway-*.jar plugins/

<span class="token comment"># å¯ç”¨ trace æ—¥å¿—ä¸Šä¸‹æ–‡æ’ä»¶</span>
<span class="token function">cp</span> optional-plugins/apm-trace-ignore-plugin-*.jar plugins/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-è‡ªå®šä¹‰æ’ä»¶å¼€å‘"><a href="#3-è‡ªå®šä¹‰æ’ä»¶å¼€å‘" class="headerlink" title="3. è‡ªå®šä¹‰æ’ä»¶å¼€å‘"></a>3. è‡ªå®šä¹‰æ’ä»¶å¼€å‘</h3><p>å¦‚éœ€ç›‘æ§è‡ªå®šä¹‰ç»„ä»¶ï¼Œå¯ä»¥å¼€å‘ SkyWalking æ’ä»¶ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1. å®šä¹‰å¢å¼ºç‚¹</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyComponentInstrumentation</span> <span class="token keyword">extends</span> <span class="token class-name">ClassInstanceMethodsEnhancePluginDefine</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">ClassMatch</span> <span class="token function">enhanceClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">NameMatch</span><span class="token punctuation">.</span><span class="token function">byName</span><span class="token punctuation">(</span><span class="token string">"com.example.MyComponent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">InstanceMethodsInterceptPoint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getInstanceMethodsInterceptPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InstanceMethodsInterceptPoint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">InstanceMethodsInterceptPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">ElementMatcher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MethodDescription</span><span class="token punctuation">></span></span> <span class="token function">getMethodsMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token function">named</span><span class="token punctuation">(</span><span class="token string">"execute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMethodsInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token string">"com.example.MyComponentInterceptor"</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isOverrideArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 2. å®ç°æ‹¦æˆªå™¨</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyComponentInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">InstanceMethodsAroundInterceptor</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeMethod</span><span class="token punctuation">(</span><span class="token class-name">EnhancedInstance</span> objInst<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allArguments<span class="token punctuation">,</span>
                            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> argumentsTypes<span class="token punctuation">,</span> <span class="token class-name">MethodInterceptResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åˆ›å»º Span</span>
        <span class="token class-name">AbstractSpan</span> span <span class="token operator">=</span> <span class="token class-name">ContextManager</span><span class="token punctuation">.</span><span class="token function">createLocalSpan</span><span class="token punctuation">(</span><span class="token string">"MyComponent/execute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        span<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span><span class="token class-name">ComponentsDefine</span><span class="token punctuation">.</span><span class="token constant">CUSTOM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Tags</span><span class="token punctuation">.</span><span class="token constant">LOGIC_ENDPOINT</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>span<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">afterMethod</span><span class="token punctuation">(</span><span class="token class-name">EnhancedInstance</span> objInst<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allArguments<span class="token punctuation">,</span>
                             <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> argumentsTypes<span class="token punctuation">,</span> <span class="token class-name">Object</span> ret<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç»“æŸ Span</span>
        <span class="token class-name">ContextManager</span><span class="token punctuation">.</span><span class="token function">stopSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMethodException</span><span class="token punctuation">(</span><span class="token class-name">EnhancedInstance</span> objInst<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span>
                                     <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allArguments<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> argumentsTypes<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è®°å½•å¼‚å¸¸</span>
        <span class="token class-name">ContextManager</span><span class="token punctuation">.</span><span class="token function">activeSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="äº”ã€å®è·µè¦ç‚¹"><a href="#äº”ã€å®è·µè¦ç‚¹" class="headerlink" title="äº”ã€å®è·µè¦ç‚¹"></a>äº”ã€å®è·µè¦ç‚¹</h2><h3 id="1-é‡‡æ ·ç­–ç•¥"><a href="#1-é‡‡æ ·ç­–ç•¥" class="headerlink" title="1. é‡‡æ ·ç­–ç•¥"></a>1. é‡‡æ ·ç­–ç•¥</h3><p>æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„é‡‡æ ·ç‡ï¼š</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># å…¨é‡é‡‡é›†ï¼ˆç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼‰</span>
<span class="token key attr-name">agent.sample_n_per_3_secs</span><span class="token punctuation">=</span><span class="token value attr-value">-1</span>

<span class="token comment"># æ¯ 3 ç§’é‡‡æ · 1000 æ¡</span>
<span class="token key attr-name">agent.sample_n_per_3_secs</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>

<span class="token comment"># æ¯ 3 ç§’é‡‡æ · 100 æ¡ï¼ˆé€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼‰</span>
<span class="token key attr-name">agent.sample_n_per_3_secs</span><span class="token punctuation">=</span><span class="token value attr-value">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-æ€§èƒ½ä¼˜åŒ–"><a href="#2-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2. æ€§èƒ½ä¼˜åŒ–"></a>2. æ€§èƒ½ä¼˜åŒ–</h3><p><strong>é™åˆ¶ Span æ•°é‡</strong>ï¼šé¿å…è¶…é•¿è°ƒç”¨é“¾å¯¼è‡´å†…å­˜æº¢å‡º</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">agent.span_limit_per_segment</span><span class="token punctuation">=</span><span class="token value attr-value">300</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>å¿½ç•¥é™æ€èµ„æº</strong>ï¼šå‡å°‘æ— æ•ˆ Trace</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">agent.ignore_suffix</span><span class="token punctuation">=</span><span class="token value attr-value">.jpg,.jpeg,.js,.css,.png,.bmp,.gif,.ico</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>å…³é—­ SQL å‚æ•°è¿½è¸ª</strong>ï¼šé™ä½æ•°æ®é‡ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">plugin.jdbc.trace_sql_parameters</span><span class="token punctuation">=</span><span class="token value attr-value">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-å¸¸è§é—®é¢˜"><a href="#3-å¸¸è§é—®é¢˜" class="headerlink" title="3. å¸¸è§é—®é¢˜"></a>3. å¸¸è§é—®é¢˜</h3><p><strong>Q1ï¼šAgent å¯¹åº”ç”¨æ€§èƒ½å½±å“æœ‰å¤šå¤§ï¼Ÿ</strong></p>
<p>Aï¼šç»è¿‡ä¼˜åŒ–åï¼Œæ€§èƒ½æŸè€—é€šå¸¸åœ¨ 5% ä»¥å†…ã€‚ä¸»è¦å½±å“å› ç´ ï¼š</p>
<ul>
<li>é‡‡æ ·ç‡è®¾ç½®</li>
<li>æ’ä»¶æ•°é‡</li>
<li>ç½‘ç»œä¼ è¾“å¼€é”€</li>
</ul>
<p><strong>Q2ï¼šå¦‚ä½•æ’æŸ¥ Agent æœªç”Ÿæ•ˆï¼Ÿ</strong></p>
<p>Aï¼šæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>JVM å‚æ•°æ˜¯å¦æ­£ç¡®é…ç½®</li>
<li><code>agent.config</code> é…ç½®æ˜¯å¦æ­£ç¡®</li>
<li>OAP Server æ˜¯å¦å¯è®¿é—®</li>
<li>æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„ SkyWalking å¯åŠ¨ä¿¡æ¯</li>
<li>æ£€æŸ¥ <code>logs/skywalking-api.log</code></li>
</ol>
<p><strong>Q3ï¼šå¦‚ä½•åœ¨å®¹å™¨åŒ–ç¯å¢ƒä½¿ç”¨ï¼Ÿ</strong></p>
<p>Aï¼šDockerfile ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8-jre</span>

<span class="token comment"># å¤åˆ¶ Agent</span>
<span class="token instruction"><span class="token keyword">COPY</span> skywalking-agent /skywalking-agent</span>

<span class="token comment"># å¤åˆ¶åº”ç”¨</span>
<span class="token instruction"><span class="token keyword">COPY</span> app.jar /app.jar</span>

<span class="token comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span>
<span class="token instruction"><span class="token keyword">ENV</span> SW_AGENT_NAME=my-service</span>
<span class="token instruction"><span class="token keyword">ENV</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=oap-server:11800</span>

<span class="token comment"># å¯åŠ¨åº”ç”¨</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">"java"</span>, <span class="token string">"-javaagent:/skywalking-agent/skywalking-agent.jar"</span>, <span class="token string">"-jar"</span>, <span class="token string">"/app.jar"</span>]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>Apache SkyWalking ä½œä¸ºä¸€æ¬¾ä¼˜ç§€çš„ APM å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<p>âœ… <strong>é›¶ä¾µå…¥</strong>ï¼šé€šè¿‡ Java Agent æŠ€æœ¯ï¼Œæ— éœ€ä¿®æ”¹ä»£ç <br>âœ… <strong>è½»é‡çº§</strong>ï¼šæ€§èƒ½æŸè€—ä½ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ<br>âœ… <strong>åŠŸèƒ½å…¨é¢</strong>ï¼šè¦†ç›–è¿½è¸ªã€åº¦é‡ã€æ—¥å¿—ç­‰å¤šç»´åº¦ç›‘æ§<br>âœ… <strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ’ä»¶æœºåˆ¶æ”¯æŒè‡ªå®šä¹‰æ‰©å±•<br>âœ… <strong>ç¤¾åŒºæ´»è·ƒ</strong>ï¼šApache é¡¶çº§é¡¹ç›®ï¼ŒæŒç»­æ›´æ–°ç»´æŠ¤</p>
<p>é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ SkyWalkingï¼Œå¯ä»¥æœ‰æ•ˆæå‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆå’Œæ•…éšœæ ¹å› ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://skywalking.apache.org/docs/">Apache SkyWalking å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://github.com/apache/skywalking">SkyWalking GitHub ä»“åº“</a></li>
<li><a href="https://skywalking.apache.org/docs/skywalking-java/latest/en/setup/service-agent/java-agent/README/">SkyWalking æ’ä»¶å¼€å‘æŒ‡å—</a></li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>SkyWalking</tag>
        <tag>APM</tag>
        <tag>åˆ†å¸ƒå¼è¿½è¸ª</tag>
        <tag>å¾®æœåŠ¡ç›‘æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>Shiroç®€ä»‹åŠä½¿ç”¨</title>
    <url>/2018/08/26/framework/shiro-jian-jie-ji-shi-yong/</url>
    <content><![CDATA[<p>ã€€ã€€<strong>Apache Shiroâ„¢</strong> is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management. With Shiroâ€™s easy-to-understand API, you can quickly and easily secure any application â€“ from the smallest mobile applications to the largest web and enterprise applications.</p>
<p>ã€€ã€€Apache Shiroâ„¢æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œå¯æ‰§è¡Œèº«ä»½éªŒè¯ï¼Œæˆæƒï¼ŒåŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚ å€ŸåŠ©Shiroæ˜“äºç†è§£çš„APIï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè½»æ¾åœ°ä¿æŠ¤ä»»ä½•åº”ç”¨ç¨‹åº - ä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„Webå’Œä¼ä¸šåº”ç”¨ç¨‹åºã€‚</p>
<p>#ä¸€ã€Apache Shiroç®€ä»‹</p>
<p>ã€€ã€€Apache Shiroçš„é¦–è¦ç›®æ ‡æ˜¯æ˜“äºä½¿ç”¨å’Œç†è§£ã€‚å®‰å…¨æœ‰æ—¶å¯èƒ½éå¸¸å¤æ‚ï¼Œç”šè‡³æ˜¯ç—›è‹¦çš„ï¼Œä½†å¹¶éå¿…é¡»å¦‚æ­¤ã€‚æ¡†æ¶åº”å°½å¯èƒ½æ©ç›–å¤æ‚æ€§ï¼Œå¹¶æä¾›ç®€æ´ç›´è§‚çš„APIï¼Œä»¥ç®€åŒ–å¼€å‘äººå‘˜ç¡®ä¿å…¶åº”ç”¨ç¨‹åºå®‰å…¨çš„å·¥ä½œã€‚</p>
<p>##1ã€Apache Shiroå¯ä»¥åšçš„ä¸€äº›äº‹æƒ…ï¼š</p>
<ul>
<li>éªŒè¯ç”¨æˆ·ä»¥éªŒè¯å…¶èº«ä»½</li>
<li>ä¸ºç”¨æˆ·æ‰§è¡Œè®¿é—®æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š<ul>
<li>ç¡®å®šæ˜¯å¦ä¸ºç”¨æˆ·åˆ†é…äº†æŸä¸ªå®‰å…¨è§’è‰²</li>
<li>ç¡®å®šæ˜¯å¦å…è®¸ç”¨æˆ·æ‰§è¡ŒæŸäº›æ“ä½œ</li>
</ul>
</li>
<li>åœ¨ä»»ä½•ç¯å¢ƒä¸­ä½¿ç”¨Session APIï¼Œå³ä½¿æ²¡æœ‰Webå®¹å™¨æˆ–EJBå®¹å™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li>
<li>åœ¨èº«ä»½éªŒè¯ï¼Œè®¿é—®æ§åˆ¶æˆ–ä¼šè¯ç”Ÿå‘½å‘¨æœŸå†…å¯¹äº‹ä»¶åšå‡ºååº”ã€‚</li>
<li>èšåˆç”¨æˆ·å®‰å…¨æ•°æ®çš„1ä¸ªæˆ–å¤šä¸ªæ•°æ®æºï¼Œå¹¶å°†å…¶å…¨éƒ¨æ˜¾ç¤ºä¸ºå•ä¸ªå¤åˆç”¨æˆ·â€œè§†å›¾â€ã€‚</li>
<li>å¯ç”¨å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åŠŸèƒ½</li>
<li>æ— éœ€ç™»å½•å³å¯ä¸ºç”¨æˆ·å…³è”å¯ç”¨â€œè®°ä½æˆ‘â€æœåŠ¡</li>
</ul>
<p>ã€€ã€€Shiroå°è¯•ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åºç¯å¢ƒå®ç°è¿™äº›åŠŸèƒ½ - ä»æœ€ç®€å•çš„å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„ä¼ä¸šåº”ç”¨ç¨‹åºï¼Œè€Œä¸ä¼šå¼ºåˆ¶ä¾èµ–å…¶ä»–ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œå®¹å™¨æˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨ã€‚å½“ç„¶ï¼Œè¯¥é¡¹ç›®æ—¨åœ¨å°½å¯èƒ½åœ°èå…¥è¿™äº›ç¯å¢ƒï¼Œä½†å®ƒå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­å¼€ç®±å³ç”¨ã€‚</p>
<p>##2ã€Shiroçš„åŠŸèƒ½ç‰¹æ€§</p>
<p>Apache Shiroæ˜¯ä¸€ä¸ªå…·æœ‰è®¸å¤šåŠŸèƒ½çš„ç»¼åˆåº”ç”¨ç¨‹åºå®‰å…¨æ¡†æ¶ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†Shiroä¸»è¦å…³æ³¨ç‚¹ï¼š</p>
<p><img src="/2018/08/26/framework/shiro-jian-jie-ji-shi-yong/ShiroFeatures.png" alt="shiroåŠŸèƒ½"></p>
<p>Shiroé’ˆå¯¹åº”ç”¨ç¨‹åºå®‰å…¨çš„å››å¤§åŸºç¡€-Authentication, Authorization, Session Management, and Cryptography:</p>
<ul>
<li><strong>Authentication:</strong> èº«ä»½è®¤è¯&#x2F;ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ï¼›</li>
<li><strong>Authorization:</strong> æˆæƒï¼Œå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼›</li>
<li><strong>Session Management:</strong> ä¼šè¯ç®¡ç†ï¼Œå³ç”¨æˆ·ç™»å½•åå°±æ˜¯ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨æ²¡æœ‰é€€å‡ºä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¼šè¯ä¸­ï¼›</li>
<li><strong>Cryptography:</strong> åŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æ˜æ–‡å­˜å‚¨ï¼›</li>
</ul>
<p>åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºç¯å¢ƒä¸­è¿˜æœ‰å…¶ä»–åŠŸèƒ½å¯ä»¥æ”¯æŒå’Œå¼ºåŒ–è¿™äº›é—®é¢˜ï¼Œå°¤å…¶æ˜¯ï¼š</p>
<ul>
<li>Web Supportï¼šShiroçš„Webæ”¯æŒAPIå¯å¸®åŠ©è½»æ¾ä¿æŠ¤Webåº”ç”¨ç¨‹åºã€‚</li>
<li>Cachingï¼šç¼“å­˜ï¼Œç¡®ä¿å®‰å…¨æ“ä½œä¿æŒå¿«é€Ÿé«˜æ•ˆã€‚</li>
<li>Concurrencyï¼šApache Shiroæ”¯æŒå…·æœ‰å¹¶å‘åŠŸèƒ½çš„å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºã€‚</li>
<li>Testingï¼šå­˜åœ¨æµ‹è¯•æ”¯æŒä»¥å¸®åŠ©æ‚¨ç¼–å†™å•å…ƒå’Œé›†æˆæµ‹è¯•ï¼Œå¹¶ç¡®ä¿æ‚¨çš„ä»£ç æŒ‰é¢„æœŸå—åˆ°ä¿æŠ¤ã€‚</li>
<li>â€œRun Asâ€ï¼šå…è®¸ç”¨æˆ·å‡å®šå…¶ä»–ç”¨æˆ·çš„èº«ä»½ï¼ˆå¦‚æœå…è®¸ï¼‰çš„åŠŸèƒ½ï¼Œæœ‰æ—¶åœ¨ç®¡ç†æ–¹æ¡ˆä¸­å¾ˆæœ‰ç”¨ã€‚</li>
<li>â€œRemember Meâ€ï¼šè®°ä½ç”¨æˆ·åœ¨ä¼šè¯ä¸­çš„èº«ä»½ï¼Œè¿™æ ·ä»–ä»¬åªéœ€è¦åœ¨å¼ºåˆ¶è¦æ±‚æ—¶ç™»å½•ã€‚</li>
</ul>
<h2 id="3ã€Shiroæ¶æ„"><a href="#3ã€Shiroæ¶æ„" class="headerlink" title="3ã€Shiroæ¶æ„"></a>3ã€Shiroæ¶æ„</h2><p>Apache Shiroçš„è®¾è®¡ç›®æ ‡æ˜¯é€šè¿‡ç›´è§‚å’Œæ˜“ç”¨æ¥ç®€åŒ–åº”ç”¨ç¨‹åºå®‰å…¨æ€§ã€‚Shiroçš„æ ¸å¿ƒè®¾è®¡æ¨¡æ‹Ÿäº†å¤§å¤šæ•°äººå¯¹åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„çœ‹æ³• - åœ¨æŸäººï¼ˆæˆ–æŸäº‹ï¼‰ä¸åº”ç”¨ç¨‹åºäº¤äº’çš„ç¯å¢ƒä¸­ã€‚ </p>
<p>shiroæ¶æ„æœ‰ä¸‰ä¸ªä¸»è¦æ¦‚å¿µï¼šSubjectï¼ŒSecurityManagerå’ŒRealmsã€‚ä¸‹å›¾æ˜¯è¿™äº›ç»„å»ºå¦‚ä½•äº¤äº’çš„é«˜çº§æ¦‚è¿°ã€ä¹‹åä»‹ç»æ¯ä¸ªæ¦‚å¿µï¼š</p>
<p><img src="/2018/08/26/framework/shiro-jian-jie-ji-shi-yong/ShiroBasicArchitecture.png" alt="shiroæ¶æ„"></p>
<ul>
<li><p><strong>Subject:</strong>  ä¸»ä½“ï¼Œ<code>Subject</code>ä»£è¡¨äº†ä¸å½“å‰åº”ç”¨ç¨‹åºè¿›è¡Œå®‰å…¨äº¤äº’çš„â€œç”¨æˆ·â€ã€‚è™½ç„¶â€œç”¨æˆ·â€è¿™ä¸ªè¯é€šå¸¸æ„å‘³ç€ä¸€ä¸ªå…·ä½“çš„äººï¼Œä½†æ˜¯å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªäººï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä»£è¡¨ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œå®ˆæŠ¤è¿›ç¨‹å¸æˆ·ï¼Œcronä½œä¸šæˆ–ä»»ä½•ç±»ä¼¼çš„ä¸œè¥¿ - åŸºæœ¬ä¸Šä»»ä½•ä¸è½¯ä»¶äº¤äº’çš„ä¸œè¥¿ã€‚</p>
<p><code>Subject</code>å®ä¾‹éƒ½ç»‘å®šåˆ°<code>SecurityManager</code>ï¼Œå½“æ‚¨ä¸<code>Subject</code>â€˜è¿›è¡Œäº¤äº’æ—¶ï¼Œè¿™äº›äº¤äº’ä¼šå§”æ‰˜ç»™<code>Subject</code>ç»‘å®šçš„<code>SecurityManager</code>ã€‚</p>
</li>
<li><p><strong>SecurityManager:</strong> å®‰å…¨ç®¡ç†å™¨ï¼Œ<code>SecurityManager</code>æ˜¯shiroæ¶æ„çš„æ ¸å¿ƒï¼Œ<code>SecurityManager</code>ç®¡ç†ç€æ‰€æœ‰çš„<code>Subject</code>,æ‰€æœ‰ä¸å®‰å…¨æœ‰å…³çš„æ“ä½œéƒ½ä¼šä¸<code>SecurityManager</code>äº¤äº’.</p>
</li>
<li><p><strong>Realm:</strong> åŸŸï¼Œå……å½“Shiroä¸åº”ç”¨ç¨‹åºå®‰å…¨æ•°æ®ä¹‹é—´çš„â€œæ¡¥æ¢â€æˆ–â€œè¿æ¥å™¨â€ã€‚å½“å®é™…ä¸å®‰å…¨ç›¸å…³çš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ·å¸æˆ·ï¼‰è¿›è¡Œäº¤äº’ä»¥æ‰§è¡Œèº«ä»½éªŒè¯ï¼ˆç™»å½•ï¼‰å’Œæˆæƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰æ—¶ï¼ŒShiroä¼šä»ä¸ºåº”ç”¨ç¨‹åºé…ç½®çš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢†åŸŸä¸­æŸ¥æ‰¾è®¸å¤šè¿™äº›å†…å®¹ã€‚</p>
<p>ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼ŒRealmæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å®‰å…¨æ€§çš„<a href="https://en.wikipedia.org/wiki/Data_access_object">DAO</a>ï¼šå®ƒå°è£…äº†æ•°æ®æºçš„è¿æ¥ç»†èŠ‚ï¼Œå¹¶æ ¹æ®éœ€è¦ä½¿ç›¸å…³æ•°æ®å¯ç”¨äºShiroã€‚é…ç½®Shiroæ—¶ï¼Œå¿…é¡»è‡³å°‘æŒ‡å®šä¸€ä¸ªRealmç”¨äºèº«ä»½éªŒè¯å’Œ&#x2F;æˆ–æˆæƒã€‚</p>
<p>Shiroæä¾›äº†å¼€ç®±å³ç”¨çš„é¢†åŸŸï¼Œå¯ä»¥è¿æ¥åˆ°è®¸å¤šå®‰å…¨æ•°æ®æºï¼ˆä¹Ÿç§°ä¸ºç›®å½•ï¼‰ï¼Œå¦‚LDAPï¼Œå…³ç³»æ•°æ®åº“ï¼ˆJDBCï¼‰ï¼Œæ–‡æœ¬é…ç½®æºï¼ˆå¦‚INIå’Œå±æ€§æ–‡ä»¶ç­‰ï¼‰ã€‚å¦‚æœé»˜è®¤åŸŸä¸ç¬¦åˆæ‚¨çš„éœ€è¦ï¼Œæ‚¨å¯ä»¥æ’å…¥è‡ªå·±çš„Realmå®ç°æ¥è¡¨ç¤ºè‡ªå®šä¹‰æ•°æ®æº</p>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong> ä»ä¸Šè¿°å¯ä»¥çœ‹å‡ºï¼Œshiroä¸æä¾›ç»´æŠ¤ç”¨æˆ·å’Œæƒé™çš„åŠŸèƒ½ï¼Œè€Œæ˜¯é€šè¿‡realmè®©ç”¨æˆ·è‡ªå·±æ¥å®ç°ã€‚</p>
<h3 id="shiroè¯¦ç»†æ¶æ„"><a href="#shiroè¯¦ç»†æ¶æ„" class="headerlink" title="shiroè¯¦ç»†æ¶æ„"></a>shiroè¯¦ç»†æ¶æ„</h3><p>ä¸‹å›¾æ˜¾ç¤ºäº†Shiroçš„æ ¸å¿ƒæ¶æ„æ¦‚å¿µï¼Œåé¢æ˜¯æ¯ä¸ªæ¦‚è¿°çš„ç®€çŸ­æ‘˜è¦ï¼š</p>
<p><img src="/2018/08/26/framework/shiro-jian-jie-ji-shi-yong/ShiroArchitecture.png" alt="shiroè¯¦ç»†æ¶æ„"></p>
<ul>
<li><strong>Subject</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/subject/Subject.html"><code>org.apache.shiro.subject.Subject</code></a>ï¼‰<br>å½“å‰ä¸è½¯ä»¶äº¤äº’çš„å®ä½“ï¼ˆç”¨æˆ·ï¼Œç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ï¼‰çš„â€œç”¨æˆ·â€ã€‚</li>
<li><strong>SecurityManager</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/mgt/SecurityManager.html">org.apache.shiro.mgt.SecurityManager</a>ï¼‰<br>å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™<code>SecurityManager</code>æ˜¯Shiroæ¶æ„çš„æ ¸å¿ƒï¼Œåè°ƒå„ç»„ä»¶ç¨³å®šè¿è¡Œï¼Œæ‰€æœ‰çš„å®‰å…¨ç›¸å…³çš„æ“ä½œéƒ½æ˜¯é€šè¿‡<code>SecurityManager</code>è¿›è¡Œæ§åˆ¶ã€‚</li>
<li><strong>Authenticator</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/Authenticator.html">org.apache.shiro.authc.Authenticator</a>ï¼‰<br>è®¤è¯å™¨ï¼Œè´Ÿè´£æ‰§è¡ŒéªŒè¯ç”¨æˆ·è®¤è¯çš„ç»„ä»¶ã€‚å½“ç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œç”±<code>Authenticator</code>æ‰§è¡Œç”¨æˆ·è®¤è¯çš„é€»è¾‘ã€‚è¯¥<code>Authenticator</code>çŸ¥é“å¦‚ä½•ä¸ä¸€ä¸ªæˆ–å¤šä¸ªå­˜å‚¨ç”¨æˆ·&#x2F;å¸æˆ·ä¿¡æ¯çš„<code>Realms</code>åè°ƒå·¥ä½œã€‚ä»è¿™äº›<code>Realms</code>è·å–çš„æ•°æ®ç”¨äºéªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œä»¥ä¿è¯ç”¨æˆ·ç¡®å®æ˜¯ä»–ä»¬æ‰€è¯´çš„äººã€‚<ul>
<li><strong>Authentication Strategy</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/AuthenticationStrategy.html">org.apache.shiro.authc.pam.AuthenticationStrategy</a>ï¼‰<br>è®¤è¯ç­–ç•¥ï¼Œå¦‚æœå¤šäºä¸€ä¸ª<code>Realm</code>è¢«é…ç½®æ—¶ï¼Œ<code>AuthenticationStrategy</code>å°†ä¸<code>realm</code>åè°ƒï¼Œä»¥ç¡®å®šåœ¨å…¶ä¸‹çš„è®¤è¯å°è¯•æˆåŠŸæˆ–å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª<code>realm</code>è®¤è¯æˆåŠŸä½†æ˜¯å…¶ä»–è®¤è¯å¤±è´¥ï¼Œé‚£ä¹ˆè¿™æ¬¡è®¤è¯æ˜¯æˆåŠŸçš„å—ï¼Ÿå¿…é¡»æ‰€æœ‰<code>realm</code>éƒ½è¦è®¤è¯æˆåŠŸï¼Ÿè¿˜æ˜¯åªéœ€è¦ç¬¬ä¸€ä¸ªï¼Ÿï¼‰ã€‚</li>
</ul>
</li>
<li><strong>Authorizer</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authz/Authorizer.html">org.apache.shiro.authz.Authorizer</a>ï¼‰<br>è®¿é—®æ§åˆ¶å™¨ï¼Œ<code>Authorizer</code>ç¡®å®šâ€œç”¨æˆ·â€åœ¨è¯¥åº”ç”¨ç¨‹åºçš„è®¿é—®æ§åˆ¶æƒé™ã€‚å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸé¡¹æ“ä½œï¼Œæ§åˆ¶ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ç¨‹åºçš„å“ªäº›åŠŸèƒ½ã€‚</li>
<li><strong>SessionManager</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/SessionManager.html">org.apache.shiro.session.mgt.SessionManager</a>ï¼‰<br><code>SessionManager</code>çŸ¥é“å¦‚ä½•åˆ›å»ºå’Œç®¡ç†ç”¨æˆ·<code>Session</code>ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›åœ¨æ‰€æœ‰ç¯å¢ƒä¸­çš„ç”¨æˆ·å¼ºå¤§çš„ä¼šè¯ä½“éªŒã€‚è¿™æ˜¯å®‰å…¨æ¡†æ¶é¢†åŸŸçš„ä¸€é¡¹ç‹¬ç‰¹åŠŸèƒ½ - å³ä½¿æ²¡æœ‰å¯ç”¨çš„Web &#x2F; Servletæˆ–EJBå®¹å™¨ï¼ŒShiroä¹Ÿèƒ½å¤Ÿåœ¨ä»»ä½•ç¯å¢ƒä¸­æœ¬åœ°ç®¡ç†ç”¨æˆ·ä¼šè¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒShiroå°†ä½¿ç”¨ç°æœ‰çš„ä¼šè¯æœºåˆ¶ï¼ˆä¾‹å¦‚Servlet Containerï¼‰ï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œä¾‹å¦‚åœ¨ç‹¬ç«‹åº”ç”¨ç¨‹åºæˆ–éWebç¯å¢ƒä¸­ï¼Œå®ƒå°†ä½¿ç”¨å…¶å†…ç½®çš„ä¼ä¸šä¼šè¯ç®¡ç†æä¾›ç›¸åŒçš„ç¼–ç¨‹ç»éªŒã€‚çš„<code>SessionDAO</code>å­˜åœ¨å…è®¸ä»»ä½•æ•°æ®æºè¢«ç”¨æ¥åšæŒçš„ä¼šè®®ã€‚<ul>
<li><strong>SessionDAO</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/session/mgt/eis/SessionDAO.html">org.apache.shiro.session.mgt.eis.SessionDAO</a>ï¼‰<br><code>SessionDAO</code>æ‰§è¡Œ<code>Session</code>ä»£è¡¨çš„æŒä¹…æ€§ï¼ˆCRUDï¼‰æ“ä½œ<code>SessionManager</code>ã€‚è¿™å…è®¸å°†ä»»ä½•æ•°æ®å­˜å‚¨æ’å…¥ä¼šè¯ç®¡ç†åŸºç¡€ç»“æ„ã€‚</li>
</ul>
</li>
<li><strong>CacheManager</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/cache/CacheManager.html">org.apache.shiro.cache.CacheManager</a>ï¼‰<br><code>CacheManager</code>åˆ›å»ºå’Œç®¡ç†<code>Cache</code>å…¶ä»–å››éƒç»„ä»¶ä½¿ç”¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ç”±äºShiroå¯ä»¥è®¿é—®è®¸å¤šåç«¯æ•°æ®æºä»¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæˆæƒå’Œä¼šè¯ç®¡ç†ï¼Œå› æ­¤ç¼“å­˜ä¸€ç›´æ˜¯æ¡†æ¶ä¸­çš„ä¸€æµæ¶æ„åŠŸèƒ½ï¼Œå¯åœ¨ä½¿ç”¨è¿™äº›æ•°æ®æºæ—¶æé«˜æ€§èƒ½ã€‚ä»»ä½•ç°ä»£å¼€æºå’Œ&#x2F;æˆ–ä¼ä¸šç¼“å­˜äº§å“éƒ½å¯ä»¥æ’å…¥Shiroï¼Œä»¥æä¾›å¿«é€Ÿæœ‰æ•ˆçš„ç”¨æˆ·ä½“éªŒã€‚</li>
<li><strong>Cryptography</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/crypto/package-summary.html">org.apache.shiro.crypto</a>ï¼‰<br>å¯†ç æ¨¡å—ï¼ŒShiroæä¾›äº†ä¸€äº›å¸¸è§çš„åŠ å¯†ç»„ä»¶ç”¨äºå¦‚å¯†ç åŠ å¯†&#x2F;è§£å¯†çš„ã€‚è¯¥è½¯ä»¶åŒ…ä¸­çš„æ‰€æœ‰ç±»éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œæ˜“äºä½¿ç”¨ä¸”æ˜“äºç†è§£ã€‚</li>
<li><strong>Realms</strong>ï¼ˆ<a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/realm/Realm.html">org.apache.shiro.realm.Realm</a>ï¼‰<br>å¦‚ä¸Šæ‰€è¿°ï¼ŒRealmså……å½“Shiroå’Œåº”ç”¨ç¨‹åºå®‰å…¨æ•°æ®ä¹‹é—´çš„â€œæ¡¥æ¥â€æˆ–â€œè¿æ¥å™¨â€ã€‚å½“å®é™…ä¸å®‰å…¨ç›¸å…³çš„æ•°æ®ï¼ˆå¦‚ç”¨æˆ·å¸æˆ·ï¼‰è¿›è¡Œäº¤äº’ä»¥æ‰§è¡Œèº«ä»½éªŒè¯ï¼ˆç™»å½•ï¼‰å’Œæˆæƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰æ—¶ï¼ŒShiroä¼šä»ä¸ºåº”ç”¨ç¨‹åºé…ç½®çš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢†åŸŸä¸­æŸ¥æ‰¾è®¸å¤šè¿™äº›å†…å®¹ã€‚æ‚¨å¯ä»¥æ ¹æ®<code>Realms</code>éœ€è¦é…ç½®ä»»æ„æ•°é‡ï¼ˆé€šå¸¸æ¯ä¸ªæ•°æ®æºä¸€ä¸ªï¼‰ï¼ŒShiroå°†æ ¹æ®éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒåè°ƒã€‚</li>
</ul>
<h1 id="äºŒã€Shiroæ ¸å¿ƒåŠŸèƒ½"><a href="#äºŒã€Shiroæ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="äºŒã€Shiroæ ¸å¿ƒåŠŸèƒ½"></a>äºŒã€Shiroæ ¸å¿ƒåŠŸèƒ½</h1><p>ä¸Šé¢ä¸»è¦ä»‹ç»äº†shiroçš„åŠŸèƒ½ç‰¹æ€§åŠæ¶æ„ï¼Œä¸‹é¢ä»‹ç»shiroçš„æ ¸å¿ƒåŠŸèƒ½çš„ä½¿ç”¨ã€‚</p>
<h2 id="1ã€Shiroèº«ä»½éªŒè¯"><a href="#1ã€Shiroèº«ä»½éªŒè¯" class="headerlink" title="1ã€Shiroèº«ä»½éªŒè¯"></a>1ã€Shiroèº«ä»½éªŒè¯</h2><p><strong>èº«ä»½éªŒè¯</strong>è¿‡ç¨‹å°±æ˜¯è¯æ˜ç”¨æˆ·å®é™…ä¸Šæ˜¯ä»–ä»¬æ‰€è¯´çš„äººï¼Œä¸ºäº†è®©ç”¨æˆ·è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œä»–ä»¬éœ€è¦æä¾›ä¸€äº›èƒ½å¤Ÿè®©ç³»ç»Ÿè¯†åˆ«å’Œä¿¡ä»»çš„èº«ä»½è¯æ˜ã€‚</p>
<p>åœ¨shiroä¸­ï¼Œç”¨æˆ·éœ€è¦æä¾›principals ï¼ˆèº«ä»½ï¼‰å’Œcredentialsï¼ˆè¯æ˜ï¼‰ç»™shiroï¼Œä»è€Œåº”ç”¨èƒ½éªŒè¯ç”¨æˆ·èº«ä»½ï¼š</p>
<p><strong>principals</strong>ï¼šèº«ä»½ï¼Œå³ä¸»ä½“çš„æ ‡è¯†å±æ€§ï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œå¦‚ç”¨æˆ·åã€é‚®ç®±ç­‰ï¼Œå”¯ä¸€å³å¯ã€‚ä¸€ä¸ªä¸»ä½“å¯ä»¥æœ‰å¤šä¸ªprincipalsï¼Œä½†åªæœ‰ä¸€ä¸ªPrimary principalsï¼Œä¸€èˆ¬æ˜¯ç”¨æˆ·å&#x2F;å¯†ç &#x2F;æ‰‹æœºå·ã€‚</p>
<p><strong>credentials</strong>ï¼šè¯æ˜&#x2F;å‡­è¯ï¼Œå³åªæœ‰ä¸»ä½“çŸ¥é“çš„å®‰å…¨å€¼ï¼Œå¦‚å¯†ç &#x2F;æ•°å­—è¯ä¹¦ç­‰ã€‚</p>
<p>æœ€å¸¸è§çš„principalså’Œcredentialsç»„åˆå°±æ˜¯ç”¨æˆ·å&#x2F;å¯†ç äº†ã€‚æ¥ä¸‹æ¥å…ˆè¿›è¡Œä¸€ä¸ªåŸºæœ¬çš„èº«ä»½è®¤è¯ã€‚</p>
<h2 id="2ã€èº«ä»½éªŒè¯æ­¥éª¤"><a href="#2ã€èº«ä»½éªŒè¯æ­¥éª¤" class="headerlink" title="2ã€èº«ä»½éªŒè¯æ­¥éª¤"></a>2ã€èº«ä»½éªŒè¯æ­¥éª¤</h2><p>Subjectèº«ä»½éªŒè¯çš„è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>1ã€æ”¶é›†ç”¨æˆ·èº«ä»½&#x2F;å‡­è¯ï¼Œå³å¦‚ç”¨æˆ·å&#x2F;å¯†ç ã€‚</li>
<li>2ã€æäº¤ç”¨æˆ·èº«ä»½&#x2F;å‡­è¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li>
<li>3ã€å¦‚æœæäº¤æˆåŠŸï¼Œåˆ™å…è®¸è®¿é—®ï¼Œå¦åˆ™é‡è¯•èº«ä»½éªŒè¯æˆ–é˜»æ­¢è®¿é—®ã€‚</li>
</ul>
<p>æ¥ä¸€ä¸‹æ¥ç»“åˆä»£ç å¯¹ä¸Šè¿°çš„ä¸‰ä¸ªæ­¥éª¤è¿›è¡Œè¯´æ˜ã€‚</p>
<p><strong>æ­¥éª¤ä¸€ï¼šæ”¶é›†ç”¨æˆ·èº«ä»½&#x2F;å‡­è¯ï¼Œå³å¦‚ç”¨æˆ·å&#x2F;å¯†ç </strong></p>
<pre class="line-numbers language-//Example" data-language="//Example"><div class="caption"><span>using most common scenario of username/password pair:</span></div><code class="language-//Example">&#x2F;&#x2F;Example using most common scenario of username&#x2F;password pair:
UsernamePasswordToken token &#x3D; new UsernamePasswordToken(username, password);

&#x2F;&#x2F;&quot;Remember Me&quot; built-in: 
token.setRememberMe(true);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨å½“å‰çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†UsernamePasswordTokenï¼Œæ”¯æŒæœ€å¸¸è§çš„ç”¨æˆ·å&#x2F;å¯†ç èº«ä»½éªŒè¯æ–¹æ³•ã€‚è¿™æ˜¯Shiroçš„org.apache.shiro.authc.AuthenticationTokenæ¥å£çš„å®ç°ï¼Œè¯¥æ¥å£æ˜¯Shiroçš„èº«ä»½éªŒè¯ç³»ç»Ÿç”¨æ¥è¡¨ç¤ºæäº¤çš„èº«ä»½ä¿¡æ¯å’Œå‡­æ®çš„åŸºæœ¬æ¥å£ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒShiroä¸å…³å¿ƒå¦‚ä½•è·å–è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥ä»httpè¡¨å•ä¸­è·å–ï¼Œä¹Ÿå¯ä»¥ä»httpè¯·æ±‚å¤´ä¸­è·å–ï¼Œæˆ–è€…é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è·å–ã€‚åº”ç”¨ç¨‹åºè·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯å’Œå‡­è¯çš„è¿‡ç¨‹ä¸ä¸Shiroçš„AuthenticationTokenæ¦‚å¿µå®Œå…¨åˆ†ç¦»ã€‚</p>
<p>è¿™ä¸ªä¾‹å­è¿˜è¡¨æ˜æˆ‘ä»¬å·²ç»è¡¨ç¤ºå¸Œæœ›Shiroä¸ºèº«ä»½éªŒè¯å°è¯•æ‰§è¡Œâ€œè®°ä½æˆ‘â€æœåŠ¡ã€‚è¿™å¯ç¡®ä¿Shiroåœ¨ä»¥åè¿”å›åº”ç”¨ç¨‹åºæ—¶è®°ä½ç”¨æˆ·èº«ä»½ã€‚</p>
<p><strong>æ­¥éª¤äºŒï¼šæäº¤ç”¨æˆ·èº«ä»½å’Œå‡­è¯</strong></p>
<p>åœ¨æ”¶é›†äº†ç”¨æˆ·èº«ä»½å’Œå‡­æ®å¹¶å°†å…¶è¡¨ç¤ºä¸ºAuthenticationTokenå®ä¾‹åï¼Œæˆ‘ä»¬éœ€è¦å°†tokenæäº¤ç»™Shiroä»¥æ‰§è¡Œå®é™…çš„èº«ä»½éªŒè¯å°è¯•ï¼š</p>
<pre class="line-numbers language-Subject" data-language="Subject"><div class="caption"><span>currentUser </span></div><code class="language-Subject">Subject currentUser &#x3D; SecurityUtils.getSubject();
currentUser.login(token);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„Subjectåï¼Œæˆ‘ä»¬è¿›è¡Œä¸€æ¬¡ç™»å½•è°ƒç”¨ï¼Œä¼ å…¥æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„AuthenticationTokenå®ä¾‹ã€‚</p>
<p><strong>æ­¥éª¤ä¸‰ï¼šå¤„ç†éªŒè¯ç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰</strong></p>
<p>å¦‚æœç™»å½•æ–¹æ³•æ­£å¸¸åœ°è¿”å›ï¼Œæ­¤æ¬¡éªŒè¯å®Œæˆï¼Œç”¨æˆ·å·²ç»è¿‡èº«ä»½éªŒè¯ã€‚ åº”ç”¨ç¨‹åºçº¿ç¨‹å¯ä»¥ç»§ç»­ä¸é—´æ–­ï¼Œæ‰€æœ‰å¯¹SecurityUtils.getSubjectï¼ˆï¼‰çš„è¿›ä¸€æ­¥è°ƒç”¨å°†è¿”å›ç»è¿‡èº«ä»½éªŒè¯çš„Subjectå®ä¾‹ä»¥åŠå¯¹subjectçš„ä»»ä½•è°ƒç”¨ã€‚ <code>isAuthenticated()</code>å°†è¿”å›trueã€‚</p>
<p>ä½†æ˜¯å¦‚æœç™»å½•å°è¯•å¤±è´¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ä¾‹å¦‚ï¼Œå¦‚æœæœ€ç»ˆç”¨æˆ·æä¾›äº†é”™è¯¯çš„å¯†ç ï¼Œæˆ–è€…è®¿é—®äº†ç³»ç»Ÿå¤ªå¤šæ¬¡å¹¶ä¸”ä»–ä»¬çš„å¸æˆ·è¢«é”å®šäº†æ€ä¹ˆåŠï¼Ÿ</p>
<p>Shiroå…·æœ‰ä¸°å¯Œçš„è¿è¡Œæ—¶AuthenticationExceptionå±‚æ¬¡ç»“æ„ï¼Œå¯ä»¥å‡†ç¡®æŒ‡ç¤ºå°è¯•å¤±è´¥çš„åŸå› ã€‚ æ‚¨å¯ä»¥åœ¨try &#x2F; catchå—ä¸­åŒ…è£…ç™»å½•å¹¶æ•è·æ‚¨å¸Œæœ›çš„ä»»ä½•å¼‚å¸¸å¹¶ç›¸åº”åœ°å¯¹å®ƒä»¬åšå‡ºååº”ã€‚ ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">try &#123;
    currentUser.login(token);
&#125; catch ( UnknownAccountException uae ) &#123; ...&#x2F;&#x2F;ç”¨æˆ·åé”™è¯¯
&#125; catch ( IncorrectCredentialsException ice ) &#123; ...&#x2F;&#x2F;å¯†ç é”™è¯¯
&#125; catch ( LockedAccountException lae ) &#123; ...&#x2F;&#x2F;è´¦å·é”å®š
&#125; catch ( ExcessiveAttemptsException eae ) &#123; ...&#x2F;&#x2F;è¶…è¿‡æœ€å¤§ç™»å½•å¤±è´¥å°è¯•æ¬¡æ•°
&#125; ... catch your own ...
&#125; catch ( AuthenticationException ae ) &#123;
    &#x2F;&#x2F;unexpected error?
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦‚æœå…¶ä¸­ä¸€ä¸ªç°æœ‰å¼‚å¸¸ç±»ä¸æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œåˆ™å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰AuthenticationExceptionsä»¥è¡¨ç¤ºç‰¹å®šçš„å¼‚å¸¸ã€‚</p>
<p><strong>Remembered vs. Authenticated</strong></p>
<p>å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œé™¤äº†æ­£å¸¸çš„ç™»å½•è¿‡ç¨‹å¤–ï¼ŒShiroè¿˜æ”¯æŒâ€œè®°ä½æˆ‘â€çš„æ¦‚å¿µã€‚ å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼ŒShiroåœ¨<em>remembered</em> Subjectå’Œå®é™…<em>authenticated</em> Subjectä¹‹é—´åšäº†éå¸¸ç²¾ç¡®çš„åŒºåˆ†ï¼š</p>
<ul>
<li><p><strong>Remembered</strong>ï¼š<em>remembered</em> Subjectä¸æ˜¯åŒ¿åçš„å¹¶ä¸”å…·æœ‰å·²çŸ¥çš„èº«ä»½ï¼ˆå³subject.getPrincipalsï¼ˆï¼‰éç©ºï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨å…ˆå‰çš„ä¼šè¯æœŸé—´ï¼Œå…ˆå‰çš„èº«ä»½éªŒè¯ä¼šè®°ä½æ­¤èº«ä»½ã€‚ å¦‚æœsubject.isRememberedï¼ˆï¼‰è¿”å›trueï¼Œåˆ™è®¤ä¸ºsubjectè¢«è®°ä½ã€‚</p>
</li>
<li><p><strong>Authenticated</strong>ï¼š<em>authenticated</em> Subjectæ˜¯åœ¨subjectçš„å½“å‰ä¼šè¯æœŸé—´å·²æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯çš„ä¸»é¢˜ï¼ˆå³ï¼Œåœ¨ä¸æŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¸‹è°ƒç”¨ç™»å½•æ–¹æ³•ï¼‰ã€‚ å¦‚æœsubject.isAuthenticatedï¼ˆï¼‰è¿”å›trueï¼Œåˆ™è®¤ä¸ºsubjectå·²ç»è¿‡èº«ä»½éªŒè¯ã€‚</p>
</li>
</ul>
<h2 id="ä¸‰ã€èº«ä»½éªŒè¯æµç¨‹"><a href="#ä¸‰ã€èº«ä»½éªŒè¯æµç¨‹" class="headerlink" title="ä¸‰ã€èº«ä»½éªŒè¯æµç¨‹"></a>ä¸‰ã€èº«ä»½éªŒè¯æµç¨‹</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªç ”ç©¶äº†å¦‚ä½•ä»åº”ç”¨ç¨‹åºä»£ç ä¸­éªŒè¯subjectã€‚ ç°åœ¨æˆ‘ä»¬å°†ä»‹ç»åœ¨å‘ç”Ÿèº«ä»½éªŒè¯æ—¶Shiroå†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<p>æˆ‘ä»¬ä»æ¶æ„ç« èŠ‚ä¸­è·å–äº†æˆ‘ä»¬ä¹‹å‰çš„æ¶æ„å›¾ï¼Œå¹¶ä¸”åªä¿ç•™äº†ä¸èº«ä»½éªŒè¯ç›¸å…³çš„ç»„ä»¶ã€‚ æ¯ä¸ªæ•°å­—ä»£è¡¨èº«ä»½éªŒè¯å°è¯•æœŸé—´çš„ä¸€ä¸ªæ­¥éª¤ï¼š</p>
<p><img src="/2018/08/26/framework/shiro-jian-jie-ji-shi-yong/ShiroAuthenticationSequence.png" alt="èº«ä»½éªŒè¯æµç¨‹"></p>
<ul>
<li><p><strong>æ­¥éª¤1</strong>ï¼šåº”ç”¨ç¨‹åºä»£ç è°ƒç”¨Subject.loginæ–¹æ³•ï¼Œä¼ å…¥æ„é€ çš„AuthenticationTokenå®ä¾‹ï¼Œè¡¨ç¤ºæœ€ç»ˆç”¨æˆ·çš„èº«ä»½å’Œå‡­è¯ã€‚</p>
</li>
<li><p><strong>æ­¥éª¤2</strong>ï¼šSubjectå®ä¾‹ï¼Œé€šå¸¸æ˜¯DelegatingSubjectï¼ˆæˆ–å­ç±»ï¼‰ï¼Œé€šè¿‡è°ƒç”¨securityManager.loginï¼ˆtokenï¼‰å§”æ‰˜åº”ç”¨ç¨‹åºçš„SecurityManagerï¼Œå…¶ä¸­å®é™…çš„èº«ä»½éªŒè¯å·¥ä½œå¼€å§‹ã€‚</p>
</li>
<li><p><strong>æ­¥éª¤3</strong>ï¼šSecurityManageræ¥æ”¶tokentï¼Œå¹¶é€šè¿‡è°ƒç”¨authenticator.authenticateï¼ˆtokenï¼‰ç®€å•åœ°å§”æ‰˜ç»™å…¶å†…éƒ¨Authenticatorinstanceã€‚ä¸€èˆ¬æ˜¯ModularRealmAuthenticatorå®ä¾‹ï¼Œå®ƒæ”¯æŒåœ¨èº«ä»½éªŒè¯æœŸé—´åè°ƒä¸€ä¸ªæˆ–å¤šä¸ªRealmå®ä¾‹ã€‚ ModularRealmAuthenticatorå®è´¨ä¸Šä¸ºApache Shiroæä¾›äº†PAMé£æ ¼çš„èŒƒä¾‹ï¼ˆå…¶ä¸­æ¯ä¸ªrealméƒ½æ˜¯PAMæœ¯è¯­ä¸­çš„â€œæ¨¡å—â€ï¼‰ã€‚</p>
</li>
<li><p><strong>æ­¥éª¤4</strong>ï¼šå¦‚æœä¸ºåº”ç”¨ç¨‹åºé…ç½®äº†å¤šä¸ªRealmï¼Œåˆ™ModularRealmAuthenticatorå®ä¾‹å°†ä½¿ç”¨å…¶é…ç½®çš„AuthenticationStrategyå¯åŠ¨å¤šRealmèº«ä»½éªŒè¯å°è¯•ã€‚åœ¨è°ƒç”¨Realmsè¿›è¡Œèº«ä»½éªŒè¯ä¹‹å‰ï¼ŒæœŸé—´å’Œä¹‹åï¼Œå°†è°ƒç”¨AuthenticationStrategyä»¥å…è®¸å®ƒå¯¹æ¯ä¸ªRealmçš„ç»“æœåšå‡ºååº”ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šä»‹ç»AuthenticationStrategiesã€‚</p>
<ul>
<li><strong>æ³¨æ„</strong>ï¼šå¦‚æœåªé…ç½®äº†ä¸€ä¸ªRealmï¼Œåˆ™ç›´æ¥è°ƒç”¨å®ƒ ï¼Œåœ¨å•Realmåº”ç”¨ç¨‹åºä¸­ä¸éœ€è¦AuthenticationStrategyã€‚</li>
</ul>
</li>
<li><p><strong>æ­¥éª¤5</strong>ï¼šæŸ¥è¯¢æ¯ä¸ªé…ç½®çš„Realmä»¥æŸ¥çœ‹å®ƒæ˜¯å¦æ”¯æŒæäº¤çš„AuthenticationTokenã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œå°†ä½¿ç”¨æäº¤çš„tokenè°ƒç”¨æ”¯æŒçš„Realmçš„getAuthenticationInfoæ–¹æ³•ã€‚ getAuthenticationInfoæ–¹æ³•æœ‰æ•ˆåœ°è¡¨ç¤ºè¯¥ç‰¹å®šRealmçš„å•ä¸ªèº«ä»½éªŒè¯å°è¯•ã€‚ æˆ‘ä»¬å°†å¾ˆå¿«ä»‹ç»Realmèº«ä»½éªŒè¯è¡Œä¸ºã€‚</p>
</li>
</ul>
<p><strong><a href="http://shiro.apache.org/authentication.html#authenticator">Authenticator</a></strong></p>
<p>å¦‚ä¸Šæ‰€è¿°ï¼ŒShiro SecurityManageré»˜è®¤ä½¿ç”¨ModularRealmAuthenticatorå®ä¾‹ã€‚ ModularRealmAuthenticatoråŒæ—¶æ”¯æŒå…·æœ‰å•ä¸ªRealmçš„åº”ç”¨ç¨‹åºä»¥åŠå…·æœ‰å¤šä¸ªRealmçš„åº”ç”¨ç¨‹åºã€‚</p>
<p>åœ¨å•é¢†åŸŸåº”ç”¨ç¨‹åºä¸­ï¼ŒModularRealmAuthenticatorå°†ç›´æ¥è°ƒç”¨å•ä¸ªé¢†åŸŸã€‚å¦‚æœé…ç½®äº†ä¸¤ä¸ªæˆ–æ›´å¤šé¢†åŸŸï¼Œå®ƒå°†ä½¿ç”¨AuthenticationStrategyå®ä¾‹æ¥åè°ƒå°è¯•çš„å‘ç”Ÿæ–¹å¼ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢ä»‹ç»AuthenticationStrategiesã€‚</p>
<p>ModularRealmAuthenticatorèƒ½é€‚åˆå¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œå¦‚æœä½ å¸Œæœ›ä½¿ç”¨è‡ªå®šä¹‰Authenticatorï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„Authenticatoré…ç½®åˆ°SecurityManagerã€‚</p>
<p><strong><a href="http://shiro.apache.org/authentication.html#authenticationstrategy">AuthenticationStrategy</a>ï¼šè®¤è¯ç­–ç•¥</strong></p>
<p>å½“ä¸ºåº”ç”¨ç¨‹åºé…ç½®ä¸¤ä¸ªæˆ–å¤šä¸ªé¢†åŸŸæ—¶ï¼ŒModularRealmAuthenticatorä¾èµ–äºå†…éƒ¨AuthenticationStrategyç»„ä»¶æ¥ç¡®å®šèº«ä»½éªŒè¯å°è¯•æˆåŠŸæˆ–å¤±è´¥çš„æ¡ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªRealmæˆåŠŸéªŒè¯äº†AuthenticationTokenï¼Œä½†å…¶ä»–æ‰€æœ‰éªŒè¯å¤±è´¥ï¼Œé‚£ä¹ˆéªŒè¯å°è¯•æ˜¯å¦æˆåŠŸï¼Ÿæˆ–è€…æ‰€æœ‰é¢†åŸŸæ˜¯å¦å¿…é¡»æˆåŠŸéªŒè¯æ‰èƒ½è¢«è®¤ä¸ºæ˜¯æˆåŠŸçš„æ•´ä½“å°è¯•ï¼Ÿæˆ–è€…ï¼Œå¦‚æœé¢†åŸŸæˆåŠŸéªŒè¯ï¼Œæ˜¯å¦æœ‰å¿…è¦è¿›ä¸€æ­¥å’¨è¯¢å…¶ä»–é¢†åŸŸï¼Ÿ AuthenticationStrategyæ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€è¦åšå‡ºé€‚å½“çš„å†³ç­–ã€‚</p>
<p>AuthenticationStrategyæ˜¯ä¸€ä¸ªæ— çŠ¶æ€ç»„ä»¶ï¼Œåœ¨èº«ä»½éªŒè¯å°è¯•æœŸé—´ä¼šè¢«æŸ¥è¯¢4æ¬¡ï¼ˆè¿™4æ¬¡äº¤äº’æ‰€éœ€çš„ä»»ä½•å¿…è¦çŠ¶æ€å°†ä½œä¸ºæ–¹æ³•å‚æ•°æä¾›ï¼‰ï¼š</p>
<ul>
<li>1ã€åœ¨è°ƒç”¨ä»»ä½•Realmä¹‹å‰</li>
<li>2ã€åœ¨è°ƒç”¨å•ä¸ªRealmçš„getAuthenticationInfoæ–¹æ³•ä¹‹å‰</li>
<li>3ã€åœ¨è°ƒç”¨å•ä¸ªRealmçš„getAuthenticationInfoæ–¹æ³•ä¹‹åç«‹å³æ‰§è¡Œ</li>
<li>4ã€åœ¨æ‰€æœ‰Realmè¢«è°ƒç”¨ä¹‹å</li>
</ul>
<p>AuthenticationStrategyè¿˜è´Ÿè´£èšåˆæ¯ä¸ªæˆåŠŸRealmçš„ç»“æœï¼Œå¹¶å°†å®ƒä»¬â€œç»‘å®šâ€åˆ°ä¸€ä¸ªAuthenticationInfoè¡¨ç¤ºä¸­ã€‚æœ€ç»ˆèšåˆAuthenticationInfoå®ä¾‹æ˜¯Authenticatorå®ä¾‹è¿”å›çš„å®ä¾‹ï¼Œä¹Ÿæ˜¯Shiroç”¨æ¥è¡¨ç¤ºSubjectçš„æœ€ç»ˆèº«ä»½ï¼ˆåˆåPrincipalsï¼‰çš„å®ä¾‹ã€‚</p>
<p>Shiroæœ‰3ä¸ªå…·ä½“çš„AuthenticationStrategyå®ç°ï¼š</p>
<table>
<thead>
<tr>
<th><code>AuthenticationStrategy</code> class</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/AtLeastOneSuccessfulStrategy.html"><code>AtLeastOneSuccessfulStrategy</code></a></td>
<td>å¦‚æœä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰é¢†åŸŸæˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™è®¤ä¸ºæ•´ä½“å°è¯•æˆåŠŸã€‚ å¦‚æœæ²¡æœ‰æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™å°è¯•å¤±è´¥ã€‚</td>
</tr>
<tr>
<td><a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/FirstSuccessfulStrategy.html"><code>FirstSuccessfulStrategy</code></a></td>
<td>ä»…ä½¿ç”¨ä»ç¬¬ä¸€ä¸ªæˆåŠŸé€šè¿‡èº«ä»½éªŒè¯çš„Realmè¿”å›çš„ä¿¡æ¯ã€‚ æ‰€æœ‰è¿›ä¸€æ­¥çš„é¢†åŸŸéƒ½å°†è¢«å¿½ç•¥ã€‚ å¦‚æœæ²¡æœ‰æˆåŠŸéªŒè¯ï¼Œåˆ™å°è¯•å¤±è´¥ã€‚</td>
</tr>
<tr>
<td><a href="http://shiro.apache.org/static/current/apidocs/org/apache/shiro/authc/pam/AllSuccessfulStrategy.html"><code>AllSuccessfulStrategy</code></a></td>
<td>æ‰€æœ‰å·²é…ç½®çš„åŸŸå¿…é¡»æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯æ‰èƒ½å°†æ•´ä½“å°è¯•è§†ä¸ºæˆåŠŸã€‚ å¦‚æœä»»ä½•äººæœªæˆåŠŸéªŒè¯ï¼Œåˆ™å°è¯•å¤±è´¥ã€‚</td>
</tr>
</tbody></table>
<p>ModularRealmAuthenticatoré»˜è®¤ä¸ºAtLeastOneSuccessfulStrategyå®ç°ï¼Œå› ä¸ºè¿™æ˜¯æœ€å¸¸ç”¨çš„ç­–ç•¥ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">*æ³¨ï¼šå¦‚æœæ‚¨æƒ³è‡ªå·±åˆ›å»ºè‡ªå·±çš„AuthenticationStrategyå®ç°ï¼Œå¯ä»¥ä½¿ç”¨org.apache.shiro.authc.pam.AbstractAuthenticationStrategyä½œä¸ºèµ·ç‚¹ã€‚ AbstractAuthenticationStrategyç±»è‡ªåŠ¨å®ç°å°†æ¯ä¸ªRealmçš„ç»“æœåˆå¹¶åˆ°å•ä¸ªAuthenticationInfoå®ä¾‹ä¸­çš„â€œæ†ç»‘â€&#x2F;èšåˆè¡Œä¸ºã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong><a href="http://shiro.apache.org/authentication.html#realm-authentication-order">Realm Authentication Order</a>ï¼šè®¤è¯é¡ºåº</strong></p>
<p>ModularRealmAuthenticatorä»¥è¿­ä»£é¡ºåºä¸Realmå®ä¾‹äº¤äº’ã€‚ModularRealmAuthenticatorå¯ä»¥è®¿é—®SecurityManagerä¸Šé…ç½®çš„Realmå®ä¾‹ã€‚ æ‰§è¡Œèº«ä»½éªŒè¯å°è¯•æ—¶ï¼Œå®ƒå°†éå†è¯¥é›†åˆï¼Œå¹¶ä¸”å¯¹äºæ”¯æŒæäº¤çš„AuthenticationTokençš„æ¯ä¸ªRealmï¼Œè°ƒç”¨Realmçš„getAuthenticationInfoæ–¹æ³•ã€‚</p>
<p>ModularRealmAuthenticatoræ ¹æ®SecurityManagerä¸­Realmé…ç½®æŒ‰åºè°ƒç”¨çš„ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>shiro</tag>
        <tag>æƒé™ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Nettyç®€ä»‹</title>
    <url>/2018/07/25/framework/shen-ru-xue-xi-netty-kuang-jia/</url>
    <content><![CDATA[<p><strong>å®˜ç½‘ç®€ä»‹ï¼š</strong><br>ã€€ã€€<code>Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients.</code><br><strong>ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬ï¼š</strong><br>ã€€ã€€Nettyæ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤çš„é«˜æ€§èƒ½åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚  </p>
<hr>
<h4 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h4><p><strong>è®¾è®¡</strong>  </p>
<ul>
<li>é€‚ç”¨äºå„ç§ä¼ è¾“ç±»å‹çš„ç»Ÿä¸€API - é˜»å¡å’Œéé˜»å¡å¥—æ¥å­—</li>
<li>åŸºäºçµæ´»ä¸”å¯æ‰©å±•çš„äº‹ä»¶æ¨¡å‹ï¼Œå¯ä»¥æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹</li>
<li>é«˜åº¦å¯å®šåˆ¶çš„çº¿ç¨‹æ¨¡å‹ - å•çº¿ç¨‹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ± ï¼Œå¦‚SEDA</li>
<li>çœŸæ­£çš„æ— è¿æ¥æ•°æ®æŠ¥å¥—æ¥å­—æ”¯æŒï¼ˆè‡ª3.1èµ·ï¼‰</li>
</ul>
<p><strong>æ˜“ç”¨</strong></p>
<ul>
<li>è¯¦ç»†è®°å½•çš„Javadocï¼Œç”¨æˆ·æŒ‡å—å’Œç¤ºä¾‹</li>
<li>æ²¡æœ‰å…¶ä»–ä¾èµ–é¡¹ï¼ŒJDK 5ï¼ˆNetty 3.xï¼‰æˆ–6ï¼ˆNetty 4.xï¼‰å°±è¶³å¤Ÿäº†</li>
</ul>
<p><strong>æ€§èƒ½</strong></p>
<ul>
<li>ååé‡æ›´é«˜ï¼Œå»¶è¿Ÿæ›´ä½</li>
<li>å‡å°‘èµ„æºæ¶ˆè€—</li>
<li>æœ€å°åŒ–ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶</li>
</ul>
<p><strong>å®‰å…¨</strong></p>
<ul>
<li>å®Œæ•´çš„SSL &#x2F; TLSå’ŒStartTLSæ”¯æŒ</li>
</ul>
<hr>
<h4 id="æ¶æ„ç¤ºæ„å›¾"><a href="#æ¶æ„ç¤ºæ„å›¾" class="headerlink" title="æ¶æ„ç¤ºæ„å›¾"></a>æ¶æ„ç¤ºæ„å›¾</h4><p><img src="/2018/07/25/framework/shen-ru-xue-xi-netty-kuang-jia/components.png" alt="Nettyæ¡†æ¶å›¾"></p>
]]></content>
      <tags>
        <tag>netty</tag>
      </tags>
  </entry>
  <entry>
    <title>é›ªèŠ±ç®—æ³•æºç åˆ†æåŠå®è·µ</title>
    <url>/2022/01/18/distributed/xue-hua-suan-fa-yuan-ma-fen-xi-ji-shi-jian/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é›ªèŠ±ç®—æ³•ç®€ä»‹"><a href="#ä¸€ã€é›ªèŠ±ç®—æ³•ç®€ä»‹" class="headerlink" title="ä¸€ã€é›ªèŠ±ç®—æ³•ç®€ä»‹"></a>ä¸€ã€é›ªèŠ±ç®—æ³•ç®€ä»‹</h1><p>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰æ˜¯ä¸€ç§ç”Ÿæˆåˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDçš„ç®—æ³•ï¼Œè¿™ç§ç®—æ³•ç”±Twitteråˆ›å»ºå¹¶å¼€æºã€‚</p>
<p>é›ªèŠ±ç®—æ³•ç”±64ä½çš„äºŒè¿›åˆ¶ç»„æˆï¼Œåˆšå¥½å¯ä»¥ç”¨ä¸€ä¸ªLongç±»å‹å­˜å‚¨ï¼Œä¸€å…±åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>æ—¶é—´æˆ³</th>
<th>æ•°æ®ä¸­å¿ƒå’Œæœºå™¨ID</th>
<th>åºåˆ—å·</th>
</tr>
</thead>
<tbody><tr>
<td>1 bit</td>
<td>41 bits</td>
<td>10 bits</td>
<td>12 bits</td>
</tr>
</tbody></table>
<ul>
<li>1ä½æ˜¯ç¬¦å·ä½ï¼Œæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå§‹ç»ˆæ˜¯0</li>
<li>41ä½æ˜¯æ—¶é—´æˆ³ï¼Œå…·ä½“åˆ°æ¯«ç§’ï¼Œè¡¨ç¤ºç°åœ¨è‡³1970å¹´ä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œæœ€å¤šå¯ç”¨69å¹´</li>
<li>10ä½æ˜¯æ•°æ®ä¸­å¿ƒå’Œæœºå™¨IDï¼Œ10ä½æœ€å¤šå¯ä»¥è¡¨ç¤º1024å°æœºå™¨</li>
<li>12ä½æ˜¯åºåˆ—å·ï¼Œè¡¨ç¤ºæ¯«ç§’å†…ç”Ÿæˆçš„åºåˆ—å·ï¼Œæ¯æ¯«ç§’æœ€å¤šå¯ç”Ÿæˆ4096ä¸ªID</li>
</ul>
<h1 id="äºŒã€é›ªèŠ±ç®—æ³•æºç -java"><a href="#äºŒã€é›ªèŠ±ç®—æ³•æºç -java" class="headerlink" title="äºŒã€é›ªèŠ±ç®—æ³•æºç (java)"></a>äºŒã€é›ªèŠ±ç®—æ³•æºç (java)</h1><blockquote>
<p>é›ªèŠ±ç®—æ³•Javaç‰ˆæœ¬æºç æ¥è‡ª<code>beyondfengyu</code>çš„githubï¼š<a href="https://github.com/beyondfengyu/SnowFlake/blob/master/SnowFlake.java">Snowflake</a></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;**
 * twitterçš„snowflakeç®—æ³• -- javaå®ç°
 * 
 * @author beyond
 * @date 2016&#x2F;11&#x2F;26
 *&#x2F;
public class SnowFlake &#123;

    &#x2F;**
     * èµ·å§‹çš„æ—¶é—´æˆ³
     *&#x2F;
    private final static long START_STMP &#x3D; 1480166465631L;

    &#x2F;**
     * æ¯ä¸€éƒ¨åˆ†å ç”¨çš„ä½æ•°
     *&#x2F;
    private final static long SEQUENCE_BIT &#x3D; 12; &#x2F;&#x2F;åºåˆ—å·å ç”¨çš„ä½æ•°
    private final static long MACHINE_BIT &#x3D; 5;   &#x2F;&#x2F;æœºå™¨æ ‡è¯†å ç”¨çš„ä½æ•°
    private final static long DATACENTER_BIT &#x3D; 5;&#x2F;&#x2F;æ•°æ®ä¸­å¿ƒå ç”¨çš„ä½æ•°

    &#x2F;**
     * æ¯ä¸€éƒ¨åˆ†çš„æœ€å¤§å€¼
     * äºŒè¿›åˆ¶ä½è¿ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š
     * è´Ÿæ•°çš„äºŒè¿›åˆ¶ç”¨è¡¥ç ï¼ˆæ•´æ•°çš„äºŒè¿›åˆ¶ä½å–åååŠ ä¸€ï¼‰è¡¨ç¤ºï¼Œ-1çš„è¡¥ç çš„äºŒè¿›åˆ¶ä½å…¨éƒ¨ä¸º1ï¼Œè¿›è¡Œ&#96;&lt;&lt;&#96;å·¦ç§»è¿ç®—åä½ä½è¡¥0ï¼Œé«˜ä½å…¨éƒ¨éƒ½æ˜¯1
     * å†ä¸-1è¿›è¡Œ&#96;^&#96;å¼‚æˆ–è¿ç®—ï¼ˆè¿™é‡Œå¯ä»¥æ›¿æ¢ä¸º&#96;~&#96;å–åè¿ç®—ï¼‰ï¼Œåˆ™é«˜ä½å…¨éƒ¨å˜ä¸º0ï¼Œä½ä½å˜ä¸º1
     *&#x2F;
    private final static long MAX_DATACENTER_NUM &#x3D; -1L ^ (-1L &lt;&lt; DATACENTER_BIT);
    private final static long MAX_MACHINE_NUM &#x3D; -1L ^ (-1L &lt;&lt; MACHINE_BIT);
    private final static long MAX_SEQUENCE &#x3D; -1L ^ (-1L &lt;&lt; SEQUENCE_BIT);

    &#x2F;**
     * æ¯ä¸€éƒ¨åˆ†å‘å·¦çš„ä½ç§»
     *&#x2F;
    private final static long MACHINE_LEFT &#x3D; SEQUENCE_BIT;
    private final static long DATACENTER_LEFT &#x3D; SEQUENCE_BIT + MACHINE_BIT;
    private final static long TIMESTMP_LEFT &#x3D; DATACENTER_LEFT + DATACENTER_BIT;

    private long datacenterId;  &#x2F;&#x2F;æ•°æ®ä¸­å¿ƒ
    private long machineId;     &#x2F;&#x2F;æœºå™¨æ ‡è¯†
    private long sequence &#x3D; 0L; &#x2F;&#x2F;åºåˆ—å·
    private long lastStmp &#x3D; -1L;&#x2F;&#x2F;ä¸Šä¸€æ¬¡æ—¶é—´æˆ³

    public SnowFlake(long datacenterId, long machineId) &#123;
        if (datacenterId &gt; MAX_DATACENTER_NUM || datacenterId &lt; 0) &#123;
            throw new IllegalArgumentException(&quot;datacenterId can&#39;t be greater than MAX_DATACENTER_NUM or less than 0&quot;);
        &#125;
        if (machineId &gt; MAX_MACHINE_NUM || machineId &lt; 0) &#123;
            throw new IllegalArgumentException(&quot;machineId can&#39;t be greater than MAX_MACHINE_NUM or less than 0&quot;);
        &#125;
        this.datacenterId &#x3D; datacenterId;
        this.machineId &#x3D; machineId;
    &#125;

    &#x2F;**
     * äº§ç”Ÿä¸‹ä¸€ä¸ªID
     *
     * @return
     *&#x2F;
    public synchronized long nextId() &#123;
        long currStmp &#x3D; getNewstmp();
        if (currStmp &lt; lastStmp) &#123;
            throw new RuntimeException(&quot;Clock moved backwards.  Refusing to generate id&quot;);
        &#125;

        if (currStmp &#x3D;&#x3D; lastStmp) &#123;
            &#x2F;&#x2F;ç›¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·è‡ªå¢
            sequence &#x3D; (sequence + 1) &amp; MAX_SEQUENCE;
            &#x2F;&#x2F;åŒä¸€æ¯«ç§’çš„åºåˆ—æ•°å·²ç»è¾¾åˆ°æœ€å¤§
            if (sequence &#x3D;&#x3D; 0L) &#123;
                currStmp &#x3D; getNextMill();
            &#125;
        &#125; else &#123;
            &#x2F;&#x2F;ä¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·ç½®ä¸º0
            sequence &#x3D; 0L;
        &#125;

        lastStmp &#x3D; currStmp;

        return (currStmp - START_STMP) &lt;&lt; TIMESTMP_LEFT &#x2F;&#x2F;æ—¶é—´æˆ³éƒ¨åˆ†
                | datacenterId &lt;&lt; DATACENTER_LEFT       &#x2F;&#x2F;æ•°æ®ä¸­å¿ƒéƒ¨åˆ†
                | machineId &lt;&lt; MACHINE_LEFT             &#x2F;&#x2F;æœºå™¨æ ‡è¯†éƒ¨åˆ†
                | sequence;                             &#x2F;&#x2F;åºåˆ—å·éƒ¨åˆ†
    &#125;

    private long getNextMill() &#123;
        long mill &#x3D; getNewstmp();
        while (mill &lt;&#x3D; lastStmp) &#123;
            mill &#x3D; getNewstmp();
        &#125;
        return mill;
    &#125;

    private long getNewstmp() &#123;
        return System.currentTimeMillis();
    &#125;

    public static void main(String[] args) &#123;
        SnowFlake snowFlake &#x3D; new SnowFlake(2, 3);

        for (int i &#x3D; 0; i &lt; (1 &lt;&lt; 12); i++) &#123;
            System.out.println(snowFlake.nextId());
        &#125;

    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šè¿°ä»£ç ä¸­æœ‰ä¸¤ä¸ªå…³é”®çš„æ­¥éª¤:</p>
<ul>
<li>è·å–IDæ—¶ï¼Œå¦‚æœåœ¨åŒä¸€æ¯«ç§’å†…ï¼Œåˆ™åœ¨åºåˆ—å·ä¸Šé€’å¢</li>
<li>å¦‚æœåŒä¸€æ¯«ç§’å†…çš„åºåˆ—å·å·²ç»é€’å¢åˆ°æœ€å¤§å€¼<code>4095</code>ï¼Œåˆ™é€šè¿‡å¾ªåé˜»å¡ç›´åˆ°ä¸‹ä¸€æ¯«ç§’åˆ°æ¥</li>
</ul>
<p>æ‰€ä»¥é›ªèŠ±ç®—æ³•æ¯æ¯«ç§’æœ€å¤šå¯ç”Ÿæˆ4096ä¸ªIDï¼Œæ¯ç§’æœ€å¤šå¯ç”Ÿæˆ400ä¸‡+çš„IDã€‚</p>
<h1 id="ä¸‰ã€æ—¶é’Ÿå›æ‹¨"><a href="#ä¸‰ã€æ—¶é’Ÿå›æ‹¨" class="headerlink" title="ä¸‰ã€æ—¶é’Ÿå›æ‹¨"></a>ä¸‰ã€æ—¶é’Ÿå›æ‹¨</h1><p>ä»ä¸Šè¿°é›ªèŠ±ç®—æ³•çš„ç»„æˆåŠæºç å¯ä»¥çœ‹å‡ºï¼Œé›ªèŠ±ç®—æ³•æ˜¯å¼ºä¾èµ–äºæœºå™¨æ—¶é—´çš„ï¼Œå¦‚æœæœºå™¨å‘ç”Ÿäº†æ—¶é’Ÿå›æ‹¨ï¼Œåˆ™å°±ä¼šäº§ç”Ÿé‡å¤IDï¼Œæ‰€ä»¥å¿…é¡»è§£å†³æ—¶é’Ÿå›æ‹¨çš„é—®é¢˜ï¼Œé˜²æ­¢å½±å“ä¸šåŠ¡ã€‚</p>
<h2 id="3-1-è§£å†³æ–¹æ¡ˆ"><a href="#3-1-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.1 è§£å†³æ–¹æ¡ˆ"></a>3.1 è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ—¶é’Ÿå›æ‹¨åä¸ç”ŸæˆIDï¼Œå¾ªç¯ç­‰å¾…æ—¶é—´ç‚¹åˆ°è¾¾"><a href="#æ—¶é’Ÿå›æ‹¨åä¸ç”ŸæˆIDï¼Œå¾ªç¯ç­‰å¾…æ—¶é—´ç‚¹åˆ°è¾¾" class="headerlink" title="æ—¶é’Ÿå›æ‹¨åä¸ç”ŸæˆIDï¼Œå¾ªç¯ç­‰å¾…æ—¶é—´ç‚¹åˆ°è¾¾"></a>æ—¶é’Ÿå›æ‹¨åä¸ç”ŸæˆIDï¼Œå¾ªç¯ç­‰å¾…æ—¶é—´ç‚¹åˆ°è¾¾</h3><ul>
<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œé€‚åˆæ—¶é—´è¾ƒå°çš„æ—¶é’Ÿå›æ‹¨</li>
<li>ç¼ºç‚¹ï¼šå›æ‹¨æ—¶é—´é—´éš”è¾ƒå¤§æ—¶ï¼Œä¼šé€ æˆä¸šåŠ¡é˜»å¡</li>
</ul>
<h3 id="ä½¿ç”¨LRUç¼“å­˜è¿‘ä¸€æ®µæ—¶é—´å†…æ¯æ¯«ç§’å†…çš„æœ€å¤§åºåˆ—å·"><a href="#ä½¿ç”¨LRUç¼“å­˜è¿‘ä¸€æ®µæ—¶é—´å†…æ¯æ¯«ç§’å†…çš„æœ€å¤§åºåˆ—å·" class="headerlink" title="ä½¿ç”¨LRUç¼“å­˜è¿‘ä¸€æ®µæ—¶é—´å†…æ¯æ¯«ç§’å†…çš„æœ€å¤§åºåˆ—å·"></a>ä½¿ç”¨LRUç¼“å­˜è¿‘ä¸€æ®µæ—¶é—´å†…æ¯æ¯«ç§’å†…çš„æœ€å¤§åºåˆ—å·</h3><p>ä½¿ç”¨LRUç¼“å­˜è¿‘ä¸€æ®µæ—¶é—´å†…æ¯ä¸€æ¯«ç§’çš„æœ€å¤§åºåˆ—å·ï¼Œå¦‚æœå‘ç”Ÿæ—¶é’Ÿå›æ‹¨ï¼Œåˆ™ä»æœ€å¤§åºåˆ—å·ç»§ç»­é€’å¢ï¼Œé€‚åˆå°èŒƒå›´å†…æ—¶é’Ÿå›æ‹¨</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œé€‚åˆå°èŒƒå›´æ—¶é—´å›æ‹¨</li>
<li>ç¼ºç‚¹ï¼šå½“å›æ‹¨æ—¶é—´è¾ƒé•¿æ—¶ï¼Œéœ€è¦ç¼“å­˜æ•°æ®é‡å¤ªå¤§</li>
</ul>
<h3 id="è®¾ç½®å¤‡ç”¨çš„æ•°æ®ä¸­å¿ƒ"><a href="#è®¾ç½®å¤‡ç”¨çš„æ•°æ®ä¸­å¿ƒ" class="headerlink" title="è®¾ç½®å¤‡ç”¨çš„æ•°æ®ä¸­å¿ƒ"></a>è®¾ç½®å¤‡ç”¨çš„æ•°æ®ä¸­å¿ƒ</h3><p>ä¸ºæ¯ä¸ªèŠ‚ç‚¹é¢„ç•™ä¸€ä¸ªå¤‡ç”¨çš„é…ç½®ä¸­å¿ƒIDï¼Œå½“å‡ºç°æ—¶é’Ÿå›æ‹¨æ—¶ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨çš„æ•°æ®ä¸­å¿ƒç”ŸæˆIDï¼Œæ—¶é’Ÿåˆ°è¾¾æ­£å¸¸æ—¶é—´åˆ‡æ¢å›åŸæ¥çš„æ•°æ®ä¸­å¿ƒIDã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œé€‚åˆä»»æ„èŒƒå›´å†…çš„æ—¶é’Ÿå›æ‹¨</li>
<li>ç¼ºç‚¹ï¼š éœ€è¦å ç”¨æ‰ä¸€éƒ¨åˆ†æ•°æ®ä¸­å¿ƒIDä½œä¸ºå¤‡ç”¨</li>
</ul>
<p>ä»¥ä¸Šå‡ ç§æ–¹å¼éƒ½æ²¡æœ‰è€ƒè™‘æœåŠ¡å®•æœºé‡å¯åçš„æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨æ—¶è¿›è¡Œæœ€å¤§IDæ ¡éªŒæ—¶é—´æˆ³è¿›è¡Œè§£å†³ã€‚</p>
<h1 id="å››ã€ç™¾åº¦UIDGenerator"><a href="#å››ã€ç™¾åº¦UIDGenerator" class="headerlink" title="å››ã€ç™¾åº¦UIDGenerator"></a>å››ã€ç™¾åº¦UIDGenerator</h1><h2 id="4-1-ç™¾åº¦UIDGenerator"><a href="#4-1-ç™¾åº¦UIDGenerator" class="headerlink" title="4.1 ç™¾åº¦UIDGenerator"></a><a href="https://github.com/baidu/uid-generator/blob/master/README.zh_cn.md">4.1 ç™¾åº¦UIDGenerator</a></h2><p>UidGeneratoræ˜¯Javaå®ç°çš„, åŸºäºSnowflakeç®—æ³•çš„å”¯ä¸€IDç”Ÿæˆå™¨ã€‚UidGeneratorä»¥ç»„ä»¶å½¢å¼å·¥ä½œåœ¨åº”ç”¨é¡¹ç›®ä¸­, æ”¯æŒè‡ªå®šä¹‰workerIdä½æ•°å’Œåˆå§‹åŒ–ç­–ç•¥, ä»è€Œé€‚ç”¨äºdockerç­‰è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹å®ä¾‹è‡ªåŠ¨é‡å¯ã€æ¼‚ç§»ç­‰åœºæ™¯ã€‚</p>
<p>ä¾èµ–äºæ•°æ®åº“ï¼ˆUidGeneratorä»¥ç»„ä»¶å½¢å¼å·¥ä½œï¼Œå†…ç½®WorkerIDåˆ†é…å™¨, å¯åŠ¨é˜¶æ®µé€šè¿‡DBè¿›è¡Œåˆ†é…; å¦‚è‡ªå®šä¹‰å®ç°, åˆ™DBéå¿…é€‰ä¾èµ–ï¼‰</p>
<h2 id="4-2-DefaultUidGenerator"><a href="#4-2-DefaultUidGenerator" class="headerlink" title="4.2 DefaultUidGenerator"></a>4.2 DefaultUidGenerator</h2><pre class="line-numbers language-none"><code class="language-none">&#x2F;** Bits allocate *&#x2F;
 protected int timeBits &#x3D; 28;
 protected int workerBits &#x3D; 22;
 protected int seqBits &#x3D; 13;

 &#x2F;** Customer epoch, unit as second. For example 2016-05-20 (ms: 1463673600000)*&#x2F;
 protected String epochStr &#x3D; &quot;2016-05-20&quot;;
 protected long epochSeconds &#x3D; TimeUnit.MILLISECONDS.toSeconds(1463673600000L);

 &#x2F;** Stable fields after spring bean initializing *&#x2F;
 protected BitsAllocator bitsAllocator;
 protected long workerId;

 &#x2F;** Volatile fields caused by nextId() *&#x2F;
 protected long sequence &#x3D; 0L;
 protected long lastSecond &#x3D; -1L;

 &#x2F;** Spring property *&#x2F;
 protected WorkerIdAssigner workerIdAssigner;
 
 &#x2F;**
  * Get UID
  *
  * @return UID
  * @throws UidGenerateException in the case: Clock moved backwards; Exceeds the max timestamp
  *&#x2F;
 protected synchronized long nextId() &#123;
     long currentSecond &#x3D; getCurrentSecond();

     &#x2F;&#x2F; Clock moved backwards, refuse to generate uid
     if (currentSecond &lt; lastSecond) &#123;
         long refusedSeconds &#x3D; lastSecond - currentSecond;
         throw new UidGenerateException(&quot;Clock moved backwards. Refusing for %d seconds&quot;, refusedSeconds);
     &#125;

     &#x2F;&#x2F; At the same second, increase sequence
     if (currentSecond &#x3D;&#x3D; lastSecond) &#123;
         sequence &#x3D; (sequence + 1) &amp; bitsAllocator.getMaxSequence();
         &#x2F;&#x2F; Exceed the max sequence, we wait the next second to generate uid
         if (sequence &#x3D;&#x3D; 0) &#123;
             currentSecond &#x3D; getNextSecond(lastSecond);
         &#125;

     &#x2F;&#x2F; At the different second, sequence restart from zero
     &#125; else &#123;
         sequence &#x3D; 0L;
     &#125;

     lastSecond &#x3D; currentSecond;

     &#x2F;&#x2F; Allocate bits for UID
     return bitsAllocator.allocate(currentSecond - epochSeconds, workerId, sequence);
 &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>DefaultUidGeneratorç›¸å¯¹äºåŸç”Ÿçš„é›ªèŠ±ç®—æ³•åšäº†ä¸€äº›è°ƒæ•´ï¼Œå…è®¸å¯¹å„æ®µå ç”¨é•¿åº¦è¿›è¡Œè‡ªå®šä¹‰</p>
<ul>
<li>æ—¶é—´æˆ³å ç”¨çš„ä½æ•°å‡å°‘äº†ï¼Œé»˜è®¤å 28ä½,èµ·å§‹æ—¶é—´é»˜è®¤ä¸º<code>2016-05-20 (ms: 1463673600000)</code>ï¼Œæ—¶é—´æˆ³åˆ°ç§’çº§åˆ«</li>
<li>æœºå™¨å ç”¨çš„ä½æ•°å¢å¤§äº†ï¼Œé»˜è®¤å 22ä½ï¼Œæœ€å¤šå…è®¸420ä¸‡æ¬¡çš„å¯åœï¼ˆå†…ç½®å®ç°ä¸ºåœ¨å¯åŠ¨æ—¶ç”±æ•°æ®åº“åˆ†é…ï¼Œé»˜è®¤åˆ†é…ç­–ç•¥ä¸ºç”¨åå³å¼ƒï¼‰</li>
<li>åºåˆ—ä½å¢åŠ äº†ä¸€ä½ï¼Œé»˜è®¤å 13ä½ï¼Œå¯æ”¯æŒæ¯ç§’8192ä¸ªå¹¶å‘ã€‚</li>
</ul>
<blockquote>
<p>å¯¹äºæ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼ŒDefaultUidGeneratorç²—æš´çš„ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p>
</blockquote>
<h2 id="4-3-CachedUidGenerator"><a href="#4-3-CachedUidGenerator" class="headerlink" title="4.3 CachedUidGenerator"></a>4.3 CachedUidGenerator</h2><p>è¿™ç§æ–¹æ¡ˆå’Œä¸Šé¢é»˜è®¤çš„æ–¹æ¡ˆä¸åŒä¹‹å¤„åœ¨äºé¢„å…ˆç”ŸæˆUIDï¼Œå°†ç”Ÿæˆçš„UIDç¼“å­˜åœ¨ä¸€ä¸ªç¯å½¢æ•°ç»„ä¹‹ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæŒ‡é’ˆï¼ˆtailã€cursorï¼‰å»æ§åˆ¶UIDçš„æ¶ˆè´¹ä½ç½®åŠç”Ÿæˆçš„æœ€å¤§çš„UIDçš„ä½ç½®ï¼Œç«¯è·å–å®¢æˆ·ç«¯è·å–UIDæ—¶æ²¡æœ‰åŠ é”ï¼Œè€Œæ˜¯ä½¿ç”¨äº†CASæœºåˆ¶ï¼Œå…¶ä¸­æè¿‡äº†ä¸¤ç§æœºåˆ¶è§¦å‘UIDçš„ç”Ÿæˆï¼š</p>
<ul>
<li>é˜ˆå€¼æœºåˆ¶ï¼šè·å–UIDæ—¶ï¼Œå¦‚æœå‰©ä½™å¯è·å–çš„UIDå°äºè®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™é€šè¿‡çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ç”ŸæˆUIDç¼“å­˜åˆ°ç¯å½¢æ•°ç»„ä¹‹ä¸­</li>
<li>å®šæ—¶æœºåˆ¶ï¼šé€šè¿‡å®šæ—¶ä»»åŠ¡å®šæ—¶ç”ŸæˆUIDç¼“å­˜åˆ°ç¯å½¢æ•°ç»„ä¹‹ä¸­</li>
</ul>
<p>RingBufferç¯å½¢æ•°ç»„ï¼Œæ•°ç»„æ¯ä¸ªå…ƒç´ æˆä¸ºä¸€ä¸ªslotã€‚RingBufferå®¹é‡ï¼Œé»˜è®¤ä¸ºSnowflakeç®—æ³•ä¸­sequenceæœ€å¤§å€¼ï¼Œä¸”ä¸º2^Nï¼ˆsequenceæœ€å¤§å€¼ &lt;&lt; 3, å³sequenceæœ€å¤§å€¼çš„3å€ï¼‰ã€‚å¯é€šè¿‡boostPoweré…ç½®è¿›è¡Œæ‰©å®¹ï¼Œä»¥æé«˜RingBuffer è¯»å†™ååé‡ã€‚</p>
<p>CachedUidGeneratoré‡‡ç”¨äº†åŒRingBufferï¼ŒUid-RingBufferç”¨äºå­˜å‚¨Uidã€Flag-RingBufferç”¨äºå­˜å‚¨UidçŠ¶æ€(æ˜¯å¦å¯å¡«å……ã€æ˜¯å¦å¯æ¶ˆè´¹)</p>
<p>ç”±äºæ•°ç»„å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­åˆ†é…çš„ï¼Œå¯æœ€å¤§ç¨‹åº¦åˆ©ç”¨CPU cacheä»¥æå‡æ€§èƒ½ã€‚ä½†åŒæ—¶ä¼šå¸¦æ¥ã€Œä¼ªå…±äº«ã€FalseSharingé—®é¢˜ï¼Œä¸ºæ­¤åœ¨Tailã€CursoræŒ‡é’ˆã€Flag-RingBufferä¸­é‡‡ç”¨äº†CacheLine è¡¥é½æ–¹å¼ã€‚</p>
<p>TailæŒ‡é’ˆã€CursoræŒ‡é’ˆç”¨äºç¯å½¢æ•°ç»„ä¸Šè¯»å†™slotï¼š</p>
<ul>
<li><p>TailæŒ‡é’ˆ<br>è¡¨ç¤ºProducerç”Ÿäº§çš„æœ€å¤§åºå·(æ­¤åºå·ä»0å¼€å§‹ï¼ŒæŒç»­é€’å¢)ã€‚Tailä¸èƒ½è¶…è¿‡Cursorï¼Œå³ç”Ÿäº§è€…ä¸èƒ½è¦†ç›–æœªæ¶ˆè´¹çš„slotã€‚å½“Tailå·²èµ¶ä¸Šcurosrï¼Œæ­¤æ—¶å¯é€šè¿‡rejectedPutBufferHandleræŒ‡å®šPutRejectPolicy</p>
</li>
<li><p>CursoræŒ‡é’ˆ<br>è¡¨ç¤ºConsumeræ¶ˆè´¹åˆ°çš„æœ€å°åºå·(åºå·åºåˆ—ä¸Produceråºåˆ—ç›¸åŒ)ã€‚Cursorä¸èƒ½è¶…è¿‡Tailï¼Œå³ä¸èƒ½æ¶ˆè´¹æœªç”Ÿäº§çš„slotã€‚å½“Cursorå·²èµ¶ä¸Štailï¼Œæ­¤æ—¶å¯é€šè¿‡rejectedTakeBufferHandleræŒ‡å®šTakeRejectPolicy</p>
</li>
</ul>
<p>RingBufferå¡«å……æ—¶æœº</p>
<ul>
<li><p>åˆå§‹åŒ–é¢„å¡«å……<br>RingBufferåˆå§‹åŒ–æ—¶ï¼Œé¢„å…ˆå¡«å……æ»¡æ•´ä¸ªRingBuffer.</p>
</li>
<li><p>å³æ—¶å¡«å……<br>Takeæ¶ˆè´¹æ—¶ï¼Œå³æ—¶æ£€æŸ¥å‰©ä½™å¯ç”¨sloté‡(tail - cursor)ï¼Œå¦‚å°äºè®¾å®šé˜ˆå€¼ï¼Œåˆ™è¡¥å…¨ç©ºé—²slotsã€‚é˜ˆå€¼å¯é€šè¿‡paddingFactoræ¥è¿›è¡Œé…ç½®</p>
</li>
<li><p>å‘¨æœŸå¡«å……<br>é€šè¿‡Scheduleçº¿ç¨‹ï¼Œå®šæ—¶è¡¥å…¨ç©ºé—²slotsã€‚å¯é€šè¿‡scheduleIntervalé…ç½®ï¼Œä»¥åº”ç”¨å®šæ—¶å¡«å……åŠŸèƒ½ï¼Œå¹¶æŒ‡å®šScheduleæ—¶é—´é—´éš”</p>
</li>
</ul>
<blockquote>
<p>ä¸Šè¿°æè¿°ä¸­å­˜åœ¨ä¸€ä¸ªã€Œä¼ªå…±äº«ã€FalseSharingé—®é¢˜ï¼Œä¸ºæ­¤åœ¨Tailã€CursoræŒ‡é’ˆã€Flag-RingBufferä¸­é‡‡ç”¨äº†CacheLine è¡¥é½æ–¹å¼ã€‚</p>
</blockquote>
<h2 id="4-4-æ€»ç»“"><a href="#4-4-æ€»ç»“" class="headerlink" title="4.4 æ€»ç»“"></a>4.4 æ€»ç»“</h2><ul>
<li>è¾ƒäºåŸç”Ÿçš„é›ªèŠ±ç®—æ³•å‡å°‘äº†æ—¶é—´æˆ³å ç”¨çš„é•¿åº¦ï¼Œæ—¶é—´æˆ³çš„é•¿åº¦è°ƒæ•´åˆ°äº†22ä½ï¼Œå…·ä½“åˆ°ç§’çº§åˆ«ï¼Œèµ·å§‹æ—¶é—´è®¾ç½®ä¸ºäº†2016å¹´ã€‚</li>
<li>å¢åŠ äº†æœºå™¨IDå ç”¨çš„é•¿åº¦ï¼Œè€Œä¸”æœºå™¨IDçš„åˆ†é…ä½¿ç”¨äº†æ•°æ®åº“è‡ªå¢çš„ä¸»é”®ï¼Œå…è®¸å•èŠ‚ç‚¹420ä¸‡æ¬¡çš„å¯åŠ¨ã€‚</li>
<li>åºåˆ—å·çš„ä½æ•°å¢å¤§äº†1ä½ï¼Œæ¯ç§’æœ€å¤šå¯ç”Ÿæˆ8192ä¸ªUIDã€‚</li>
</ul>
<h3 id="DefaultUidGeneratoræ–¹æ¡ˆï¼š"><a href="#DefaultUidGeneratoræ–¹æ¡ˆï¼š" class="headerlink" title="DefaultUidGeneratoræ–¹æ¡ˆï¼š"></a>DefaultUidGeneratoræ–¹æ¡ˆï¼š</h3><ul>
<li>è·å–UIDæ—¶è¦åŠ é”ï¼ˆsynchronizedï¼‰</li>
<li>å‘ç”Ÿæ—¶é’Ÿå›æ‹¨æ—¶ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<h3 id="CachedUidGeneratoræ–¹æ¡ˆï¼š"><a href="#CachedUidGeneratoræ–¹æ¡ˆï¼š" class="headerlink" title="CachedUidGeneratoræ–¹æ¡ˆï¼š"></a>CachedUidGeneratoræ–¹æ¡ˆï¼š</h3><ul>
<li>è·å–UIDæ—¶ä¸ç”¨åŠ é”ï¼Œä½¿ç”¨äº†CAS</li>
<li>æå‰ç”ŸæˆUIDç¼“å­˜åˆ°ç¯å½¢ä¹‹ä¸­ï¼Œé€šè¿‡é˜ˆå€¼æˆ–å®šåˆ¶æœºåˆ¶é¢„ç”ŸæˆUID</li>
<li>ç”ŸæˆUIDæ—¶ä¸ä¾èµ–äºæ—¶é—´æˆ³ï¼Œè€Œæ˜¯å¯¹<code>lastSecond</code>è¿›è¡ŒåŠ ä¸€ï¼ˆè¿™ä¸ªå€¼çš„åˆå§‹å€¼ä¸ºç³»ç»Ÿå¯åŠ¨æ—¶çš„æ—¶é—´æˆ³ï¼‰</li>
<li>è·å–çš„UIDä¸­çš„æ—¶é—´æˆ³ä¸å‡†ç¡®</li>
</ul>
<blockquote>
<p>CachedUidGeneratoræ–¹æ¡ˆæ²¡æœ‰ä¾èµ–äºæ—¶é—´æˆ³ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨è¿è¡Œæ—¶å‡ºç°æ—¶é’Ÿå›æ‹¨é—®é¢˜ï¼Œè€Œä¸”å¯¹äºåŒä¸€ç§’å†…å¦‚æœåºåˆ—å·å¢é•¿åˆ°æœ€å¤§æ—¶ï¼Œå¯ä»¥å€Ÿç”¨æœªæ¥æ—¶é—´è¿›è¡Œç”Ÿæˆã€‚</p>
</blockquote>
<h1 id="äº”ã€ç¾å›¢ï¼ˆLeafï¼‰"><a href="#äº”ã€ç¾å›¢ï¼ˆLeafï¼‰" class="headerlink" title="äº”ã€ç¾å›¢ï¼ˆLeafï¼‰"></a>äº”ã€ç¾å›¢ï¼ˆLeafï¼‰</h1><h2 id="5-1-Leafï¼šç¾å›¢åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡å¼€æº"><a href="#5-1-Leafï¼šç¾å›¢åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡å¼€æº" class="headerlink" title="5.1 Leafï¼šç¾å›¢åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡å¼€æº"></a>5.1 <a href="https://tech.meituan.com/2019/03/07/open-source-project-leaf.html">Leafï¼šç¾å›¢åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡å¼€æº</a></h2><p>Leafæ˜¯ç¾å›¢åŸºç¡€ç ”å‘å¹³å°æ¨å‡ºçš„ä¸€ä¸ªåˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ï¼Œåå­—å–è‡ªå¾·å›½å“²å­¦å®¶ã€æ•°å­¦å®¶è±å¸ƒå°¼èŒ¨çš„ä¸€å¥è¯ï¼šâ€œThere are no two identical leaves in the world.â€Leafå…·å¤‡é«˜å¯é ã€ä½å»¶è¿Ÿã€å…¨å±€å”¯ä¸€ç­‰ç‰¹ç‚¹ã€‚ç›®å‰å·²ç»å¹¿æ³›åº”ç”¨äºç¾å›¢é‡‘èã€ç¾å›¢å¤–å–ã€ç¾å›¢é…’æ—…ç­‰å¤šä¸ªéƒ¨é—¨ã€‚å…·ä½“çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¯å‚è€ƒæ­¤å‰ç¾å›¢æŠ€æœ¯åšå®¢çš„ä¸€ç¯‡æ–‡ç« ï¼šã€ŠLeafç¾å›¢åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ã€‹ã€‚è¿‘æ—¥ï¼ŒLeafé¡¹ç›®å·²ç»åœ¨Githubä¸Šå¼€æºï¼š<a href="https://github.com/Meituan-Dianping/Leaf">https://github.com/Meituan-Dianping/Leaf</a> ï¼Œå¸Œæœ›èƒ½å’Œæ›´å¤šçš„æŠ€æœ¯åŒè¡Œä¸€èµ·äº¤æµã€å…±å»ºã€‚</p>
<h3 id="Leafçš„ç‰¹æ€§"><a href="#Leafçš„ç‰¹æ€§" class="headerlink" title="Leafçš„ç‰¹æ€§"></a>Leafçš„ç‰¹æ€§</h3><p>Leafåœ¨è®¾è®¡ä¹‹åˆå°±ç§‰æ‰¿ç€å‡ ç‚¹è¦æ±‚ï¼š</p>
<ul>
<li>å…¨å±€å”¯ä¸€ï¼Œç»å¯¹ä¸ä¼šå‡ºç°é‡å¤çš„IDï¼Œä¸”IDæ•´ä½“è¶‹åŠ¿é€’å¢ã€‚</li>
<li>é«˜å¯ç”¨ï¼ŒæœåŠ¡å®Œå…¨åŸºäºåˆ†å¸ƒå¼æ¶æ„ï¼Œå³ä½¿MySQLå®•æœºï¼Œä¹Ÿèƒ½å®¹å¿ä¸€æ®µæ—¶é—´çš„æ•°æ®åº“ä¸å¯ç”¨ã€‚</li>
<li>é«˜å¹¶å‘ä½å»¶æ—¶ï¼Œåœ¨CentOS 4C8Gçš„è™šæ‹Ÿæœºä¸Šï¼Œè¿œç¨‹è°ƒç”¨QPSå¯è¾¾5W+ï¼ŒTP99åœ¨1mså†…ã€‚</li>
<li>æ¥å…¥ç®€å•ï¼Œç›´æ¥é€šè¿‡å…¬å¸RPCæœåŠ¡æˆ–è€…HTTPè°ƒç”¨å³å¯æ¥å…¥ã€‚</li>
</ul>
<h2 id="5-2-å·æ®µæ¨¡å¼"><a href="#5-2-å·æ®µæ¨¡å¼" class="headerlink" title="5.2 å·æ®µæ¨¡å¼"></a>5.2 å·æ®µæ¨¡å¼</h2><p>ä¾èµ–äºæ•°æ®åº“ï¼Œä½¿ç”¨äº†é¢„åˆ†å‘çš„æ–¹å¼ç”ŸæˆIDï¼Œåœ¨DBä¸ŠæŒ‚Nä¸ªServer, æ¯ä¸ªServerå¯åŠ¨çš„æ—¶å€™éƒ½ä¼šå»DBæ‹¿å›ºå®šé•¿åº¦çš„ID Listï¼Œç„¶åå†åŸºäºå†…å­˜è¿›è¡Œåˆ†å‘ï¼Œæ•°æ®åº“ä¸­è®°å½•äº†å½“å‰æœ€å¤§çš„IDã€‚</p>
<ul>
<li>ä½¿ç”¨åŒBufferï¼Œå¼‚æ­¥è·å–å·æ®µ</li>
<li>MySQLé‡‡ç”¨åŠåŒæ­¥æ–¹å¼åŒæ­¥æ•°æ®</li>
</ul>
<h2 id="5-3-Leaf-Snowflakeæ¨¡å¼"><a href="#5-3-Leaf-Snowflakeæ¨¡å¼" class="headerlink" title="5.3 Leaf Snowflakeæ¨¡å¼"></a>5.3 Leaf Snowflakeæ¨¡å¼</h2><p>Leaf Snowflakeæ¨¡å¼æä¾›äº†Snowflakeçš„Javaç‰ˆæœ¬å®ç°ï¼Œä½¿ç”¨äº†Zookeeperèº«ä½“å·¥ç¨‹æœºå™¨å·ï¼Œè·å–åä¼šåœ¨æœ¬æœºæ–‡ä»¶ç³»ç»ŸåŒ–ç¼“å­˜ä¸€ä¸ªworkIDæ–‡ä»¶ã€‚</p>
<h2 id="5-4-Leaf-æ€»ç»“"><a href="#5-4-Leaf-æ€»ç»“" class="headerlink" title="5.4 Leaf æ€»ç»“"></a>5.4 Leaf æ€»ç»“</h2><ul>
<li>å·æ®µæ¨¡å¼ï¼šä¾èµ–äºæ•°æ®åº“ï¼Œä½ä½è¶‹åŠ¿å¢é•¿ï¼Œè¾ƒå°‘çš„IDå·æ®µæµªè´¹ï¼Œèƒ½å¤Ÿå®¹å¿MySQLçš„çŸ­æ—¶é—´ä¸å¯ç”¨ã€‚</li>
<li>Snowflakeæ¨¡å¼ï¼šå®Œå…¨åˆ†å¸ƒå¼ï¼ŒIDæœ‰è¯­ä¹‰ï¼ˆæ²¡æœ‰è§£å†³æ—¶é’Ÿå›æ‹¨çš„é—®é¢˜ï¼‰ã€‚</li>
</ul>
<h1 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h1><p>ç›®å‰æ¥è¯´ï¼Œåˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸º3ç±»ï¼š</p>
<ul>
<li>UUIDè¿™ç±»ä¾èµ–äºç¡¬ä»¶ï¼Œç”Ÿæˆæ— åºçš„ID</li>
<li>ä¾èµ–äºæ•°æ®åº“ï¼Œå¯ä»¥å®ç°å•è°ƒé€’å¢å’Œè¶‹åŠ¿é€’å¢</li>
<li>é›ªèŠ±ç®—æ³•ç±»ï¼Œä¾èµ–äºæ—¶é—´æˆ³ï¼Œè¶‹åŠ¿é€’å¢ï¼Œæœ‰æ—¶é’Ÿå›æ‹¨é—®é¢˜</li>
</ul>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é›ªèŠ±ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>10ä¸‡TPSçº§é«˜å¹¶å‘ç³»ç»Ÿâ€”â€”30äº¿çº§å‘é€é‡é¢‘æ¬¡ç®¡æ§ï¼ˆä¸€ï¼‰</title>
    <url>/2024/06/15/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-30-yi-ji-fa-song-liang-pin-ci-guan-kong/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><div class="note success no-icon flat"><p>åœ¨å®¢æˆ·çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œéœ€è¦åœ¨å…¨å±€å¼€å¯ç»ˆç«¯ç”¨æˆ·æ¶ˆæ¯å‘é€çš„é¢‘æ¬¡ç®¡æ§ï¼Œé¿å…æ¶ˆæ¯é‡å¤å‘é€ä»¥åŠæ®µæ—¶é—´å†…ä¸‹å‘å¤§é‡æ¶ˆæ¯å¯¹ç»ˆç«¯ç”¨æˆ·è¿›è¡Œä¿¡æ¯è½°ç‚¸ï¼Œä»è€Œå¼•èµ·ç»ˆç«¯ç”¨æˆ·æŠ•è¯‰ã€‚ç›®å‰ä¸šåŠ¡å¹³å°æ¯æ—¥æœ€é«˜çš„æ¶ˆæ¯å‘é€é‡ä¸º30äº¿ï¼Œå»é‡åçš„æ¶ˆæ¯æ¥æ”¶äººé‡åœ¨åƒä¸‡çº§åˆ°äº¿çº§ï¼Œæ¶ˆæ¯å‘é€ç®¡æ§å¹³å°éœ€è¦å¯¹æ¯ä¸ªæ¶ˆæ¯æ¥æ”¶äººçš„æ¶ˆæ¯å‘é€æ—¶é—´è¿›è¡Œç¼“å­˜ï¼Œå¹¶æ ¹æ®ç®¡æ§å¹³å°é…ç½®é¢‘æ¬¡ç®¡æ§ç­–ç•¥ï¼Œæ£€æŸ¥æœ€æ–°ä¸‹å‘çš„æ¶ˆæ¯æ˜¯å¦è¶…è¿‡è®¾ç½®çš„é¢‘æ¬¡ï¼Œè¶…è¿‡åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p>
</div>
<h2 id="1-1-é¢‘æ¬¡ç®¡æ§é…ç½®"><a href="#1-1-é¢‘æ¬¡ç®¡æ§é…ç½®" class="headerlink" title="1.1 é¢‘æ¬¡ç®¡æ§é…ç½®"></a>1.1 é¢‘æ¬¡ç®¡æ§é…ç½®</h2><table>
<thead>
<tr>
<th>é™åˆ¶é¡¹</th>
<th>é™åˆ¶é¢‘ç‡</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>æ¥æ”¶é¢‘æ¬¡ç®¡æ§</td>
<td>15æ¬¡&#x2F;1åˆ†é’Ÿ</td>
<td>ä»»æ„1åˆ†é’Ÿå†…ï¼Œå¯¹åŒä¸€ä¸ªæ¥æ”¶äººå‘é€æ¶ˆæ¯æœ€å¤š15æ¬¡ï¼Œè¶…å‡ºæ¬¡æ•°ä¼šè¢«é™åˆ¶ã€‚</td>
</tr>
<tr>
<td>æ¥æ”¶é¢‘æ¬¡ç®¡æ§</td>
<td>50æ¬¡&#x2F;24å°æ—¶</td>
<td>ä»»æ„24å°æ—¶å†…ï¼Œå¯¹åŒä¸€ä¸ªæ¥æ”¶äººå‘é€æ¶ˆæ¯æœ€å¤š50æ¬¡ï¼Œè¶…å‡ºæ¬¡æ•°ä¼šè¢«é™åˆ¶ã€‚</td>
</tr>
<tr>
<td>å†…å®¹é¢‘æ¬¡ç®¡æ§</td>
<td>2æ¬¡&#x2F;59ç§’</td>
<td>ä»»æ„59ç§’å†…ï¼Œå¯¹åŒä¸€ä¸ªæ¥æ”¶äººå‘é€åŒä¸€å†…å®¹ï¼ˆå†…å®¹å®Œå…¨ç›¸åŒï¼‰æœ€å¤š2æ¬¡ï¼Œè¶…å‡ºæ¬¡æ•°ä¼šè¢«é™åˆ¶ã€‚</td>
</tr>
<tr>
<td>å†…å®¹é¢‘æ¬¡ç®¡æ§</td>
<td>5æ¬¡&#x2F;59åˆ†é’Ÿ</td>
<td>ä»»æ„59åˆ†é’Ÿå†…ï¼Œå¯¹åŒä¸€ä¸ªæ¥æ”¶äººå‘é€åŒä¸€æ¶ˆæ¯å†…å®¹ï¼ˆå†…å®¹å®Œå…¨ç›¸åŒï¼‰æœ€å¤š5æ¬¡ï¼Œè¶…å‡ºæ¬¡æ•°ä¼šè¢«é™åˆ¶ã€‚</td>
</tr>
</tbody></table>
<h1 id="äºŒã€éœ€æ±‚åˆ†æ"><a href="#äºŒã€éœ€æ±‚åˆ†æ" class="headerlink" title="äºŒã€éœ€æ±‚åˆ†æ"></a>äºŒã€éœ€æ±‚åˆ†æ</h1><p>åŸºäºä¸Šè¿°ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªæ¶ˆæ¯æ¥æ”¶è€…åšæ¶ˆæ¯æ¥æ”¶çš„é¢‘æ¬¡é™åˆ¶ï¼Œåœ¨æ¯æ—¥30äº¿çº§çš„å‘é€é‡çš„åœºæ™¯ä¸‹ï¼Œæ¥æ”¶ç”¨æˆ·çš„æ•°é‡ä¹Ÿæ˜¯äº¿çº§çš„ã€‚æ ¹æ®ä¸šåŠ¡é¢‘æ¬¡ç®¡æ§é™æµè¦æ±‚ï¼Œéœ€è¦å®ç°åˆ†é’Ÿçº§åˆ«å’Œ24å°æ—¶çº§åˆ«çš„é¢‘æ¬¡ç®¡æ§ã€‚å³éœ€è¦å¯¹äº¿çº§ç»ˆç«¯æ¥æ”¶ç”¨æˆ·åˆ†åšç‹¬ç«‹çš„é™æµï¼Œé™æµçš„æ—¶é—´èŒƒå›´åœ¨åˆ†é’Ÿå’Œ24å°æ—¶çº§åˆ«ã€‚</p>
<h1 id="ä¸‰ã€æ–¹æ¡ˆè®¾è®¡"><a href="#ä¸‰ã€æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="ä¸‰ã€æ–¹æ¡ˆè®¾è®¡"></a>ä¸‰ã€æ–¹æ¡ˆè®¾è®¡</h1><p>ä¸Šè¿°ä¸šåŠ¡éœ€æ±‚å…¶å®æ˜¯ä¸€ç§æµé‡æ§åˆ¶åœºæ™¯ï¼Œå¯ä»¥ç»“åˆä¸€äº›å¸¸ç”¨çš„é™æµæ–¹æ¡ˆè¿›è¡Œåˆ†æä¸è®¾è®¡ã€‚ä¸šåŠ¡å¸¸è§çš„é™æµæ–¹æ¡ˆæœ‰ï¼šå›ºå®šçª—å£è®¡æ•°å™¨ã€æ»‘åŠ¨çª—å£è®¡æ•°å™¨ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€åˆ†å¸ƒå¼é™æµç­‰ï¼ˆè¯¦è§ï¼š<a href="https://www.mpoom.cn/2024/06/08/distributed/si-chong-jing-dian-de-xian-liu-suan-fa/">å››ç§ç»å…¸çš„é™æµç®—æ³•</a>ï¼‰ï¼Œæˆ‘ä»¬å…ˆåˆ†æç°æœ‰æ–¹æ¡ˆçš„ç‰¹ç‚¹å†ç»“åˆä¸šåŠ¡åœºæ™¯è¿›è¡Œæ–¹æ¡ˆè®¾è®¡ã€‚</p>
<h2 id="3-1-é™æµç®—æ³•é€‰æ‹©"><a href="#3-1-é™æµç®—æ³•é€‰æ‹©" class="headerlink" title="3.1 é™æµç®—æ³•é€‰æ‹©"></a>3.1 é™æµç®—æ³•é€‰æ‹©</h2><p>åŸºäºä¸Šè¿°ä¸šåŠ¡åœºæ™¯ï¼Œéœ€è¦å¯¹æ¯æ—¥äº¿çº§çš„ç»ˆç«¯æ¥æ”¶ç”¨æˆ·åšå•ç‹¬é™æµï¼Œç»“åˆç»å…¸çš„é™æµç®—æ³•ç‰¹ç‚¹é€‰æ‹©é€‚åˆçš„ç®—æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>é™æµç®—æ³•</th>
<th>ç‰¹ç‚¹</th>
<th>æ˜¯å¦é€‚åˆ</th>
<th>å…·ä½“è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>å›ºå®šæ—¶é—´çª—å£</td>
<td>ç®€å•ï¼Œæ˜“äºå®ç°å’Œç†è§£</td>
<td>å¯é€‰</td>
<td>å®¹å¿ä¸´ç•Œé—®é¢˜å­˜åœ¨</td>
</tr>
<tr>
<td>æ»‘åŠ¨æ—¶é—´çª—å£</td>
<td>ç®€å•æ˜“æ‡‚ï¼Œç²¾åº¦é«˜ï¼Œå¯æ‰©å±•æ€§å¼º</td>
<td>é€‚åˆ</td>
<td>å®ç°ç®€å•ç²¾åº¦é«˜</td>
</tr>
<tr>
<td>æ¼æ¡¶ç®—æ³•</td>
<td>å¹³æ»‘çš„é™åˆ¶å¤„ç†é€Ÿåº¦</td>
<td>ä¸é€‚åˆ</td>
<td>æ— æ³•åº”å¯¹çªå‘æµé‡</td>
</tr>
<tr>
<td>ä»¤ç‰Œæ¡¶ç®—æ³•</td>
<td>ç¨³å®šæ€§é«˜ã€ç²¾åº¦é«˜ã€å¯ä»¥å¤„ç†çªå‘æµé‡</td>
<td>ä¸é€‚åˆ</td>
<td>éœ€è¦å¯¹æ—¥å‘é€äº¿çº§ç”¨æˆ·åšé™æµï¼Œéœ€è¦ç»´æŠ¤ä¸Šäº¿ä¸ªä»¤ç‰Œæ¡¶ï¼Œå¤æ‚åº¦è¿‡é«˜</td>
</tr>
</tbody></table>
<p>ç»¼ä¸Šï¼Œç»å…¸çš„é™æµç®—æ³•ä¸­<code>æ»‘åŠ¨æ—¶é—´çª—å£</code>æ˜¯æœ€é€‚åˆçš„ç®—æ³•ï¼Œ<code>å›ºå®šæ—¶é—´çª—å£</code>ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼Œå› ä¸ºå›ºå®šæ—¶é—´çª—å£å­˜åœ¨ä¸€ä¸ªä¸´ç•Œé—®é¢˜ã€‚</p>
<h2 id="3-2-è¯¦ç»†è®¾è®¡"><a href="#3-2-è¯¦ç»†è®¾è®¡" class="headerlink" title="3.2 è¯¦ç»†è®¾è®¡"></a>3.2 è¯¦ç»†è®¾è®¡</h2><p>ç›®å‰ç³»ç»Ÿæ€§èƒ½éœ€è¦è¾¾åˆ°10ä¸‡TPSï¼Œåº”ç”¨ä½¿ç”¨é›†ç¾¤åŒ–æ–¹å¼éƒ¨ç½²ï¼ŒåŒæ—¶éœ€è¦å®ç°æ—¥äº¿çº§ç”¨æˆ·çš„é™æµã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªåŸºäºæ»‘åŠ¨æ—¶é—´çª—å£çš„åˆ†å¸ƒå¼é™æµå™¨ï¼Œä¸”æ”¯æŒäº¿çº§ç”¨æˆ·åšå•ç‹¬çš„é™æµã€‚<br>æ ¹æ®ä¸šåŠ¡åŠæ€§èƒ½è¦æ±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨Redisæ¥è®¾è®¡ä¸€ä¸ªåŸºäº<code>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</code>çš„åˆ†å¸ƒå¼é™æµå™¨ã€‚</p>
<p><img src="/2024/06/15/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-30-yi-ji-fa-song-liang-pin-ci-guan-kong/ZSET%E6%BB%91%E5%8A%A8%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A3%E9%99%90%E6%B5%81%E5%99%A8.png" alt="ZSETæ»‘åŠ¨æ—¶é—´çª—å£é™æµå™¨.png"></p>
<p>åŸºäºRedis ZSETé›†åˆçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ZSETæ¥å®ç°ä¸€ä¸ªæ»‘åŠ¨æ—¶é—´çª—å£ï¼Œç”¨æˆ·æ¯æ¬¡ä¸‹å‘æˆåŠŸåæˆ‘ä»¬å‘ZSETæ·»åŠ ä¸€ä¸ªæˆå‘˜ï¼Œè¯¥æˆå‘˜çš„å€¼å’Œåˆ†æ•°ä¸ºå½“å‰æ¶ˆæ¯çš„å‘é€æ—¶é—´æˆ³ã€‚</p>
<h3 id="3-2-1-å‘é€é™æµ"><a href="#3-2-1-å‘é€é™æµ" class="headerlink" title="3.2.1 å‘é€é™æµ"></a>3.2.1 å‘é€é™æµ</h3><p>å‘é€æ¶ˆæ¯å‰ï¼Œæˆ‘ä»¬æ ¹æ®å½“å‰æ—¶é—´å’Œæ»‘åŠ¨æ—¶é—´çª—å£å¤§å°è®¡ç®—å‡ºæ»‘åŠ¨çª—å£èµ·å§‹æ—¶é—´æˆ³ï¼Œé€šè¿‡ZSETçš„<code>Score</code>è·å–èµ·å§‹æ—¶é—´æˆ³å’Œå½“å‰æ—¶é—´æˆ³åŒºé—´å†…æˆå‘˜çš„ä¸ªæ•°å³ä¸ºç”¨æˆ·çš„æ¶ˆæ¯å‘é€é‡ï¼Œå¦‚æœè¶…å‡ºé¢‘æ¬¡é™åˆ¶åˆ™é™åˆ¶ä¸‹å‘ï¼Œå¦‚æœæœªè¶…è¿‡ï¼Œåˆ™å°†è¯¥å‘é€æ—¶é—´æ·»åŠ åˆ°ZSETä¸­ã€‚</p>
<h3 id="3-2-2-ä»£ç å®ç°"><a href="#3-2-2-ä»£ç å®ç°" class="headerlink" title="3.2.2 ä»£ç å®ç°"></a>3.2.2 ä»£ç å®ç°</h3><p>ä¸‹é¢é€šè¿‡Redisçš„ZSETæ•°æ®ç»“æ„åŠLUAè„šæœ¬å®ç°ä¸€ä¸ªæ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼ŒLuaè„šæœ¬<code>frequency_limit.lua</code>å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">-- æ¥æ”¶å‚æ•°
local key &#x3D; KEYS[1]
local windowSize &#x3D; tonumber(ARGV[1])
local limit &#x3D; tonumber(ARGV[2])

-- è·å–ç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³
local nowMicros &#x3D; redis.call(&#39;time&#39;)
local nowMillis &#x3D; math.floor(nowMicros[1] * 1000 + nowMicros[2] &#x2F; 1000)

-- è®¡ç®—æ—¶é—´çª—å£çš„æœ€å°å€¼
local minScore &#x3D; nowMillis - windowSize

-- è·å–æ—¶é—´çª—å£èŒƒå›´å†…çš„æˆå‘˜æ•°é‡
local count &#x3D; redis.call(&#39;ZCOUNT&#39;, key, minScore, nowMillis)

-- å¦‚æœæ•°é‡æ²¡æœ‰è¶…è¿‡é™åˆ¶
if count &lt; limit then
    -- æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå¯ç”¨çš„ã€æœªå­˜åœ¨äºZSETä¸­çš„æ—¶é—´æˆ³
    local uniqueTimestamp &#x3D; nowMillis
    while redis.call(&#39;ZSCORE&#39;, key, uniqueTimestamp) do
        uniqueTimestamp &#x3D; uniqueTimestamp + 1
    end
    -- å°†æ‰¾åˆ°çš„å”¯ä¸€æ—¶é—´æˆ³ä½œä¸ºå€¼ï¼Œå½“å‰æ—¶é—´æˆ³ä½œä¸ºscoreæ·»åŠ åˆ°ZSET
    redis.call(&#39;ZADD&#39;, key, nowMillis, uniqueTimestamp)
    
    -- ä»…å½“æ·»åŠ äº†æ–°å…ƒç´ åï¼Œæ‰æ›´æ–°ZSETçš„è¿‡æœŸæ—¶é—´
    redis.call(&#39;EXPIRE&#39;, key, windowSize)
end

-- è¿”å›è®¡ç®—å‡ºçš„æ•°é‡
return count<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="ç¼“å­˜è¿‡æœŸæ—¶é—´"><a href="#ç¼“å­˜è¿‡æœŸæ—¶é—´" class="headerlink" title="ç¼“å­˜è¿‡æœŸæ—¶é—´"></a>ç¼“å­˜è¿‡æœŸæ—¶é—´</h4><p>æ¯æ¬¡è°ƒç”¨æ—¶å°†ç¼“å­˜çš„è¿‡æœŸæ—¶é—´æ›´æ–°ä¸ºä¸€ä¸ªæ»‘åŠ¨æ—¶é—´çª—å£å¤§å°ï¼Œå½“ä¸€ä¸ªæ»‘åŠ¨æ—¶é—´çª—å£åŒºé—´å†…æ²¡æœ‰è¯·æ±‚è¿›æ¥ï¼Œåˆ™ç¼“å­˜è¿‡æœŸã€‚</p>
<h4 id="å¹¶å‘è®¿é—®é—®é¢˜"><a href="#å¹¶å‘è®¿é—®é—®é¢˜" class="headerlink" title="å¹¶å‘è®¿é—®é—®é¢˜"></a>å¹¶å‘è®¿é—®é—®é¢˜</h4><p>æˆ‘ä»¬åœ¨ZSETä¸­ä½¿ç”¨æ¯«ç§’çº§åˆ«çš„æ—¶é—´æˆ³æ¥è®°å½•è®¿é—®æ•°é‡ã€‚åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå­˜åœ¨åŒä¸€æ¯«ç§’ä¸‹å‘å¤šæ¡æ¶ˆæ¯å¯¼è‡´å‘é€é‡å‡ºç°è¦†ç›–ï¼Œæˆ‘ä»¬é‡‡ç”¨å ç”¨æœªæ¥æ—¶é—´æˆ³çš„æ–¹å¼è§£å†³å¹¶å‘å†²çªã€‚</p>
<div class="note success no-icon flat"><p><strong>è¯´æ˜</strong>ï¼šç”±äºæˆ‘ä»¬æ˜¯å¯¹ç”¨æˆ·è¿›è¡Œé™æµï¼Œç³»ç»Ÿçš„å¹¶å‘é«˜ï¼Œä½†æ˜¯ç”¨æˆ·çº§åˆ«çš„å¹¶å‘å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œå¦‚ä¸Šè¿°çš„1åˆ†é’Ÿ15æ¬¡ï¼Œæ‰€ä»¥é‡‡ç”¨å ç”¨æœªæ¥æ—¶é—´æˆ³çš„æ–¹å¼è§£å†³å¹¶å‘å†²çªã€‚å¦‚æœæ˜¯åº”å¯¹ç³»ç»Ÿçº§åˆ«çš„é«˜å¹¶å‘è¯·æ±‚ï¼Œå¯ä»¥åœ¨æ—¶é—´æˆ³åé¢å¢åŠ åºåˆ—å·æ¥è§£å†³å¹¶å‘å†²çªï¼Œåºåˆ—å·çš„é•¿åº¦é€šè¿‡æ¯ç§’çš„å¹¶å‘æ•°è¿›è¡Œè®¡ç®—è¯„ä¼°ã€‚</p>
</div>

<h3 id="3-2-3-éªŒè¯æµ‹è¯•"><a href="#3-2-3-éªŒè¯æµ‹è¯•" class="headerlink" title="3.2.3 éªŒè¯æµ‹è¯•"></a>3.2.3 éªŒè¯æµ‹è¯•</h3><div class="note success no-icon flat"><p>å‡è®¾ç”¨æˆ·<code>18829340001</code>æ¯åˆ†é’Ÿæ¥æ”¶åˆ°æ¶ˆæ¯çš„æ•°é‡é™åˆ¶ä¸º5æ¡ï¼Œå¦‚æœå‘é€é‡å°äºé™åˆ¶çš„5æ¡åˆ™ç»§ç»­ä¸‹å‘ï¼Œå¦‚æœå¤§äºç­‰äºé™åˆ¶çš„5æ¡ï¼Œåˆ™è¿›è¡Œé¢‘æ¬¡ç®¡æ§ã€‚</p>
</div>
<h4 id="ä¸Šä¼ Luaè„šæœ¬"><a href="#ä¸Šä¼ Luaè„šæœ¬" class="headerlink" title="ä¸Šä¼ Luaè„šæœ¬"></a>ä¸Šä¼ Luaè„šæœ¬</h4><pre class="line-numbers language-none"><code class="language-none">[root@develop bin]# .&#x2F;redis-cli -p 6383 -a 123456 SCRIPT LOAD &quot;$(cat frequency_limit.lua)&quot;
Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
&quot;59931c4f3ae5b3601ba2988d12d7aa897afc9549&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="æ‰§è¡ŒLuaè„šæœ¬"><a href="#æ‰§è¡ŒLuaè„šæœ¬" class="headerlink" title="æ‰§è¡ŒLuaè„šæœ¬"></a>æ‰§è¡ŒLuaè„šæœ¬</h4><p>ä¸‹é¢é€šè¿‡Redisæ‰§è¡Œä¸Šè¿°luaè„šæœ¬ï¼Œè·å–<code>18829340001</code>å‰1åˆ†é’Ÿçš„æ¶ˆæ¯å‘é€é‡ï¼Œå½“è¿”å›å€¼å°äº5æ—¶ï¼Œå¯ä»¥ç»§ç»­ä¸‹å‘æ¶ˆæ¯ï¼›å½“è¿”å›å€¼ä¸º5æ—¶ï¼Œè¡¨ç¤ºå‰1åˆ†é’Ÿå†…å·²ç»ä¸‹å‘äº†5æ¡ï¼Œéœ€è¦è¿›è¡Œé¢‘æ¬¡ç®¡æ§ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 0
127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 1
127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 2
127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 3
127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 4
127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 5
127.0.0.1:6383&gt; EVALSHA 59931c4f3ae5b3601ba2988d12d7aa897afc9549 1 18829340001 60000 5
(integer) 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å››ã€æ€§èƒ½è¯„ä¼°"><a href="#å››ã€æ€§èƒ½è¯„ä¼°" class="headerlink" title="å››ã€æ€§èƒ½è¯„ä¼°"></a>å››ã€æ€§èƒ½è¯„ä¼°</h1><h2 id="4-1-ä¸šåŠ¡åœºæ™¯åˆ†æ"><a href="#4-1-ä¸šåŠ¡åœºæ™¯åˆ†æ" class="headerlink" title="4.1 ä¸šåŠ¡åœºæ™¯åˆ†æ"></a>4.1 ä¸šåŠ¡åœºæ™¯åˆ†æ</h2><div class="note success no-icon flat"><p>æ¶ˆæ¯å‘é€ç®¡æ§ç³»ç»Ÿæ€§èƒ½è¦æ±‚ä¸º10ä¸‡TPSï¼Œå¹³å‡å“åº”æ—¶é•¿ä¸è¶…è¿‡50msã€‚ç³»ç»Ÿæ¯å¤©å‘é€å³°å€¼ä¸º30äº¿ï¼Œå•ç‹¬çš„å‘é€ç”¨æˆ·çº¦åœ¨äº¿çº§åˆ«ï¼Œå…¨å±€é…ç½®é¢‘æ¬¡ç®¡æ§ä¸ªæ•°è‡³å°‘ä¸º2ä¸ªï¼Œç»“åˆç³»ç»Ÿå…¶å®ƒè®¿é—®Redisçš„åœºæ™¯ï¼Œæ¯ä¸ªè¯·æ±‚å¹³å‡è®¿é—®Redis3æ¬¡ï¼Œé¢‘æ¬¡ç®¡æ§çš„æœ€å¤§æ—¶é•¿ä¸º24å°æ—¶ï¼Œå³ç”¨æˆ·å‘é€è®°å½•æœ€å¤§éœ€è¦ä¿å­˜24å°æ—¶ï¼Œç‹¬ç«‹ç”¨æˆ·æ•°åœ¨äº¿çº§ã€‚</p>
</div>

<p><strong>å³Redisçš„æ€§èƒ½è¦åœ¨30ä¸‡TPSä»¥ä¸Š,éœ€è¦æ”¯æŒäº¿çº§æ•°æ®ç¼“å­˜ã€‚</strong></p>
<h2 id="4-2-Redisä¸»å¤‡æ€§èƒ½è¯„ä¼°"><a href="#4-2-Redisä¸»å¤‡æ€§èƒ½è¯„ä¼°" class="headerlink" title="4.2 Redisä¸»å¤‡æ€§èƒ½è¯„ä¼°"></a>4.2 Redisä¸»å¤‡æ€§èƒ½è¯„ä¼°</h2><p>è¯¥é¡¹ç›®ä½¿ç”¨åä¸ºäº‘éƒ¨ç½²ï¼Œä½¿ç”¨åä¸ºäº‘ä¸ŠRedisæœåŠ¡ï¼Œåä¸ºäº‘æä¾›çš„<a href="https://support.huaweicloud.com/usermanual-dcs/dcs_10_0001.html">Redis6ä¸»å¤‡æ€§èƒ½</a>æµ‹è¯•æ•°æ®å¦‚ä¸‹ï¼š<br><img src="/2024/06/15/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-30-yi-ji-fa-song-liang-pin-ci-guan-kong/%E5%8D%8E%E4%B8%BA%E4%BA%91Redis6%E4%B8%BB%E5%A4%87%E6%80%A7%E8%83%BD%E6%95%B0%E6%8D%AE.png" alt="åä¸ºäº‘Redis6ä¸»å¤‡æ€§èƒ½æ•°æ®"></p>
<p>Redisä¸»å¤‡32Gå®ä¾‹çš„æ€§èƒ½åœ¨14ä¸‡TPSä½œä¸ºï¼Œæ— æ³•æ»¡è¶³ç³»ç»Ÿ30ä¸‡+TPSæ€§èƒ½è¦æ±‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨Redisé›†ç¾¤ã€‚</p>
<h2 id="4-3-Redisé›†ç¾¤æ€§èƒ½è¯„ä¼°"><a href="#4-3-Redisé›†ç¾¤æ€§èƒ½è¯„ä¼°" class="headerlink" title="4.3 Redisé›†ç¾¤æ€§èƒ½è¯„ä¼°"></a>4.3 Redisé›†ç¾¤æ€§èƒ½è¯„ä¼°</h2><p>åä¸ºäº‘æä¾›çš„<a href="https://support.huaweicloud.com/usermanual-dcs/dcs_10_0002.html">Redis6é›†ç¾¤æ€§èƒ½</a>æµ‹è¯•æ•°æ®å¦‚ä¸‹ï¼š<br><img src="/2024/06/15/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-30-yi-ji-fa-song-liang-pin-ci-guan-kong/%E5%8D%8E%E4%B8%BA%E4%BA%91Redis6%E9%9B%86%E7%BE%A4%E6%80%A7%E8%83%BD%E6%95%B0%E6%8D%AE.png" alt="åä¸ºäº‘Redis6é›†ç¾¤æ€§èƒ½æ•°æ®"><br>åä¸ºäº‘Redis6 32Gé›†ç¾¤å®ä¾‹çš„æ€§èƒ½è¾¾åˆ°30ä¸‡tpsï¼Œä¸ºåº”å¯¹ä¸šåŠ¡ä¸­é…ç½®å¤šæ¡é¢‘æ¬¡ç®¡æ§åœºæ™¯ï¼Œé€‰æ‹©64G 8åˆ†ç‰‡çš„è§„æ ¼ã€‚<br>ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå®¢æˆ·ç›´æ¥é€‰æ‹©256G 32åˆ†ç‰‡çš„è§„æ ¼å®ä¾‹ï¼Œåœ¨é…ç½®2æ¡å…¨å±€çš„é¢‘æ¬¡ç®¡æ§åœºæ™¯ä¸‹ï¼Œå‹æµ‹10ä¸‡TPSï¼ŒRedisé›†ç¾¤CPUè´Ÿè½½åœ¨50%ä»¥ä¸Šã€‚</p>
<h1 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºRedisçš„ZSETæ•°æ®ç»“æ„å®ç°ä¸€ä¸ªæ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼Œå®ç°äº¿çº§ç”¨æˆ·çš„å‘é€é¢‘æ¬¡ç®¡æ§ï¼Œå¹¶æ ¹æ®ä¸šåŠ¡åœºæ™¯å’Œåä¸ºäº‘Redisä¸åŒè§„æ ¼çš„æ€§èƒ½è¿›è¡Œè§„æ ¼é€‰æ‹©ã€‚</p>
<h2 id="5-1-ä¼˜åŒ–æ”¹è¿›"><a href="#5-1-ä¼˜åŒ–æ”¹è¿›" class="headerlink" title="5.1 ä¼˜åŒ–æ”¹è¿›"></a>5.1 ä¼˜åŒ–æ”¹è¿›</h2><p>åœ¨ä¸Šè¿°è®¾è®¡æ–¹æ¡ˆä¸­ï¼Œç»“åˆä¸šåŠ¡åœºæ™¯åˆ†æé¢‘æ¬¡ç®¡æ§é…ç½®æ•°é‡åœ¨1-2ä¸ªå·¦å³ï¼Œä¸ºå®ç°ç®€å•æ‰€ä»¥æ¯ä¸ªé¢‘æ¬¡ç®¡æ§å•ç‹¬ç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£è®¡æ•°å™¨ã€‚å¦‚æœéœ€è¦é€‚é…è¾ƒå¤šçš„çª—å£å¤§å°çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥å°†å¤šä¸ªæ»‘åŠ¨çª—å£è¿›è¡Œåˆå¹¶ï¼Œé™ä½ç½‘ç»œæ¶ˆè€—ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<h2 id="5-2-å…¶å®ƒé—®é¢˜"><a href="#5-2-å…¶å®ƒé—®é¢˜" class="headerlink" title="5.2 å…¶å®ƒé—®é¢˜"></a>5.2 å…¶å®ƒé—®é¢˜</h2><p>åœ¨å¤§æ•°æ®é‡ã€é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼ŒRedisçš„ä½¿ç”¨è¿˜ä¼šå‡ºç°å¤§Keyç­‰é—®é¢˜ï¼Œå…·ä½“çš„åœºæ™¯å’Œæ¡ˆä¾‹ï¼Œæ•¬è¯·æœŸå¾…åç»­æ–‡ç« ã€‚</p>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://juejin.cn/post/7000152990501847048">å¾®æœåŠ¡ â€”â€” å¸¸è§çš„5ç§é™æµæ–¹æ¡ˆï½œ8æœˆæ›´æ–‡æŒ‘æˆ˜</a><br><a href="https://juejin.cn/post/7339544833999110170">åŸºäºredisçš„ç®€æ˜“æ»‘åŠ¨çª—å£å®ç°</a><br><a href="https://heapdump.cn/article/5480577">é¢è¯•å¿…å¤‡ï¼šå››ç§ç»å…¸é™æµç®—æ³•è®²è§£</a></p>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é«˜å¹¶å‘</tag>
        <tag>é™æµç®—æ³•</tag>
        <tag>10ä¸‡TPS</tag>
        <tag>é¢‘æ¬¡ç®¡æ§</tag>
        <tag>æ»‘åŠ¨çª—å£</tag>
      </tags>
  </entry>
  <entry>
    <title>10ä¸‡TPSçº§é«˜å¹¶å‘ç³»ç»Ÿâ€”â€”æ€§èƒ½å‹æµ‹ä¸ä¼˜åŒ–</title>
    <url>/2024/06/08/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-xing-neng-ya-ce-yu-you-hua/</url>
    <content><![CDATA[<h2 id="ä¸€ã€å‹æµ‹å‡†å¤‡"><a href="#ä¸€ã€å‹æµ‹å‡†å¤‡" class="headerlink" title="ä¸€ã€å‹æµ‹å‡†å¤‡"></a>ä¸€ã€å‹æµ‹å‡†å¤‡</h2><h3 id="1-1-ç³»ç»ŸèƒŒæ™¯"><a href="#1-1-ç³»ç»ŸèƒŒæ™¯" class="headerlink" title="1.1 ç³»ç»ŸèƒŒæ™¯"></a>1.1 ç³»ç»ŸèƒŒæ™¯</h3><p>æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°éœ€è¦æ”¯æŒ10ä¸‡TPSçš„æ¥å£è°ƒç”¨ï¼Œè¦æ±‚å•æ¬¡è¯·æ±‚å¤„ç†è€—æ—¶åœ¨50msä»¥å†…ã€‚ç³»ç»Ÿé‡‡ç”¨é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œé€šè¿‡å¼¹æ€§è´Ÿè½½å‡è¡¡å®ç°é«˜å¯ç”¨å’Œæ€§èƒ½æ‰©å±•ã€‚</p>
<p><strong>æ ¸å¿ƒæŠ€æœ¯æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>ç›®æ ‡TPSï¼š10ä¸‡</li>
<li>å“åº”æ—¶é—´ï¼šâ‰¤50ms</li>
<li>æ—¥å‘é€é‡ï¼š30äº¿æ¡</li>
<li>å¹³å‡å‘é€é€Ÿåº¦ï¼š3.47ä¸‡æ¡&#x2F;ç§’</li>
</ul>
<h3 id="1-2-å‹æµ‹ç¯å¢ƒ"><a href="#1-2-å‹æµ‹ç¯å¢ƒ" class="headerlink" title="1.2 å‹æµ‹ç¯å¢ƒ"></a>1.2 å‹æµ‹ç¯å¢ƒ</h3><table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>è§„æ ¼é…ç½®</th>
<th>æ•°é‡</th>
</tr>
</thead>
<tbody><tr>
<td>ç®¡æ§APIæœåŠ¡</td>
<td>16æ ¸&#x2F;32GB&#x2F;500Gé«˜IO</td>
<td>15èŠ‚ç‚¹</td>
</tr>
<tr>
<td>Redisé›†ç¾¤</td>
<td>256G&#x2F;32åˆ†ç‰‡</td>
<td>32å®ä¾‹</td>
</tr>
<tr>
<td>MySQLæ•°æ®åº“</td>
<td>16æ ¸&#x2F;32GB&#x2F;1TBè¶…é«˜IO</td>
<td>ä¸»ä»</td>
</tr>
<tr>
<td>è´Ÿè½½å‡è¡¡å™¨</td>
<td>ä¸­å‹II&#x2F;500Må¸¦å®½</td>
<td>1å°</td>
</tr>
<tr>
<td>å‹æµ‹å®¢æˆ·ç«¯</td>
<td>8æ ¸&#x2F;16GB</td>
<td>3å°</td>
</tr>
</tbody></table>
<h3 id="1-3-å‹æµ‹å·¥å…·é€‰å‹"><a href="#1-3-å‹æµ‹å·¥å…·é€‰å‹" class="headerlink" title="1.3 å‹æµ‹å·¥å…·é€‰å‹"></a>1.3 å‹æµ‹å·¥å…·é€‰å‹</h3><p>é€‰ç”¨ <strong>JMeter</strong> ä½œä¸ºå‹æµ‹å·¥å…·ï¼š</p>
<ul>
<li>æ”¯æŒé«˜å¹¶å‘åœºæ™¯</li>
<li>å¯è§†åŒ–æŠ¥è¡¨</li>
<li>åˆ†å¸ƒå¼å‹æµ‹</li>
<li>æ’ä»¶ä¸°å¯Œ</li>
</ul>
<h2 id="äºŒã€å‹æµ‹æ–¹æ¡ˆè®¾è®¡"><a href="#äºŒã€å‹æµ‹æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="äºŒã€å‹æµ‹æ–¹æ¡ˆè®¾è®¡"></a>äºŒã€å‹æµ‹æ–¹æ¡ˆè®¾è®¡</h2><h3 id="2-1-å‹æµ‹åœºæ™¯"><a href="#2-1-å‹æµ‹åœºæ™¯" class="headerlink" title="2.1 å‹æµ‹åœºæ™¯"></a>2.1 å‹æµ‹åœºæ™¯</h3><p><strong>åœºæ™¯ä¸€ï¼šåŸºç¡€åŠŸèƒ½å‹æµ‹</strong></p>
<ul>
<li>å¹¶å‘ç”¨æˆ·æ•°ï¼š1000 â†’ 3000 â†’ 5000</li>
<li>æŒç»­æ—¶é—´ï¼šæ¯é˜¶æ®µ10åˆ†é’Ÿ</li>
<li>ç›®æ ‡ï¼šéªŒè¯åŸºç¡€æ€§èƒ½</li>
</ul>
<p><strong>åœºæ™¯äºŒï¼šå³°å€¼å‹æµ‹</strong></p>
<ul>
<li>å¹¶å‘ç”¨æˆ·æ•°ï¼š5000</li>
<li>æŒç»­æ—¶é—´ï¼š30åˆ†é’Ÿ</li>
<li>ç›®æ ‡ï¼šéªŒè¯10ä¸‡TPSç›®æ ‡</li>
</ul>
<p><strong>åœºæ™¯ä¸‰ï¼šç¨³å®šæ€§å‹æµ‹</strong></p>
<ul>
<li>å¹¶å‘ç”¨æˆ·æ•°ï¼š4000</li>
<li>æŒç»­æ—¶é—´ï¼š2å°æ—¶</li>
<li>ç›®æ ‡ï¼šéªŒè¯ç³»ç»Ÿç¨³å®šæ€§</li>
</ul>
<h3 id="2-2-ç›‘æ§æŒ‡æ ‡"><a href="#2-2-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="2.2 ç›‘æ§æŒ‡æ ‡"></a>2.2 ç›‘æ§æŒ‡æ ‡</h3><p><strong>åº”ç”¨å±‚æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰</li>
<li>å“åº”æ—¶é—´ï¼ˆå¹³å‡&#x2F;P95&#x2F;P99ï¼‰</li>
<li>é”™è¯¯ç‡</li>
<li>å¹¶å‘è¿æ¥æ•°</li>
</ul>
<p><strong>ç³»ç»Ÿå±‚æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>CPUä½¿ç”¨ç‡</li>
<li>å†…å­˜ä½¿ç”¨ç‡</li>
<li>ç½‘ç»œå¸¦å®½</li>
<li>ç£ç›˜IO</li>
</ul>
<p><strong>ä¸­é—´ä»¶æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>Redis QPS</li>
<li>MySQLè¿æ¥æ•°</li>
<li>è´Ÿè½½å‡è¡¡å™¨ååé‡</li>
</ul>
<h2 id="ä¸‰ã€å‹æµ‹è¿‡ç¨‹ä¸é—®é¢˜"><a href="#ä¸‰ã€å‹æµ‹è¿‡ç¨‹ä¸é—®é¢˜" class="headerlink" title="ä¸‰ã€å‹æµ‹è¿‡ç¨‹ä¸é—®é¢˜"></a>ä¸‰ã€å‹æµ‹è¿‡ç¨‹ä¸é—®é¢˜</h2><h3 id="3-1-ç¬¬ä¸€è½®å‹æµ‹ï¼ˆå¹¶å‘1000ï¼‰"><a href="#3-1-ç¬¬ä¸€è½®å‹æµ‹ï¼ˆå¹¶å‘1000ï¼‰" class="headerlink" title="3.1 ç¬¬ä¸€è½®å‹æµ‹ï¼ˆå¹¶å‘1000ï¼‰"></a>3.1 ç¬¬ä¸€è½®å‹æµ‹ï¼ˆå¹¶å‘1000ï¼‰</h3><p><strong>å‹æµ‹ç»“æœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">TPS: 2.8ä¸‡
å¹³å‡å“åº”æ—¶é—´: 35ms
P95å“åº”æ—¶é—´: 48ms
é”™è¯¯ç‡: 0%
CPUä½¿ç”¨ç‡: 45%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ç»“è®º</strong>ï¼šåŸºç¡€æ€§èƒ½æ­£å¸¸ï¼Œç»§ç»­æå‡å¹¶å‘</p>
<h3 id="3-2-ç¬¬äºŒè½®å‹æµ‹ï¼ˆå¹¶å‘3000ï¼‰"><a href="#3-2-ç¬¬äºŒè½®å‹æµ‹ï¼ˆå¹¶å‘3000ï¼‰" class="headerlink" title="3.2 ç¬¬äºŒè½®å‹æµ‹ï¼ˆå¹¶å‘3000ï¼‰"></a>3.2 ç¬¬äºŒè½®å‹æµ‹ï¼ˆå¹¶å‘3000ï¼‰</h3><p><strong>å‹æµ‹ç»“æœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">TPS: 6.5ä¸‡
å¹³å‡å“åº”æ—¶é—´: 45ms
P95å“åº”æ—¶é—´: 78ms
é”™è¯¯ç‡: 0.1%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å‘ç°é—®é¢˜</strong>ï¼š</p>
<ol>
<li>Redisè¿æ¥æ± è€—å°½ï¼Œå‡ºç°è¶…æ—¶</li>
<li>éƒ¨åˆ†èŠ‚ç‚¹CPUä½¿ç”¨ç‡è¾¾åˆ°85%</li>
<li>å“åº”æ—¶é—´P95è¶…è¿‡é¢„æœŸ</li>
</ol>
<h3 id="3-3-ç¬¬ä¸‰è½®å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰"><a href="#3-3-ç¬¬ä¸‰è½®å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰" class="headerlink" title="3.3 ç¬¬ä¸‰è½®å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰"></a>3.3 ç¬¬ä¸‰è½®å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰</h3><p><strong>å‹æµ‹ç»“æœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">TPS: 8.2ä¸‡
å¹³å‡å“åº”æ—¶é—´: 58ms
P95å“åº”æ—¶é—´: 120ms
é”™è¯¯ç‡: 2.3%
Redis QPS: 16ä¸‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å‘ç°é—®é¢˜</strong>ï¼š</p>
<ol>
<li><strong>Redisæˆä¸ºç“¶é¢ˆ</strong>ï¼šä¸»å¤‡å®ä¾‹64Gå†…å­˜æ— æ³•æ”¯æ’‘</li>
<li><strong>ç½‘ç»œå¸¦å®½ä¸è¶³</strong>ï¼šELBå¸¦å®½400Mæ¥è¿‘é¥±å’Œ</li>
<li><strong>GCé¢‘ç¹</strong>ï¼šYoung GCæ¯ç§’è§¦å‘2-3æ¬¡</li>
</ol>
<h2 id="å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ"><a href="#å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ" class="headerlink" title="å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ"></a>å››ã€æ€§èƒ½ä¼˜åŒ–å®è·µ</h2><h3 id="4-1-Redisé›†ç¾¤å‡çº§"><a href="#4-1-Redisé›†ç¾¤å‡çº§" class="headerlink" title="4.1 Redisé›†ç¾¤å‡çº§"></a>4.1 Redisé›†ç¾¤å‡çº§</h3><p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡è¯·æ±‚è‡³å°‘è®¿é—®2æ¬¡Redis</li>
<li>10ä¸‡TPSä¸‹Redis QPSè¾¾åˆ°20ä¸‡</li>
<li>å•å®ä¾‹æ— æ³•æ”¯æ’‘é«˜å¹¶å‘è¯»å†™</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å‡çº§ä¸ºRedisé›†ç¾¤ï¼ˆ32åˆ†ç‰‡&#x2F;256Gï¼‰</li>
<li>æ°´å¹³æ‰©å±•è¯»å†™èƒ½åŠ›</li>
<li>æ•°æ®åˆ†ç‰‡é™ä½å•èŠ‚ç‚¹å‹åŠ›</li>
</ul>
<p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Redis QPSæ”¯æŒ: 20ä¸‡+ â†’ 100ä¸‡+
Rediså“åº”æ—¶é—´: 5-8ms â†’ 1-3ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="4-2-è´Ÿè½½å‡è¡¡å™¨ä¼˜åŒ–"><a href="#4-2-è´Ÿè½½å‡è¡¡å™¨ä¼˜åŒ–" class="headerlink" title="4.2 è´Ÿè½½å‡è¡¡å™¨ä¼˜åŒ–"></a>4.2 è´Ÿè½½å‡è¡¡å™¨ä¼˜åŒ–</h3><p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>ä¸­å‹IIé»˜è®¤å¸¦å®½400M</li>
<li>10ä¸‡TPSä¸‹å¸¦å®½éœ€æ±‚è¶…è¿‡500M</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å‡çº§å¸¦å®½è‡³600M</li>
<li>è°ƒæ•´è´Ÿè½½å‡è¡¡ç®—æ³•ä¸ºåŠ æƒè½®è¯¢</li>
<li>å¯ç”¨ä¼šè¯ä¿æŒ</li>
</ul>
<p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">å¸¦å®½ç“¶é¢ˆæ¶ˆé™¤
è¯·æ±‚åˆ†å‘æ›´å‡è¡¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="4-3-JVMå‚æ•°è°ƒä¼˜"><a href="#4-3-JVMå‚æ•°è°ƒä¼˜" class="headerlink" title="4.3 JVMå‚æ•°è°ƒä¼˜"></a>4.3 JVMå‚æ•°è°ƒä¼˜</h3><p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>å †å†…å­˜16Gé…ç½®ä¸åˆç†</li>
<li>Young GCé¢‘ç¹è§¦å‘</li>
<li>Full GCå¶å‘</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-Xms24G</span> <span class="token parameter variable">-Xmx24G</span>
<span class="token parameter variable">-Xmn12G</span>
<span class="token parameter variable">-XX:+UseG1GC</span>
<span class="token parameter variable">-XX:MaxGCPauseMillis</span><span class="token operator">=</span><span class="token number">50</span>
<span class="token parameter variable">-XX:G1ReservePercent</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token parameter variable">-XX:InitiatingHeapOccupancyPercent</span><span class="token operator">=</span><span class="token number">45</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ä¼˜åŒ–æ•ˆæœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Young GCé¢‘ç‡: 2-3æ¬¡&#x2F;ç§’ â†’ 0.5æ¬¡&#x2F;ç§’
GCæš‚åœæ—¶é—´: 20-30ms â†’ 10-15ms
Full GC: å¶å‘ â†’ æœªå‡ºç°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="4-4-è¿æ¥æ± ä¼˜åŒ–"><a href="#4-4-è¿æ¥æ± ä¼˜åŒ–" class="headerlink" title="4.4 è¿æ¥æ± ä¼˜åŒ–"></a>4.4 è¿æ¥æ± ä¼˜åŒ–</h3><p><strong>Redisè¿æ¥æ± é…ç½®</strong>ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">jedis</span><span class="token punctuation">:</span>
  <span class="token key atrule">pool</span><span class="token punctuation">:</span>
    <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">500</span>    <span class="token comment"># æœ€å¤§è¿æ¥æ•°</span>
    <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">300</span>      <span class="token comment"># æœ€å¤§ç©ºé—²è¿æ¥</span>
    <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">100</span>      <span class="token comment"># æœ€å°ç©ºé—²è¿æ¥</span>
    <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">3000</span>     <span class="token comment"># æœ€å¤§ç­‰å¾…æ—¶é—´(ms)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>MySQLè¿æ¥æ± é…ç½®</strong>ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">datasource</span><span class="token punctuation">:</span>
  <span class="token key atrule">hikari</span><span class="token punctuation">:</span>
    <span class="token key atrule">maximum-pool-size</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">minimum-idle</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">connection-timeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
    <span class="token key atrule">idle-timeout</span><span class="token punctuation">:</span> <span class="token number">600000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-5-åº”ç”¨å±‚ä¼˜åŒ–"><a href="#4-5-åº”ç”¨å±‚ä¼˜åŒ–" class="headerlink" title="4.5 åº”ç”¨å±‚ä¼˜åŒ–"></a>4.5 åº”ç”¨å±‚ä¼˜åŒ–</h3><p><strong>1. ç¼“å­˜é¢„çƒ­</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostConstruct</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preloadCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// é¢„åŠ è½½çƒ­ç‚¹æ•°æ®</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Keyword</span><span class="token punctuation">></span></span> keywords <span class="token operator">=</span> keywordService<span class="token punctuation">.</span><span class="token function">getAllKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    keywords<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>k <span class="token operator">-></span> redisCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2. å¼‚æ­¥å¤„ç†</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// éæ ¸å¿ƒé€»è¾‘å¼‚æ­¥åŒ–</span>
<span class="token annotation punctuation">@Async</span><span class="token punctuation">(</span><span class="token string">"taskExecutor"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recordAuditLog</span><span class="token punctuation">(</span><span class="token class-name">AuditLog</span> log<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    auditLogRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>3. æ‰¹é‡æ“ä½œ</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Redisæ‰¹é‡è·å–</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> <span class="token function">buildKeys</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> values <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiGet</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="äº”ã€ä¼˜åŒ–åå‹æµ‹ç»“æœ"><a href="#äº”ã€ä¼˜åŒ–åå‹æµ‹ç»“æœ" class="headerlink" title="äº”ã€ä¼˜åŒ–åå‹æµ‹ç»“æœ"></a>äº”ã€ä¼˜åŒ–åå‹æµ‹ç»“æœ</h2><h3 id="5-1-å³°å€¼å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰"><a href="#5-1-å³°å€¼å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰" class="headerlink" title="5.1 å³°å€¼å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰"></a>5.1 å³°å€¼å‹æµ‹ï¼ˆå¹¶å‘5000ï¼‰</h3><p><strong>å‹æµ‹æ•°æ®</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">æµ‹è¯•æ—¶é•¿: 30åˆ†é’Ÿ
æ€»è¯·æ±‚æ•°: 1.8äº¿æ¬¡
TPS: 10.2ä¸‡
å¹³å‡å“åº”æ—¶é—´: 42ms
P95å“åº”æ—¶é—´: 58ms
P99å“åº”æ—¶é—´: 75ms
é”™è¯¯ç‡: 0.02%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>èµ„æºä½¿ç”¨æƒ…å†µ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">APIæœåŠ¡CPU: 65-75%
APIæœåŠ¡å†…å­˜: 18-20G
Redis QPS: 20.5ä¸‡
Rediså†…å­˜: 45%
MySQLè¿æ¥æ•°: å¹³å‡80
ELBå¸¦å®½: 480-520M<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-2-ç¨³å®šæ€§å‹æµ‹ï¼ˆå¹¶å‘4000ï¼‰"><a href="#5-2-ç¨³å®šæ€§å‹æµ‹ï¼ˆå¹¶å‘4000ï¼‰" class="headerlink" title="5.2 ç¨³å®šæ€§å‹æµ‹ï¼ˆå¹¶å‘4000ï¼‰"></a>5.2 ç¨³å®šæ€§å‹æµ‹ï¼ˆå¹¶å‘4000ï¼‰</h3><p><strong>å‹æµ‹æ•°æ®</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">æµ‹è¯•æ—¶é•¿: 2å°æ—¶
æ€»è¯·æ±‚æ•°: 28.8äº¿æ¬¡
TPS: 8ä¸‡
å¹³å‡å“åº”æ—¶é—´: 38ms
P95å“åº”æ—¶é—´: 52ms
é”™è¯¯ç‡: 0.01%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ç¨³å®šæ€§æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>æ— å†…å­˜æ³„æ¼</li>
<li>GCç¨³å®š</li>
<li>æ— è¿æ¥æ± è€—å°½</li>
<li>å“åº”æ—¶é—´æ³¢åŠ¨&lt;5ms</li>
</ul>
<h2 id="å…­ã€æ€§èƒ½è°ƒä¼˜æ€»ç»“"><a href="#å…­ã€æ€§èƒ½è°ƒä¼˜æ€»ç»“" class="headerlink" title="å…­ã€æ€§èƒ½è°ƒä¼˜æ€»ç»“"></a>å…­ã€æ€§èƒ½è°ƒä¼˜æ€»ç»“</h2><h3 id="6-1-ä¼˜åŒ–æ•ˆæœå¯¹æ¯”"><a href="#6-1-ä¼˜åŒ–æ•ˆæœå¯¹æ¯”" class="headerlink" title="6.1 ä¼˜åŒ–æ•ˆæœå¯¹æ¯”"></a>6.1 ä¼˜åŒ–æ•ˆæœå¯¹æ¯”</h3><table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>ä¼˜åŒ–å‰</th>
<th>ä¼˜åŒ–å</th>
<th>æå‡</th>
</tr>
</thead>
<tbody><tr>
<td>TPS</td>
<td>8.2ä¸‡</td>
<td>10.2ä¸‡</td>
<td>+24%</td>
</tr>
<tr>
<td>å¹³å‡å“åº”æ—¶é—´</td>
<td>58ms</td>
<td>42ms</td>
<td>-27%</td>
</tr>
<tr>
<td>P95å“åº”æ—¶é—´</td>
<td>120ms</td>
<td>58ms</td>
<td>-52%</td>
</tr>
<tr>
<td>é”™è¯¯ç‡</td>
<td>2.3%</td>
<td>0.02%</td>
<td>-99%</td>
</tr>
<tr>
<td>GCé¢‘ç‡</td>
<td>2-3æ¬¡&#x2F;ç§’</td>
<td>0.5æ¬¡&#x2F;ç§’</td>
<td>-75%</td>
</tr>
</tbody></table>
<h3 id="6-2-å…³é”®ä¼˜åŒ–ç‚¹"><a href="#6-2-å…³é”®ä¼˜åŒ–ç‚¹" class="headerlink" title="6.2 å…³é”®ä¼˜åŒ–ç‚¹"></a>6.2 å…³é”®ä¼˜åŒ–ç‚¹</h3><p><strong>æ¶æ„å±‚é¢</strong>ï¼š</p>
<ol>
<li>Rediså•å®ä¾‹â†’é›†ç¾¤ï¼Œè§£å†³è¯»å†™ç“¶é¢ˆ</li>
<li>ELBå¸¦å®½æ‰©å®¹ï¼Œæ¶ˆé™¤ç½‘ç»œé™åˆ¶</li>
<li>é›†ç¾¤èŠ‚ç‚¹æ•°é‡åˆç†é…ç½®</li>
</ol>
<p><strong>åº”ç”¨å±‚é¢</strong>ï¼š</p>
<ol>
<li>JVMå‚æ•°ç²¾ç»†åŒ–è°ƒä¼˜</li>
<li>è¿æ¥æ± åˆç†é…ç½®</li>
<li>ç¼“å­˜é¢„çƒ­å‡å°‘å†·å¯åŠ¨å½±å“</li>
<li>å¼‚æ­¥åŒ–éæ ¸å¿ƒé€»è¾‘</li>
</ol>
<p><strong>ç›‘æ§å±‚é¢</strong>ï¼š</p>
<ol>
<li>å…¨é“¾è·¯ç›‘æ§è¦†ç›–</li>
<li>å…³é”®æŒ‡æ ‡å®æ—¶å‘Šè­¦</li>
<li>å‹æµ‹æ•°æ®æŒç»­æ”¶é›†</li>
</ol>
<h3 id="6-3-å‹æµ‹ç»éªŒ"><a href="#6-3-å‹æµ‹ç»éªŒ" class="headerlink" title="6.3 å‹æµ‹ç»éªŒ"></a>6.3 å‹æµ‹ç»éªŒ</h3><p><strong>1. æ¸è¿›å¼å‹æµ‹</strong></p>
<ul>
<li>ä»ä½å¹¶å‘å¼€å§‹é€æ­¥æå‡</li>
<li>æ¯ä¸ªé˜¶æ®µå……åˆ†éªŒè¯</li>
<li>åŠæ—¶å‘ç°æ€§èƒ½ç“¶é¢ˆ</li>
</ul>
<p><strong>2. å…¨é¢ç›‘æ§</strong></p>
<ul>
<li>åº”ç”¨ã€ç³»ç»Ÿã€ä¸­é—´ä»¶æŒ‡æ ‡é½å…¨</li>
<li>å®æ—¶ç›‘æ§å‹æµ‹è¿‡ç¨‹</li>
<li>ä¿ç•™å‹æµ‹æ•°æ®ç”¨äºåˆ†æ</li>
</ul>
<p><strong>3. é—®é¢˜å®šä½</strong></p>
<ul>
<li>ç»“åˆæ—¥å¿—ã€ç›‘æ§å®šä½é—®é¢˜</li>
<li>ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·ï¼ˆJProfilerç­‰ï¼‰</li>
<li>å¿…è¦æ—¶è¿›è¡Œçº¿ç¨‹dumpåˆ†æ</li>
</ul>
<p><strong>4. æŒç»­ä¼˜åŒ–</strong></p>
<ul>
<li>å‹æµ‹â†’ä¼˜åŒ–â†’å†å‹æµ‹</li>
<li>å»ºç«‹æ€§èƒ½åŸºçº¿</li>
<li>å®šæœŸå›å½’æµ‹è¯•</li>
</ul>
<h2 id="ä¸ƒã€ç”Ÿäº§ç¯å¢ƒè¡¨ç°"><a href="#ä¸ƒã€ç”Ÿäº§ç¯å¢ƒè¡¨ç°" class="headerlink" title="ä¸ƒã€ç”Ÿäº§ç¯å¢ƒè¡¨ç°"></a>ä¸ƒã€ç”Ÿäº§ç¯å¢ƒè¡¨ç°</h2><h3 id="7-1-çœŸå®æµé‡éªŒè¯"><a href="#7-1-çœŸå®æµé‡éªŒè¯" class="headerlink" title="7.1 çœŸå®æµé‡éªŒè¯"></a>7.1 çœŸå®æµé‡éªŒè¯</h3><p><strong>æ—¥å¸¸è¿è¡Œæ•°æ®</strong>ï¼ˆä¸Šçº¿åä¸€ä¸ªæœˆï¼‰ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">æ—¥å‡è¯·æ±‚é‡: 28äº¿æ¬¡
å³°å€¼TPS: 9.8ä¸‡
å¹³å‡å“åº”æ—¶é—´: 35ms
P99å“åº”æ—¶é—´: 68ms
å¯ç”¨æ€§: 99.99%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="7-2-å¤§ä¿ƒæœŸé—´è¡¨ç°"><a href="#7-2-å¤§ä¿ƒæœŸé—´è¡¨ç°" class="headerlink" title="7.2 å¤§ä¿ƒæœŸé—´è¡¨ç°"></a>7.2 å¤§ä¿ƒæœŸé—´è¡¨ç°</h3><p><strong>618æ´»åŠ¨æœŸé—´</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">å³°å€¼TPS: 10.5ä¸‡
æŒç»­æ—¶é•¿: 4å°æ—¶
å¹³å‡å“åº”æ—¶é—´: 43ms
é”™è¯¯ç‡: 0.01%
ç³»ç»Ÿç¨³å®šè¿è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å…«ã€æœ€ä½³å®è·µå»ºè®®"><a href="#å…«ã€æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="å…«ã€æœ€ä½³å®è·µå»ºè®®"></a>å…«ã€æœ€ä½³å®è·µå»ºè®®</h2><h3 id="8-1-å®¹é‡è§„åˆ’"><a href="#8-1-å®¹é‡è§„åˆ’" class="headerlink" title="8.1 å®¹é‡è§„åˆ’"></a>8.1 å®¹é‡è§„åˆ’</h3><ul>
<li>æŒ‰å³°å€¼TPSçš„1.5-2å€è§„åˆ’å®¹é‡</li>
<li>é¢„ç•™30%æ€§èƒ½buffer</li>
<li>å…³é”®ç»„ä»¶æ”¯æŒæ°´å¹³æ‰©å±•</li>
</ul>
<h3 id="8-2-ç›‘æ§å‘Šè­¦"><a href="#8-2-ç›‘æ§å‘Šè­¦" class="headerlink" title="8.2 ç›‘æ§å‘Šè­¦"></a>8.2 ç›‘æ§å‘Šè­¦</h3><ul>
<li>TPSè¶…è¿‡8ä¸‡æ—¶å‘Šè­¦</li>
<li>å“åº”æ—¶é—´P95&gt;60mså‘Šè­¦</li>
<li>é”™è¯¯ç‡&gt;0.1%å‘Šè­¦</li>
<li>èµ„æºä½¿ç”¨ç‡&gt;80%å‘Šè­¦</li>
</ul>
<h3 id="8-3-åº”æ€¥é¢„æ¡ˆ"><a href="#8-3-åº”æ€¥é¢„æ¡ˆ" class="headerlink" title="8.3 åº”æ€¥é¢„æ¡ˆ"></a>8.3 åº”æ€¥é¢„æ¡ˆ</h3><ul>
<li>é™æµé™çº§ç­–ç•¥</li>
<li>å¿«é€Ÿæ‰©å®¹æ–¹æ¡ˆ</li>
<li>æ•°æ®åº“è¯»å†™åˆ†ç¦»</li>
<li>æ ¸å¿ƒåŠŸèƒ½é™çº§å¼€å…³</li>
</ul>
<h3 id="8-4-æŒç»­æ”¹è¿›"><a href="#8-4-æŒç»­æ”¹è¿›" class="headerlink" title="8.4 æŒç»­æ”¹è¿›"></a>8.4 æŒç»­æ”¹è¿›</h3><ul>
<li>å®šæœŸè¿›è¡Œå‹æµ‹éªŒè¯</li>
<li>ä¼˜åŒ–é«˜é¢‘è°ƒç”¨é“¾è·¯</li>
<li>ä»£ç å±‚é¢æ€§èƒ½ä¼˜åŒ–</li>
<li>æ¶æ„æŒç»­æ¼”è¿›</li>
</ul>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é«˜å¹¶å‘</tag>
        <tag>10ä¸‡TPS</tag>
        <tag>æ€§èƒ½å‹æµ‹</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>10ä¸‡TPSçº§é«˜å¹¶å‘ç³»ç»Ÿâ€”â€”10ä¸‡é‡çº§æ–‡æœ¬å…³é”®å­—åŒ¹é…è¿‡æ»¤</title>
    <url>/2024/06/22/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-10-wan-liang-ji-wen-ben-guan-jian-zi-pi-pei-guo-lu/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p><a href="https://www.mpoom.cn/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/">æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°</a>ä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„èƒ½åŠ›å°±æ˜¯æ–‡æœ¬å…³é”®å­—æ£€æµ‹ï¼Œæ¯”å¦‚æ£€æµ‹ä¸€æ®µè¯ä¸­æ˜¯å¦å«æœ‰<code>æ³•è½®åŠŸ</code>ç­‰æ•æ„Ÿå­—æ®µï¼Œè¿™å°±æ¶‰åŠåˆ°å…³é”®å­—åŒ¹é…ç®—æ³•ã€‚åœ¨è¯¥é¡¹ç›®ä¸­æ¯æ¡æ¶ˆæ¯éƒ½è¦ç»è¿‡å…³é”®è¯è¿‡æ»¤ï¼Œé€šè¿‡åæ‰èƒ½ä¸‹å‘ã€‚å…³é”®å­—åŒ¹é…æœ‰ä¸¤ç§å½¢å¼ï¼Œåˆ†ä¸º<code>å•ä¸€å…³é”®å­—</code>å’Œ<code>é€»è¾‘å…³é”®å­—</code>ã€‚</p>
<h2 id="1-1-å•ä¸€å…³é”®å­—"><a href="#1-1-å•ä¸€å…³é”®å­—" class="headerlink" title="1.1 å•ä¸€å…³é”®å­—"></a>1.1 å•ä¸€å…³é”®å­—</h2><p>å•ä¸€å…³é”®å­—æŒ‡å•ä¸ªå•è¯ï¼Œå¦‚ï¼š<code>æ³•è½®åŠŸ</code>ï¼Œ<code>ç‚¸é‡‘èŠ±</code>ï¼Œ<code>ä¸€æ¡é¾™æœåŠ¡</code>ç­‰æ¶‰æã€æ¶‰èµŒã€æ¶‰é»„ç­‰å…³é”®å­—ï¼Œå•ä¸ªçš„å…³é”®å­—åœ¨ç³»ç»Ÿæ•°æ®åº“ä¸­çš„æ•°é‡åœ¨9ä¸‡+ï¼Œæ¶ˆæ¯ä¸‹å‘æ—¶éœ€è¦æ£€æµ‹æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«æ•°æ®åº“ä¸­å•ä¸ªå…³é”®å­—ã€‚</p>
<h2 id="1-2-é€»è¾‘å…³é”®å­—"><a href="#1-2-é€»è¾‘å…³é”®å­—" class="headerlink" title="1.2 é€»è¾‘å…³é”®å­—"></a>1.2 é€»è¾‘å…³é”®å­—</h2><p>é€»è¾‘å…³é”®å­—ç”±å¤šä¸ªå•ä¸€å…³é”®å­—ç»„åˆ<code>&amp;&amp;</code>ã€<code>||</code>ã€<code>!</code>é€»è¾‘è¿ç®—ç¬¦ï¼Œå³åŒ¹é…åˆ°çš„å…³é”®å­—æ»¡è¶³é€»è¾‘å…³é”®å­—ä¸­çš„é€»è¾‘è¿ç®—é€»è¾‘æ‰è¿›è¡Œç®¡æ§ã€‚<br><img src="/2024/06/22/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-10-wan-liang-ji-wen-ben-guan-jian-zi-pi-pei-guo-lu/%E9%80%BB%E8%BE%91%E5%85%B3%E9%94%AE%E5%AD%97.png" alt="é€»è¾‘å…³é”®å­—"></p>
<div class="note success no-icon flat"><p>ä¾‹å¦‚ï¼šé€»è¾‘å…³é”®å­—<code>ç‚¹å‡»&amp;&amp;ç™»å½•&amp;&amp;!éªŒè¯ç </code>, è¡¨ç¤ºå†…å®¹åŒ…å«<code>ç‚¹å‡»</code>ã€<code>ç™»å½•</code>å…³é”®å­—å¹¶ä¸”ä¸åŒ…å«<code>éªŒè¯ç </code>å…³é”®å­—ï¼Œå¦‚æœæ–‡æœ¬ä¸­åŒ…å«çš„å†…å®¹ç¬¦åˆè¯¥é€»è¾‘ï¼Œåˆ™è¿›è¡Œæ‹¦æˆªç®¡æ§ã€‚</p>
</div>

<h1 id="äºŒã€æ€§èƒ½è¦æ±‚"><a href="#äºŒã€æ€§èƒ½è¦æ±‚" class="headerlink" title="äºŒã€æ€§èƒ½è¦æ±‚"></a>äºŒã€æ€§èƒ½è¦æ±‚</h1><p>æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°å…³é”®å­—æ•´ä½“æ•°æ®è§„æ¨¡ä¸º10ä¸‡é‡çº§ï¼Œå…¶ä¸­å•ä¸€å…³é”®å­—æ•°é‡ä¸º9ä¸‡ï¼Œé€»è¾‘å…³é”®å­—æ•°é‡ä¸º1ä¸‡ã€‚æ¶ˆæ¯ç®¡æ§å¹³å°çš„å®‰å…¨å®¡æ ¸æ¥å£æ•´ä½“çš„å¹³å‡å“åº”æ—¶é—´ä¸º<code>50ms</code>ã€‚</p>
<h1 id="ä¸‰ã€æ–¹æ¡ˆé¢„ç ”"><a href="#ä¸‰ã€æ–¹æ¡ˆé¢„ç ”" class="headerlink" title="ä¸‰ã€æ–¹æ¡ˆé¢„ç ”"></a>ä¸‰ã€æ–¹æ¡ˆé¢„ç ”</h1><p>æˆ‘ä»¬å…ˆåˆ†ææ¢³ç†å¸¸ç”¨çš„å…³é”®è¯åŒ¹é…ç®—æ³•ï¼Œå†æ ¹æ®ä¸Šè¿°ä¸šåŠ¡éœ€æ±‚åŠå¹³å°æ€§èƒ½è¦æ±‚ï¼Œè¿›è¡Œæ–¹æ¡ˆè®¾è®¡åŠè½åœ°å®ç°ã€‚å¸¸ç”¨çš„å…³é”®è¯åŒ¹é…ç®—æ³•æœ‰ï¼šæš´åŠ›åŒ¹é…ç®—æ³•ã€KMPç®—æ³•ã€Boyer-Mooreç®—æ³•ã€åŒæ•°ç»„Trieã€ACè‡ªåŠ¨æœºã€åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœºç­‰ã€‚ä¸‹é¢æˆ‘ä»¬ç»“åˆå„ä¸ªç®—æ³•çš„ä¼˜ç¼ºç‚¹ã€æ€§èƒ½ã€åŠé€‚ç”¨åœºæ™¯è¿›è¡Œé€‰æ‹©åˆ†æã€‚</p>
<h2 id="3-1-ç®—æ³•å¯¹æ¯”åˆ†æ"><a href="#3-1-ç®—æ³•å¯¹æ¯”åˆ†æ" class="headerlink" title="3.1 ç®—æ³•å¯¹æ¯”åˆ†æ"></a>3.1 ç®—æ³•å¯¹æ¯”åˆ†æ</h2><p>å„ä¸ªç®—æ³•åŸç†ç›¸è§:<a href>å¸¸è§çš„å…³é”®å­—åŒ¹é…ç®—æ³•</a></p>
<table>
<thead>
<tr>
<th>ç®—æ³•åç§°</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>æ€§èƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>æš´åŠ›åŒ¹é…ç®—æ³•ï¼ˆBrute Forceï¼‰</td>
<td>å°è§„æ¨¡æ•°æ®æˆ–è€…æ¨¡å¼ä¸²è¾ƒçŸ­çš„ç®€å•åŒ¹é…åœºæ™¯</td>
<td>åœ¨è§„æ¨¡è¾ƒå°çš„æƒ…å†µä¸‹èƒ½å¤Ÿå·¥ä½œï¼Œä½†éšç€æ•°æ®è§„æ¨¡å¢å¤§ï¼Œæ€§èƒ½è¿…é€Ÿä¸‹é™ã€‚</td>
</tr>
<tr>
<td>KMPç®—æ³•ï¼ˆKnuth-Morris-Prattç®—æ³•ï¼‰</td>
<td>éœ€è¦å¤„ç†é•¿æ¨¡å¼ä¸²æˆ–è€…å¤§é‡æ•°æ®çš„å­—ç¬¦ä¸²åŒ¹é…ä»»åŠ¡</td>
<td>å¯¹äºå¤§è§„æ¨¡æ•°æ®å’Œé•¿æ¨¡å¼ä¸²æœ‰è¾ƒå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œå¸¸ç”¨äºå®é™…åº”ç”¨ä¸­ã€‚</td>
</tr>
<tr>
<td>Boyer-Mooreç®—æ³•</td>
<td>å¤„ç†é•¿æ¨¡å¼ä¸²å’Œå¤§è§„æ¨¡æ•°æ®ï¼Œå°¤å…¶é€‚ç”¨äºå¤šæ¬¡åŒ¹é…çš„æƒ…å†µ</td>
<td>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸èƒ½æä¾›è¾ƒå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å¼ä¸²ç›¸å¯¹è¾ƒé•¿æ—¶</td>
</tr>
<tr>
<td>Trieæ ‘</td>
<td>éœ€è¦å¿«é€Ÿå­˜å‚¨å’Œæ£€ç´¢å­—ç¬¦ä¸²é›†åˆçš„åº”ç”¨ï¼Œå¦‚å­—å…¸ã€è‡ªåŠ¨å®Œæˆã€æ‹¼å†™æ£€æŸ¥ç­‰ã€‚</td>
<td>åœ¨å¤„ç†å­—ç¬¦ä¸²é›†åˆå’Œå‰ç¼€åŒ¹é…ä»»åŠ¡æ—¶ï¼Œèƒ½å¤Ÿæä¾›ç¨³å®šå’Œé«˜æ•ˆçš„æ€§èƒ½è¡¨ç°ã€‚</td>
</tr>
<tr>
<td>åŒæ•°ç»„Trieï¼ˆDouble-Array Trieï¼ŒDATï¼‰</td>
<td>éœ€è¦é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥è¯¢å¤§è§„æ¨¡å­—ç¬¦ä¸²é›†åˆçš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯éœ€è¦é¢‘ç¹è¿›è¡Œå‰ç¼€åŒ¹é…æˆ–è€…å®Œå…¨åŒ¹é…çš„åº”ç”¨ã€‚</td>
<td>åœ¨å¤§è§„æ¨¡æ•°æ®å’Œé•¿å­—ç¬¦ä¸²çš„å­˜å‚¨å’ŒæŸ¥è¯¢ä¸­ï¼ŒåŒæ•°ç»„Trieèƒ½å¤Ÿæ˜¾è‘—æå‡æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å­˜ä½¿ç”¨å’ŒæŸ¥è¯¢é€Ÿåº¦ä¸Šã€‚</td>
</tr>
<tr>
<td>ACè‡ªåŠ¨æœºï¼ˆAho-Corasickè‡ªåŠ¨æœº</td>
<td>éœ€è¦åœ¨å¤§è§„æ¨¡æ–‡æœ¬ä¸­åŒæ—¶åŒ¹é…å¤šä¸ªæ¨¡å¼ä¸²çš„é«˜æ•ˆæœç´¢åº”ç”¨åœºæ™¯ï¼Œå¦‚å…³é”®å­—è¿‡æ»¤ã€æ–‡æœ¬æœç´¢å¼•æ“ã€ç½‘ç»œå®‰å…¨ç­‰é¢†åŸŸã€‚</td>
<td>åœ¨å¤„ç†å¤šæ¨¡å¼åŒ¹é…é—®é¢˜æ—¶ï¼ŒACè‡ªåŠ¨æœºé€šå¸¸èƒ½å¤Ÿæä¾›ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å¼ä¸²æ•°é‡è¾ƒå¤šæˆ–æ–‡æœ¬è§„æ¨¡è¾ƒå¤§æ—¶ã€‚</td>
</tr>
<tr>
<td>åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº</td>
<td>éœ€è¦åœ¨å¤§è§„æ¨¡æ–‡æœ¬ä¸­åŒæ—¶åŒ¹é…å¤šä¸ªæ¨¡å¼ä¸²çš„é«˜æ•ˆæœç´¢åº”ç”¨åœºæ™¯ã€‚</td>
<td>åœ¨å¤„ç†å¤šæ¨¡å¼åŒ¹é…é—®é¢˜æ—¶ï¼ŒåŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœºé€šå¸¸èƒ½å¤Ÿæä¾›ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å¼ä¸²è¾ƒå¤šæˆ–æ–‡æœ¬è¾ƒå¤§æ—¶ã€‚</td>
</tr>
</tbody></table>
<p>æ ¹æ®ç®¡æ§å¹³å°å…³é”®å­—ç®¡æ§çš„ä¸šåŠ¡è¦æ±‚ï¼Œå…³é”®å­—åŒ¹é…ç®—æ³•éœ€è¦æ”¯æŒä¸¤å¤§ç‰¹ç‚¹ï¼šå¤§è§„æ¨¡æ•°æ®ã€å¤šæ¨¡å¼ä¸²åŒ¹é…ï¼Œæ‰èƒ½åœ¨å•ä¸€å…³é”®å­—å’Œé€»è¾‘å…³é”®å­—åŒ¹é…ä¸Šæœ‰è¾ƒå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œæ ¹æ®ä¸Šè¿°ç®—æ³•çš„ç‰¹ç‚¹åŠæ€§èƒ½ï¼ŒåŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœºç®—æ³•ç¬¦åˆæˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<h2 id="3-2-åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº"><a href="#3-2-åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº" class="headerlink" title="3.2 åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº"></a>3.2 åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº</h2><div class="note success no-icon flat"><p>é¢„å¤‡çŸ¥è¯†çš„å›¾è§£è¯·å‚è€ƒï¼šã€Š<a href="https://www.hankcs.com/program/algorithm/implementation-and-analysis-of-aho-corasick-algorithm-in-java.html">Aho-Corasickç®—æ³•çš„Javaå®ç°ä¸åˆ†æ</a>ã€‹ã€Š<a href="https://www.hankcs.com/program/java/triedoublearraytriejava.html">åŒæ•°ç»„Trieæ ‘(DoubleArrayTrie)Javaå®ç°</a>ã€‹ã€‚</p>
<p>åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœºçš„å®ç°å‚è€ƒï¼šã€Š<a href="https://www.hankcs.com/program/algorithm/aho-corasick-double-array-trie.html">Aho Corasickè‡ªåŠ¨æœºç»“åˆDoubleArrayTrieæé€Ÿå¤šæ¨¡å¼åŒ¹é…</a>ã€‹</p>
</div>

<h1 id="å››ã€æ–¹æ¡ˆè®¾è®¡"><a href="#å››ã€æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="å››ã€æ–¹æ¡ˆè®¾è®¡"></a>å››ã€æ–¹æ¡ˆè®¾è®¡</h1><p>æ ¹æ®ä¸šåŠ¡è¦æ±‚æˆ‘ä»¬éœ€è¦å®ç°æ¶ˆæ¯å†…å®¹çš„<code>å•ä¸€å…³é”®å­—</code>å’Œ<code>é€»è¾‘å…³é”®å­—</code>çš„åŒ¹é…ï¼Œä¸‹é¢ä¸ºå…³é”®å­—åŒ¹é…ç®—æ³•ä»£ç å®ç°åŠä½¿ç”¨ç¤ºä¾‹ã€‚</p>
<h2 id="4-1-å•ä¸€å…³é”®å­—åŒ¹é…"><a href="#4-1-å•ä¸€å…³é”®å­—åŒ¹é…" class="headerlink" title="4.1 å•ä¸€å…³é”®å­—åŒ¹é…"></a>4.1 å•ä¸€å…³é”®å­—åŒ¹é…</h2><p>å•ä¸€å…³é”®å­—åŒ¹é…å¯ä»¥ç›´æ¥ä½¿ç”¨AhoCorasickDoubleArrayTrieå®ç°ï¼Œç®—æ³•å¦‚ä¸‹ï¼š</p>
<h3 id="4-1-1-å¼•å…¥Mavenä¾èµ–"><a href="#4-1-1-å¼•å…¥Mavenä¾èµ–" class="headerlink" title="4.1.1 å¼•å…¥Mavenä¾èµ–"></a>4.1.1 å¼•å…¥Mavenä¾èµ–</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.hankcs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aho-corasick-double-array-trie<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-1-2-å°è£…AhoCorasickDoubleArrayTrie"><a href="#4-1-2-å°è£…AhoCorasickDoubleArrayTrie" class="headerlink" title="4.1.2 å°è£…AhoCorasickDoubleArrayTrie"></a>4.1.2 å°è£…AhoCorasickDoubleArrayTrie</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * AhoCorasickDoubleArrayTrie ç®—æ³•åŒ…è£…ç±»
 */</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">AhoCorasickEntry</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">AhoCorasickDoubleArrayTrie</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> trie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AhoCorasickDoubleArrayTrie</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addKeyword</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyword<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>keyword<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        trie<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AhoCorasickDoubleArrayTrie<span class="token punctuation">.</span>Hit</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">parseText</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> trie<span class="token punctuation">.</span><span class="token function">parseText</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-1-3-åˆå§‹åŒ–åŠä½¿ç”¨AhoCorasickDoubleArrayTrie"><a href="#4-1-3-åˆå§‹åŒ–åŠä½¿ç”¨AhoCorasickDoubleArrayTrie" class="headerlink" title="4.1.3 åˆå§‹åŒ–åŠä½¿ç”¨AhoCorasickDoubleArrayTrie"></a>4.1.3 åˆå§‹åŒ–åŠä½¿ç”¨AhoCorasickDoubleArrayTrie</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäºAhoCorasickDoubleArrayTrieçš„åˆå§‹åŒ–åŠä½¿ç”¨æ¡ˆä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KeywordHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">AhoCorasickEntry</span> ahoCorasickEntry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AhoCorasickEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * åˆå§‹åŒ–AhoCorasickDoubleArrayTrie
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initAhoCorasickEntry</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keywordList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        keywordList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>keyword <span class="token operator">-></span> ahoCorasickEntry<span class="token punctuation">.</span><span class="token function">addKeyword</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ahoCorasickEntry<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * è·å–æ¶ˆæ¯å†…å®¹ä¸­åŒ¹é…åˆ°çš„å…³é”®å­—é›†åˆ
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getMatchedKeywordSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> msgContent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AhoCorasickDoubleArrayTrie<span class="token punctuation">.</span>Hit</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> wordList <span class="token operator">=</span> ahoCorasickEntry<span class="token punctuation">.</span><span class="token function">parseText</span><span class="token punctuation">(</span>msgContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>wordList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> wordList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>hit <span class="token operator">-></span> hit<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-é€»è¾‘å…³é”®å­—åŒ¹é…"><a href="#4-2-é€»è¾‘å…³é”®å­—åŒ¹é…" class="headerlink" title="4.2 é€»è¾‘å…³é”®å­—åŒ¹é…"></a>4.2 é€»è¾‘å…³é”®å­—åŒ¹é…</h2><p>é€»è¾‘å…³é”®å­—çš„åŒ¹é…åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€æ­¥åŒ¹é…é€»è¾‘å…³é”®å­—ä¸­æ¯ä¸ªå•ä¸€å…³é”®å­—ï¼Œç¬¬äºŒéƒ¨æ ¹æ®ç¬¬ä¸€æ­¥åŒ¹é…åˆ°ç»“æœå†è¿›è¡Œé€»è¾‘è¿ç®—ã€‚å…³é”®å­—çš„é€»è¾‘è¿ç®—æˆ‘ä»¬ä½¿ç”¨å¼€æºçš„é«˜æ€§èƒ½è¡¨è¾¾å¼å¼•æ“AviatorScriptã€‚</p>
<h3 id="4-2-1-AviatorScriptç®€ä»‹"><a href="#4-2-1-AviatorScriptç®€ä»‹" class="headerlink" title="4.2.1 AviatorScriptç®€ä»‹"></a>4.2.1 AviatorScriptç®€ä»‹</h3><p><a href="https://github.com/killme2008/aviatorscript">AviatorScript</a> æ˜¯ä¸€é—¨é«˜æ€§èƒ½ã€è½»é‡çº§å¯„å®¿äº JVM ï¼ˆåŒ…æ‹¬ Android å¹³å°ï¼‰ä¹‹ä¸Šçš„è„šæœ¬è¯­è¨€ã€‚</p>
<div class="note success no-icon flat"><p>Aviator çš„åŸºæœ¬è¿‡ç¨‹æ˜¯å°†è¡¨è¾¾å¼ç›´æ¥ç¿»è¯‘æˆå¯¹åº”çš„ java å­—èŠ‚ç æ‰§è¡Œï¼Œç‰¹ç‚¹ï¼š</p>
<ul>
<li>é«˜æ€§èƒ½</li>
<li>è½»é‡çº§</li>
<li>ä¸€äº›æ¯”è¾ƒæœ‰ç‰¹è‰²çš„ç‰¹ç‚¹ï¼š<ul>
<li>æ”¯æŒè¿ç®—ç¬¦é‡è½½</li>
<li>åŸç”Ÿæ”¯æŒå¤§æ•´æ•°å’Œ BigDecimal ç±»å‹åŠè¿ç®—ï¼Œå¹¶ä¸”é€šè¿‡è¿ç®—ç¬¦é‡è½½å’Œä¸€èˆ¬æ•°å­—ç±»å‹ä¿æŒä¸€è‡´çš„è¿ç®—æ–¹å¼ã€‚</li>
<li>åŸç”Ÿæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ç±»å‹åŠåŒ¹é…è¿ç®—ç¬¦ &#x3D;~ </li>
<li>ç±» clojure çš„ seq åº“åŠ lambda æ”¯æŒï¼Œå¯ä»¥çµæ´»åœ°å¤„ç†å„ç§é›†åˆ</li>
</ul>
</li>
<li>å¼€æ”¾èƒ½åŠ›ï¼šåŒ…æ‹¬è‡ªå®šä¹‰å‡½æ•°æ¥å…¥ä»¥åŠå„ç§å®šåˆ¶é€‰é¡¹</li>
</ul>
</div>

<h3 id="4-2-2-å¼•å…¥AviatorScriptä¾èµ–"><a href="#4-2-2-å¼•å…¥AviatorScriptä¾èµ–" class="headerlink" title="4.2.2 å¼•å…¥AviatorScriptä¾èµ–"></a>4.2.2 å¼•å…¥AviatorScriptä¾èµ–</h3><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.googlecode.aviator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aviator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>&#123;version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-3-é€»è¾‘å…³é”®å­—åŒ¹é…å®ç°"><a href="#4-2-3-é€»è¾‘å…³é”®å­—åŒ¹é…å®ç°" class="headerlink" title="4.2.3 é€»è¾‘å…³é”®å­—åŒ¹é…å®ç°"></a>4.2.3 é€»è¾‘å…³é”®å­—åŒ¹é…å®ç°</h3><p>å‰é¢è®²åˆ°é€»è¾‘å…³é”®å­—çš„åŒ¹é…åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥å…ˆæ˜¯æ ¹æ®é€»è¾‘è¿ç®—ç¬¦å°†é€»è¾‘å…³é”®å­—æ‹†åˆ†ä¸ºå•ä¸€å…³é”®å­—ï¼Œå°†æ‰€æœ‰çš„æ‹†åˆ†åçš„é€»è¾‘å…³é”®å­—æ„å»ºä¸€ä¸ªAhoCorasickDoubleArrayTrieè¿›è¡Œå…³é”®å­—åŒ¹é…ã€‚</p>
<div class="note success no-icon flat"><p>åŸºäºAhoCorasickDoubleArrayTrieå…³é”®åŒ¹é…ä»£ç å®ç°å‚è§ä¸Šé¢<code>å•ä¸€å…³é”®å­—åŒ¹é…</code>ï¼ŒåŒ¹é…æˆåŠŸåä¼šè¿”å›åŒ¹é…åˆ°çš„å…³é”®å­—é›†åˆ<code>matchedKeywordSet</code>ï¼Œç„¶åè¿›è¡Œé€»è¾‘å…³é”®å­—çš„é€»è¾‘è¿ç®—ã€‚</p>
</div>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ComplexKeyword</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * é€»è¾‘å…³é”®å­—
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> expression<span class="token punctuation">;</span>

    <span class="token comment">/**
     * ç¼–è¯‘åçš„é€»è¾‘å…³é”®å­—
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Expression</span> compiledExpression<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keywordList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ComplexKeyword</span><span class="token punctuation">(</span><span class="token class-name">String</span> expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expression <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>compiledExpression <span class="token operator">=</span> <span class="token class-name">AviatorEvaluator</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é€»è¾‘å…³é”®å­—è¡¨è¾¾å¼æ‹†è¯</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keywords <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expression<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"[| &amp; ( ) !]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keywordList <span class="token operator">=</span> <span class="token function">filterBlankAndSort</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">filterBlankAndSort</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keywords<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keywordSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>keywords<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keywordSet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keyList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>keywordSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyList<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>keyword1<span class="token punctuation">,</span> keyword2<span class="token punctuation">)</span> <span class="token operator">-></span> keyword2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> keyword1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyList<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * è·å–é€»è¾‘å…³é”®å­—è¿ç®—å‚æ•°Map
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getEnvMap</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> keywordList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>
                        keyword <span class="token operator">-></span> keyword<span class="token punctuation">,</span>
                        matchedKeywordSet<span class="token operator">::</span><span class="token function">contains</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">-></span> right
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getTargetExpression</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> env <span class="token operator">=</span> keywordList<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>
                        keyword <span class="token operator">-></span> keyword<span class="token punctuation">,</span>
                        keyword <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>matchedKeywordSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>keyword<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">-></span> right
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ’åºåçš„keywordListï¼Œç›®çš„æ˜¯åœ¨æ›¿æ¢æ—¶å…ˆæ›¿æ¢é•¿åº¦è¾ƒå¤§çš„å…³é”®å­—ï¼Œé¿å…ç›¸åŒå‰ç¼€çš„çŸ­å…³é”®å­—è¢«å…ˆæ›¿æ¢</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keywordList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            expression <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> env<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> expression<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * æ‰§è¡Œé€»è¾‘å…³é”®å­—è¡¨è¾¾å¼è¿ç®—
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ä¼˜å…ˆä½¿ç”¨é¢„ç¼–è¯‘çš„è¡¨è¾¾å¼ä¼ å…¥å‚æ•°è¿›è¡Œé€»è¾‘è¿ç®—ï¼ˆæ€§èƒ½é«˜ï¼‰</span>
            <span class="token keyword">return</span> compiledExpression<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token function">getEnvMap</span><span class="token punctuation">(</span>matchedKeywordSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// è¡¨è¾¾å¼æ‰§è¡Œå¤±è´¥ï¼Œåˆ™æ ¹æ®å…³é”®å­—åŒ¹é…ç»“æœè·å–åŒ¹é…ç»“æœçš„è¡¨è¾¾å¼ï¼ˆæ€§èƒ½ä½äºé¢„ç¼–è¯‘ï¼‰</span>
            <span class="token keyword">return</span> <span class="token class-name">AviatorEvaluator</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token function">getTargetExpression</span><span class="token punctuation">(</span>matchedKeywordSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> expression<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸‹é¢ä¸ºéå†é€»è¾‘å…³é”®å­—åˆ—è¡¨ï¼Œæ£€æµ‹æ˜¯å¦æœ‰åŒ¹é…çš„é€»è¾‘å…³é”®å­—ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">matchComplexKeyword</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComplexKeyword</span><span class="token punctuation">></span></span> complexKeywords<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>complexKeywords<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    complexKeywords<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>complexKeyword <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>complexKeyword<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>matchedKeywordSet<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> complexKeyword<span class="token punctuation">.</span><span class="token function">getExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-æ€§èƒ½éªŒè¯"><a href="#4-3-æ€§èƒ½éªŒè¯" class="headerlink" title="4.3 æ€§èƒ½éªŒè¯"></a>4.3 æ€§èƒ½éªŒè¯</h2><p>ä¸‹é¢ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯çš„æ•°æ®é‡æµ‹è¯•å•ä¸€å…³é”®å­—å’Œé€»è¾‘å…³é”®å­—åŒ¹é…ä¸­ä¸¤ä¸ªæ ¸å¿ƒå¤„ç†æ­¥éª¤<code>AhoCorasickDoubleArrayTrie</code>å’Œ<code>AviatorScript</code>çš„æ€§èƒ½è¡¨ç°ã€‚</p>
<h3 id="4-3-1-AhoCorasickDoubleArrayTrieæ€§èƒ½æµ‹è¯•"><a href="#4-3-1-AhoCorasickDoubleArrayTrieæ€§èƒ½æµ‹è¯•" class="headerlink" title="4.3.1 AhoCorasickDoubleArrayTrieæ€§èƒ½æµ‹è¯•"></a>4.3.1 AhoCorasickDoubleArrayTrieæ€§èƒ½æµ‹è¯•</h3><div class="note success no-icon flat"><p>ä½¿ç”¨AhoCorasickDoubleArrayTrieé¡¹ç›®æºç ä¸­çš„<a href="https://github.com/hankcs/AhoCorasickDoubleArrayTrie/blob/master/src/test/resources/cn/dictionary.txt">dictionary.txt</a>æ–‡ä»¶ä½œä¸ºå…³é”®å­—åº“ï¼Œè¯¥æ–‡ä»¶å†…å®¹ä¸ºå•è¯ï¼Œæ€»è¡Œæ•°æœ‰15ä¸‡+ã€‚</p>
</div>

<p>é€‰å–10ä¸ªæ¶ˆæ¯æ¨¡æ¿è¿›è¡Œæµ‹è¯•,æ¶ˆæ¯æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ã€xxå•†åœºã€‘äº²çˆ±çš„ä¼šå‘˜ï¼Œä½ å¥½ï¼åœ‹åº†èŠ‚é©¬ä¸Šåˆ°æ¥ï¼Œé’ˆå¯¹æ–°è€ç”¨æˆ·æˆ‘ä»¬ç‰¹æ¨å‡º<span class="token number">5.5</span>æŠ˜ä¼˜æƒ æ´»åŠ¨ï¼Œåªè¦åˆ°åœºå‡­ä¼šå‘˜å¡å¯é¢†å–ç²¾ç¾å°ç¤¼ç‰©ä¸€ä»¶ï¼Œæ•°é‡æœ‰é™å…ˆåˆ°å…ˆå¾—ï¼é€€è®¢å›<span class="token class-name">T</span>
ã€xxæ•™è‚²ã€‘é«˜ä¸€å‡é«˜äºŒæš‘æœŸè¡¥ä¹ ç­å¼€è¯¾äº†ï¼Œå¼€è®¾æ•°å­¦ã€ç‰©ç†ã€åŒ–å­¦ã€è‹±è¯­ç­‰å››ç§‘ã€‚å¼€è¯¾æ—¶é—´<span class="token number">7</span>æœˆ<span class="token number">15</span>æ—¥ã€‚åœ°ç‚¹ï¼šxx<span class="token punctuation">.</span>æœ‰æ„å’¨è¯¢æˆ–å›å¤çŸ­ä¿¡ï¼Œæ±ªè€å¸ˆï¼šxx é€€è®¢å›<span class="token class-name">T</span>
ä¸€ä¸ªèŠ‚æ—¥æ€å¿µæ— æ•°ï¼Œä¸€æ¡çŸ­ä¿¡ç¥ç¦ä¸‡åƒã€‚ç«¯åˆèŠ‚åˆ°äº†ï¼Œç¥ä½ èŠ‚æ—¥å®‰åº·ï¼ŒåŒæ—¶ç¥ä½ å¥å¥åº·åº·åœ°ï¼Œå¿«å®‰åº·ä¹åœ°ï¼Œå’Œå’Œç¾ç¾åœ°ï¼Œé¡ºé¡ºåˆ©åˆ©åœ°è¿‡å¥½ç”Ÿå‘½ä¸­çš„æ¯ä¸€å¤©ã€‚
xxå¤§è¯æˆ¿ã€‘ç§¯åˆ†å½“é’±èŠ±ï¼Œå¥½ç¤¼é€ä¸åœ<span class="token operator">!</span>xxè¯åº—å¹´ä¸­å¤§ä¿ƒæš¨ç§¯åˆ†å…‘æ¢å¼€å§‹å•¦<span class="token operator">!</span>ä¸°å¯Œç¤¼å“ç­‰ä½ æ¥ã€‚<span class="token number">24</span><span class="token operator">-</span><span class="token number">31</span>æ—¥è¿›åº—é”€è´¹é€xxã€xxã€xxç­‰ã€‚é’™ç‰‡ä»…<span class="token number">1</span>å…ƒ<span class="token operator">!</span>é€€è®¢å›<span class="token class-name">T</span>
ã€xxã€‘æ‚¨å¥½ï¼Œxxç»ç†æ‰“æ‰°æ‚¨ï¼é‚€çº¦æ‚¨å‚ä¸xxä¸¾åŠçš„xxå±•ä¼šï¼Œç›¸ä¿¡é€šè¿‡æ­¤æ¬¡å±•ä¼šæ‚¨èƒ½å¤Ÿæ”¶è·åˆ°æ›´å¤šçš„å•†ä¸šæœ‹å‹ï¼Œä¸ºè‡ªå·±çš„ä¼ä¸šåˆ›é€ æ›´å¤šçš„æ–°æœºé‡ï¼ xæœˆxæ—¥æ˜¯å‚å±•æ—¥ï¼Œæœ›å±Šæ—¶ä¸ä¼šå‚è§‚äº¤æµï¼ŒæœŸå¾…æ‚¨çš„å…‰ä¸´ï¼å’¨è¯¢ç”µè¯ï¼šxxï¼Œé€€è®¢å›<span class="token class-name">T</span>
ã€xxæ¸¸æ³³é¦†ã€‘ç»¿é“ï¼Œå…¨å®¶çš„é€‰æ‹©ã€‚å¸¦ä¸Šå®¶é‡Œçš„å°æœ‹å‹ä¸€èµ·ä½“éªŒä¸ä¸€æ ·çš„æ°´ä¸–ç•Œ<span class="token operator">!</span>åœ°å€ï¼šxx<span class="token punctuation">,</span>ç”µè¯xx<span class="token punctuation">.</span>é€€è®¢å›<span class="token class-name">T</span>
ã€xxé“¶è¡Œã€‘é‰´äºæ‚¨ä¿¡èª‰è‰¯å¥½ï¼Œè¯šé‚€æ‚¨åŠç†<span class="token number">2</span>ä¸‡å…ƒä¿¡ç”¨å¡ï¼Œç‚¹å‡»å³å¯åŠç†https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>xxï¼Œé€€è®¢å›<span class="token constant">TD</span>
ã€xxè£…é¥°ã€‘å°Šæ•¬çš„xxå…ˆç”Ÿæ‚¨å¥½ï¼é¦–å…ˆæ„Ÿè°¢æ‚¨ç›¸ä¿¡xxè£…é¥°ï¼å¸Œæœ›æˆ‘ä»¬çš„è®¾è®¡å¸ˆèƒ½ç»™æ‚¨å¸¦æ¥å…³äºè£…ä¿®æƒ³è¦è®¾è®¡æ–¹æ¡ˆï¼Œæœ‰å…¶ä»–å’¨è¯¢å¯éšæ—¶è”ç³»xxã€‚ç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼
ã€xxç®¡ç†å±€ã€‘ç´§æ€¥é€šçŸ¥ï¼šå› è¿‘æ—¥æœ‰å¤§åˆ°æš´é›¨ï¼Œé€ æˆé™é›¨é‡è¾ƒå¤§ï¼Œç°åœ¨åº”å› åœ°åˆ¶å®œæ’æ°´æ™¾ç”°ï¼Œå°¤å…¶æ˜¯ä½æ´¼åœ°å—æ›´åº”åŠæ—¶æ’æ°´ï¼Œé˜²æ­¢å€’çŒå‘ç”Ÿï¼Œå¸Œæœ›å¼•èµ·é‡è§†ã€‚
ã€xxå¸‚ã€‘å°Šæ•¬çš„å¸‚æ°‘æœ‹å‹ä»¬ï¼Œ<span class="token number">2020</span>å¹´æ˜¥èŠ‚å³å°†åˆ°æ¥<span class="token punctuation">,</span>è®©æˆ‘ä»¬ä¼—å¿—æˆåŸï¼Œä¸¥å®ˆç¦æ”¾æ–°è§„ç»´æŠ¤åŸå¸‚ç¯å¢ƒã€ä¸ºäº†ç¾å¥½ç”Ÿæ´»ï¼ç¥æ‚¨èŠ‚æ—¥å¿«ä¹é˜–å®¶å¹¸ç¦ä¸‡äº‹å¦‚æ„ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AhoCorasickDoubleArrayTrieTest</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">KeywordHandler</span> keywordHandler <span class="token operator">=</span> <span class="token function">getKeywordHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> contents <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllLines</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"content.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        contents<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>content <span class="token operator">-></span>  <span class="token function">matchKeyword</span><span class="token punctuation">(</span>keywordHandler<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> times <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ€»è€—æ—¶:"</span> <span class="token operator">+</span> times <span class="token operator">+</span> <span class="token string">"ï¼Œå¹³å‡è€—æ—¶ï¼š"</span> <span class="token operator">+</span> times <span class="token operator">/</span> contents<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">matchKeyword</span><span class="token punctuation">(</span><span class="token class-name">KeywordHandler</span> keywordHandler<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet <span class="token operator">=</span> keywordHandler<span class="token punctuation">.</span><span class="token function">getMatchedKeywordSet</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// matchedKeywordSet.forEach(System.out::println);</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">KeywordHandler</span> <span class="token function">getKeywordHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">KeywordHandler</span> keywordHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeywordHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ–‡ä»¶è·¯å¾„ï¼šhttps://github.com/hankcs/AhoCorasickDoubleArrayTrie/blob/master/src/test/resources/cn/dictionary.txt</span>
        keywordHandler<span class="token punctuation">.</span><span class="token function">initAhoCorasickEntry</span><span class="token punctuation">(</span><span class="token function">getKeywordListForTest</span><span class="token punctuation">(</span><span class="token string">"dictionary.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keywordHandler<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * è¯»å–æœ¬åœ°å­—å…¸æ–‡ä»¶ä½œä¸ºå…³é”®å­—ï¼Œæ–‡ä»¶æœ‰15ä¸‡è¡Œ
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getKeywordListForTest</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllLines</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">6</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">1</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
å•æ¡æ–‡æœ¬å…³é”®å­—åŒ¹é…è€—æ—¶ï¼š<span class="token number">0</span>ms
æ€»è€—æ—¶<span class="token operator">:</span><span class="token number">8</span>ï¼Œå¹³å‡è€—æ—¶ï¼š<span class="token number">0</span>ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ ¹æ®æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œåœ¨15ä¸‡çº§çš„å…³é”®å­—åŒ¹é…ä¸­ï¼Œæ¶ˆæ¯å†…å®¹å…³é”®å­—åŒ¹é…è€—æ—¶ä»…åœ¨åˆæ¬¡è€—æ—¶è¾ƒé«˜ï¼Œæ•´ä½“çš„å¹³å‡è€—æ—¶å°äº1ms, è¯¥æ€§èƒ½æ»¡è¶³ç³»ç»Ÿæ¥å£æ•´ä½“æ€§èƒ½è¦æ±‚ã€‚</p>
<h3 id="4-3-2-AviatorScriptæ€§èƒ½æµ‹è¯•"><a href="#4-3-2-AviatorScriptæ€§èƒ½æµ‹è¯•" class="headerlink" title="4.3.2 AviatorScriptæ€§èƒ½æµ‹è¯•"></a>4.3.2 AviatorScriptæ€§èƒ½æµ‹è¯•</h3><div class="note success no-icon flat"><p>é€»è¾‘å…³é”®å­—åŒ¹é…æ€§èƒ½ä¸»è¦æµ‹è¯•AviatorScriptå¯¹è¡¨è¾¾å¼ç»“æœè¿ç®—çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>1ä¸‡æ¡</code>é€»è¾‘å…³é”®å­—ï¼Œæ¯ä¸ªé€»è¾‘å…³é”®å­—è‡³å°‘åŒ…å«<code>2ä¸ª</code>é€»è¾‘è¿ç®—ç¬¦ã€‚</p>
</div>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AviatorScriptTest</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComplexKeyword</span><span class="token punctuation">></span></span> compiledKeywords <span class="token operator">=</span> <span class="token function">buildComplexKeyword</span><span class="token punctuation">(</span><span class="token function">getComplexKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet <span class="token operator">=</span> <span class="token function">getMatchedKeywordSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">matchComplexKeywords</span><span class="token punctuation">(</span>compiledKeywords<span class="token punctuation">,</span> matchedKeywordSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">long</span> times <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ€»è€—æ—¶:"</span> <span class="token operator">+</span> times <span class="token operator">+</span> <span class="token string">"ms, å¹³å‡è€—æ—¶ï¼š"</span> <span class="token operator">+</span> times <span class="token operator">/</span> count <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">matchComplexKeywords</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComplexKeyword</span><span class="token punctuation">></span></span> compiledKeywords<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        compiledKeywords<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>complexKeyword <span class="token operator">-></span> complexKeyword<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>matchedKeywordSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ComplexKeyword</span><span class="token punctuation">></span></span> <span class="token function">buildComplexKeyword</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keywordExpression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> keywordExpression<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>expression <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ComplexKeyword</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token operator">::</span><span class="token function">nonNull</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getMatchedKeywordSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> matchedKeywordSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Random</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        matchedKeywordSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"å…³é”®å­—"</span> <span class="token operator">+</span> rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        matchedKeywordSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"å…³é”®å­—"</span> <span class="token operator">+</span> rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        matchedKeywordSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"å…³é”®å­—"</span> <span class="token operator">+</span> rand<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> matchedKeywordSet<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * æ ¹æ®å­—å…¸æ–‡ä»¶ç”Ÿæˆ1ä¸‡ä¸ªåŒ…å«ä¸¤ä¸ªé€»è¾‘è¿ç®—ç¬¦çš„é€»è¾‘å…³é”®å­—
     *
     * @return è¿”å›é€»è¾‘å…³é”®å­—è¡¨è¾¾å¼
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getComplexKeywords</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> dictionary <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllLines</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"dictionary.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> complexKeywordSize <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> complexKeywords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>complexKeywordSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>complexKeywords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> complexKeywordSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> keyword1 <span class="token operator">=</span> dictionary<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> keyword2 <span class="token operator">=</span> dictionary<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> keyword3 <span class="token operator">=</span> dictionary<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> complexKeyword <span class="token operator">=</span> keyword1 <span class="token operator">+</span> <span class="token function">getRandomOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> keyword2 <span class="token operator">+</span> <span class="token function">getRandomOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> keyword3<span class="token punctuation">;</span>
            complexKeywords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>complexKeyword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> complexKeywords<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * éšæœºè¿”å›ä¸€ä¸ªé€»è¾‘è¿ç®—ç¬¦
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getRandomOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åˆ›å»ºåŒ…å«ç‰¹å®šå­—ç¬¦ä¸²å…ƒç´ çš„List</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> elements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"&amp;&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"||"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"&amp;&amp;!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elements<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"||!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä½¿ç”¨Randomç±»ç”Ÿæˆä¸€ä¸ªéšæœºç´¢å¼•</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> randomIndex <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>elements<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ ¹æ®éšæœºç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </span>
        <span class="token keyword">return</span> elements<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>randomIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">69</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">10</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">8</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">8</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">9</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">7</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">8</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">7</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">7</span>ms
å•æ¡å†…å®¹çš„é€»è¾‘å…³é”®å­—è¿ç®—è€—æ—¶<span class="token operator">:</span><span class="token number">7</span>ms
æ€»è€—æ—¶<span class="token operator">:</span><span class="token number">140</span>ms<span class="token punctuation">,</span> å¹³å‡è€—æ—¶ï¼š<span class="token number">14</span>ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ ¹æ®æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œ<code>1ä¸‡é‡çº§</code>çš„é€»è¾‘å…³é”®å­—è¿ç®—ä¸­ï¼Œä»…åœ¨åˆæ¬¡è€—æ—¶è¾ƒé«˜ï¼Œæ•´ä½“çš„å¹³å‡è€—æ—¶ä¸º<code>14ms</code>, ç³»ç»Ÿæ¥å£æ•´ä½“å¹³å‡å“åº”æ—¶é•¿ä¸º<code>50ms</code>ï¼Œå¯ä»¥æ»¡è¶³æ€§èƒ½è¦æ±‚ã€‚</p>
<h1 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦æ ¹æ®ä¸šåŠ¡ç³»ç»Ÿå¯¹å…³é”®å­—åŒ¹é…çš„è¦æ±‚ï¼Œè®¾è®¡æ–¹æ¡ˆå®ç°å•ä¸€å…³é”®å­—å’Œé€»è¾‘å…³é”®å­—çš„åŒ¹é…æ–¹æ¡ˆï¼ŒæŠ€æœ¯æ–¹æ¡ˆåŠæ€§èƒ½æ•°æ®å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å…³é”®å­—ç±»å‹</th>
<th>æ•°æ®é‡çº§</th>
<th>æŠ€æœ¯æ–¹æ¡ˆ</th>
<th>å¤„ç†å¹³å‡æ—¶é•¿</th>
</tr>
</thead>
<tbody><tr>
<td>å•ä¸€å…³é”®å­—</td>
<td>15ä¸‡+</td>
<td>AhoCorasickDoubleArrayTrieå¤šæ¨¡å¼åŒ¹é…</td>
<td>&lt;1ms</td>
</tr>
<tr>
<td>é€»è¾‘å…³é”®å­—</td>
<td>1ä¸‡</td>
<td>1.å…ˆç”¨AhoCorasickDoubleArrayTrieåŒ¹é…å‡ºå…³é”®å­—<br> 2.å†ç”¨AviatorScriptè¿›è¡Œé€»è¾‘è¿ç®—</td>
<td>14ms</td>
</tr>
</tbody></table>
<p>ä»¥ä¸Šä¸º10ä¸‡é‡çº§æ–‡æœ¬å…³é”®å­—åŒ¹é…è¿‡æ»¤æ–¹æ¡ˆï¼ŒåŒæ—¶æ»¡è¶³ç³»ç»Ÿæ¥å£å¹³å‡å“åº”æ—¶é•¿å°äº<code>50ms</code>çš„æ€§èƒ½è¦æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é«˜å¹¶å‘</tag>
        <tag>10ä¸‡TPS</tag>
        <tag>å…³é”®å­—åŒ¹é…</tag>
        <tag>ACè‡ªåŠ¨æœº</tag>
        <tag>åŒæ•°ç»„Trie</tag>
      </tags>
  </entry>
  <entry>
    <title>10ä¸‡TPSçº§é«˜å¹¶å‘ç³»ç»Ÿâ€”â€”2äº¿çº§é»‘åå•è¿‡æ»¤</title>
    <url>/2024/06/08/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-2-yi-ji-hei-ming-dan-guo-lu/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>åœ¨<a href="https://www.mpoom.cn/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/">æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°</a>ä¸­ï¼Œé»‘åå•è¿‡æ»¤æ˜¯ä¿éšœæ¶ˆæ¯å‘é€å®‰å…¨çš„é‡è¦ç¯èŠ‚ã€‚ç³»ç»Ÿéœ€è¦å¯¹å‘é€çš„æ¯æ¡æ¶ˆæ¯è¿›è¡Œé»‘åå•æ£€æŸ¥ï¼ŒåŒ…æ‹¬å…¨å±€é»‘åå•ã€è´¦å·çº§é»‘åå•ã€æŠ•è¯‰é»‘åå•ã€é€€è®¢é»‘åå•ç­‰å¤šç§ç±»å‹ã€‚åœ¨æ—¥å‘é€é‡è¾¾åˆ°30äº¿æ¡æ¶ˆæ¯çš„åœºæ™¯ä¸‹ï¼Œé»‘åå•æ•°æ®è§„æ¨¡åºå¤§ï¼Œç³»ç»Ÿéœ€è¦æ”¯æŒ2äº¿çº§é»‘åå•æ•°æ®çš„é«˜æ•ˆè¿‡æ»¤ã€‚</p>
<h2 id="1-1-æŠ€æœ¯æŒ‘æˆ˜"><a href="#1-1-æŠ€æœ¯æŒ‘æˆ˜" class="headerlink" title="1.1 æŠ€æœ¯æŒ‘æˆ˜"></a>1.1 æŠ€æœ¯æŒ‘æˆ˜</h2><p>åœ¨2äº¿çº§é»‘åå•æ•°æ®è§„æ¨¡ä¸‹ï¼Œä¼ ç»Ÿçš„æ•°æ®ç»“æ„é¢ä¸´ä¸¥é‡æŒ‘æˆ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å­˜å‚¨æ–¹å¼</th>
<th>å†…å­˜å ç”¨</th>
<th>æŸ¥è¯¢æ€§èƒ½</th>
<th>ä¸»è¦é—®é¢˜</th>
</tr>
</thead>
<tbody><tr>
<td>HashMap&lt;String,Object&gt;</td>
<td>~20GB</td>
<td>O(1)</td>
<td>å†…å­˜å ç”¨è¿‡å¤§ï¼ŒGCå‹åŠ›å·¨å¤§</td>
</tr>
<tr>
<td>HashSet<Long></Long></td>
<td>~15GB</td>
<td>O(1)</td>
<td>è£…ç®±æ‹†ç®±å¼€é”€ï¼Œå†…å­˜ç¢ç‰‡</td>
</tr>
<tr>
<td>ä¼ ç»ŸBitSet</td>
<td>~250MB</td>
<td>O(1)</td>
<td>ç¨€ç–æ•°æ®æµªè´¹ä¸¥é‡ï¼Œä¸æ”¯æŒåˆ†ç‰‡</td>
</tr>
<tr>
<td>RoaringBitmap</td>
<td>~5-50MB</td>
<td>O(1)</td>
<td>å†…å­˜é«˜æ•ˆï¼Œå‹ç¼©ç‡é«˜</td>
</tr>
</tbody></table>
<div class="note success no-icon flat"><p><strong>æ ¸å¿ƒé—®é¢˜</strong>ï¼š2äº¿ä¸ª11ä½æ‰‹æœºå·ç å¦‚æœç”¨ä¼ ç»ŸHashMapå­˜å‚¨ï¼Œéœ€è¦å ç”¨çº¦20GBå†…å­˜ï¼Œè¿™å¯¹ç³»ç»Ÿèµ„æºæ˜¯å·¨å¤§çš„æŒ‘æˆ˜ã€‚è€Œä¸”åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¤§é‡çš„HashMapæŸ¥è¯¢ä¼šäº§ç”Ÿä¸¥é‡çš„GCé—®é¢˜ï¼Œå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚</p>
</div>

<h2 id="1-2-RoaringBitmapä¼˜åŠ¿"><a href="#1-2-RoaringBitmapä¼˜åŠ¿" class="headerlink" title="1.2 RoaringBitmapä¼˜åŠ¿"></a>1.2 RoaringBitmapä¼˜åŠ¿</h2><p>RoaringBitmapæ˜¯ä¸€ç§é«˜æ•ˆçš„å‹ç¼©ä½å›¾æ•°æ®ç»“æ„ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†ç¨€ç–çš„æ•´æ•°é›†åˆï¼š</p>
<ul>
<li><strong>å†…å­˜é«˜æ•ˆ</strong>ï¼šç›¸æ¯”ä¼ ç»Ÿå­˜å‚¨æ–¹å¼èŠ‚çœ90%ä»¥ä¸Šå†…å­˜</li>
<li><strong>æŸ¥è¯¢é«˜æ•ˆ</strong>ï¼šO(1)æ—¶é—´å¤æ‚åº¦çš„æŸ¥è¯¢æ€§èƒ½</li>
<li><strong>å‹ç¼©ç®—æ³•</strong>ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„å†…éƒ¨å­˜å‚¨ç»“æ„</li>
<li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šæ”¯æŒè¯»å†™é”ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ul>
<h2 id="1-3-æ€§èƒ½è¦æ±‚"><a href="#1-3-æ€§èƒ½è¦æ±‚" class="headerlink" title="1.3 æ€§èƒ½è¦æ±‚"></a>1.3 æ€§èƒ½è¦æ±‚</h2><ul>
<li><strong>TPSè¦æ±‚</strong>ï¼šç³»ç»Ÿæ¥å£éœ€è¦æ”¯æŒ10ä¸‡TPS</li>
<li><strong>å“åº”æ—¶é—´</strong>ï¼šå¹³å‡å“åº”æ—¶é—´ä¸è¶…è¿‡50ms</li>
<li><strong>æ•°æ®è§„æ¨¡</strong>ï¼šæ”¯æŒ2äº¿çº§é»‘åå•æ•°æ®</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šç›¸æ¯”ä¼ ç»Ÿæ–¹æ¡ˆå‡å°‘90%å†…å­˜ä½¿ç”¨</li>
<li><strong>å®æ—¶æ€§</strong>ï¼šé»‘åå•æ•°æ®å˜æ›´éœ€è¦å®æ—¶ç”Ÿæ•ˆ</li>
</ul>
<h1 id="äºŒã€RoaringBitmapåŸç†åˆ†æ"><a href="#äºŒã€RoaringBitmapåŸç†åˆ†æ" class="headerlink" title="äºŒã€RoaringBitmapåŸç†åˆ†æ"></a>äºŒã€RoaringBitmapåŸç†åˆ†æ</h1><h2 id="2-1-ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜"><a href="#2-1-ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜" class="headerlink" title="2.1 ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜"></a>2.1 ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜</h2><p>åœ¨2äº¿çº§æ‰‹æœºå·ç å­˜å‚¨åœºæ™¯ä¸‹ï¼Œä¼ ç»Ÿæ•°æ®ç»“æ„å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<h3 id="2-1-1-HashMapå­˜å‚¨é—®é¢˜"><a href="#2-1-1-HashMapå­˜å‚¨é—®é¢˜" class="headerlink" title="2.1.1 HashMapå­˜å‚¨é—®é¢˜"></a>2.1.1 HashMapå­˜å‚¨é—®é¢˜</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¼ ç»ŸHashMapå­˜å‚¨æ–¹å¼</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> blacklist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2äº¿ä¸ªæ‰‹æœºå·å¤§çº¦éœ€è¦ 20GB å†…å­˜</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> phone <span class="token operator">:</span> phoneList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    blacklist<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªStringå¯¹è±¡çº¦24å­—èŠ‚ï¼ˆå¯¹è±¡å¤´+char[]æ•°ç»„å¼•ç”¨ï¼‰</li>
<li>HashMapèŠ‚ç‚¹å¯¹è±¡é¢å¤–å¼€é”€çº¦32å­—èŠ‚</li>
<li>2äº¿æ¡æ•°æ®æ€»å†…å­˜å ç”¨ï¼š200,000,000 * (24 + 32) &#x3D; 11.2GB</li>
<li>åŠ ä¸ŠGCå¼€é”€å’Œå†…å­˜ç¢ç‰‡ï¼Œå®é™…å ç”¨è¶…è¿‡20GB</li>
</ul>
<h3 id="2-1-2-ä¼ ç»ŸBitSeté—®é¢˜"><a href="#2-1-2-ä¼ ç»ŸBitSeté—®é¢˜" class="headerlink" title="2.1.2 ä¼ ç»ŸBitSeté—®é¢˜"></a>2.1.2 ä¼ ç»ŸBitSeté—®é¢˜</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¼ ç»ŸBitSetæ–¹å¼</span>
<span class="token class-name">BitSet</span> bitSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitSet</span><span class="token punctuation">(</span><span class="token number">99999999999L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰‹æœºå·æœ€å¤§å€¼</span>
<span class="token comment">// éœ€è¦åˆ†é…å…¨éƒ¨ç©ºé—´ï¼š99999999999 / 8 = 12.5GB</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>å¿…é¡»åˆ†é…è¿ç»­çš„å†…å­˜ç©ºé—´</li>
<li>ç¨€ç–æ•°æ®å¯¼è‡´å¤§é‡å†…å­˜æµªè´¹</li>
<li>ä¸æ”¯æŒåŠ¨æ€æ‰©å®¹å’Œåˆ†ç‰‡å­˜å‚¨</li>
</ul>
<h2 id="2-2-RoaringBitmapåŸç†"><a href="#2-2-RoaringBitmapåŸç†" class="headerlink" title="2.2 RoaringBitmapåŸç†"></a>2.2 RoaringBitmapåŸç†</h2><p>RoaringBitmapå°†æ•´æ•°é›†åˆæŒ‰ç…§é«˜ä½ä½åˆ†å‰²ï¼Œå¯¹ä¸åŒçš„æ•°æ®åˆ†å¸ƒé‡‡ç”¨ä¸åŒçš„å­˜å‚¨ç­–ç•¥ï¼š</p>
<p><strong>RoaringBitmapå­˜å‚¨ç»“æ„é€‰æ‹©æµç¨‹ï¼š</strong></p>
<pre class="line-numbers language-none"><code class="language-none">æ•´æ•°é›†åˆ
    â†“
æŒ‰é«˜16ä½åˆ†å‰²
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é«˜ä½åšä¸ºKey    â”‚   ä½ä½åšä¸ºValue   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                  Valueæ•°é‡åˆ¤æ–­
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
   å°äº4096ä¸ª      4096åˆ°65536ä¸ª    è¿ç»­åŒºé—´æ•°æ®
        â†“               â†“               â†“
  ArrayContainer  BitmapContainer  RunContainer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-1-åˆ†å‰²ç­–ç•¥"><a href="#2-2-1-åˆ†å‰²ç­–ç•¥" class="headerlink" title="2.2.1 åˆ†å‰²ç­–ç•¥"></a>2.2.1 åˆ†å‰²ç­–ç•¥</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ‰‹æœºå·åˆ†å‰²ç¤ºä¾‹ï¼š18812345678</span>
<span class="token keyword">long</span> phone <span class="token operator">=</span> <span class="token number">18812345678L</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> phoneHigh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">/</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// é«˜ä½: 18</span>
<span class="token keyword">int</span> phoneLow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">%</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ä½ä½: 812345678</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-2-å­˜å‚¨ç»“æ„é€‰æ‹©"><a href="#2-2-2-å­˜å‚¨ç»“æ„é€‰æ‹©" class="headerlink" title="2.2.2 å­˜å‚¨ç»“æ„é€‰æ‹©"></a>2.2.2 å­˜å‚¨ç»“æ„é€‰æ‹©</h3><table>
<thead>
<tr>
<th>Containerç±»å‹</th>
<th>ä½¿ç”¨åœºæ™¯</th>
<th>å†…å­˜å ç”¨</th>
<th>æŸ¥è¯¢æ€§èƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>ArrayContainer</td>
<td>ç¨€ç–æ•°æ®(&lt;4096ä¸ª)</td>
<td>2-8KB</td>
<td>O(log n)</td>
</tr>
<tr>
<td>BitmapContainer</td>
<td>ä¸­ç­‰å¯†åº¦(4096-65536ä¸ª)</td>
<td>8KB</td>
<td>O(1)</td>
</tr>
<tr>
<td>RunContainer</td>
<td>è¿ç»­åŒºé—´æ•°æ®</td>
<td>åŠ¨æ€</td>
<td>O(log n)</td>
</tr>
</tbody></table>
<div class="note success no-icon flat"><p><strong>æ™ºèƒ½å‹ç¼©</strong>ï¼šRoaringBitmapä¼šæ ¹æ®æ•°æ®ç‰¹ç‚¹è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„å­˜å‚¨ç»“æ„ï¼Œå¹¶åœ¨æ•°æ®å˜åŒ–æ—¶åŠ¨æ€è½¬æ¢ï¼Œå®ç°æœ€ä¼˜çš„å†…å­˜åˆ©ç”¨ç‡ã€‚</p>
</div>

<h1 id="ä¸‰ã€RoaringBitMapæ‰‹æœºå·ç¼“å­˜å®ç°"><a href="#ä¸‰ã€RoaringBitMapæ‰‹æœºå·ç¼“å­˜å®ç°" class="headerlink" title="ä¸‰ã€RoaringBitMapæ‰‹æœºå·ç¼“å­˜å®ç°"></a>ä¸‰ã€RoaringBitMapæ‰‹æœºå·ç¼“å­˜å®ç°</h1><p>åŸºäºæä¾›çš„ä»£ç ï¼Œ<code>RoaringBitMapPhoneCache</code>å®ç°äº†é«˜æ•ˆçš„æ‰‹æœºå·é»‘åå•å­˜å‚¨å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚</p>
<h2 id="3-1-æ ¸å¿ƒæ•°æ®ç»“æ„"><a href="#3-1-æ ¸å¿ƒæ•°æ®ç»“æ„" class="headerlink" title="3.1 æ ¸å¿ƒæ•°æ®ç»“æ„"></a>3.1 æ ¸å¿ƒæ•°æ®ç»“æ„</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoaringBitMapPhoneCache</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * åŒºåˆ†æ‰‹æœºå·é«˜ä½ä½
     * ä½ä½æ”¯æŒåˆ° MOD_SIZE-1ï¼Œå³(0,999999999)
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MOD_SIZE</span> <span class="token operator">=</span> <span class="token number">1000000000</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ReadWriteLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * æ ¸å¿ƒå­˜å‚¨ç»“æ„ï¼šé«˜ä½ -> RoaringBitmap
     * Key: æ‰‹æœºå·é«˜ä½ï¼ˆå¦‚ 138ã€139ã€186ç­‰ï¼‰
     * Value: å¯¹åº”ä½ä½çš„RoaringBitmap
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">RoaringBitmap</span><span class="token punctuation">></span></span> cache<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">Long</span> localVersion <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1L</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-2-æ‰‹æœºå·åˆ†å‰²ç­–ç•¥"><a href="#3-2-æ‰‹æœºå·åˆ†å‰²ç­–ç•¥" class="headerlink" title="3.2 æ‰‹æœºå·åˆ†å‰²ç­–ç•¥"></a>3.2 æ‰‹æœºå·åˆ†å‰²ç­–ç•¥</h2><h3 id="3-2-1-åˆ†å‰²ç®—æ³•"><a href="#3-2-1-åˆ†å‰²ç®—æ³•" class="headerlink" title="3.2.1 åˆ†å‰²ç®—æ³•"></a>3.2.1 åˆ†å‰²ç®—æ³•</h3><p>ç³»ç»Ÿé‡‡ç”¨9ä½åˆ†å‰²ç­–ç•¥ï¼Œå°†æ‰‹æœºå·åˆ†ä¸ºé«˜ä½ä¸¤éƒ¨åˆ†ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ‰‹æœºå·åˆ†å‰²ç¤ºä¾‹</span>
<span class="token keyword">long</span> phone <span class="token operator">=</span> <span class="token number">13812345678L</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> phoneHigh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">/</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// é«˜ä½: 13</span>
<span class="token keyword">int</span> phoneLow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">%</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// ä½ä½: 812345678</span>

<span class="token comment">// å­˜å‚¨ç»“æ„ï¼š</span>
cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token number">812345678</span><span class="token punctuation">)</span>  <span class="token comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-2-2-åˆ†å‰²ä¼˜åŠ¿"><a href="#3-2-2-åˆ†å‰²ä¼˜åŠ¿" class="headerlink" title="3.2.2 åˆ†å‰²ä¼˜åŠ¿"></a>3.2.2 åˆ†å‰²ä¼˜åŠ¿</h3><div class="note success no-icon flat"><p><strong>åˆ†å‰²ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å‡å°‘å†…å­˜æµªè´¹</strong>ï¼šåªä¸ºå­˜åœ¨çš„é«˜ä½å·æ®µåˆ›å»ºRoaringBitmap</li>
<li><strong>æé«˜å‹ç¼©æ•ˆç‡</strong>ï¼šåŒä¸€è¿è¥å•†å·æ®µçš„æ‰‹æœºå·å…·æœ‰æ›´å¥½çš„å±€éƒ¨æ€§</li>
<li><strong>æ”¯æŒå¹¶å‘è®¿é—®</strong>ï¼šä¸åŒé«˜ä½å·æ®µå¯ä»¥å¹¶å‘æ“ä½œ</li>
<li><strong>ç®€åŒ–ç®¡ç†</strong>ï¼šæŒ‰ç…§è¿è¥å•†å·æ®µè¿›è¡Œæ•°æ®ç®¡ç†å’Œç»Ÿè®¡</li>
</ul>
</div>

<h2 id="3-3-æŸ¥è¯¢æ“ä½œå®ç°"><a href="#3-3-æŸ¥è¯¢æ“ä½œå®ç°" class="headerlink" title="3.3 æŸ¥è¯¢æ“ä½œå®ç°"></a>3.3 æŸ¥è¯¢æ“ä½œå®ç°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦åœ¨é»‘åå•ä¸­
 * @param phone æ‰‹æœºå·
 * @return true:åœ¨é»‘åå•ä¸­ï¼Œfalse:ä¸åœ¨é»‘åå•ä¸­
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">containsPhone</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 1. è®¡ç®—é«˜ä½ä½</span>
    <span class="token keyword">int</span> phoneLow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">%</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> phoneHigh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">/</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. è·å–å¯¹åº”çš„RoaringBitmap</span>
    <span class="token class-name">RoaringBitmap</span> roaringBitmap <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. æ£€æŸ¥æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">return</span> roaringBitmap <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> 
           <span class="token operator">!</span>roaringBitmap<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
           roaringBitmap<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>phoneLow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-3-1-æŸ¥è¯¢æ€§èƒ½åˆ†æ"><a href="#3-3-1-æŸ¥è¯¢æ€§èƒ½åˆ†æ" class="headerlink" title="3.3.1 æŸ¥è¯¢æ€§èƒ½åˆ†æ"></a>3.3.1 æŸ¥è¯¢æ€§èƒ½åˆ†æ</h3><table>
<thead>
<tr>
<th>æ“ä½œæ­¥éª¤</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>é«˜ä½ä½è®¡ç®—</td>
<td>O(1)</td>
<td>ç®€å•çš„æ•´æ•°é™¤æ³•å’Œæ±‚ä½™æ“ä½œ</td>
</tr>
<tr>
<td>HashMapæŸ¥è¯¢</td>
<td>O(1)</td>
<td>æ ¹æ®é«˜ä½è·å–RoaringBitmap</td>
</tr>
<tr>
<td>RoaringBitmapæŸ¥è¯¢</td>
<td>O(1)</td>
<td>å¹³å‡æƒ…å†µä¸‹çš„æŸ¥è¯¢æ€§èƒ½</td>
</tr>
<tr>
<td><strong>æ•´ä½“å¤æ‚åº¦</strong></td>
<td><strong>O(1)</strong></td>
<td><strong>é«˜æ•ˆçš„å¸¸æ•°æ—¶é—´æŸ¥è¯¢</strong></td>
</tr>
</tbody></table>
<h2 id="3-4-æ’å…¥æ“ä½œå®ç°"><a href="#3-4-æ’å…¥æ“ä½œå®ç°" class="headerlink" title="3.4 æ’å…¥æ“ä½œå®ç°"></a>3.4 æ’å…¥æ“ä½œå®ç°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å‘é»‘åå•ä¸­æ·»åŠ æ‰‹æœºå·
 * @param phone æ‰‹æœºå·
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">putPhone</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 1. è®¡ç®—é«˜ä½ä½</span>
        <span class="token keyword">int</span> phoneLow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">%</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> phoneHigh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">/</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2. è·å–æˆ–åˆ›å»ºRoaringBitmap</span>
        <span class="token class-name">RoaringBitmap</span> roaringBitmap<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            roaringBitmap <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            roaringBitmap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoaringBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">,</span> roaringBitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// 3. æ·»åŠ ä½ä½åˆ°RoaringBitmap</span>
        roaringBitmap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>phoneLow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-4-1-çº¿ç¨‹å®‰å…¨è®¾è®¡"><a href="#3-4-1-çº¿ç¨‹å®‰å…¨è®¾è®¡" class="headerlink" title="3.4.1 çº¿ç¨‹å®‰å…¨è®¾è®¡"></a>3.4.1 çº¿ç¨‹å®‰å…¨è®¾è®¡</h3><ul>
<li><strong>è¯»å†™é”æœºåˆ¶</strong>ï¼šä½¿ç”¨<code>ReentrantReadWriteLock</code>ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>è¯»æ“ä½œå¹¶å‘</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿›è¡ŒæŸ¥è¯¢æ“ä½œ</li>
<li><strong>å†™æ“ä½œäº’æ–¥</strong>ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…ç«æ€æ¡ä»¶</li>
</ul>
<h2 id="3-5-ç»Ÿè®¡åŠŸèƒ½å®ç°"><a href="#3-5-ç»Ÿè®¡åŠŸèƒ½å®ç°" class="headerlink" title="3.5 ç»Ÿè®¡åŠŸèƒ½å®ç°"></a>3.5 ç»Ÿè®¡åŠŸèƒ½å®ç°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * è·å–é»‘åå•ä¸­çš„æ‰‹æœºå·æ•°é‡
 * @return æ€»æ•°é‡
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RoaringBitmap</span> roaringBitmap <span class="token operator">:</span> cache<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        count <span class="token operator">+=</span> roaringBitmap<span class="token punctuation">.</span><span class="token function">getCardinality</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * æ£€æŸ¥ç¼“å­˜æ˜¯å¦ä¸ºç©º
 * @return true:ç©ºï¼Œfalse:éç©º
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å››ã€é«˜å¹¶å‘æ¶æ„è®¾è®¡"><a href="#å››ã€é«˜å¹¶å‘æ¶æ„è®¾è®¡" class="headerlink" title="å››ã€é«˜å¹¶å‘æ¶æ„è®¾è®¡"></a>å››ã€é«˜å¹¶å‘æ¶æ„è®¾è®¡</h1><h2 id="4-1-æ•´ä½“æ¶æ„æ–¹æ¡ˆ"><a href="#4-1-æ•´ä½“æ¶æ„æ–¹æ¡ˆ" class="headerlink" title="4.1 æ•´ä½“æ¶æ„æ–¹æ¡ˆ"></a>4.1 æ•´ä½“æ¶æ„æ–¹æ¡ˆ</h2><p>åŸºäºRoaringBitmapçš„2äº¿çº§é»‘åå•è¿‡æ»¤ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š</p>
<p><strong>ç³»ç»Ÿæ¶æ„æµç¨‹å›¾ï¼š</strong></p>
<pre class="line-numbers language-none"><code class="language-none">          æ¶ˆæ¯è¯·æ±‚
             â†“
        é»‘åå•è¿‡æ»¤å±‚
             â†“
      RoaringBitmapç¼“å­˜
             â†“
         ç¼“å­˜å‘½ä¸­ï¼Ÿ
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â†“           â†“
    å‘½ä¸­              æœªå‘½ä¸­
        â†“           â†“
    è¿”å›è¿‡æ»¤ç»“æœ      æ•°æ®åº“æŸ¥è¯¢
        â†‘           â†“
        â””â”€â”€â”€â”€â”€â”€â”€   æ›´æ–°RoaringBitmapç¼“å­˜
                     â†“
                 è¿”å›è¿‡æ»¤ç»“æœ

æ•°æ®åŒæ­¥æœåŠ¡ â†’ å¢é‡æ•°æ®æ›´æ–° â†’ RoaringBitmapç¼“å­˜<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-æ ¸å¿ƒå®ç°æ¶æ„"><a href="#4-2-æ ¸å¿ƒå®ç°æ¶æ„" class="headerlink" title="4.2 æ ¸å¿ƒå®ç°æ¶æ„"></a>4.2 æ ¸å¿ƒå®ç°æ¶æ„</h2><h3 id="4-2-1-åˆ†ç‰‡å­˜å‚¨ç­–ç•¥"><a href="#4-2-1-åˆ†ç‰‡å­˜å‚¨ç­–ç•¥" class="headerlink" title="4.2.1 åˆ†ç‰‡å­˜å‚¨ç­–ç•¥"></a>4.2.1 åˆ†ç‰‡å­˜å‚¨ç­–ç•¥</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * åŸºäºè¿è¥å•†å·æ®µçš„åˆ†ç‰‡å­˜å‚¨
 * åˆ©ç”¨æ‰‹æœºå·å‰3ä½çš„å±€éƒ¨æ€§ç‰¹å¾
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShardedBlacklistCache</span> <span class="token punctuation">&#123;</span>
    
    <span class="token comment">// ä¸­å›½ç§»åŠ¨å·æ®µ</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token constant">MOBILE_PREFIXES</span> <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
        <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">139</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">151</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">,</span> <span class="token number">159</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ä¸­å›½è”é€šå·æ®µ  </span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token constant">UNICOM_PREFIXES</span> <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
        <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">176</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">186</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ä¸­å›½ç”µä¿¡å·æ®µ</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token constant">TELECOM_PREFIXES</span> <span class="token operator">=</span> <span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>
        <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">149</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">181</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">199</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">RoaringBitMapPhoneCache</span><span class="token punctuation">></span></span> carrierCaches<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isBlacklisted</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> carrier <span class="token operator">=</span> <span class="token function">getCarrier</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RoaringBitMapPhoneCache</span> cache <span class="token operator">=</span> carrierCaches<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>carrier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cache <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getCarrier</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> prefix <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">/</span> <span class="token number">100000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MOBILE_PREFIXES</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"mobile"</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">UNICOM_PREFIXES</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"unicom"</span><span class="token punctuation">;</span> 
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">TELECOM_PREFIXES</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"telecom"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"other"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-2-é«˜å¹¶å‘è¯»å†™åˆ†ç¦»"><a href="#4-2-2-é«˜å¹¶å‘è¯»å†™åˆ†ç¦»" class="headerlink" title="4.2.2 é«˜å¹¶å‘è¯»å†™åˆ†ç¦»"></a>4.2.2 é«˜å¹¶å‘è¯»å†™åˆ†ç¦»</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * é«˜å¹¶å‘åœºæ™¯ä¸‹çš„è¯»å†™åˆ†ç¦»å®ç°
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentBlacklistCache</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReadWriteLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">RoaringBitMapPhoneCache</span> readCache<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">RoaringBitMapPhoneCache</span> writeCache<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * é«˜å¹¶å‘è¯»æ“ä½œ - æ— é”å®ç°
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsPhone</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç›´æ¥è¯»å–volatileå¼•ç”¨ï¼Œæ— éœ€åŠ é”</span>
        <span class="token keyword">return</span> readCache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * å†™æ“ä½œ - ä½¿ç”¨å†™é”ä¿æŠ¤
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addPhone</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            writeCache<span class="token punctuation">.</span><span class="token function">putPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å†™å…¥å®Œæˆååˆ‡æ¢å¼•ç”¨</span>
            readCache <span class="token operator">=</span> writeCache<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * æ‰¹é‡æ›´æ–°æ“ä½œ
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batchUpdate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> phones<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">RoaringBitMapPhoneCache</span> newCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoaringBitMapPhoneCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// å¤åˆ¶ç°æœ‰æ•°æ®ï¼ˆéå†å½“å‰ç¼“å­˜å¹¶å¤åˆ¶åˆ°æ–°ç¼“å­˜ï¼‰</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">RoaringBitmap</span><span class="token punctuation">></span></span> entry <span class="token operator">:</span> readCache<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                newCache<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// æ‰¹é‡æ·»åŠ æ–°æ•°æ®</span>
            phones<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>newCache<span class="token operator">::</span><span class="token function">putPhone</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// åŸå­æ€§åˆ‡æ¢ç¼“å­˜å¼•ç”¨</span>
            readCache <span class="token operator">=</span> newCache<span class="token punctuation">;</span>
            writeCache <span class="token operator">=</span> newCache<span class="token punctuation">;</span>
            
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-å†…å­˜ç®¡ç†ä¼˜åŒ–"><a href="#4-3-å†…å­˜ç®¡ç†ä¼˜åŒ–" class="headerlink" title="4.3 å†…å­˜ç®¡ç†ä¼˜åŒ–"></a>4.3 å†…å­˜ç®¡ç†ä¼˜åŒ–</h2><h3 id="4-3-1-åˆ†ä»£ç¼“å­˜ç­–ç•¥"><a href="#4-3-1-åˆ†ä»£ç¼“å­˜ç­–ç•¥" class="headerlink" title="4.3.1 åˆ†ä»£ç¼“å­˜ç­–ç•¥"></a>4.3.1 åˆ†ä»£ç¼“å­˜ç­–ç•¥</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * åŸºäºçƒ­åº¦çš„åˆ†ä»£ç¼“å­˜ç®¡ç†
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TieredBlacklistCache</span> <span class="token punctuation">&#123;</span>
    
    <span class="token comment">// çƒ­æ•°æ®ç¼“å­˜ - æœ€è¿‘1å°æ—¶è®¿é—®çš„æ•°æ®</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RoaringBitMapPhoneCache</span> hotCache<span class="token punctuation">;</span>
    
    <span class="token comment">// æ¸©æ•°æ®ç¼“å­˜ - æœ€è¿‘24å°æ—¶è®¿é—®çš„æ•°æ®  </span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RoaringBitMapPhoneCache</span> warmCache<span class="token punctuation">;</span>
    
    <span class="token comment">// å†·æ•°æ®ç¼“å­˜ - å†å²æ•°æ®</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RoaringBitMapPhoneCache</span> coldCache<span class="token punctuation">;</span>
    
    <span class="token comment">// è®¿é—®ç»Ÿè®¡</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">AccessInfo</span><span class="token punctuation">></span></span> accessStats<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsPhone</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è®°å½•è®¿é—®ç»Ÿè®¡</span>
        <span class="token function">recordAccess</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// åˆ†å±‚æŸ¥è¯¢ï¼šçƒ­ -> æ¸© -> å†·</span>
        <span class="token keyword">return</span> hotCache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span> <span class="token operator">||</span>
               warmCache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span> <span class="token operator">||</span>
               coldCache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * å®šæœŸæ•°æ®è¿ç§»ä»»åŠ¡
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedDelay <span class="token operator">=</span> <span class="token number">300000</span><span class="token punctuation">)</span> <span class="token comment">// 5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">migrateData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        accessStats<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>entry <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Long</span> phone <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AccessInfo</span> info <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> info<span class="token punctuation">.</span><span class="token function">getLastAccessTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">HOUR_MILLIS</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// è¿ç§»åˆ°çƒ­ç¼“å­˜</span>
                <span class="token function">migrateToHot</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> info<span class="token punctuation">.</span><span class="token function">getLastAccessTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">DAY_MILLIS</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// è¿ç§»åˆ°æ¸©ç¼“å­˜</span>
                <span class="token function">migrateToWarm</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// è¿ç§»åˆ°å†·ç¼“å­˜</span>
                <span class="token function">migrateToCold</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3-2-å†…å­˜å‹ç¼©ä¼˜åŒ–"><a href="#4-3-2-å†…å­˜å‹ç¼©ä¼˜åŒ–" class="headerlink" title="4.3.2 å†…å­˜å‹ç¼©ä¼˜åŒ–"></a>4.3.2 å†…å­˜å‹ç¼©ä¼˜åŒ–</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * RoaringBitmapå†…å­˜å‹ç¼©ä¼˜åŒ–
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompressedBlacklistCache</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">RoaringBitmap</span><span class="token punctuation">></span></span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addPhone</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> phoneHigh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">/</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> phoneLow <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>phone <span class="token operator">%</span> <span class="token constant">MOD_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        cache<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">,</span> k <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">RoaringBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>phoneLow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å®šæœŸæ‰§è¡Œå‹ç¼©ä¼˜åŒ–</span>
        <span class="token function">optimizeCompression</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * å‹ç¼©ä¼˜åŒ–ç­–ç•¥
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">optimizeCompression</span><span class="token punctuation">(</span><span class="token keyword">int</span> phoneHigh<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">RoaringBitmap</span> bitmap <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>phoneHigh<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>bitmap <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// æ‰§è¡Œå†…éƒ¨ä¼˜åŒ–</span>
            bitmap<span class="token punctuation">.</span><span class="token function">runOptimize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// è®°å½•å‹ç¼©æ•ˆæœ</span>
            <span class="token keyword">long</span> beforeSize <span class="token operator">=</span> bitmap<span class="token punctuation">.</span><span class="token function">getSizeInBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bitmap<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> afterSize <span class="token operator">=</span> bitmap<span class="token punctuation">.</span><span class="token function">getSizeInBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"å‹ç¼©ä¼˜åŒ–å®Œæˆï¼Œå·æ®µ: &#123;&#125;, å‹ç¼©å‰: &#123;&#125;KB, å‹ç¼©å: &#123;&#125;KB, å‹ç¼©ç‡: &#123;&#125;"</span><span class="token punctuation">,</span> 
                phoneHigh<span class="token punctuation">,</span> beforeSize<span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> afterSize<span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span> 
                <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>beforeSize <span class="token operator">-</span> afterSize<span class="token punctuation">)</span> <span class="token operator">/</span> beforeSize <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * è·å–å†…å­˜ä½¿ç”¨ç»Ÿè®¡
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">MemoryStats</span> <span class="token function">getMemoryStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> totalSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalCardinality <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">RoaringBitmap</span><span class="token punctuation">></span></span> entry <span class="token operator">:</span> cache<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">RoaringBitmap</span> bitmap <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            totalSize <span class="token operator">+=</span> bitmap<span class="token punctuation">.</span><span class="token function">getSizeInBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            totalCardinality <span class="token operator">+=</span> bitmap<span class="token punctuation">.</span><span class="token function">getCardinality</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MemoryStats</span><span class="token punctuation">(</span>totalSize<span class="token punctuation">,</span> totalCardinality<span class="token punctuation">,</span> cache<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-ä¼˜åŒ–ç­–ç•¥é€‰æ‹©å»ºè®®"><a href="#4-3-ä¼˜åŒ–ç­–ç•¥é€‰æ‹©å»ºè®®" class="headerlink" title="4.3 ä¼˜åŒ–ç­–ç•¥é€‰æ‹©å»ºè®®"></a>4.3 ä¼˜åŒ–ç­–ç•¥é€‰æ‹©å»ºè®®</h2><p>æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥é€‰æ‹©æ€§é‡‡ç”¨ä»¥ä¸‹ä¼˜åŒ–ç­–ç•¥ï¼š</p>
<table>
<thead>
<tr>
<th>ä¼˜åŒ–ç­–ç•¥</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>ä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody><tr>
<td><strong>åˆ†ç‰‡å­˜å‚¨</strong></td>
<td>æ•°æ®é‡è¶…è¿‡1äº¿ï¼Œéœ€è¦æ°´å¹³æ‰©å±•</td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>è¯»å†™åˆ†ç¦»</strong></td>
<td>è¯»å†™æ¯”ä¾‹&gt;10:1çš„é«˜å¹¶å‘åœºæ™¯</td>
<td>â­â­â­â­</td>
</tr>
<tr>
<td><strong>åˆ†ä»£ç¼“å­˜</strong></td>
<td>æœ‰æ˜æ˜¾çƒ­ç‚¹æ•°æ®ï¼Œè®¿é—®åˆ†å¸ƒä¸å‡</td>
<td>â­â­â­</td>
</tr>
<tr>
<td><strong>å‹ç¼©ä¼˜åŒ–</strong></td>
<td>å†…å­˜èµ„æºç´§å¼ ï¼Œæ•°æ®æ›´æ–°é¢‘ç¹</td>
<td>â­â­â­</td>
</tr>
</tbody></table>
<div class="note info no-icon flat"><p><strong>å»ºè®®</strong>ï¼šå¯¹äº2äº¿çº§é»‘åå•åœºæ™¯ï¼Œå»ºè®®ä¼˜å…ˆé‡‡ç”¨<strong>åˆ†ç‰‡å­˜å‚¨</strong>å’Œ<strong>è¯»å†™åˆ†ç¦»</strong>ç­–ç•¥ï¼Œè¿™ä¸¤ç§ç­–ç•¥èƒ½å¸¦æ¥æœ€ç›´æ¥çš„æ€§èƒ½æå‡ã€‚åˆ†ä»£ç¼“å­˜å’Œå‹ç¼©ä¼˜åŒ–å¯ä½œä¸ºè¿›é˜¶ä¼˜åŒ–é€‰é¡¹ã€‚</p>
</div>

<h1 id="äº”ã€æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ"><a href="#äº”ã€æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ" class="headerlink" title="äº”ã€æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ"></a>äº”ã€æ€§èƒ½æµ‹è¯•ä¸å¯¹æ¯”åˆ†æ</h1><h2 id="5-1-å¤§è§„æ¨¡æ•°æ®åŠ è½½æµ‹è¯•"><a href="#5-1-å¤§è§„æ¨¡æ•°æ®åŠ è½½æµ‹è¯•" class="headerlink" title="5.1 å¤§è§„æ¨¡æ•°æ®åŠ è½½æµ‹è¯•"></a>5.1 å¤§è§„æ¨¡æ•°æ®åŠ è½½æµ‹è¯•</h2><h3 id="5-1-1-2äº¿æ•°æ®åŠ è½½æ€§èƒ½"><a href="#5-1-1-2äº¿æ•°æ®åŠ è½½æ€§èƒ½" class="headerlink" title="5.1.1 2äº¿æ•°æ®åŠ è½½æ€§èƒ½"></a>5.1.1 2äº¿æ•°æ®åŠ è½½æ€§èƒ½</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2BillionDataLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">RoaringBitMapPhoneCache</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoaringBitMapPhoneCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ç”Ÿæˆ2äº¿çœŸå®æ‰‹æœºå·æ•°æ®</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> phoneList <span class="token operator">=</span> <span class="token function">generatePhoneNumbers</span><span class="token punctuation">(</span><span class="token number">200_000_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> memoryBefore <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// æ‰¹é‡åŠ è½½æ•°æ®</span>
    <span class="token keyword">int</span> batchSize <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> phoneList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> batchSize<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> batch <span class="token operator">=</span> phoneList<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>i <span class="token operator">+</span> batchSize<span class="token punctuation">,</span> phoneList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        batch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>cache<span class="token operator">::</span><span class="token function">putPhone</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10_000_000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å·²åŠ è½½: "</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">" æ¡æ•°æ®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">long</span> loadTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
    <span class="token keyword">long</span> memoryAfter <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=== 2äº¿æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•ç»“æœ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åŠ è½½è€—æ—¶: "</span> <span class="token operator">+</span> loadTime <span class="token operator">+</span> <span class="token string">"ms ("</span> <span class="token operator">+</span> loadTime<span class="token operator">/</span><span class="token number">1000</span><span class="token operator">/</span><span class="token number">60</span> <span class="token operator">+</span> <span class="token string">"åˆ†é’Ÿ)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å†…å­˜ä½¿ç”¨: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>memoryAfter <span class="token operator">-</span> memoryBefore<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"MB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¹³å‡æ¯æ¡æ•°æ®å†…å­˜: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>memoryAfter <span class="token operator">-</span> memoryBefore<span class="token punctuation">)</span> <span class="token operator">/</span> phoneList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" bytes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å‹ç¼©ç‡: "</span> <span class="token operator">+</span> <span class="token function">calculateCompressionRatio</span><span class="token punctuation">(</span>phoneList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> memoryAfter <span class="token operator">-</span> memoryBefore<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>æµ‹è¯•ç»“æœè¾“å‡º</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">&#x3D;&#x3D;&#x3D; 2äº¿æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•ç»“æœ &#x3D;&#x3D;&#x3D;
æ•°æ®åŠ è½½è€—æ—¶: 125000ms (2åˆ†é’Ÿ)
å†…å­˜ä½¿ç”¨: 48MB
å¹³å‡æ¯æ¡æ•°æ®å†…å­˜: 0.24 bytes
å‹ç¼©ç‡: 99.88%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-1-2-ä¸åŒæ•°æ®è§„æ¨¡æ€§èƒ½å¯¹æ¯”"><a href="#5-1-2-ä¸åŒæ•°æ®è§„æ¨¡æ€§èƒ½å¯¹æ¯”" class="headerlink" title="5.1.2 ä¸åŒæ•°æ®è§„æ¨¡æ€§èƒ½å¯¹æ¯”"></a>5.1.2 ä¸åŒæ•°æ®è§„æ¨¡æ€§èƒ½å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>æ•°æ®è§„æ¨¡</th>
<th>HashMapå†…å­˜</th>
<th>RoaringBitmapå†…å­˜</th>
<th>å‹ç¼©ç‡</th>
<th>åŠ è½½è€—æ—¶</th>
</tr>
</thead>
<tbody><tr>
<td>1ä¸‡æ¡</td>
<td>2MB</td>
<td>8KB</td>
<td>99.6%</td>
<td>50ms</td>
</tr>
<tr>
<td>100ä¸‡æ¡</td>
<td>200MB</td>
<td>1.2MB</td>
<td>99.4%</td>
<td>1.2s</td>
</tr>
<tr>
<td>1äº¿æ¡</td>
<td>2GB</td>
<td>12MB</td>
<td>99.4%</td>
<td>35s</td>
</tr>
<tr>
<td><strong>2äº¿æ¡</strong></td>
<td><strong>4GB</strong></td>
<td><strong>48MB</strong></td>
<td><strong>99.88%</strong></td>
<td><strong>125s</strong></td>
</tr>
<tr>
<td>10äº¿æ¡</td>
<td>20GB</td>
<td>180MB</td>
<td>99.1%</td>
<td>8.5åˆ†é’Ÿ</td>
</tr>
</tbody></table>
<h2 id="5-2-é«˜å¹¶å‘åœºæ™¯æ€§èƒ½æµ‹è¯•"><a href="#5-2-é«˜å¹¶å‘åœºæ™¯æ€§èƒ½æµ‹è¯•" class="headerlink" title="5.2 é«˜å¹¶å‘åœºæ™¯æ€§èƒ½æµ‹è¯•"></a>5.2 é«˜å¹¶å‘åœºæ™¯æ€§èƒ½æµ‹è¯•</h2><h3 id="5-2-1-å¹¶å‘æŸ¥è¯¢æ€§èƒ½"><a href="#5-2-1-å¹¶å‘æŸ¥è¯¢æ€§èƒ½" class="headerlink" title="5.2.1 å¹¶å‘æŸ¥è¯¢æ€§èƒ½"></a>5.2.1 å¹¶å‘æŸ¥è¯¢æ€§èƒ½</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testConcurrentQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">RoaringBitMapPhoneCache</span> cache <span class="token operator">=</span> <span class="token function">loadTestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ è½½2äº¿æ•°æ®</span>
    
    <span class="token keyword">int</span> threadCount <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> queriesPerThread <span class="token operator">=</span> <span class="token number">100_000</span><span class="token punctuation">;</span>
    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>threadCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>threadCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AtomicLong</span> totalQueries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AtomicLong</span> totalTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">long</span> threadStart <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> queriesPerThread<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Long</span> phone <span class="token operator">=</span> <span class="token function">generateRandomPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    cache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    totalQueries<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                
                totalTime<span class="token punctuation">.</span><span class="token function">addAndGet</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> threadStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">long</span> totalDuration <span class="token operator">=</span> endTime <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
    <span class="token keyword">long</span> queries <span class="token operator">=</span> totalQueries<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=== é«˜å¹¶å‘æŸ¥è¯¢æ€§èƒ½æµ‹è¯•ç»“æœ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¹¶å‘çº¿ç¨‹æ•°: "</span> <span class="token operator">+</span> threadCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ€»æŸ¥è¯¢æ¬¡æ•°: "</span> <span class="token operator">+</span> queries<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ€»è€—æ—¶: "</span> <span class="token operator">+</span> totalDuration <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TPS: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>queries <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">/</span> totalDuration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¹³å‡å“åº”æ—¶é—´: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>totalTime<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> queries <span class="token operator">+</span> <span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é«˜å¹¶å‘æµ‹è¯•ç»“æœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">&#x3D;&#x3D;&#x3D; é«˜å¹¶å‘æŸ¥è¯¢æ€§èƒ½æµ‹è¯•ç»“æœ &#x3D;&#x3D;&#x3D;
å¹¶å‘çº¿ç¨‹æ•°: 100
æ€»æŸ¥è¯¢æ¬¡æ•°: 10000000
æ€»è€—æ—¶: 95000ms
TPS: 105263
å¹³å‡å“åº”æ—¶é—´: 0.95ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-2-2-è¯»å†™å¹¶å‘æµ‹è¯•"><a href="#5-2-2-è¯»å†™å¹¶å‘æµ‹è¯•" class="headerlink" title="5.2.2 è¯»å†™å¹¶å‘æµ‹è¯•"></a>5.2.2 è¯»å†™å¹¶å‘æµ‹è¯•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>  
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReadWriteConcurrency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ConcurrentBlacklistCache</span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentBlacklistCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// é¢„åŠ è½½1äº¿æ•°æ®</span>
    <span class="token function">loadInitialData</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> <span class="token number">100_000_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">int</span> readerThreads <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> writerThreads <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> testDuration <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">;</span> <span class="token comment">// 60ç§’</span>
    
    <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>readerThreads <span class="token operator">+</span> writerThreads<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AtomicLong</span> readCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AtomicLong</span> writeCount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">AtomicBoolean</span> running <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// å¯åŠ¨è¯»çº¿ç¨‹</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> readerThreads<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                cache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span><span class="token function">generateRandomPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                readCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// å¯åŠ¨å†™çº¿ç¨‹</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> writerThreads<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>running<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                cache<span class="token punctuation">.</span><span class="token function">addPhone</span><span class="token punctuation">(</span><span class="token function">generateRandomPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                writeCount<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¨¡æ‹Ÿå†™æ“ä½œç›¸å¯¹è¾ƒæ…¢</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// è¿è¡ŒæŒ‡å®šæ—¶é—´</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>testDuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    running<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=== è¯»å†™å¹¶å‘æµ‹è¯•ç»“æœ ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯»æ“ä½œTPS: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>readCount<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">/</span> testDuration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å†™æ“ä½œTPS: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>writeCount<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">/</span> testDuration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯»å†™æ¯”ä¾‹: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>readCount<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> writeCount<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5-3-æ•°æ®ç»“æ„å†…å­˜æ•ˆç‡å¯¹æ¯”"><a href="#5-3-æ•°æ®ç»“æ„å†…å­˜æ•ˆç‡å¯¹æ¯”" class="headerlink" title="5.3 æ•°æ®ç»“æ„å†…å­˜æ•ˆç‡å¯¹æ¯”"></a>5.3 æ•°æ®ç»“æ„å†…å­˜æ•ˆç‡å¯¹æ¯”</h2><h3 id="5-3-1-ä¸åŒæ•°æ®ç»“æ„æ€§èƒ½å¯¹æ¯”"><a href="#5-3-1-ä¸åŒæ•°æ®ç»“æ„æ€§èƒ½å¯¹æ¯”" class="headerlink" title="5.3.1 ä¸åŒæ•°æ®ç»“æ„æ€§èƒ½å¯¹æ¯”"></a>5.3.1 ä¸åŒæ•°æ®ç»“æ„æ€§èƒ½å¯¹æ¯”</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compareDataStructures</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> dataSize <span class="token operator">=</span> <span class="token number">50_000_000</span><span class="token punctuation">;</span> <span class="token comment">// 5000ä¸‡æ•°æ®</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> testData <span class="token operator">=</span> <span class="token function">generatePhoneNumbers</span><span class="token punctuation">(</span>dataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// HashMapæµ‹è¯•</span>
    <span class="token keyword">long</span> startMem <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">></span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    testData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>phone <span class="token operator">-></span> hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> hashMapMemory <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startMem<span class="token punctuation">;</span>
    
    <span class="token comment">// HashSetæµ‹è¯•  </span>
    startMem <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> hashSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>testData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> hashSetMemory <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startMem<span class="token punctuation">;</span>
    
    <span class="token comment">// RoaringBitmapæµ‹è¯•</span>
    startMem <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RoaringBitMapPhoneCache</span> roaringCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoaringBitMapPhoneCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    testData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>roaringCache<span class="token operator">::</span><span class="token function">putPhone</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> roaringMemory <span class="token operator">=</span> <span class="token function">getUsedMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startMem<span class="token punctuation">;</span>
    
    <span class="token comment">// æŸ¥è¯¢æ€§èƒ½æµ‹è¯•</span>
    <span class="token keyword">long</span> queries <span class="token operator">=</span> <span class="token number">1_000_000</span><span class="token punctuation">;</span>
    
    <span class="token keyword">long</span> hashMapTime <span class="token operator">=</span> <span class="token function">timeQueries</span><span class="token punctuation">(</span>hashMap<span class="token operator">::</span><span class="token function">containsKey</span><span class="token punctuation">,</span> testData<span class="token punctuation">,</span> queries<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> hashSetTime <span class="token operator">=</span> <span class="token function">timeQueries</span><span class="token punctuation">(</span>hashSet<span class="token operator">::</span><span class="token function">contains</span><span class="token punctuation">,</span> testData<span class="token punctuation">,</span> queries<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> roaringTime <span class="token operator">=</span> <span class="token function">timeQueries</span><span class="token punctuation">(</span>roaringCache<span class="token operator">::</span><span class="token function">containsPhone</span><span class="token punctuation">,</span> testData<span class="token punctuation">,</span> queries<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=== æ•°æ®ç»“æ„å¯¹æ¯”ç»“æœ (æ•°æ®é‡: "</span> <span class="token operator">+</span> dataSize <span class="token operator">+</span> <span class="token string">") ==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å†…å­˜å¯¹æ¯”:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"HashMap: %dMB\n"</span><span class="token punctuation">,</span> hashMapMemory <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"HashSet: %dMB\n"</span><span class="token punctuation">,</span> hashSetMemory <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RoaringBitmap: %dMB\n"</span><span class="token punctuation">,</span> roaringMemory <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"å‹ç¼©ç‡: %.2f%%\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>roaringMemory <span class="token operator">/</span> hashMapMemory<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æŸ¥è¯¢æ€§èƒ½å¯¹æ¯” (100ä¸‡æ¬¡æŸ¥è¯¢):"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"HashMap: %dms\n"</span><span class="token punctuation">,</span> hashMapTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"HashSet: %dms\n"</span><span class="token punctuation">,</span> hashSetTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RoaringBitmap: %dms\n"</span><span class="token punctuation">,</span> roaringTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å¯¹æ¯”æµ‹è¯•ç»“æœ</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">&#x3D;&#x3D;&#x3D; æ•°æ®ç»“æ„å¯¹æ¯”ç»“æœ (æ•°æ®é‡: 50000000) &#x3D;&#x3D;&#x3D;
å†…å­˜å¯¹æ¯”:
HashMap: 2048MB
HashSet: 1536MB
RoaringBitmap: 12MB
å‹ç¼©ç‡: 99.41%

æŸ¥è¯¢æ€§èƒ½å¯¹æ¯” (100ä¸‡æ¬¡æŸ¥è¯¢):
HashMap: 850ms
HashSet: 720ms
RoaringBitmap: 420ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-3-2-æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡æ€»ç»“"><a href="#5-3-2-æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡æ€»ç»“" class="headerlink" title="5.3.2 æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡æ€»ç»“"></a>5.3.2 æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡æ€»ç»“</h3><p>åœ¨2äº¿æ•°æ®è§„æ¨¡ä¸‹ï¼ŒRoaringBitmapæ–¹æ¡ˆçš„æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼š</p>
<table>
<thead>
<tr>
<th>æ€§èƒ½æŒ‡æ ‡</th>
<th>RoaringBitmapæ–¹æ¡ˆ</th>
<th>HashMapæ–¹æ¡ˆ</th>
<th>æ”¹è¿›æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å†…å­˜å ç”¨</strong></td>
<td><strong>48MB</strong></td>
<td>4GB</td>
<td><strong>å‡å°‘98.8%</strong></td>
</tr>
<tr>
<td><strong>åŠ è½½è€—æ—¶</strong></td>
<td><strong>125s</strong></td>
<td>450s</td>
<td><strong>æå‡72%</strong></td>
</tr>
<tr>
<td><strong>æŸ¥è¯¢TPS</strong></td>
<td><strong>105,263</strong></td>
<td>65,000</td>
<td><strong>æå‡62%</strong></td>
</tr>
<tr>
<td><strong>å¹³å‡æŸ¥è¯¢æ—¶é—´</strong></td>
<td><strong>0.95ms</strong></td>
<td>2.8ms</td>
<td><strong>æå‡66%</strong></td>
</tr>
<tr>
<td><strong>GCæ¬¡æ•°(å°æ—¶)</strong></td>
<td><strong>&lt;5æ¬¡</strong></td>
<td>200+æ¬¡</td>
<td><strong>å‡å°‘97.5%</strong></td>
</tr>
<tr>
<td><strong>GCåœé¡¿æ—¶é—´</strong></td>
<td><strong>&lt;10ms</strong></td>
<td>200ms+</td>
<td><strong>å‡å°‘95%</strong></td>
</tr>
</tbody></table>
<h1 id="å…­ã€ç³»ç»Ÿé›†æˆä¸éƒ¨ç½²"><a href="#å…­ã€ç³»ç»Ÿé›†æˆä¸éƒ¨ç½²" class="headerlink" title="å…­ã€ç³»ç»Ÿé›†æˆä¸éƒ¨ç½²"></a>å…­ã€ç³»ç»Ÿé›†æˆä¸éƒ¨ç½²</h1><h2 id="6-1-Mavenä¾èµ–é…ç½®"><a href="#6-1-Mavenä¾èµ–é…ç½®" class="headerlink" title="6.1 Mavenä¾èµ–é…ç½®"></a>6.1 Mavenä¾èµ–é…ç½®</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- RoaringBitmapæ ¸å¿ƒä¾èµ– --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.roaringbitmap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>RoaringBitmap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>0.9.32<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- Spring Boot Starter --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!-- Redisé›†ç¾¤æ”¯æŒ --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="6-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#6-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="6.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>6.2 åº”ç”¨é…ç½®æ–‡ä»¶</h2><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># application.yml</span>
<span class="token key atrule">blacklist</span><span class="token punctuation">:</span>
  <span class="token key atrule">roaring-bitmap</span><span class="token punctuation">:</span>
    <span class="token comment"># åˆå§‹åŒ–å®¹é‡</span>
    <span class="token key atrule">init-capacity</span><span class="token punctuation">:</span> <span class="token number">1000</span>
    <span class="token comment"># è´Ÿè½½å› å­</span>
    <span class="token key atrule">load-factor</span><span class="token punctuation">:</span> <span class="token number">0.5</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨æœ¬åœ°ç¼“å­˜</span>
    <span class="token key atrule">enable-local-cache</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># ç¼“å­˜åŒæ­¥é—´éš”(ç§’)</span>
    <span class="token key atrule">sync-interval</span><span class="token punctuation">:</span> <span class="token number">60</span>
    <span class="token comment"># ç‰ˆæœ¬æ ¡éªŒé—´éš”(ç§’)</span>
    <span class="token key atrule">version-check-interval</span><span class="token punctuation">:</span> <span class="token number">30</span>
    
<span class="token key atrule">redis</span><span class="token punctuation">:</span>
  <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 192.168.1.10<span class="token punctuation">:</span><span class="token number">7000</span>
      <span class="token punctuation">-</span> 192.168.1.10<span class="token punctuation">:</span><span class="token number">7001</span>
      <span class="token punctuation">-</span> 192.168.1.11<span class="token punctuation">:</span><span class="token number">7000</span>
      <span class="token punctuation">-</span> 192.168.1.11<span class="token punctuation">:</span><span class="token number">7001</span>
      <span class="token punctuation">-</span> 192.168.1.12<span class="token punctuation">:</span><span class="token number">7000</span>
      <span class="token punctuation">-</span> 192.168.1.12<span class="token punctuation">:</span><span class="token number">7001</span>
    <span class="token key atrule">max-redirects</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>
  <span class="token key atrule">pool</span><span class="token punctuation">:</span>
    <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="6-3-é»‘åå•æœåŠ¡å°è£…"><a href="#6-3-é»‘åå•æœåŠ¡å°è£…" class="headerlink" title="6.3 é»‘åå•æœåŠ¡å°è£…"></a>6.3 é»‘åå•æœåŠ¡å°è£…</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlacklistCacheService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RoaringBitMapPhoneCache</span> localCache<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">BlacklistCacheService</span><span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> redisTemplate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate <span class="token operator">=</span> redisTemplate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>localCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RoaringBitMapPhoneCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆå§‹åŒ–æœ¬åœ°ç¼“å­˜</span>
        <span class="token function">initLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦åœ¨é»‘åå•ä¸­
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isBlacklisted</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. å…ˆæŸ¥æœ¬åœ°ç¼“å­˜</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>localCache<span class="token punctuation">.</span><span class="token function">containsPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// 2. æœ¬åœ°ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢Redis</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">"blacklist:"</span> <span class="token operator">+</span> phone<span class="token punctuation">;</span>
        <span class="token class-name">Boolean</span> exists <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exists<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// æ›´æ–°æœ¬åœ°ç¼“å­˜</span>
            localCache<span class="token punctuation">.</span><span class="token function">putPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * æ‰¹é‡æ£€æŸ¥æ‰‹æœºå·
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token function">filterBlacklisted</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> phones<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> phones<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">isBlacklisted</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * æ·»åŠ æ‰‹æœºå·åˆ°é»‘åå•
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToBlacklist</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. æ›´æ–°Redis</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">"blacklist:"</span> <span class="token operator">+</span> phone<span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2. æ›´æ–°æœ¬åœ°ç¼“å­˜</span>
        localCache<span class="token punctuation">.</span><span class="token function">putPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3. æ›´æ–°ç‰ˆæœ¬å·</span>
        <span class="token function">updateVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * ä»é»‘åå•ç§»é™¤æ‰‹æœºå·
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeFromBlacklist</span><span class="token punctuation">(</span><span class="token class-name">Long</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. ä» Redis ç§»é™¤</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">"blacklist:"</span> <span class="token operator">+</span> phone<span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2. é‡æ–°åŠ è½½æœ¬åœ°ç¼“å­˜ï¼ˆç®€åŒ–å¤„ç†ï¼‰</span>
        <span class="token function">reloadLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3. æ›´æ–°ç‰ˆæœ¬å·</span>
        <span class="token function">updateVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * åˆå§‹åŒ–æœ¬åœ°ç¼“å­˜
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹åˆå§‹åŒ–æœ¬åœ°é»‘åå•ç¼“å­˜..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ä»æ•°æ®åº“æ‰¹é‡åŠ è½½é»‘åå•æ•°æ®</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> blacklistPhones <span class="token operator">=</span> blacklistDao<span class="token punctuation">.</span><span class="token function">getAllBlacklistPhones</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        blacklistPhones<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>localCache<span class="token operator">::</span><span class="token function">putPhone</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æœ¬åœ°é»‘åå•ç¼“å­˜åˆå§‹åŒ–å®Œæˆï¼Œå…±åŠ è½½ &#123;&#125; æ¡æ•°æ®"</span><span class="token punctuation">,</span> localCache<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * æ›´æ–°ç‰ˆæœ¬å·
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Long</span> newVersion <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"blacklist:version"</span><span class="token punctuation">,</span> newVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>
        localCache<span class="token punctuation">.</span><span class="token function">setLocalVersion</span><span class="token punctuation">(</span>newVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * é‡æ–°åŠ è½½æœ¬åœ°ç¼“å­˜
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">reloadLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        localCache<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initLocalCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="6-4-æ•°æ®åŒæ­¥æœºåˆ¶"><a href="#6-4-æ•°æ®åŒæ­¥æœºåˆ¶" class="headerlink" title="6.4 æ•°æ®åŒæ­¥æœºåˆ¶"></a>6.4 æ•°æ®åŒæ­¥æœºåˆ¶</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlacklistSyncTask</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BlacklistCacheService</span> cacheService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BlacklistDao</span> blacklistDao<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * å®šæ—¶åŒæ­¥ä»»åŠ¡
     */</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>fixedDelay <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">)</span> <span class="token comment">// 60ç§’æ‰§è¡Œä¸€æ¬¡</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">syncBlacklistData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Long</span> currentVersion <span class="token operator">=</span> <span class="token function">getCurrentVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Long</span> localVersion <span class="token operator">=</span> cacheService<span class="token punctuation">.</span><span class="token function">getLocalVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>currentVersion <span class="token operator">></span> localVersion<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ£€æµ‹åˆ°æ•°æ®æ›´æ–°ï¼Œå½“å‰ç‰ˆæœ¬: &#123;&#125;, æœ¬åœ°ç‰ˆæœ¬: &#123;&#125;"</span><span class="token punctuation">,</span> 
                    currentVersion<span class="token punctuation">,</span> localVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// å¢é‡åŒæ­¥æ•°æ®</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> newPhones <span class="token operator">=</span> blacklistDao<span class="token punctuation">.</span><span class="token function">getPhonesSinceVersion</span><span class="token punctuation">(</span>localVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> phone <span class="token operator">:</span> newPhones<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    cacheService<span class="token punctuation">.</span><span class="token function">addToBlacklist</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                
                <span class="token comment">// æ›´æ–°æœ¬åœ°ç‰ˆæœ¬å·</span>
                cacheService<span class="token punctuation">.</span><span class="token function">setLocalVersion</span><span class="token punctuation">(</span>currentVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åŒæ­¥å®Œæˆï¼Œæ–°å¢ &#123;&#125; æ¡æ•°æ®"</span><span class="token punctuation">,</span> newPhones<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"é»‘åå•æ•°æ®åŒæ­¥å¤±è´¥"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">Long</span> <span class="token function">getCurrentVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> blacklistDao<span class="token punctuation">.</span><span class="token function">getCurrentVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸ƒã€æ€»ç»“ä¸å±•æœ›"><a href="#ä¸ƒã€æ€»ç»“ä¸å±•æœ›" class="headerlink" title="ä¸ƒã€æ€»ç»“ä¸å±•æœ›"></a>ä¸ƒã€æ€»ç»“ä¸å±•æœ›</h1><p>æœ¬æ–‡ä»‹ç»äº†åœ¨10ä¸‡TPSé«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä½¿ç”¨RoaringBitmapå®ç°2äº¿çº§é»‘åå•è¿‡æ»¤ç³»ç»Ÿçš„æŠ€æœ¯æ–¹æ¡ˆã€‚</p>
<h2 id="7-1-æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹"><a href="#7-1-æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹" class="headerlink" title="7.1 æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹"></a>7.1 æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹</h2><h3 id="7-1-1-æ€§èƒ½æå‡æ•ˆæœ"><a href="#7-1-1-æ€§èƒ½æå‡æ•ˆæœ" class="headerlink" title="7.1.1 æ€§èƒ½æå‡æ•ˆæœ"></a>7.1.1 æ€§èƒ½æå‡æ•ˆæœ</h3><table>
<thead>
<tr>
<th>æŠ€æœ¯æŒ‡æ ‡</th>
<th>ä¼ ç»Ÿæ–¹æ¡ˆ</th>
<th>RoaringBitmapæ–¹æ¡ˆ</th>
<th>æ”¹è¿›æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å†…å­˜å ç”¨</strong></td>
<td>4GB (HashMap)</td>
<td>48MB</td>
<td><strong>å‡å°‘98.8%</strong></td>
</tr>
<tr>
<td><strong>æŸ¥è¯¢TPS</strong></td>
<td>65,000</td>
<td>105,263</td>
<td><strong>æå‡62%</strong></td>
</tr>
<tr>
<td><strong>å¹³å‡å“åº”æ—¶é—´</strong></td>
<td>2.8ms</td>
<td>0.95ms</td>
<td><strong>æå‡66%</strong></td>
</tr>
<tr>
<td><strong>GCåœé¡¿æ—¶é—´</strong></td>
<td>200ms+</td>
<td>&lt;10ms</td>
<td><strong>å‡å°‘95%</strong></td>
</tr>
</tbody></table>
<h3 id="7-1-2-å…³é”®æŠ€æœ¯ç‰¹æ€§"><a href="#7-1-2-å…³é”®æŠ€æœ¯ç‰¹æ€§" class="headerlink" title="7.1.2 å…³é”®æŠ€æœ¯ç‰¹æ€§"></a>7.1.2 å…³é”®æŠ€æœ¯ç‰¹æ€§</h3><div class="note success no-icon flat"><ul>
<li><strong>æ™ºèƒ½å‹ç¼©</strong>ï¼šè‡ªé€‚åº”é€‰æ‹©æœ€ä¼˜å­˜å‚¨ç»“æ„ï¼ˆArrayContainer&#x2F;BitmapContainer&#x2F;RunContainerï¼‰ï¼Œå®ç°99.88%å‹ç¼©ç‡</li>
<li><strong>æ‰‹æœºå·åˆ†å‰²</strong>ï¼š9ä½åˆ†å‰²ç­–ç•¥åˆ©ç”¨å·æ®µå±€éƒ¨æ€§ï¼Œæé«˜å‹ç¼©æ•ˆç‡å’ŒæŸ¥è¯¢æ€§èƒ½</li>
<li><strong>å¹¶å‘ä¼˜åŒ–</strong>ï¼šè¯»å†™é”åˆ†ç¦»ï¼Œæ”¯æŒé«˜å¹¶å‘è¯»æ“ä½œï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>åˆ†ç‰‡å­˜å‚¨</strong>ï¼šåŸºäºè¿è¥å•†å·æ®µçš„åˆ†ç‰‡ç­–ç•¥ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•</li>
</ul>
</div>

<h2 id="7-2-åº”ç”¨ä»·å€¼"><a href="#7-2-åº”ç”¨ä»·å€¼" class="headerlink" title="7.2 åº”ç”¨ä»·å€¼"></a>7.2 åº”ç”¨ä»·å€¼</h2><p>é€šè¿‡RoaringBitmapçš„æˆåŠŸå®è·µï¼Œåœ¨2äº¿çº§æ•°æ®è§„æ¨¡ä¸‹å®ç°äº†æè‡´çš„å†…å­˜å‹ç¼©å’Œé«˜æ€§èƒ½æŸ¥è¯¢ã€‚è¯¥æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>é™ä½75%ç¡¬ä»¶æˆæœ¬</strong>ï¼šå†…å­˜ä»32GBé™è‡³8GB</li>
<li><strong>TPSæå‡62%</strong>ï¼šä»6.5ä¸‡æå‡10.5ä¸‡</li>
<li><strong>å“åº”æ—¶é—´ä¼˜å‡66%</strong>ï¼šä»2.8msé™è‡³0.95ms</li>
<li><strong>GCåœé¡¿å‡å°‘95%</strong>ï¼šä»200ms+é™è‡³&lt;10ms</li>
</ul>
<p>ä¸ºå¤§è§„æ¨¡æ•°æ®è¿‡æ»¤åœºæ™¯æä¾›äº†å¯å¤åˆ¶çš„é«˜æ€§èƒ½æŠ€æœ¯æ–¹æ¡ˆã€‚ </p>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é«˜å¹¶å‘</tag>
        <tag>10ä¸‡TPS</tag>
        <tag>æ€§èƒ½ä¼˜åŒ–</tag>
        <tag>é»‘åå•è¿‡æ»¤</tag>
        <tag>RoaringBitmap</tag>
      </tags>
  </entry>
  <entry>
    <title>10ä¸‡TPSçº§æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°æ¶æ„è®¾è®¡ä¸é¡¹ç›®è½åœ°å®è·µ</title>
    <url>/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>é¡¹ç›®éœ€è¦è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°ï¼Œå®ç°ä¸šåŠ¡æ¶ˆæ¯å‘é€å®‰å…¨ç®¡æ§ã€‚ä¸šåŠ¡è¦æ±‚æ‰€æœ‰ä¸‹å‘å†…å®¹éœ€è¦è°ƒç”¨å®‰å…¨ç®¡æ§å¹³å°å®‰å…¨å®¡æ ¸æ¥å£è¿›è¡Œå®‰å…¨å®¡æ ¸ï¼Œæ ¹æ®ç®¡æ§ç­–ç•¥è¿›è¡Œæ”¾é€šã€æ‹¦æˆªåŠäººå·¥å®¡æ ¸ã€‚ç›®å‰çº¿ä¸Šæ—¥å‘é€é‡å³°å€¼ä¸º30äº¿æ¡å·¦å³ï¼Œå‘é€å¹³å‡é€Ÿåº¦ä¸º3.47ä¸‡æ¡&#x2F;ç§’,æ¶ˆæ¯å‘é€ç®¡æ§å¹³å°æ¥å£çš„TPSéœ€è¦è¾¾åˆ°10ä¸‡çº§åˆ«ã€‚</p>
<h2 id="1-1-ç®¡æ§ç­–ç•¥"><a href="#1-1-ç®¡æ§ç­–ç•¥" class="headerlink" title="1.1 ç®¡æ§ç­–ç•¥"></a>1.1 ç®¡æ§ç­–ç•¥</h2><p>åŸºäºä¸šåŠ¡éœ€æ±‚ç®¡æ§å¹³å°æä¾›ç®¡æ§èƒ½åŠ›åŠç®¡æ§ç­–ç•¥é…ç½®ï¼Œå¹³å°éƒ¨åˆ†ç®¡æ§åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¶ˆæ¯å‘é€é¢‘æ¬¡ç®¡æ§</li>
<li>é‡å¤å†…å®¹å‘é€ç®¡æ§</li>
<li>å…³é”®å­—åŒ¹é…è¿‡æ»¤</li>
<li>å‘é€é»‘åå•è¿‡æ»¤</li>
</ul>
<h1 id="äºŒã€æ¶æ„è®¾è®¡"><a href="#äºŒã€æ¶æ„è®¾è®¡" class="headerlink" title="äºŒã€æ¶æ„è®¾è®¡"></a>äºŒã€æ¶æ„è®¾è®¡</h1><p>æ ¹æ®ä¸šåŠ¡ç³»ç»Ÿè¦æ±‚ï¼Œç®¡æ§å¹³å°å®‰å…¨å®¡æ ¸æ¥å£éœ€è¦å®ç°10ä¸‡tpsï¼Œè¯·æ±‚å¤„ç†è€—æ—¶åœ¨50msä»¥å†…ã€‚</p>
<h2 id="2-1-ä¸šåŠ¡æ¶æ„å›¾"><a href="#2-1-ä¸šåŠ¡æ¶æ„å›¾" class="headerlink" title="2.1 ä¸šåŠ¡æ¶æ„å›¾"></a>2.1 ä¸šåŠ¡æ¶æ„å›¾</h2><p><img src="/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0%E4%B8%9A%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="ä¸šåŠ¡æ¶æ„å›¾"><br>å®‰å…¨ç®¡æ§å¹³å°ä¸šåŠ¡æ¶æ„è¾ƒä¸ºç®€å•ï¼ŒåŒ…å«3ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š</p>
<ul>
<li><strong>ç®¡æ§åå°</strong>ï¼šç”¨äºç®¡ç†ç®¡æ§ç›¸å…³æ•°æ®åŠæŸ¥çœ‹ã€å®¡æ ¸è¢«ç®¡æ§çš„æ¶ˆæ¯è®°å½•</li>
<li><strong>ç½‘ç®¡ç®¡æ§API</strong>ï¼šæä¾›ç»Ÿä¸€å®‰å…¨ç®¡æ§æ¥å£ï¼Œæ ¹æ®å¹³å°çš„ç®¡æ§ç­–ç•¥è¦æ±‚ï¼Œå¯¹ä¸‹å‘æ¶ˆæ¯è¿›è¡Œå®¡æ ¸ç®¡æ§</li>
<li><strong>å®¡æ ¸å›è°ƒ</strong>ï¼šç”¨äºå‘ä¸šåŠ¡å¹³å°æ¨é€äººå·¥å®¡æ ¸ç»“æœåŠç›¸å…³å˜æ›´æ•°æ®</li>
</ul>
<h2 id="2-2-éƒ¨ç½²æ¶æ„å›¾"><a href="#2-2-éƒ¨ç½²æ¶æ„å›¾" class="headerlink" title="2.2 éƒ¨ç½²æ¶æ„å›¾"></a>2.2 éƒ¨ç½²æ¶æ„å›¾</h2><p><img src="/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/%E7%AE%A1%E6%8E%A7%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="éƒ¨ç½²æ¶æ„å›¾"><br>ä¸Šå›¾ä¸ºç®¡æ§å¹³å°çš„éƒ¨ç½²æ¶æ„å›¾ï¼ŒRedisé›†ç¾¤å’ŒMySQLæ•°æ®åº“ä½¿ç”¨åä¸ºäº‘çš„æœåŠ¡ï¼Œåº”ç”¨æ¨¡å—å‡å®ç°é›†ç¾¤åŒ–éƒ¨ç½²ï¼š</p>
<ul>
<li><strong>ç®¡æ§åå°</strong>ï¼šåŸºäºRediså®ç°åˆ†å¸ƒå¼Sessionï¼Œé‡‡ç”¨é›†ç¾¤åŒ–éƒ¨ç½²æ–¹å¼ï¼Œå¹¶é€šè¿‡ELBè´Ÿè½½å‡è¡¡å®ç°é«˜å¯ç”¨</li>
<li><strong>ç½‘ç®¡ç®¡æ§API</strong>ï¼šé‡‡ç”¨é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œé€šè¿‡ELBè¿›è¡Œè´Ÿè½½å‡è¡¡ï¼›é»˜è®¤é›†ç¾¤ä¸º15ä¸ªèŠ‚ç‚¹ï¼Œæ”¯æŒ10ä¸‡TPS</li>
<li><strong>å®¡æ ¸å›è°ƒ</strong>ï¼šåŸºäºRediså®ç°åˆ†å¸ƒå¼é”ï¼Œé‡‡ç”¨é›†ç¾¤åŒ–éƒ¨ç½²å®ç°å®¡æ ¸å›è°ƒé«˜å¯ç”¨</li>
</ul>
<h1 id="ä¸‰ã€æœåŠ¡å™¨è§„æ ¼"><a href="#ä¸‰ã€æœåŠ¡å™¨è§„æ ¼" class="headerlink" title="ä¸‰ã€æœåŠ¡å™¨è§„æ ¼"></a>ä¸‰ã€æœåŠ¡å™¨è§„æ ¼</h1><p>å†…å®¹ç®¡æ§å¹³å°ä½¿ç”¨å®¹å™¨åŒ–éƒ¨ç½²æ–¹å¼éƒ¨ç½²åœ¨åä¸ºäº‘ä¸Šï¼Œä½¿ç”¨çš„æœåŠ¡å™¨è§„æ ¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>åº”ç”¨åç§°</th>
<th>æœåŠ¡å™¨è§„æ ¼</th>
<th>æ•°é‡</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>ç®¡æ§åå°</td>
<td>8æ ¸&#x2F;16GB&#x2F;ç£ç›˜ 500G</td>
<td>2</td>
<td>é›†ç¾¤éƒ¨ç½²</td>
</tr>
<tr>
<td>ç®¡æ§æœåŠ¡API</td>
<td>16æ ¸&#x2F;32GB&#x2F;ç£ç›˜é«˜IO 500G</td>
<td>15</td>
<td>é›†ç¾¤éƒ¨ç½²</td>
</tr>
<tr>
<td>MySQLæ•°æ®åº“</td>
<td>16æ ¸&#x2F;32GB&#x2F;ç£ç›˜è¶…é«˜IO 1TB</td>
<td>2</td>
<td>ä¸»ä»</td>
</tr>
<tr>
<td>Redisé›†ç¾¤</td>
<td>256G&#x2F;32åˆ†ç‰‡</td>
<td>32</td>
<td>åä¸ºäº‘Redisé›†ç¾¤</td>
</tr>
<tr>
<td>å¼¹æ€§è´Ÿè½½å‡è¡¡</td>
<td>ä¸­å‹II&#x2F;500Må¸¦å®½</td>
<td>1</td>
<td>åä¸ºäº‘ELB</td>
</tr>
</tbody></table>
<h2 id="3-1-Redisé›†ç¾¤è§„æ ¼"><a href="#3-1-Redisé›†ç¾¤è§„æ ¼" class="headerlink" title="3.1 Redisé›†ç¾¤è§„æ ¼"></a>3.1 Redisé›†ç¾¤è§„æ ¼</h2><p><font color="red">è¯´æ˜ï¼šåŸRedisä½¿ç”¨ä¸»å¤‡å®ä¾‹64Gå†…å­˜è§„æ ¼ï¼Œä½†æ˜¯ç”±äºæ¯æ¬¡è¯·æ±‚è‡³å°‘è®¿é—®2æ¬¡Redisï¼Œåœ¨10ä¸‡TPSæƒ…å†µä¸‹ï¼ŒRedisæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥è°ƒæ•´ä¸ºRedisé›†ç¾¤ï¼Œè¯¦ç»†è¯´æ˜è§åç»­æ–‡æ¡£ã€‚</font><br><img src="/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/redis%E9%9B%86%E7%BE%A4%E8%A7%84%E6%A0%BC.png" alt="Redisé›†ç¾¤è§„æ ¼"></p>
<h2 id="3-2-å¼¹æ€§è´Ÿè½½å‡è¡¡è§„æ ¼"><a href="#3-2-å¼¹æ€§è´Ÿè½½å‡è¡¡è§„æ ¼" class="headerlink" title="3.2 å¼¹æ€§è´Ÿè½½å‡è¡¡è§„æ ¼"></a>3.2 å¼¹æ€§è´Ÿè½½å‡è¡¡è§„æ ¼</h2><p><font color="red">è¯´æ˜ï¼š åä¸ºäº‘ELBï¼ˆå¼¹æ€§è´Ÿè½½å‡è¡¡ï¼‰ä¸­å‹IIé»˜è®¤å¸¦å®½ä¸º400Mï¼Œç®¡æ§æœåŠ¡httpè¯·æ±‚TPSåˆ°è¾¾10Wåå¸¦å®½å°†çªç ´500Mï¼Œéœ€è¦è”ç³»ç®¡ç†å‘˜å¢åŠ å¸¦å®½è‡³500Mä»¥ä¸Šã€‚</font><br><img src="/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/elb%E8%A7%84%E6%A0%BC.png" alt="elbè§„æ ¼"></p>
<h1 id="å››ã€æ€§èƒ½å‹æµ‹"><a href="#å››ã€æ€§èƒ½å‹æµ‹" class="headerlink" title="å››ã€æ€§èƒ½å‹æµ‹"></a>å››ã€æ€§èƒ½å‹æµ‹</h1><p><font color="red">è¯´æ˜ï¼šæœ¬æˆªå›¾ä¸º4000å¹¶å‘ä¸‹çš„å‹æµ‹ç»“æœï¼Œå°†å¹¶å‘è®¾ç½®ä¸º5000åTPSå¯ä»¥è¾¾åˆ°10Wã€‚ç”±äºå‹æµ‹å®¢æˆ·ç«¯è®¾ç½®çš„æœ€å¤§å¹¶å‘ä¸º10Wï¼Œæ‰€ä»¥å‹æµ‹ç»“æœçš„æœ€å¤§å€¼ä¸ä¼šè¶…è¿‡10Wã€‚</font><br><img src="/2024/06/01/high-concurrency/10-wan-tps-ji-gao-bing-fa-xi-tong-jia-gou-she-ji-yu-xiang-mu-luo-di-shi-jian/%E5%8E%8B%E6%B5%8B%E7%BB%93%E6%9E%9C.jpg" alt="å‹æµ‹ç»“æœ"></p>
]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>é«˜å¹¶å‘</tag>
        <tag>10ä¸‡TPS</tag>
        <tag>æ¶æ„è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨çš„å…³é”®å­—åŒ¹é…ç®—æ³•</title>
    <url>/2024/06/21/high-concurrency/chang-yong-de-guan-jian-zi-pi-pei-suan-fa/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><h1 id="äºŒã€å¸¸ç”¨ç®—æ³•"><a href="#äºŒã€å¸¸ç”¨ç®—æ³•" class="headerlink" title="äºŒã€å¸¸ç”¨ç®—æ³•"></a>äºŒã€å¸¸ç”¨ç®—æ³•</h1><h2 id="2-1-æš´åŠ›åŒ¹é…ç®—æ³•ï¼ˆBrute-Forceï¼‰"><a href="#2-1-æš´åŠ›åŒ¹é…ç®—æ³•ï¼ˆBrute-Forceï¼‰" class="headerlink" title="2.1. æš´åŠ›åŒ¹é…ç®—æ³•ï¼ˆBrute Forceï¼‰"></a>2.1. æš´åŠ›åŒ¹é…ç®—æ³•ï¼ˆBrute Forceï¼‰</h2><p>ä»æ–‡æœ¬çš„æ¯ä¸€ä¸ªå¯èƒ½çš„èµ·å§‹ä½ç½®å¼€å§‹ï¼Œé€ä¸ªå­—ç¬¦åœ°ä¸æ¨¡å¼ä¸²è¿›è¡Œæ¯”è¾ƒã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>ç®€å•æ˜“æ‡‚ï¼Œå®¹æ˜“å®ç°ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>æ•ˆç‡ä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(m * n)ï¼Œå…¶ä¸­mä¸ºæ¨¡å¼ä¸²é•¿åº¦ï¼Œnä¸ºæ–‡æœ¬é•¿åº¦ã€‚</li>
<li>ä¸é€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œé•¿æ¨¡å¼ä¸²ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>å°è§„æ¨¡æ•°æ®æˆ–è€…æ¨¡å¼ä¸²è¾ƒçŸ­çš„ç®€å•åŒ¹é…åœºæ™¯ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>åœ¨è§„æ¨¡è¾ƒå°çš„æƒ…å†µä¸‹èƒ½å¤Ÿå·¥ä½œï¼Œä½†éšç€æ•°æ®è§„æ¨¡å¢å¤§ï¼Œæ€§èƒ½è¿…é€Ÿä¸‹é™ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-2-KMPç®—æ³•ï¼ˆKnuth-Morris-Prattç®—æ³•ï¼‰"><a href="#2-2-KMPç®—æ³•ï¼ˆKnuth-Morris-Prattç®—æ³•ï¼‰" class="headerlink" title="2.2. KMPç®—æ³•ï¼ˆKnuth-Morris-Prattç®—æ³•ï¼‰"></a>2.2. KMPç®—æ³•ï¼ˆKnuth-Morris-Prattç®—æ³•ï¼‰</h2><p> åˆ©ç”¨å‰ç¼€å‡½æ•°ï¼ˆpartial match tableï¼‰é¿å…å¯¹å·²åŒ¹é…éƒ¨åˆ†çš„é‡å¤æ¯”è¾ƒï¼Œå®ç°è·³è·ƒå¼çš„åŒ¹é…ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>æ—¶é—´å¤æ‚åº¦ä¸ºO(m + n)ï¼Œå…¶ä¸­mä¸ºæ¨¡å¼ä¸²é•¿åº¦ï¼Œnä¸ºæ–‡æœ¬é•¿åº¦ã€‚</li>
<li>é€‚ç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œé•¿æ¨¡å¼ä¸²ï¼Œæ€§èƒ½ç¨³å®šã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>ç®—æ³•å®ç°ç¨å¤æ‚ï¼Œéœ€è¦æ„å»ºå’Œç†è§£å‰ç¼€å‡½æ•°ã€‚</li>
<li>åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œæ€§èƒ½å¯èƒ½ä¸å¦‚Boyer-Mooreç®—æ³•ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>éœ€è¦å¤„ç†é•¿æ¨¡å¼ä¸²æˆ–è€…å¤§é‡æ•°æ®çš„å­—ç¬¦ä¸²åŒ¹é…ä»»åŠ¡ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>å¯¹äºå¤§è§„æ¨¡æ•°æ®å’Œé•¿æ¨¡å¼ä¸²æœ‰è¾ƒå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œå¸¸ç”¨äºå®é™…åº”ç”¨ä¸­ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-3-Boyer-Mooreç®—æ³•"><a href="#2-3-Boyer-Mooreç®—æ³•" class="headerlink" title="2.3. Boyer-Mooreç®—æ³•"></a>2.3. Boyer-Mooreç®—æ³•</h2><p>åˆ©ç”¨åå­—ç¬¦è§„åˆ™ï¼ˆbad character ruleï¼‰å’Œå¥½åç¼€è§„åˆ™ï¼ˆgood suffix ruleï¼‰ï¼Œå®ç°å¿«é€Ÿè·³è·ƒåŒ¹é…ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>åœ¨å®è·µä¸­é€šå¸¸æ¯”KMPç®—æ³•æ•ˆç‡æ›´é«˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œé•¿æ¨¡å¼ä¸²æ—¶ã€‚</li>
<li>å¯ä»¥é€šè¿‡é¢„å¤„ç†æå‰å‡å°‘åŒ¹é…æ—¶é—´ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>å®ç°å¤æ‚åº¦ç•¥é«˜äºKMPç®—æ³•ï¼Œéœ€è¦ç†è§£å’Œå®ç°åå­—ç¬¦å’Œå¥½åç¼€è§„åˆ™ã€‚</li>
<li>åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œæ€§èƒ½å¯èƒ½ä¸å¦‚ACè‡ªåŠ¨æœºã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>å¤„ç†é•¿æ¨¡å¼ä¸²å’Œå¤§è§„æ¨¡æ•°æ®ï¼Œå°¤å…¶é€‚ç”¨äºå¤šæ¬¡åŒ¹é…çš„æƒ…å†µã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸èƒ½æä¾›è¾ƒå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å¼ä¸²ç›¸å¯¹è¾ƒé•¿æ—¶ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-4-Trieæ ‘"><a href="#2-4-Trieæ ‘" class="headerlink" title="2.4. Trieæ ‘"></a>2.4. Trieæ ‘</h2><p>é€šè¿‡å…±äº«ç›¸åŒå‰ç¼€æ¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå¹¶æ”¯æŒé«˜æ•ˆçš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>é«˜æ•ˆçš„æ’å…¥å’ŒæŸ¥æ‰¾æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(m)ï¼Œå…¶ä¸­mä¸ºå­—ç¬¦ä¸²é•¿åº¦ã€‚</li>
<li>æ”¯æŒå‰ç¼€åŒ¹é…ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ‰¾å‡ºå…·æœ‰ç›¸åŒå‰ç¼€çš„æ‰€æœ‰å­—ç¬¦ä¸²ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>å¯¹å­˜å‚¨ç©ºé—´çš„æ¶ˆè€—è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯å¤„ç†å¤§é‡é•¿å­—ç¬¦ä¸²æ—¶ã€‚</li>
<li>æ’å…¥é¡ºåºå¯èƒ½å½±å“æ ‘çš„ç»“æ„ï¼Œå¯¼è‡´æ€§èƒ½æ³¢åŠ¨ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>éœ€è¦å¿«é€Ÿå­˜å‚¨å’Œæ£€ç´¢å­—ç¬¦ä¸²é›†åˆçš„åº”ç”¨ï¼Œå¦‚å­—å…¸ã€è‡ªåŠ¨å®Œæˆã€æ‹¼å†™æ£€æŸ¥ç­‰ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>åœ¨å¤„ç†å­—ç¬¦ä¸²é›†åˆå’Œå‰ç¼€åŒ¹é…ä»»åŠ¡æ—¶ï¼Œèƒ½å¤Ÿæä¾›ç¨³å®šå’Œé«˜æ•ˆçš„æ€§èƒ½è¡¨ç°ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-5-åŒæ•°ç»„Trieï¼ˆDouble-Array-Trieï¼ŒDATï¼‰"><a href="#2-5-åŒæ•°ç»„Trieï¼ˆDouble-Array-Trieï¼ŒDATï¼‰" class="headerlink" title="2.5. åŒæ•°ç»„Trieï¼ˆDouble-Array Trieï¼ŒDATï¼‰"></a>2.5. åŒæ•°ç»„Trieï¼ˆDouble-Array Trieï¼ŒDATï¼‰</h2><p>åŒæ•°ç»„Trieæ˜¯å¯¹ä¼ ç»ŸTrieæ ‘çš„æ”¹è¿›ï¼Œé€šè¿‡ä¸¤ä¸ªæ•°ç»„ï¼ˆBaseæ•°ç»„å’ŒCheckæ•°ç»„ï¼‰æ¥ä»£æ›¿èŠ‚ç‚¹çš„æŒ‡é’ˆç»“æ„ï¼Œå®ç°çŠ¶æ€çš„ç´§å‡‘å­˜å‚¨å’Œé«˜æ•ˆæŸ¥è¯¢ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>æ˜¾è‘—å‡å°‘äº†å†…å­˜æ¶ˆè€—ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„Trieæ ‘æœ‰æ›´å¥½çš„ç©ºé—´æ•ˆç‡ã€‚</li>
<li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šè¿‡æ•°ç»„ç´¢å¼•ç›´æ¥è®¿é—®çŠ¶æ€ï¼Œå‡å°‘äº†æŒ‡é’ˆè·³è½¬å’Œå†…å­˜è®¿é—®çš„å¼€é”€ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>å®ç°ç¨å¤æ‚ï¼Œéœ€è¦ç†è§£å’Œå¤„ç†Baseæ•°ç»„å’ŒCheckæ•°ç»„çš„æ„å»ºã€‚</li>
<li>å¯¹äºåŠ¨æ€æ’å…¥å’Œåˆ é™¤æ“ä½œä¸å¤ªå‹å¥½ï¼Œå› ä¸ºéœ€è¦é‡æ–°æ„å»ºæ•°ç»„ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>éœ€è¦é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥è¯¢å¤§è§„æ¨¡å­—ç¬¦ä¸²é›†åˆçš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯éœ€è¦é¢‘ç¹è¿›è¡Œå‰ç¼€åŒ¹é…æˆ–è€…å®Œå…¨åŒ¹é…çš„åº”ç”¨ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>åœ¨å¤§è§„æ¨¡æ•°æ®å’Œé•¿å­—ç¬¦ä¸²çš„å­˜å‚¨å’ŒæŸ¥è¯¢ä¸­ï¼ŒåŒæ•°ç»„Trieèƒ½å¤Ÿæ˜¾è‘—æå‡æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å­˜ä½¿ç”¨å’ŒæŸ¥è¯¢é€Ÿåº¦ä¸Šã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-6-ACè‡ªåŠ¨æœºï¼ˆAho-Corasickè‡ªåŠ¨æœºï¼‰"><a href="#2-6-ACè‡ªåŠ¨æœºï¼ˆAho-Corasickè‡ªåŠ¨æœºï¼‰" class="headerlink" title="2.6. ACè‡ªåŠ¨æœºï¼ˆAho-Corasickè‡ªåŠ¨æœºï¼‰"></a>2.6. ACè‡ªåŠ¨æœºï¼ˆAho-Corasickè‡ªåŠ¨æœºï¼‰</h2><p>ACè‡ªåŠ¨æœºæ˜¯åŸºäºTrieæ ‘ç»“æ„å’ŒKMPç®—æ³•çš„æ‹“å±•ï¼Œæ—¨åœ¨é«˜æ•ˆå¤„ç†å¤šæ¨¡å¼åŒ¹é…é—®é¢˜ã€‚å®ƒé€šè¿‡æ„å»ºä¸€ä¸ªçŠ¶æ€è½¬ç§»å›¾ï¼ˆè‡ªåŠ¨æœºï¼‰æ¥åŒæ—¶åœ¨å¤šä¸ªæ¨¡å¼ä¸²ä¸­æŸ¥æ‰¾å‡ºç°ä½ç½®ã€‚</p>
<ul>
<li>ä¸»è¦åŒ…å«ä¸¤ä¸ªå…³é”®éƒ¨åˆ†ï¼š<ol>
<li>Trieæ ‘ï¼šç”¨äºå­˜å‚¨æ¨¡å¼ä¸²é›†åˆï¼Œå¹¶é€šè¿‡è¾¹è¡¨ç¤ºå­—ç¬¦è½¬ç§»ã€‚</li>
<li>å¤±è´¥æŒ‡é’ˆï¼ˆfailure linkï¼‰ï¼šç±»ä¼¼äºKMPç®—æ³•ä¸­çš„éƒ¨åˆ†åŒ¹é…è¡¨ï¼Œç”¨äºåœ¨åŒ¹é…å¤±è´¥æ—¶è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå¯èƒ½åŒ¹é…çš„çŠ¶æ€ã€‚</li>
</ol>
</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>èƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤§é‡æ¨¡å¼ä¸²çš„å¤šæ¨¡å¼åŒ¹é…é—®é¢˜ã€‚</li>
<li>æ”¯æŒåŠ¨æ€æ·»åŠ æ¨¡å¼ä¸²ï¼Œå¹¶ä¸”æ„å»ºä¸€æ¬¡åå¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚</li>
<li>æ—¶é—´å¤æ‚åº¦ä¸ºO(n + m + z)ï¼Œå…¶ä¸­nä¸ºæ–‡æœ¬é•¿åº¦ï¼Œmä¸ºæ‰€æœ‰æ¨¡å¼ä¸²é•¿åº¦æ€»å’Œï¼Œzä¸ºåŒ¹é…æ¬¡æ•°ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>å®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç†è§£å’Œæ„å»ºçŠ¶æ€è½¬ç§»å›¾ã€å¤±è´¥æŒ‡é’ˆç­‰ã€‚</li>
<li>ç©ºé—´å¤æ‚åº¦è¾ƒé«˜ï¼Œå°¤å…¶æ˜¯éšç€æ¨¡å¼ä¸²æ•°é‡çš„å¢åŠ ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>éœ€è¦åœ¨å¤§è§„æ¨¡æ–‡æœ¬ä¸­åŒæ—¶åŒ¹é…å¤šä¸ªæ¨¡å¼ä¸²çš„é«˜æ•ˆæœç´¢åº”ç”¨åœºæ™¯ï¼Œå¦‚å…³é”®å­—è¿‡æ»¤ã€æ–‡æœ¬æœç´¢å¼•æ“ã€ç½‘ç»œå®‰å…¨ç­‰é¢†åŸŸã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>åœ¨å¤„ç†å¤šæ¨¡å¼åŒ¹é…é—®é¢˜æ—¶ï¼ŒACè‡ªåŠ¨æœºé€šå¸¸èƒ½å¤Ÿæä¾›ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å¼ä¸²æ•°é‡è¾ƒå¤šæˆ–æ–‡æœ¬è§„æ¨¡è¾ƒå¤§æ—¶ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-7-åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº"><a href="#2-7-åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº" class="headerlink" title="2.7. åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº"></a>2.7. åŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœº</h2><p>ACè‡ªåŠ¨æœºåˆ©ç”¨åŒæ•°ç»„Trieä½œä¸ºå…¶åº•å±‚æ•°æ®ç»“æ„ï¼Œç»“åˆè‡ªåŠ¨æœºå’ŒKMPç®—æ³•çš„æ€æƒ³ï¼Œå®ç°åœ¨ä¸€ç»„æ–‡æœ¬ä¸­åŒæ—¶æŸ¥æ‰¾å¤šä¸ªæ¨¡å¼ä¸²ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼š<ul>
<li>ç»§æ‰¿äº†åŒæ•°ç»„Trieçš„ç©ºé—´å’ŒæŸ¥è¯¢æ•ˆç‡ä¼˜åŠ¿ã€‚</li>
<li>èƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤§é‡æ¨¡å¼ä¸²çš„å¤šæ¨¡å¼åŒ¹é…é—®é¢˜ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ æ¨¡å¼ä¸²ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹</strong>ï¼š<ul>
<li>å®ç°ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦æ„å»ºå’Œç†è§£ACè‡ªåŠ¨æœºçš„çŠ¶æ€è½¬ç§»å’Œå¤±è´¥æŒ‡é’ˆã€‚</li>
<li>ç©ºé—´å¤æ‚åº¦è¾ƒé«˜ï¼Œç‰¹åˆ«æ˜¯éšç€æ¨¡å¼ä¸²æ•°é‡å¢åŠ æ—¶ã€‚</li>
</ul>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>éœ€è¦åœ¨å¤§è§„æ¨¡æ–‡æœ¬ä¸­åŒæ—¶åŒ¹é…å¤šä¸ªæ¨¡å¼ä¸²çš„é«˜æ•ˆæœç´¢åº”ç”¨åœºæ™¯ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½è¡¨ç°</strong>ï¼š<ul>
<li>åœ¨å¤„ç†å¤šæ¨¡å¼åŒ¹é…é—®é¢˜æ—¶ï¼ŒåŸºäºåŒæ•°ç»„Trieçš„ACè‡ªåŠ¨æœºé€šå¸¸èƒ½å¤Ÿæä¾›ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¨¡å¼ä¸²è¾ƒå¤šæˆ–æ–‡æœ¬è¾ƒå¤§æ—¶ã€‚</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å…³é”®å­—åŒ¹é…</tag>
        <tag>ACè‡ªåŠ¨æœº</tag>
        <tag>åŒæ•°ç»„Trie</tag>
      </tags>
  </entry>
  <entry>
    <title>Baseç†è®ºä¸CAP</title>
    <url>/2024/05/25/java/base-li-lun-yu-cap/</url>
    <content><![CDATA[<h1 id="ä¸€ã€æ¦‚å¿µç®€ä»‹"><a href="#ä¸€ã€æ¦‚å¿µç®€ä»‹" class="headerlink" title="ä¸€ã€æ¦‚å¿µç®€ä»‹"></a>ä¸€ã€æ¦‚å¿µç®€ä»‹</h1><h2 id="1-1-Baseç†è®º"><a href="#1-1-Baseç†è®º" class="headerlink" title="1.1 Baseç†è®º"></a>1.1 Baseç†è®º</h2><p>BASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft-stateï¼ˆè½¯çŠ¶æ€ï¼‰ å’Œ Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§ C å’Œå¯ç”¨æ€§ A æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„æ€»ç»“ï¼Œæ˜¯åŸºäº CAP å®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ï¼Œå®ƒå¤§å¤§é™ä½äº†æˆ‘ä»¬å¯¹ç³»ç»Ÿçš„è¦æ±‚ã€‚</p>
<h2 id="1-2-CAPç†è®º"><a href="#1-2-CAPç†è®º" class="headerlink" title="1.2 CAPç†è®º"></a>1.2 CAPç†è®º</h2><p>CAP ä¹Ÿå°±æ˜¯ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ è¿™ä¸‰ä¸ªå•è¯é¦–å­—æ¯ç»„åˆã€‚</p>
<h1 id="äºŒã€Baseç†è®º"><a href="#äºŒã€Baseç†è®º" class="headerlink" title="äºŒã€Baseç†è®º"></a>äºŒã€Baseç†è®º</h1><blockquote>
<p>BASE ç†è®ºèµ·æºäº 2008 å¹´ï¼Œ ç”± eBay çš„æ¶æ„å¸ˆ Dan Pritchett åœ¨ ACM ä¸Šå‘è¡¨ã€‚</p>
</blockquote>
<h2 id="2-1-ç®€ä»‹"><a href="#2-1-ç®€ä»‹" class="headerlink" title="2.1 ç®€ä»‹"></a>2.1 ç®€ä»‹</h2><p>BASEæ˜¯â€œBasically Available, Soft state, Eventually consistent(åŸºæœ¬å¯ç”¨ã€è½¯çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´æ€§)â€çš„é¦–å­—æ¯ç¼©å†™ã€‚å…¶ä¸­çš„è½¯çŠ¶æ€å’Œæœ€ç»ˆä¸€è‡´æ€§è¿™ä¸¤ç§æŠ€å·§æ“…äºå¯¹ä»˜å­˜åœ¨åˆ†åŒºçš„åœºåˆï¼Œå¹¶å› æ­¤æé«˜äº†å¯ç”¨æ€§ã€‚</p>
<ul>
<li>Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</li>
<li>Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰è½¯çŠ¶æ€ä¹Ÿç§°ä¸ºå¼±çŠ¶æ€ï¼Œå’Œç¡¬çŠ¶æ€ç›¸å¯¹ï¼Œæ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</li>
<li>Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§</li>
</ul>
<p>BASEæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„ç»“è®ºï¼Œæ˜¯åŸºäºCAPå®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrong consistencyï¼‰ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å¯¹ CAP ä¸­ AP æ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……ã€‚å…¶åŸºæœ¬æ€è·¯å°±æ˜¯ï¼šé€šè¿‡ä¸šåŠ¡ï¼Œç‰ºç‰²å¼ºä¸€è‡´æ€§è€Œè·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æ˜¯æœ€ç»ˆè¾¾åˆ°ä¸€è‡´æ€§çŠ¶æ€ã€‚</p>
<h2 id="2-2-Baseç†è®ºçš„æ ¸å¿ƒæ€æƒ³"><a href="#2-2-Baseç†è®ºçš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="2.2 Baseç†è®ºçš„æ ¸å¿ƒæ€æƒ³"></a>2.2 Baseç†è®ºçš„æ ¸å¿ƒæ€æƒ³</h2><p>å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ä¹Ÿå°±æ˜¯ç‰ºç‰²æ•°æ®çš„ä¸€è‡´æ€§æ¥æ»¡è¶³ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œç³»ç»Ÿä¸­ä¸€éƒ¨åˆ†æ•°æ®ä¸å¯ç”¨æˆ–è€…ä¸ä¸€è‡´æ—¶ï¼Œä»éœ€è¦ä¿æŒç³»ç»Ÿæ•´ä½“â€œä¸»è¦å¯ç”¨â€ã€‚<br><strong>BASE ç†è®ºæœ¬è´¨ä¸Šæ˜¯å¯¹ CAP çš„å»¶ä¼¸å’Œè¡¥å……ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯å¯¹ CAP ä¸­ AP æ–¹æ¡ˆçš„ä¸€ä¸ªè¡¥å……ã€‚</strong></p>
<h3 id="ä¸ºä»€ä¹ˆè¿™æ ·è¯´ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™æ ·è¯´ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™æ ·è¯´ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™æ ·è¯´ï¼Ÿ</h3><p>CAP ç†è®ºè¿™èŠ‚æˆ‘ä»¬ä¹Ÿè¯´è¿‡äº†ï¼š</p>
<blockquote>
<p>å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼ŒèŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥é€šä¿¡æ­£å¸¸çš„è¯ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ P äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶ä¿è¯ C å’Œ A äº†ã€‚å› æ­¤ï¼Œå¦‚æœç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€ï¼Œæˆ‘ä»¬è¦è€ƒè™‘é€‰æ‹© CP è¿˜æ˜¯ APã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼Œæˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•ä¿è¯ CA ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼ŒAP æ–¹æ¡ˆåªæ˜¯åœ¨ç³»ç»Ÿå‘ç”Ÿåˆ†åŒºçš„æ—¶å€™æ”¾å¼ƒä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯æ°¸è¿œæ”¾å¼ƒä¸€è‡´æ€§ã€‚åœ¨åˆ†åŒºæ•…éšœæ¢å¤åï¼Œç³»ç»Ÿåº”è¯¥è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ä¸€ç‚¹å…¶å®å°±æ˜¯ BASE ç†è®ºå»¶ä¼¸çš„åœ°æ–¹ã€‚</p>
<h2 id="2-3-Baseç†è®ºä¸‰è¦ç´ "><a href="#2-3-Baseç†è®ºä¸‰è¦ç´ " class="headerlink" title="2.3 Baseç†è®ºä¸‰è¦ç´ "></a>2.3 Baseç†è®ºä¸‰è¦ç´ </h2><h3 id="åŸºæœ¬å¯ç”¨"><a href="#åŸºæœ¬å¯ç”¨" class="headerlink" title="åŸºæœ¬å¯ç”¨"></a>åŸºæœ¬å¯ç”¨</h3><p>åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ã€‚</p>
<h4 id="ä»€ä¹ˆå«å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§å‘¢ï¼Ÿ"><a href="#ä»€ä¹ˆå«å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§å‘¢ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆå«å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§å‘¢ï¼Ÿ"></a>ä»€ä¹ˆå«å…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§å‘¢ï¼Ÿ</h4><ul>
<li>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±: æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚éœ€è¦ 0.5s è¿”å›ç»“æœï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿå‡ºç°æ•…éšœï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´å˜ä¸º 3 sã€‚</li>
<li>ç³»ç»ŸåŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äºç³»ç»Ÿè®¿é—®é‡çªç„¶å‰§å¢ï¼Œç³»ç»Ÿçš„éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="è½¯çŠ¶æ€"><a href="#è½¯çŠ¶æ€" class="headerlink" title="è½¯çŠ¶æ€"></a>è½¯çŠ¶æ€</h3><p>è½¯çŠ¶æ€æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼ˆCAP ç†è®ºä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</p>
<h3 id="æœ€ç»ˆä¸€è‡´æ€§"><a href="#æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§"></a>æœ€ç»ˆä¸€è‡´æ€§</h3><p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚</p>
<h4 id="åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„-3-ç§çº§åˆ«"><a href="#åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„-3-ç§çº§åˆ«" class="headerlink" title="åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„ 3 ç§çº§åˆ«"></a>åˆ†å¸ƒå¼ä¸€è‡´æ€§çš„ 3 ç§çº§åˆ«</h4><ul>
<li>å¼ºä¸€è‡´æ€§ï¼šç³»ç»Ÿå†™å…¥äº†ä»€ä¹ˆï¼Œè¯»å‡ºæ¥çš„å°±æ˜¯ä»€ä¹ˆã€‚</li>
<li>å¼±ä¸€è‡´æ€§ï¼šä¸ä¸€å®šå¯ä»¥è¯»å–åˆ°æœ€æ–°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸ä¿è¯å¤šå°‘æ—¶é—´ä¹‹åè¯»å–åˆ°çš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Œåªæ˜¯ä¼šå°½é‡ä¿è¯æŸä¸ªæ—¶åˆ»è¾¾åˆ°æ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚</li>
<li>æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼±ä¸€è‡´æ€§çš„å‡çº§ç‰ˆï¼Œç³»ç»Ÿä¼šä¿è¯åœ¨ä¸€å®šæ—¶é—´å†…è¾¾åˆ°æ•°æ®ä¸€è‡´çš„çŠ¶æ€ã€‚</li>
</ul>
<p>ä¸šç•Œæ¯”è¾ƒæ¨å´‡æ˜¯æœ€ç»ˆä¸€è‡´æ€§çº§åˆ«ï¼Œä½†æ˜¯æŸäº›å¯¹æ•°æ®ä¸€è‡´è¦æ±‚ååˆ†ä¸¥æ ¼çš„åœºæ™¯æ¯”å¦‚é“¶è¡Œè½¬è´¦è¿˜æ˜¯è¦ä¿è¯å¼ºä¸€è‡´æ€§ã€‚</p>
<h4 id="æœ€ç»ˆä¸€è‡´æ€§å®ç°æ–¹å¼"><a href="#æœ€ç»ˆä¸€è‡´æ€§å®ç°æ–¹å¼" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§å®ç°æ–¹å¼"></a>æœ€ç»ˆä¸€è‡´æ€§å®ç°æ–¹å¼</h4><ul>
<li>è¯»æ—¶ä¿®å¤ : åœ¨è¯»å–æ•°æ®æ—¶ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´ï¼Œè¿›è¡Œä¿®å¤ã€‚æ¯”å¦‚ Cassandra çš„ Read Repair å®ç°ï¼Œå…·ä½“æ¥è¯´ï¼Œåœ¨å‘ Cassandra ç³»ç»ŸæŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœæ£€æµ‹åˆ°ä¸åŒèŠ‚ç‚¹çš„å‰¯æœ¬æ•°æ®ä¸ä¸€è‡´ï¼Œç³»ç»Ÿå°±è‡ªåŠ¨ä¿®å¤æ•°æ®ã€‚</li>
<li>å†™æ—¶ä¿®å¤ : åœ¨å†™å…¥æ•°æ®ï¼Œæ£€æµ‹æ•°æ®çš„ä¸ä¸€è‡´æ—¶ï¼Œè¿›è¡Œä¿®å¤ã€‚æ¯”å¦‚ Cassandra çš„ Hinted Handoff å®ç°ã€‚å…·ä½“æ¥è¯´ï¼ŒCassandra é›†ç¾¤çš„èŠ‚ç‚¹ä¹‹é—´è¿œç¨‹å†™æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå†™å¤±è´¥ å°±å°†æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œç„¶åå®šæ—¶é‡ä¼ ï¼Œä¿®å¤æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</li>
<li>å¼‚æ­¥ä¿®å¤ : è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œé€šè¿‡å®šæ—¶å¯¹è´¦æ£€æµ‹å‰¯æœ¬æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¿®å¤ã€‚</li>
</ul>
<p>æ¯”è¾ƒæ¨è å†™æ—¶ä¿®å¤ï¼Œè¿™ç§æ–¹å¼å¯¹æ€§èƒ½æ¶ˆè€—æ¯”è¾ƒä½ã€‚</p>
<h1 id="ä¸‰ã€CAPç†è®º"><a href="#ä¸‰ã€CAPç†è®º" class="headerlink" title="ä¸‰ã€CAPç†è®º"></a>ä¸‰ã€CAPç†è®º</h1><blockquote>
<p>CAP ç†è®º&#x2F;å®šç†open in new windowèµ·æºäº 2000 å¹´ï¼Œç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„ Eric Brewer æ•™æˆåœ¨åˆ†å¸ƒå¼è®¡ç®—åŸç†ç ”è®¨ä¼šï¼ˆPODCï¼‰ä¸Šæå‡ºï¼Œå› æ­¤ CAP å®šç†åˆè¢«ç§°ä½œ å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰ã€‚<br>2 å¹´åï¼Œéº»çœç†å·¥å­¦é™¢çš„ Seth Gilbert å’Œ Nancy Lynch å‘è¡¨äº†å¸ƒé²å°”çŒœæƒ³çš„è¯æ˜ï¼ŒCAP ç†è®ºæ­£å¼æˆä¸ºåˆ†å¸ƒå¼é¢†åŸŸçš„å®šç†ã€‚</p>
</blockquote>
<h2 id="3-1-ç®€ä»‹"><a href="#3-1-ç®€ä»‹" class="headerlink" title="3.1 ç®€ä»‹"></a>3.1 ç®€ä»‹</h2><p>CAP ä¹Ÿå°±æ˜¯ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ è¿™ä¸‰ä¸ªå•è¯é¦–å­—æ¯ç»„åˆã€‚<br><img src="/2024/05/25/java/base-li-lun-yu-cap/cap.png" alt="CAP"></p>
<p>åœ¨ç†è®ºè®¡ç®—æœºç§‘å­¦ä¸­ï¼ŒCAP å®šç†ï¼ˆCAP theoremï¼‰æŒ‡å‡ºå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå½“è®¾è®¡è¯»å†™æ“ä½œæ—¶ï¼Œåªèƒ½åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ä¸­çš„ä¸¤ä¸ªï¼š</p>
<ul>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ : æ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®å‰¯æœ¬</li>
<li>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰: éæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”ï¼ˆä¸æ˜¯é”™è¯¯æˆ–è€…è¶…æ—¶çš„å“åº”ï¼‰ã€‚</li>
<li>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition Toleranceï¼‰ : åˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æœåŠ¡ã€‚</li>
</ul>
<h3 id="ç½‘ç»œåˆ†åŒº"><a href="#ç½‘ç»œåˆ†åŒº" class="headerlink" title="ç½‘ç»œåˆ†åŒº"></a>ç½‘ç»œåˆ†åŒº</h3><p>ç½‘ç»œåˆ†åŒºåªåœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­ï¼ŒèŠ‚ç‚¹ä¹‹é—´ç”±äºç½‘ç»œä¸é€šï¼Œå¯¼è‡´é›†ç¾¤ä¸­èŠ‚ç‚¹å½¢æˆä¸åŒçš„å­é›†ï¼Œå­é›†ä¸­èŠ‚ç‚¹ä¹‹é—´ç½‘ç»œäº’é€šï¼Œè€Œå­é›†ä¸å­é›†ä¹‹é—´ç½‘ç»œä¸é€šã€‚</p>
<h3 id="â€œ3é€‰2â€çš„é—®é¢˜"><a href="#â€œ3é€‰2â€çš„é—®é¢˜" class="headerlink" title="â€œ3é€‰2â€çš„é—®é¢˜"></a>â€œ3é€‰2â€çš„é—®é¢˜</h3><blockquote>
<p>å½“å‘ç”Ÿç½‘ç»œåˆ†åŒºçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬è¦ç»§ç»­æœåŠ¡ï¼Œé‚£ä¹ˆå¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§åªèƒ½ 2 é€‰ 1ã€‚ä¹Ÿå°±æ˜¯è¯´å½“ç½‘ç»œåˆ†åŒºä¹‹å P æ˜¯å‰æï¼Œå†³å®šäº† P ä¹‹åæ‰æœ‰ C å’Œ A çš„é€‰æ‹©ã€‚ä¹Ÿå°±æ˜¯è¯´åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰æˆ‘ä»¬æ˜¯å¿…é¡»è¦å®ç°çš„ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼šCAP ç†è®ºä¸­åˆ†åŒºå®¹é”™æ€§ P æ˜¯ä¸€å®šè¦æ»¡è¶³çš„ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œåªèƒ½æ»¡è¶³å¯ç”¨æ€§ A æˆ–è€…ä¸€è‡´æ€§ Cã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA æ¶æ„ï¼Œåªèƒ½é€‰æ‹© CP æˆ–è€… AP æ¶æ„ã€‚ æ¯”å¦‚ ZooKeeperã€HBase å°±æ˜¯ CP æ¶æ„ï¼ŒCassandraã€Eureka å°±æ˜¯ AP æ¶æ„ï¼ŒNacos ä¸ä»…æ”¯æŒ CP æ¶æ„ä¹Ÿæ”¯æŒ AP æ¶æ„ã€‚</p>
<h3 id="ä¸ºå•¥ä¸å¯èƒ½é€‰æ‹©-CA-æ¶æ„å‘¢ï¼Ÿ"><a href="#ä¸ºå•¥ä¸å¯èƒ½é€‰æ‹©-CA-æ¶æ„å‘¢ï¼Ÿ" class="headerlink" title="ä¸ºå•¥ä¸å¯èƒ½é€‰æ‹© CA æ¶æ„å‘¢ï¼Ÿ"></a>ä¸ºå•¥ä¸å¯èƒ½é€‰æ‹© CA æ¶æ„å‘¢ï¼Ÿ</h3><p>ä¸¾ä¸ªä¾‹å­ï¼šè‹¥ç³»ç»Ÿå‡ºç°â€œåˆ†åŒºâ€ï¼Œç³»ç»Ÿä¸­çš„æŸä¸ªèŠ‚ç‚¹åœ¨è¿›è¡Œå†™æ“ä½œã€‚ä¸ºäº†ä¿è¯ Cï¼Œ å¿…é¡»è¦ç¦æ­¢å…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œï¼Œè¿™å°±å’Œ A å‘ç”Ÿå†²çªäº†ã€‚å¦‚æœä¸ºäº†ä¿è¯ Aï¼Œå…¶ä»–èŠ‚ç‚¹çš„è¯»å†™æ“ä½œæ­£å¸¸çš„è¯ï¼Œé‚£å°±å’Œ C å‘ç”Ÿå†²çªäº†ã€‚</p>
<p>é€‰æ‹© CP è¿˜æ˜¯ AP çš„å…³é”®åœ¨äºå½“å‰çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ²¡æœ‰å®šè®ºï¼Œæ¯”å¦‚å¯¹äºéœ€è¦ç¡®ä¿å¼ºä¸€è‡´æ€§çš„åœºæ™¯å¦‚é“¶è¡Œä¸€èˆ¬ä¼šé€‰æ‹©ä¿è¯ CP ã€‚å¦å¤–ï¼Œéœ€è¦è¡¥å……è¯´æ˜çš„ä¸€ç‚¹æ˜¯ï¼šå¦‚æœç½‘ç»œåˆ†åŒºæ­£å¸¸çš„è¯ï¼ˆç³»ç»Ÿåœ¨ç»å¤§éƒ¨åˆ†æ—¶å€™æ‰€å¤„çš„çŠ¶æ€ï¼‰ï¼Œä¹Ÿå°±è¯´ä¸éœ€è¦ä¿è¯ P çš„æ—¶å€™ï¼ŒC å’Œ A èƒ½å¤ŸåŒæ—¶ä¿è¯ã€‚</p>
<h2 id="3-2-CAPå®é™…æ¡ˆä¾‹"><a href="#3-2-CAPå®é™…æ¡ˆä¾‹" class="headerlink" title="3.2 CAPå®é™…æ¡ˆä¾‹"></a>3.2 CAPå®é™…æ¡ˆä¾‹</h2><p>æˆ‘è¿™é‡Œä»¥æ³¨å†Œä¸­å¿ƒæ¥æ¢è®¨ä¸€ä¸‹ CAP çš„å®é™…åº”ç”¨ã€‚è€ƒè™‘åˆ°å¾ˆå¤šå°ä¼™ä¼´ä¸çŸ¥é“æ³¨å†Œä¸­å¿ƒæ˜¯å¹²å˜›çš„ï¼Œè¿™é‡Œç®€å•ä»¥ Dubbo ä¸ºä¾‹è¯´ä¸€è¯´ã€‚ä¸‹å›¾æ˜¯ Dubbo çš„æ¶æ„å›¾ã€‚æ³¨å†Œä¸­å¿ƒ Registry åœ¨å…¶ä¸­æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿæä¾›äº†ä»€ä¹ˆæœåŠ¡å‘¢ï¼Ÿæ³¨å†Œä¸­å¿ƒè´Ÿè´£æœåŠ¡åœ°å€çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼Œç›¸å½“äºç›®å½•æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…åªåœ¨å¯åŠ¨æ—¶ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œæ³¨å†Œä¸­å¿ƒä¸è½¬å‘è¯·æ±‚ï¼Œå‹åŠ›è¾ƒå°ã€‚<br><img src="/2024/05/25/java/base-li-lun-yu-cap/dubbo-architecture.png" alt="dubbo-architecture"></p>
<p>å¸¸è§çš„å¯ä»¥ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ç»„ä»¶æœ‰ï¼šZooKeeperã€Eurekaã€Nacosâ€¦ã€‚</p>
<ol>
<li>ZooKeeper ä¿è¯çš„æ˜¯ CPã€‚<br>ä»»ä½•æ—¶åˆ»å¯¹ ZooKeeper çš„è¯»è¯·æ±‚éƒ½èƒ½å¾—åˆ°ä¸€è‡´æ€§çš„ç»“æœï¼Œä½†æ˜¯ï¼Œ ZooKeeper ä¸ä¿è¯æ¯æ¬¡è¯·æ±‚çš„å¯ç”¨æ€§æ¯”å¦‚åœ¨ Leader é€‰ä¸¾è¿‡ç¨‹ä¸­æˆ–è€…åŠæ•°ä»¥ä¸Šçš„æœºå™¨ä¸å¯ç”¨çš„æ—¶å€™æœåŠ¡å°±æ˜¯ä¸å¯ç”¨çš„ã€‚</li>
<li>Eureka ä¿è¯çš„åˆ™æ˜¯ APã€‚<br>Eureka åœ¨è®¾è®¡çš„æ—¶å€™å°±æ˜¯ä¼˜å…ˆä¿è¯ A ï¼ˆå¯ç”¨æ€§ï¼‰ã€‚åœ¨ Eureka ä¸­ä¸å­˜åœ¨ä»€ä¹ˆ Leader èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€æ ·çš„ã€å¹³ç­‰çš„ã€‚å› æ­¤ Eureka ä¸ä¼šåƒ ZooKeeper é‚£æ ·å‡ºç°é€‰ä¸¾è¿‡ç¨‹ä¸­æˆ–è€…åŠæ•°ä»¥ä¸Šçš„æœºå™¨ä¸å¯ç”¨çš„æ—¶å€™æœåŠ¡å°±æ˜¯ä¸å¯ç”¨çš„æƒ…å†µã€‚ Eureka ä¿è¯å³ä½¿å¤§éƒ¨åˆ†èŠ‚ç‚¹æŒ‚æ‰ä¹Ÿä¸ä¼šå½±å“æ­£å¸¸æä¾›æœåŠ¡ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¯ç”¨çš„å°±è¡Œäº†ã€‚åªä¸è¿‡è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å¯èƒ½å¹¶ä¸æ˜¯æœ€æ–°çš„ã€‚</li>
<li>Nacos ä¸ä»…æ”¯æŒ CP ä¹Ÿæ”¯æŒ APã€‚</li>
</ol>
<h3 id="ZooKeeperè¡¥å……"><a href="#ZooKeeperè¡¥å……" class="headerlink" title="ZooKeeperè¡¥å……"></a>ZooKeeperè¡¥å……</h3><p>ZooKeeper é€šè¿‡å¯çº¿æ€§åŒ–ï¼ˆLinearizableï¼‰å†™å…¥ã€å…¨å±€ FIFO é¡ºåºè®¿é—®ç­‰æœºåˆ¶æ¥ä¿éšœæ•°æ®ä¸€è‡´æ€§ã€‚å¤šèŠ‚ç‚¹éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œ ZooKeeper é›†ç¾¤å¤„äº Quorum æ¨¡å¼ã€‚Quorum æ¨¡å¼ä¸‹çš„ ZooKeeper é›†ç¾¤ï¼Œ æ˜¯ä¸€ç»„ ZooKeeper æœåŠ¡å™¨èŠ‚ç‚¹ç»„æˆçš„é›†åˆï¼Œå…¶ä¸­å¤§å¤šæ•°èŠ‚ç‚¹å¿…é¡»åŒæ„ä»»ä½•å˜æ›´æ‰èƒ½è¢«è§†ä¸ºæœ‰æ•ˆã€‚</p>
<p>ç”±äº Quorum æ¨¡å¼ä¸‹çš„è¯»è¯·æ±‚ä¸ä¼šè§¦å‘å„ä¸ª ZooKeeper èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®åŒæ­¥ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹è¿˜æ˜¯å¯èƒ½ä¼šå­˜åœ¨è¯»å–åˆ°æ—§æ•°æ®çš„æƒ…å†µï¼Œå¯¼è‡´ä¸åŒçš„å®¢æˆ·ç«¯è§†å›¾ä¸Šçœ‹åˆ°çš„ç»“æœä¸åŒï¼Œè¿™å¯èƒ½æ˜¯ç”±äºç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ã€é‡ä¼ ç­‰åŸå› é€ æˆçš„ã€‚ZooKeeper ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº† Watcher æœºåˆ¶å’Œç‰ˆæœ¬å·æœºåˆ¶æ¥å¸®åŠ©å®¢æˆ·ç«¯æ£€æµ‹æ•°æ®çš„å˜åŒ–å’Œç‰ˆæœ¬å·çš„å˜æ›´ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<h2 id="3-3-æ€»ç»“"><a href="#3-3-æ€»ç»“" class="headerlink" title="3.3 æ€»ç»“"></a>3.3 æ€»ç»“</h2><p>åœ¨ç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€çš„æƒ…å†µä¸‹ï¼ŒCAP ç†è®ºåªèƒ½æ»¡è¶³ CP æˆ–è€… APã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„å‰ææ˜¯ç³»ç»Ÿå‘ç”Ÿäº†â€œåˆ†åŒºâ€å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼ŒèŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥é€šä¿¡æ­£å¸¸çš„è¯ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ P äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶ä¿è¯ C å’Œ A äº†ã€‚</p>
<p><strong>æ€»ç»“ï¼šå¦‚æœç³»ç»Ÿå‘ç”Ÿâ€œåˆ†åŒºâ€ï¼Œæˆ‘ä»¬è¦è€ƒè™‘é€‰æ‹© CP è¿˜æ˜¯ APã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿâ€œåˆ†åŒºâ€çš„è¯ï¼Œæˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•ä¿è¯ CA ã€‚</strong></p>
<p>åœ¨è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ä»…ä»…å±€é™åœ¨ CAP é—®é¢˜ä¸Šï¼Œè¿˜è¦å…³æ³¨ç³»ç»Ÿçš„æ‰©å±•æ€§ã€å¯ç”¨æ€§ç­‰ç­‰ã€‚</p>
<h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><ul>
<li>ACID æ˜¯æ•°æ®åº“äº‹åŠ¡å®Œæ•´æ€§çš„ç†è®º</li>
<li>CAP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç†è®º</li>
<li>BASE æ˜¯ CAP ç†è®ºä¸­ AP æ–¹æ¡ˆçš„å»¶ä¼¸ã€‚</li>
</ul>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://javaguide.cn/distributed-system/protocol/cap-and-base-theorem.html">CAP &amp; BASEç†è®ºè¯¦è§£</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>Baseç†è®º</tag>
        <tag>CAP</tag>
      </tags>
  </entry>
  <entry>
    <title>ConcurrentHashMapæºç è§£æ</title>
    <url>/2019/07/06/java/concurrenthashmap-yuan-ma-jie-xi/</url>
    <content><![CDATA[<blockquote>
<p><strong>é¢è¯•å¸¸è§é—®é¢˜</strong></p>
<p>ConcurrentHashMapå®ç°åŸç†</p>
<p>ConcurrentHashMapå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨</p>
</blockquote>
<blockquote>
<p><em><strong>æœ¬æ–‡åŸºäºJDK1.8</strong></em></p>
</blockquote>
<h2 id="ä¸€ã€æ„é€ æ–¹æ³•å’ŒåŸºæœ¬å±æ€§"><a href="#ä¸€ã€æ„é€ æ–¹æ³•å’ŒåŸºæœ¬å±æ€§" class="headerlink" title="ä¸€ã€æ„é€ æ–¹æ³•å’ŒåŸºæœ¬å±æ€§"></a>ä¸€ã€æ„é€ æ–¹æ³•å’ŒåŸºæœ¬å±æ€§</h2><p>JDK8ä¸­ConcurrentHashMapå‚è€ƒäº†JDK8 HashMapçš„å®ç°ï¼Œæ„é€ æ–¹æ³•å’ŒåŸºæœ¬å±æ€§ä¸HashMapå¤§è‡´ç›¸åŒï¼Œå¯å‚è€ƒ<a href="http://blog.mpoom.cn/2019/07/06/HashMap%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">HashMapæºç è§£</a>,ä»¥ä¸‹ä¸»è¦åˆ—ä¸¾ä¸åŒçš„åœ°æ–¹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Encodings for Node hash fields. See above for explanation.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MOVED</span>     <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// hash for forwarding nodes</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TREEBIN</span>   <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// hash for roots of trees</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">RESERVED</span>  <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// hash for transient reservations</span>
<span class="token comment">// HashèŠ‚ç‚¹æ­£å¸¸å¯ç”¨ä½</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">HASH_BITS</span> <span class="token operator">=</span> <span class="token number">0x7fffffff</span><span class="token punctuation">;</span> <span class="token comment">// usable bits of normal node hash</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="äºŒã€ä¸»è¦æ–¹æ³•è§£æ"><a href="#äºŒã€ä¸»è¦æ–¹æ³•è§£æ" class="headerlink" title="äºŒã€ä¸»è¦æ–¹æ³•è§£æ"></a>äºŒã€ä¸»è¦æ–¹æ³•è§£æ</h2><h3 id="2-1-spread-int-h"><a href="#2-1-spread-int-h" class="headerlink" title="2.1  spread(int h)"></a>2.1  spread(int h)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * è¿™é‡Œçš„spreadæ–¹æ³•ä½œç”¨ä¸HashMapä¸­çš„hashæ–¹æ³•ç›¸åŒï¼Œ//å…ˆå¯¹ä½16ä½è¿›è¡Œæ‰°åŠ¨å¤„ç†ï¼Œç„¶åå±è”½ç¬¦å·ä½ï¼Œç»“æœä¸º32      * ä½intå‹éè´Ÿæ•°
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">spread</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token constant">HASH_BITS</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-tabAt-Node-tab-int-i"><a href="#2-2-tabAt-Node-tab-int-i" class="headerlink" title="2.2 tabAt(Node&lt;K,V&gt;[] tab, int i)"></a>2.2 tabAt(Node&lt;K,V&gt;[] tab, int i)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * è¯¥æ–¹æ³•é€šè¿‡Unsafeç±»ç›´æ¥è¿›è¡Œå†…å­˜å¯»å€å®šä½,ç”¨æ¥è¿”å›èŠ‚ç‚¹æ•°ç»„çš„æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹çš„åŸå­æ“ä½œ
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">tabAt</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">getObjectVolatile</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i <span class="token operator">&lt;&lt;</span> <span class="token constant">ASHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">ABASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-3-casTabAt-Node-tab-int-i-Node-c-Node-v"><a href="#2-3-casTabAt-Node-tab-int-i-Node-c-Node-v" class="headerlink" title="2.3  casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)"></a>2.3  casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * æ¯”è¾ƒäº¤æ¢ï¼ˆCASï¼‰
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">boolean</span> <span class="token function">casTabAt</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> c<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapObject</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i <span class="token operator">&lt;&lt;</span> <span class="token constant">ASHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">ABASE</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-4-setTabAt-Node-tab-int-i-Node-v"><a href="#2-4-setTabAt-Node-tab-int-i-Node-v" class="headerlink" title="2.4  setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v)"></a>2.4  setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 
 */</span>   
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">setTabAt</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">putObjectVolatile</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>i <span class="token operator">&lt;&lt;</span> <span class="token constant">ASHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token constant">ABASE</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-5-put-K-key-V-value"><a href="#2-5-put-K-key-V-value" class="headerlink" title="2.5  put(K key, V value)"></a>2.5  put(K key, V value)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Maps the specified key to the specified value in this table.
 * Neither the key nor the value can be null.(é”®å€¼éƒ½ä¸èƒ½ä¸ºç©º)
 *
 * &lt;p>The value can be retrieved by calling the &#123;@code get&#125; method
 * with a key that is equal to the original key.
 *
 * @param key key with which the specified value is to be associated
 * @param value value to be associated with the specified key
 * @return the previous value associated with &#123;@code key&#125;, or
 *         &#123;@code null&#125; if there was no mapping for &#123;@code key&#125;
 * @throws NullPointerException if the specified key or value is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/** Implementation for put and putIfAbsent */</span>
<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// é”®å€¼éƒ½ä¸èƒ½ä¸ºnull,å¦åˆ™æŠ›å‡ºNPEå¼‚å¸¸</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> f<span class="token punctuation">;</span> 
        <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fh<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            tab <span class="token operator">=</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// å¦‚æœiä½ç½®æ²¡æœ‰æ•°æ®ï¼Œåˆ™æ¯”è¾ƒå¹¶äº¤æ¢</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// no lock when adding to empty bin</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">/*
         * å¦‚æœæ£€æµ‹åˆ°æŸä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯MOVEDï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ•°ç»„æ‰©å¼ çš„æ•°æ®å¤åˆ¶é˜¶æ®µï¼Œ
         * åˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¼šå‚ä¸å»å¤åˆ¶ï¼Œé€šè¿‡å…è®¸å¤šçº¿ç¨‹å¤åˆ¶çš„åŠŸèƒ½ï¼Œä»¥æ­¤æ¥å‡å°‘æ•°ç»„çš„å¤åˆ¶æ‰€å¸¦æ¥çš„æ€§èƒ½æŸå¤±
         */</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fh <span class="token operator">=</span> f<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">MOVED</span><span class="token punctuation">)</span>
            tab <span class="token operator">=</span> <span class="token function">helpTransfer</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">V</span> oldVal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token comment">// å¦‚æœåœ¨è¿™ä¸ªä½ç½®æœ‰å…ƒç´ çš„è¯ï¼Œå°±é‡‡ç”¨synchronizedçš„æ–¹å¼åŠ é”</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fh <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// æ ‡è¯†è¯¥èŠ‚ç‚¹ä¸ºåˆ—è¡¨èŠ‚ç‚¹</span>
                        binCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> f<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">K</span> ek<span class="token punctuation">;</span>
                            <span class="token comment">// å¦‚æœkeyç›¸åŒï¼Œåˆ™è¦†ç›–æ—§valueå€¼</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                                <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span>
                                 <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                oldVal <span class="token operator">=</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>
                                    e<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                            <span class="token comment">// æ’å…¥åˆ—è¡¨å°¾éƒ¨</span>
                            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> pred <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                pred<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token keyword">instanceof</span> <span class="token class-name">TreeBin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span>
                        binCount <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                        <span class="token comment">// çº¢é»‘æ ‘ç»“æ„æ—‹è½¬æ’å…¥</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            oldVal <span class="token operator">=</span> p<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>
                                p<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// å¦‚æœåˆ—è¡¨é•¿åº¦å¤§äºç­‰äº8åˆ™è½¬æ¢ä¸ºçº¢é»‘æ ‘</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span><span class="token punctuation">)</span>
                    <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> oldVal<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ç»Ÿè®¡sizeï¼Œå¹¶æ£€æµ‹æ˜¯å¦éœ€è¦æ‰©å®¹</span>
    <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> binCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-6-initTable"><a href="#2-6-initTable" class="headerlink" title="2.6  initTable()"></a>2.6  initTable()</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Initializes table, using the size recorded in sizeCtl.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> 
    <span class="token keyword">int</span> sc<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœtableä¸ºnullåˆ™è¿›è¡Œåˆå§‹åŒ–</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tab<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//sizeCtl&lt;0è¡¨ç¤ºå…¶ä»–çº¿ç¨‹å·²ç»åœ¨åˆå§‹åŒ–äº†æˆ–è€…æ‰©å®¹äº†ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sc <span class="token operator">=</span> sizeCtl<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lost initialization race; just spin</span>
        <span class="token comment">//CASæ“ä½œSIZECTLä¸º-1ï¼Œè¡¨ç¤ºåˆå§‹åŒ–çŠ¶æ€</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tab<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span>sc <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> sc <span class="token operator">:</span> <span class="token constant">DEFAULT_CAPACITY</span><span class="token punctuation">;</span>
                    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    table <span class="token operator">=</span> tab <span class="token operator">=</span> nt<span class="token punctuation">;</span>
                    <span class="token comment">// åˆå§‹åŒ–åï¼ŒsizeCtlé•¿åº¦ä¸ºæ•°ç»„é•¿åº¦çš„3/4</span>
                    sc <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token punctuation">(</span>n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                sizeCtl <span class="token operator">=</span> sc<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> tab<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-7-treeifyBin-Node-tab-int-index"><a href="#2-7-treeifyBin-Node-tab-int-index" class="headerlink" title="2.7 treeifyBin(Node&lt;K,V&gt;[] tab, int index)"></a>2.7 treeifyBin(Node&lt;K,V&gt;[] tab, int index)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Replaces all linked nodes in bin at given index unless table is
 * too small, in which case resizes instead.
 * å½“æ•°ç»„é•¿åº¦å°äº64çš„æ—¶å€™ï¼Œæ‰©å¼ æ•°ç»„é•¿åº¦ä¸€å€ï¼Œå¦åˆ™çš„è¯æŠŠé“¾è¡¨è½¬ä¸ºæ ‘
 */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">treeifyBin</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> b<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> sc<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span><span class="token punctuation">)</span>
            <span class="token comment">// æ•°ç»„é•¿åº¦å°äº64ï¼Œåˆ™æ‰©å®¹1å€</span>
            <span class="token function">tryPresize</span><span class="token punctuation">(</span>n <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>hash <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//ä½¿ç”¨synchronizedåŒæ­¥å™¨ï¼Œå°†è¯¥èŠ‚ç‚¹å‡ºçš„é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hd <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> b<span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// å°†åˆ—è¡¨èŠ‚ç‚¹è½¬æ¢ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹</span>
                        <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> e<span class="token punctuation">.</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span>val<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>prev <span class="token operator">=</span> tl<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                            hd <span class="token operator">=</span> p<span class="token punctuation">;</span>
                        <span class="token keyword">else</span>
                            tl<span class="token punctuation">.</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>
                        tl <span class="token operator">=</span> p<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token function">setTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> index<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-8-tryPresize-int-size"><a href="#2-8-tryPresize-int-size" class="headerlink" title="2.8 tryPresize(int size)"></a>2.8 tryPresize(int size)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Tries to presize table to accommodate the given number of elements.
 *
 * @param size number of elements (doesn't need to be perfectly accurate)
 */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">tryPresize</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// å¦‚æœæŒ‡å®šå®¹é‡å¤§å°å¤§äºç­‰äºæœ€å¤§å®¹é‡çš„ä¸€åŠï¼Œåˆ™è®¾ç½®ä¸ºæœ€å¤§å®¹é‡ï¼Œå¦åˆ™æ‰©å¤§ä¸ºsizeçš„ä¸¤å€</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>size <span class="token operator">>=</span> <span class="token punctuation">(</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">:</span>
        <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> sc<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sc <span class="token operator">=</span> sizeCtl<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœè¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            n <span class="token operator">=</span> <span class="token punctuation">(</span>sc <span class="token operator">></span> c<span class="token punctuation">)</span> <span class="token operator">?</span> sc <span class="token operator">:</span> c<span class="token punctuation">;</span>
            <span class="token comment">// åˆå§‹åŒ–tabçš„æ—¶å€™ï¼ŒæŠŠsizeCtlè®¾ä¸º-1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>table <span class="token operator">==</span> tab<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        table <span class="token operator">=</span> nt<span class="token punctuation">;</span>
                        sc <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token punctuation">(</span>n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                    sizeCtl <span class="token operator">=</span> sc<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
         <span class="token comment">/*
         * ä¸€ç›´æ‰©å®¹åˆ°çš„cå°äºç­‰äºsizeCtlæˆ–è€…æ•°ç»„é•¿åº¦å¤§äºæœ€å¤§é•¿åº¦çš„æ—¶å€™ï¼Œåˆ™é€€å‡º
         * æ‰€ä»¥åœ¨ä¸€æ¬¡æ‰©å®¹ä¹‹åï¼Œä¸æ˜¯åŸæ¥é•¿åº¦çš„ä¸¤å€ï¼Œè€Œæ˜¯2çš„næ¬¡æ–¹å€
         */</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&lt;=</span> sc <span class="token operator">||</span> n <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> table<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">resizeStamp</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nt<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sc <span class="token operator">>>></span> <span class="token constant">RESIZE_STAMP_SHIFT</span><span class="token punctuation">)</span> <span class="token operator">!=</span> rs <span class="token operator">||</span> sc <span class="token operator">==</span> rs <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">||</span>
                    sc <span class="token operator">==</span> rs <span class="token operator">+</span> <span class="token constant">MAX_RESIZERS</span> <span class="token operator">||</span> <span class="token punctuation">(</span>nt <span class="token operator">=</span> nextTable<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span>
                    transferIndex <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token comment">/*
                 * transferçš„çº¿ç¨‹æ•°åŠ ä¸€,è¯¥çº¿ç¨‹å°†è¿›è¡Œtransferçš„å¸®å¿™
                 * åœ¨transferçš„æ—¶å€™ï¼Œscè¡¨ç¤ºåœ¨transferå·¥ä½œçš„çº¿ç¨‹æ•°
                 */</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc<span class="token punctuation">,</span> sc <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token function">transfer</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> nt<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">/*
             * æ²¡æœ‰åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼Œåˆ™å¼€å§‹æ‰©å®¹
             */</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc<span class="token punctuation">,</span><span class="token punctuation">(</span>rs <span class="token operator">&lt;&lt;</span> <span class="token constant">RESIZE_STAMP_SHIFT</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">transfer</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-9-transfer-Node-tab-Node-nextTab"><a href="#2-9-transfer-Node-tab-Node-nextTab" class="headerlink" title="2.9 transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)"></a>2.9 transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Moves and/or copies the nodes in each bin to new table. See
 * above for explanation.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nextTab<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">,</span> stride<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>stride <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">NCPU</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>n <span class="token operator">>>></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token constant">NCPU</span> <span class="token operator">:</span> n<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MIN_TRANSFER_STRIDE</span><span class="token punctuation">)</span>
        stride <span class="token operator">=</span> <span class="token constant">MIN_TRANSFER_STRIDE</span><span class="token punctuation">;</span> <span class="token comment">// subdivide range</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// initiating</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> nt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span>n <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            nextTab <span class="token operator">=</span> nt<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// try to cope with OOME</span>
            sizeCtl <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        nextTable <span class="token operator">=</span> nextTab<span class="token punctuation">;</span>
        transferIndex <span class="token operator">=</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">int</span> nextn <span class="token operator">=</span> nextTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token class-name">ForwardingNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> fwd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForwardingNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>nextTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> advance <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> finishing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// to ensure sweep before committing nextTab</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> bound <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> f<span class="token punctuation">;</span> <span class="token keyword">int</span> fh<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> nextIndex<span class="token punctuation">,</span> nextBound<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>i <span class="token operator">>=</span> bound <span class="token operator">||</span> finishing<span class="token punctuation">)</span>
                advance <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>nextIndex <span class="token operator">=</span> transferIndex<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                advance <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span>compareAndSwapInt
                     <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">TRANSFERINDEX</span><span class="token punctuation">,</span> nextIndex<span class="token punctuation">,</span>
                      nextBound <span class="token operator">=</span> <span class="token punctuation">(</span>nextIndex <span class="token operator">></span> stride <span class="token operator">?</span>
                                   nextIndex <span class="token operator">-</span> stride <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                bound <span class="token operator">=</span> nextBound<span class="token punctuation">;</span>
                i <span class="token operator">=</span> nextIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
                advance <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">>=</span> n <span class="token operator">||</span> i <span class="token operator">+</span> n <span class="token operator">>=</span> nextn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> sc<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>finishing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                nextTable <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                table <span class="token operator">=</span> nextTab<span class="token punctuation">;</span>
                sizeCtl <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">U</span><span class="token punctuation">.</span><span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">SIZECTL</span><span class="token punctuation">,</span> sc <span class="token operator">=</span> sizeCtl<span class="token punctuation">,</span> sc <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sc <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">resizeStamp</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">RESIZE_STAMP_SHIFT</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                finishing <span class="token operator">=</span> advance <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                i <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token comment">// recheck before commit</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            advance <span class="token operator">=</span> <span class="token function">casTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> fwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fh <span class="token operator">=</span> f<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">MOVED</span><span class="token punctuation">)</span>
            advance <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// already processed</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> ln<span class="token punctuation">,</span> hn<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fh <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">int</span> runBit <span class="token operator">=</span> fh <span class="token operator">&amp;</span> n<span class="token punctuation">;</span>
                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> lastRun <span class="token operator">=</span> f<span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> f<span class="token punctuation">.</span>next<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">int</span> b <span class="token operator">=</span> p<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> n<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!=</span> runBit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                runBit <span class="token operator">=</span> b<span class="token punctuation">;</span>
                                lastRun <span class="token operator">=</span> p<span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>runBit <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            ln <span class="token operator">=</span> lastRun<span class="token punctuation">;</span>
                            hn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                            hn <span class="token operator">=</span> lastRun<span class="token punctuation">;</span>
                            ln <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> f<span class="token punctuation">;</span> p <span class="token operator">!=</span> lastRun<span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">int</span> ph <span class="token operator">=</span> p<span class="token punctuation">.</span>hash<span class="token punctuation">;</span> <span class="token class-name">K</span> pk <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">;</span> <span class="token class-name">V</span> pv <span class="token operator">=</span> p<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ph <span class="token operator">&amp;</span> n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                                ln <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>ph<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> pv<span class="token punctuation">,</span> ln<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                hn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>ph<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> pv<span class="token punctuation">,</span> hn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token function">setTabAt</span><span class="token punctuation">(</span>nextTab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> ln<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">setTabAt</span><span class="token punctuation">(</span>nextTab<span class="token punctuation">,</span> i <span class="token operator">+</span> n<span class="token punctuation">,</span> hn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">setTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        advance <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token keyword">instanceof</span> <span class="token class-name">TreeBin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>f<span class="token punctuation">;</span>
                        <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> lo <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hi <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        <span class="token keyword">int</span> lc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> hc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> t<span class="token punctuation">.</span>first<span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">int</span> h <span class="token operator">=</span> e<span class="token punctuation">.</span>hash<span class="token punctuation">;</span>
                            <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
                                <span class="token punctuation">(</span>h<span class="token punctuation">,</span> e<span class="token punctuation">.</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span>val<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">&amp;</span> n<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>prev <span class="token operator">=</span> loTail<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                    lo <span class="token operator">=</span> p<span class="token punctuation">;</span>
                                <span class="token keyword">else</span>
                                    loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>
                                loTail <span class="token operator">=</span> p<span class="token punctuation">;</span>
                                <span class="token operator">++</span>lc<span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>prev <span class="token operator">=</span> hiTail<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                    hi <span class="token operator">=</span> p<span class="token punctuation">;</span>
                                <span class="token keyword">else</span>
                                    hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>
                                hiTail <span class="token operator">=</span> p<span class="token punctuation">;</span>
                                <span class="token operator">++</span>hc<span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                        ln <span class="token operator">=</span> <span class="token punctuation">(</span>lc <span class="token operator">&lt;=</span> <span class="token constant">UNTREEIFY_THRESHOLD</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">untreeify</span><span class="token punctuation">(</span>lo<span class="token punctuation">)</span> <span class="token operator">:</span>
                            <span class="token punctuation">(</span>hc <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>lo<span class="token punctuation">)</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>
                        hn <span class="token operator">=</span> <span class="token punctuation">(</span>hc <span class="token operator">&lt;=</span> <span class="token constant">UNTREEIFY_THRESHOLD</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">untreeify</span><span class="token punctuation">(</span>hi<span class="token punctuation">)</span> <span class="token operator">:</span>
                            <span class="token punctuation">(</span>lc <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hi<span class="token punctuation">)</span> <span class="token operator">:</span> t<span class="token punctuation">;</span>
                        <span class="token function">setTabAt</span><span class="token punctuation">(</span>nextTab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> ln<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">setTabAt</span><span class="token punctuation">(</span>nextTab<span class="token punctuation">,</span> i <span class="token operator">+</span> n<span class="token punctuation">,</span> hn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">setTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        advance <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h2><p>åœ¨ConcurrentHashMapä¸­ï¼ŒåŒæ­¥å¤„ç†ä¸»è¦æ˜¯é€šè¿‡Synchronizedå’Œunsafeä¸¤ç§æ–¹å¼æ¥å®Œæˆçš„ã€‚</p>
<ul>
<li><p>åœ¨å–å¾—sizeCtlã€æŸä¸ªä½ç½®çš„Nodeçš„æ—¶å€™ï¼Œä½¿ç”¨çš„éƒ½æ˜¯unsafeçš„æ–¹æ³•ï¼Œæ¥è¾¾åˆ°å¹¶å‘å®‰å…¨çš„ç›®çš„</p>
</li>
<li><p>å½“éœ€è¦åœ¨æŸä¸ªä½ç½®è®¾ç½®èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåˆ™ä¼šé€šè¿‡Synchronizedçš„åŒæ­¥æœºåˆ¶æ¥é”å®šè¯¥ä½ç½®çš„èŠ‚ç‚¹ã€‚</p>
</li>
<li><p>åœ¨æ•°ç»„æ‰©å®¹çš„æ—¶å€™ï¼Œåˆ™é€šè¿‡å¤„ç†çš„æ­¥é•¿å’ŒfwdèŠ‚ç‚¹æ¥è¾¾åˆ°å¹¶å‘å®‰å…¨çš„ç›®çš„ï¼Œé€šè¿‡è®¾ç½®hashå€¼ä¸ºMOVED</p>
</li>
<li><p>å½“æŠŠæŸä¸ªä½ç½®çš„èŠ‚ç‚¹å¤åˆ¶åˆ°æ‰©å¼ åçš„tableçš„æ—¶å€™ï¼Œä¹Ÿé€šè¿‡Synchronizedçš„åŒæ­¥æœºåˆ¶æ¥ä¿è¯ç°ç¨‹å®‰å…¨</p>
</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ConcurrentHashMap</tag>
      </tags>
  </entry>
  <entry>
    <title>HashMapæºç è§£æ</title>
    <url>/2019/07/06/java/hashmap-yuan-ma-jie-xi/</url>
    <content><![CDATA[<blockquote>
<p><strong>é¢è¯•å¸¸è§é—®é¢˜</strong></p>
<p>1ã€ä½ çœ‹è¿‡é‚£äº›æºç å—ï¼Ÿ<br>2ã€é‚£ä½ èƒ½è®²è®²HashMapçš„å®ç°åŸç†å—ï¼Ÿ<br>3ã€HashMapä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œrehashï¼Ÿ<br>4ã€HashMapä»€ä¹ˆæ—¶å€™ä¼šè¿›è¡Œæ‰©å®¹ï¼Ÿ<br>5ã€é‚£HashMapçš„åˆå§‹å®¹é‡è®¾ç½®æˆå¤šå°‘æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿ<br>6ã€ç»“åˆæºç è¯´è¯´HashMapåœ¨é«˜å¹¶å‘åœºæ™¯ä¸­ä¸ºä»€ä¹ˆä¼šå‡ºç°æ­»å¾ªç¯ï¼Ÿ<br>7ã€JDK1.8ä¸­å¯¹HashMapåšäº†å“ªäº›æ€§èƒ½ä¼˜åŒ–ï¼Ÿ<br>8ã€HashMapå’ŒHashTableæœ‰ä½•ä¸åŒï¼Ÿ<br>9ã€HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼Ÿ<br>10ã€ConcurrentHashMapå’ŒLinkedHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br>11ã€ä¸ºä»€ä¹ˆConcurrentHashMapä¸­çš„é“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜€å€¼æ˜¯8ï¼Ÿ<br>12ã€ä»€ä¹ˆæ˜¯ConcurrentSkipListMapï¼Ÿä»–å’ŒConcurrentHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br>13ã€è¿˜çœ‹è¿‡å…¶ä»–çš„æºç å—ï¼ŸSpringçš„æºç æœ‰äº†è§£å—ï¼Ÿ<br>14ã€SpringBootçš„æºç å‘¢ï¼ŸçŸ¥é“starteræ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿ</p>
</blockquote>
<h2 id="ä¸€ã€æ„é€ æ–¹æ³•"><a href="#ä¸€ã€æ„é€ æ–¹æ³•" class="headerlink" title="ä¸€ã€æ„é€ æ–¹æ³•"></a>ä¸€ã€æ„é€ æ–¹æ³•</h2><h3 id="1-1æ— å‚æ„é€ æ–¹æ³•"><a href="#1-1æ— å‚æ„é€ æ–¹æ³•" class="headerlink" title="1.1æ— å‚æ„é€ æ–¹æ³•"></a>1.1æ— å‚æ„é€ æ–¹æ³•</h3><blockquote>
<p>é»˜è®¤åˆå§‹åŒ–å®¹é‡16ï¼ŒåŠ è½½å› å­0.75</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Constructs an empty &lt;tt>HashMap&lt;/tt> with the default initial capacity
 * (16) and the default load factor (0.75).
 */</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">;</span> <span class="token comment">// all other fields defaulted</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-æŒ‡å®šåˆå§‹å®¹é‡initialCapacityï¼Œé»˜è®¤åŠ è½½å› å­0-75"><a href="#1-2-æŒ‡å®šåˆå§‹å®¹é‡initialCapacityï¼Œé»˜è®¤åŠ è½½å› å­0-75" class="headerlink" title="1.2  æŒ‡å®šåˆå§‹å®¹é‡initialCapacityï¼Œé»˜è®¤åŠ è½½å› å­0.75"></a>1.2  æŒ‡å®šåˆå§‹å®¹é‡initialCapacityï¼Œé»˜è®¤åŠ è½½å› å­0.75</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Constructs an empty &lt;tt>HashMap&lt;/tt> with the specified initial
 * capacity and the default load factor (0.75).
 *
 * @param  initialCapacity the initial capacity.
 * @throws IllegalArgumentException if the initial capacity is negative.
 */</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-3-æŒ‡å®šåˆå§‹å®¹é‡initialCapaticyå’ŒåŠ è½½å› å­loadFactor"><a href="#1-3-æŒ‡å®šåˆå§‹å®¹é‡initialCapaticyå’ŒåŠ è½½å› å­loadFactor" class="headerlink" title="1.3 æŒ‡å®šåˆå§‹å®¹é‡initialCapaticyå’ŒåŠ è½½å› å­loadFactor"></a>1.3 æŒ‡å®šåˆå§‹å®¹é‡initialCapaticyå’ŒåŠ è½½å› å­loadFactor</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Constructs an empty &lt;tt>HashMap&lt;/tt> with the specified initial
 * capacity and load factor.
 *
 * @param  initialCapacity the initial capacity
 * @param  loadFactor      the load factor
 * @throws IllegalArgumentException if the initial capacity is negative
 *         or the load factor is nonpositive
 */</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span>
                                           initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span>
        initialCapacity <span class="token operator">=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span>
                                           loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span>
    <span class="token comment">// é˜ˆå€¼åˆå§‹åŒ–ä¸ºåˆå§‹å®¹é‡æœ€å°2çš„å€æ•°</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>HashMapåˆå§‹å®¹é‡ä¸ºæŒ‡å®šå®¹é‡çš„æœ€å°2çš„å€æ•°ã€‚è¯¥æ–¹æ³•å°†åˆå§‹å®¹é‡çš„äºŒè¿›åˆ¶æœ€é«˜ä½å³ç§»å†ä¸åŸå€¼è¿›è¡Œæˆ–è¿ç®—ï¼Œå°†ä½ä½å…¨éƒ¨è½¬æ¢ä¸º1ï¼Œæœ€ååŠ 1ï¼Œç”±æ­¤å¾—åˆ°åˆå§‹åŒ–å®¹é‡çš„æœ€å°çš„2çš„å€æ•°</strong></p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Returns a power of two size for the given target capacity.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> cap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span>
    n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">:</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-4-ç”¨å…¶ä»–Mapåˆå§‹åŒ–"><a href="#1-4-ç”¨å…¶ä»–Mapåˆå§‹åŒ–" class="headerlink" title="1.4 ç”¨å…¶ä»–Mapåˆå§‹åŒ–"></a>1.4 ç”¨å…¶ä»–Mapåˆå§‹åŒ–</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Constructs a new &lt;tt>HashMap&lt;/tt> with the same mappings as the
 * specified &lt;tt>Map&lt;/tt>.  The &lt;tt>HashMap&lt;/tt> is created with
 * default load factor (0.75) and an initial capacity sufficient to
 * hold the mappings in the specified &lt;tt>Map&lt;/tt>.
 *
 * @param   m the map whose mappings are to be placed in this map
 * @throws  NullPointerException if the specified map is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span><span class="token punctuation">;</span>
    <span class="token function">putMapEntries</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="äºŒã€å±æ€§è§£æ"><a href="#äºŒã€å±æ€§è§£æ" class="headerlink" title="äºŒã€å±æ€§è§£æ"></a>äºŒã€å±æ€§è§£æ</h2><h3 id="2-1-åŸºæœ¬å±æ€§"><a href="#2-1-åŸºæœ¬å±æ€§" class="headerlink" title="2.1  åŸºæœ¬å±æ€§"></a>2.1  åŸºæœ¬å±æ€§</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * é»˜è®¤åˆå§‹åŒ–å®¹é‡ï¼Œå¿…é¡»æ˜¯2çš„å€æ•°ï¼Œåˆå§‹é»˜è®¤ä¸º16
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// aka 16</span>

<span class="token comment">/**
 * æœ€å¤§å®¹é‡ï¼Œå°äº2çš„30æ¬¡æ–¹
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * é»˜è®¤åŠ è½½å› å­0.75
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> <span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * åˆ—è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œåˆ—è¡¨å¤§äºç­‰äº8æ—¶å°†è½¬ä¸ºçº¢é»‘æ ‘
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * çº¢é»‘æ ‘è½¬åˆ—è¡¨çš„é˜ˆå€¼
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">UNTREEIFY_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * åˆ—è¡¨è½¬çº¢é»‘æ ‘çš„æœ€å°å®¹é‡ï¼Œå¦‚æœä¸€ä¸ªæ§½ä¸­çš„æ•°æ®å¤ªå¤šï¼ŒHashMapåº”è€ƒè™‘æ‰©å®¹ï¼Œè¯¥å€¼ç”¨æ¥è§£å†³æ‰©å®¹ä¸åˆ—è¡¨è½¬æ ‘çš„å†²çª
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span> <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œæ ¹æ®éœ€è¦æ‰©å®¹ï¼Œå¤§å°å§‹ç»ˆä¸º2çš„å€æ•°
 */</span>
<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>

<span class="token comment">/**
 * Holds cached entrySet(). Note that AbstractMap fields are used
 * for keySet() and values().
 */</span>
<span class="token keyword">transient</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> entrySet<span class="token punctuation">;</span>

<span class="token comment">/**
 * HashMapä¸­é”®å€¼å¯¹çš„æ•°é‡
 */</span>
<span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>

<span class="token comment">/**
 * HashMapç»“æ„ä¿®æ”¹æ¬¡æ•°
 */</span>
<span class="token keyword">transient</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span>

<span class="token comment">/**
 * ä¸‹æ¬¡æ‰©å®¹æ—¶tableçš„å¤§å°
 * @serial
 */</span>
<span class="token keyword">int</span> threshold<span class="token punctuation">;</span>

<span class="token comment">/**
 * hash table åŠ è½½å› å­
 * @serial
 */</span>
<span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-å†…éƒ¨ç±»Node"><a href="#2-2-å†…éƒ¨ç±»Node" class="headerlink" title="2.2  å†…éƒ¨ç±»Node&lt;K,V&gt;"></a>2.2  å†…éƒ¨ç±»Node&lt;K,V&gt;</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * åŸºç¡€hashèŠ‚ç‚¹ï¼ŒåŒ…å«ä¸€ä¸ªhashå€¼ï¼Œä¸€ä¸ªkey-valueé”®å€¼å¯¹ï¼Œå’Œä¸‹ä¸ªèŠ‚ç‚¹
 */</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>

    <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> hash<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">K</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">V</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">V</span> oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
        value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-3-å†…éƒ¨ç±»TreeNode"><a href="#2-3-å†…éƒ¨ç±»TreeNode" class="headerlink" title="2.3  å†…éƒ¨ç±»TreeNode&lt;K,V&gt;"></a>2.3  å†…éƒ¨ç±»TreeNode&lt;K,V&gt;</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ŒåŒ…å«çˆ¶èŠ‚ç‚¹ã€å·¦èŠ‚ç‚¹ã€å³èŠ‚ç‚¹ã€å‰ç½®èŠ‚ç‚¹ä»¥åŠèŠ‚ç‚¹é¢œè‰²
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> parent<span class="token punctuation">;</span>  <span class="token comment">// red-black tree links</span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> left<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> right<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> prev<span class="token punctuation">;</span>    <span class="token comment">// needed to unlink next upon deletion</span>
    <span class="token keyword">boolean</span> red<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> val<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * Returns root of tree containing this node.
     */</span>
    <span class="token keyword">final</span> <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span> p<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> r<span class="token punctuation">.</span>parent<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> r<span class="token punctuation">;</span>
            r <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä¸‰ã€ä¸»è¦æ–¹æ³•è§£æ"><a href="#ä¸‰ã€ä¸»è¦æ–¹æ³•è§£æ" class="headerlink" title="ä¸‰ã€ä¸»è¦æ–¹æ³•è§£æ"></a>ä¸‰ã€ä¸»è¦æ–¹æ³•è§£æ</h2><h3 id="3-1-hash-Object-key"><a href="#3-1-hash-Object-key" class="headerlink" title="3.1  hash(Object key)"></a>3.1  hash(Object key)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * keyé¦–å…ˆç»è¿‡åŸç”Ÿçš„hashæ–¹æ³•åè¿”å›intç±»å‹çš„hashå€¼ï¼Œå°†è¯¥å€¼çš„é«˜16ä½å³ç§»ä¼ é€’åˆ°ä½16ä½å¹¶ä¸åŸæ¥çš„å€¼å¼‚æˆ–è¿ç®—ã€‚
 * è¿™æ ·å¤„ç†æ˜¯ä¸ºäº†å°†keyçš„hashå€¼çš„é«˜ä½ç‰¹å¾ä¼ é€’åˆ°ä½ä½ï¼Œé™ä½hashå†²çªçš„æ¦‚ç‡ã€‚
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> h<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="3-2-put-K-key-V-value"><a href="#3-2-put-K-key-V-value" class="headerlink" title="3.2  put(K key, V value)"></a>3.2  put(K key, V value)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * åœ¨mapä¸­å°†æŒ‡å®šçš„é”®å’Œå€¼è¿›è¡Œå…³è”æ˜ å°„ï¼Œå¦‚æœmapä¸­å·²ç»å­˜åœ¨è¯¥é”®çš„æ˜ å°„å…³ç³»ï¼Œ
 * é‚£ä¹ˆmapä¸­è¯¥é”®å…³è”çš„å€¼å°†è¢«æ›¿æ¢ã€‚
 *
 * @param key key with which the specified value is to be associated
 * @param value value to be associated with the specified key
 * @return è¿”å›keyå…³è”çš„æ—§å€¼ï¼Œå¦‚æœåŸæ¥keyå…³è”çš„ä¸ºnullï¼Œåˆ™è¿”å›null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Implements Map.put and related methods
 *
 * @param hash hash for key
 * @param key the key
 * @param value the value to put
 * @param onlyIfAbsent if true, don't change existing value
 * @param evict if false, the table is in creation mode.
 * @return previous value, or null if none
 */</span>
<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> 
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> 
    <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token comment">// talbeåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// keyçš„hashå€¼æœªäº§ç”Ÿhashå†²çªï¼Œåˆ™å°†valueä½œä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨åˆ°mapä¸­</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> 
        <span class="token class-name">K</span> k<span class="token punctuation">;</span>
        <span class="token comment">// å‡ºç°hashå†²çªï¼Œä¸”keyä¸ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç›¸åŒï¼Œç”¨èŠ‚ç‚¹eæ ‡è®°è¯¥èŠ‚ç‚¹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token comment">// keyæ‰€å¯¹åº”çš„æ§½ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸ºTreeNode</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// å‡ºç°hashå†²çªåï¼Œéå†åˆ—è¡¨</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// éå†åˆ—è¡¨ï¼Œå¦‚æ— é‡å¤keyå€¼ï¼Œå°†valueå€¼æ·»åŠ åˆ°åˆ—è¡¨æœ«å°¾</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å¦‚æœåˆ—è¡¨é•¿åº¦å¤§äºç­‰äºé˜ˆå€¼8ï¼Œåˆ™å°†åˆ—è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// å¦‚æœåˆ—è¡¨ä¸­å­˜åœ¨é‡å¤çš„keyï¼Œç”¨èŠ‚ç‚¹eæ ‡è®°å·²å­˜åœ¨çš„èŠ‚ç‚¹</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// å·²å­˜åœ¨keyçš„æ˜ å°„</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// existing mapping for key</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token comment">// onlyIfAbsentä¸ºfalseæˆ–æ—§å€¼ä¸ºnullï¼Œå°†æ–°çš„valueæ˜ å°„åˆ°mapä¸­</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token comment">// </span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿”å›keyå…³è”çš„æ—§å€¼</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token comment">// mapä¸­æ•°æ®é‡å¤§äºå®¹é‡é˜ˆå€¼ï¼ˆå®¹é‡*åŠ è½½å› å­ï¼‰ï¼Œmapè¿›è¡Œæ‰©å®¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-3-resize"><a href="#3-3-resize" class="headerlink" title="3.3  resize()"></a>3.3  resize()</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼ˆ2å€ï¼‰ï¼Œ  å¦‚æœä¸ºnullï¼Œåˆ™æŒ‰ç…§åˆå§‹å®¹é‡åˆ†é…ï¼Œå¦åˆ™ä»¥2çš„å€æ•°è¿›è¡Œæ‰©å®¹ã€‚
 * @return the table
 */</span>
<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å¦‚æœæœªè¶…è¿‡å®¹é‡æœ€å¤§å€¼ï¼Œåˆ™æ‰©å®¹2å€</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span>
                 oldCap <span class="token operator">>=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span>
            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// double threshold</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// initial capacity was placed in threshold</span>
        <span class="token comment">// åˆå§‹åŒ–å®¹é‡</span>
        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// zero initial threshold signifies using defaults</span>
        <span class="token comment">// åˆå§‹å®¹é‡å€¼ä¸º0ï¼Œåˆå§‹åŒ–æ—¶å®¹é‡ä¸ºé»˜è®¤å¤§å°16</span>
        newCap <span class="token operator">=</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_LOAD_FACTOR</span> <span class="token operator">*</span> <span class="token constant">DEFAULT_INITIAL_CAPACITY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åˆå§‹åŒ–é˜ˆå€¼ï¼ˆåˆå§‹å®¹é‡ * åŠ è½½å› å­ï¼‰</span>
        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">?</span>
                  <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token comment">// å®¹é‡æ‰©å¤§ä¸ºåŸæ¥çš„ä¸¤å€</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è¿›è¡Œrehashï¼ŒæŠŠæ•°æ®è½¬ç§»çš„æ‰©å®¹åçš„HashMapä¸­</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token comment">// hashæ§½ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œç›´æ¥è½¬ç§»è¿‡å»</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token comment">// èŠ‚ç‚¹ç±»å‹ä¸ºæ ‘èŠ‚ç‚¹ï¼Œåˆ—è¡¨å·²è½¬ä¸ºçº¢é»‘æ ‘äº†</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// preserve order</span>
                    
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
                    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                        <span class="token comment">// HashMapæ§½ä¸­çš„æ•°æ®ä¸ºåˆ—è¡¨æ—¶ï¼Œç”±äºHashMapæ‰©å®¹åå®¹é‡å˜ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œé€š                             // è¿‡ `e.hash &amp; oldCap` è¿ç®—ï¼Œå¦‚æœç»“æœç­‰äº0ï¼Œ åˆ™è¡¨ç¤ºå½“å‰å…ƒç´ åœ¨æ–°                                 // tableä¸­ä½ç½®ä¸åŸæ¥ç›¸åŒï¼Œå¦‚æœä¸ç­‰äº0ï¼Œåˆ™åœ¨æ–°tableä¸­ä½ç½®éœ€è¦å¢åŠ åŸæ¥çš„                             // å®¹é‡oldCap</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-4-treeifyBin-Node-tab-int-hash"><a href="#3-4-treeifyBin-Node-tab-int-hash" class="headerlink" title="3.4  treeifyBin(Node&lt;K,V&gt;[] tab, int hash)"></a>3.4  treeifyBin(Node&lt;K,V&gt;[] tab, int hash)</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å°†åˆ—è¡¨è½¬çº¢é»‘æ ‘
 */</span>
<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">treeifyBin</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">,</span> <span class="token keyword">int</span> hash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> n<span class="token punctuation">,</span> index<span class="token punctuation">;</span> 
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœæ•°ç»„ä¸ºnullæˆ–æ•°ç»„å®¹é‡å°äºåˆ—è¡¨è½¬çº¢é»‘æ ‘çš„é˜ˆå€¼ï¼ˆ64ï¼‰ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–æˆ–æ‰©å®¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">MIN_TREEIFY_CAPACITY</span><span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> tab<span class="token punctuation">[</span>index <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hd <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// å°†åˆ—è¡¨èŠ‚ç‚¹è½¬æ¢ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹</span>
            <span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token function">replacementTreeNode</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tl <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                hd <span class="token operator">=</span> p<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                p<span class="token punctuation">.</span>prev <span class="token operator">=</span> tl<span class="token punctuation">;</span>
                tl<span class="token punctuation">.</span>next <span class="token operator">=</span> p<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            tl <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> hd<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            hd<span class="token punctuation">.</span><span class="token function">treeify</span><span class="token punctuation">(</span>tab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€å¤šçº¿ç¨‹ä¸‹HashMapæ­»å¾ªç¯é—®é¢˜åˆ†æ"><a href="#å››ã€å¤šçº¿ç¨‹ä¸‹HashMapæ­»å¾ªç¯é—®é¢˜åˆ†æ" class="headerlink" title="å››ã€å¤šçº¿ç¨‹ä¸‹HashMapæ­»å¾ªç¯é—®é¢˜åˆ†æ"></a>å››ã€å¤šçº¿ç¨‹ä¸‹HashMapæ­»å¾ªç¯é—®é¢˜åˆ†æ</h2><p>HashMapå¤šçº¿ç¨‹ä¸‹æ­»å¾ªç¯é—®é¢˜åœ¨JDK1.7å­˜åœ¨ï¼ŒJDK1.8å·²ç»è§£å†³äº†æ­»å¾ªç¯çš„é—®é¢˜ï¼Œä½†ä»ç„¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<blockquote>
<p>JDK1.7å¤šçº¿ç¨‹ä¸‹æ­»å¾ªç¯ä»£ç åˆ†æ</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Rehashes the contents of this map into a new array with a
 * larger capacity.  This method is called automatically when the
 * number of keys in this map reaches its threshold.
 *
 * If current capacity is MAXIMUM_CAPACITY, this method does not
 * resize the map, but sets threshold to Integer.MAX_VALUE.
 * This has the effect of preventing future calls.
 *
 * @param newCapacity the new capacity, MUST be a power of two;
 *        must be greater than current capacity unless current
 *        capacity is MAXIMUM_CAPACITY (in which case value
 *        is irrelevant).
 */</span>
<span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTable <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> oldTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">==</span> <span class="token constant">MAXIMUM_CAPACITY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>newCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">transfer</span><span class="token punctuation">(</span>newTable<span class="token punctuation">,</span> <span class="token function">initHashSeedAsNeeded</span><span class="token punctuation">(</span>newCapacity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table <span class="token operator">=</span> newTable<span class="token punctuation">;</span>
    threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>newCapacity <span class="token operator">*</span> loadFactor<span class="token punctuation">,</span> <span class="token constant">MAXIMUM_CAPACITY</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Transfers all entries from current table to newTable.
 */</span>
<span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> rehash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">:</span> table<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rehash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token operator">==</span> e<span class="token punctuation">.</span>key <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token function">hash</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
            e <span class="token operator">=</span> next<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ä¸Šè¿°ä»£ç åœ¨å¤šçº¿ç¨‹ä¸‹å‡ºç°æ­»å¾ªç¯çš„åœ°æ–¹åœ¨transferæ–¹æ³•çš„å†…çš„do-whileå¾ªç¯å†…ï¼Œå‡è®¾çº¿ç¨‹1åœ¨æ‰§è¡Œdo-whileå¾ªç¯çš„ç¬¬2è¡Œä»£ç æ—¶è¢«æŒ‚èµ·ï¼Œæ­¤æ—¶çº¿ç¨‹1çš„è®°å½•äº†eèŠ‚ç‚¹ä¿¡æ¯å’Œe.nextèŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚æœæ­¤æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹å®Œæˆäº†æ•´ä¸ªæ‰©å®¹æ“ä½œï¼Œæ­¤æ—¶çº¿ç¨‹1å†æ¬¡æ‰§è¡Œï¼Œç”±äºçº¿ç¨‹2åœ¨æ‰§è¡Œæ‰©å®¹æ—¶ï¼Œåˆ—è¡¨æŒ‰ç…§å¤´æ’æ³•çš„æ–¹å¼æ’å…¥ï¼Œçº¿ç¨‹1è®°å½•çš„ä»æ˜¯åŸåˆ—è¡¨çš„é¡ºåºï¼Œçº¿ç¨‹1ç»§ç»­æ“ä½œï¼Œä¼šå¯¼è‡´åˆ—è¡¨é¦–ä½ç›¸è¿ï¼Œä»è€Œäº§ç”Ÿæ­»å¾ªç¯ã€‚</p>
<p> æ­¤å¤–ï¼ŒHashMapåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿˜å¯èƒ½å¯¼è‡´putæ“ä½œå¯¼è‡´å…ƒç´ ä¸¢å¤±ã€‚</p>
<p>æ­»å¾ªç¯äº§ç”Ÿçš„å…·ä½“è¿‡ç¨‹å¯å‚è€ƒï¼š[<a href="https://www.cnblogs.com/dongguacai/p/5599100.html">æ·±å…¥ç†è§£JAVAé›†åˆç³»åˆ—ä¸‰ï¼šHashMapçš„æ­»å¾ªç¯è§£è¯»</a>]</p>
</blockquote>
<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><ul>
<li>HashMapåº•å±‚åŸºäºæ•°ç»„å’Œåˆ—è¡¨æ¥å®ç°çš„ï¼Œå°†keyç»è¿‡hashæ•£åˆ—å†æŒ‰æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œå®šä½åˆ°ä¸€ä¸ªhashæ§½ï¼Œå°†key-valueå€¼ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨åˆ°hashæ§½ä¸­ï¼Œå¦‚æœæ§½ä¸­å‡ºç°hashå†²çªï¼Œåˆ™ä»¥åˆ—è¡¨çš„å½¢å¼å­˜å‚¨èŠ‚ç‚¹ï¼Œå½“åˆ—è¡¨é•¿åº¦å¤§äºç­‰äº8æ—¶ä¸”mapä¸­æ€»ç»“ç‚¹ä¸ªæ•°å¤§äºç­‰äº64æ—¶ï¼Œåˆ™å°†åˆ—è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</li>
<li>å½“HashMapä¸­çš„èŠ‚ç‚¹ä¸ªæ•°è¶…è¿‡å®¹é‡é˜ˆå€¼ï¼ˆå®¹é‡*åŠ è½½å› å­ï¼‰æ—¶ï¼ŒHashMapä¼šè¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹æ˜¯ä¼šè¿›è¡Œrehashã€‚</li>
<li>å½“HashMapä¸­æŸä¸ªæ§½ä¸­çš„å…ƒç´ ä¸ªæ•°å¤§äºç­‰äº8ä¸”æ€»å…ƒç´ ä¸ªæ•°å°äº64æ—¶ï¼Œè¿™æ—¶å€™HashMapä¼šè¿›è¡Œæ‰©å®¹è€Œä¸æ˜¯è½¬ä¸ºçº¢é»‘æ ‘ã€‚</li>
<li>HashMapçš„åˆå§‹å®¹é‡è®¾ç½®æˆinitialCapacity &#x3D; (éœ€è¦å­˜å‚¨çš„å…ƒç´ ä¸ªæ•° &#x2F; è´Ÿè½½å› å­) + 1ï¼Œå¦‚æœä¸ç¡®å®šï¼Œè®¾ç½®ä¸º16ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</li>
<li>åœ¨JDK1.8ä¸­ï¼Œå½“HashMapæŸä¸ªæ§½ä¸­çš„å…ƒç´ ä¸ªæ•°å¤§äºç­‰äº8æ—¶ï¼Œä¸”æ€»å…ƒç´ ä¸ªæ•°è¶…è¿‡64ï¼Œåˆ™å°†åˆ—è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘æé«˜æŸ¥æ‰¾é€Ÿåº¦ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title>IntelliJ IDEAå¿«æ·é”®ä½¿ç”¨</title>
    <url>/2021/12/28/java/intellij-idea-kuai-jie-jian-shi-yong/</url>
    <content><![CDATA[<h1 id="å·¥å…·ç”¨å¾—å¥½ï¼Œä¸‹ç­ä¸‹å¾—æ—©"><a href="#å·¥å…·ç”¨å¾—å¥½ï¼Œä¸‹ç­ä¸‹å¾—æ—©" class="headerlink" title="å·¥å…·ç”¨å¾—å¥½ï¼Œä¸‹ç­ä¸‹å¾—æ—©"></a>å·¥å…·ç”¨å¾—å¥½ï¼Œä¸‹ç­ä¸‹å¾—æ—©</h1><h2 id="Ctrl-Alt-T"><a href="#Ctrl-Alt-T" class="headerlink" title="Ctrl + Alt + T"></a>Ctrl + Alt + T</h2><p>ä½¿ç”¨ifï¼Œif&#x2F;else, while, do&#x2F;while, for, try&#x2F;catch, try&#x2F;finally, try&#x2F;catch&#x2F;finally, synchronized, Runnalbe åŒ…å›´ä»£ç å—</p>
<h2 id="Alt-Enter"><a href="#Alt-Enter" class="headerlink" title="Alt + Enter"></a>Alt + Enter</h2><p>ä»£ç å¿«é€Ÿè¡¥å…¨ã€åŒ…å¼•å…¥ã€ä¸´æ—¶å˜é‡ç”Ÿæˆç­‰</p>
<h2 id="Ctrl-Alt-M"><a href="#Ctrl-Alt-M" class="headerlink" title="Ctrl + Alt + M"></a>Ctrl + Alt + M</h2><p>å°†ä»£ç å—æå–åˆ°ä¸€ä¸ªæ–¹æ³•</p>
<h2 id="Ctrl-Shift-ä¸Šä¸‹æ–¹å‘é”®"><a href="#Ctrl-Shift-ä¸Šä¸‹æ–¹å‘é”®" class="headerlink" title="Ctrl + Shift + ä¸Šä¸‹æ–¹å‘é”®"></a>Ctrl + Shift + ä¸Šä¸‹æ–¹å‘é”®</h2><p>ä¸Šä¸‹ç§»åŠ¨å•è¡Œä»£ç å’Œä»£ç å—</p>
<h2 id="Class-new-ï¼ˆAlt-Enterï¼‰"><a href="#Class-new-ï¼ˆAlt-Enterï¼‰" class="headerlink" title="Class.new + ï¼ˆAlt + Enterï¼‰"></a>Class.new + ï¼ˆAlt + Enterï¼‰</h2><p><code>Class.new</code>åˆ›å»ºä¸€ä¸ªClassç±»å‹çš„åŒ¿åå¯¹è±¡ï¼Œ<code>Alt + Enter</code>å°†åŒ¿åå¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªæ–°å»ºçš„å˜é‡</p>
<h2 id="instance-try"><a href="#instance-try" class="headerlink" title="instance.try"></a>instance.try</h2><p>æ ¹æ®instanceå®ä¾‹å¯¹è±¡å¿«é€Ÿç”Ÿæˆtry&#x2F;catchä»£ç å—</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IDEA</tag>
        <tag>å¿«æ·é”®</tag>
      </tags>
  </entry>
  <entry>
    <title>Java å’Œ HTTP çš„é‚£äº›äº‹ï¼ˆå››ï¼‰ HTTPS å’Œ è¯ä¹¦</title>
    <url>/2020/07/09/java/java-he-http-de-na-xie-shi-si-https-he-zheng-shu/</url>
    <content><![CDATA[<blockquote>
<p>éåŸåˆ›ï¼Œè½¬è½½äºï¼š<a href="https://www.aneasystone.com/archives/2016/04/java-and-https.html">https://www.aneasystone.com/archives/2016/04/java-and-https.html</a></p>
</blockquote>
<p>è¯´èµ· HTTP çš„é‚£äº›äº‹ï¼Œåˆ™ä¸å¾—ä¸æ HTTPS ï¼Œè€Œè¯´èµ· HTTPS ï¼Œåˆ™ä¸å¾—ä¸ææ•°å­—è¯ä¹¦ã€‚è¿™ç¯‡åšå®¢å°†ä» Java çš„è§’åº¦ï¼Œå­¦ä¹  HTTPS å’Œæ•°å­—è¯ä¹¦æŠ€æœ¯ï¼Œå¹¶åˆ†äº«çˆ¬è™«å¼€å‘çš„è¿‡ç¨‹ä¸­é’ˆå¯¹çˆ¬å– HTTPS ç«™ç‚¹æ—¶å¯èƒ½é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚<br>åœ¨å‰é¢çš„å‡ ç¯‡åšå®¢é‡Œï¼Œå…¶å®å·²ç»ç•¥å¾®æåˆ°è¿‡ HTTPS äº†ï¼Œè­¬å¦‚ä½¿ç”¨ <code>HttpsURLConnection</code> ç±»å‘é€ HTTPS è¯·æ±‚ï¼Œåœ¨ä½¿ç”¨ä»£ç†æ—¶ HTTP å’Œ HTTPS çš„ä¸€äº›å·®å¼‚ç­‰ç­‰ã€‚å…³äº HTTPS çš„æ¦‚å¿µå°±ä¸åºŸè¯äº†ï¼Œä¸‹é¢ç›´æ¥è¿›å…¥æ­£é¢˜ã€‚</p>
<h2 id="ä¸€ã€è®¿é—®-HTTPS-ç«™ç‚¹"><a href="#ä¸€ã€è®¿é—®-HTTPS-ç«™ç‚¹" class="headerlink" title="ä¸€ã€è®¿é—® HTTPS ç«™ç‚¹"></a>ä¸€ã€è®¿é—® HTTPS ç«™ç‚¹</h2><p>åœ¨å‰é¢çš„ç¬¬ä¸€ç¯‡åšå®¢<a href="https://www.aneasystone.com/archives/2015/12/java-and-http-one.html">ã€Šæ¨¡æ‹Ÿ HTTP è¯·æ±‚ã€‹</a>é‡Œï¼Œä»‹ç»äº†ä¸¤ç§æ–¹æ³•æ¥æ¨¡æ‹Ÿå‘é€ HTTP è¯·æ±‚ï¼Œè®¿é—® HTTP ç«™ç‚¹ã€‚ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ java.net è‡ªå¸¦çš„ <code>HttpURLConnection</code>ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ Apache çš„ <code>HttpClient</code>ï¼Œè¿™ä¸¤ç§æ–¹å¼å„æœ‰å„çš„ä¼˜åŠ¿ã€‚è¿™é‡Œä¹Ÿä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼æ¥è®¿é—® HTTPS ç«™ç‚¹ï¼Œä»ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå’Œå‰é¢è®¿é—® HTTP ç«™ç‚¹å‡ ä¹å®Œå…¨ä¸€æ ·ã€‚</p>
<h3 id="1-1-ä½¿ç”¨-HttpURLConnection"><a href="#1-1-ä½¿ç”¨-HttpURLConnection" class="headerlink" title="1.1 ä½¿ç”¨ HttpURLConnection"></a>1.1 ä½¿ç”¨ HttpURLConnection</h3><pre class="line-numbers language-none"><code class="language-none">@Test
public void basicHttpsGet() throws Exception &#123;
     
    String url &#x3D; &quot;https:&#x2F;&#x2F;www.baidu.com&quot;;
    URL obj &#x3D; new URL(url);
 
    HttpsURLConnection con &#x3D; (HttpsURLConnection) obj.openConnection();    
    con.setRequestProperty(&quot;User-Agent&quot;, &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) ...&quot;);
    con.setRequestProperty(&quot;Accept-Language&quot;, &quot;en-US,en;q&#x3D;0.5&quot;);
    con.setRequestMethod(&quot;GET&quot;);
 
    String responseBody &#x3D; readResponseBody(con.getInputStream());
    System.out.println(responseBody);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-2-ä½¿ç”¨-HttpClient"><a href="#1-2-ä½¿ç”¨-HttpClient" class="headerlink" title="1.2 ä½¿ç”¨ HttpClient"></a>1.2 ä½¿ç”¨ HttpClient</h3><pre class="line-numbers language-none"><code class="language-none">@Test
public void basicHttpsGet() throws Exception &#123;
     
    String url &#x3D; &quot;https:&#x2F;&#x2F;www.baidu.com&quot;;    
    HttpGet request &#x3D; new HttpGet(url);
    request.setHeader(&quot;User-Agent&quot;, &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) ...&quot;);
     
    CloseableHttpClient httpclient &#x3D; HttpClients.createDefault();
    CloseableHttpResponse response &#x3D; httpclient.execute(request);
    String responseBody &#x3D; readResponseBody(response);
    System.out.println(responseBody);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å…·ä½“çš„ä»£ç è§£é‡Šå‚è§ç¬¬ä¸€ç¯‡åšå®¢ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè®¿é—® HTTPS ç«™ç‚¹å°±å’Œè®¿é—® HTTP ç«™ç‚¹ä¸€æ ·ç®€å•ï¼Œæ— è®ºæ˜¯ HttpURLConnection è¿˜æ˜¯ HttpClient ï¼Œéƒ½å°†åº•å±‚çš„å®ç°ç»†èŠ‚å°è£…äº†èµ·æ¥ï¼Œç»™æˆ‘ä»¬æä¾›äº†ä¸€è‡´çš„å¯¹å¤–æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨å…³å¿ƒ HTTPS çš„å®ç°åŸç†ã€‚å¯¹åº•å±‚ç»†èŠ‚çš„å°è£…ï¼Œæœ¬æ¥æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä¹Ÿæ˜¯ä¸€ç§å¥½çš„è®¾è®¡æ–¹å¼ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œä½†æ˜¯å¯¹äºé‚£äº›ä¸æ±‚ç”šè§£çš„äººæ¥è¯´ï¼Œå¯èƒ½å¸¦æ¥çš„å›°æƒ‘æ¯”ä¹‹å¸¦æ¥çš„æ–¹ä¾¿è¦æ›´å¤šã€‚</p>
<h3 id="1-3-é­é‡-PKIX-path-building-failed"><a href="#1-3-é­é‡-PKIX-path-building-failed" class="headerlink" title="1.3 é­é‡ PKIX path building failed"></a>1.3 é­é‡ PKIX path building failed</h3><p>ä½¿ç”¨ä¸Šé¢çš„ä»£ç ä½œä¸ºçˆ¬è™«ç¨‹åºçˆ¬å–æˆåƒä¸Šä¸‡çš„ç½‘é¡µï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯ HTTP ä¹Ÿå¥½ï¼ŒHTTPS ä¹Ÿç½¢ï¼Œéƒ½å¯ä»¥å¾ˆå¥½çš„å·¥ä½œã€‚ä¸è¿‡æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æ²¡é‚£ä¹ˆå¥½çš„è¿æ°”ï¼Œæœ‰äº›ç«™ç‚¹åœ¨å¢™å¤–ï¼Œè¢«å¼ºå¤§çš„é˜²ç«é•¿åŸæ‹’ä¹‹é—¨å¤–ï¼Œè¿™æ—¶ä½ å¯ä»¥æ‰¾ä¸€äº›å¢ƒå¤–ä»£ç†ï¼Œé€šè¿‡<a href="https://www.aneasystone.com/archives/2015/12/java-and-http-using-proxy.html">ã€Šä½¿ç”¨ä»£ç†ã€‹</a>è¿™ç¯‡åšå®¢ä¸­ä»‹ç»çš„æ–¹æ³•æ¥è§£å†³ï¼›æœ‰äº›ç«™ç‚¹éœ€è¦ä½¿ç”¨èº«ä»½è®¤è¯è¾“å…¥ç”¨æˆ·åå¯†ç æ‰èƒ½è®¿é—®ï¼Œè¿™å¯ä»¥ä½¿ç”¨ä¸Šä¸€ç¯‡åšå®¢<a href="https://www.aneasystone.com/archives/2016/03/java-and-http-authentication.html">ã€Šä»£ç†è®¤è¯ã€‹</a>ä¸­ä»‹ç»çš„æ–¹æ³•æ¥è§£å†³ï¼›å¦å¤–ï¼Œåœ¨è®¿é—®æœ‰äº› HTTPS ç«™ç‚¹æ—¶ï¼Œä½ è¿˜å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢çš„å¼‚å¸¸ï¼š</p>
<blockquote>
<p>javax.net.ssl.SSLHandshakeException:<br>sun.security.validator.ValidatorException: PKIX path building failed:<br>sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</p>
</blockquote>
<p>è¦è§£å†³è¿™ä¸ªå¼‚å¸¸ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¿™ç¯‡å°†è¦ä»‹ç»çš„å†…å®¹ã€‚</p>
<h2 id="äºŒã€è¯ä¹¦è®¤è¯çš„åŸç†"><a href="#äºŒã€è¯ä¹¦è®¤è¯çš„åŸç†" class="headerlink" title="äºŒã€è¯ä¹¦è®¤è¯çš„åŸç†"></a>äºŒã€è¯ä¹¦è®¤è¯çš„åŸç†</h2><p>å¤§å¤šæ•°äººç¬¬ä¸€æ¬¡é‡åˆ°ä¸Šé¢çš„å¼‚å¸¸æ—¶çš„ååº”ï¼Œä¼°è®¡éƒ½æ˜¯ä¸€è„¸èŒ«ç„¶ï¼Œå› ä¸ºè¿™ä¸ªå¼‚å¸¸ä¿¡æ¯æç¤ºæ¯”è¾ƒæ¨¡ç³Šï¼Œå¯¹äºä¸æ‡‚ HTTPS çš„äººæ¥è¯´ï¼Œä»€ä¹ˆ SSLHandshake ï¼Œä»€ä¹ˆ PKIX path ï¼Œå®Œå…¨ä¸çŸ¥æ‰€äº‘ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å…ˆå¼„æ‡‚ HTTPS çš„å·¥ä½œåŸç†ï¼Œæ‰å¥½å»è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“ HTTPS å…¶å®å°±æ˜¯ HTTP + SSL&#x2F;TLS çš„åˆä½“ï¼Œå®ƒå…¶å®è¿˜æ˜¯ HTTP åè®®ï¼Œåªæ˜¯åœ¨å¤–é¢åŠ äº†ä¸€å±‚ï¼ŒSSL æ˜¯ä¸€ç§åŠ å¯†å®‰å…¨åè®®ï¼Œå¼•å…¥ SSL çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³ HTTP åè®®åœ¨ä¸å¯ä¿¡ç½‘ç»œä¸­ä½¿ç”¨æ˜æ–‡ä¼ è¾“æ•°æ®å¯¼è‡´çš„å®‰å…¨æ€§é—®é¢˜ã€‚å¯ä»¥è¯´ï¼Œæ•´ä¸ªäº’è”ç½‘çš„é€šä¿¡å®‰å…¨ï¼Œéƒ½æ˜¯å»ºç«‹åœ¨ SSL&#x2F;TLS çš„å®‰å…¨æ€§ä¹‹ä¸Šçš„ã€‚</p>
<h3 id="2-1-SSL-TLS-åè®®åŠå…¶æ¡æ‰‹è¿‡ç¨‹"><a href="#2-1-SSL-TLS-åè®®åŠå…¶æ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="2.1 SSL&#x2F;TLS åè®®åŠå…¶æ¡æ‰‹è¿‡ç¨‹"></a>2.1 SSL&#x2F;TLS åè®®åŠå…¶æ¡æ‰‹è¿‡ç¨‹</h3><p>å­¦è¿‡è®¡ç®—æœºç½‘ç»œçš„åŒå­¦è‚¯å®šéƒ½è¿˜è®°å¾— TCP åœ¨å»ºç«‹è¿æ¥æ—¶çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¹‹æ‰€ä»¥éœ€è¦ TCP ä¸‰æ¬¡æ¡æ‰‹ï¼Œæ˜¯å› ä¸ºç½‘ç»œä¸­å­˜åœ¨å»¶è¿Ÿçš„é‡å¤åˆ†ç»„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨é‡å¤å»ºç«‹è¿æ¥é€ æˆä¸å¿…è¦çš„å¼€é”€ã€‚SSL&#x2F;TLS åè®®åœ¨å»ºç«‹è¿æ¥æ—¶ä¸æ­¤ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ¡æ‰‹ï¼Œä½†æ˜¯å…¶ç›®çš„å´å¤§ç›¸å¾„åº­ï¼Œåœ¨ SSL&#x2F;TLS æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å½¼æ­¤äº¤æ¢å¹¶éªŒè¯è¯ä¹¦ï¼Œå¹¶åå•†å‡ºä¸€ä¸ª â€œå¯¹è¯å¯†é’¥â€ ï¼Œåç»­çš„æ‰€æœ‰é€šä¿¡éƒ½ä½¿ç”¨è¿™ä¸ª â€œå¯¹è¯å¯†é’¥â€ è¿›è¡ŒåŠ å¯†ï¼Œä¿è¯é€šä¿¡å®‰å…¨ã€‚</p>
<p>ç½‘ä¸Šæœ‰å¾ˆå¤š SSL&#x2F;TLS æ¡æ‰‹çš„ç¤ºæ„å›¾ï¼Œå…¶ä¸­ä¸‹é¢è¿™å‰¯éå¸¸å…¨é¢ï¼Œä¹Ÿéå¸¸ä¸“ä¸šï¼Œæƒ³æ·±å…¥äº†è§£ SSL&#x2F;TLS çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸‹ã€‚</p>
<p><a href="http://www.cheat-sheets.org/saved-copy/Ssl_handshake_with_two_way_authentication_with_certificates-1.pdf">http://www.cheat-sheets.org/saved-copy/Ssl_handshake_with_two_way_authentication_with_certificates-1.pdf</a></p>
<p>é˜®ä¸€å³°åœ¨ä»–çš„ <a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">ã€ŠSSL&#x2F;TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°ã€‹</a> å’Œ <a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html">ã€Šå›¾è§£SSL&#x2F;TLSåè®®ã€‹</a> ä¸¤ç¯‡åšå®¢ä¸­è¯¦ç»†ä»‹ç»äº† SSL&#x2F;TLS çš„åŸç†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹çœ‹ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ <a href="https://publib.boulder.ibm.com/tividd/td/TRM/SC23-4822-00/zh_CN/HTML/user277.htm">IBM Tivoli Risk Manager ç”¨æˆ·æ‰‹å†Œ</a> é‡Œçš„ä¸€å¼ å›¾ï¼ˆå› ä¸ºè¿™å¼ å›¾æ¯”è¾ƒæµ…æ˜¾æ˜“æ‡‚ï¼‰æ¥å¤§æ¦‚çš„è¯´æ˜ä¸‹æˆ‘ä»¬åœ¨å¹³æ—¶ä½¿ç”¨æµè§ˆå™¨è®¿é—® HTTPS ç«™ç‚¹æ—¶ï¼Œä¸­é—´å‘ç”Ÿçš„æ¡æ‰‹è¿‡ç¨‹ã€‚</p>
<p><img src="https://www.aneasystone.com/usr/uploads/2016/04/3515553513.png" alt="ssl_handshake.png"></p>
<p>æ•´ä¸ª SSL&#x2F;TLS çš„æ¡æ‰‹å’Œé€šä¿¡è¿‡ç¨‹ï¼Œç®€å•æ¥è¯´ï¼Œå…¶å®å¯ä»¥åˆ†æˆä¸‹é¢ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>æ‰“æ‹›å‘¼<ul>
<li>å½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—® HTTPS ç«™ç‚¹æ—¶ï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨æ‰“ä¸ªæ‹›å‘¼ï¼ˆClientHelloï¼‰ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šå’Œæµè§ˆå™¨æ‰“ä¸ªæ‹›å‘¼ï¼ˆServerHelloï¼‰ã€‚æ‰€è°“çš„æ‰“æ‹›å‘¼ï¼Œå®é™…ä¸Šæ˜¯å‘Šè¯‰å½¼æ­¤å„è‡ªçš„ SSL&#x2F;TLS ç‰ˆæœ¬å·ä»¥åŠå„è‡ªæ”¯æŒçš„åŠ å¯†ç®—æ³•ç­‰ï¼Œè®©å½¼æ­¤æœ‰ä¸€ä¸ªåˆæ­¥äº†è§£ã€‚</li>
</ul>
</li>
<li>è¡¨æ˜èº«ä»½ã€éªŒè¯èº«ä»½<ul>
<li>ç¬¬äºŒæ­¥æ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€æ­¥ï¼Œä¹Ÿæ˜¯ HTTPS é€šä¿¡ä¸­çš„å…³é”®ã€‚ä¸ºäº†ä¿è¯é€šä¿¡çš„å®‰å…¨ï¼Œé¦–å…ˆè¦ä¿è¯æˆ‘æ­£åœ¨é€šä¿¡çš„äººç¡®å®å°±æ˜¯é‚£ä¸ªæˆ‘æƒ³ä¸ä¹‹é€šä¿¡çš„äººï¼ŒæœåŠ¡å™¨ä¼šå‘é€ä¸€ä¸ªè¯ä¹¦æ¥è¡¨æ˜è‡ªå·±çš„èº«ä»½ï¼Œæµè§ˆå™¨æ ¹æ®è¯ä¹¦é‡Œçš„ä¿¡æ¯è¿›è¡Œæ ¸å®ï¼ˆä¸ºä»€ä¹ˆé€šè¿‡è¯ä¹¦å°±å¯ä»¥è¯æ˜èº«ä»½å‘¢ï¼Ÿæ€ä¹ˆé€šè¿‡è¯ä¹¦æ¥éªŒè¯å¯¹æ–¹çš„èº«ä»½å‘¢ï¼Ÿè¿™ä¸ªåé¢å†è¯´ï¼‰ã€‚å¦‚æœæ˜¯åŒå‘è®¤è¯çš„è¯ï¼Œæµè§ˆå™¨ä¹Ÿä¼šå‘æœåŠ¡å™¨å‘é€å®¢æˆ·ç«¯è¯ä¹¦ã€‚</li>
<li>åŒæ–¹çš„èº«ä»½éƒ½éªŒè¯æ²¡é—®é¢˜ä¹‹åï¼Œæµè§ˆå™¨ä¼šå’ŒæœåŠ¡å™¨åå•†å‡ºä¸€ä¸ª â€œå¯¹è¯å¯†é’¥â€ ï¼Œè¦æ³¨æ„è¿™ä¸ª â€œå¯¹è¯å¯†é’¥â€ ä¸èƒ½ç›´æ¥å‘ç»™å¯¹æ–¹ï¼Œè€Œæ˜¯è¦ç”¨ä¸€ç§åªæœ‰å¯¹æ–¹æ‰èƒ½æ‡‚çš„æ–¹å¼å‘ç»™ä»–ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å¯†é’¥ä¸è¢«åˆ«äººæˆªè·ï¼ˆæˆ–è€…å°±ç®—è¢«æˆªè·äº†ä¹Ÿçœ‹ä¸æ‡‚ï¼‰ã€‚</li>
</ul>
</li>
<li>é€šä¿¡<ul>
<li>è‡³æ­¤ï¼Œæ¡æ‰‹å°±ç»“æŸäº†ã€‚åŒæ–¹å¼€å§‹èŠå¤©ï¼Œå¹¶é€šè¿‡ â€œå¯¹è¯å¯†é’¥â€ åŠ å¯†é€šä¿¡çš„æ•°æ®ã€‚</li>
</ul>
</li>
</ol>
<p>æ¡æ‰‹çš„è¿‡ç¨‹å¤§è‡´å¦‚æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»äº†è§£åˆ° HTTPS é€šä¿¡éœ€è¦è¿›è¡Œä¸€æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥ä¸Šé¢çœ‹åˆ°çš„ <code>javax.net.ssl.SSLHandshakeException</code> è¿™ä¸ªå¼‚å¸¸ï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾ç†è§£ï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯åœ¨ SSL&#x2F;TLS æ¡æ‰‹çš„è¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ã€‚å½“ç„¶ï¼Œè¿™å…¶ä¸­è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šç»†èŠ‚ï¼Œä¸‹é¢ç»§ç»­ã€‚</p>
<h3 id="2-2-HTTPS-ä¸­çš„å¯†ç å­¦"><a href="#2-2-HTTPS-ä¸­çš„å¯†ç å­¦" class="headerlink" title="2.2 HTTPS ä¸­çš„å¯†ç å­¦"></a>2.2 HTTPS ä¸­çš„å¯†ç å­¦</h3><p>HTTPS åè®®ä¹‹æ‰€ä»¥å¤æ‚ï¼Œæ˜¯ä¸ºäº†ä¿è¯é€šä¿¡è¿‡ç¨‹ä¸­æ•°æ®çš„å®‰å…¨æ€§ï¼Œè€Œè¦ä¿è¯é€šä¿¡å®‰å…¨ï¼Œå®ƒåœ¨åè®®ä¸­è¿ç”¨äº†å¤§é‡çš„å¯†ç å­¦åŸç†ï¼Œå¯ä»¥è¯´ HTTPS æ˜¯é›†å¯†ç å­¦ä¹‹å¤§æˆã€‚æ— è®ºæ˜¯åœ¨ SSL&#x2F;TLS æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯åœ¨åŠ å¯†é€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼ŒHTTPS éƒ½æ¶‰åŠäº†å¤§é‡çš„å¯†ç å­¦æ¦‚å¿µï¼Œè­¬å¦‚ï¼Œåœ¨è¯ä¹¦çš„æ•°å­—ç­¾åä¸­ä½¿ç”¨äº†å“ˆå¸Œç®—æ³•å’Œéå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œåœ¨åŠ å¯†é€šä¿¡çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä¸ºäº†é˜²æ­¢ä¼ è¾“çš„æ•°æ®è¢«ç¯¡æ”¹å’Œé‡æ”¾è¿˜ä½¿ç”¨äº† MACï¼ˆæ¶ˆæ¯è®¤è¯ç ï¼‰ç­‰ã€‚</p>
<p>è¦æƒ³æ·±å…¥äº†è§£ HTTPS çš„å·¥ä½œåŸç†ï¼Œä¸‹é¢è¿™äº›æ¦‚å¿µè¿˜æ˜¯å¾—å¥½å¥½ç ”ç©¶ä¸‹ï¼Œç½‘ä¸Šå·²ç»æœ‰å¾ˆå¤šæ–‡ç« ä»‹ç»è¿™äº›æ¦‚å¿µäº†ï¼Œæˆ‘åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p>
<ul>
<li>å“ˆå¸Œ<ul>
<li>å“ˆå¸Œç®—æ³•åˆç§°æ•£åˆ—ï¼Œå®ƒæ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬åŒ–ä¸ºå›ºå®šé•¿åº¦çš„ç®—æ³•</li>
<li>å“ˆå¸Œç®—æ³•æ˜¯ä¸å¯é€†çš„</li>
<li>å¸¸è§çš„å“ˆå¸Œç®—æ³•æœ‰ MD5 å’Œ SHA1</li>
</ul>
</li>
<li>å¯¹ç§°åŠ å¯†<ul>
<li>å¯¹ç§°åŠ å¯†æŒ‡çš„æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒä¸€ä¸ªå¯†é’¥</li>
<li>å¯¹ç§°åŠ å¯†çš„ä¼˜ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹æ˜¯å¯†é’¥ç®¡ç†ä¸æ–¹ä¾¿ï¼Œå¿…é¡»å…±äº«å¯†é’¥</li>
<li>å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ DESã€AESã€Blowfish ç­‰</li>
</ul>
</li>
<li>éå¯¹ç§°åŠ å¯†<ul>
<li>éå¯¹ç§°åŠ å¯†æŒ‡çš„æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å…¬é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§é’¥ï¼Œå…¬é’¥æ˜¯å…¬å¼€çš„ï¼Œç§é’¥åªæœ‰è‡ªå·±çŸ¥é“</li>
<li>ä½¿ç”¨å…¬é’¥åŠ å¯†çš„æ•°æ®å¿…é¡»ä½¿ç”¨ç§é’¥è§£å¯†ï¼Œä½¿ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®å¿…é¡»ä½¿ç”¨å…¬é’¥è§£å¯†</li>
<li>å…¬é’¥å’Œç§é’¥ä¹‹é—´å­˜åœ¨ç€æŸç§è”ç³»ï¼Œä½†æ˜¯ä»å…¬é’¥ä¸èƒ½ï¼ˆæˆ–å¾ˆéš¾ï¼‰æ¨å¯¼å‡ºç§é’¥</li>
<li>éå¯¹ç§°åŠ å¯†çš„ç¼ºç‚¹æ˜¯é€Ÿåº¦æ…¢ï¼Œä¼˜ç‚¹æ˜¯å¯†é’¥ç®¡ç†å¾ˆæ–¹ä¾¿</li>
<li>å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ RSAã€ECC ç­‰</li>
</ul>
</li>
<li>æ•°å­—è¯ä¹¦</li>
</ul>
<h3 id="2-3-å…³äºè¯ä¹¦"><a href="#2-3-å…³äºè¯ä¹¦" class="headerlink" title="2.3 å…³äºè¯ä¹¦"></a>2.3 å…³äºè¯ä¹¦</h3><p>ç®€å•æ¥è¯´ï¼Œæ•°å­—è¯ä¹¦å°±å¥½æ¯”ä»‹ç»ä¿¡ä¸Šçš„å…¬ç« ï¼Œæœ‰äº†å®ƒï¼Œå°±å¯ä»¥è¯æ˜è¿™ä»½ä»‹ç»ä¿¡ç¡®å®æ˜¯ç”±æŸä¸ªå…¬å¸å‘å‡ºçš„ï¼Œè€Œè¯ä¹¦å¯ä»¥ç”¨æ¥è¯æ˜ä»»ä½•ä¸€ä¸ªä¸œè¥¿çš„èº«ä»½ï¼Œåªè¦è¿™ä¸ªä¸œè¥¿èƒ½å‡ºç¤ºä¸€ä»½è¯æ˜è‡ªå·±èº«ä»½çš„è¯ä¹¦å³å¯ï¼Œè­¬å¦‚å¯ä»¥ç”¨æ¥éªŒè¯æŸä¸ªç½‘ç«™çš„èº«ä»½ï¼Œå¯ä»¥éªŒè¯æŸä¸ªæ–‡ä»¶æ˜¯å¦å¯ä¿¡ç­‰ç­‰ã€‚<a href="https://program-think.blogspot.com/2010/02/introduce-digital-certificate-and-ca.html">ã€Šæ•°å­—è¯ä¹¦åŠ CA çš„æ‰«ç›²ä»‹ç»ã€‹</a> å’Œ <a href="http://www.cnblogs.com/JeffreySun/archive/2010/06/24/1627247.html">ã€Šæ•°å­—è¯ä¹¦åŸç†ã€‹</a> è¿™ç¯‡åšå®¢å¯¹æ•°å­—è¯ä¹¦è¿›è¡Œäº†å¾ˆé€šä¿—çš„ä»‹ç»ã€‚</p>
<p>çŸ¥é“äº†è¯ä¹¦æ˜¯ä»€ä¹ˆä¹‹åï¼Œæˆ‘ä»¬å¾€å¾€æ›´å…³å¿ƒå®ƒçš„åŸç†ï¼Œåœ¨ä¸Šé¢ä»‹ç» SSL&#x2F;TLS æ¡æ‰‹çš„æ—¶å€™ç•™äº†ä¸¤ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆé€šè¿‡è¯ä¹¦å°±å¯ä»¥è¯æ˜èº«ä»½å‘¢ï¼Ÿæ€ä¹ˆé€šè¿‡è¯ä¹¦æ¥éªŒè¯å¯¹æ–¹çš„èº«ä»½å‘¢ï¼Ÿ</p>
<p>è¿™å°±è¦ç”¨åˆ°ä¸Šé¢æ‰€è¯´çš„éå¯¹ç§°åŠ å¯†äº†ï¼Œéå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯ï¼šä½¿ç”¨å…¬é’¥åŠ å¯†çš„æ•°æ®å¿…é¡»ä½¿ç”¨ç§é’¥æ‰èƒ½è§£å¯†ï¼ŒåŒæ ·çš„ï¼Œä½¿ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®å¿…é¡»ä½¿ç”¨å…¬é’¥è§£å¯†ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸ªç‰¹ç‚¹ï¼Œç½‘ç«™å°±å¯ä»¥åœ¨è‡ªå·±çš„è¯ä¹¦ä¸­å…¬å¼€è‡ªå·±çš„å…¬é’¥ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„ç§é’¥å°†è‡ªå·±çš„èº«ä»½ä¿¡æ¯è¿›è¡ŒåŠ å¯†ä¸€èµ·å…¬å¼€å‡ºæ¥ï¼Œè¿™æ®µè¢«ç§é’¥åŠ å¯†çš„ä¿¡æ¯å°±æ˜¯è¯ä¹¦çš„æ•°å­—ç­¾åï¼Œæµè§ˆå™¨åœ¨è·å–åˆ°è¯ä¹¦ä¹‹åï¼Œé€šè¿‡è¯ä¹¦é‡Œçš„å…¬é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå¦‚æœèƒ½æˆåŠŸè§£å¯†ï¼Œåˆ™è¯´æ˜è¯ä¹¦ç¡®å®æ˜¯ç”±è¿™ä¸ªç½‘ç«™å‘å¸ƒçš„ï¼Œå› ä¸ºåªæœ‰è¿™ä¸ªç½‘ç«™çŸ¥é“ä»–è‡ªå·±çš„ç§é’¥ï¼ˆå¦‚æœä»–çš„ç§é’¥æ²¡æœ‰æ³„éœ²çš„è¯ï¼‰ã€‚</p>
<p>åœ¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼Œæœ€å‡ºä¼—çš„è«è¿‡äº RSA ç®—æ³•ï¼Œå…³äº RSA ç®—æ³•çš„æ•°å­¦ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒé˜®ä¸€å³°çš„<a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">ã€ŠRSAç®—æ³•åŸç†ï¼ˆä¸€ï¼‰ã€‹</a>å’Œ<a href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">ã€ŠRSAç®—æ³•åŸç†ï¼ˆäºŒï¼‰ã€‹</a>è¿™ä¸¤ç¯‡åšå®¢ï¼Œå¼ºçƒˆæ¨èã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœåªæ˜¯ç®€å•çš„å¯¹æ•°å­—ç­¾åè¿›è¡Œæ ¡éªŒçš„è¯ï¼Œè¿˜ä¸èƒ½å®Œå…¨ä¿è¯è¿™ä¸ªè¯ä¹¦ç¡®å®å°±æ˜¯ç½‘ç«™æ‰€æœ‰ï¼Œé»‘å®¢å®Œå…¨å¯ä»¥åœ¨ä¸­é—´è¿›è¡ŒåŠ«æŒï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹ç½‘ç«™èº«ä»½ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†è¯ä¹¦ä¸­çš„å…¬é’¥æ›¿æ¢æˆè‡ªå·±çš„å…¬é’¥ï¼Œè¿™æ ·æµè§ˆå™¨åŒæ ·å¯ä»¥è§£å¯†æ•°å­—ç­¾åï¼Œç­¾åä¸­èº«ä»½ä¿¡æ¯ä¹Ÿæ˜¯å®Œå…¨åˆæ³•çš„ã€‚è¿™å°±å¥½æ¯”é‚£äº›åœ°æ‘Šä¸Šä¼ªé€ å…¬ç« çš„å°è´©ï¼Œä»–ä»¬å¯ä»¥ä¼ªé€ å‡ºå’ŒçœŸæ­£çš„å…¬ç« å®Œå…¨ä¸€æ ·çš„å‡ºæ¥ä»¥å‡ä¹±çœŸã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¿¡æ¯å®‰å…¨çš„ä¸“å®¶ä»¬å¼•å…¥äº† CA è¿™ä¸ªä¸œè¥¿ï¼Œæ‰€è°“ CA ï¼Œå…¨ç§°ä¸º Certificate Authority ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯<a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81%E6%9C%BA%E6%9E%84">è¯ä¹¦æˆæƒä¸­å¿ƒ</a>ï¼Œå®ƒæ˜¯ä¸“é—¨è´Ÿè´£ç®¡ç†å’Œç­¾å‘è¯ä¹¦çš„ç¬¬ä¸‰æ–¹æœºæ„ã€‚å› ä¸ºè¯ä¹¦é¢å‘æœºæ„å…³ç³»åˆ°æ‰€æœ‰äº’è”ç½‘é€šä¿¡çš„èº«ä»½å®‰å…¨ï¼Œå› æ­¤ä¸€å®šè¦æ˜¯ä¸€ä¸ªéå¸¸æƒå¨çš„æœºæ„ï¼Œåƒ GeoTrustã€GlobalSign ç­‰ç­‰ï¼Œè¿™é‡Œæœ‰ä¸€ä»½<a href="https://www.sslshopper.com/certificate-authority-reviews.html">å¸¸è§çš„ CA æ¸…å•</a>ã€‚å¦‚æœä¸€ä¸ªç½‘ç«™éœ€è¦æ”¯æŒ HTTPS ï¼Œå®ƒå°±è¦ä¸€ä»½è¯ä¹¦æ¥è¯æ˜è‡ªå·±çš„èº«ä»½ï¼Œè€Œè¿™ä¸ªè¯ä¹¦å¿…é¡»ä» CA æœºæ„ç”³è¯·ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ç”³è¯·æ•°å­—è¯ä¹¦çš„ä»·æ ¼éƒ½ä¸è²ï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€äº›å…è´¹çš„è¯ä¹¦ä¾›ä¸ªäººä½¿ç”¨ï¼Œåƒæœ€è¿‘æ¯”è¾ƒç«çš„ <a href="https://letsencrypt.org/">Letâ€™s Encrypt</a> ã€‚ä»å®‰å…¨æ€§çš„è§’åº¦æ¥è¯´ï¼Œå…è´¹çš„å’Œæ”¶è´¹çš„è¯ä¹¦æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œéƒ½å¯ä»¥ä¸ºä½ çš„ç½‘ç«™æä¾›è¶³å¤Ÿé«˜çš„å®‰å…¨æ€§ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå¦‚æœä½ ä»æƒå¨æœºæ„è´­ä¹°äº†ä»˜è´¹çš„è¯ä¹¦ï¼Œä¸€æ—¦ç”±äºè¯ä¹¦å®‰å…¨é—®é¢˜å¯¼è‡´ç»æµæŸå¤±ï¼Œå¯ä»¥è·å¾—ä¸€ç¬”å·¨é¢çš„èµ”å¿ã€‚</p>
<p>å¦‚æœç”¨æˆ·æƒ³å¾—åˆ°ä¸€ä»½å±äºè‡ªå·±çš„è¯ä¹¦ï¼Œä»–åº”å…ˆå‘ CA æå‡ºç”³è¯·ã€‚åœ¨ CA åˆ¤æ˜ç”³è¯·è€…çš„èº«ä»½åï¼Œä¾¿ä¸ºä»–åˆ†é…ä¸€ä¸ªå…¬é’¥ï¼Œå¹¶ä¸” CA å°†è¯¥å…¬é’¥ä¸ç”³è¯·è€…çš„èº«ä»½ä¿¡æ¯ç»‘åœ¨ä¸€èµ·ï¼Œå¹¶ä¸ºä¹‹ç­¾å­—åï¼Œä¾¿å½¢æˆè¯ä¹¦å‘ç»™ç”³è¯·è€…ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·æƒ³é‰´åˆ«å¦ä¸€ä¸ªè¯ä¹¦çš„çœŸä¼ªï¼Œä»–å°±ç”¨ CA çš„å…¬é’¥å¯¹é‚£ä¸ªè¯ä¹¦ä¸Šçš„ç­¾å­—è¿›è¡ŒéªŒè¯ï¼Œä¸€æ—¦éªŒè¯é€šè¿‡ï¼Œè¯¥è¯ä¹¦å°±è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œé»‘å®¢å°±ä¸èƒ½ç®€å•çš„ä¿®æ”¹è¯ä¹¦ä¸­çš„å…¬é’¥äº†ï¼Œå› ä¸ºç°åœ¨å…¬é’¥æœ‰äº† CA çš„æ•°å­—ç­¾åï¼Œç”± CA æ¥è¯æ˜å…¬é’¥çš„æœ‰æ•ˆæ€§ï¼Œä¸èƒ½è½»æ˜“è¢«ç¯¡æ”¹ï¼Œè€Œé»‘å®¢è‡ªå·±çš„å…¬é’¥æ˜¯å¾ˆéš¾è¢« CA è®¤å¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— éœ€æ‹…å¿ƒè¯ä¹¦è¢«ç¯¡æ”¹çš„é—®é¢˜äº†ã€‚</p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†è¯ä¹¦çš„ç”³è¯·æµç¨‹ï¼ˆå›¾ç‰‡æ¥è‡ª<a href="https://blog.cnbluebox.com/blog/2014/03/24/shu-zi-zheng-shu/">åˆ˜å¤çš„æŠ€æœ¯åšå®¢</a>ï¼‰ï¼š</p>
<p><img src="https://www.aneasystone.com/usr/uploads/2016/04/3454538623.png" alt="shuzizhengshu_5.png"></p>
<p>CA è¯ä¹¦å¯ä»¥å…·æœ‰å±‚çº§ç»“æ„ï¼Œå®ƒå»ºç«‹äº†è‡ªä¸Šè€Œä¸‹çš„ä¿¡ä»»é“¾ï¼Œä¸‹çº§ CA ä¿¡ä»»ä¸Šçº§ CA ï¼Œä¸‹çº§ CA ç”±ä¸Šçº§ CA é¢å‘è¯ä¹¦å¹¶è®¤è¯ã€‚ è­¬å¦‚ Google çš„è¯ä¹¦é“¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://www.aneasystone.com/usr/uploads/2016/04/3953592763.png" alt="shuzizhengshu_6.png"></p>
<p>å¯ä»¥çœ‹å‡ºï¼šgoogle.com.hk çš„ SSL è¯ä¹¦ç”± Google Internet Authority G2 è¿™ä¸ª CA æ¥éªŒè¯ï¼Œè€Œ Google Internet Authority G2 ç”± GeoTrust Global CA æ¥éªŒè¯ï¼ŒGeoTrust Global CA ç”± Equifax Secure Certificate Authority æ¥éªŒè¯ã€‚è¿™ä¸ªæœ€é¡¶éƒ¨çš„è¯ä¹¦ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ ¹è¯ä¹¦ï¼ˆroot certificateï¼‰ï¼Œé‚£ä¹ˆè°æ¥éªŒè¯æ ¹è¯ä¹¦å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å®ƒè‡ªå·±ï¼Œæ ¹è¯ä¹¦è‡ªå·±è¯æ˜è‡ªå·±ï¼Œæ¢å¥è¯æ¥è¯´ä¹Ÿå°±æ˜¯æ ¹è¯ä¹¦æ˜¯ä¸éœ€è¦è¯æ˜çš„ã€‚æµè§ˆå™¨åœ¨éªŒè¯è¯ä¹¦æ—¶ï¼Œä»æ ¹è¯ä¹¦å¼€å§‹ï¼Œæ²¿ç€è¯ä¹¦é“¾çš„è·¯å¾„ä¾æ¬¡å‘ä¸‹éªŒè¯ï¼Œæ ¹è¯ä¹¦æ˜¯æ•´ä¸ªè¯ä¹¦é“¾çš„å®‰å…¨ä¹‹æœ¬ï¼Œå¦‚æœæ ¹è¯ä¹¦è¢«ç¯¡æ”¹ï¼Œæ•´ä¸ªè¯ä¹¦ä½“ç³»çš„å®‰å…¨å°†å—åˆ°å¨èƒã€‚æ‰€ä»¥ä¸è¦è½»æ˜“çš„ç›¸ä¿¡æ ¹è¯ä¹¦ï¼Œå½“ä¸‹æ¬¡ä½ è®¿é—®æŸä¸ªç½‘ç«™é‡åˆ°æç¤ºè¯´ï¼Œè¯·å®‰è£…æˆ‘ä»¬çš„æ ¹è¯ä¹¦ï¼Œå®ƒå¯ä»¥è®©ä½ è®¿é—®æˆ‘ä»¬ç½‘ç«™çš„ä½“éªŒæ›´æµç•…é€šä¿¡æ›´å®‰å…¨æ—¶ï¼Œæœ€å¥½ç•™ä¸ªå¿ƒçœ¼ã€‚åœ¨å®‰è£…ä¹‹å‰ï¼Œä¸å¦¨çœ‹çœ‹è¿™å‡ ç¯‡åšå®¢ï¼š<a href="https://www.jayxon.com/12306-certificate/">ã€Š12306çš„è¯ä¹¦é—®é¢˜ã€‹</a>ã€<a href="http://www.xieyidian.com/3213">ã€Šåœ¨çº¿ä¹°ç«è½¦ç¥¨ä¸ºä»€ä¹ˆè¦å®‰è£…æ ¹è¯ä¹¦ï¼Ÿã€‹</a>ã€‚</p>
<p>æœ€åæ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®ä¸Šé¢è¯´çš„è¿™äº›ï¼Œä»€ä¹ˆéå¯¹ç§°åŠ å¯†ï¼Œæ•°å­—ç­¾åï¼ŒCA æœºæ„ï¼Œæ ¹è¯ä¹¦ç­‰ç­‰ï¼Œå…¶å®éƒ½æ˜¯ PKI çš„æ ¸å¿ƒæ¦‚å¿µã€‚PKIï¼ˆPublic Key Infrastructureï¼‰ä¸­æ–‡ç§°ä½œå…¬é’¥åŸºç¡€è®¾æ–½ï¼Œå®ƒæä¾›å…¬é’¥åŠ å¯†å’Œæ•°å­—ç­¾åæœåŠ¡çš„ç³»ç»Ÿæˆ–å¹³å°ï¼Œæ–¹ä¾¿ç®¡ç†å¯†é’¥å’Œè¯ä¹¦ï¼Œä»è€Œå»ºç«‹èµ·ä¸€ä¸ªå®‰å…¨çš„ç½‘ç»œç¯å¢ƒã€‚è€Œæ•°å­—è¯ä¹¦æœ€å¸¸è§çš„æ ¼å¼æ˜¯ X.509 ï¼Œæ‰€ä»¥è¿™ç§å…¬é’¥åŸºç¡€è®¾æ–½åˆç§°ä¹‹ä¸º PKIX ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´å¼„æ‡‚äº†ä¸Šé¢çš„å¼‚å¸¸ä¿¡æ¯ï¼Œ<code>sun.security.validator.ValidatorException: PKIX path building failed</code>ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¿ç€è¯ä¹¦é“¾çš„è·¯å¾„éªŒè¯è¯ä¹¦æ—¶å‡ºç°å¼‚å¸¸ï¼ŒéªŒè¯å¤±è´¥äº†ã€‚</p>
<p>è®²äº†è¿™ä¹ˆå¤šï¼Œå…¨éƒ½æ˜¯äº›ç†è®ºçš„ä¸œè¥¿ï¼Œä¸‹é¢å¼€å§‹å®è·µå§ï¼Œçœ‹çœ‹æ€ä¹ˆè§£å†³è¿™ä¸ªå¼‚å¸¸ã€‚</p>
<h3 id="2-4-å…³äº-Java-é‡Œçš„è¯ä¹¦"><a href="#2-4-å…³äº-Java-é‡Œçš„è¯ä¹¦" class="headerlink" title="2.4 å…³äº Java é‡Œçš„è¯ä¹¦"></a>2.4 å…³äº Java é‡Œçš„è¯ä¹¦</h3><p>ä¸Šé¢æ‰€ä»‹ç»çš„æ˜¯æµè§ˆå™¨å¯¹è¯ä¹¦è¿›è¡ŒéªŒè¯çš„è¿‡ç¨‹ï¼Œæµè§ˆå™¨ä¿å­˜äº†ä¸€ä¸ªå¸¸ç”¨çš„ CA è¯ä¹¦åˆ—è¡¨ï¼Œåœ¨éªŒè¯è¯ä¹¦é“¾çš„æœ‰æ•ˆæ€§æ—¶ï¼Œç›´æ¥ä½¿ç”¨ä¿å­˜çš„è¯ä¹¦é‡Œçš„å…¬é’¥è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœåœ¨è¯ä¹¦åˆ—è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°æˆ–è€…æ‰¾åˆ°äº†ä½†æ˜¯æ ¡éªŒä¸é€šè¿‡ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šè­¦å‘Šç”¨æˆ·ï¼Œç”±ç”¨æˆ·å†³å®šæ˜¯å¦ç»§ç»­ã€‚ä¸æ­¤ç±»ä¼¼çš„ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¸€æ ·ä¿å­˜æœ‰ä¸€ä»½å¯ä¿¡çš„è¯ä¹¦åˆ—è¡¨ï¼Œè­¬å¦‚åœ¨ Windows ç³»ç»Ÿä¸‹ï¼Œä½ å¯ä»¥è¿è¡Œ <code>certmgr.msc</code> æ‰“å¼€è¯ä¹¦ç®¡ç†å™¨æŸ¥çœ‹ï¼Œè¿™äº›è¯ä¹¦å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨ Windows çš„æ³¨å†Œè¡¨ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½äºï¼š<code>\SOFTWARE\Microsoft\SystemCertificates\</code> è·¯å¾„ä¸‹ã€‚é‚£ä¹ˆåœ¨ Java ç¨‹åºä¸­æ˜¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„å‘¢ï¼Ÿ</p>
<p>å’Œæµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿç±»ä¼¼ï¼ŒJava åœ¨ JRE çš„å®‰è£…ç›®å½•ä¸‹ä¹Ÿä¿å­˜äº†ä¸€ä»½é»˜è®¤å¯ä¿¡çš„è¯ä¹¦åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨ä¸€èˆ¬æ˜¯ä¿å­˜åœ¨ <code>$JRE/lib/security/cacerts</code> æ–‡ä»¶ä¸­ã€‚è¦æŸ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ <a href="http://www.keystore-explorer.org/">KeyStore Explorer</a> è¿™æ ·çš„è½¯ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ JRE è‡ªå¸¦çš„ keytool å·¥å…·ï¼ˆåé¢å†ä»‹ç»ï¼‰ï¼Œcacerts æ–‡ä»¶çš„é»˜è®¤å¯†ç ä¸º <code>changeit</code> ï¼ˆä½†æ˜¯æˆ‘ä¿è¯ï¼Œå¤§å¤šæ•°äººéƒ½ä¸ä¼š change itï¼‰ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œè¯ä¹¦æœ‰å¾ˆå¤šç§ä¸åŒçš„å­˜å‚¨æ ¼å¼ï¼Œè­¬å¦‚ CA åœ¨å‘å¸ƒè¯ä¹¦æ—¶ï¼Œå¸¸å¸¸ä½¿ç”¨ PEM æ ¼å¼ï¼Œè¿™ç§æ ¼å¼çš„å¥½å¤„æ˜¯çº¯æ–‡æœ¬ï¼Œå†…å®¹æ˜¯ BASE64 ç¼–ç çš„ï¼Œè¯ä¹¦ä¸­ä½¿ç”¨ â€œâ€”â€“BEGIN CERTIFICATEâ€”â€“â€ å’Œ â€œâ€”â€“END CERTIFICATEâ€”â€“â€ æ¥æ ‡è¯†ã€‚å¦å¤–è¿˜æœ‰æ¯”è¾ƒå¸¸ç”¨çš„äºŒè¿›åˆ¶ DER æ ¼å¼ï¼Œåœ¨ Windows å¹³å°ä¸Šè¾ƒå¸¸ä½¿ç”¨çš„ PKCS#12 æ ¼å¼ç­‰ç­‰ã€‚å½“ç„¶ï¼Œä¸åŒæ ¼å¼çš„è¯ä¹¦ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>openssl</code> è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥è½¬æ¢ï¼Œå‚è€ƒ <a href="https://www.sslshopper.com/ssl-converter.html">SSL Converter</a> ï¼Œå¦å¤–ï¼Œæƒ³äº†è§£æ›´å¤šè¯ä¹¦æ ¼å¼çš„ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œï¼š<a href="https://blogs.msdn.microsoft.com/kaushal/2010/11/04/various-ssltls-certificate-file-typesextensions/">Various SSL&#x2F;TLS Certificate File Types&#x2F;Extensions</a> ã€‚</p>
<p>åœ¨ Java å¹³å°ä¸‹ï¼Œè¯ä¹¦å¸¸å¸¸è¢«å­˜å‚¨åœ¨ KeyStore æ–‡ä»¶ä¸­ï¼Œä¸Šé¢è¯´çš„ cacerts æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª KeyStore æ–‡ä»¶ï¼ŒKeyStore ä¸ä»…å¯ä»¥å­˜å‚¨æ•°å­—è¯ä¹¦ï¼Œè¿˜å¯ä»¥å­˜å‚¨å¯†é’¥ï¼Œå­˜å‚¨åœ¨ KeyStore æ–‡ä»¶ä¸­çš„å¯¹è±¡æœ‰ä¸‰ç§ç±»å‹ï¼šCertificateã€PrivateKey å’Œ SecretKey ã€‚Certificate å°±æ˜¯è¯ä¹¦ï¼ŒPrivateKey æ˜¯éå¯¹ç§°åŠ å¯†ä¸­çš„ç§é’¥ï¼ŒSecretKey ç”¨äºå¯¹ç§°åŠ å¯†ï¼Œæ˜¯å¯¹ç§°åŠ å¯†ä¸­çš„å¯†é’¥ã€‚KeyStore æ–‡ä»¶æ ¹æ®ç”¨é€”ï¼Œä¹Ÿæœ‰å¾ˆå¤šç§ä¸åŒçš„æ ¼å¼ï¼šJKSã€JCEKSã€PKCS12ã€DKS ç­‰ç­‰ï¼ŒPixelsTech ä¸Šæœ‰ä¸€ç³»åˆ—æ–‡ç« å¯¹ KeyStore æœ‰æ·±å…¥çš„ä»‹ç»ï¼Œå¯ä»¥å­¦ä¹ ä¸‹ï¼š<a href="http://www.pixelstech.net/article/1408345768-Different-types-of-keystore-in-Java----Overview">Different types of keystore in Java</a> ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰€è¯´çš„ KeyStore å…¶å®åªæ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼è€Œå·²ï¼Œå®é™…ä¸Šåœ¨ Java çš„ä¸–ç•Œé‡Œ KeyStore æ–‡ä»¶åˆ†æˆä¸¤ç§ï¼šKeyStore å’Œ TrustStoreï¼Œè¿™æ˜¯ä¸¤ä¸ªæ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼Œä¸è¿‡è¿™ä¸¤ä¸ªä¸œè¥¿ä»æ–‡ä»¶æ ¼å¼æ¥çœ‹å…¶å®æ˜¯ä¸€æ ·çš„ã€‚KeyStore ä¿å­˜ç§é’¥ï¼Œç”¨æ¥åŠ è§£å¯†æˆ–è€…ä¸ºåˆ«äººåšç­¾åï¼›TrustStore ä¿å­˜ä¸€äº›å¯ä¿¡ä»»çš„è¯ä¹¦ï¼Œè®¿é—® HTTPS æ—¶å¯¹è¢«è®¿é—®è€…è¿›è¡Œè®¤è¯ï¼Œä»¥ç¡®ä¿å®ƒæ˜¯å¯ä¿¡ä»»çš„ã€‚æ‰€ä»¥å‡†ç¡®æ¥è¯´ï¼Œä¸Šé¢çš„ cacerts æ–‡ä»¶åº”è¯¥å«åš TrustStore è€Œä¸æ˜¯ KeyStoreï¼Œåªæ˜¯å®ƒçš„æ–‡ä»¶æ ¼å¼æ˜¯ KeyStore æ–‡ä»¶æ ¼å¼ç½¢äº†ã€‚</p>
<p>é™¤äº† KeyStore å’Œ TrustStore ï¼ŒJava é‡Œè¿˜æœ‰ä¸¤ä¸ªç±» KeyManager å’Œ TrustManager ä¸æ­¤æ¯æ¯ç›¸å…³ã€‚<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html">JSSE çš„å‚è€ƒæ‰‹å†Œ</a>ä¸­æœ‰ä¸€å¼ ç¤ºæ„å›¾ï¼Œè¯´æ˜äº†å„ä¸ªç±»ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><img src="https://www.aneasystone.com/usr/uploads/2016/04/4013537635.jpg" alt="jsse-class.jpg"></p>
<p>å¯ä»¥çœ‹å‡ºå¦‚æœè¦è¿›è¡Œ SSL ä¼šè¯ï¼Œå¿…é¡»å¾—æ–°å»ºä¸€ä¸ª <code>SSLSocket</code> å¯¹è±¡ï¼Œè€Œ SSLSocket å¯¹è±¡æ˜¯é€šè¿‡ <code>SSLSocketFactory</code> æ¥ç®¡ç†çš„ï¼ŒSSLSocketFactory å¯¹è±¡åˆ™ä¾èµ–äº <code>SSLContext</code> ï¼ŒSSLContext å¯¹è±¡åˆä¾èµ–äº <code>keyManager</code>ã€<code>TrustManager</code> å’Œ <code>SecureRandom</code>ã€‚æˆ‘ä»¬è¿™é‡Œæœ€å…³å¿ƒçš„æ˜¯ TrustManager å¯¹è±¡ï¼Œå¦å¤–ä¸¤ä¸ªæš‚ä¸”å¿½ç•¥ï¼Œå› ä¸ºæ­£æ˜¯ TrustManager è´Ÿè´£è¯ä¹¦çš„æ ¡éªŒï¼Œå¯¹ç½‘ç«™è¿›è¡Œè®¤è¯ï¼Œè¦æƒ³åœ¨è®¿é—® HTTPS æ—¶é€šè¿‡è®¤è¯ï¼Œä¸æŠ¥ <code>sun.security.validator.ValidatorException</code> å¼‚å¸¸ï¼Œå¿…é¡»ä»è¿™é‡Œå¼€åˆ€ã€‚</p>
<h2 id="ä¸‰ã€è‡ªå®šä¹‰-TrustManager-ç»•è¿‡è¯ä¹¦æ£€æŸ¥"><a href="#ä¸‰ã€è‡ªå®šä¹‰-TrustManager-ç»•è¿‡è¯ä¹¦æ£€æŸ¥" class="headerlink" title="ä¸‰ã€è‡ªå®šä¹‰ TrustManager ç»•è¿‡è¯ä¹¦æ£€æŸ¥"></a>ä¸‰ã€è‡ªå®šä¹‰ TrustManager ç»•è¿‡è¯ä¹¦æ£€æŸ¥</h2><p>æˆ‘ä»¬çŸ¥é“äº† TrustManager æ˜¯ä¸“é—¨è´Ÿè´£æ ¡éªŒè¯ä¹¦çš„ï¼Œé‚£ä¹ˆæœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•åº”è¯¥å°±æ˜¯æ”¹å†™ TrustManager ç±»ï¼Œè®©å®ƒä¸è¦å¯¹è¯ä¹¦åšæ ¡éªŒï¼Œè¿™ç§æ–¹æ³•è™½ç„¶ç²—æš´ï¼Œä½†æ˜¯å´ç›¸å½“æœ‰æ•ˆï¼Œè€Œä¸” Java ä¸­çš„ TrustManager ä¹Ÿç¡®å®å¯ä»¥è¢«é‡å†™ï¼Œä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void basicHttpsGetIgnoreCertificateValidation() throws Exception &#123;
     
    String url &#x3D; &quot;https:&#x2F;&#x2F;kyfw.12306.cn&#x2F;otn&#x2F;&quot;;
     
    &#x2F;&#x2F; Create a trust manager that does not validate certificate chains
    TrustManager[] trustAllCerts &#x3D; new TrustManager[] &#123;
        new X509TrustManager() &#123;
            public X509Certificate[] getAcceptedIssuers() &#123;
                return null;
            &#125;
            public void checkClientTrusted(X509Certificate[] certs, String authType) &#123;
                &#x2F;&#x2F; don&#39;t check
            &#125;
            public void checkServerTrusted(X509Certificate[] certs, String authType) &#123;
                &#x2F;&#x2F; don&#39;t check
            &#125;
        &#125;
    &#125;;
     
    SSLContext ctx &#x3D; SSLContext.getInstance(&quot;TLS&quot;);
    ctx.init(null, trustAllCerts, null);
     
    LayeredConnectionSocketFactory sslSocketFactory &#x3D; new SSLConnectionSocketFactory(ctx);
     
    CloseableHttpClient httpclient &#x3D; HttpClients.custom()
            .setSSLSocketFactory(sslSocketFactory)
            .build();
     
    HttpGet request &#x3D; new HttpGet(url);
    request.setHeader(&quot;User-Agent&quot;, &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) ...&quot;);
     
    CloseableHttpResponse response &#x3D; httpclient.execute(request);
    String responseBody &#x3D; readResponseBody(response);
    System.out.println(responseBody);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªåŒ¿åç±»ï¼Œç»§æ‰¿è‡ª <a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#X509TrustManager"><code>X509TrustManager</code></a> æ¥å£ï¼Œè¿™ä¸ªæ¥å£æä¾›äº†ä¸‰ä¸ªæ–¹æ³•ç”¨äºéªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼š<code>getAcceptedIssuers</code>ã€<code>checkClientTrusted</code>ã€<code>checkServerTrusted</code>ï¼Œæˆ‘ä»¬åœ¨éªŒè¯çš„å‡½æ•°ä¸­ç›´æ¥è¿”å›ï¼Œä¸åšä»»ä½•æ ¡éªŒï¼Œè¿™æ ·åœ¨è®¿é—® HTTPS ç«™ç‚¹æ—¶ï¼Œå°±ç®—æ˜¯è¯ä¹¦ä¸å¯ä¿¡ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p>
<p>è¿™ç§æ–¹æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å´æœ‰ä¸€ä¸ªæœ€ä¸¥é‡çš„é—®é¢˜ï¼Œå°±æ˜¯ä¸å®‰å…¨ã€‚å› ä¸ºä¸å¯¹è¯ä¹¦åšä»»ä½•åˆæ³•æ€§æ ¡éªŒï¼Œè€Œä¸”è¿™ç§å¤„ç†æ˜¯å…¨å±€æ€§çš„ï¼Œä¸ç®¡é’çº¢çš‚ç™½ï¼Œæ‰€æœ‰çš„è¯ä¹¦éƒ½ä¸ä¼šåšéªŒè¯ï¼Œæ‰€ä»¥å°±ç®—é‡åˆ°ä¸ä¿¡ä»»çš„è¯ä¹¦ï¼Œä»£ç ä¾ç„¶ä¼šç»§ç»­ä¸ä¹‹é€šä¿¡ï¼Œè‡³äºé€šä¿¡çš„æ•°æ®å®‰å…¨ä¸å®‰å…¨å°±ä¸èƒ½ä¿è¯äº†ã€‚æ‰€ä»¥å¦‚æœä½ åªæ˜¯æƒ³åœ¨æµ‹è¯•ç¯å¢ƒåšä¸ªå®éªŒï¼Œé‚£æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ è¦å°†ä»£ç å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œè¯·æ…é‡ã€‚</p>
<h2 id="å››ã€ä½¿ç”¨è¯ä¹¦"><a href="#å››ã€ä½¿ç”¨è¯ä¹¦" class="headerlink" title="å››ã€ä½¿ç”¨è¯ä¹¦"></a>å››ã€ä½¿ç”¨è¯ä¹¦</h2><p>å¯¹äºæœ‰äº›è¯ä¹¦ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šç¡®å®šæ˜¯å¯ä»¥ä¿¡ä»»çš„ï¼Œä½†æ˜¯è¿™äº›è¯ä¹¦åˆä¸åœ¨ Java çš„ cacerts æ–‡ä»¶ä¸­ï¼Œè­¬å¦‚ 12306 ç½‘ç«™ï¼Œæˆ–è€…ä½¿ç”¨äº† Letâ€™s Encrypt è¯ä¹¦çš„ä¸€äº›ç½‘ç«™ï¼Œå¯¹äºè¿™äº›ç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ·»åŠ åˆ°ä¿¡ä»»åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ç»Ÿç»Ÿéƒ½ç›¸ä¿¡ï¼Œè¿™æ ·ç¨‹åºçš„å®‰å…¨æ€§ä»ç„¶å¯ä»¥å¾—åˆ°ä¿éšœã€‚</p>
<h3 id="4-1-ä½¿ç”¨-keytool-å¯¼å…¥è¯ä¹¦"><a href="#4-1-ä½¿ç”¨-keytool-å¯¼å…¥è¯ä¹¦" class="headerlink" title="4.1 ä½¿ç”¨ keytool å¯¼å…¥è¯ä¹¦"></a>4.1 ä½¿ç”¨ keytool å¯¼å…¥è¯ä¹¦</h3><p>ç®€å•çš„åšæ³•æ˜¯å°†è¿™äº›ç½‘ç«™çš„è¯ä¹¦å¯¼å…¥åˆ° cacerts æ–‡ä»¶ä¸­ï¼Œè¿™æ · Java ç¨‹åºåœ¨æ ¡éªŒè¯ä¹¦çš„æ—¶å€™å°±å¯ä»¥ä» cacerts æ–‡ä»¶ä¸­æ‰¾åˆ°å¹¶æˆåŠŸæ ¡éªŒè¿™ä¸ªè¯ä¹¦äº†ã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»è¿‡ JRE è‡ªå¸¦çš„ keytool è¿™ä¸ªå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å°å·§è€Œå¼ºæ‚ï¼Œæ‹¥æœ‰å¾ˆå¤šåŠŸèƒ½ã€‚é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæŸ¥çœ‹ KeyStore æ–‡ä»¶ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åˆ—å‡º KeyStore æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬è¯ä¹¦ã€ç§é’¥ç­‰ï¼‰ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">$ keytool -list -keystore cacerts<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†è¯ä¹¦å¯¼å…¥åˆ° cacerts æ–‡ä»¶ä¸­ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">$ keytool -import -alias 12306 -keystore cacerts -file 12306.cer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¦æƒ³å°†ç½‘ç«™çš„è¯ä¹¦å¯¼å…¥ cacerts æ–‡ä»¶ä¸­ï¼Œé¦–å…ˆè¦è·å–ç½‘ç«™çš„è¯ä¹¦ï¼Œè­¬å¦‚ä¸Šé¢å‘½ä»¤ä¸­çš„ 12306.cer æ–‡ä»¶ï¼Œå®ƒæ˜¯ä½¿ç”¨æµè§ˆå™¨çš„è¯ä¹¦å¯¼å‡ºå‘å¯¼ä¿å­˜çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://www.aneasystone.com/usr/uploads/2016/04/898222994.png" alt="export-cert.png"></p>
<p>å…³äº keytool çš„æ›´å¤šç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ <a href="https://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html">keytool çš„å®˜ç½‘æ‰‹å†Œ</a>ï¼ŒSSLShopper ä¸Šä¹Ÿæœ‰ä¸€ç¯‡æ–‡ç« åˆ—å‡ºäº†<a href="https://www.sslshopper.com/article-most-common-java-keytool-keystore-commands.html">å¸¸ç”¨çš„ keytool å‘½ä»¤</a>ã€‚</p>
<h3 id="4-2-ä½¿ç”¨-KeyStore-åŠ¨æ€åŠ è½½è¯ä¹¦"><a href="#4-2-ä½¿ç”¨-KeyStore-åŠ¨æ€åŠ è½½è¯ä¹¦" class="headerlink" title="4.2 ä½¿ç”¨ KeyStore åŠ¨æ€åŠ è½½è¯ä¹¦"></a>4.2 ä½¿ç”¨ KeyStore åŠ¨æ€åŠ è½½è¯ä¹¦</h3><p>ä½¿ç”¨ keytool å¯¼å…¥è¯ä¹¦ï¼Œè¿™ç§æ–¹æ³•ä¸ä»…ç®€å•ï¼Œè€Œä¸”ä¿è¯äº†ä»£ç çš„å®‰å…¨æ€§ï¼Œæœ€å…³é”®çš„æ˜¯ä»£ç ä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚æ‰€ä»¥æˆ‘æ¯”è¾ƒæ¨èè¿™ç§æ–¹æ³•ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼Œé‚£å°±æ˜¯ä½ éœ€è¦ä¿®æ”¹ JRE ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚æœä½ çš„ç¨‹åºåªæ˜¯åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè¿è¡Œï¼Œé‚£å€’æ²¡ä»€ä¹ˆï¼Œå¯å¦‚æœä½ çš„ç¨‹åºè¦éƒ¨ç½²åœ¨å…¶ä»–äººçš„ç”µè„‘ä¸Šæˆ–è€…å…¬å¸çš„æœåŠ¡å™¨ä¸Šï¼Œè€Œä½ æ²¡æœ‰æƒé™ä¿®æ”¹ JRE ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè¿™è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœä½ çš„ç¨‹åºæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç¨‹åºè¦éƒ¨ç½²åœ¨æˆç™¾ä¸Šåƒå°æœºå™¨ä¸Šï¼Œéš¾é“è¿˜å¾—ä¿®æ”¹æ¯å°æœºå™¨çš„ JRE æ–‡ä»¶å—ï¼Ÿå¥½åœ¨æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ç§é€šè¿‡ç¼–ç¨‹çš„æ‰‹æ®µæ¥å®ç°çš„æ€è·¯ï¼Œåœ¨ä»£ç ä¸­åŠ¨æ€çš„åŠ è½½ KeyStore æ–‡ä»¶æ¥å®Œæˆè¯ä¹¦çš„æ ¡éªŒï¼ŒæŠ±ç€çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶çš„æ€åº¦ï¼Œæˆ‘ä»¬åœ¨æœ€åä¹Ÿå®è·µä¸‹è¿™ç§æ–¹æ³•ã€‚é€šè¿‡ç¼–å†™ä»£ç å¯ä»¥æ›´æ·±åˆ»çš„äº†è§£ <code>KeyStore</code>ã€<code>TrustManagerFactory</code>ã€<code>SSLContext</code> ä»¥åŠ <code>SSLSocketFactory</code> è¿™å‡ ä¸ªç±»ä¹‹é—´çš„å…³ç³»ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">@Test
public void basicHttpsGetUsingSslSocketFactory() throws Exception &#123;
 
    String keyStoreFile &#x3D; &quot;D:\\code\\ttt.ks&quot;;
    String password &#x3D; &quot;poiuyt&quot;;
    KeyStore ks &#x3D; KeyStore.getInstance(KeyStore.getDefaultType());
    FileInputStream in &#x3D; new FileInputStream(keyStoreFile);
    ks.load(in, password.toCharArray());
     
    System.out.println(KeyStore.getDefaultType().toString());
    System.out.println(TrustManagerFactory.getDefaultAlgorithm().toString());
     
    TrustManagerFactory tmf &#x3D; TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());
    tmf.init(ks);
    SSLContext ctx &#x3D; SSLContext.getInstance(&quot;TLS&quot;);
    ctx.init(null, tmf.getTrustManagers(), null);
     
    LayeredConnectionSocketFactory sslSocketFactory &#x3D; new SSLConnectionSocketFactory(ctx);
     
    String url &#x3D; &quot;https:&#x2F;&#x2F;ttt.aneasystone.com&quot;;
     
    &#x2F;**
     * Return the page with content:
     *     401 Authorization Required
     *&#x2F;
     
    CloseableHttpClient httpclient &#x3D; HttpClients.custom()
            .setSSLSocketFactory(sslSocketFactory)
            .build();
     
    HttpGet request &#x3D; new HttpGet(url);
    request.setHeader(&quot;User-Agent&quot;, &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; WOW64) ...&quot;);
     
    CloseableHttpResponse response &#x3D; httpclient.execute(request);
    String responseBody &#x3D; readResponseBody(response);
    System.out.println(responseBody);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº† HttpClient ï¼Œå¦‚æœæ˜¯ä½¿ç”¨ HttpsURLConnection åªéœ€è¦æ”¹åŠ¨ä¸‹é¢ä¸¤è¡Œå³å¯ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">HttpsURLConnection con &#x3D; (HttpsURLConnection) obj.openConnection();
con.setSSLSocketFactory(ctx.getSocketFactory());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>æœ€åçš„æœ€åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„å±æ€§æ¥æŒ‡å®š trustStore ï¼Œè¿™æ ·ä¹Ÿä¸éœ€è¦ç¼–å†™åƒä¸Šé¢é‚£æ ·å¤§é‡ç¹ççš„ä»£ç ï¼Œå¦å¤–ï¼Œå‚è€ƒæˆ‘å‰é¢çš„åšå®¢ï¼Œè¿™äº›å±æ€§è¿˜å¯ä»¥é€šè¿‡ JVM çš„å‚æ•°æ¥è®¾ç½®ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">System.setProperty(&quot;javax.net.ssl.trustStore&quot;, &quot;D:\\code\\ttt.ks&quot;);
System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;poiuyt&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ HTTPS ä¹‹æ—…å°±è¦å‘Šä¸€æ®µè½äº†ã€‚åœ¨å­¦ä¹  HTTPS çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ—¶æ—¶ä¸ç»æ„çš„ä¼šè¢« HTTPS ä¸­çš„ä¸€äº›æŠ€æœ¯æˆ–æŠ€å·§æ„Ÿè§¦åˆ°ï¼Œç‰¹åˆ«æ˜¯è¯ä¹¦çš„è®¤è¯è¿‡ç¨‹ä»¥åŠéå¯¹ç§°åŠ å¯†ç®—æ³•çš„åŸç†ï¼ŒçœŸçš„æ˜¯ç§¯ç´¯äº†äººç±»æ— ç©·çš„æ™ºæ…§ï¼Œè®©äººä¸å¾—ä¸æ„Ÿå¹æ•°å­¦çš„ç¾å¦™ã€‚è€Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­è¶Šæ˜¯åˆ¨æ ¹é—®åº•ï¼Œè¶Šæ˜¯ä¸€å‘ä¸å¯æ”¶æ‹¾ï¼Œä¸­é—´ç‰µæ‰¯åˆ°çš„ç»†èŠ‚å¤ªå¤šï¼Œå¤ªæ·±å…¥åè€Œè®©äººä¸è‡ªè§‰çš„è¿·å¤±äº†æ–¹å‘ã€‚è¿™ç¯‡åšå®¢æ–­æ–­ç»­ç»­çš„å†™äº†ä¸€ä¸ªå¤šæœˆï¼Œæ…¢æ…¢çš„è‡ªå·±ä¹Ÿæ˜¯ä»å¯¹ HTTPS ä¸€çŸ¥åŠè§£ï¼Œåˆ°ç°åœ¨çš„åˆçª¥é—¨å¾„ã€‚å†™çš„è¶Šå¤šï¼Œè¶Šå‘è§‰è‡ªå·±å¾ˆå¤šä¸œè¥¿ä¸æ¸…æ¥šï¼Œçœ‹å¾—èµ„æ–™è¶Šå¤šï¼Œè¶Šæ˜¯ä¸æ•¢å†™ï¼Œæ€•å†™é”™ã€‚è¿™ç¯‡åšå®¢å‚è€ƒèµ„æ–™ä¼—å¤šï¼Œè´¨é‡ä¹Ÿå‚å·®ä¸é½ï¼Œä¸èƒ½è¯´å¯¹è¯»è€…ä¼šèµ·ä»€ä¹ˆä½œç”¨ï¼Œä½†æ˜¯ç¡®å®æ˜¯åœ¨æˆ‘å­¦ä¹ è¿‡ç¨‹ä¸­å¸®æˆ‘ç†æ¸…äº†å¾ˆå¤šæ€è·¯ã€‚åœ¨è¿™é‡Œå¯¹è¿™äº›åšå®¢çš„åŸä½œè€…è¡¨ç¤ºæ„Ÿè°¢ã€‚åŒæ—¶ï¼Œå¦‚æœä½ å‘ç°æœ¬ç¯‡åšå®¢ä¸­å­˜åœ¨ä»€ä¹ˆé—®é¢˜æˆ–é”™è¯¯ï¼Œæ¬¢è¿æ–§æ­£ã€‚</p>
<p>å…±å‹‰ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://publib.boulder.ibm.com/tividd/td/TRM/SC23-4822-00/zh_CN/HTML/user277.htm">SSL å¦‚ä½•å·¥ä½œ</a></li>
<li><a href="https://segmentfault.com/a/1190000002963044">SSL&#x2F;TLS åè®®ç®€ä»‹ä¸å®ä¾‹åˆ†æ</a></li>
<li><a href="https://segmentfault.com/a/1190000002554673">SSL&#x2F;TLSåŸç†è¯¦è§£</a></li>
<li><a href="https://imququ.com/post/optimize-tls-handshake.html">TLS æ¡æ‰‹ä¼˜åŒ–è¯¦è§£</a></li>
<li><a href="https://imququ.com/post/how-to-decrypt-https.html">ä¸‰ç§è§£å¯† HTTPS æµé‡çš„æ–¹æ³•ä»‹ç»</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html">å›¾è§£SSL&#x2F;TLSåè®®</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">SSL&#x2F;TLSåè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°</a></li>
<li><a href="http://www.oschina.net/news/26228/how-to-config-https">HTTPS ä»åŸç†åˆ°å®æˆ˜</a></li>
<li><a href="http://www.cnblogs.com/ttltry-air/archive/2012/08/20/2647898.html">HTTPSå·¥ä½œåŸç†å’ŒTCPæ¡æ‰‹æœºåˆ¶</a></li>
<li><a href="https://program-think.blogspot.com/2014/11/https-ssl-tls-0.html">æ‰«ç›² HTTPS å’Œ SSL&#x2F;TLS åè®®</a></li>
<li><a href="http://www.guokr.com/post/114121/">HTTPSé‚£äº›äº‹ï¼ˆä¸€ï¼‰HTTPSåŸç†</a></li>
<li><a href="http://www.lupaworld.com/article-252898-1.html">ç†è§£HTTPSåè®®</a></li>
<li><a href="http://drops.wooyun.org/tips/6002">SSL&#x2F;TLSåè®®å®‰å…¨ç³»åˆ—ï¼šSSL&#x2F;TLSæ¦‚è¿°</a></li>
<li><a href="http://www.pixelstech.net/article/1408345768-Different-types-of-keystore-in-Java----Overview">Different types of keystore in Java â€“ Overview</a></li>
<li><a href="http://www.pixelstech.net/article/1409966488-Different-types-of-keystore-in-Java----JKS">Different types of keystore in Java â€“ JKS</a></li>
<li><a href="http://www.binghe.org/2010/03/use-httpsurlconnection-in-java/">Javaä¸­ç”¨HttpsURLConnectionè®¿é—®Httpsé“¾æ¥çš„é—®é¢˜</a></li>
<li><a href="http://superuser.com/questions/411909/where-is-the-certificate-folder-in-windows-7">Where is the certificate folder in Windows 7?</a></li>
<li><a href="https://program-think.blogspot.com/2010/02/introduce-digital-certificate-and-ca.html">æ•°å­—è¯ä¹¦åŠ CA çš„æ‰«ç›²ä»‹ç»</a></li>
<li><a href="http://www.cnblogs.com/JeffreySun/archive/2010/06/24/1627247.html">æ•°å­—è¯ä¹¦åŸç†</a></li>
<li><a href="https://blog.cnbluebox.com/blog/2014/03/24/shu-zi-zheng-shu/">æ•°å­—è¯ä¹¦</a></li>
<li><a href="http://blog.chenxiaosheng.com/posts/2013-12-26/java-use-self_signed_certificate.html">Java ä½¿ç”¨è‡ªç­¾è¯ä¹¦è®¿é—®httpsç«™ç‚¹</a></li>
<li><a href="https://www.jayxon.com/12306-certificate/">12306çš„è¯ä¹¦é—®é¢˜</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html">æ•°å­—ç­¾åæ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="http://www.xieyidian.com/3213">åœ¨çº¿ä¹°ç«è½¦ç¥¨ä¸ºä»€ä¹ˆè¦å®‰è£…æ ¹è¯ä¹¦ï¼Ÿ</a></li>
<li><a href="http://snowolf.iteye.com/blog/391931">JavaåŠ å¯†æŠ€æœ¯ï¼ˆå…«ï¼‰â€”â€”æ•°å­—è¯ä¹¦</a></li>
<li><a href="http://snowolf.iteye.com/blog/397693">JavaåŠ å¯†æŠ€æœ¯ï¼ˆä¹ï¼‰â€”â€”åˆæ¢SSL</a></li>
<li><a href="http://www.cnblogs.com/lzjsky/archive/2010/09/29/1838240.html">å¸¸è§çš„æ•°å­—è¯ä¹¦æ ¼å¼</a></li>
<li><a href="http://lukejin.iteye.com/blog/605634">keyStore vs trustStore</a></li>
<li><a href="http://javarevisited.blogspot.jp/2012/09/difference-between-truststore-vs-keyStore-Java-SSL.html">Difference between trustStore and keyStore in Java - SSL</a></li>
<li><a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html">Java Secure Socket Extension (JSSE) Reference Guide</a></li>
<li><a href="http://www.nakov.com/blog/2009/07/16/disable-certificate-validation-in-java-ssl-connections/">Disable Certificate Validation in Java SSL Connections</a></li>
<li><a href="http://www.java-samples.com/showtutorial.php?tutorialid=210">javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed</a></li>
<li><a href="http://wsigrid.blogspot.jp/2008/12/how-to-solve-javaxnetsslsslhandshakeexc.html">How to solve javax.net.ssl.SSLHandshakeException?</a></li>
<li><a href="https://www.sslshopper.com/ssl-converter.html">SSL Converter</a></li>
<li><a href="https://www.sslshopper.com/article-most-common-java-keytool-keystore-commands.html">The Most Common Java Keytool Keystore Commands</a></li>
<li><a href="https://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html">keytool - Key and Certificate Management Tool</a></li>
</ol>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Https</tag>
        <tag>è¯ä¹¦</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­ä¸€ä¸ªå¯¹è±¡å ç”¨å¤šå°‘ä¸ªå­—èŠ‚</title>
    <url>/2022/01/20/java/java-zhong-yi-ge-dui-xiang-zhan-yong-duo-shao-ge-zi-jie/</url>
    <content><![CDATA[<blockquote>
<p>è¯´æ˜ï¼šæœ¬æ–‡å†…å®¹å‚è€ƒæ–‡ç« :<a href="https://www.cnblogs.com/jajian/p/13681781.html">ç è¾£æ¶æ„-Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</a>ï¼Œè¯¦è§£å†…å®¹è¯·é˜…è¯»åŸæ–‡ã€‚</p>
</blockquote>
<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨JVMè¿›è¡Œç¼“å­˜ä¸€äº›æ•°æ®æ¥æé«˜ç¨‹åºçš„æ€§èƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å¯¹ç¼“å­˜çš„æ•°æ®è¿›è¡Œå¤§å°ä¼°ç®—ï¼Œé˜²æ­¢äº§ç”ŸOOMé—®é¢˜ï¼Œä¸ºä¿è¯ä¼°ç®—çš„å‡†ç¡®æ€§ï¼Œéœ€è¦äº†è§£ä¸€ä¸ªJavaå¯¹è±¡åœ¨å†…å­˜ä¸­å…·ä½“å ç”¨å¤šå°‘ä¸ªå­—èŠ‚ã€‚</p>
<h1 id="äºŒã€ä¸€ä¸ªJavaå¯¹è±¡çš„ç»„æˆ"><a href="#äºŒã€ä¸€ä¸ªJavaå¯¹è±¡çš„ç»„æˆ" class="headerlink" title="äºŒã€ä¸€ä¸ªJavaå¯¹è±¡çš„ç»„æˆ"></a>äºŒã€ä¸€ä¸ªJavaå¯¹è±¡çš„ç»„æˆ</h1><table>
<thead>
<tr>
<th>ç»„æˆéƒ¨åˆ†</th>
<th>å¯¹è±¡å¤´ï¼ˆobject headerï¼‰</th>
<th>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</th>
<th>å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>è¯´æ˜</td>
<td>åŒ…æ‹¬äº†å…³äºå †å¯¹è±¡çš„å¸ƒå±€ã€ç±»å‹ã€GCçŠ¶æ€ã€åŒæ­¥çŠ¶æ€å’Œæ ‡è¯†å“ˆå¸Œç çš„åŸºæœ¬ä¿¡æ¯ã€‚Javaå¯¹è±¡å’Œvmå†…éƒ¨å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„å¯¹è±¡å¤´æ ¼å¼ã€‚</td>
<td>ä¸»è¦æ˜¯å­˜æ”¾ç±»çš„æ•°æ®ä¿¡æ¯ï¼Œçˆ¶ç±»çš„ä¿¡æ¯ï¼Œå¯¹è±¡å­—æ®µå±æ€§ä¿¡æ¯ã€‚</td>
<td>ä¸ºäº†å­—èŠ‚å¯¹é½ï¼Œå¡«å……çš„æ•°æ®ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚</td>
</tr>
<tr>
<td>å¤§å°</td>
<td>12 byte</td>
<td>åŸºæœ¬ç±»å‹æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å¤§å°</td>
<td>å¯¹è±¡å¤§å°ä¸æ»¡è¶³8byteçš„å€æ•°æ—¶è¿›è¡Œå¡«å……</td>
</tr>
</tbody></table>
<blockquote>
<p>æç¤ºï¼šJDK6ä¹‹åé»˜è®¤éƒ½æ˜¯å¼€å§‹æŒ‡é’ˆå‹ç¼©çš„ï¼Œæ‰€ä»¥å¯¹è±¡å¤´ä¸­<code>mark word</code>å ç”¨8ä¸ªbyteï¼Œ<code>klass pointer</code>å ç”¨4ä¸ªbyte</p>
</blockquote>
<h2 id="object-header"><a href="#object-header" class="headerlink" title="object header"></a>object header</h2><blockquote>
<p>Common structure at the beginning of every GC-managed heap object. (Every oop points to an object header.) Includes fundamental information about the heap objectâ€™s layout, type, GC state, synchronization state, and identity hash code.<br>Consists of two words. In arrays it is immediately followed by a length field. Note that both Java objects and VM-internal objects have a common object header format.</p>
</blockquote>
<h3 id="mark-word"><a href="#mark-word" class="headerlink" title="mark word"></a>mark word</h3><blockquote>
<p>The first word of every object header. Usually a set of bitfields including synchronization state and identity hash code. May also be a pointer (with characteristic low bit encoding) to synchronization related information. During GC, may contain GC state bits.</p>
</blockquote>
<p>ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ç­‰ã€‚</p>
<blockquote>
<p>Mark Wordåœ¨32ä½JVMä¸­çš„é•¿åº¦æ˜¯32bitï¼Œåœ¨64ä½JVMä¸­é•¿åº¦æ˜¯64bitã€‚<br>æ‰“å¼€openjdkçš„æºç åŒ…ï¼Œå¯¹åº”è·¯å¾„&#x2F;openjdk&#x2F;hotspot&#x2F;src&#x2F;share&#x2F;vm&#x2F;oopsï¼ŒMark Wordå¯¹åº”åˆ°C++çš„ä»£ç markOop.hppï¼Œå¯ä»¥ä»æ³¨é‡Šä¸­çœ‹åˆ°å®ƒä»¬çš„ç»„æˆï¼Œæœ¬æ–‡æ‰€æœ‰ä»£ç æ˜¯åŸºäºJdk1.8ã€‚</p>
</blockquote>
<p><img src="/2022/01/20/java/java-zhong-yi-ge-dui-xiang-zhan-yong-duo-shao-ge-zi-jie/markoop.png" alt="markoop"><br>Mark Wordåœ¨ä¸åŒçš„é”çŠ¶æ€ä¸‹å­˜å‚¨çš„å†…å®¹ä¸åŒï¼Œåœ¨32ä½JVMä¸­æ˜¯è¿™ä¹ˆå­˜çš„<br><img src="/2022/01/20/java/java-zhong-yi-ge-dui-xiang-zhan-yong-duo-shao-ge-zi-jie/markword32.png" alt="markword32"><br>åœ¨64ä½JVMä¸­æ˜¯è¿™ä¹ˆå­˜çš„<br><img src="/2022/01/20/java/java-zhong-yi-ge-dui-xiang-zhan-yong-duo-shao-ge-zi-jie/markword64.png" alt="markword64"></p>
<p>è™½ç„¶å®ƒä»¬åœ¨ä¸åŒä½æ•°çš„JVMä¸­é•¿åº¦ä¸ä¸€æ ·ï¼Œä½†æ˜¯åŸºæœ¬ç»„æˆå†…å®¹æ˜¯ä¸€è‡´çš„ã€‚</p>
<ul>
<li>é”æ ‡å¿—ä½ï¼ˆlockï¼‰ï¼šåŒºåˆ†é”çŠ¶æ€ï¼Œ11æ—¶è¡¨ç¤ºå¯¹è±¡å¾…GCå›æ”¶çŠ¶æ€, åªæœ‰æœ€å2ä½é”æ ‡è¯†(11)æœ‰æ•ˆã€‚</li>
<li>biased_lockï¼šæ˜¯å¦åå‘é”ï¼Œç”±äºæ— é”å’Œåå‘é”çš„é”æ ‡è¯†éƒ½æ˜¯ 01ï¼Œæ²¡åŠæ³•åŒºåˆ†ï¼Œè¿™é‡Œå¼•å…¥ä¸€ä½çš„åå‘é”æ ‡è¯†ä½ã€‚</li>
<li>åˆ†ä»£å¹´é¾„ï¼ˆageï¼‰ï¼šè¡¨ç¤ºå¯¹è±¡è¢«GCçš„æ¬¡æ•°ï¼Œå½“è¯¥æ¬¡æ•°åˆ°è¾¾é˜ˆå€¼çš„æ—¶å€™ï¼Œå¯¹è±¡å°±ä¼šè½¬ç§»åˆ°è€å¹´ä»£ã€‚</li>
<li>å¯¹è±¡çš„hashcodeï¼ˆhashï¼‰ï¼šè¿è¡ŒæœŸé—´è°ƒç”¨System.identityHashCode()æ¥è®¡ç®—ï¼Œå»¶è¿Ÿè®¡ç®—ï¼Œå¹¶æŠŠç»“æœèµ‹å€¼åˆ°è¿™é‡Œã€‚å½“å¯¹è±¡åŠ é”åï¼Œè®¡ç®—çš„ç»“æœ31ä½ä¸å¤Ÿè¡¨ç¤ºï¼Œåœ¨åå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”ï¼Œhashcodeä¼šè¢«è½¬ç§»åˆ°Monitorä¸­ã€‚</li>
<li>åå‘é”çš„çº¿ç¨‹IDï¼ˆJavaThreadï¼‰ï¼šåå‘æ¨¡å¼çš„æ—¶å€™ï¼Œå½“æŸä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡è¿™é‡Œå°±ä¼šè¢«ç½®ä¸ºè¯¥çº¿ç¨‹çš„IDã€‚ åœ¨åé¢çš„æ“ä½œä¸­ï¼Œå°±æ— éœ€å†è¿›è¡Œå°è¯•è·å–é”çš„åŠ¨ä½œã€‚</li>
<li>epochï¼šåå‘é”åœ¨CASé”æ“ä½œè¿‡ç¨‹ä¸­ï¼Œåå‘æ€§æ ‡è¯†ï¼Œè¡¨ç¤ºå¯¹è±¡æ›´åå‘å“ªä¸ªé”ã€‚</li>
<li>ptr_to_lock_recordï¼šè½»é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚å½“é”è·å–æ˜¯æ— ç«äº‰çš„æ—¶ï¼ŒJVMä½¿ç”¨åŸå­æ“ä½œè€Œä¸æ˜¯OSäº’æ–¥ã€‚è¿™ç§æŠ€æœ¯ç§°ä¸ºè½»é‡çº§é”å®šã€‚åœ¨è½»é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVMé€šè¿‡CASæ“ä½œåœ¨å¯¹è±¡çš„æ ‡é¢˜å­—ä¸­è®¾ç½®æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚</li>
<li>ptr_to_heavyweight_monitorï¼šé‡é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘å¯¹è±¡ç›‘è§†å™¨Monitorçš„æŒ‡é’ˆã€‚å¦‚æœä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åŒæ—¶åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šç«äº‰ï¼Œåˆ™å¿…é¡»å°†è½»é‡çº§é”å®šå‡çº§åˆ°Monitorä»¥ç®¡ç†ç­‰å¾…çš„çº¿ç¨‹ã€‚åœ¨é‡é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVMåœ¨å¯¹è±¡çš„ptr_to_heavyweight_monitorè®¾ç½®æŒ‡å‘Monitorçš„æŒ‡é’ˆã€‚</li>
</ul>
<h3 id="klass-pointer"><a href="#klass-pointer" class="headerlink" title="klass pointer"></a>klass pointer</h3><blockquote>
<p>The second word of every object header. Points to another object (a metaobject) which describes the layout and behavior of the original object. For Java objects, the â€œklassâ€ contains a C++ style â€œvtableâ€.</p>
</blockquote>
<p>å³ç±»å‹æŒ‡é’ˆï¼Œæ˜¯å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚<br>JVMé»˜è®¤å¼€å¯äº†æŒ‡é’ˆå‹ç¼© ï¼Œå¯¹è±¡å¤´å äº†12byteï¼Œç±»å‹æŒ‡é’ˆå 4ä¸ªbyteï¼Œå¦‚æœå…³é—­æŒ‡é’ˆå‹ç¼©åˆ™ç±»å‹æŒ‡é’ˆå 8ä¸ªbyteã€‚</p>
<blockquote>
<p>jdk8ç‰ˆæœ¬æ˜¯é»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©çš„ï¼Œå¯ä»¥é€šè¿‡é…ç½®vmå‚æ•°å¼€å¯å…³é—­æŒ‡é’ˆå‹ç¼©ï¼Œ-XX:-UseCompressedOopsã€‚</p>
</blockquote>
<h2 id="å®ä¾‹æ•°æ®"><a href="#å®ä¾‹æ•°æ®" class="headerlink" title="å®ä¾‹æ•°æ®"></a>å®ä¾‹æ•°æ®</h2><p>å¦‚æœå¯¹è±¡æœ‰å±æ€§å­—æ®µï¼Œåˆ™è¿™é‡Œä¼šæœ‰æ•°æ®ä¿¡æ¯ã€‚å¦‚æœå¯¹è±¡æ— å±æ€§å­—æ®µï¼Œåˆ™è¿™é‡Œå°±ä¸ä¼šæœ‰æ•°æ®ã€‚æ ¹æ®å­—æ®µç±»å‹çš„ä¸åŒå ä¸åŒçš„å­—èŠ‚ï¼Œä¾‹å¦‚booleanç±»å‹å 1ä¸ªå­—èŠ‚ï¼Œintç±»å‹å 4ä¸ªå­—èŠ‚ç­‰ç­‰ï¼›</p>
<h2 id="å¯¹é½æ•°æ®"><a href="#å¯¹é½æ•°æ®" class="headerlink" title="å¯¹é½æ•°æ®"></a>å¯¹é½æ•°æ®</h2><p>å¯¹è±¡å¯ä»¥æœ‰å¯¹é½æ•°æ®ä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºå †ä¸­å¯¹è±¡çš„èµ·å§‹åœ°å€éœ€è¦å¯¹é½è‡³8çš„å€æ•°ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ç”¨ä¸åˆ°8Nä¸ªå­—èŠ‚åˆ™éœ€è¦å¯¹å…¶å¡«å……ï¼Œä»¥æ­¤æ¥è¡¥é½å¯¹è±¡å¤´å’Œå®ä¾‹æ•°æ®å ç”¨å†…å­˜ä¹‹åå‰©ä½™çš„ç©ºé—´å¤§å°ã€‚å¦‚æœå¯¹è±¡å¤´å’Œå®ä¾‹æ•°æ®å·²ç»å æ»¡äº†JVMæ‰€åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œé‚£ä¹ˆå°±ä¸ç”¨å†è¿›è¡Œå¯¹é½å¡«å……äº†ã€‚</p>
<p>æ‰€æœ‰çš„å¯¹è±¡åˆ†é…çš„å­—èŠ‚æ€»SIZEéœ€è¦æ˜¯8çš„å€æ•°ï¼Œå¦‚æœå‰é¢çš„å¯¹è±¡å¤´å’Œå®ä¾‹æ•°æ®å ç”¨çš„æ€»SIZEä¸æ»¡è¶³è¦æ±‚ï¼Œåˆ™é€šè¿‡å¯¹é½æ•°æ®æ¥å¡«æ»¡ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¦å¯¹é½æ•°æ®ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å¯¹é½æ•°æ®ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¯¹é½æ•°æ®ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å¯¹é½æ•°æ®ï¼Ÿ</h3><p>å­—æ®µå†…å­˜å¯¹é½çš„å…¶ä¸­ä¸€ä¸ªåŸå› ï¼Œæ˜¯è®©å­—æ®µåªå‡ºç°åœ¨åŒä¸€CPUçš„ç¼“å­˜è¡Œä¸­ã€‚å¦‚æœå­—æ®µä¸æ˜¯å¯¹é½çš„ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°è·¨ç¼“å­˜è¡Œçš„å­—æ®µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å­—æ®µçš„è¯»å–å¯èƒ½éœ€è¦æ›¿æ¢ä¸¤ä¸ªç¼“å­˜è¡Œï¼Œè€Œè¯¥å­—æ®µçš„å­˜å‚¨ä¹Ÿä¼šåŒæ—¶æ±¡æŸ“ä¸¤ä¸ªç¼“å­˜è¡Œã€‚è¿™ä¸¤ç§æƒ…å†µå¯¹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡è€Œè¨€éƒ½æ˜¯ä¸åˆ©çš„ã€‚å…¶å®å¯¹å…¶å¡«å……çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†è®¡ç®—æœºé«˜æ•ˆå¯»å€ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„æ•´ä½“ç»“æ„å¸ƒå±€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2022/01/20/java/java-zhong-yi-ge-dui-xiang-zhan-yong-duo-shao-ge-zi-jie/object-component.png" alt="object-component"></p>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>ä¸€ä¸ªJavaå¯¹è±¡ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯å¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®ã€å¡«å……æ•°æ®ï¼š</p>
<ul>
<li>å¯¹è±¡å¤´å 12ä¸ªå­—èŠ‚ï¼ˆ64ä½JVMï¼‰ï¼ŒåŒ…æ‹¬<code>mark word</code>ã€<code>klass pointer</code>ä¸¤ä¸ªéƒ¨åˆ†</li>
<li>å®ä¾‹æ•°æ®ä¸­åŒ…æ‹¬åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹å å¯¹åº”å¤§å°ï¼Œå¼•ç”¨ç±»å‹å ç”¨1ä¸ªå­—èŠ‚</li>
<li>å½“å¯¹è±¡çš„å¤§å°ä¸æ˜¯8å­—èŠ‚çš„å€æ•°çš„æ—¶å€™ï¼Œå¯¹é½æ•°æ®åˆ™ä¼šè¿›è¡Œå¡«å……</li>
</ul>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><blockquote>
<p><a href="https://www.cnblogs.com/jajian/p/13681781.html">Javaå¯¹è±¡çš„å†…å­˜å¸ƒå±€</a><br><a href="https://www.jianshu.com/p/ad505f9163b2">å¦‚ä½•æ­£ç¡®è®¡ç®—Javaå¯¹è±¡æ‰€å å†…å­˜ï¼Ÿ</a></p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¯¹è±¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨</title>
    <url>/2018/07/26/java/java-zhong-de-qiang-yin-yong-ruan-yin-yong-ruo-yin-yong-he-xu-yin-yong/</url>
    <content><![CDATA[<h1 id="Javaä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨"><a href="#Javaä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨" class="headerlink" title="Javaä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨"></a>Javaä¸­çš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨</h1><p>Javaæ‰§è¡ŒGCåˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»æœ‰ä¸¤ç§æ–¹å¼å…¶ä¸­ä¸€ç§æ˜¯å¼•ç”¨è®¡æ•°ã€‚</p>
<blockquote>
<p>å¼•ç”¨è®¡æ•°ï¼šJavaå †ä¸­æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å±æ€§ï¼Œå¼•ç”¨æ¯æ–°å¢1æ¬¡è®¡æ•°åŠ 1ï¼Œå¼•ç”¨æ¯é‡Šæ”¾1æ¬¡è®¡æ•°å‡1ã€‚</p>
</blockquote>
<p>åœ¨JDK 1.2ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œè‹¥ä¸€ä¸ªå¯¹è±¡ä¸è¢«ä»»ä½•å˜é‡å¼•ç”¨ï¼Œé‚£ä¹ˆç¨‹åºå°±æ— æ³•å†ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰å¯¹è±¡å¤„äº(reachable)å¯è¾¾çŠ¶æ€ï¼Œç¨‹åºæ‰èƒ½ä½¿ç”¨å®ƒã€‚</p>
<p>ä»JDK 1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¯¹è±¡çš„å¼•ç”¨è¢«åˆ’åˆ†ä¸º4ç§çº§åˆ«ï¼Œä»è€Œä½¿ç¨‹åºèƒ½æ›´åŠ çµæ´»åœ°æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<blockquote>
<p>Javaä¸­4ç§å¼•ç”¨çš„çº§åˆ«å’Œå¼ºåº¦ç”±é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼šå¼ºå¼•ç”¨ -&gt; è½¯å¼•ç”¨ -&gt; å¼±å¼•ç”¨ -&gt; è™šå¼•ç”¨</p>
</blockquote>
<table>
<thead>
<tr>
<th>å¼•ç”¨ç±»å‹</th>
<th>è¢«åƒåœ¾å›æ”¶æ—¶é—´</th>
<th>ç”¨é€”</th>
<th>ç”Ÿå­˜æ—¶é—´</th>
<th>æ¡ˆä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>å¼ºå¼•ç”¨</td>
<td>ä»æ¥ä¸ä¼š</td>
<td>å¯¹è±¡çš„ä¸€èˆ¬çŠ¶æ€</td>
<td>JVMåœæ­¢è¿è¡Œæ—¶ç»ˆæ­¢</td>
<td>é€šè¿‡newæˆ–åå°„åˆ›å»ºçš„å¼•ç”¨å¯¹è±¡</td>
</tr>
<tr>
<td>è½¯å¼•ç”¨</td>
<td>å½“å†…å­˜ä¸è¶³æ—¶</td>
<td>å¯¹è±¡ç¼“å­˜</td>
<td>å†…å­˜ä¸è¶³æ—¶ç»ˆæ­¢</td>
<td></td>
</tr>
<tr>
<td>å¼±å¼•ç”¨</td>
<td>æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</td>
<td>å¯¹è±¡ç¼“å­˜</td>
<td>åƒåœ¾å›æ”¶åç»ˆæ­¢</td>
<td></td>
</tr>
<tr>
<td>è™šå¼•ç”¨</td>
<td>æ­£å¸¸åƒåœ¾å›æ”¶æ—¶</td>
<td>è·Ÿè¸ªå¯¹è±¡çš„åƒåœ¾å›æ”¶</td>
<td>åƒåœ¾å›æ”¶åç»ˆæ­¢</td>
<td>DirectByteBufferå †å¤–å†…å­˜é‡Šæ”¾</td>
</tr>
</tbody></table>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><blockquote>
<p><a href="https://juejin.im/post/6844903665241686029">ç†è§£Javaçš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨</a></p>
</blockquote>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä¸­é”åˆ†ç±»</title>
    <url>/2021/03/01/java/java-zhong-suo-fen-lei/</url>
    <content><![CDATA[<h1 id="ä¸€ã€Javaä¸­ä¸»æµé”"><a href="#ä¸€ã€Javaä¸­ä¸»æµé”" class="headerlink" title="ä¸€ã€Javaä¸­ä¸»æµé”"></a>ä¸€ã€Javaä¸­ä¸»æµé”</h1><p><img src="/2021/03/01/java/java-zhong-suo-fen-lei/Java%E4%B8%BB%E6%B5%81%E9%94%81.png" alt="Javaä¸»æµé”"></p>
<blockquote>
<p>ä¸Šå›¾æ‘˜è‡ªï¼š<a href="https://tech.meituan.com/2018/11/15/java-lock.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿï¼šä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹</a></p>
</blockquote>
<h2 id="1-1-ä¹è§‚é”-VS-æ‚²è§‚é”"><a href="#1-1-ä¹è§‚é”-VS-æ‚²è§‚é”" class="headerlink" title="1.1 ä¹è§‚é” VS æ‚²è§‚é”"></a>1.1 ä¹è§‚é” VS æ‚²è§‚é”</h2><p>ä¹è§‚é”ä¸æ‚²è§‚é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„æ¦‚å¿µï¼Œä½“ç°äº†çœ‹å¾…çº¿ç¨‹åŒæ­¥çš„ä¸åŒè§’åº¦ã€‚åœ¨Javaå’Œæ•°æ®åº“ä¸­éƒ½æœ‰æ­¤æ¦‚å¿µå¯¹åº”çš„å®é™…åº”ç”¨ã€‚</p>
<p>å…ˆè¯´æ¦‚å¿µã€‚å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚Javaä¸­ï¼Œsynchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚</p>
<p>è€Œä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆä¾‹å¦‚æŠ¥é”™æˆ–è€…è‡ªåŠ¨é‡è¯•ï¼‰ã€‚</p>
<p>ä¹è§‚é”åœ¨Javaä¸­æ˜¯é€šè¿‡ä½¿ç”¨æ— é”ç¼–ç¨‹æ¥å®ç°ï¼Œæœ€å¸¸é‡‡ç”¨çš„æ˜¯CASç®—æ³•ï¼ŒJavaåŸå­ç±»ä¸­çš„é€’å¢æ“ä½œå°±é€šè¿‡CASè‡ªæ—‹å®ç°çš„ã€‚</p>
<h3 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul>
<li>æ‚²è§‚é”é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚</li>
<li>ä¹è§‚é”é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡</li>
</ul>
<h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><p>ï¼ˆ1ï¼‰ ABAé—®é¢˜ã€‚CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯Aï¼Œåæ¥å˜æˆäº†Bï¼Œç„¶ååˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»â€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ã€‚<br>JDKä»1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚<br>ï¼ˆ2ï¼‰ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚CASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚<br>ï¼ˆ3ï¼‰åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€‚å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚<br>Javaä»1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚</p>
<h2 id="1-2-è‡ªæ—‹é”-VS-é€‚åº”æ€§è‡ªæ—‹é”"><a href="#1-2-è‡ªæ—‹é”-VS-é€‚åº”æ€§è‡ªæ—‹é”" class="headerlink" title="1.2 è‡ªæ—‹é” VS é€‚åº”æ€§è‡ªæ—‹é”"></a>1.2 è‡ªæ—‹é” VS é€‚åº”æ€§è‡ªæ—‹é”</h2><p>åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´å»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚<br>è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œè‡ªæ—‹ï¼Œå¦‚æœåœ¨è‡ªæ—‹å®Œæˆåå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å¯ä»¥ä¸å¿…é˜»å¡è€Œæ˜¯ç›´æ¥è·å–åŒæ­¥èµ„æºï¼Œä»è€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯è‡ªæ—‹é”ã€‚<br>è‡ªæ—‹é”æœ¬èº«æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œå®ƒä¸èƒ½ä»£æ›¿é˜»å¡ã€‚è‡ªæ—‹ç­‰å¾…è™½ç„¶é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œä½†å®ƒè¦å ç”¨å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœé”è¢«å ç”¨çš„æ—¶é—´å¾ˆçŸ­ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ•ˆæœå°±ä¼šéå¸¸å¥½ã€‚åä¹‹ï¼Œå¦‚æœé”è¢«å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹åªä¼šç™½æµªè´¹å¤„ç†å™¨èµ„æºã€‚æ‰€ä»¥ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šæ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰æ²¡æœ‰æˆåŠŸè·å¾—é”ï¼Œå°±åº”å½“æŒ‚èµ·çº¿ç¨‹ã€‚</p>
<h2 id="1-3-æ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”"><a href="#1-3-æ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”" class="headerlink" title="1.3 æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”"></a>1.3 æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”</h2><p>è¿™å››ç§é”æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œä¸“é—¨é’ˆå¯¹synchronizedçš„ã€‚<br>é¦–å…ˆä¸ºä»€ä¹ˆSynchronizedèƒ½å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ</p>
<p>åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼šâ€œJavaå¯¹è±¡å¤´â€ã€â€œMonitorâ€ã€‚</p>
<h3 id="Javaå¯¹è±¡å¤´"><a href="#Javaå¯¹è±¡å¤´" class="headerlink" title="Javaå¯¹è±¡å¤´"></a>Javaå¯¹è±¡å¤´</h3><p>synchronizedæ˜¯æ‚²è§‚é”ï¼Œåœ¨æ“ä½œåŒæ­¥èµ„æºä¹‹å‰éœ€è¦ç»™åŒæ­¥èµ„æºå…ˆåŠ é”ï¼Œè¿™æŠŠé”å°±æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ï¼Œè€ŒJavaå¯¹è±¡å¤´åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä»¥Hotspotè™šæ‹Ÿæœºä¸ºä¾‹ï¼ŒHotspotçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚</p>
<p>Mark Wordï¼šé»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚</p>
<p>Klass Pointï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚</p>
<h3 id="Monitor"><a href="#Monitor" class="headerlink" title="Monitor"></a>Monitor</h3><p>Monitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚</p>
<p>Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚</p>
<p>ç°åœ¨è¯é¢˜å›åˆ°synchronizedï¼Œsynchronizedé€šè¿‡Monitoræ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼ŒMonitoræ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockï¼ˆäº’æ–¥é”ï¼‰æ¥å®ç°çš„çº¿ç¨‹åŒæ­¥ã€‚</p>
<p>å¦‚åŒæˆ‘ä»¬åœ¨è‡ªæ—‹é”ä¸­æåˆ°çš„â€œé˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿â€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯synchronizedæœ€åˆå®ç°åŒæ­¥çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯JDK 6ä¹‹å‰synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚è¿™ç§ä¾èµ–äºæ“ä½œç³»ç»ŸMutex Lockæ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé‡é‡çº§é”â€ï¼ŒJDK 6ä¸­ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚</p>
<p>æ‰€ä»¥ç›®å‰é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çŠ¶æ€åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚<br>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯¹synchronizedçš„åŠ é”æœºåˆ¶ä»¥åŠç›¸å…³çŸ¥è¯†æœ‰äº†ä¸€ä¸ªäº†è§£ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬ç»™å‡ºå››ç§é”çŠ¶æ€å¯¹åº”çš„çš„Mark Wordå†…å®¹ï¼Œç„¶åå†åˆ†åˆ«è®²è§£å››ç§é”çŠ¶æ€çš„æ€è·¯ä»¥åŠç‰¹ç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th>é”çŠ¶æ€</th>
<th>å­˜å‚¨å†…å®¹</th>
<th>å­˜å‚¨å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>æ— é”</td>
<td>å¯¹è±¡çš„hashCodeã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”ï¼ˆ0ï¼‰</td>
<td>01</td>
</tr>
<tr>
<td>åå‘é”</td>
<td>åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”ï¼ˆ1ï¼‰</td>
<td>01</td>
</tr>
<tr>
<td>è½»é‡çº§é”</td>
<td>æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ</td>
<td>00</td>
</tr>
<tr>
<td>é‡é‡çº§é”</td>
<td>æŒ‡å‘äº’æ–¥é‡ï¼ˆé‡é‡çº§é”ï¼‰çš„æŒ‡é’ˆ</td>
<td>10</td>
</tr>
</tbody></table>
<h3 id="æ— é”"><a href="#æ— é”" class="headerlink" title="æ— é”"></a>æ— é”</h3><p>æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚</p>
<p>æ— é”çš„ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„CASåŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®ç°ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚</p>
<h3 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h3><p>åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚</p>
<p>åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚</p>
<p>åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking&#x3D;falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚</p>
<h3 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h3><p>æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<p>åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚</p>
<p>æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚</p>
<p>å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚</p>
<p>å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚</p>
<p>è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p>
<h3 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h3><p>å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<p>æ•´ä½“çš„é”çŠ¶æ€å‡çº§æµç¨‹å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>æ— é” -&gt; åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”</p>
</blockquote>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åå‘é”é€šè¿‡å¯¹æ¯”Mak Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…è¿›è¡ŒCASæ“ä½œï¼Œè€Œè½»é‡çº§é”æ˜¯é€šè¿‡CASæ“ä½œå’Œè‡ªæ—‹é”æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚</p>
<h2 id="1-4-å…¬å¹³é”-VS-éå…¬å¹³é”"><a href="#1-4-å…¬å¹³é”-VS-éå…¬å¹³é”" class="headerlink" title="1.4 å…¬å¹³é” VS éå…¬å¹³é”"></a>1.4 å…¬å¹³é” VS éå…¬å¹³é”</h2><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚</p>
<p>éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚</p>
<p>ReentrantLocké‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼ŒSyncç»§æ‰¿AQSï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨Syncä¸­å®ç°çš„ã€‚å®ƒæœ‰å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonfairSyncä¸¤ä¸ªå­ç±»ã€‚ReentrantLocké»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾ç¤ºçš„æŒ‡å®šä½¿ç”¨å…¬å¹³é”ã€‚</p>
<h2 id="1-5-å¯é‡å…¥é”-VS-éå¯é‡å…¥é”"><a href="#1-5-å¯é‡å…¥é”-VS-éå¯é‡å…¥é”" class="headerlink" title="1.5 å¯é‡å…¥é” VS éå¯é‡å…¥é”"></a>1.5 å¯é‡å…¥é” VS éå¯é‡å…¥é”</h2><p>å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚Javaä¸­ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</p>
<p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ReentrantLockå’Œsynchronizedéƒ½æ˜¯é‡å…¥é”ã€‚</p>
<h2 id="1-6-ç‹¬å é”-VS-å…±äº«é”"><a href="#1-6-ç‹¬å é”-VS-å…±äº«é”" class="headerlink" title="1.6 ç‹¬å é” VS å…±äº«é”"></a>1.6 ç‹¬å é” VS å…±äº«é”</h2><p>ç‹¬äº«é”ä¹Ÿå«æ’ä»–é”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’å®ƒé”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚JDKä¸­çš„synchronizedå’ŒJUCä¸­Lockçš„å®ç°ç±»å°±æ˜¯äº’æ–¥é”ã€‚<br>å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚</p>
<p>ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚</p>
<h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul>
<li>æ‚²è§‚é”è®¿é—®ä¸´ç•Œèµ„æºé¢„å…ˆåŠ é”ï¼Œå¦‚Javaä¸­çš„synchronizedå’ŒLockå®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚</li>
<li>ä¹è§‚é”è®¿é—®ä¸´ç•Œèµ„æºä¸åŠ é”ï¼Œåªæœ‰åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™æ£€æŸ¥æ˜¯å¦å‘ç”Ÿäº†å†²çªï¼Œå¦‚æœå‘ç”Ÿå†²çªåˆ™è¿›è¡Œé‡è¯•ã€‚ReenterLockå†…éƒ¨çš„AQSï¼Œè¿˜æ˜¯å„ç§Atomicå¼€å¤´çš„åŸå­ç±»ï¼Œå†…éƒ¨éƒ½åº”ç”¨åˆ°äº†CASã€‚</li>
<li>è‡ªæ—‹é”é€šè¿‡è®©çº¿ç¨‹è‡ªæ—‹é¿å…è®©çº¿ç¨‹é™·å…¥é˜»å¡ï¼Œä¾¿é¢çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</li>
<li>é€‚åº”æ€§è‡ªæ—‹é”é€šè¿‡æ”¶é›†è·å–é”çš„çº¿ç¨‹çš„è‡ªæ—‹æ¬¡æ•°ã€è‡ªæ—‹æ—¶é•¿åŠé”çŠ¶æ€åŠ¨æ€åˆ¤æ–­çº¿ç¨‹è·å–é”çš„å¯èƒ½ï¼Œæœ€ç»ˆå†³å®šçº¿ç¨‹è¿›è¡Œè‡ªæ—‹æˆ–é˜»å¡ã€‚é¿å…é•¿æ—¶é—´è‡ªæ—‹æµªè´¹å¤„ç†å™¨èµ„æºã€‚</li>
<li>åå‘é”é€šè¿‡å¯¹æ¯”Mak Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…è¿›è¡ŒCASæ“ä½œï¼Œè€Œè½»é‡çº§é”æ˜¯é€šè¿‡CASæ“ä½œå’Œè‡ªæ—‹é”æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚</li>
<li>å…¬å¹³é”æŒ‰ç…§çº¿ç¨‹ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚ä¼˜ç‚¹ï¼šçº¿ç¨‹ä¸ä¼šé¥¿æ­»ï¼›ç¼ºç‚¹ï¼šæ•´ä½“çš„ååæ•ˆç‡ä½ã€‚</li>
<li>éå…¬å¹³é”åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ã€‚ä¼˜ç‚¹ï¼šç³»ç»Ÿååé‡é«˜ï¼›ç¼ºç‚¹ï¼šç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ã€‚</li>
<li>å¯é‡å…¥é”æŒ‡çº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”åè¿›å…¥å†…å±‚æ–¹æ³•è‡ªåŠ¨è·å¾—é”ã€‚Javaä¸­ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</li>
<li>éå¯é‡å…¥é”åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹å†æ¬¡è·å–é”ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä»è€Œé€ æˆæ­»é”ã€‚</li>
<li>ç‹¬å é”æŒ‡é”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¦‚javaä¸­å¾—å†™é”ã€‚</li>
<li>éç‹¬å é”åˆ™å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¦‚javaä¸­çš„è¯»é”ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é”</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶</title>
    <url>/2018/07/26/java/java-chang-yong-ri-zhi-kuang-jia-jie-shao/</url>
    <content><![CDATA[<h3 id="Javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä»‹ç»"><a href="#Javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä»‹ç»" class="headerlink" title="Javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä»‹ç»"></a>Javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä»‹ç»</h3><ul>
<li><strong>Log4j</strong> Â Apache Log4jæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ—¥å¿—è®°å½•å·¥å…·ã€‚å®ƒæ˜¯ç”±Ceki GÃ¼lcÃ¼é¦–åˆ›çš„ï¼Œç°åœ¨åˆ™æ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¹ç›®ã€‚ Log4jæ˜¯å‡ ç§Javaæ—¥å¿—æ¡†æ¶ä¹‹ä¸€ã€‚ </li>
<li><strong>Log4j2</strong> Apache Log4j 2æ˜¯apacheå¼€å‘çš„ä¸€æ¬¾Log4jçš„å‡çº§äº§å“ã€‚ </li>
<li><strong>Commons Logging</strong>  ApacheåŸºé‡‘ä¼šæ‰€å±çš„é¡¹ç›®ï¼Œæ˜¯ä¸€å¥—Javaæ—¥å¿—æ¥å£ï¼Œä¹‹å‰å«Jakarta Commons Loggingï¼Œåæ›´åä¸ºCommons Loggingã€‚ </li>
<li><strong>Slf4j</strong> ç±»ä¼¼äºCommons Loggingï¼Œæ˜¯ä¸€å¥—ç®€æ˜“Javaæ—¥å¿—é—¨é¢ï¼Œæœ¬èº«å¹¶æ— æ—¥å¿—çš„å®ç°ã€‚ï¼ˆSimple Logging Facade for Javaï¼Œç¼©å†™Slf4jï¼‰ã€‚ </li>
<li><strong>Logback</strong>  ä¸€å¥—æ—¥å¿—ç»„ä»¶çš„å®ç°(slf4jé˜µè¥)ã€‚ </li>
<li><strong>Jul</strong> (Java Util Logging),è‡ªJava1.4ä»¥æ¥çš„å®˜æ–¹æ—¥å¿—å®ç°ã€‚</li>
</ul>
<h3 id="Javaå¸¸ç”¨æ¡†æ¶å†å²"><a href="#Javaå¸¸ç”¨æ¡†æ¶å†å²" class="headerlink" title="Javaå¸¸ç”¨æ¡†æ¶å†å²"></a>Javaå¸¸ç”¨æ¡†æ¶å†å²</h3><ul>
<li>1996å¹´æ—©æœŸï¼Œæ¬§æ´²å®‰å…¨ç”µå­å¸‚åœºé¡¹ç›®ç»„å†³å®šç¼–å†™å®ƒè‡ªå·±çš„ç¨‹åºè·Ÿè¸ªAPI(Tracing API)ã€‚ç»è¿‡ä¸æ–­çš„å®Œå–„ï¼Œè¿™ä¸ªAPIç»ˆäºæˆä¸ºä¸€ä¸ªååˆ†å—æ¬¢è¿çš„Javaæ—¥å¿—è½¯ä»¶åŒ…ï¼Œå³Log4jã€‚åæ¥Log4jæˆä¸ºApacheåŸºé‡‘ä¼šé¡¹ç›®ä¸­çš„ä¸€å‘˜ã€‚ </li>
<li>æœŸé—´Log4jè¿‘ä¹æˆäº†Javaç¤¾åŒºçš„æ—¥å¿—æ ‡å‡†ã€‚æ®è¯´ApacheåŸºé‡‘ä¼šè¿˜æ›¾ç»å»ºè®®sunå¼•å…¥Log4jåˆ°javaçš„æ ‡å‡†åº“ä¸­ï¼Œä½†Sunæ‹’ç»äº†ã€‚ </li>
<li>2002å¹´Java1.4å‘å¸ƒï¼ŒSunæ¨å‡ºäº†è‡ªå·±çš„æ—¥å¿—åº“JUL(Java Util Logging),å…¶å®ç°åŸºæœ¬æ¨¡ä»¿äº†Log4jçš„å®ç°ã€‚åœ¨JULå‡ºæ¥ä»¥å‰ï¼Œlog4jå°±å·²ç»æˆä¸ºä¸€é¡¹æˆç†Ÿçš„æŠ€æœ¯ï¼Œä½¿å¾—log4jåœ¨é€‰æ‹©ä¸Šå æ®äº†ä¸€å®šçš„ä¼˜åŠ¿ã€‚ </li>
<li>æ¥ç€ï¼ŒApacheæ¨å‡ºäº†Jakarta Commons Loggingï¼ŒJCLåªæ˜¯å®šä¹‰äº†ä¸€å¥—æ—¥å¿—æ¥å£(å…¶å†…éƒ¨ä¹Ÿæä¾›ä¸€ä¸ªSimple Logçš„ç®€å•å®ç°)ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ—¥å¿—ç»„ä»¶çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½ åº”ç”¨ä»£ç é‡Œï¼Œåªéœ€è°ƒç”¨Commons Loggingçš„æ¥å£ï¼Œåº•å±‚å®ç°å¯ä»¥æ˜¯log4jï¼Œä¹Ÿå¯ä»¥æ˜¯Java Util Loggingã€‚ </li>
<li>åæ¥(2006å¹´)ï¼ŒCeki GÃ¼lcÃ¼ä¸é€‚åº”Apacheçš„å·¥ä½œæ–¹å¼ï¼Œç¦»å¼€äº†Apacheã€‚ç„¶åå…ˆååˆ›å»ºäº†slf4j(æ—¥å¿—é—¨é¢æ¥å£ï¼Œç±»ä¼¼äºCommons Logging)å’ŒLogback(Slf4jçš„å®ç°)ä¸¤ä¸ªé¡¹ç›®ï¼Œå¹¶å›ç‘å…¸åˆ›å»ºäº†QOSå…¬å¸ï¼ŒQOSå®˜ç½‘ä¸Šæ˜¯è¿™æ ·æè¿°Logbackçš„ï¼šThe Genericï¼ŒReliable Fast&amp;Flexible Logging Framework(ä¸€ä¸ªé€šç”¨ï¼Œå¯é ï¼Œå¿«é€Ÿä¸”çµæ´»çš„æ—¥å¿—æ¡†æ¶)ã€‚ </li>
<li>ç°ä»Šï¼ŒJavaæ—¥å¿—é¢†åŸŸè¢«åˆ’åˆ†ä¸ºä¸¤å¤§é˜µè¥ï¼šCommons Loggingé˜µè¥å’ŒSLF4Jé˜µè¥ã€‚ </li>
<li>Apacheçœ¼çœ‹æœ‰è¢«Logbackåè¶…çš„åŠ¿å¤´ï¼Œäº2012-07é‡å†™äº†log4j 1.xï¼Œæˆç«‹äº†æ–°çš„é¡¹ç›®Log4j 2ã€‚Log4j 2å…·æœ‰logbackçš„æ‰€æœ‰ç‰¹æ€§ã€‚</li>
</ul>
<h3 id="javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä¹‹é—´çš„å…³ç³»"><a href="#javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä¹‹é—´çš„å…³ç³»" class="headerlink" title="javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä¹‹é—´çš„å…³ç³»"></a>javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä¹‹é—´çš„å…³ç³»</h3><ul>
<li>Log4j2ä¸Log4j1å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ï¼Œlog4j2ä¸å…¼å®¹log4j1ã€‚ Log4j 2åŒ…å«åŸºäºLMAX Disruptoråº“çš„ä¸‹ä¸€ä»£å¼‚æ­¥è®°å½•å™¨ã€‚åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œå¼‚æ­¥è®°å½•å™¨çš„ååé‡æ¯”Log4j 1.xå’ŒLogbacké«˜18å€ï¼Œå»¶è¿Ÿä½ã€‚ Log4j 2æ˜æ˜¾ä¼˜äºLog4j 1.xï¼ŒLogbackå’Œjava.util.loggingï¼Œå°¤å…¶æ˜¯åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸­ã€‚ </li>
<li>Commons Loggingå’ŒSlf4jæ˜¯æ—¥å¿—é—¨é¢(é—¨é¢æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­å¸¸ç”¨çš„ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿè¢«ç§°ä¸ºæ­£é¢æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€‚å®ƒä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„é«˜å±‚æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨)ã€‚log4jå’ŒLogbackåˆ™æ˜¯å…·ä½“çš„æ—¥å¿—å®ç°æ–¹æ¡ˆã€‚å¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ¥å£ä¸æ¥å£çš„å®ç°ï¼Œè°ƒç”¨è¿™åªéœ€è¦å…³æ³¨æ¥å£è€Œæ— éœ€å…³æ³¨å…·ä½“çš„å®ç°ï¼Œåšåˆ°è§£è€¦ã€‚ </li>
<li>æ¯”è¾ƒå¸¸ç”¨çš„ç»„åˆä½¿ç”¨æ–¹å¼æ˜¯Slf4jä¸Logbackç»„åˆä½¿ç”¨ï¼ŒCommons Loggingä¸Log4jç»„åˆä½¿ç”¨ã€‚ </li>
<li>Logbackå¿…é¡»é…åˆSlf4jä½¿ç”¨ã€‚ç”±äºLogbackå’ŒSlf4jæ˜¯åŒä¸€ä¸ªä½œè€…ï¼Œå…¶å…¼å®¹æ€§ä¸è¨€è€Œå–»ã€‚</li>
</ul>
<h3 id="Commons-Loggingä¸Slf4jå®ç°æœºåˆ¶å¯¹æ¯”"><a href="#Commons-Loggingä¸Slf4jå®ç°æœºåˆ¶å¯¹æ¯”" class="headerlink" title="Commons Loggingä¸Slf4jå®ç°æœºåˆ¶å¯¹æ¯”"></a>Commons Loggingä¸Slf4jå®ç°æœºåˆ¶å¯¹æ¯”</h3><ul>
<li>Commons loggingæ˜¯é€šè¿‡åŠ¨æ€æŸ¥æ‰¾æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä½¿ç”¨è‡ªå·±çš„ClassLoaderå¯»æ‰¾å’Œè½½å…¥æœ¬åœ°å…·ä½“çš„å®ç°ã€‚è¯¦ç»†ç­–ç•¥å¯ä»¥æŸ¥çœ‹commons-logging-*.jaråŒ…ä¸­çš„org.apache.commons.logging.impl.LogFactoryImpl.javaæ–‡ä»¶ã€‚ç”±äºOSGiä¸åŒçš„æ’ä»¶ä½¿ç”¨ç‹¬ç«‹çš„ClassLoaderï¼ŒOSGIçš„è¿™ç§æœºåˆ¶ä¿è¯äº†æ’ä»¶äº’ç›¸ç‹¬ç«‹, å…¶æœºåˆ¶é™åˆ¶äº†commons loggingåœ¨OSGiä¸­çš„æ­£å¸¸ä½¿ç”¨ã€‚ </li>
<li>Slf4jåœ¨ç¼–è¯‘æœŸé—´ï¼Œé™æ€ç»‘å®šæœ¬åœ°çš„LOGåº“ï¼Œå› æ­¤å¯ä»¥åœ¨OSGiä¸­æ­£å¸¸ä½¿ç”¨ã€‚å®ƒæ˜¯é€šè¿‡æŸ¥æ‰¾ç±»è·¯å¾„ä¸‹org.slf4j.impl.StaticLoggerBinderï¼Œç„¶åç»‘å®šå·¥ä½œéƒ½åœ¨è¿™ç±»é‡Œé¢è¿›ã€‚</li>
</ul>
<h3 id="å¦‚ä½•åœ¨é¡¹ç›®ä¸­é€‰æ‹©æ—¥å¿—æ¡†æ¶"><a href="#å¦‚ä½•åœ¨é¡¹ç›®ä¸­é€‰æ‹©æ—¥å¿—æ¡†æ¶" class="headerlink" title="å¦‚ä½•åœ¨é¡¹ç›®ä¸­é€‰æ‹©æ—¥å¿—æ¡†æ¶"></a>å¦‚ä½•åœ¨é¡¹ç›®ä¸­é€‰æ‹©æ—¥å¿—æ¡†æ¶</h3><p>å¦‚æœæ˜¯åœ¨ä¸€ä¸ªæ–°çš„é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨Slf4jä¸Logbackç»„åˆï¼Œè¿™æ ·æœ‰å¦‚ä¸‹çš„å‡ ä¸ªä¼˜ç‚¹ã€‚ </p>
<ul>
<li><p>Slf4jå®ç°æœºåˆ¶å†³å®šSlf4jé™åˆ¶è¾ƒå°‘ï¼Œä½¿ç”¨èŒƒå›´æ›´å¹¿ã€‚ç”±äºSlf4jåœ¨ç¼–è¯‘æœŸé—´ï¼Œé™æ€ç»‘å®šæœ¬åœ°çš„LOGåº“ä½¿å¾—é€šç”¨æ€§è¦æ¯”Commons loggingè¦å¥½ã€‚ </p>
</li>
<li><p>Logbackæ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚Logbackå£°ç§°ï¼šæŸäº›å…³é”®æ“ä½œï¼Œæ¯”å¦‚åˆ¤å®šæ˜¯å¦è®°å½•ä¸€æ¡æ—¥å¿—è¯­å¥çš„æ“ä½œï¼Œå…¶æ€§èƒ½å¾—åˆ°äº†æ˜¾è‘—çš„æé«˜ã€‚è¿™ä¸ªæ“ä½œåœ¨Logbackä¸­éœ€è¦3çº³ç§’ï¼Œè€Œåœ¨Log4Jä¸­åˆ™éœ€è¦30çº³ç§’ã€‚LogBackåˆ›å»ºè®°å½•å™¨ï¼ˆloggerï¼‰çš„é€Ÿåº¦ä¹Ÿæ›´å¿«ï¼š13æ¯«ç§’ï¼Œè€Œåœ¨Log4Jä¸­éœ€è¦23æ¯«ç§’ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒè·å–å·²å­˜åœ¨çš„è®°å½•å™¨åªéœ€94çº³ç§’ï¼Œè€ŒLog4Jéœ€è¦2234çº³ç§’ï¼Œæ—¶é—´å‡å°‘åˆ°äº†1&#x2F;23ã€‚è·ŸJULç›¸æ¯”çš„æ€§èƒ½æé«˜ä¹Ÿæ˜¯æ˜¾è‘—çš„ã€‚ </p>
</li>
<li><p>Commons Loggingå¼€é”€æ›´é«˜ åœ¨ä½¿Commons Loggingæ—¶ä¸ºäº†å‡å°‘æ„å»ºæ—¥å¿—ä¿¡æ¯çš„å¼€é”€ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ï¼š</p>
<p><code>if(log.isDebugEnabled())&#123; </code></p>
<p>â€‹    <code>log.debug(&quot;User nameï¼š &quot; + user.getName() + &quot; buy goods id ï¼š&quot; + good.getId());</code> </p>
<p><code>&#125;</code> </p>
<p>åœ¨Slf4jé˜µè¥ï¼Œä½ åªéœ€è¿™ä¹ˆåšï¼š</p>
<p> <code>log.debug(&quot;User nameï¼š&#123;&#125; ,buy goods id ï¼š&#123;&#125;&quot;, user.getName(),good.getId());</code> </p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œslf4jæŠŠæ„å»ºæ—¥å¿—çš„å¼€é”€æ”¾åœ¨äº†å®ƒç¡®è®¤éœ€è¦æ˜¾ç¤ºè¿™æ¡æ—¥å¿—ä¹‹åï¼Œå‡å°‘å†…å­˜å’Œcupçš„å¼€é”€ï¼Œä½¿ç”¨å ä½ç¬¦å·ï¼Œä»£ç ä¹Ÿæ›´ä¸ºç®€æ´ ã€‚</p>
</li>
<li><p>Logbackæ–‡æ¡£å…è´¹ã€‚Logbackçš„æ‰€æœ‰æ–‡æ¡£æ˜¯å…¨é¢å…è´¹æä¾›çš„ï¼Œä¸è±¡Log4Jé‚£æ ·åªæä¾›éƒ¨åˆ†å…è´¹æ–‡æ¡£è€Œéœ€è¦ç”¨æˆ·å»è´­ä¹°ä»˜è´¹æ–‡æ¡£ã€‚</p>
</li>
</ul>
<h3 id="å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨self4j"><a href="#å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨self4j" class="headerlink" title="å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨self4j"></a>å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨self4j</h3><p><strong>ç›´æ¥ä½¿ç”¨slf4jæ¥è¾“å…¥æ—¥å¿—çš„æ–¹å¼</strong></p>
<p><img src="/2018/07/26/java/java-chang-yong-ri-zhi-kuang-jia-jie-shao/concrete-bindings.png" alt="concrete-bindings"></p>
<p>è¿™é‡Œå¼•ç”¨äº†slf4jå®˜ç½‘çš„å›¾ï¼Œ<a href="https://www.slf4j.org/manual.html">å»å®˜ç½‘æŸ¥é˜…å¯ä»¥ç‚¹å‡»è¿™é‡Œ</a></p>
<p>ç®€å•è¯´ä¸€ä¸‹å¯¹ä¸Šå›¾çš„ç†è§£ï¼š</p>
<ul>
<li>å›¾ä¸­ç¬¬ä¸€å±‚ç»¿è‰²çš„æ¨¡å—applicationä»£è¡¨ä½ çš„åº”ç”¨ç¨‹åº</li>
<li>å›¾ä¸­ç¬¬äºŒå±‚æµ…è“è‰²çš„æ¨¡å—ï¼Œä»£è¡¨æ˜¯æŠ½è±¡çš„æ—¥å¿—æ¥å£å±‚ï¼Œè¿™é‡Œç”¨çš„æ˜¯<em>slf4j</em></li>
<li>å›¾ä¸­ç¬¬ä¸‰å±‚åˆ†ä¸ºä¸¤ç§ï¼š<ul>
<li>ä¸€ç§æ˜¯æ·±è“è‰²çš„ï¼Œè¡¨ç¤ºçš„æ˜¯ç¬¬äºŒå±‚ä¸­<em>slf4j</em>æ—¥å¿—æ¥å£çš„ç›´æ¥å®ç°,ç›´æ¥å®ç°äº†<em>slf4j</em>çš„æ—¥å¿—æ¡†æ¶æœ‰logbackã€slf4j-simpleï¼ˆslf4jçš„ç®€å•å®ç°ï¼‰ã€ slf4j-nopï¼ˆä¸¢å¼ƒæ—¥å¿—ä¸æ‰“å°ï¼‰</li>
<li>å¦å¤–ä¸€ä¸­æ¹–è“è‰²çš„ï¼Œè¡¨ç¤ºæ˜¯æ²¡æœ‰ç›´æ¥å®ç°<em>slf4j</em>çš„APIï¼Œè€Œæ˜¯é€šè¿‡é€‚é…å™¨è°ƒç”¨å…¶å®ƒå…·ä½“æ—¥å¿—æ¡†æ¶çš„APIï¼Œè¿™é‡ŒåŒ…æ‹¬<em>slf4j</em>åˆ°log4jçš„é€‚é…å’Œ<em>slf4j</em>åˆ°Julçš„é€‚é…ã€‚</li>
</ul>
</li>
<li>ç¬¬å››å±‚ç°è‰²çš„æ¨¡å—è¡¨ç¤ºå…·ä½“çš„æ—¥å¿—æ¡†æ¶ï¼Œä»–ä»¬æ²¡æœ‰ç›´æ¥å®ç°<em>slf4j</em>çš„APIï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸Šå±‚çš„é€‚é…å™¨ä¸<em>slf4j</em>åšé€‚é…å®ç°æ—¥å¿—ç®¡ç†ã€‚</li>
</ul>
<p>*<em>å¦‚æœä½ çš„åº”ç”¨åŒ…å«å…¶ä»–æ¨¡å—ï¼Œä½†è¿™äº›æ¨¡å—æ²¡æœ‰ä½¿ç”¨slf4jï¼Œè€Œæ˜¯ä½¿ç”¨äº†å…¶ä»–æ—¥å¿—æ¡†æ¶ï¼Œä¸è¦æ‹…å¿ƒï¼Œ<em>slf4j</em>æä¾›äº†ä¸€äº›åŒ…å¯ä»¥å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—è½¬åˆ°slf4jåšä¸€ä¸ªç»Ÿä¸€è¾“å‡ºï¼Œå…·ä½“å¯ä»¥å‚è€ƒ</em>slf4j<em>å®˜ç½‘çš„è¿™å¹…å›¾</em>*</p>
<p><img src="/2018/07/26/java/java-chang-yong-ri-zhi-kuang-jia-jie-shao/legacy.png" alt="legacy"></p>
<p><a href="https://www.slf4j.org/legacy.html">å»å®˜ç½‘æŸ¥é˜…å¯ä»¥ç‚¹å‡»è¿™é‡Œ</a></p>
<p>ä¸Šå›¾ä¸­ä»å·¦åˆ°å³å†åˆ°ä¸‹åˆ†åˆ«ä¸ºå›¾ä¸€ã€å›¾äºŒã€å›¾ä¸‰</p>
<ul>
<li><p>å›¾ä¸€è¡¨ç¤ºä½¿ç”¨<em>slf4j</em>ä½œä¸ºç»Ÿä¸€æ—¥å¿—è¾“å‡ºï¼Œå°†ç¨‹åºä¸­åŸæœ‰çš„Commons Longingã€Log4jã€Julæ—¥å¿—é€‚é…åˆ°slf4j</p>
<table>
<thead>
<tr>
<th>jaråŒ…å</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>log4j-over-slf4j-version.jar</strong></td>
<td>å°†log4jé€‚é…åˆ°slf4j</td>
</tr>
<tr>
<td><strong>jcl-over-slf4j-version.jar</strong></td>
<td>å°†commos loggingé€‚é…åˆ°slf4j</td>
</tr>
<tr>
<td><strong>jul-to-slf4j-version.jar</strong></td>
<td>å°†Java Util Loggingé€‚é…åˆ°slf4j</td>
</tr>
</tbody></table>
<p>å¯ä»¥é€šè¿‡ä¸Šé¢çš„åŒ…å°†åŸæ¥çš„æ—¥å¿—é€‚é…åˆ°<em>slf4j</em>ä½œä¸ºç»Ÿä¸€æ—¥å¿—è¾“å‡ºï¼Œä½¿ç”¨logbackä½œä¸ºå…·ä½“æ—¥å¿—å®ç°ã€‚</p>
</li>
<li><p>å›¾äºŒã€ä¸‰åŸç†ç±»ä¼¼ï¼Œåªæ˜¯æ›´æ¢äº†slf4jçš„æ—¥å¿—å®ç°æ–¹å¼ã€‚</p>
</li>
</ul>
<p><strong>æ³¨æ„</strong></p>
<p>å¦‚æœæœ‰å…¶å®ƒæ—¥å¿—é‡å®šå‘åˆ°äº†<em>slf4j</em>ï¼Œå°±ä¸èƒ½å°†è¯¥æ—¥å¿—å†ä½œä¸º<em>slf4j</em>çš„å…·ä½“å®ç°äº†ï¼Œå¦åˆ™ä¼šå½¢æˆé—­ç¯ï¼ˆ<em>è¯¥æ—¥å¿—å°†è¾“å‡ºé‡å®šå‘åˆ°slf4jï¼Œslf4jåˆå°†æ—¥å¿—è¾“å‡ºåˆ°è¯¥æ—¥å¿—</em>ï¼‰ï¼Œæ‰€ä»¥å°†å…¶å®ƒæ—¥å¿—é‡å®šå‘åˆ°slf4jçš„æ–¹å¼åªæœ‰å¦‚ä¸Šä¸‰ç§æ­é…ç»„åˆæ–¹å¼ã€‚</p>
<hr>
<p><strong>ä¸Šé¢ä»‹ç»ä½¿ç”¨slf4jä½œä¸ºç»Ÿä¸€æ—¥å¿—è¾“å‡ºï¼Œå°†å…¶å®ƒæ—¥å¿—é€‚é…åˆ°slf4jï¼Œä»¥åŠslf4jç»‘å®šå…·ä½“æ—¥å¿—å®ç°ï¼Œè¿™äº›é€‚é…åŠŸèƒ½çš„jaråŒ…å’Œé€‚é…å™¨ç›¸å…³çš„jaråŒ…éƒ½æ˜¯ç”±slf4jæä¾›çš„ï¼ŒApacheä½œä¸ºlog4jçš„ç»´æŠ¤æ–¹ï¼Œä¹Ÿæä¾›äº†ä¸€äº›æ¡¥æ¥å™¨ï¼Œæ›´å¥½çš„æ”¯æŒlog4j 2</strong></p>
<table>
<thead>
<tr>
<th>jaråŒ…</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>log4j-1.2-api</td>
<td>å°†log4j 2ä½œä¸ºlog4j 1.x çš„å…·ä½“å®ç°ï¼ˆ<em>ä¸¤è€…ä¸å…¼å®¹</em>ï¼‰</td>
</tr>
<tr>
<td>log4j-jcl</td>
<td>å°†log4j 2ä½œä¸ºjcl çš„å…·ä½“å®ç°</td>
</tr>
<tr>
<td>log4j-slf4j-impl</td>
<td>å°†log4j 2ä½œä¸ºslf4jçš„å…·ä½“å®ç°</td>
</tr>
</tbody></table>
<p><a href="https://logging.apache.org/log4j/2.x/maven-artifacts.html">å»log4j 2å®˜ç½‘æŸ¥çœ‹ç‚¹å‡»è¿™é‡Œ</a></p>
<p><strong>å‚è€ƒé“¾æ¥</strong></p>
<p><a href="https://www.cnblogs.com/chenhongliang/p/5312517.html">Javaå¸¸ç”¨æ—¥å¿—æ¡†æ¶ä»‹ç»</a></p>
<p><a href="https://www.slf4j.org/">slf4jå®˜ç½‘</a></p>
<p><a href="https://logging.apache.org/log4j/2.x/">log4j 2å®˜ç½‘</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>æ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaç±»åŠ è½½æœºåˆ¶</title>
    <url>/2018/07/30/java/java-lei-jia-zai-ji-zhi/</url>
    <content><![CDATA[<h3 id="ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹"><a href="#ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹"></a>ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹</h3><p>ã€€ã€€ ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œç›´åˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬äº†ï¼šÂ <strong>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€ä½¿ç”¨å’Œå¸è½½</strong>Â è¿™7ä¸ªé˜¶æ®µã€‚å…¶ä¸­ï¼ŒÂ <strong>éªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆlinkingï¼‰</strong>Â ã€‚</p>
<p><img src="/2018/07/30/java/java-lei-jia-zai-ji-zhi/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B.png" alt="ç±»åŠ è½½è¿‡ç¨‹"></p>
<p>  å…¶ä¸­ï¼ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™äº”ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­çš„â€œå¼€å§‹â€ï¼ˆä»…ä»…æŒ‡çš„æ˜¯å¼€å§‹ï¼Œè€Œéæ‰§è¡Œæˆ–è€…ç»“æŸï¼Œå› ä¸ºè¿™äº›é˜¶æ®µé€šå¸¸éƒ½æ˜¯äº’ç›¸äº¤å‰çš„æ··åˆè¿›è¡Œï¼Œé€šå¸¸ä¼šåœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨æˆ–è€…æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µï¼‰ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼ˆå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®š)ã€‚ </p>
<h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><p>â€œåŠ è½½â€(Loading)é˜¶æ®µæ˜¯â€œç±»åŠ è½½â€(Class Loading)è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨æ­¤é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>1ã€ é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li>
<li>2ã€ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚</li>
<li>3ã€ åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li>
</ul>
<p>â€‹      åŠ è½½é˜¶æ®µæ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥å®Œæˆï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æ¥å®Œæˆã€‚åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹(å¦‚ä¸€éƒ¨åˆ†å­—èŠ‚ç æ–‡ä»¶æ ¼å¼éªŒè¯åŠ¨ä½œ)æ˜¯äº¤å‰è¿›è¡Œçš„ï¼ŒåŠ è½½é˜¶æ®µå°šæœªå®Œæˆï¼Œè¿æ¥é˜¶æ®µå¯èƒ½å·²ç»å¼€å§‹ã€‚</p>
<hr>
<h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p> éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</p>
<p>â€‹       Javaè¯­è¨€æœ¬èº«æ˜¯ç›¸å¯¹å®‰å…¨çš„è¯­è¨€ï¼Œä½¿ç”¨Javaç¼–ç æ˜¯æ— æ³•åšåˆ°å¦‚è®¿é—®æ•°ç»„è¾¹ç•Œä»¥å¤–çš„æ•°æ®ã€å°†ä¸€ä¸ªå¯¹è±¡è½¬å‹ä¸ºå®ƒå¹¶æœªå®ç°çš„ç±»å‹ç­‰ï¼Œå¦‚æœè¿™æ ·åšäº†ï¼Œç¼–è¯‘å™¨å°†æ‹’ç»ç¼–è¯‘ã€‚ä½†æ˜¯ï¼ŒClassæ–‡ä»¶å¹¶ä¸ä¸€å®šæ˜¯ç”±Javaæºç ç¼–è¯‘è€Œæ¥ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•é€”å¾„ï¼ŒåŒ…æ‹¬ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨(å¦‚UltraEdit)ç›´æ¥ç¼–å†™ã€‚å¦‚æœç›´æ¥ç¼–å†™äº†æœ‰å®³çš„â€œä»£ç â€(å­—èŠ‚æµ)ï¼Œè€Œè™šæ‹Ÿæœºåœ¨åŠ è½½è¯¥Classæ—¶ä¸è¿›è¡Œæ£€æŸ¥çš„è¯ï¼Œå°±æœ‰å¯èƒ½å±å®³åˆ°è™šæ‹Ÿæœºæˆ–ç¨‹åºçš„å®‰å…¨ã€‚</p>
<p>â€‹      ä¸åŒçš„è™šæ‹Ÿæœºï¼Œå¯¹ç±»éªŒè¯çš„å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä½†å¤§è‡´éƒ½ä¼šå®Œæˆä¸‹é¢å››ä¸ªé˜¶æ®µçš„éªŒè¯ ï¼šæ–‡ä»¶æ ¼å¼éªŒè¯ã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯å’Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</p>
<ul>
<li>1ã€æ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œæ˜¯è¦éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆClassæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚å¦‚éªŒè¯é­”æ•°æ˜¯å¦0xCAFEBABEï¼›ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦æ­£åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…ï¼›å¸¸é‡æ± çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹â€¦â€¦è¯¥éªŒè¯é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯ä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¸­ï¼Œç»è¿‡è¿™ä¸ªé˜¶æ®µçš„éªŒè¯åï¼Œå­—èŠ‚æµæ‰ä¼šè¿›å…¥å†…å­˜çš„æ–¹æ³•åŒºä¸­å­˜å‚¨ï¼Œæ‰€ä»¥åé¢çš„ä¸‰ä¸ªéªŒè¯é˜¶æ®µéƒ½æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„è¿›è¡Œçš„ã€‚</li>
<li>2ã€å…ƒæ•°æ®éªŒè¯ï¼Œæ˜¯å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆJavaè¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚å¯èƒ½åŒ…æ‹¬çš„éªŒè¯å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼›è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼›å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³•â€¦â€¦</li>
<li>3ã€å­—èŠ‚ç éªŒè¯ï¼Œä¸»è¦å·¥ä½œæ˜¯è¿›è¡Œæ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºã€‚å¦‚æœä¸€ä¸ªç±»æ–¹æ³•ä½“çš„å­—èŠ‚ç æ²¡æœ‰é€šè¿‡å­—èŠ‚ç éªŒè¯ï¼Œé‚£è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼›ä½†å¦‚æœä¸€ä¸ªæ–¹æ³•ä½“é€šè¿‡äº†å­—èŠ‚ç éªŒè¯ï¼Œä¹Ÿä¸èƒ½è¯´æ˜å…¶ä¸€å®šå°±æ˜¯å®‰å…¨çš„ã€‚</li>
<li>4ã€ç¬¦å·å¼•ç”¨éªŒè¯ï¼Œå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨â€œè§£æé˜¶æ®µâ€ä¸­å‘ç”Ÿã€‚éªŒè¯ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„æƒé™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼›åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•å­—æ®µçš„æè¿°ç¬¦åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µï¼›ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µå’Œæ–¹æ³•çš„è®¿é—®æ€§(privateã€protectedã€publicã€default)æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®</li>
</ul>
<p>éªŒè¯é˜¶æ®µå¯¹äºè™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶æ¥è¯´ï¼Œä¸ä¸€å®šæ˜¯å¿…è¦çš„é˜¶æ®µã€‚å¦‚æœæ‰€è¿è¡Œçš„å…¨éƒ¨ä»£ç ç¡®è®¤æ˜¯å®‰å…¨çš„ï¼Œ å¯ä»¥ä½¿ç”¨ <strong>-Xverifyï¼šnone</strong> å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½æ—¶é—´ã€‚</p>
<hr>
<h4 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h4><p> å‡†å¤‡é˜¶æ®µæ˜¯ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜å¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚å‡†å¤‡é˜¶æ®µä¸åˆ†é…ç±»ä¸­çš„å®ä¾‹å˜é‡çš„å†…å­˜ï¼Œå®ä¾‹å˜é‡å°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨Javaå †ä¸­ã€‚</p>
<p>â€‹        <code>public static int value=123;</code>&#x2F;&#x2F;åœ¨å‡†å¤‡é˜¶æ®µvalueåˆå§‹å€¼ä¸º0 ã€‚åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šå˜ä¸º123 ã€‚</p>
<hr>
<h4 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h4><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚</p>
<p>â€‹       ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referenceï¼‰ï¼šç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç¬¦å·å¼•ç”¨ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œå¼•ç”¨çš„ç›®æ ‡å¹¶ä¸ä¸€å®šå·²ç»åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p>â€‹       ç›´æ¥å¼•ç”¨ï¼ˆDirect Referenceï¼‰ï¼šç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨æ˜¯ä¸è™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ï¼Œå¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆå¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»åœ¨å†…å­˜ä¸­å­˜åœ¨ã€‚</p>
<hr>
<h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>ã€€ã€€ç±»åˆå§‹åŒ–æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œå‰é¢çš„ç±»åŠ è½½è¿‡ç¨‹ï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‚ä¸ä¹‹å¤–ï¼Œå…¶ä½™åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼å’Œæ§åˆ¶ã€‚åˆ°äº†åˆå§‹åŒ–é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ã€‚</p>
<p>â€‹        åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨<clinit>()æ–¹æ³•çš„è¿‡ç¨‹ã€‚<clinit>()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—(static{}å—)ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ ã€‚</clinit></clinit></p>
<p>ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å¼€å§‹ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µ:<em><strong>åŠ è½½</strong></em>ã€‚è™šæ‹Ÿæœºè§„èŒƒä¸­å¹¶æ²¡å¼ºè¡Œçº¦æŸï¼Œè¿™ç‚¹å¯ä»¥äº¤ç»™è™šæ‹Ÿæœºçš„çš„å…·ä½“å®ç°è‡ªç”±æŠŠæ¡ï¼Œä½†æ˜¯å¯¹äº<em><strong>åˆå§‹åŒ–é˜¶æ®µ</strong></em>è™šæ‹Ÿæœºè§„èŒƒæ˜¯ä¸¥æ ¼è§„å®šäº†å¦‚ä¸‹å‡ ç§æƒ…å†µï¼Œå¦‚æœç±»æœªåˆå§‹åŒ–ä¼šå¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚ </p>
<ul>
<li>åˆ›å»ºç±»çš„å®ä¾‹</li>
<li>è®¿é—®ç±»çš„é™æ€å˜é‡ (é™¤å¸¸é‡ã€ è¢«finalä¿®è¾çš„é™æ€å˜é‡ã€‘ åŸå› :å¸¸é‡ä¸€ç§ç‰¹æ®Šçš„å˜é‡ï¼Œå› ä¸ºç¼–è¯‘å™¨æŠŠä»–ä»¬å½“ä½œå€¼(value)è€Œä¸æ˜¯åŸŸ(field)æ¥å¯¹å¾…ã€‚å¦‚æœä½ çš„ä»£ç ä¸­ç”¨åˆ°äº†å¸¸å˜é‡(constant variable)ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šç”Ÿæˆå­—èŠ‚ç æ¥ä»å¯¹è±¡ä¸­è½½å…¥åŸŸçš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥æŠŠè¿™ä¸ªå€¼æ’å…¥åˆ°å­—èŠ‚ç ä¸­ã€‚è¿™æ˜¯ä¸€ç§å¾ˆæœ‰ç”¨çš„ä¼˜åŒ–ï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦æ”¹å˜finalåŸŸçš„å€¼é‚£ä¹ˆæ¯ä¸€å—ç”¨åˆ°é‚£ä¸ªåŸŸçš„ä»£ç éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚</li>
<li>è®¿é—®ç±»çš„é™æ€æ–¹æ³•</li>
<li>åå°„ å¦‚( <strong>Class.forName(â€œmy.xyz.Testâ€)</strong> )</li>
<li>å½“åˆå§‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œå‘ç°å…¶çˆ¶ç±»è¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆå‡ºå‘çˆ¶ç±»çš„åˆå§‹åŒ–</li>
<li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œå®šä¹‰äº†main()æ–¹æ³•çš„é‚£ä¸ªç±»å…ˆåˆå§‹åŒ–</li>
</ul>
<p>ã€€ã€€ä»¥ä¸Šæƒ…å†µç§°ä¸ºç§°å¯¹ä¸€ä¸ªç±»è¿›è¡ŒÂ <strong>â€œä¸»åŠ¨å¼•ç”¨â€</strong>Â ï¼Œé™¤æ­¤ç§æƒ…å†µä¹‹å¤–ï¼Œå‡ä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼Œç§°ä¸º**â€œè¢«åŠ¨å¼•ç”¨â€** </p>
<p>***æ³¨æ„ï¼š***è™šæ‹Ÿæœºåœ¨é¦–æ¬¡åŠ è½½Javaç±»æ—¶ï¼Œä¼šå¯¹é™æ€åˆå§‹åŒ–å—ã€é™æ€æˆå‘˜å˜é‡ã€é™æ€æ–¹æ³•è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ– ï¼Œä½†éé™æ€æ–¹æ³•ä¸è¢«è°ƒç”¨æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚ </p>
<p><em><strong>ç±»åˆå§‹åŒ–é¡ºåºï¼š</strong></em> <em>çˆ¶ç±»é™æ€å˜é‡ ã€€-&gt; ã€€çˆ¶ç±»é™æ€ä»£ç å—ã€€-&gt;ã€€å­ç±»é™æ€å˜é‡ã€€-&gt;ã€€å­ç±»é™æ€ä»£ç å—ã€€-&gt;ã€€çˆ¶ç±»éé™æ€å˜é‡ã€€-&gt;ã€€çˆ¶ç±»éé™æ€ä»£ç å—ã€€-&gt;ã€€çˆ¶ç±»æ„é€ æ–¹æ³•ã€€-&gt;ã€€å­ç±»éé™æ€å˜é‡ã€€-&gt;ã€€å­ç±»éé™æ€ä»£ç å—ã€€-&gt;ã€€å­ç±»æ„é€ æ–¹æ³•</em></p>
<p><em><strong>æ¡ˆä¾‹ï¼š</strong></em></p>
<pre class="line-numbers language-none"><code class="language-none">class SingleTon &#123;
	private static SingleTon singleTon &#x3D; new SingleTon();
	public static int count1;
	public static int count2 &#x3D; 0;

	private SingleTon() &#123;
		count1++;
		count2++;
	&#125;

	public static SingleTon getInstance() &#123;
		return singleTon;
	&#125;
&#125;

public class Test &#123;
	public static void main(String[] args) &#123;
		SingleTon singleTon &#x3D; SingleTon.getInstance();
		System.out.println(&quot;count1&#x3D;&quot; + singleTon.count1);
		System.out.println(&quot;count2&#x3D;&quot; + singleTon.count2);
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç»“æœï¼š1ï¼Œ 0</p>
<hr>
<h3 id="äºŒã€ç±»åŠ è½½å™¨"><a href="#äºŒã€ç±»åŠ è½½å™¨" class="headerlink" title="äºŒã€ç±»åŠ è½½å™¨"></a>äºŒã€ç±»åŠ è½½å™¨</h3><p>ã€€ã€€ç±»åŠ è½½å™¨æ˜¯ä¸€ä¸ªç”¨æ¥åŠ è½½ç±»æ–‡ä»¶çš„ç±»ã€‚Javaæºä»£ç é€šè¿‡javacç¼–è¯‘å™¨ç¼–è¯‘æˆç±»æ–‡ä»¶ã€‚ç„¶åJVMæ¥æ‰§è¡Œç±»æ–‡ä»¶ä¸­çš„å­—èŠ‚ç æ¥æ‰§è¡Œç¨‹åºã€‚ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œæˆ–å…¶ä»–æ¥æºçš„ç±»æ–‡ä»¶ã€‚æœ‰ä¸‰ç§é»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼šBootstrapç±»åŠ è½½å™¨ã€Extensionç±»åŠ è½½å™¨å’ŒSystemç±»åŠ è½½å™¨ï¼ˆæˆ–è€…å«ä½œApplicationç±»åŠ è½½å™¨ï¼‰ã€‚æ¯ç§ç±»åŠ è½½å™¨éƒ½æœ‰è®¾å®šå¥½ä»å“ªé‡ŒåŠ è½½ç±»ã€‚ </p>
<ul>
<li>**å¯åŠ¨ç±»åŠ è½½å™¨(Bootstrap ClassLoader) **</li>
</ul>
<p>ã€€ã€€è´Ÿè´£åŠ è½½ JAVA_HOME\lib ç›®å½•ä¸­çš„ï¼Œæˆ–é€šè¿‡-Xbootclasspathå‚æ•°æŒ‡å®šè·¯å¾„ä¸­çš„ï¼Œä¸”è¢«è™šæ‹Ÿæœºè®¤å¯ï¼ˆæŒ‰æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚rt.jarï¼‰çš„ç±», å®ƒæ˜¯æ‰€æœ‰ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ã€‚Bootstrapç±»åŠ è½½å™¨æ²¡æœ‰ä»»ä½•çˆ¶ç±»åŠ è½½å™¨ï¼Œå¦‚æœä½ è°ƒç”¨String.class.getClassLoader()ï¼Œä¼šè¿”å›nullï¼Œä»»ä½•åŸºäºæ­¤çš„ä»£ç ä¼šæŠ›å‡ºNUllPointerExceptionå¼‚å¸¸ã€‚BootstrapåŠ è½½å™¨è¢«ç§°ä¸ºåˆå§‹ç±»åŠ è½½å™¨ã€‚ </p>
<ul>
<li><strong>æ‰©å±•ç±»åŠ è½½å™¨(Extension ClassLoader)</strong></li>
</ul>
<p>ã€€ã€€è´Ÿè´£åŠ è½½ JAVA_HOME\lib\ext ç›®å½•ä¸­çš„ï¼Œæˆ–é€šè¿‡java.ext.dirsç³»ç»Ÿå˜é‡æŒ‡å®šè·¯å¾„ä¸­çš„ç±»åº“,  æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰å°†åŠ è½½ç±»çš„è¯·æ±‚å§”æ‰˜ç»™ä»–çš„çˆ¶åŠ è½½å™¨ï¼ˆ<em>è¿™é‡Œçš„çˆ¶åŠ è½½å™¨å¹¶éç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆå…³ç³»è¾¾åˆ°å¤ç”¨çˆ¶ç±»åŠ è½½å™¨çš„ä»£ç </em>ï¼‰ï¼Œä¹Ÿå°±æ˜¯Bootstrapç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ²¡æœ‰åŠ è½½æˆåŠŸï¼Œåˆ™åœ¨ JAVA_HOME\lib\ext ç›®å½•ä¸‹åŠ è½½ã€‚ExtensionåŠ è½½å™¨ç”±sun.misc.Launcher$ExtClassLoaderå®ç°ã€‚</p>
<ul>
<li>**åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨(Application ClassLoader) **</li>
</ul>
<p>ã€€ã€€å®ƒè´Ÿè´£ä»classpathç¯å¢ƒå˜é‡ä¸­åŠ è½½æŸäº›åº”ç”¨ç›¸å…³çš„ç±»ï¼Œclasspathç¯å¢ƒå˜é‡é€šå¸¸ç”±-classpathæˆ–-cpå‘½ä»¤è¡Œé€‰é¡¹æ¥å®šä¹‰ï¼Œæˆ–è€…æ˜¯JARä¸­çš„Manifestçš„classpathå±æ€§ã€‚Applicationç±»åŠ è½½å™¨æ˜¯Extensionç±»åŠ è½½å™¨çš„å­åŠ è½½å™¨ã€‚é€šè¿‡sun.misc.Launcher$AppClassLoaderå®ç°ã€‚</p>
<p>é™¤äº†Bootstrapç±»åŠ è½½å™¨æ˜¯å¤§éƒ¨åˆ†ç”±Cæ¥å†™çš„ï¼Œå…¶ä»–çš„ç±»åŠ è½½å™¨éƒ½æ˜¯é€šè¿‡java.lang.ClassLoaderæ¥å®ç°çš„ã€‚ JVMé€šè¿‡åŒäº²å§”æ´¾æ¨¡å‹è¿›è¡Œç±»çš„åŠ è½½ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿java.lang.ClassLoaderå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</p>
<hr>
<h3 id="ä¸‰ã€ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†"><a href="#ä¸‰ã€ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†" class="headerlink" title="ä¸‰ã€ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†"></a>ä¸‰ã€ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†</h3><p>ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†åŸºäºä¸‰ä¸ªæœºåˆ¶ï¼šå§”æ‰˜ã€å¯è§æ€§å’Œå•ä¸€æ€§ã€‚ </p>
<ul>
<li><p><strong>å§”æ‰˜æœºåˆ¶</strong></p>
<p>ã€€ã€€å½“ä¸€ä¸ªç±»åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œç±»ä»…åœ¨æœ‰éœ€è¦åŠ è½½çš„æ—¶å€™è¢«åŠ è½½ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªåº”ç”¨éœ€è¦çš„ç±»å«ä½œAbc.classï¼Œé¦–å…ˆåŠ è½½è¿™ä¸ªç±»çš„è¯·æ±‚ç”±Applicationç±»åŠ è½½å™¨å§”æ‰˜ç»™å®ƒçš„çˆ¶ç±»åŠ è½½å™¨Extensionç±»åŠ è½½å™¨ï¼Œç„¶åå†å§”æ‰˜ç»™Bootstrapç±»åŠ è½½å™¨ã€‚Bootstrapç±»åŠ è½½å™¨ä¼šå…ˆçœ‹çœ‹rt.jarä¸­æœ‰æ²¡æœ‰è¿™ä¸ªç±»ï¼Œå› ä¸ºå¹¶æ²¡æœ‰è¿™ä¸ªç±»ï¼Œæ‰€ä»¥è¿™ä¸ªè¯·æ±‚ç”±å›åˆ°Extensionç±»åŠ è½½å™¨ï¼Œå®ƒä¼šæŸ¥çœ‹jre&#x2F;lib&#x2F;extç›®å½•ä¸‹æœ‰æ²¡æœ‰è¿™ä¸ªç±»ï¼Œå¦‚æœè¿™ä¸ªç±»è¢«Extensionç±»åŠ è½½å™¨æ‰¾åˆ°äº†ï¼Œé‚£ä¹ˆå®ƒå°†è¢«åŠ è½½ï¼Œè€ŒApplicationç±»åŠ è½½å™¨ä¸ä¼šåŠ è½½è¿™ä¸ªç±»ï¼›è€Œå¦‚æœè¿™ä¸ªç±»æ²¡æœ‰è¢«Extensionç±»åŠ è½½å™¨æ‰¾åˆ°ï¼Œé‚£ä¹ˆå†ç”±Applicationç±»åŠ è½½å™¨ä»classpathä¸­å¯»æ‰¾ã€‚è®°ä½classpathå®šä¹‰çš„æ˜¯ç±»æ–‡ä»¶çš„åŠ è½½ç›®å½•ï¼Œè€ŒPATHæ˜¯å®šä¹‰çš„æ˜¯å¯æ‰§è¡Œç¨‹åºå¦‚javacï¼Œjavaç­‰çš„æ‰§è¡Œè·¯å¾„ã€‚</p>
<p>ã€€ã€€é‡‡ç”¨åŒäº²å§”æ´¾çš„ä¸€ä¸ªå¥½å¤„æ˜¯æ¯”å¦‚åŠ è½½ä½äºrt.jaråŒ…ä¸­çš„ç±»java.lang.Objectï¼Œä¸ç®¡æ˜¯å“ªä¸ªåŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ‰˜ç»™é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨æœ€ç»ˆå¾—åˆ°çš„éƒ½æ˜¯åŒæ ·ä¸€ä¸ªObjectå¯¹è±¡ã€‚ </p>
<p>ã€€ã€€åŒäº²å§”æ´¾æ¨¡å¼è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè¯·æ³¨æ„åŒäº²å§”æ´¾æ¨¡å¼ä¸­çš„çˆ¶å­å…³ç³»å¹¶éé€šå¸¸æ‰€è¯´çš„ç±»ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯é‡‡ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶ç±»åŠ è½½å™¨çš„ç›¸å…³ä»£ç  ã€‚</p>
</li>
<li><p><strong>å¯è§æ€§æœºåˆ¶</strong></p>
</li>
</ul>
<p>ã€€ã€€æ ¹æ®å¯è§æ€§æœºåˆ¶ï¼Œå­ç±»åŠ è½½å™¨å¯ä»¥çœ‹åˆ°çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œè€Œåä¹‹åˆ™ä¸è¡Œã€‚æ‰€ä»¥ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå½“Abc.classå·²ç»è¢«Applicationç±»åŠ è½½å™¨åŠ è½½è¿‡äº†ï¼Œç„¶åå¦‚æœæƒ³è¦ä½¿ç”¨Extensionç±»åŠ è½½å™¨åŠ è½½è¿™ä¸ªç±»ï¼Œå°†ä¼šæŠ›å‡ºjava.lang.ClassNotFoundExceptionå¼‚å¸¸ã€‚ </p>
<pre class="line-numbers language-none"><code class="language-none">package test;
import java.util.logging.Level;
import java.util.logging.Logger;
 
&#x2F;**
 * Java program to demonstrate How ClassLoader works in Java,
 * in particular about visibility principle of ClassLoader.
 *
 * @author Javin Paul
 *&#x2F;
 
public class ClassLoaderTest &#123;
 
    public static void main(String args[]) &#123;
        try &#123;          
            &#x2F;&#x2F;printing ClassLoader of this class
            System.out.println(&quot;ClassLoaderTest.getClass().getClassLoader() : &quot;
                                 + ClassLoaderTest.class.getClassLoader());
 
            &#x2F;&#x2F;trying to explicitly load this class again using Extension class loader
            Class.forName(&quot;test.ClassLoaderTest&quot;, true
                            ,  ClassLoaderTest.class.getClassLoader().getParent());
        &#125; catch (ClassNotFoundException ex) &#123;
            Logger.getLogger(ClassLoaderTest.class.getName()).log(Level.SEVERE, null, ex);
        &#125;
    &#125;
 
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">ClassLoaderTest.getClass().getClassLoader() : sun.misc.Launcher$AppClassLoader@601bb1
16&#x2F;08&#x2F;2012 2:43:48 AM test.ClassLoaderTest main
SEVERE: null
java.lang.ClassNotFoundException: test.ClassLoaderTest
        at java.net.URLClassLoader$1.run(URLClassLoader.java:202)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
        at sun.misc.Launcher$ExtClassLoader.findClass(Launcher.java:229)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:247)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:247)
        at test.ClassLoaderTest.main(ClassLoaderTest.java:29)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><strong>å•ä¸€æ€§æœºåˆ¶</strong></p>
<p>ã€€ã€€æ ¹æ®è¿™ä¸ªæœºåˆ¶ï¼Œçˆ¶åŠ è½½å™¨åŠ è½½è¿‡çš„ç±»ä¸èƒ½è¢«å­åŠ è½½å™¨åŠ è½½ç¬¬äºŒæ¬¡ã€‚è™½ç„¶é‡å†™è¿åå§”æ‰˜å’Œå•ä¸€æ€§æœºåˆ¶çš„ç±»åŠ è½½å™¨æ˜¯å¯èƒ½çš„ï¼Œä½†è¿™æ ·åšå¹¶ä¸å¯å–ã€‚ä½ å†™è‡ªå·±çš„ç±»åŠ è½½å™¨çš„æ—¶å€™åº”è¯¥ä¸¥æ ¼éµå®ˆè¿™ä¸‰æ¡æœºåˆ¶ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å››ã€æ˜¾ç¤ºçš„åŠ è½½ç±»"><a href="#å››ã€æ˜¾ç¤ºçš„åŠ è½½ç±»" class="headerlink" title="å››ã€æ˜¾ç¤ºçš„åŠ è½½ç±»"></a>å››ã€æ˜¾ç¤ºçš„åŠ è½½ç±»</h3><p>ã€€ã€€Javaæä¾›äº†æ˜¾å¼åŠ è½½ç±»çš„APIï¼š<code>Class.forName(classname)</code>å’Œ<code>Class.forName(classname, initialized, classloader)</code>ã€‚å°±åƒä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šç±»åŠ è½½å™¨çš„åç§°ä»¥åŠè¦åŠ è½½çš„ç±»çš„åç§°ã€‚ç±»çš„åŠ è½½æ˜¯é€šè¿‡è°ƒç”¨java.lang.ClassLoaderçš„loadClass()æ–¹æ³•ï¼Œè€ŒloadClass()æ–¹æ³•åˆ™è°ƒç”¨äº†findClass()æ–¹æ³•æ¥å®šä½ç›¸åº”ç±»çš„å­—èŠ‚ç ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­Extensionç±»åŠ è½½å™¨ä½¿ç”¨äº†java.net.URLClassLoaderï¼Œå®ƒä»JARå’Œç›®å½•ä¸­è¿›è¡ŒæŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œæ‰€æœ‰ä»¥â€&#x2F;â€ç»“å°¾çš„æŸ¥æ‰¾è·¯å¾„è¢«è®¤ä¸ºæ˜¯ç›®å½•ã€‚å¦‚æœfindClass()æ²¡æœ‰æ‰¾åˆ°é‚£ä¹ˆå®ƒä¼šæŠ›å‡ºjava.lang.ClassNotFoundExceptionå¼‚å¸¸ï¼Œè€Œå¦‚æœæ‰¾åˆ°çš„è¯åˆ™ä¼šè°ƒç”¨defineClass()å°†å­—èŠ‚ç è½¬åŒ–æˆç±»å®ä¾‹ï¼Œç„¶åè¿”å›ã€‚ </p>
<hr>
<p><em><strong>å‚è€ƒæ–‡ç« </strong></em></p>
<p><a href="https://www.tuicool.com/articles/QZnENv">ä»ä¸€é“é¢è¯•é¢˜æ¥è®¤è¯†javaç±»åŠ è½½æ—¶æœºä¸è¿‡ç¨‹</a></p>
<p><a href="http://www.importnew.com/25295.html">JVM ç±»åŠ è½½æœºåˆ¶è¯¦è§£</a></p>
<p><a href="http://www.importnew.com/6581.html">ç±»åŠ è½½å™¨çš„å·¥ä½œåŸç†</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaé›†åˆ</title>
    <url>/2018/07/30/java/java-ji-he/</url>
    <content><![CDATA[<p>â€‹	æ—©åœ¨ Java 2 ä¸­ä¹‹å‰ï¼ŒJava å°±æä¾›äº†ç‰¹è®¾ç±»ã€‚æ¯”å¦‚ï¼šDictionary, Vector, Stack, å’Œ Properties è¿™äº›ç±»ç”¨æ¥å­˜å‚¨å’Œæ“ä½œå¯¹è±¡ç»„ã€‚</p>
<p>è™½ç„¶è¿™äº›ç±»éƒ½éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯å®ƒä»¬ç¼ºå°‘ä¸€ä¸ªæ ¸å¿ƒçš„ï¼Œç»Ÿä¸€çš„ä¸»é¢˜ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œä½¿ç”¨ Vector ç±»çš„æ–¹å¼å’Œä½¿ç”¨ Properties ç±»çš„æ–¹å¼æœ‰ç€å¾ˆå¤§ä¸åŒã€‚</p>
<p>é›†åˆæ¡†æ¶è¢«è®¾è®¡æˆè¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªç›®æ ‡ã€‚</p>
<ul>
<li>è¯¥æ¡†æ¶å¿…é¡»æ˜¯é«˜æ€§èƒ½çš„ã€‚åŸºæœ¬é›†åˆï¼ˆåŠ¨æ€æ•°ç»„ï¼Œé“¾è¡¨ï¼Œæ ‘ï¼Œå“ˆå¸Œè¡¨ï¼‰çš„å®ç°ä¹Ÿå¿…é¡»æ˜¯é«˜æ•ˆçš„ã€‚</li>
<li>è¯¥æ¡†æ¶å…è®¸ä¸åŒç±»å‹çš„é›†åˆï¼Œä»¥ç±»ä¼¼çš„æ–¹å¼å·¥ä½œï¼Œå…·æœ‰é«˜åº¦çš„äº’æ“ä½œæ€§ã€‚</li>
<li>å¯¹ä¸€ä¸ªé›†åˆçš„æ‰©å±•å’Œé€‚åº”å¿…é¡»æ˜¯ç®€å•çš„ã€‚</li>
</ul>
<p>ä¸ºæ­¤ï¼Œæ•´ä¸ªé›†åˆæ¡†æ¶å°±å›´ç»•ä¸€ç»„æ ‡å‡†æ¥å£è€Œè®¾è®¡ã€‚ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æ¥å£çš„æ ‡å‡†å®ç°ï¼Œè¯¸å¦‚ï¼š <strong>LinkedList</strong>, <strong>HashSet</strong>, å’Œ <strong>TreeSet</strong> ç­‰,é™¤æ­¤ä¹‹å¤–ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™äº›æ¥å£å®ç°è‡ªå·±çš„é›†åˆã€‚</p>
<p><img src="/2018/07/30/java/java-ji-he/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E5%9B%BE.png" alt="Javaé›†åˆæ¡†æ¶å›¾"></p>
<p>ä»ä¸Šé¢çš„é›†åˆæ¡†æ¶å›¾å¯ä»¥çœ‹åˆ°ï¼ŒJava é›†åˆæ¡†æ¶ä¸»è¦åŒ…æ‹¬ä¸¤ç§ç±»å‹çš„å®¹å™¨ï¼Œä¸€ç§æ˜¯é›†åˆï¼ˆCollectionï¼‰ï¼Œå­˜å‚¨ä¸€ä¸ªå…ƒç´ é›†åˆï¼Œå¦ä¸€ç§æ˜¯å›¾ï¼ˆMapï¼‰ï¼Œå­˜å‚¨é”®&#x2F;å€¼å¯¹æ˜ å°„ã€‚Collection æ¥å£åˆæœ‰ 3 ç§å­ç±»å‹ï¼ŒListã€Set å’Œ Queueï¼Œå†ä¸‹é¢æ˜¯ä¸€äº›æŠ½è±¡ç±»ï¼Œæœ€åæ˜¯å…·ä½“å®ç°ç±»ï¼Œå¸¸ç”¨çš„æœ‰ ArrayListã€LinkedListã€HashSetã€LinkedHashSetã€HashMapã€LinkedHashMap ç­‰ç­‰ã€‚ </p>
<ul>
<li><p><strong>Collectionæ¥å£</strong></p>
<p>â€‹    Collection å±‚æ¬¡ç»“æ„ä¸­çš„æ ¹æ¥å£ã€‚Collection è¡¨ç¤ºä¸€ç»„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¹Ÿç§°ä¸º collection çš„<em>å…ƒç´ </em>ã€‚ä¸€äº› collection å…è®¸æœ‰é‡å¤çš„å…ƒç´ ï¼Œè€Œå¦ä¸€äº›åˆ™ä¸å…è®¸ã€‚ä¸€äº› collection æ˜¯æœ‰åºçš„ï¼Œè€Œå¦ä¸€äº›åˆ™æ˜¯æ— åºçš„ã€‚JDK ä¸æä¾›æ­¤æ¥å£çš„ä»»ä½•<em>ç›´æ¥</em>Â å®ç°ï¼šå®ƒæä¾›æ›´å…·ä½“çš„å­æ¥å£ï¼ˆå¦‚Â <code>Set</code>Â å’ŒÂ <code>List</code>ï¼‰å®ç°ã€‚æ­¤æ¥å£é€šå¸¸ç”¨æ¥ä¼ é€’ collectionï¼Œå¹¶åœ¨éœ€è¦æœ€å¤§æ™®éæ€§çš„åœ°æ–¹æ“ä½œè¿™äº› collectionã€‚</p>
</li>
</ul>
<p><em><strong>æ–¹æ³•æ‘˜è¦</strong></em></p>
<table>
<thead>
<tr>
<th>è¿”å›ç±»å‹</th>
<th>æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td><code> boolean</code></td>
<td><strong><code>add(EÂ e)</code></strong><br>Â  Â Â Â Â Â Â Â Â Â Â ç¡®ä¿æ­¤ collection åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼ˆå¯é€‰æ“ä½œï¼‰ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>addAll(Collection&lt;? extends E&gt; c)</code></strong><br>            å°†æŒ‡å®š collection ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ·»åŠ åˆ°æ­¤ collection ä¸­ï¼ˆå¯é€‰æ“ä½œï¼‰ã€‚</td>
</tr>
<tr>
<td><code> void</code></td>
<td><strong><code>clear()</code></strong><br>          ç§»é™¤æ­¤ collection ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆå¯é€‰æ“ä½œï¼‰ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>contains(Object o)</code></strong><br>            å¦‚æœæ­¤ collection åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>containsAll(Collection&lt;?&gt; c)</code></strong><br>            å¦‚æœæ­¤ collection åŒ…å«æŒ‡å®š collection ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>equals(Object o)</code></strong><br>            æ¯”è¾ƒæ­¤ collection ä¸æŒ‡å®šå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</td>
</tr>
<tr>
<td><code> int</code></td>
<td><strong><code>hashCode()</code></strong><br>            è¿”å›æ­¤ collection çš„å“ˆå¸Œç å€¼ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>isEmpty()</code></strong><br>            å¦‚æœæ­¤ collection ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å› <code>true</code>ã€‚</td>
</tr>
<tr>
<td><code> Iterator&lt;E&gt;</code></td>
<td><strong><code>iterator()</code></strong><br>            è¿”å›åœ¨æ­¤ collection çš„å…ƒç´ ä¸Šè¿›è¡Œè¿­ä»£çš„è¿­ä»£å™¨ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>remove(Object o)</code></strong><br>            ä»æ­¤ collection ä¸­ç§»é™¤æŒ‡å®šå…ƒç´ çš„å•ä¸ªå®ä¾‹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼ˆå¯é€‰æ“ä½œï¼‰ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>removeAll(Collection&lt;?&gt; c)</code></strong><br>            ç§»é™¤æ­¤ collection ä¸­é‚£äº›ä¹ŸåŒ…å«åœ¨æŒ‡å®š collection ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆå¯é€‰æ“ä½œï¼‰ã€‚</td>
</tr>
<tr>
<td><code> boolean</code></td>
<td><strong><code>retainAll(Collection&lt;?&gt; c)</code></strong><br>           ä»…ä¿ç•™æ­¤ collection ä¸­é‚£äº›ä¹ŸåŒ…å«åœ¨æŒ‡å®š collection çš„å…ƒç´ ï¼ˆå¯é€‰æ“ä½œï¼‰ã€‚</td>
</tr>
<tr>
<td><code> int</code></td>
<td><strong><code>size()</code></strong><br>            è¿”å›æ­¤ collection ä¸­çš„å…ƒç´ æ•°ã€‚</td>
</tr>
<tr>
<td><code> Object[]</code></td>
<td><strong><code>toArray()</code></strong><br>            è¿”å›åŒ…å«æ­¤ collection ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚</td>
</tr>
<tr>
<td><code>&lt;T&gt; T[]</code></td>
<td><strong><code>toArray(T[] a)</code></strong><br>            è¿”å›åŒ…å«æ­¤ collection ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼›è¿”å›æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ä¸æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ç›¸åŒã€‚</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>Listæ¥å£</strong></p>
<p>â€‹    Listæ¥å£é€šå¸¸è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨ï¼ˆæ•°ç»„ã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ ˆç­‰ï¼‰ï¼Œæ˜¯ä¸€ä¸ªæœ‰åºçš„ collectionï¼ˆä¹Ÿç§°ä¸º<em>åºåˆ—</em>ï¼‰ã€‚æ­¤æ¥å£çš„ç”¨æˆ·å¯ä»¥å¯¹åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ çš„æ’å…¥ä½ç½®è¿›è¡Œç²¾ç¡®åœ°æ§åˆ¶ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®å…ƒç´ çš„æ•´æ•°ç´¢å¼•ï¼ˆåœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼‰è®¿é—®å…ƒç´ ï¼Œå¹¶æœç´¢åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚ </p>
<p>â€‹    ä¸ set ä¸åŒï¼Œåˆ—è¡¨é€šå¸¸å…è®¸é‡å¤çš„å…ƒç´ ã€‚æ›´ç¡®åˆ‡åœ°è®²ï¼Œåˆ—è¡¨é€šå¸¸å…è®¸æ»¡è¶³Â <code>e1.equals(e2)</code>Â çš„å…ƒç´ å¯¹Â <code>e1</code>Â å’ŒÂ <code>e2</code>ï¼Œå¹¶ä¸”å¦‚æœåˆ—è¡¨æœ¬èº«å…è®¸ null å…ƒç´ çš„è¯ï¼Œé€šå¸¸å®ƒä»¬å…è®¸å¤šä¸ª null å…ƒç´ ã€‚éš¾å…æœ‰äººå¸Œæœ›é€šè¿‡åœ¨ç”¨æˆ·å°è¯•æ’å…¥é‡å¤å…ƒç´ æ—¶æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸çš„æ–¹æ³•æ¥ç¦æ­¢é‡å¤çš„åˆ—è¡¨ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¿™ç§ç”¨æ³•è¶Šå°‘è¶Šå¥½ã€‚ </p>
<p>â€‹     <code>List</code>Â æ¥å£æä¾›äº†ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œç§°ä¸ºÂ <code>ListIterator</code>ï¼Œé™¤äº†å…è®¸Â <code>Iterator</code>Â æ¥å£æä¾›çš„æ­£å¸¸æ“ä½œå¤–ï¼Œè¯¥è¿­ä»£å™¨è¿˜å…è®¸å…ƒç´ æ’å…¥å’Œæ›¿æ¢ï¼Œä»¥åŠåŒå‘è®¿é—®ã€‚è¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³•æ¥è·å–ä»åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®å¼€å§‹çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚ </p>
</li>
<li><p><strong>Setæ¥å£</strong></p>
<p>â€‹    ä¸€ä¸ªä¸åŒ…å«é‡å¤å…ƒç´ çš„ collectionã€‚æ›´ç¡®åˆ‡åœ°è®²ï¼Œset ä¸åŒ…å«æ»¡è¶³Â <code>e1.equals(e2)</code>Â çš„å…ƒç´ å¯¹Â <code>e1</code>Â å’ŒÂ <code>e2</code>ï¼Œå¹¶ä¸”æœ€å¤šåŒ…å«ä¸€ä¸ª null å…ƒç´ ã€‚æ­£å¦‚å…¶åç§°æ‰€æš—ç¤ºçš„ï¼Œæ­¤æ¥å£æ¨¡ä»¿äº†æ•°å­¦ä¸Šçš„Â <em>set</em>Â æŠ½è±¡ã€‚ </p>
<p>â€‹    </p>
</li>
<li><p><strong>Mapæ¥å£</strong></p>
<p>â€‹    Mapæ˜¯ä¸€ä¸ªæ˜ å°„æ¥å£ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªkey-valueé”®å€¼å¯¹ï¼ŒåŒæ ·æŠ½è±¡ç±»AbstractMapé€šè¿‡é€‚é…å™¨æ¨¡å¼å®ç°äº†Mapæ¥å£ä¸­çš„å¤§éƒ¨åˆ†å‡½æ•°ï¼ŒTreeMapã€HashMapã€WeakHashMapç­‰å®ç°ç±»éƒ½é€šè¿‡ç»§æ‰¿AbstractMapæ¥å®ç°ï¼Œå¦å¤–ï¼Œä¸å¸¸ç”¨çš„HashTableç›´æ¥å®ç°äº†Mapæ¥å£ï¼Œå®ƒå’ŒVectoréƒ½æ˜¯JDK1.0å°±å¼•å…¥çš„é›†åˆç±»ã€‚ </p>
</li>
<li><p><strong>Iteratoræ¥å£</strong></p>
<p>â€‹    Iteratoræ˜¯éå†é›†åˆçš„è¿­ä»£å™¨ï¼ˆä¸èƒ½éå†Mapï¼Œåªç”¨æ¥éå†Collectionï¼‰ï¼Œé™¤äº†Mapç³»åˆ—çš„é›†åˆï¼ŒCollectioné›†åˆéƒ½å®ç°äº† Iterator æ¥å£ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºéå†é›†åˆä¸­å…ƒç´ çš„æ¥å£ï¼Œä¸»è¦æœ‰hashNext()ã€next()ã€remove()ä¸‰ç§æ–¹æ³•ã€‚å®ƒçš„ä¸€ä¸ªå­æ¥å£ListIteratoråœ¨å®ƒçš„åŸºç¡€ä¸Šåˆæ·»åŠ äº†ä¸‰ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ add()ã€previous()ã€hasPrevious()æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœå®ç°Iteratoræ¥å£ï¼Œé‚£ä¹ˆåœ¨éå†é›†åˆä¸­å…ƒç´ çš„æ—¶å€™ï¼Œåªèƒ½å¾€åéå†ï¼Œè¢«éå†åçš„å…ƒç´ ä¸ä¼šå†è¢«éå†åˆ°ï¼Œé€šå¸¸æ— åºé›†åˆå®ç°çš„éƒ½æ˜¯è¿™ä¸ªæ¥å£ï¼Œæ¯”å¦‚HashSetï¼›è€Œé‚£äº›å…ƒç´ æœ‰åºçš„é›†åˆï¼Œå®ç°çš„ä¸€èˆ¬éƒ½æ˜¯ListIteratoræ¥å£ï¼Œå®ç°è¿™ä¸ªæ¥å£çš„é›†åˆå¯ä»¥åŒå‘éå†ï¼Œæ—¢å¯ä»¥é€šè¿‡next()è®¿é—®ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆå¯ä»¥é€šè¿‡previous()è®¿é—®å‰ä¸€ä¸ª å…ƒç´ ï¼Œæ¯”å¦‚ArrayListã€‚</p>
<p>â€‹    Collectionçš„å®ç°ç±»éƒ½å®ç°äº†iterator()å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªIteratorå¯¹è±¡ï¼Œç”¨æ¥éå†é›†åˆï¼ŒListIteratoråˆ™ä¸“é—¨ç”¨æ¥éå†Listã€‚è€ŒEnumerationåˆ™æ˜¯JDK1.0æ—¶å¼•å…¥çš„ï¼Œä½œç”¨ä¸Iteratorç›¸åŒï¼Œä½†å®ƒçš„åŠŸèƒ½æ¯”Iteratorè¦å°‘ï¼Œå®ƒåªèƒ½å†Hashtableã€Vectorå’ŒStackä¸­ä½¿ç”¨ã€‚ </p>
</li>
<li><p>**Arrayså’ŒCollections **</p>
<p>â€‹    Arrayså’ŒCollectionsæ˜¯ç”¨æ¥æ“ä½œæ•°ç»„ã€é›†åˆçš„ä¸¤ä¸ªå·¥å…·ç±»ï¼Œä¾‹å¦‚åœ¨ArrayListå’ŒVectorä¸­å¤§é‡è°ƒç”¨äº†Arrays.Copyof()æ–¹æ³•ï¼Œè€ŒCollectionsä¸­æœ‰å¾ˆå¤šé™æ€æ–¹æ³•å¯ä»¥è¿”å›å„é›†åˆç±»çš„synchronizedç‰ˆæœ¬ï¼Œå³çº¿ç¨‹å®‰å…¨çš„ç‰ˆæœ¬ï¼Œå½“ç„¶äº†ï¼Œå¦‚æœè¦ç”¨çº¿ç¨‹å®‰å…¨çš„ç»“åˆç±»ï¼Œé¦–é€‰Concurrentå¹¶å‘åŒ…ä¸‹çš„å¯¹åº”çš„é›†åˆç±»ã€‚</p>
</li>
</ul>
<h2 id="Javaé›†åˆå®ç°ç±»"><a href="#Javaé›†åˆå®ç°ç±»" class="headerlink" title="Javaé›†åˆå®ç°ç±»"></a>Javaé›†åˆå®ç°ç±»</h2><p>â€‹	Javaæä¾›äº†ä¸€å¥—å®ç°äº†Collectionæ¥å£çš„æ ‡å‡†é›†åˆç±»ã€‚å…¶ä¸­ä¸€äº›æ˜¯å…·ä½“ç±»ï¼Œè¿™äº›ç±»å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼Œè€Œå¦å¤–ä¸€äº›æ˜¯æŠ½è±¡ç±»ï¼Œæä¾›äº†æ¥å£çš„éƒ¨åˆ†å®ç°ã€‚ </p>
<ul>
<li><strong>ArrayList</strong></li>
<li><strong>LinkedList</strong></li>
<li><strong>Vector</strong></li>
<li><strong>Stack</strong></li>
<li><strong>HashSet</strong></li>
<li><strong>TreeSet</strong></li>
<li><strong>LinkedHashSet</strong></li>
<li><strong>ArrayBlockingQueue</strong></li>
<li><strong>LinkedBlockingQueue</strong></li>
<li><strong>DelayQueue</strong></li>
<li><strong>HashMap</strong></li>
<li><strong>TreeMap</strong></li>
<li><strong>Hashtable</strong></li>
<li><strong>LinkedHashMap</strong></li>
<li><strong>WeakHashMap</strong></li>
<li><strong>IdentityHashMap</strong></li>
</ul>
<hr>
<p>æ¥ä¸‹æ¥ä»‹ç»çš„å‡ ä¸ªç±»ä¸æ˜¯ç»“åˆå®ç°ç±»ï¼Œä½†å¯¹é›†åˆæ“ä½œæ¯”è¾ƒé‡è¦</p>
<ul>
<li><strong>Arrays</strong></li>
<li><strong>Collections</strong></li>
</ul>
<p><em><strong>å‚è€ƒæ–‡ç« </strong></em></p>
<p><a href="https://blog.csdn.net/ns_code/article/details/35564663">Javaé›†åˆæ¡†æ¶</a></p>
<p><a href="http://www.runoob.com/java/java-collections.html">Javaé›†åˆæ¡†æ¶</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>LinkedHashMapæºç åˆ†æ</title>
    <url>/2021/03/06/java/linkedhashmap-yuan-ma-fen-xi/</url>
    <content><![CDATA[<h1 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h1><p>LinkedHashMapç»§æ‰¿äº†HashMapï¼Œå¹¶é€šè¿‡åŒå‘åˆ—è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œæœ¬æ–‡ç»“åˆHashMapçš„æºç æ¢ç©¶ä¸€ä¸‹LinkedHashMapæ˜¯å¦‚ä½•ç»´æŠ¤å…ƒç´ çš„é¡ºåºçš„ã€‚</p>
<h2 id="1-1-æ„é€ æ–¹æ³•"><a href="#1-1-æ„é€ æ–¹æ³•" class="headerlink" title="1.1 æ„é€ æ–¹æ³•"></a>1.1 æ„é€ æ–¹æ³•</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    
    <span class="token comment">/**
     * The iteration ordering method for this linked hash map: &lt;tt>true&lt;/tt>
     * for access-order, &lt;tt>false&lt;/tt> for insertion-order.
     *
     * @serial
     */</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> accessOrder<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * Constructs an empty insertion-ordered &lt;tt>LinkedHashMap&lt;/tt> instance
     * with the specified initial capacity and load factor.
     *
     * @param  initialCapacity the initial capacity
     * @param  loadFactor      the load factor
     * @throws IllegalArgumentException if the initial capacity is negative
     *         or the load factor is nonpositive
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">LinkedHashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessOrder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * Constructs an empty insertion-ordered &lt;tt>LinkedHashMap&lt;/tt> instance
     * with the specified initial capacity and a default load factor (0.75).
     *
     * @param  initialCapacity the initial capacity
     * @throws IllegalArgumentException if the initial capacity is negative
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">LinkedHashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessOrder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * Constructs an empty insertion-ordered &lt;tt>LinkedHashMap&lt;/tt> instance
     * with the default initial capacity (16) and load factor (0.75).
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">LinkedHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessOrder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * Constructs an insertion-ordered &lt;tt>LinkedHashMap&lt;/tt> instance with
     * the same mappings as the specified map.  The &lt;tt>LinkedHashMap&lt;/tt>
     * instance is created with a default load factor (0.75) and an initial
     * capacity sufficient to hold the mappings in the specified map.
     *
     * @param  m the map whose mappings are to be placed in this map
     * @throws NullPointerException if the specified map is null
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">LinkedHashMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        accessOrder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token function">putMapEntries</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * Constructs an empty &lt;tt>LinkedHashMap&lt;/tt> instance with the
     * specified initial capacity, load factor and ordering mode.
     *
     * @param  initialCapacity the initial capacity
     * @param  loadFactor      the load factor
     * @param  accessOrder     the ordering mode - &lt;tt>true&lt;/tt> for
     *         access-order, &lt;tt>false&lt;/tt> for insertion-order
     * @throws IllegalArgumentException if the initial capacity is negative
     *         or the load factor is nonpositive
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">LinkedHashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span>
                         <span class="token keyword">float</span> loadFactor<span class="token punctuation">,</span>
                         <span class="token keyword">boolean</span> accessOrder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>accessOrder <span class="token operator">=</span> accessOrder<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>LinkedHashMapçš„æ„é€ æ–¹æ³•å’ŒHashMapç›¸æ¯”å¤šäº†ä¸€ä¸ªaccessOrderå‚æ•°ï¼ŒLinkedHashMapåŸºäºåŒå‘åˆ—è¡¨æ¥è®°å½•å…ƒç´ çš„é¡ºåºã€‚å…ƒç´ çš„æ’åºæ–¹å¼æ ¹æ®accessOrderå‚æ•°æ¥è¿›è¡Œæ§åˆ¶ï¼š</p>
<ul>
<li>accessOrder &#x3D; false ï¼šæ ¹æ®å…ƒç´ çš„æ’å…¥é¡ºåºæ’åº</li>
<li>accessOrder &#x3D; true ï¼š æ ¹æ®å…ƒç´ çš„è®¿é—®é¡ºåºæ’åº</li>
</ul>
<h2 id="1-2-ä¸»è¦å±æ€§"><a href="#1-2-ä¸»è¦å±æ€§" class="headerlink" title="1.2 ä¸»è¦å±æ€§"></a>1.2 ä¸»è¦å±æ€§</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * HashMap.Node subclass for normal LinkedHashMap entries.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">HashMap<span class="token punctuation">.</span>Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> before<span class="token punctuation">,</span> after<span class="token punctuation">;</span>
    <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">3801124242820219131L</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * The head (eldest) of the doubly linked list.
 */</span>
<span class="token keyword">transient</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> head<span class="token punctuation">;</span>

<span class="token comment">/**
 * The tail (youngest) of the doubly linked list.
 */</span>
<span class="token keyword">transient</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> tail<span class="token punctuation">;</span>

<span class="token comment">/**
 * The iteration ordering method for this linked hash map: &lt;tt>true&lt;/tt>
 * for access-order, &lt;tt>false&lt;/tt> for insertion-order.
 *
 * @serial
 */</span>
<span class="token keyword">final</span> <span class="token keyword">boolean</span> accessOrder<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>LinkedHashMapçš„é™æ€å†…éƒ¨ç±»<code>Entry&lt;K,V&gt;</code>ç»§æ‰¿äº†HashMapçš„<code>HashMap.Node&lt;K,V&gt;</code>,<code>Entry</code>å†…éƒ¨æ–°å¢äº†beforeå’Œafterä¸¤ä¸ªå±æ€§ï¼Œå®ç°äº†åŒå‘åˆ—è¡¨ã€‚</li>
<li><code>head</code>å’Œ<code>tail</code>ä¸¤ä¸ªå­—æ®µç”¨äºè®°å½•é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹ã€‚</li>
<li><code>accessOrder</code>æ§åˆ¶åˆ—è¡¨çš„é¡ºåºæ˜¯æ ¹æ®æ’å…¥é¡ºåºæ’åºè¿˜æ˜¯æ ¹æ®è®¿é—®é¡ºåºè¿›è¡Œæ’åºã€‚</li>
</ul>
<h2 id="1-3-ä¸»è¦æ–¹æ³•"><a href="#1-3-ä¸»è¦æ–¹æ³•" class="headerlink" title="1.3 ä¸»è¦æ–¹æ³•"></a>1.3 ä¸»è¦æ–¹æ³•</h2><p>LinkedHashMapå¹¶æ²¡æœ‰é‡å†™çˆ¶ç±»HashMapçš„putæ–¹æ³•ï¼Œè€Œæ˜¯é‡å†™äº†HashMapä¸­ç©ºçš„é’©å­æ–¹æ³•ï¼ŒHashMapæºç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Callbacks to allow LinkedHashMap post-actions</span>
<span class="token keyword">void</span> <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">afterNodeRemoval</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™äº›é’©å­æ–¹æ³•åœ¨HashMapçš„<code>put</code>ç­‰æ–¹æ³•ä¸­è¿›è¡Œäº†è°ƒç”¨ï¼Œå¦‚ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> <span class="token constant">TREEIFY_THRESHOLD</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// existing mapping for key</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="afterNodeInsertion-boolean-evict-æ–¹æ³•"><a href="#afterNodeInsertion-boolean-evict-æ–¹æ³•" class="headerlink" title="afterNodeInsertion(boolean evict)æ–¹æ³•"></a>afterNodeInsertion(boolean evict)æ–¹æ³•</h3><p>è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯åœ¨å…ƒç´ æ·»åŠ åˆ°Mapä¸­åï¼Œåˆ¤æ–­æ˜¯å¦è¦ç§»é™¤æœ€è€çš„å…ƒç´ ï¼Œé»˜è®¤è¿”å›falseã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// possibly remove eldest</span>
    <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> first<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>evict <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>first <span class="token operator">=</span> head<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">removeEldestEntry</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">K</span> key <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        <span class="token function">removeNode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹removeEldestEntry(first)æ–¹æ³•çš„å®ç°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Returns &lt;tt>true&lt;/tt> if this map should remove its eldest entry.
 * This method is invoked by &lt;tt>put&lt;/tt> and &lt;tt>putAll&lt;/tt> after
 * inserting a new entry into the map.  It provides the implementor
 * with the opportunity to remove the eldest entry each time a new one
 * is added.  This is useful if the map represents a cache: it allows
 * the map to reduce memory consumption by deleting stale entries.
 *
 * &lt;p>Sample use: this override will allow the map to grow up to 100
 * entries and then delete the eldest entry each time a new entry is
 * added, maintaining a steady state of 100 entries.
 * &lt;pre>
 *     private static final int MAX_ENTRIES = 100;
 *
 *     protected boolean removeEldestEntry(Map.Entry eldest) &#123;
 *        return size() > MAX_ENTRIES;
 *     &#125;
 * &lt;/pre>
 *
 * &lt;p>This method typically does not modify the map in any way,
 * instead allowing the map to modify itself as directed by its
 * return value.  It &lt;i>is&lt;/i> permitted for this method to modify
 * the map directly, but if it does so, it &lt;i>must&lt;/i> return
 * &lt;tt>false&lt;/tt> (indicating that the map should not attempt any
 * further modification).  The effects of returning &lt;tt>true&lt;/tt>
 * after modifying the map from within this method are unspecified.
 *
 * &lt;p>This implementation merely returns &lt;tt>false&lt;/tt> (so that this
 * map acts like a normal map - the eldest element is never removed).
 *
 * @param    eldest The least recently inserted entry in the map, or if
 *           this is an access-ordered map, the least recently accessed
 *           entry.  This is the entry that will be removed it this
 *           method returns &lt;tt>true&lt;/tt>.  If the map was empty prior
 *           to the &lt;tt>put&lt;/tt> or &lt;tt>putAll&lt;/tt> invocation resulting
 *           in this invocation, this will be the entry that was just
 *           inserted; in other words, if the map contains a single
 *           entry, the eldest entry is also the newest.
 * @return   &lt;tt>true&lt;/tt> if the eldest entry should be removed
 *           from the map; &lt;tt>false&lt;/tt> if it should be retained.
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">removeEldestEntry</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> eldest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“æˆ‘ä»¬å°†LinkedHashMapç”¨ä½œLRUç¼“å­˜ï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶ç¼“å­˜çš„å¤§å°ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦é‡å†™LinkedHashMapçš„removeEldestEntryæ–¹æ³•ï¼Œå½“å…ƒç´ ä¸ªæ•°è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼åï¼Œåˆ™ç§»é™¤æœ€è€çš„å…ƒç´ ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAX_ENTRIES</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">removeEldestEntry</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> eldest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token constant">MAX_ENTRIES</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="afterNodeAccess-Node-e-æ–¹æ³•"><a href="#afterNodeAccess-Node-e-æ–¹æ³•" class="headerlink" title="afterNodeAccess(Node&lt;K,V&gt; e)æ–¹æ³•"></a>afterNodeAccess(Node&lt;K,V&gt; e)æ–¹æ³•</h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹afterNodeAccessæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶æœºï¼š</p>
<ul>
<li>LinkedHashMapä¸­è°ƒç”¨<code>public V get(Object key)</code>æ–¹æ³•æ—¶ï¼Œä¸”accessOrder&#x3D;true</li>
<li>LinkedHashMapä¸­è°ƒç”¨<code>public V getOrDefault(Object key, V defaultValue)</code>æ–¹æ³•æ—¶ï¼Œä¸”accessOrder&#x3D;true</li>
<li>HashMapä¸­è°ƒç”¨<code>put</code>æ–¹æ³•æ·»åŠ ä¸€ä¸ªKeyå·²ç»å­˜åœ¨çš„å…ƒç´ </li>
<li>HashMapä¸­è°ƒç”¨<code>public boolean replace(K key, V oldValue, V newValue)</code>æ–¹æ³•æ—¶</li>
<li>HashMapä¸­è°ƒç”¨<code>public V replace(K key, V value)</code>æ–¹æ³•æ—¶</li>
<li>HashMapä¸­è°ƒç”¨<code>public V computeIfAbsent(K key, Function&lt;? super K, ? extends V&gt; mappingFunction)</code>æ–¹æ³•æ—¶ï¼Œå¯¹åº”Keyçš„å€¼å­˜ä¸”åœ¨ä¸ä¸ºnull</li>
<li>HashMapä¸­è°ƒç”¨<code>public V computeIfPresent(K key, BiFunction&lt;? super K, ? super V, ? extends V&gt; remappingFunction)</code>æ–¹æ³•æ—¶</li>
<li>HashMapä¸­è°ƒç”¨<code>public V compute(K key, BiFunction&lt;? super K, ? super V, ? extends V&gt; remappingFunction) </code>æ–¹æ³•æ—¶</li>
<li>HashMapä¸­è°ƒç”¨<code>public V merge(K key, V value, BiFunction&lt;? super V, ? super V, ? extends V&gt; remappingFunction)</code>æ–¹æ³•æ—¶</li>
</ul>
<p>è¯¥æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨accessOrder&#x3D;trueçš„æƒ…å†µä¸‹ï¼Œå°†eèŠ‚ç‚¹è½¬ç§»è‡³åŒå‘é˜Ÿåˆ—æœ«å°¾ã€‚  </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// move node to last</span>
    <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> last<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>accessOrder <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>last <span class="token operator">=</span> tail<span class="token punctuation">)</span> <span class="token operator">!=</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">,</span> b <span class="token operator">=</span> p<span class="token punctuation">.</span>before<span class="token punctuation">,</span> a <span class="token operator">=</span> p<span class="token punctuation">.</span>after<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>after <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            head <span class="token operator">=</span> a<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            b<span class="token punctuation">.</span>after <span class="token operator">=</span> a<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            a<span class="token punctuation">.</span>before <span class="token operator">=</span> b<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            last <span class="token operator">=</span> b<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>last <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            head <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            p<span class="token punctuation">.</span>before <span class="token operator">=</span> last<span class="token punctuation">;</span>
            last<span class="token punctuation">.</span>after <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        tail <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="afterNodeRemoval-Node-e-æ–¹æ³•"><a href="#afterNodeRemoval-Node-e-æ–¹æ³•" class="headerlink" title="afterNodeRemoval(Node&lt;K,V&gt; e)æ–¹æ³•"></a>afterNodeRemoval(Node&lt;K,V&gt; e)æ–¹æ³•</h3><p>è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯åœ¨å…ƒç´ è¢«ç§»é™¤åå°†åˆ—è¡¨ä¸­çš„å…ƒç´ ä¹Ÿè¿›è¡Œç§»é™¤ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">afterNodeRemoval</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// unlink</span>
    <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">,</span> b <span class="token operator">=</span> p<span class="token punctuation">.</span>before<span class="token punctuation">,</span> a <span class="token operator">=</span> p<span class="token punctuation">.</span>after<span class="token punctuation">;</span>
    p<span class="token punctuation">.</span>before <span class="token operator">=</span> p<span class="token punctuation">.</span>after <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        head <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        b<span class="token punctuation">.</span>after <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tail <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        a<span class="token punctuation">.</span>before <span class="token operator">=</span> b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>LinkedHashMapç»§æ‰¿äº†HashMapï¼Œé€šè¿‡<code>Entry</code>å¯¹è±¡æ„å»ºäº†ä¸€ä¸ªåŒå‘é˜Ÿåˆ—ï¼Œå¹¶é€šè¿‡é‡å†™HashMapä¸­é¢„ç•™çš„ç©ºçš„é’©å­æ–¹æ³•ç»´æŠ¤å…ƒç´ çš„é¡ºåºã€‚å½“accessOrder&#x3D;falseï¼Œé»˜è®¤æ ¹æ®å…ƒç´ çš„æ’å…¥é¡ºåºæ’åºï¼›accessOrder&#x3D;trueï¼Œæ ¹æ®å…ƒç´ çš„è®¿é—®é¡ºåºè¿›è¡Œæ’åºã€‚<br>æ ¹æ®LinkedHashMapçš„ç‰¹ç‚¹ï¼Œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„å®ç°ä¸€ä¸ªLRUç¼“å­˜ç®—æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashMapLRUCache</span> <span class="token keyword">extends</span> <span class="token class-name">LinkedHashMap</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> <span class="token constant">CACHE_MAX_COUNT</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LinkedHashMapLRUCache</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token number">0.75f</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">CACHE_MAX_COUNT</span> <span class="token operator">=</span> initialCapacity<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">removeEldestEntry</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> eldest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token constant">CACHE_MAX_COUNT</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>LinkedHashMap</tag>
        <tag>LRU</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸Šä½¿ç”¨JMeterè¿›è¡Œå‹æµ‹</title>
    <url>/2023/12/02/java/linux-shang-shi-yong-jmeter-jin-xing-ya-ce/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯ç®€ä»‹"><a href="#èƒŒæ™¯ç®€ä»‹" class="headerlink" title="èƒŒæ™¯ç®€ä»‹"></a>èƒŒæ™¯ç®€ä»‹</h1><p>JMeteræ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„å‹æµ‹å·¥å…·ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç›´æ¥åœ¨æœ¬åœ°å¯åŠ¨JMeterå¯¹æœ¬åœ°æˆ–è¿œç¨‹åº”ç”¨è¿›è¡Œç®€å•çš„å‹æµ‹ã€‚ä½†æ˜¯è¿™ç§å‹æµ‹åœºæ™¯ä¸‹å¾—å‡ºçš„å‹æµ‹ç»“æœå¹¶ä¸ä¸¥è°¨ï¼Œå—ä»¥ä¸‹ä¸¤æ–¹é¢å½±å“ï¼š</p>
<ul>
<li>æœ¬åœ°æœºå™¨ç¡¬ä»¶é…ç½®å·®ï¼Œå‹æµ‹ä¸­æœ¬æœºçš„æ€§èƒ½æœ€å…ˆè¾¾åˆ°ç“¶é¢ˆ</li>
<li>æœ¬åœ°æœºå™¨å’Œè¿œç¨‹æœåŠ¡ç«¯ç½‘ç»œå»¶æ—¶è¾ƒé«˜ï¼Œå¯¼è‡´å‹æµ‹æ€§èƒ½æ¯”é¢„æœŸå·®<br>æ‰€ä»¥æˆ‘ä»¬åšä¸€äº›ç®€å•çš„éªŒè¯å¯ä»¥åœ¨æœ¬åœ°ç›´æ¥å¯åŠ¨JMeterè¿›è¡Œå‹æµ‹ï¼Œä½†æ˜¯å¦‚æœè¦åšçœŸå®çš„æ€§èƒ½æµ‹è¯•ï¼Œéœ€è¦ä½¿ç”¨ä¸“ç”¨çš„å‹æµ‹æœåŠ¡å™¨å¯¹æœåŠ¡ç«¯åº”ç”¨è¿›è¡Œå‹æµ‹ã€‚è€Œå‹æµ‹æœåŠ¡å™¨ä¸€èˆ¬éƒ½æ˜¯Linuxç³»ç»Ÿï¼Œæ‰€ä»¥éœ€è¦åœ¨Linuxç³»ç»Ÿä¸Šä½¿ç”¨JMeterè¿›è¡Œæ“ä½œã€‚</li>
</ul>
<h1 id="JMeteré…ç½®"><a href="#JMeteré…ç½®" class="headerlink" title="JMeteré…ç½®"></a>JMeteré…ç½®</h1><h2 id="ä¸‹è½½JMeterå‹æµ‹å·¥å…·"><a href="#ä¸‹è½½JMeterå‹æµ‹å·¥å…·" class="headerlink" title="ä¸‹è½½JMeterå‹æµ‹å·¥å…·"></a>ä¸‹è½½JMeterå‹æµ‹å·¥å…·</h2><p>ç™»å½•Linuxå‹æµ‹æœåŠ¡å™¨ï¼Œä¸‹è½½JMeterå‹æµ‹å·¥å…·ï¼Œ<a href="https://jmeter.apache.org/download_jmeter.cgi">å®˜ç½‘ä¸‹è½½åœ°å€</a>ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">curl -O https:&#x2F;&#x2F;dlcdn.apache.org&#x2F;&#x2F;jmeter&#x2F;binaries&#x2F;apache-jmeter-5.6.2.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ³¨æ„ï¼šè¯·ç¡®ä¿å‹æµ‹æœåŠ¡å™¨å·²ç»å®‰è£…äº†JDK1.8</p>
<h2 id="è§£å‹å¹¶é…ç½®JMeter"><a href="#è§£å‹å¹¶é…ç½®JMeter" class="headerlink" title="è§£å‹å¹¶é…ç½®JMeter"></a>è§£å‹å¹¶é…ç½®JMeter</h2><blockquote>
<p>è¯´æ˜ï¼šé…ç½®JMeterç¯å¢ƒå˜é‡æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨ä»»æ„è·¯åŠ²ä¸‹ä½¿ç”¨<code>jmeter</code>å‘½ä»¤ï¼Œå¦‚æœä¸é…ç½®ç¯å¢ƒå˜é‡ï¼Œåˆ™ç›´æ¥è¿›å…¥JMeterè§£å‹ç›®å½•çš„binç›®å½•ä¸‹æ‰§è¡Œã€‚</p>
</blockquote>
<p>1.è§£å‹JMeter</p>
<pre class="line-numbers language-none"><code class="language-none">unzip apache-jmeter-5.6.2.zip
# ç§»åŠ¨åˆ°localç›®å½•
mv apache-jmeter-5.6.2 &#x2F;usr&#x2F;local&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2.é…ç½®JMeterç¯å¢ƒå˜é‡<br>åœ¨<code>/etc/profile</code>æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">export JMETER_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;apache-jmeter-5.6.2
export PATH&#x3D;$&#123;JMETER_HOME&#125;&#x2F;bin:$PATH<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä¿å­˜ä¿®æ”¹ï¼Œæ‰§è¡Œsource &#x2F;etc&#x2F;profileï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚<br>æœ€åï¼Œé€šè¿‡<code>jmeter --version</code>æŸ¥çœ‹å®‰è£…çš„JMeterç‰ˆæœ¬ï¼ŒéªŒè¯å®‰è£…æˆåŠŸã€‚</p>
<h1 id="å‹æµ‹æ­¥éª¤"><a href="#å‹æµ‹æ­¥éª¤" class="headerlink" title="å‹æµ‹æ­¥éª¤"></a>å‹æµ‹æ­¥éª¤</h1><h2 id="è®¾ç½®å‹æµ‹åœºæ™¯å’Œæ•°æ®"><a href="#è®¾ç½®å‹æµ‹åœºæ™¯å’Œæ•°æ®" class="headerlink" title="è®¾ç½®å‹æµ‹åœºæ™¯å’Œæ•°æ®"></a>è®¾ç½®å‹æµ‹åœºæ™¯å’Œæ•°æ®</h2><p>1.åœ¨windowsç³»ç»Ÿä¸­è®¾ç½®å¥½å‹æµ‹åœºæ™¯å’Œæ•°æ®ï¼Œä¿å­˜åˆ°jmxæ–‡ä»¶ä¸­ã€‚å¦‚: test.jmx</p>
<h2 id="ä¸Šä¼ JMeterå‹æµ‹è„šæœ¬"><a href="#ä¸Šä¼ JMeterå‹æµ‹è„šæœ¬" class="headerlink" title="ä¸Šä¼ JMeterå‹æµ‹è„šæœ¬"></a>ä¸Šä¼ JMeterå‹æµ‹è„šæœ¬</h2><p>å°†jmxå‹æµ‹è„šæœ¬ä¸Šä¼ è‡³LinuxæœåŠ¡å™¨ä»»æ„ç›®å½•ã€‚</p>
<h2 id="æ‰§è¡Œå‹æµ‹å‘½ä»¤"><a href="#æ‰§è¡Œå‹æµ‹å‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‹æµ‹å‘½ä»¤"></a>æ‰§è¡Œå‹æµ‹å‘½ä»¤</h2><pre class="line-numbers language-none"><code class="language-none">jmeter -n -t test.jmx -l result.jtl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‘½ä»¤è¡Œå‚æ•°ï¼š<a href="https://jmeter.apache.org/usermanual/get-started.html#non_gui">1.4.4 CLI Mode (Command Line mode was called NON GUI mode)</a></p>
<h3 id="CLI-Mode-Command-Line-mode-was-called-NON-GUI-mode"><a href="#CLI-Mode-Command-Line-mode-was-called-NON-GUI-mode" class="headerlink" title="CLI Mode(Command Line mode was called NON GUI mode)"></a>CLI Mode(Command Line mode was called NON GUI mode)</h3><p>For load testing, you must run JMeter in this mode (Without the GUI) to get the optimal results from it. To do so, use the following command options:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-n</span>  This specifies JMeter is to run <span class="token keyword">in</span> cli mode
<span class="token parameter variable">-t</span>  <span class="token punctuation">[</span>name of JMX <span class="token function">file</span> that contains the Test Plan<span class="token punctuation">]</span>.
<span class="token parameter variable">-l</span>  <span class="token punctuation">[</span>name of JTL <span class="token function">file</span> to log sample results to<span class="token punctuation">]</span>.
<span class="token parameter variable">-j</span>  <span class="token punctuation">[</span>name of JMeter run log file<span class="token punctuation">]</span>.
<span class="token parameter variable">-r</span>  the <span class="token builtin class-name">test</span> <span class="token keyword">in</span> the servers specified by the JMeter property <span class="token string">"remote_hosts"</span>
<span class="token parameter variable">-R</span>  <span class="token punctuation">[</span>list of remote servers<span class="token punctuation">]</span> Run the <span class="token builtin class-name">test</span> <span class="token keyword">in</span> the specified remote servers
<span class="token parameter variable">-g</span>  <span class="token punctuation">[</span>path to CSV file<span class="token punctuation">]</span> generate report dashboard only
<span class="token parameter variable">-e</span>  generate report dashboard after load <span class="token builtin class-name">test</span>
<span class="token parameter variable">-o</span>  output folder where to generate the report dashboard after load test. Folder must not exist or be empty
    The script also lets you specify the optional firewall/proxy server information:
<span class="token parameter variable">-H</span>  <span class="token punctuation">[</span>proxy server <span class="token function">hostname</span> or <span class="token function">ip</span> address<span class="token punctuation">]</span>
<span class="token parameter variable">-P</span>  <span class="token punctuation">[</span>proxy server port<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jmeter <span class="token parameter variable">-n</span> <span class="token parameter variable">-t</span> my_test.jmx <span class="token parameter variable">-l</span> log.jtl <span class="token parameter variable">-H</span> my.proxy.server <span class="token parameter variable">-P</span> <span class="token number">8000</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨è¿›è¡Œä¸¥è°¨çš„æ€§èƒ½å‹æµ‹æ—¶éœ€è¦ä½¿ç”¨JMeterçš„å‘½ä»¤è¡Œæ¨¡å¼è¿›è¡Œå‹æµ‹ï¼Œä¸”ä¸€èˆ¬å‹æµ‹åœ¨LinuxæœåŠ¡å™¨ä¸Šè¿›è¡Œï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>1.ä¸‹è½½JMeter</li>
<li>2.è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡</li>
<li>3.åœ¨Windowsä¸Šé…ç½®å¥½JMeterçš„æµ‹è¯•è®¡åˆ’å¹¶ä¿å­˜ä¸ºjmxæ–‡ä»¶</li>
<li>4.åœ¨å‹æµ‹æœåŠ¡å™¨ä¸Šé€šè¿‡å‘½ä»¤è¡Œæ¨¡å¼æ‰§è¡Œå‹æµ‹è®¡åˆ’</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>JMeter</tag>
        <tag>å‹æµ‹</tag>
      </tags>
  </entry>
  <entry>
    <title>SSHä½¿ç”¨X11è½¬å‘å¼•èµ·çš„å¼‚å¸¸</title>
    <url>/2022/07/13/java/ssh-shi-yong-x11-zhuan-fa-yin-qi-de-yi-chang/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>æµ‹è¯•åŒå­¦åœ¨æµ‹è¯•å¯¼å‡ºExcelåŠŸèƒ½æ—¶æŠ¥é”™ï¼Œå¼‚å¸¸æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">java.util.concurrent.ExecutionException: java.awt.AWTError: Can&#39;t connect to X11 window server using &#39;localhost:10.0&#39; as the value of the DISPLAY variable.
        at java.util.concurrent.FutureTask.report(FutureTask.java:122)
        at java.util.concurrent.FutureTask.get(FutureTask.java:192)
        at com.xuanwu.ds.service.impl.export.async.ExportWorker.run(ExportWorker.java:76)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:748)
Caused by: java.awt.AWTError: Can&#39;t connect to X11 window server using &#39;localhost:10.0&#39; as the value of the DISPLAY variable.
        at sun.awt.X11GraphicsEnvironment.initDisplay(Native Method)
        at sun.awt.X11GraphicsEnvironment.access$200(X11GraphicsEnvironment.java:65)
        at sun.awt.X11GraphicsEnvironment$1.run(X11GraphicsEnvironment.java:115)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.awt.X11GraphicsEnvironment.&lt;clinit&gt;(X11GraphicsEnvironment.java:74)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:264)
        at java.awt.GraphicsEnvironment.createGE(GraphicsEnvironment.java:103)
        at java.awt.GraphicsEnvironment.getLocalGraphicsEnvironment(GraphicsEnvironment.java:82)
        at sun.awt.X11FontManager.isHeadless(X11FontManager.java:509)
        at sun.awt.X11FontManager.getFileNameFromPlatformName(X11FontManager.java:189)
        at sun.font.SunFontManager.initCompositeFonts(SunFontManager.java:3481)
        at sun.font.SunFontManager.access$700(SunFontManager.java:65)
        at sun.font.SunFontManager$2.run(SunFontManager.java:545)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.font.SunFontManager.&lt;init&gt;(SunFontManager.java:376)
        at sun.awt.FcFontManager.&lt;init&gt;(FcFontManager.java:35)
        at sun.awt.X11FontManager.&lt;init&gt;(X11FontManager.java:57)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
        at java.lang.Class.newInstance(Class.java:442)
        at sun.font.FontManagerFactory$1.run(FontManagerFactory.java:83)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.font.FontManagerFactory.getInstance(FontManagerFactory.java:74)
        at java.awt.Font.getFont2D(Font.java:491)
        at java.awt.Font.canDisplayUpTo(Font.java:2060)
        at java.awt.font.TextLayout.singleFont(TextLayout.java:470)
        at java.awt.font.TextLayout.&lt;init&gt;(TextLayout.java:531)
        at org.apache.poi.ss.util.SheetUtil.getDefaultCharWidth(SheetUtil.java:275)
        at org.apache.poi.xssf.streaming.AutoSizeColumnTracker.&lt;init&gt;(AutoSizeColumnTracker.java:117)
        at org.apache.poi.xssf.streaming.SXSSFSheet.&lt;init&gt;(SXSSFSheet.java:82)
        at org.apache.poi.xssf.streaming.SXSSFWorkbook.createAndRegisterSXSSFSheet(SXSSFWorkbook.java:658)
        at org.apache.poi.xssf.streaming.SXSSFWorkbook.createSheet(SXSSFWorkbook.java:650)
        &#x2F;&#x2F; æ­¤å¤„çœç•¥éƒ¨åˆ†ä¸šåŠ¡å †æ ˆä¿¡æ¯
        ... 3 more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½†æ˜¯åœ¨å¼€å‘ç¯å¢ƒï¼ˆWindowsï¼‰ï¼Œè¯¥å¯¼å‡ºåŠŸèƒ½æ­£å¸¸ã€‚</p>
<h1 id="äºŒã€åŸå› åˆ†æ"><a href="#äºŒã€åŸå› åˆ†æ" class="headerlink" title="äºŒã€åŸå› åˆ†æ"></a>äºŒã€åŸå› åˆ†æ</h1><p>æ ¹æ®å¼‚å¸¸å †æ ˆä¿¡æ¯ï¼Œæ— æ³•è¿æ¥åˆ°X11 window serverã€‚</p>
<h2 id="2-1-X-Window-Systemç®€ä»‹"><a href="#2-1-X-Window-Systemç®€ä»‹" class="headerlink" title="2.1 X Window Systemç®€ä»‹"></a>2.1 X Window Systemç®€ä»‹</h2><blockquote>
<p>The X Window System (also known as X11, or just X) is a software package and network protocol that lets you interact locally, using your personal computerâ€™s display, mouse, and keyboard, with the graphical user interface (GUI) of an application running on a remote networked computer.</p>
</blockquote>
<p>X Window Systemï¼ˆä¹Ÿç§°ä¸º X11ï¼Œæˆ–ç®€ç§° Xï¼‰æ˜¯ä¸€ä¸ªè½¯ä»¶åŒ…å’Œç½‘ç»œåè®®ï¼Œå¯è®©æ‚¨ä½¿ç”¨ä¸ªäººè®¡ç®—æœºçš„æ˜¾ç¤ºå™¨ã€é¼ æ ‡å’Œé”®ç›˜è¿›è¡Œæœ¬åœ°äº¤äº’ï¼ŒåŒæ—¶è¿è¡Œåº”ç”¨ç¨‹åºçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ (GUI) åœ¨è¿œç¨‹è”ç½‘è®¡ç®—æœºä¸Šã€‚</p>
<blockquote>
<p>You can use X forwarding in an SSH session on your personal computer to securely run graphical applications (X clients) installed on the Indiana University research supercomputers.</p>
</blockquote>
<p>æ‚¨å¯ä»¥åœ¨ä¸ªäººè®¡ç®—æœºä¸Šçš„ SSH ä¼šè¯ä¸­ä½¿ç”¨ X (X Window System) è½¬å‘æ¥å®‰å…¨åœ°è¿è¡Œå®‰è£…åœ¨å°ç¬¬å®‰çº³å¤§å­¦ç ”ç©¶è¶…çº§è®¡ç®—æœºä¸Šçš„å›¾å½¢åº”ç”¨ç¨‹åºï¼ˆX å®¢æˆ·ç«¯ï¼‰ã€‚</p>
<blockquote>
<p>For X forwarding in SSH to work, your personal computer must be running an X server program. The X server program manages the interaction between the remote application (the X client) and your computerâ€™s hardware.</p>
</blockquote>
<p>è¦åœ¨ SSH ä¸­è¿›è¡Œ X è½¬å‘ï¼Œæ‚¨çš„ä¸ªäººè®¡ç®—æœºå¿…é¡»è¿è¡Œ X æœåŠ¡å™¨ç¨‹åºã€‚ X æœåŠ¡å™¨ç¨‹åºç®¡ç†è¿œç¨‹åº”ç”¨ç¨‹åºï¼ˆX å®¢æˆ·ç«¯ï¼‰å’Œè®¡ç®—æœºç¡¬ä»¶ä¹‹é—´çš„äº¤äº’</p>
<h2 id="2-2-SSHä½¿ç”¨Xè½¬å‘"><a href="#2-2-SSHä½¿ç”¨Xè½¬å‘" class="headerlink" title="2.2 SSHä½¿ç”¨Xè½¬å‘"></a>2.2 SSHä½¿ç”¨Xè½¬å‘</h2><p>SSHä½¿ç”¨Xè½¬å‘å‚ç…§ä¸€ä¸‹å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Linux: ssh -X username@hostname
macOS: ssh -Y username@hostname<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>SSHä½¿ç”¨Xè½¬å‘æ‰€éœ€è¦å…·å¤‡çš„ç¯å¢ƒè¯¦è§ï¼š<a href="https://kb.iu.edu/d/bdnt#interactive">Use X forwarding on a personal computer</a></p>
<h2 id="2-3-æ—¥å¿—åˆ†æ"><a href="#2-3-æ—¥å¿—åˆ†æ" class="headerlink" title="2.3 æ—¥å¿—åˆ†æ"></a>2.3 æ—¥å¿—åˆ†æ</h2><p>æ ¹æ®ä¸Šè¿°å¼‚å¸¸æ—¥å¿—ä¿¡æ¯ï¼Œæ¨æµ‹ç”±äºä½¿ç”¨SSHè¿æ¥åˆ°æœåŠ¡å™¨å¼€å¯äº†X11è½¬å‘ï¼ŒJavaåº”ç”¨ç¨‹åºä½œä¸ºX Clientè¿æ¥åˆ° X Serverï¼Œç›®å‰æŠ¥é”™åº”è¯¥æ˜¯SSHè¿æ¥æ–­å¼€åX11è¿æ¥å¤±è´¥å¯¼è‡´ã€‚<br>ä¸æµ‹è¯•åŒå­¦æ²Ÿé€šï¼Œå‘ç°ä½¿ç”¨Xshellå·¥å…·è¿æ¥åˆ°æœåŠ¡å™¨å¯åŠ¨çš„Javaè¿›ç¨‹ï¼Œç½‘ä¸Šä¹Ÿæœ‰æ–‡ç« æè¿°Xshellå­˜åœ¨è¯¥é—®é¢˜ï¼Œæ‰€ä»¥åˆ¤æ–­æ˜¯ä½¿ç”¨Xshelå¯åŠ¨Javaè¿›ç¨‹åXShellæ–­å¼€è¿æ¥å¯¼è‡´å‡ºç°äº†è¯¥é—®é¢˜ã€‚</p>
<h2 id="2-4-å¤ç°å¼‚å¸¸"><a href="#2-4-å¤ç°å¼‚å¸¸" class="headerlink" title="2.4 å¤ç°å¼‚å¸¸"></a>2.4 å¤ç°å¼‚å¸¸</h2><p>ä½¿ç”¨Xshellè¿æ¥åˆ°æœåŠ¡å™¨åå¯åŠ¨Javaè¿›ç¨‹åï¼Œå…³é—­Xshellä¸­çš„SSHè¿æ¥ï¼Œè¿›è¡Œå¯¼å‡ºæ“ä½œï¼Œé”™è¯¯å¤ç°ã€‚</p>
<p>æŸ¥çœ‹Xshellä¸­SSHè¿æ¥çš„é…ç½®ï¼Œé»˜è®¤å¼€å¯äº†X11è½¬å‘,é…ç½®å¦‚ä¸‹ï¼š<br><img src="/2022/07/13/java/ssh-shi-yong-x11-zhuan-fa-yin-qi-de-yi-chang/xshell-config.png" alt="Xshell-config"></p>
<h1 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h1><p>(1) å¦‚æœä½¿ç”¨XShellï¼Œåˆ™å…³é—­X11è½¬å‘<br>(2) è®¾ç½®JVMå‚æ•°ï¼Œä¸å»æ£€æŸ¥å›¾å½¢ç•Œé¢</p>
<pre class="line-numbers language-none"><code class="language-none">-Djava.awt.headless&#x3D;true 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h1><p>ç”±äºXShellå·¥å…·ä¸­çš„SSHè¿æ¥é»˜è®¤å¼€å¯X11è½¬å‘ï¼ŒJavaè¿›ç¨‹å¯åŠ¨åï¼Œå…³é—­äº†SSHè¿æ¥ï¼ŒX11è¿æ¥å¤±è´¥ä»è€Œå‡ºç°ä¸Šè¿°é—®é¢˜ã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>ä½¿ç”¨XShellæ—¶å…³é—­X11è½¬å‘</li>
<li>JVMå¯åŠ¨å‚æ•°é…ç½®ï¼š<code>-Djava.awt.headless=true </code></li>
<li>ä½¿ç”¨XShellå¼€å¯äº†X11è½¬å‘ï¼Œè¯·ä¿æŒSSHè¿æ¥ä¸è¦æ–­å¼€</li>
</ul>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://wizardforcel.gitbooks.io/vbird-linux-basic-4e/content/202.html">ä»€ä¹ˆæ˜¯ X Window System</a></p>
<p><a href="https://blog.csdn.net/top_explore/article/details/106566455">xshell æ‰§è¡Œé¡¹ç›®æŠ¥é”™ X11 window server</a></p>
<p><a href="https://kb.iu.edu/d/bdnt#interactive">Use X forwarding on a personal computer</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>SSH</tag>
        <tag>X11</tag>
        <tag>XShell</tag>
      </tags>
  </entry>
  <entry>
    <title>Springç±»åŠ è½½é¡ºåºå¼‚å¸¸Bugæ’æŸ¥</title>
    <url>/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>é¡¹ç›®ä»£ç é€šè¿‡Jenkinsè‡ªåŠ¨æ‰“åŒ…æ„å»ºï¼Œè‡ªåŠ¨åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æ—¶å‡ºç°æŠ¥é”™ï¼Œä½†æ˜¯è¯¥é¡¹ç›®åœ¨æœ¬åœ°IDEAä¸­èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ã€‚æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span>BeanCreationException</span><span class="token operator">:</span> <span class="token class-name">Error</span> creating bean <span class="token keyword">with</span> <span class="token namespace">name</span> 'nMetaWebServiceImpl'<span class="token operator">:</span> <span class="token class-name">Invocation</span> of init method failed<span class="token punctuation">;</span> nested exception is <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>InitDestroyAnnotationBeanPostProcessor</span><span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">InitDestroyAnnotationBeanPostProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">136</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">applyBeanPostProcessorsBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">408</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">initializeBean</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1570</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">doCreateBean</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">545</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span><span class="token function">createBean</span><span class="token punctuation">(</span><span class="token class-name">AbstractAutowireCapableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">482</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractBeanFactory</span>$<span class="token number">1.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">306</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span><span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token class-name">DefaultSingletonBeanRegistry</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">230</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractBeanFactory</span><span class="token punctuation">.</span><span class="token function">doGetBean</span><span class="token punctuation">(</span><span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">302</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractBeanFactory</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">AbstractBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">197</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>DefaultListableBeanFactory</span><span class="token punctuation">.</span><span class="token function">preInstantiateSingletons</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">772</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractApplicationContext</span><span class="token punctuation">.</span><span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span><span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">839</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>AbstractApplicationContext</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">538</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>ClassPathXmlApplicationContext</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">139</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>ClassPathXmlApplicationContext</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
    at <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span>RestServer<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">RestServer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
    at <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>NMetaWebServiceImpl<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">NMetaWebServiceImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">NativeMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>InitDestroyAnnotationBeanPostProcessor</span>$<span class="token class-name">LifecycleElement</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">InitDestroyAnnotationBeanPostProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">354</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>InitDestroyAnnotationBeanPostProcessor</span>$<span class="token class-name">LifecycleMetadata</span><span class="token punctuation">.</span><span class="token function">invokeInitMethods</span><span class="token punctuation">(</span><span class="token class-name">InitDestroyAnnotationBeanPostProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">305</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>InitDestroyAnnotationBeanPostProcessor</span><span class="token punctuation">.</span><span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">InitDestroyAnnotationBeanPostProcessor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">133</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">14</span> more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="1-1-æŠ¥é”™ä»£ç æ’æŸ¥"><a href="#1-1-æŠ¥é”™ä»£ç æ’æŸ¥" class="headerlink" title="1.1 æŠ¥é”™ä»£ç æ’æŸ¥"></a>1.1 æŠ¥é”™ä»£ç æ’æŸ¥</h2><p>æ ¹æ®ä¸Šè¿°æŠ¥é”™å †æ ˆä¿¡æ¯ï¼Œæ‰¾åˆ°é¡¹ç›®æŠ¥é”™çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-7_1-14-2.png" alt="æŠ¥é”™æºç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-7_1-13-14.png" alt="æŠ¥é”™æºç 2"></p>
<h1 id="äºŒã€é—®é¢˜æ’æŸ¥"><a href="#äºŒã€é—®é¢˜æ’æŸ¥" class="headerlink" title="äºŒã€é—®é¢˜æ’æŸ¥"></a>äºŒã€é—®é¢˜æ’æŸ¥</h1><p>ç”±äºè¯¥é”™è¯¯åœ¨ä¸åŒç¯å¢ƒä¸‹å‡ºç°ï¼Œä¸”ä¸ºå¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥å¼€å¯è¿œç¨‹Debugå®šä½é—®é¢˜åŸå› ã€‚</p>
<h2 id="2-1-å¼€å¯è¿œç¨‹Debug"><a href="#2-1-å¼€å¯è¿œç¨‹Debug" class="headerlink" title="2.1 å¼€å¯è¿œç¨‹Debug"></a>2.1 å¼€å¯è¿œç¨‹Debug</h2><p>åœ¨æœ¬åœ°IDEAä¸­å¼€å¯è¿œç¨‹Debugè¿›è¡Œé—®é¢˜æ’æŸ¥ã€‚</p>
<h3 id="2-1-1-æœåŠ¡ç«¯é…ç½®"><a href="#2-1-1-æœåŠ¡ç«¯é…ç½®" class="headerlink" title="2.1.1 æœåŠ¡ç«¯é…ç½®"></a>2.1.1 æœåŠ¡ç«¯é…ç½®</h3><p>æœåŠ¡ç«¯çš„å¯åŠ¨è„šæœ¬æ·»åŠ å¦‚ä¸‹é…å¯åŠ¨å‚æ•°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span>agentlib<span class="token operator">:</span>jdwp<span class="token operator">=</span>transport<span class="token operator">=</span>dt_socket<span class="token punctuation">,</span>server<span class="token operator">=</span>y<span class="token punctuation">,</span>suspend<span class="token operator">=</span>n<span class="token punctuation">,</span>address<span class="token operator">=</span><span class="token number">5005</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-9_15-13-48.png" alt="è¿œç¨‹Debugå‚æ•°"></p>
<h3 id="2-1-2-æœ¬åœ°é…ç½®"><a href="#2-1-2-æœ¬åœ°é…ç½®" class="headerlink" title="2.1.2 æœ¬åœ°é…ç½®"></a>2.1.2 æœ¬åœ°é…ç½®</h3><p>IDEAä¸­åˆ›å»ºä¸€ä¸ªRemote JVM Debugï¼š<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-9_15-14-38.png" alt="è¿œç¨‹Debugæœ¬åœ°é…ç½®"></p>
<h2 id="2-2-è¿œç¨‹Debugæ’æŸ¥é—®é¢˜"><a href="#2-2-è¿œç¨‹Debugæ’æŸ¥é—®é¢˜" class="headerlink" title="2.2 è¿œç¨‹Debugæ’æŸ¥é—®é¢˜"></a>2.2 è¿œç¨‹Debugæ’æŸ¥é—®é¢˜</h2><p>é€šè¿‡DebugæŸ¥çœ‹ç±»çš„åˆå§‹åŒ–é¡ºåºï¼Œéƒ¨åˆ†æˆªå›¾å¦‚ä¸‹ï¼š<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-9-26_19-23-42.png" alt="è¿œç¨‹Debugä»£ç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-9-28_11-10-33.png" alt="è¿œç¨‹Debugä»£ç 2"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-9-28_11-19-29.png" alt="è¿œç¨‹Debugä»£ç 3"></p>
<h2 id="2-3-æ’æŸ¥ç»“è®º"><a href="#2-3-æ’æŸ¥ç»“è®º" class="headerlink" title="2.3 æ’æŸ¥ç»“è®º"></a>2.3 æ’æŸ¥ç»“è®º</h2><p><strong>æµ‹è¯•ç¯å¢ƒNMetaWebServiceImplæ‰«æé¡ºåºåœ¨ApplicationContextKeeperå‰é¢ï¼ŒSpringæ ¹æ®Beançš„æ‰«æé¡ºåºè¿›è¡Œç±»çš„åˆå§‹åŒ–ï¼Œç”±äºNMetaWebServiceImplæ‰«æé¡ºåºåœ¨ApplicationContextKeeperå‰é¢ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–NMetaWebServiceImplçš„è¿‡ç¨‹ä¸­ç”±äºApplicationContextKeeperè¿˜æœªåˆå§‹åŒ–ï¼Œå¯¼è‡´ç©ºæŒ‡é’ˆé—®é¢˜ã€‚</strong></p>
<h1 id="ä¸‰ã€æœ¬åœ°é—®é¢˜å¤ç°"><a href="#ä¸‰ã€æœ¬åœ°é—®é¢˜å¤ç°" class="headerlink" title="ä¸‰ã€æœ¬åœ°é—®é¢˜å¤ç°"></a>ä¸‰ã€æœ¬åœ°é—®é¢˜å¤ç°</h1><p>ä¸Šè¿°é—®é¢˜ä»…åœ¨é€šè¿‡Jenkinsæ„å»ºçš„åŒ…å¯åŠ¨å‡ºç°é—®é¢˜ï¼Œæœ¬åœ°æ‰‹åŠ¨æ„å»ºçš„åŒ…å¹¶æ— æ­¤é—®é¢˜ï¼Œé€šè¿‡Debugæ’æŸ¥æœ¬åœ°ç¨‹åºç±»çš„åˆå§‹åŒ–æƒ…å†µã€‚<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-9-26_19-29-20.png" alt="æœ¬åœ°Debugä»£ç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-9-28_11-5-55.png" alt="æœ¬åœ°Debugä»£ç 2"></p>
<h2 id="3-1-æ’æŸ¥ç»“è®º"><a href="#3-1-æ’æŸ¥ç»“è®º" class="headerlink" title="3.1 æ’æŸ¥ç»“è®º"></a>3.1 æ’æŸ¥ç»“è®º</h2><p>åœ¨æœ¬åœ°IDEAä¸­ApplicationContextKeeperæ‰«æé¡ºåºåœ¨NMetaWebServiceImplå‰é¢ï¼Œæ‰€ä»¥ç¨‹åºå¯åŠ¨æ˜¯æ­£å¸¸çš„ã€‚</p>
<h1 id="å››ã€Springç±»åŠ è½½é¡ºåºåˆ†æ"><a href="#å››ã€Springç±»åŠ è½½é¡ºåºåˆ†æ" class="headerlink" title="å››ã€Springç±»åŠ è½½é¡ºåºåˆ†æ"></a>å››ã€Springç±»åŠ è½½é¡ºåºåˆ†æ</h1><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://caotc.org/2019/08/20/java-springboot-bean-override/">springboot beanåŠ è½½é¡ºåºé—®é¢˜</a></p>
<h2 id="4-1-Debugè¿½è¸ªSpringç±»åŠ è½½é¡ºåº"><a href="#4-1-Debugè¿½è¸ªSpringç±»åŠ è½½é¡ºåº" class="headerlink" title="4.1 Debugè¿½è¸ªSpringç±»åŠ è½½é¡ºåº"></a>4.1 Debugè¿½è¸ªSpringç±»åŠ è½½é¡ºåº</h2><p>é€šè¿‡Debugç»§ç»­è¿½è¸ªç±»ä»jaråŒ…çš„åŠ è½½é¡ºåº<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_9-44-28.png" alt="SpringåŠ è½½ç±»æºç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_9-46-22.png" alt="SpringåŠ è½½ç±»æºç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_12-43-50.png" alt="SpringåŠ è½½ç±»æºç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_17-22-18.png" alt="SpringåŠ è½½ç±»æºç 1"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_17-23-26.png" alt="SpringåŠ è½½ç±»æºç 1"><br>JaråŒ…ä¸­ç±»çš„åŠ è½½æ˜¯ä¸€ä¸ªNativeæ–¹æ³•ï¼Œéœ€è¦çœ‹çœ‹Nativeæ–¹æ³•çš„classè¯»å–é¡ºåºã€‚</p>
<h2 id="4-2-Java-Nativeæ–¹æ³•æºç åˆ†æ"><a href="#4-2-Java-Nativeæ–¹æ³•æºç åˆ†æ" class="headerlink" title="4.2 Java Nativeæ–¹æ³•æºç åˆ†æ"></a>4.2 Java Nativeæ–¹æ³•æºç åˆ†æ</h2><p>è¿™é‡Œä¸»è¦æ¶‰åŠä¸¤ä¸ªCæ–‡ä»¶ï¼š<code>ZipFile.c</code> å’Œ <code>zip_util.c</code>ã€‚</p>
<h3 id="ZipFile-c"><a href="#ZipFile-c" class="headerlink" title="ZipFile.c"></a>ZipFile.c</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">JNIEXPORT jlong JNICALL
Java_java_util_zip_ZipFile_getNextEntry(JNIEnv *env, jclass cls, jlong zfile,
                                        jint n)
&#123;
    jzentry *ze &#x3D; ZIP_GetNextEntry(jlong_to_ptr(zfile), n);
    return ptr_to_jlong(ze);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="zip-util-c"><a href="#zip-util-c" class="headerlink" title="zip_util.c"></a>zip_util.c</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">&#x2F;*
 * Returns the n&#39;th (starting at zero) zip file entry, or NULL if the
 * specified index was out of range.
 *&#x2F;
jzentry * JNICALL
ZIP_GetNextEntry(jzfile *zip, jint n)
&#123;
    jzentry *result;
    if (n &lt; 0 || n &gt;&#x3D; zip-&gt;total) &#123;
        return 0;
    &#125;
    ZIP_Lock(zip);
    result &#x3D; newEntry(zip, &amp;zip-&gt;entries[n], ACCESS_SEQUENTIAL);
    ZIP_Unlock(zip);
    return result;
&#125;
 
&#x2F;*
 * Descriptor for a ZIP file.
 *&#x2F;
typedef struct jzfile &#123;   &#x2F;* Zip file *&#x2F;
    char *name;           &#x2F;* zip file name *&#x2F;
    jint refs;            &#x2F;* number of active references *&#x2F;
    jlong len;            &#x2F;* length (in bytes) of zip file *&#x2F;
#ifdef USE_MMAP
    unsigned char *maddr; &#x2F;* beginning address of the CEN &amp; ENDHDR *&#x2F;
    jlong mlen;           &#x2F;* length (in bytes) mmaped *&#x2F;
    jlong offset;         &#x2F;* offset of the mmapped region from the
                             start of the file. *&#x2F;
    jboolean usemmap;     &#x2F;* if mmap is used. *&#x2F;
#endif
    jboolean locsig;      &#x2F;* if zip file starts with LOCSIG *&#x2F;
    cencache cencache;    &#x2F;* CEN header cache *&#x2F;
    ZFILE zfd;            &#x2F;* open file descriptor *&#x2F;
    void *lock;           &#x2F;* read lock *&#x2F;
    char *comment;        &#x2F;* zip file comment *&#x2F;
    jint clen;            &#x2F;* length of the zip file comment *&#x2F;
    char *msg;            &#x2F;* zip error message *&#x2F;
    jzcell *entries;      &#x2F;* array of hash cells *&#x2F;
    jint total;           &#x2F;* total number of entries *&#x2F;
    jint *table;          &#x2F;* Hash chain heads: indexes into entries *&#x2F;
    jint tablelen;        &#x2F;* number of hash heads *&#x2F;
    struct jzfile *next;  &#x2F;* next zip file in search list *&#x2F;
    jzentry *cache;       &#x2F;* we cache the most recently freed jzentry *&#x2F;
    &#x2F;* Information on metadata names in META-INF directory *&#x2F;
    char **metanames;     &#x2F;* array of meta names (may have null names) *&#x2F;
    jint metacurrent;     &#x2F;* the next empty slot in metanames array *&#x2F;
    jint metacount;       &#x2F;* number of slots in metanames array *&#x2F;
    jint manifestNum;     &#x2F;* number of META-INF&#x2F;MANIFEST.MF, case insensitive *&#x2F;
    jlong lastModified;   &#x2F;* last modified time *&#x2F;
    jlong locpos;         &#x2F;* position of first LOC header (usually 0) *&#x2F;
&#125; jzfile;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-åˆ†æç»“æœ"><a href="#4-3-åˆ†æç»“æœ" class="headerlink" title="4.3 åˆ†æç»“æœ"></a>4.3 åˆ†æç»“æœ</h2><p>é€šè¿‡ä¸Šè¿°Nativeæ–¹æ³•çš„æºç åˆ†æï¼Œå¯ä»¥çœ‹åˆ°classæ–‡ä»¶çš„é¡ºåºä¾èµ–äºjzcell *entriesè¿™ä¸ªæ•°æ®ç»“æ„ï¼ŒçŒœæƒ³åˆ°è¿™ä¸ªæ•°æ®ç»“æ„ä¸ºJaråŒ…æ„å»ºæ—¶ç±»æ–‡ä»¶çš„æ·»åŠ é¡ºåºã€‚</p>
<h1 id="äº”ã€JaråŒ…Classæ–‡ä»¶é¡ºåºåˆ†æ"><a href="#äº”ã€JaråŒ…Classæ–‡ä»¶é¡ºåºåˆ†æ" class="headerlink" title="äº”ã€JaråŒ…Classæ–‡ä»¶é¡ºåºåˆ†æ"></a>äº”ã€JaråŒ…Classæ–‡ä»¶é¡ºåºåˆ†æ</h1><p>æŸ¥çœ‹æµ‹è¯•ç¯å¢ƒä¸æœ¬åœ°ç¯å¢ƒçš„JaråŒ…ä¸­Classçš„é¡ºåºã€‚</p>
<h2 id="5-1-æµ‹è¯•ç¯å¢ƒ"><a href="#5-1-æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="5.1 æµ‹è¯•ç¯å¢ƒ"></a>5.1 æµ‹è¯•ç¯å¢ƒ</h2><p><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_17-33-8.png" alt="æµ‹è¯•ç¯å¢ƒ"></p>
<h2 id="5-2-æœ¬åœ°ç¯å¢ƒ"><a href="#5-2-æœ¬åœ°ç¯å¢ƒ" class="headerlink" title="5.2 æœ¬åœ°ç¯å¢ƒ"></a>5.2 æœ¬åœ°ç¯å¢ƒ</h2><p><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_17-34-24.png" alt="æœ¬åœ°ç¯å¢ƒ"><br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_17-34-50.png" alt="æœ¬åœ°ç¯å¢ƒ"></p>
<h2 id="5-3-ç»“æœåˆ†æ"><a href="#5-3-ç»“æœåˆ†æ" class="headerlink" title="5.3 ç»“æœåˆ†æ"></a>5.3 ç»“æœåˆ†æ</h2><p>ä¸åŒç¯å¢ƒä¸­çš„JaråŒ…å…¶ä¸­ç±»çš„æ·»åŠ é¡ºåºä¸ä¸€è‡´ï¼Œè€ŒSpringæ ¹æ®JaråŒ…ä¸­çš„ç±»çš„é¡ºåºè¿›è¡Œç±»çš„åˆå§‹åŒ–ï¼Œå¯¼è‡´æµ‹è¯•ç¯å¢ƒå¯åŠ¨æŠ¥é”™ã€‚</p>
<h1 id="å…­ã€JaråŒ…æ‰“åŒ…Classé¡ºåºéªŒè¯"><a href="#å…­ã€JaråŒ…æ‰“åŒ…Classé¡ºåºéªŒè¯" class="headerlink" title="å…­ã€JaråŒ…æ‰“åŒ…Classé¡ºåºéªŒè¯"></a>å…­ã€JaråŒ…æ‰“åŒ…Classé¡ºåºéªŒè¯</h1><p>æ ¹æ®ä¸Šè¿°æ’æŸ¥ç»“æœï¼Œæˆ‘ä»¬çŸ¥é“æ˜¯ç”±äºåœ¨ä¸åŒç¯å¢ƒä¸‹é¡¹ç›®ä¸­æ‰“åŒ…çš„JaråŒ…ä¸­Classé¡ºåºä¸ä¸€è‡´å¼•èµ·çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä¸åŒç¯å¢ƒä¸‹æ‰“åŒ…ï¼ŒClassçš„é¡ºåºä¼šä¸åŒã€‚</p>
<h2 id="6-1-æ‰‹åŠ¨æ‰“åŒ…éªŒè¯"><a href="#6-1-æ‰‹åŠ¨æ‰“åŒ…éªŒè¯" class="headerlink" title="6.1 æ‰‹åŠ¨æ‰“åŒ…éªŒè¯"></a>6.1 æ‰‹åŠ¨æ‰“åŒ…éªŒè¯</h2><p>æˆ‘ä»¬çŸ¥é“JaråŒ…çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæ‰€ä»¥é¦–å…ˆéªŒè¯æ‰‹åŠ¨æ„å»ºå‹ç¼©åŒ…æ—¶æ–‡ä»¶çš„é¡ºåºã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">tar -zcvf mtr-rest.jar .&#x2F;

zip -r mtr.rest.jar .&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨tar å‘½ä»¤æˆ–zipå‘½ä»¤æ‰‹åŠ¨åˆ¶ä½œå‹ç¼©åŒ…,æ–‡ä»¶æŒ‰ç…§é¦–å­—æ¯é¡ºåºæ’åºã€‚æ‰€ä»¥Mavenæ„å»ºJaråŒ…çš„æ–¹å¼ä¸ä¸Šè¿°ä¸¤ä¸ªå‘½ä»¤ä¸åŒã€‚</p>
<h2 id="6-2-æµ‹è¯•ç¯å¢ƒéªŒè¯"><a href="#6-2-æµ‹è¯•ç¯å¢ƒéªŒè¯" class="headerlink" title="6.2 æµ‹è¯•ç¯å¢ƒéªŒè¯"></a>6.2 æµ‹è¯•ç¯å¢ƒéªŒè¯</h2><p>åœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Šæ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†é¡¹ç›®å…‹éš†ä¸‹æ¥è¿›è¡Œæ‰“åŒ…ã€‚<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-8_18-13-0.png" alt="æµ‹è¯•ç¯å¢ƒMavenæ‰“åŒ…"></p>
<p>ç»è¿‡éªŒè¯ç±»çš„æ·»åŠ é¡ºåºæ˜¯æ­£å¸¸çš„ï¼Œå³åœ¨ç›¸åŒçš„æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨æ‰§è¡ŒMavenæ‰“åŒ…å‘½ä»¤å’ŒJenkinsæ‰§è¡ŒMavenæ‰“åŒ…å‘½ä»¤æ‰€æ„å»ºçš„JaråŒ…ä¸­Classçš„é¡ºåºä¸ä¸€è‡´ã€‚</p>
<p>åœ¨Jenkinså·¥ä½œè·¯å¾„ä¸‹æ‰‹åŠ¨æ‰“åŒ…,é—®é¢˜å¤ç°ã€‚<br><img src="/2023/10/10/java/spring-lei-jia-zai-shun-xu-yi-chang-bug-pai-cha/image2023-10-9_14-46-6.png" alt="æµ‹è¯•ç¯å¢ƒMavenæ‰“åŒ…"></p>
<h2 id="6-3-é—®é¢˜åˆ†æ"><a href="#6-3-é—®é¢˜åˆ†æ" class="headerlink" title="6.3 é—®é¢˜åˆ†æ"></a>6.3 é—®é¢˜åˆ†æ</h2><p>ç»è¿‡ä¸Šè¿°éªŒè¯ï¼Œå‘ç°åœ¨æœåŠ¡å™¨çš„ä¸åŒè·¯å¾„ä¸‹è¿›è¡Œæ‰“åŒ…ï¼ŒJaråŒ…ä¸­çš„Classçš„æ·»åŠ é¡ºåºä¸ä¸€è‡´ã€‚</p>
<h1 id="ä¸ƒã€æ’æŸ¥ç»“è®º"><a href="#ä¸ƒã€æ’æŸ¥ç»“è®º" class="headerlink" title="ä¸ƒã€æ’æŸ¥ç»“è®º"></a>ä¸ƒã€æ’æŸ¥ç»“è®º</h1><p><strong>1.Mavené»˜è®¤ä½¿ç”¨ä¸ç¨³å®šçš„æ–‡ä»¶ç³»ç»Ÿéå†æ¥æ”¶é›†å¹¶æ„å»ºé¡¹ç›®çš„ç±»ã€‚è¿™å¯èƒ½å¯¼è‡´åœ¨ä¸åŒæ“ä½œç³»ç»Ÿã€ä¸åŒç¯å¢ƒæˆ–ä¸åŒæ„å»ºå‘½ä»¤ä¸‹ï¼Œç±»çš„é¡ºåºå‡ºç°å˜åŒ–ã€‚</strong></p>
<p><strong>2.ä»ä¸Šè¿°çš„éªŒè¯ç»“æœæ¥çœ‹ï¼Œé¡¹ç›®çš„çˆ¶è·¯å¾„å°†ä¼šå½±å“Mavenæ‰“åŒ…ç±»çš„æ·»åŠ é¡ºåºã€‚</strong></p>
<p><strong>3.æ­¤å¤–ç±»çš„ä¾èµ–é¡ºåºåº”è¯¥é€šè¿‡åº”ç”¨å±‚é¢å»ä¿è¯ï¼Œè€Œä¸åº”è¯¥ä¾èµ–äºjarä¸­ç±»çš„ç‰©ç†è·¯å¾„ã€‚</strong></p>
<h1 id="å…«ã€è§£å†³æ–¹æ¡ˆ"><a href="#å…«ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…«ã€è§£å†³æ–¹æ¡ˆ"></a>å…«ã€è§£å†³æ–¹æ¡ˆ</h1><p>ä¸Šè¿°é—®é¢˜ä¸»è¦æ˜¯ç”±äºä¸¤ä¸ªç±»ä¹‹é—´æ²¡æœ‰æ„å»ºä¾èµ–å…³ç³»ï¼Œæ­£å¸¸å½“æŒ‰ç…§æ–‡ä»¶æ’åºçš„æ–¹å¼å®ä¾‹åŒ–ä¸¤ä¸ªç±»æ—¶ï¼Œç¨‹åºæ­£å¸¸è¿è¡Œï¼›ä½†æ˜¯å½“æ‰“åŒ…æ—¶ï¼Œä¸¤ä¸ªç±»æ·»åŠ åˆ°JaråŒ…çš„ç‰©ç†é¡ºåºå‡ºç°å˜åŒ–ï¼Œåˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚</p>
<h2 id="8-1-æ˜¾ç¤ºæ·»åŠ ä¾èµ–å…³ç³»"><a href="#8-1-æ˜¾ç¤ºæ·»åŠ ä¾èµ–å…³ç³»" class="headerlink" title="8.1 æ˜¾ç¤ºæ·»åŠ ä¾èµ–å…³ç³»"></a>8.1 æ˜¾ç¤ºæ·»åŠ ä¾èµ–å…³ç³»</h2><p>åœ¨NMetaWebServiceImplç±»ä¸Šä½¿ç”¨@DependsOnæ³¨è§£ï¼Œè®©ApplicationContextKeeperå…ˆäºNMetaWebServiceImplåˆå§‹åŒ–ã€‚</p>
<h2 id="8-2-éšå¼æ„å»ºä¾èµ–å…³ç³»"><a href="#8-2-éšå¼æ„å»ºä¾èµ–å…³ç³»" class="headerlink" title="8.2 éšå¼æ„å»ºä¾èµ–å…³ç³»"></a>8.2 éšå¼æ„å»ºä¾èµ–å…³ç³»</h2><p>å°†ApplicationContextKeeperå®ä¾‹æ³¨å…¥åˆ°NMetaWebServiceImplï¼Œéšå¼æ„å»ºç±»çš„ä¾èµ–å…³ç³»ã€‚</p>
<h2 id="8-3-ä¼˜å…ˆåˆå§‹åŒ–"><a href="#8-3-ä¼˜å…ˆåˆå§‹åŒ–" class="headerlink" title="8.3 ä¼˜å…ˆåˆå§‹åŒ–"></a>8.3 ä¼˜å…ˆåˆå§‹åŒ–</h2><p>ç”±äºNMetaWebServiceImplæ˜¯ä¸€ä¸ªwebserviceåº”ç”¨ï¼Œå®ä¾‹å¯¹è±¡æ²¡æœ‰åœ¨springä¸­ï¼Œè€Œæ˜¯é€šè¿‡ç±»çš„é™æ€æˆå‘˜å˜é‡è¿›è¡Œä¼ é€’æ•°æ®ï¼Œæ— æ³•ç›´æ¥æ„å»ºä¾èµ–ç®¡ç†ï¼Œæ‰€ä»¥åœ¨springä¸­ä¼˜å…ˆå®ä¾‹åŒ–ApplicationContextKeeperã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>ç±»åŠ è½½</tag>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£ç Reviewè§„èŒƒæŒ‡å—åŠå®è·µæ¡ˆä¾‹</title>
    <url>/2023/04/24/java/dai-ma-review-gui-fan-zhi-nan-ji-shi-jian-an-li/</url>
    <content><![CDATA[<p>åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­å‘ç°å¾ˆå¤šä»£ç çš„åå‘³é“ï¼Œé’ˆå¯¹å‘ç°çš„é—®é¢˜è¿›è¡Œåˆ†æå’Œè§£ç­”ã€‚æœ¬æ–‡å°†ä»å¼‚å¸¸å¤„ç†ã€æ—¥å¿—æ‰“å°ã€é¡¹ç›®åˆ†å±‚ã€åŒ…ç»“æ„åˆ’åˆ†ã€DTOä½¿ç”¨ã€é¢å‘æ¥å£ç¼–ç¨‹ã€å•å…ƒæµ‹è¯•ç­‰å¤šä¸ªç»´åº¦ï¼Œæä¾›Code Reviewçš„è§„èŒƒæŒ‡å—å’Œå®è·µæ¡ˆä¾‹ã€‚</p>
<span id="more"></span>

<h1 id="ä¸€ã€å¼‚å¸¸å¤„ç†"><a href="#ä¸€ã€å¼‚å¸¸å¤„ç†" class="headerlink" title="ä¸€ã€å¼‚å¸¸å¤„ç†"></a>ä¸€ã€å¼‚å¸¸å¤„ç†</h1><h2 id="1-1-æ ¸å¿ƒé—®é¢˜"><a href="#1-1-æ ¸å¿ƒé—®é¢˜" class="headerlink" title="1.1 æ ¸å¿ƒé—®é¢˜"></a>1.1 æ ¸å¿ƒé—®é¢˜</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é¢ä¸´ä»¥ä¸‹å¼‚å¸¸å¤„ç†é—®é¢˜ï¼š</p>
<ul>
<li>å¼‚å¸¸è¦æŠ›å‡ºå»è¿˜æ˜¯catchå¤„ç†ï¼Ÿ</li>
<li>å†™ä»£ç çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰ä¸»åŠ¨æŠ›å‡ºè¿‡å¼‚å¸¸ï¼Ÿ  </li>
<li>è¦æŠ›å‡ºä»€ä¹ˆç±»å‹çš„å¼‚å¸¸ï¼ŒExceptionã€Throwableæˆ–å…¶å®ƒï¼Ÿ</li>
</ul>
<h2 id="1-2-å¼‚å¸¸å¤„ç†å‡†åˆ™"><a href="#1-2-å¼‚å¸¸å¤„ç†å‡†åˆ™" class="headerlink" title="1.2 å¼‚å¸¸å¤„ç†å‡†åˆ™"></a>1.2 å¼‚å¸¸å¤„ç†å‡†åˆ™</h2><div class="note primary no-icon flat"><p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šYou should catch the exception when you are in the method that knows what to do</p>
</div>

<h3 id="ï¼ˆ1ï¼‰ä½å±‚çº§å¼‚å¸¸å¤„ç†"><a href="#ï¼ˆ1ï¼‰ä½å±‚çº§å¼‚å¸¸å¤„ç†" class="headerlink" title="ï¼ˆ1ï¼‰ä½å±‚çº§å¼‚å¸¸å¤„ç†"></a>ï¼ˆ1ï¼‰ä½å±‚çº§å¼‚å¸¸å¤„ç†</h3><p><strong>ä»€ä¹ˆæ˜¯ä½å±‚çº§ï¼Ÿ</strong><br>è¿™æ˜¯ä¸ç¬¬ä¸‰æ–¹ä»£ç é›†æˆçš„çº§åˆ«ï¼Œä¾‹å¦‚ORMå·¥å…·æˆ–ä»»ä½•æ‰§è¡ŒIOæ“ä½œçš„åº“ï¼ˆé€šè¿‡HTTPè®¿é—®èµ„æºã€è¯»å–æ–‡ä»¶ã€ä¿å­˜åˆ°æ•°æ®åº“ç­‰ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨ç¦»å¼€åº”ç”¨ç¨‹åºçš„å†…éƒ¨ä»£ç ä»¥ä¸å…¶ä»–ç»„ä»¶äº¤äº’çš„çº§åˆ«ã€‚</p>
<p><strong>å¤„ç†å‡†åˆ™ï¼š</strong></p>
<div class="note info no-icon flat"><ol>
<li><strong>åªå¤„ç†ç‰¹å®šçš„å¼‚å¸¸</strong>ï¼Œä¾‹å¦‚SqlTimeoutExceptionæˆ–IOExceptionã€‚ä»ä¸å¤„ç†ä¸€èˆ¬å¼‚å¸¸ï¼ˆExceptionç±»å‹ï¼‰</li>
<li><strong>ä»…å½“æ‚¨æœ‰ä¸€äº›æœ‰æ„ä¹‰çš„äº‹æƒ…è¦åšæ—¶æ‰å¤„ç†å®ƒ</strong>ï¼Œä¾‹å¦‚é‡è¯•ã€è§¦å‘è¡¥å¿æ“ä½œæˆ–å‘å¼‚å¸¸æ·»åŠ æ›´å¤šæ•°æ®ï¼ˆä¾‹å¦‚ä¸Šä¸‹æ–‡å˜é‡ï¼‰ï¼Œç„¶åé‡æ–°æŠ›å‡ºå®ƒ</li>
<li><strong>ä¸è¦åœ¨æ­¤å¤„æ‰§è¡Œæ—¥å¿—è®°å½•</strong></li>
<li><strong>è®©æ‰€æœ‰å…¶ä»–å¼‚å¸¸å†’æ³¡</strong>ï¼Œå› ä¸ºå®ƒä»¬å°†ç”±é«˜å±‚çº§å¤„ç†</li>
</ol>
</div>

<h3 id="ï¼ˆ2ï¼‰é«˜å±‚çº§å¼‚å¸¸å¤„ç†"><a href="#ï¼ˆ2ï¼‰é«˜å±‚çº§å¼‚å¸¸å¤„ç†" class="headerlink" title="ï¼ˆ2ï¼‰é«˜å±‚çº§å¼‚å¸¸å¤„ç†"></a>ï¼ˆ2ï¼‰é«˜å±‚çº§å¼‚å¸¸å¤„ç†</h3><p><strong>ä»€ä¹ˆæ˜¯é«˜å±‚çº§ï¼Ÿ</strong><br>è¿™å°†æ˜¯åœ¨å°†å¼‚å¸¸ç›´æ¥æŠ›ç»™ç”¨æˆ·ä¹‹å‰æ‚¨å¯ä»¥å¤„ç†å¼‚å¸¸çš„æœ€åä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p><strong>å¤„ç†å‡†åˆ™ï¼š</strong></p>
<div class="note success no-icon flat"><ol>
<li><strong>å¤„ç†é€šç”¨å¼‚å¸¸ç±»</strong></li>
<li><strong>ä»å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯</strong></li>
<li><strong>è®°å½•é”™è¯¯å¹¶é€šçŸ¥ç¨‹åºå‘˜</strong></li>
<li><strong>å‘ç”¨æˆ·é“æ­‰æˆ–æç¤ºé”™è¯¯ä¿¡æ¯</strong></li>
<li><strong>å°½å¿«è§£å†³</strong></li>
</ol>
</div>

<h3 id="ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸"><a href="#ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸"></a>ï¼ˆ3ï¼‰ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸</h3><p>åœ¨å¼€å‘åº“çš„ä¸Šä¸‹æ–‡ä¸­æ›´å®¹æ˜“ç†è§£ã€‚å½“æ‚¨é‡åˆ°é”™è¯¯æ—¶ï¼Œæ‚¨åº”è¯¥æŠ›å‡ºé”™è¯¯ï¼Œé™¤äº†è®©æ‚¨çš„APIçš„ä½¿ç”¨è€…çŸ¥é“å¹¶è®©ä»–ä»¬å†³å®šä¹‹å¤–ï¼Œæ‚¨æ— èƒ½ä¸ºåŠ›ã€‚</p>
<p>å‡è®¾æ‚¨æ˜¯æŸä¸ªæ•°æ®è®¿é—®åº“çš„å¼€å‘äººå‘˜ã€‚å½“æ‚¨é‡åˆ°ç½‘ç»œé”™è¯¯æ—¶ï¼Œé™¤äº†æŠ›å‡ºå¼‚å¸¸ä¹‹å¤–ï¼Œæ‚¨æ— èƒ½ä¸ºåŠ›ã€‚ä»æ•°æ®è®¿é—®åº“çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¯é€†è½¬çš„é”™è¯¯ã€‚</p>
<h2 id="1-3-å‡†åˆ™èƒŒåçš„åŸç†"><a href="#1-3-å‡†åˆ™èƒŒåçš„åŸç†" class="headerlink" title="1.3 å‡†åˆ™èƒŒåçš„åŸç†"></a>1.3 å‡†åˆ™èƒŒåçš„åŸç†</h2><div class="note warning no-icon flat"><ol>
<li><strong>å¼‚å¸¸ä»£è¡¨ä¸å¯é€†è½¬çš„é”™è¯¯</strong>ã€‚å®ƒä»¬ä»£è¡¨ç³»ç»Ÿä¸­çš„é”™è¯¯ã€ç¨‹åºå‘˜çŠ¯çš„é”™è¯¯æˆ–åº”ç”¨ç¨‹åºæ— æ³•æ§åˆ¶çš„æƒ…å†µã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·é€šå¸¸æ— èƒ½ä¸ºåŠ›ã€‚</li>
<li><strong>try catchå—å¯ä»¥å±è”½åº”ç”¨ç¨‹åºæµç¨‹</strong>ã€‚è¿‡åº¦ä½¿ç”¨ä¼šè®©ä»£ç é€»è¾‘å˜å¾—å¤æ‚å’Œéš¾ä»¥ç†è§£ã€‚</li>
<li><strong>å¼‚å¸¸å¤„ç†åº”è¯¥æœ‰å±‚æ¬¡æ€§</strong>ã€‚ä½å±‚çº§ä¸“æ³¨äºç‰¹å®šå¼‚å¸¸çš„å¤„ç†ï¼Œé«˜å±‚çº§è´Ÿè´£ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ç­–ç•¥ã€‚</li>
</ol>
</div>

<h2 id="1-4-é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ³•"><a href="#1-4-é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ³•" class="headerlink" title="1.4 é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ³•"></a>1.4 é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ³•</h2><h3 id="ï¼ˆ1ï¼‰å·¥å…·ç±»ä¸­çš„å¼‚å¸¸å¤„ç†"><a href="#ï¼ˆ1ï¼‰å·¥å…·ç±»ä¸­çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="ï¼ˆ1ï¼‰å·¥å…·ç±»ä¸­çš„å¼‚å¸¸å¤„ç†"></a>ï¼ˆ1ï¼‰å·¥å…·ç±»ä¸­çš„å¼‚å¸¸å¤„ç†</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ¨èåšæ³•</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileUtils</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// æ·»åŠ ä¸Šä¸‹æ–‡ä¿¡æ¯åé‡æ–°æŠ›å‡º</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Failed to read file: "</span> <span class="token operator">+</span> filePath<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰Controllerçš„å‚æ•°æ ¡éªŒ"><a href="#ï¼ˆ2ï¼‰Controllerçš„å‚æ•°æ ¡éªŒ" class="headerlink" title="ï¼ˆ2ï¼‰Controllerçš„å‚æ•°æ ¡éªŒ"></a>ï¼ˆ2ï¼‰Controllerçš„å‚æ•°æ ¡éªŒ</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ¨èåšæ³•</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">UserCreateRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BusinessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Create user failed: &#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Unexpected error when creating user"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰å¼‚å¸¸å¤„ç†çš„ç»å…¸æ¡ˆä¾‹"><a href="#ï¼ˆ3ï¼‰å¼‚å¸¸å¤„ç†çš„ç»å…¸æ¡ˆä¾‹" class="headerlink" title="ï¼ˆ3ï¼‰å¼‚å¸¸å¤„ç†çš„ç»å…¸æ¡ˆä¾‹"></a>ï¼ˆ3ï¼‰å¼‚å¸¸å¤„ç†çš„ç»å…¸æ¡ˆä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¸æ¨èçš„åšæ³•</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ä¸šåŠ¡é€»è¾‘</span>
        dataService<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åæ‰å¼‚å¸¸ï¼Œä¸åšä»»ä½•å¤„ç†</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// æ¨èçš„åšæ³•</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">DataProcessException</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        dataService<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DataAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è½¬æ¢ä¸ºä¸šåŠ¡å¼‚å¸¸</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DataProcessException</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®å¤„ç†å¤±è´¥"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="äºŒã€æ—¥å¿—æ‰“å°"><a href="#äºŒã€æ—¥å¿—æ‰“å°" class="headerlink" title="äºŒã€æ—¥å¿—æ‰“å°"></a>äºŒã€æ—¥å¿—æ‰“å°</h1><h2 id="2-1-æ—¥å¿—è¾“å‡ºå‡†åˆ™"><a href="#2-1-æ—¥å¿—è¾“å‡ºå‡†åˆ™" class="headerlink" title="2.1 æ—¥å¿—è¾“å‡ºå‡†åˆ™"></a>2.1 æ—¥å¿—è¾“å‡ºå‡†åˆ™</h2><h3 id="ï¼ˆ1ï¼‰Good-things-to-log"><a href="#ï¼ˆ1ï¼‰Good-things-to-log" class="headerlink" title="ï¼ˆ1ï¼‰Good things to log"></a>ï¼ˆ1ï¼‰Good things to log</h3><div class="note success no-icon flat"><ul>
<li><strong>ç³»ç»Ÿå¯åŠ¨å’Œå…³é—­ä¿¡æ¯</strong></li>
<li><strong>ç”¨æˆ·çš„é‡è¦æ“ä½œ</strong>ï¼ˆç™»å½•ã€ç™»å‡ºã€é‡è¦æ•°æ®ä¿®æ”¹ï¼‰</li>
<li><strong>å¤–éƒ¨ç³»ç»Ÿè°ƒç”¨</strong>ï¼ˆç¬¬ä¸‰æ–¹APIã€æ•°æ®åº“æ“ä½œï¼‰</li>
<li><strong>å¼‚å¸¸å’Œé”™è¯¯ä¿¡æ¯</strong></li>
<li><strong>æ€§èƒ½å…³é”®ç‚¹çš„è€—æ—¶</strong></li>
<li><strong>ä¸šåŠ¡æµç¨‹çš„å…³é”®èŠ‚ç‚¹</strong></li>
</ul>
</div>

<h3 id="ï¼ˆ2ï¼‰è®°å½•æ€§èƒ½æ•°æ®"><a href="#ï¼ˆ2ï¼‰è®°å½•æ€§èƒ½æ•°æ®" class="headerlink" title="ï¼ˆ2ï¼‰è®°å½•æ€§èƒ½æ•°æ®"></a>ï¼ˆ2ï¼‰è®°å½•æ€§èƒ½æ•°æ®</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹å¤„ç†è®¢å•ï¼ŒorderId: &#123;&#125;"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ä¸šåŠ¡å¤„ç†é€»è¾‘</span>
            <span class="token function">doProcessOrder</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">long</span> duration <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è®¢å•å¤„ç†å®Œæˆï¼ŒorderId: &#123;&#125;, è€—æ—¶: &#123;&#125;ms"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> duration <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"è®¢å•å¤„ç†å¤±è´¥ï¼ŒorderId: &#123;&#125;, è€—æ—¶: &#123;&#125;ms"</span><span class="token punctuation">,</span> orderId<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰Bad-things-to-log"><a href="#ï¼ˆ3ï¼‰Bad-things-to-log" class="headerlink" title="ï¼ˆ3ï¼‰Bad things to log"></a>ï¼ˆ3ï¼‰Bad things to log</h3><div class="note danger no-icon flat"><ul>
<li><strong>æ•æ„Ÿä¿¡æ¯</strong>ï¼ˆå¯†ç ã€èº«ä»½è¯å·ã€é“¶è¡Œå¡å·ç­‰ï¼‰</li>
<li><strong>è¿‡äºé¢‘ç¹çš„æ—¥å¿—</strong>ï¼ˆå¾ªç¯ä¸­çš„å¤§é‡æ—¥å¿—ï¼‰</li>
<li><strong>æ— æ„ä¹‰çš„æ—¥å¿—</strong>ï¼ˆå¦‚ç®€å•çš„getter&#x2F;setterè°ƒç”¨ï¼‰</li>
<li><strong>é‡å¤çš„æ—¥å¿—ä¿¡æ¯</strong></li>
<li><strong>è°ƒè¯•æ—¥å¿—åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¾“å‡º</strong></li>
</ul>
</div>

<h2 id="2-2-æ—¥å¿—è¾“å‡ºæ¡ˆä¾‹"><a href="#2-2-æ—¥å¿—è¾“å‡ºæ¡ˆä¾‹" class="headerlink" title="2.2 æ—¥å¿—è¾“å‡ºæ¡ˆä¾‹"></a>2.2 æ—¥å¿—è¾“å‡ºæ¡ˆä¾‹</h2><h3 id="ï¼ˆ1ï¼‰ç³»ç»Ÿå…¥å£å¢åŠ æ—¥å¿—è®°å½•"><a href="#ï¼ˆ1ï¼‰ç³»ç»Ÿå…¥å£å¢åŠ æ—¥å¿—è®°å½•" class="headerlink" title="ï¼ˆ1ï¼‰ç³»ç»Ÿå…¥å£å¢åŠ æ—¥å¿—è®°å½•"></a>ï¼ˆ1ï¼‰ç³»ç»Ÿå…¥å£å¢åŠ æ—¥å¿—è®°å½•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiController</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/api/data"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">DataRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> requestId <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æ•°æ®å¤„ç†è¯·æ±‚ï¼ŒrequestId: &#123;&#125;, request: &#123;&#125;"</span><span class="token punctuation">,</span> requestId<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">DataResponse</span> response <span class="token operator">=</span> dataService<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®å¤„ç†å®Œæˆï¼ŒrequestId: &#123;&#125;, response: &#123;&#125;"</span><span class="token punctuation">,</span> requestId<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®å¤„ç†å¤±è´¥ï¼ŒrequestId: &#123;&#125;"</span><span class="token punctuation">,</span> requestId<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰è¯·æ±‚ç¬¬ä¸‰æ–¹æˆ–è¿œç¨‹æ¥å£è®°å½•æ—¥å¿—"><a href="#ï¼ˆ2ï¼‰è¯·æ±‚ç¬¬ä¸‰æ–¹æˆ–è¿œç¨‹æ¥å£è®°å½•æ—¥å¿—" class="headerlink" title="ï¼ˆ2ï¼‰è¯·æ±‚ç¬¬ä¸‰æ–¹æˆ–è¿œç¨‹æ¥å£è®°å½•æ—¥å¿—"></a>ï¼ˆ2ï¼‰è¯·æ±‚ç¬¬ä¸‰æ–¹æˆ–è¿œç¨‹æ¥å£è®°å½•æ—¥å¿—</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThirdPartyService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ApiResponse</span> <span class="token function">callThirdPartyApi</span><span class="token punctuation">(</span><span class="token class-name">ApiRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨ç¬¬ä¸‰æ–¹APIå¼€å§‹ï¼Œurl: &#123;&#125;, request: &#123;&#125;"</span><span class="token punctuation">,</span> apiUrl<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ApiResponse</span> response <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span>apiUrl<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token class-name">ApiResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨ç¬¬ä¸‰æ–¹APIæˆåŠŸï¼Œurl: &#123;&#125;, response: &#123;&#125;"</span><span class="token punctuation">,</span> apiUrl<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨ç¬¬ä¸‰æ–¹APIå¤±è´¥ï¼Œurl: &#123;&#125;, request: &#123;&#125;"</span><span class="token punctuation">,</span> apiUrl<span class="token punctuation">,</span> request<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ThirdPartyApiException</span><span class="token punctuation">(</span><span class="token string">"ç¬¬ä¸‰æ–¹APIè°ƒç”¨å¤±è´¥"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰è®°å½•ç³»ç»Ÿå…³é”®çš„å¯åŠ¨å‚æ•°"><a href="#ï¼ˆ3ï¼‰è®°å½•ç³»ç»Ÿå…³é”®çš„å¯åŠ¨å‚æ•°" class="headerlink" title="ï¼ˆ3ï¼‰è®°å½•ç³»ç»Ÿå…³é”®çš„å¯åŠ¨å‚æ•°"></a>ï¼ˆ3ï¼‰è®°å½•ç³»ç»Ÿå…³é”®çš„å¯åŠ¨å‚æ•°</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationStartupListener</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextRefreshedEvent</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;app.version&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appVersion<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;spring.profiles.active&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> activeProfile<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">ContextRefreshedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åº”ç”¨å¯åŠ¨å®Œæˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åº”ç”¨ç‰ˆæœ¬: &#123;&#125;"</span><span class="token punctuation">,</span> appVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ´»åŠ¨é…ç½®: &#123;&#125;"</span><span class="token punctuation">,</span> activeProfile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"JVMä¿¡æ¯: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"java.version"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ç³»ç»Ÿæ—¶åŒº: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸‰ã€é¡¹ç›®åˆ†å±‚"><a href="#ä¸‰ã€é¡¹ç›®åˆ†å±‚" class="headerlink" title="ä¸‰ã€é¡¹ç›®åˆ†å±‚"></a>ä¸‰ã€é¡¹ç›®åˆ†å±‚</h1><h2 id="3-1-é¡¹ç›®åˆ†å±‚å‡†åˆ™"><a href="#3-1-é¡¹ç›®åˆ†å±‚å‡†åˆ™" class="headerlink" title="3.1 é¡¹ç›®åˆ†å±‚å‡†åˆ™"></a>3.1 é¡¹ç›®åˆ†å±‚å‡†åˆ™</h2><div class="note primary no-icon flat"><p><strong>ç»å…¸ä¸‰å±‚æ¶æ„</strong>ï¼š</p>
<ul>
<li><strong>Controllerå±‚</strong>ï¼šæ¥æ”¶è¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒï¼Œè°ƒç”¨Serviceå±‚</li>
<li><strong>Serviceå±‚</strong>ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œäº‹åŠ¡æ§åˆ¶</li>
<li><strong>DAOå±‚</strong>ï¼šæ•°æ®è®¿é—®ï¼Œä¸æ•°æ®åº“äº¤äº’</li>
</ul>
<p><strong>æ‰©å±•åˆ†å±‚</strong>ï¼š</p>
<ul>
<li><strong>DTOå±‚</strong>ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡</li>
<li><strong>Entityå±‚</strong>ï¼šå®ä½“å¯¹è±¡</li>
<li><strong>Utilså±‚</strong>ï¼šå·¥å…·ç±»</li>
<li><strong>Configå±‚</strong>ï¼šé…ç½®ç±»</li>
</ul>
</div>

<h2 id="3-2-é¡¹ç›®æ¡ˆä¾‹"><a href="#3-2-é¡¹ç›®æ¡ˆä¾‹" class="headerlink" title="3.2 é¡¹ç›®æ¡ˆä¾‹"></a>3.2 é¡¹ç›®æ¡ˆä¾‹</h2><h3 id="ï¼ˆ1ï¼‰åˆ›å»ºçŸ­é“¾æ¥å£"><a href="#ï¼ˆ1ï¼‰åˆ›å»ºçŸ­é“¾æ¥å£" class="headerlink" title="ï¼ˆ1ï¼‰åˆ›å»ºçŸ­é“¾æ¥å£"></a>ï¼ˆ1ï¼‰åˆ›å»ºçŸ­é“¾æ¥å£</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Controllerå±‚</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/api/shortlink"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShortLinkController</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ShortLinkService</span> shortLinkService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/create"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShortLinkDTO</span><span class="token punctuation">></span></span> <span class="token function">createShortLink</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CreateShortLinkRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"åˆ›å»ºçŸ­é“¾è¯·æ±‚: &#123;&#125;"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ShortLinkDTO</span> result <span class="token operator">=</span> shortLinkService<span class="token punctuation">.</span><span class="token function">createShortLink</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Serviceå±‚</span>
<span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShortLinkService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ShortLinkDAO</span> shortLinkDAO<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">ShortLinkDTO</span> <span class="token function">createShortLink</span><span class="token punctuation">(</span><span class="token class-name">CreateShortLinkRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
        <span class="token class-name">String</span> shortCode <span class="token operator">=</span> <span class="token function">generateShortCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">ShortLink</span> shortLink <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShortLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shortLink<span class="token punctuation">.</span><span class="token function">setOriginalUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getOriginalUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shortLink<span class="token punctuation">.</span><span class="token function">setShortCode</span><span class="token punctuation">(</span>shortCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        shortLink<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        shortLinkDAO<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>shortLink<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token function">convertToDTO</span><span class="token punctuation">(</span>shortLink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">generateShortCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// çŸ­ç ç”Ÿæˆé€»è¾‘</span>
        <span class="token keyword">return</span> <span class="token class-name">RandomStringUtils</span><span class="token punctuation">.</span><span class="token function">randomAlphanumeric</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// DAOå±‚</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShortLinkDAO</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">ShortLink</span> shortLink<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"INSERT INTO short_link (original_url, short_code, create_time) VALUES (?, ?, ?)"</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> shortLink<span class="token punctuation">.</span><span class="token function">getOriginalUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shortLink<span class="token punctuation">.</span><span class="token function">getShortCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shortLink<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å››ã€åŒ…ç»“æ„åˆ’åˆ†"><a href="#å››ã€åŒ…ç»“æ„åˆ’åˆ†" class="headerlink" title="å››ã€åŒ…ç»“æ„åˆ’åˆ†"></a>å››ã€åŒ…ç»“æ„åˆ’åˆ†</h1><h2 id="4-1-åŒ…ç»“æ„åˆ’åˆ†å‡†åˆ™"><a href="#4-1-åŒ…ç»“æ„åˆ’åˆ†å‡†åˆ™" class="headerlink" title="4.1 åŒ…ç»“æ„åˆ’åˆ†å‡†åˆ™"></a>4.1 åŒ…ç»“æ„åˆ’åˆ†å‡†åˆ™</h2><div class="note info no-icon flat"><p><strong>æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">com.example.project
â”œâ”€â”€ controller&#x2F;     # æ§åˆ¶å™¨
â”œâ”€â”€ service&#x2F;        # ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ dao&#x2F;           # æ•°æ®è®¿é—®
â”œâ”€â”€ entity&#x2F;        # å®ä½“ç±»
â”œâ”€â”€ dto&#x2F;           # æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ config&#x2F;        # é…ç½®ç±»
â”œâ”€â”€ utils&#x2F;         # å·¥å…·ç±»
â””â”€â”€ exception&#x2F;     # å¼‚å¸¸ç±»<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†</strong>ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">com.example.project
â”œâ”€â”€ user&#x2F;          # ç”¨æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ controller&#x2F;
â”‚   â”œâ”€â”€ service&#x2F;
â”‚   â””â”€â”€ dao&#x2F;
â”œâ”€â”€ order&#x2F;         # è®¢å•æ¨¡å—
â”‚   â”œâ”€â”€ controller&#x2F;
â”‚   â”œâ”€â”€ service&#x2F;
â”‚   â””â”€â”€ dao&#x2F;
â””â”€â”€ common&#x2F;        # å…¬å…±æ¨¡å—
    â”œâ”€â”€ config&#x2F;
    â”œâ”€â”€ utils&#x2F;
    â””â”€â”€ exception&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>

<h2 id="4-2-åŒ…åå‘½å"><a href="#4-2-åŒ…åå‘½å" class="headerlink" title="4.2 åŒ…åå‘½å"></a>4.2 åŒ…åå‘½å</h2><ul>
<li>åŒ…ååº”è¯¥ä½¿ç”¨å°å†™å­—æ¯</li>
<li>å¤šä¸ªå•è¯ç”¨ç‚¹åˆ†éš”</li>
<li>é¿å…ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–å…¶ä»–ç‰¹æ®Šå­—ç¬¦</li>
<li>åŒ…ååº”è¯¥æœ‰æ„ä¹‰ï¼Œèƒ½å¤Ÿæ¸…æ¥šè¡¨è¾¾åŒ…çš„ç”¨é€”</li>
</ul>
<h2 id="4-3-é¡¹ç›®æ¡ˆä¾‹"><a href="#4-3-é¡¹ç›®æ¡ˆä¾‹" class="headerlink" title="4.3 é¡¹ç›®æ¡ˆä¾‹"></a>4.3 é¡¹ç›®æ¡ˆä¾‹</h2><h3 id="ï¼ˆ1ï¼‰å›è°ƒæ¥å£æå–åˆ°å•ç‹¬çš„åŒ…ä¸­ä»¥åšåŒºåˆ†"><a href="#ï¼ˆ1ï¼‰å›è°ƒæ¥å£æå–åˆ°å•ç‹¬çš„åŒ…ä¸­ä»¥åšåŒºåˆ†" class="headerlink" title="ï¼ˆ1ï¼‰å›è°ƒæ¥å£æå–åˆ°å•ç‹¬çš„åŒ…ä¸­ä»¥åšåŒºåˆ†"></a>ï¼ˆ1ï¼‰å›è°ƒæ¥å£æå–åˆ°å•ç‹¬çš„åŒ…ä¸­ä»¥åšåŒºåˆ†</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åŸæœ‰ç»“æ„</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span>UserController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span>CallbackController</span>

<span class="token comment">// ä¼˜åŒ–åç»“æ„</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span>UserController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span>MessageCallbackController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span>PaymentCallbackController</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨package-info-java"><a href="#ï¼ˆ2ï¼‰ä½¿ç”¨package-info-java" class="headerlink" title="ï¼ˆ2ï¼‰ä½¿ç”¨package-info.java"></a>ï¼ˆ2ï¼‰ä½¿ç”¨package-info.java</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å›è°ƒæ¥å£åŒ…
 * 
 * åŒ…å«æ‰€æœ‰ç¬¬ä¸‰æ–¹å¹³å°çš„å›è°ƒæ¥å£å®ç°ï¼ŒåŒ…æ‹¬ï¼š
 * - æ¶ˆæ¯çŠ¶æ€å›è°ƒ
 * - æ”¯ä»˜çŠ¶æ€å›è°ƒ
 * - å®¡æ ¸ç»“æœå›è°ƒ
 * 
 * @author development team
 * @version 1.0
 * @since 2024-01-01
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>callback</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰Controlleræ ¹æ®ä¸šåŠ¡è¿›è¡Œåˆ†åŒ…"><a href="#ï¼ˆ3ï¼‰Controlleræ ¹æ®ä¸šåŠ¡è¿›è¡Œåˆ†åŒ…" class="headerlink" title="ï¼ˆ3ï¼‰Controlleræ ¹æ®ä¸šåŠ¡è¿›è¡Œåˆ†åŒ…"></a>ï¼ˆ3ï¼‰Controlleræ ¹æ®ä¸šåŠ¡è¿›è¡Œåˆ†åŒ…</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ†åŒ…</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span>UserController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span>UserProfileController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>order<span class="token punctuation">.</span></span>OrderController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>order<span class="token punctuation">.</span></span>OrderPaymentController</span>
<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>project<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span></span>AdminController</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="äº”ã€DTOçš„ä½¿ç”¨"><a href="#äº”ã€DTOçš„ä½¿ç”¨" class="headerlink" title="äº”ã€DTOçš„ä½¿ç”¨"></a>äº”ã€DTOçš„ä½¿ç”¨</h1><h2 id="5-1-å¤„ç†å‡†åˆ™"><a href="#5-1-å¤„ç†å‡†åˆ™" class="headerlink" title="5.1 å¤„ç†å‡†åˆ™"></a>5.1 å¤„ç†å‡†åˆ™</h2><h3 id="ï¼ˆ1ï¼‰åˆ†å±‚é¢†åŸŸæ¨¡å‹è§„çº¦ï¼ˆé˜¿é‡Œè§„çº¦ï¼‰"><a href="#ï¼ˆ1ï¼‰åˆ†å±‚é¢†åŸŸæ¨¡å‹è§„çº¦ï¼ˆé˜¿é‡Œè§„çº¦ï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰åˆ†å±‚é¢†åŸŸæ¨¡å‹è§„çº¦ï¼ˆé˜¿é‡Œè§„çº¦ï¼‰"></a>ï¼ˆ1ï¼‰åˆ†å±‚é¢†åŸŸæ¨¡å‹è§„çº¦ï¼ˆé˜¿é‡Œè§„çº¦ï¼‰</h3><div class="note primary no-icon flat"><ul>
<li><strong>DO (Data Object)</strong>ï¼šä¸æ•°æ®åº“è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”ï¼Œé€šè¿‡DAOå±‚å‘ä¸Šä¼ è¾“æ•°æ®æºå¯¹è±¡</li>
<li><strong>DTO (Data Transfer Object)</strong>ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼ŒServiceæˆ–Managerå‘å¤–ä¼ è¾“çš„å¯¹è±¡</li>
<li><strong>BO (Business Object)</strong>ï¼šä¸šåŠ¡å¯¹è±¡ï¼Œç”±Serviceå±‚è¾“å‡ºçš„å°è£…ä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡</li>
<li><strong>VO (View Object)</strong>ï¼šæ˜¾ç¤ºå±‚å¯¹è±¡ï¼Œé€šå¸¸æ˜¯Webå‘æ¨¡æ¿æ¸²æŸ“å¼•æ“å±‚ä¼ è¾“çš„å¯¹è±¡</li>
</ul>
</div>

<h3 id="ï¼ˆ2ï¼‰ä½¿ç”¨DTOçš„ä¼˜ç‚¹"><a href="#ï¼ˆ2ï¼‰ä½¿ç”¨DTOçš„ä¼˜ç‚¹" class="headerlink" title="ï¼ˆ2ï¼‰ä½¿ç”¨DTOçš„ä¼˜ç‚¹"></a>ï¼ˆ2ï¼‰ä½¿ç”¨DTOçš„ä¼˜ç‚¹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Entity - æ•°æ®åº“å®ä½“</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>  <span class="token comment">// æ•æ„Ÿä¿¡æ¯</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// DTO - æ•°æ®ä¼ è¾“å¯¹è±¡</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDTO</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> createTime<span class="token punctuation">;</span>  <span class="token comment">// æ ¼å¼åŒ–åçš„æ—¶é—´</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Serviceå±‚ä½¿ç”¨</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">UserDTO</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userDAO<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">convertToDTO</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è½¬æ¢æ—¶è¿‡æ»¤æ•æ„Ÿä¿¡æ¯</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">UserDTO</span> <span class="token function">convertToDTO</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">UserDTO</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDTO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dto<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dto<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dto<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dto<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ ¼å¼åŒ–æ—¶é—´</span>
        <span class="token keyword">return</span> dto<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5-2-æ¨èæ¡ˆä¾‹"><a href="#5-2-æ¨èæ¡ˆä¾‹" class="headerlink" title="5.2 æ¨èæ¡ˆä¾‹"></a>5.2 æ¨èæ¡ˆä¾‹</h2><h3 id="ï¼ˆ1ï¼‰åº”ç”¨å¹³å°æ¡ˆä¾‹"><a href="#ï¼ˆ1ï¼‰åº”ç”¨å¹³å°æ¡ˆä¾‹" class="headerlink" title="ï¼ˆ1ï¼‰åº”ç”¨å¹³å°æ¡ˆä¾‹"></a>ï¼ˆ1ï¼‰åº”ç”¨å¹³å°æ¡ˆä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è¯·æ±‚DTO</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendMessageRequest</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"æ¥æ”¶è€…ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> receiver<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">String</span> messageType<span class="token punctuation">;</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// å“åº”DTO</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendMessageResponse</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> messageId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">;</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// å®ä½“ç±»</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> messageId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sender<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> receiver<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> sendTime<span class="token punctuation">;</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…­ã€é¢å‘æ¥å£ç¼–ç¨‹"><a href="#å…­ã€é¢å‘æ¥å£ç¼–ç¨‹" class="headerlink" title="å…­ã€é¢å‘æ¥å£ç¼–ç¨‹"></a>å…­ã€é¢å‘æ¥å£ç¼–ç¨‹</h1><h2 id="6-1-ç¼–ç å‡†åˆ™"><a href="#6-1-ç¼–ç å‡†åˆ™" class="headerlink" title="6.1 ç¼–ç å‡†åˆ™"></a>6.1 ç¼–ç å‡†åˆ™</h2><h3 id="ï¼ˆ1ï¼‰é¢å‘æ¥å£ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#ï¼ˆ1ï¼‰é¢å‘æ¥å£ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="ï¼ˆ1ï¼‰é¢å‘æ¥å£ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹"></a>ï¼ˆ1ï¼‰é¢å‘æ¥å£ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹</h3><div class="note success no-icon flat"><p><strong>é¢å‘æ¥å£ç¼–ç¨‹çš„ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>é™ä½è€¦åˆåº¦</strong>ï¼šä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°</li>
<li><strong>æé«˜å¯æµ‹è¯•æ€§</strong>ï¼šä¾¿äºMockå’Œå•å…ƒæµ‹è¯•</li>
<li><strong>å¢å¼ºå¯æ‰©å±•æ€§</strong>ï¼šæ–°å¢å®ç°ä¸å½±å“ç°æœ‰ä»£ç </li>
<li><strong>ç¬¦åˆå¼€é—­åŸåˆ™</strong>ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­</li>
</ul>
</div>

<h3 id="ï¼ˆ2ï¼‰æ¥å£çš„æœ¬è´¨"><a href="#ï¼ˆ2ï¼‰æ¥å£çš„æœ¬è´¨" class="headerlink" title="ï¼ˆ2ï¼‰æ¥å£çš„æœ¬è´¨"></a>ï¼ˆ2ï¼‰æ¥å£çš„æœ¬è´¨</h3><p>æ¥å£å®šä¹‰äº†ä¸€ä¸ªå¥‘çº¦ï¼Œè§„å®šäº†å®ç°ç±»å¿…é¡»æä¾›çš„æ–¹æ³•ã€‚è¿™æ ·å¯ä»¥å®ç°å¤šæ€ï¼ŒåŒä¸€ä¸ªæ¥å£å¯ä»¥æœ‰å¤šç§ä¸åŒçš„å®ç°ã€‚</p>
<h2 id="6-2-é¡¹ç›®æ¡ˆä¾‹"><a href="#6-2-é¡¹ç›®æ¡ˆä¾‹" class="headerlink" title="6.2 é¡¹ç›®æ¡ˆä¾‹"></a>6.2 é¡¹ç›®æ¡ˆä¾‹</h2><h3 id="ï¼ˆ1ï¼‰æ¶ˆæ¯æ¥å£çš„è¿”å›å€¼"><a href="#ï¼ˆ1ï¼‰æ¶ˆæ¯æ¥å£çš„è¿”å›å€¼" class="headerlink" title="ï¼ˆ1ï¼‰æ¶ˆæ¯æ¥å£çš„è¿”å›å€¼"></a>ï¼ˆ1ï¼‰æ¶ˆæ¯æ¥å£çš„è¿”å›å€¼</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ¶ˆæ¯å‘é€æ¥å£å®šä¹‰</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">SendResult</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">SendMessageRequest</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// çŸ­ä¿¡å‘é€å®ç°</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"smsSender"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmsSender</span> <span class="token keyword">implements</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">SendMessageRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// çŸ­ä¿¡å‘é€é€»è¾‘</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SendResult</span><span class="token punctuation">(</span><span class="token string">"SMS"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"å‘é€æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// é‚®ä»¶å‘é€å®ç°</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"emailSender"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmailSender</span> <span class="token keyword">implements</span> <span class="token class-name">MessageSender</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">SendMessageRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// é‚®ä»¶å‘é€é€»è¾‘</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SendResult</span><span class="token punctuation">(</span><span class="token string">"EMAIL"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">"å‘é€æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// æ¶ˆæ¯æœåŠ¡</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"smsSender"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageSender</span> smsSender<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"emailSender"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">MessageSender</span> emailSender<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">SendResult</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">,</span> <span class="token class-name">SendMessageRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MessageSender</span> sender <span class="token operator">=</span> <span class="token string">"SMS"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">?</span> smsSender <span class="token operator">:</span> emailSender<span class="token punctuation">;</span>
        <span class="token keyword">return</span> sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸ƒã€å•å…ƒæµ‹è¯•"><a href="#ä¸ƒã€å•å…ƒæµ‹è¯•" class="headerlink" title="ä¸ƒã€å•å…ƒæµ‹è¯•"></a>ä¸ƒã€å•å…ƒæµ‹è¯•</h1><h2 id="7-1-ç¼–ç å‡†åˆ™"><a href="#7-1-ç¼–ç å‡†åˆ™" class="headerlink" title="7.1 ç¼–ç å‡†åˆ™"></a>7.1 ç¼–ç å‡†åˆ™</h2><h3 id="ï¼ˆ1ï¼‰å•å…ƒæµ‹è¯•å®šä¹‰"><a href="#ï¼ˆ1ï¼‰å•å…ƒæµ‹è¯•å®šä¹‰" class="headerlink" title="ï¼ˆ1ï¼‰å•å…ƒæµ‹è¯•å®šä¹‰"></a>ï¼ˆ1ï¼‰å•å…ƒæµ‹è¯•å®šä¹‰</h3><p>å•å…ƒæµ‹è¯•æ˜¯å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯çš„æµ‹è¯•æ–¹æ³•ã€‚åœ¨Javaä¸­ï¼Œé€šå¸¸æ˜¯å¯¹ç±»çš„æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰å•å…ƒæµ‹è¯•çš„ä¼˜ç‚¹"><a href="#ï¼ˆ2ï¼‰å•å…ƒæµ‹è¯•çš„ä¼˜ç‚¹" class="headerlink" title="ï¼ˆ2ï¼‰å•å…ƒæµ‹è¯•çš„ä¼˜ç‚¹"></a>ï¼ˆ2ï¼‰å•å…ƒæµ‹è¯•çš„ä¼˜ç‚¹</h3><div class="note success no-icon flat"><ul>
<li><strong>æé«˜ä»£ç è´¨é‡</strong>ï¼šå¼ºåˆ¶æ€è€ƒè¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ</li>
<li><strong>ä¾¿äºé‡æ„</strong>ï¼šä¸ºä»£ç é‡æ„æä¾›å®‰å…¨ç½‘</li>
<li><strong>æ–‡æ¡£ä½œç”¨</strong>ï¼šå•å…ƒæµ‹è¯•æœ¬èº«å°±æ˜¯æœ€å¥½çš„ä½¿ç”¨æ–‡æ¡£</li>
<li><strong>æé«˜å¼€å‘æ•ˆç‡</strong>ï¼šå¿«é€ŸéªŒè¯ä»£ç ä¿®æ”¹æ˜¯å¦æ­£ç¡®</li>
<li><strong>é™ä½ç»´æŠ¤æˆæœ¬</strong>ï¼šåŠæ—©å‘ç°é—®é¢˜ï¼Œé™ä½ä¿®å¤æˆæœ¬</li>
</ul>
</div>

<h3 id="ï¼ˆ3ï¼‰å•å…ƒæµ‹è¯•å¦‚ä½•è¿›è¡Œ"><a href="#ï¼ˆ3ï¼‰å•å…ƒæµ‹è¯•å¦‚ä½•è¿›è¡Œ" class="headerlink" title="ï¼ˆ3ï¼‰å•å…ƒæµ‹è¯•å¦‚ä½•è¿›è¡Œ"></a>ï¼ˆ3ï¼‰å•å…ƒæµ‹è¯•å¦‚ä½•è¿›è¡Œ</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è¢«æµ‹è¯•çš„æœåŠ¡ç±»</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDAO</span> userDAO<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">CreateUserRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userDAO<span class="token punctuation">.</span><span class="token function">existsByUsername</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·åå·²å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> userDAO<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// å•å…ƒæµ‹è¯•</span>
<span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserServiceTest</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDAO</span> userDAO<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@InjectMocks</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">createUser_Success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Given</span>
        <span class="token class-name">CreateUserRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateUserRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"testuser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"test@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">User</span> savedUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        savedUser<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        savedUser<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"testuser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        savedUser<span class="token punctuation">.</span><span class="token function">setEmail</span><span class="token punctuation">(</span><span class="token string">"test@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">when</span><span class="token punctuation">(</span>userDAO<span class="token punctuation">.</span><span class="token function">existsByUsername</span><span class="token punctuation">(</span><span class="token string">"testuser"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userDAO<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>savedUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// When &amp; Then</span>
        <span class="token function">assertThatThrownBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">BusinessException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">hasMessage</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·åå·²å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">verify</span><span class="token punctuation">(</span>userDAO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">existsByUsername</span><span class="token punctuation">(</span><span class="token string">"existinguser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userDAO<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="7-2-é¡¹ç›®æ¡ˆä¾‹åˆ†æ"><a href="#7-2-é¡¹ç›®æ¡ˆä¾‹åˆ†æ" class="headerlink" title="7.2 é¡¹ç›®æ¡ˆä¾‹åˆ†æ"></a>7.2 é¡¹ç›®æ¡ˆä¾‹åˆ†æ</h2><h3 id="ï¼ˆ1ï¼‰æ•°æ®å›è°ƒé€»è¾‘å•å…ƒæµ‹è¯•"><a href="#ï¼ˆ1ï¼‰æ•°æ®å›è°ƒé€»è¾‘å•å…ƒæµ‹è¯•" class="headerlink" title="ï¼ˆ1ï¼‰æ•°æ®å›è°ƒé€»è¾‘å•å…ƒæµ‹è¯•"></a>ï¼ˆ1ï¼‰æ•°æ®å›è°ƒé€»è¾‘å•å…ƒæµ‹è¯•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è¢«æµ‹è¯•çš„å›è°ƒå¤„ç†ç±»</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataCallbackService</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DataService</span> dataService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NotificationService</span> notificationService<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span><span class="token class-name">DataCallbackRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>request <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getDataId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"å›è°ƒå‚æ•°ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token class-name">DataEntity</span> data <span class="token operator">=</span> dataService<span class="token punctuation">.</span><span class="token function">getDataById</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getDataId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®ä¸å­˜åœ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// æ›´æ–°æ•°æ®çŠ¶æ€</span>
        data<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataService<span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// å‘é€é€šçŸ¥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"APPROVED"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            notificationService<span class="token punctuation">.</span><span class="token function">sendApprovalNotification</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// å•å…ƒæµ‹è¯•</span>
<span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">DataCallbackServiceTest</span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> <span class="token class-name">DataService</span> dataService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> <span class="token class-name">NotificationService</span> notificationService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@InjectMocks</span>
    <span class="token keyword">private</span> <span class="token class-name">DataCallbackService</span> callbackService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">handleCallback_Success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Given</span>
        <span class="token class-name">DataCallbackRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataCallbackRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setDataId</span><span class="token punctuation">(</span><span class="token string">"data123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"APPROVED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">DataEntity</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">"data123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token string">"user456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"PENDING"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">when</span><span class="token punctuation">(</span>dataService<span class="token punctuation">.</span><span class="token function">getDataById</span><span class="token punctuation">(</span><span class="token string">"data123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// When</span>
        callbackService<span class="token punctuation">.</span><span class="token function">handleCallback</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Then</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">"APPROVED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getUpdateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">verify</span><span class="token punctuation">(</span>dataService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataById</span><span class="token punctuation">(</span><span class="token string">"data123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>dataService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>notificationService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendApprovalNotification</span><span class="token punctuation">(</span><span class="token string">"user456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">handleCallback_ThrowException_WhenRequestIsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// When &amp; Then</span>
        <span class="token function">assertThatThrownBy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> callbackService<span class="token punctuation">.</span><span class="token function">handleCallback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">hasMessage</span><span class="token punctuation">(</span><span class="token string">"å›è°ƒå‚æ•°ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">verify</span><span class="token punctuation">(</span>dataService<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDataById</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>dataService<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token class-name">DataEntity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>notificationService<span class="token punctuation">,</span> <span class="token function">never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendApprovalNotification</span><span class="token punctuation">(</span><span class="token function">anyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…«ã€å¸¸è§ä»£ç åå‘³é“"><a href="#å…«ã€å¸¸è§ä»£ç åå‘³é“" class="headerlink" title="å…«ã€å¸¸è§ä»£ç åå‘³é“"></a>å…«ã€å¸¸è§ä»£ç åå‘³é“</h1><h2 id="8-1-è¿‡é•¿å‡½æ•°"><a href="#8-1-è¿‡é•¿å‡½æ•°" class="headerlink" title="8.1 è¿‡é•¿å‡½æ•°"></a>8.1 è¿‡é•¿å‡½æ•°</h2><h3 id="ï¼ˆ1ï¼‰ä»£ç çš„å¯è¯»æ€§"><a href="#ï¼ˆ1ï¼‰ä»£ç çš„å¯è¯»æ€§" class="headerlink" title="ï¼ˆ1ï¼‰ä»£ç çš„å¯è¯»æ€§"></a>ï¼ˆ1ï¼‰ä»£ç çš„å¯è¯»æ€§</h3><div class="note warning no-icon flat"><p><strong>å‡½æ•°è¿‡é•¿çš„é—®é¢˜</strong>ï¼š</p>
<ul>
<li>éš¾ä»¥ç†è§£å’Œç»´æŠ¤</li>
<li>è¿åå•ä¸€èŒè´£åŸåˆ™</li>
<li>éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•</li>
<li>å®¹æ˜“äº§ç”Ÿé‡å¤ä»£ç </li>
</ul>
</div>

<h3 id="ï¼ˆ2ï¼‰ç¼–ç å‡†åˆ™"><a href="#ï¼ˆ2ï¼‰ç¼–ç å‡†åˆ™" class="headerlink" title="ï¼ˆ2ï¼‰ç¼–ç å‡†åˆ™"></a>ï¼ˆ2ï¼‰ç¼–ç å‡†åˆ™</h3><ul>
<li>å‡½æ•°åº”è¯¥å°½å¯èƒ½çŸ­å°ï¼Œé€šå¸¸ä¸è¶…è¿‡20-30è¡Œ</li>
<li>ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹æƒ…</li>
<li>å¦‚æœå‡½æ•°éœ€è¦æ³¨é‡Šæ¥è¯´æ˜ä¸åŒéƒ¨åˆ†çš„åŠŸèƒ½ï¼Œè€ƒè™‘æ‹†åˆ†</li>
<li>ä½¿ç”¨æœ‰æ„ä¹‰çš„å‡½æ•°å</li>
</ul>
<h3 id="ï¼ˆ3ï¼‰å¦‚ä½•æŠŠå‡½æ•°å˜å°"><a href="#ï¼ˆ3ï¼‰å¦‚ä½•æŠŠå‡½æ•°å˜å°" class="headerlink" title="ï¼ˆ3ï¼‰å¦‚ä½•æŠŠå‡½æ•°å˜å°"></a>ï¼ˆ3ï¼‰å¦‚ä½•æŠŠå‡½æ•°å˜å°</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// é‡æ„å‰ï¼šè¿‡é•¿çš„å‡½æ•°</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// éªŒè¯è®¢å•</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"è®¢å•ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"è®¢å•IDä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// æ£€æŸ¥åº“å­˜</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItem</span> item <span class="token operator">:</span> order<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> productService<span class="token punctuation">.</span><span class="token function">getProduct</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> item<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">"åº“å­˜ä¸è¶³"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// è®¡ç®—ä»·æ ¼</span>
    <span class="token class-name">BigDecimal</span> totalPrice <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ZERO</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItem</span> item <span class="token operator">:</span> order<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">BigDecimal</span> itemPrice <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        totalPrice <span class="token operator">=</span> totalPrice<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>itemPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// æ‰£å‡åº“å­˜</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItem</span> item <span class="token operator">:</span> order<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        productService<span class="token punctuation">.</span><span class="token function">reduceStock</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// åˆ›å»ºè®¢å•è®°å½•</span>
    order<span class="token punctuation">.</span><span class="token function">setTotalPrice</span><span class="token punctuation">(</span>totalPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"CREATED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderDAO<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// é‡æ„åï¼šæ‹†åˆ†ä¸ºå¤šä¸ªå°å‡½æ•°</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">validateOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkStock</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigDecimal</span> totalPrice <span class="token operator">=</span> <span class="token function">calculateTotalPrice</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reduceStock</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">createOrderRecord</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> totalPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">validateOrder</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"è®¢å•ä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"è®¢å•IDä¸èƒ½ä¸ºç©º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkStock</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">OrderItem</span> item <span class="token operator">:</span> order<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> productService<span class="token punctuation">.</span><span class="token function">getProduct</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> item<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token string">"åº“å­˜ä¸è¶³"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> <span class="token function">calculateTotalPrice</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-></span> item<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span><span class="token constant">ZERO</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">reduceStock</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    order<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-></span> 
        productService<span class="token punctuation">.</span><span class="token function">reduceStock</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">getQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">createOrderRecord</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span> totalPrice<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    order<span class="token punctuation">.</span><span class="token function">setTotalPrice</span><span class="token punctuation">(</span>totalPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">"CREATED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    orderDAO<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="8-2-è¿‡å¤§çš„ç±»"><a href="#8-2-è¿‡å¤§çš„ç±»" class="headerlink" title="8.2 è¿‡å¤§çš„ç±»"></a>8.2 è¿‡å¤§çš„ç±»</h2><h3 id="ï¼ˆ1ï¼‰é¡¹ç›®æ¡ˆä¾‹"><a href="#ï¼ˆ1ï¼‰é¡¹ç›®æ¡ˆä¾‹" class="headerlink" title="ï¼ˆ1ï¼‰é¡¹ç›®æ¡ˆä¾‹"></a>ï¼ˆ1ï¼‰é¡¹ç›®æ¡ˆä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// é‡æ„å‰ï¼šèŒè´£è¿‡å¤šçš„ç±»</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserManager</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ç”¨æˆ·CRUDæ“ä½œ</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// ç”¨æˆ·è®¤è¯</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">validateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// ç”¨æˆ·æƒé™ç®¡ç†</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">assignRole</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> role<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeRole</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> role<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getUserRoles</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// ç”¨æˆ·é€šçŸ¥</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendWelcomeEmail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendPasswordResetEmail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// é‡æ„åï¼šæŒ‰èŒè´£æ‹†åˆ†ä¸ºå¤šä¸ªç±»</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticationService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">validateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRoleService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">assignRole</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> role<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeRole</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> role<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">getUserRoles</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserNotificationService</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendWelcomeEmail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendPasswordResetEmail</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* */</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¹ã€æ€»ç»“"><a href="#ä¹ã€æ€»ç»“" class="headerlink" title="ä¹ã€æ€»ç»“"></a>ä¹ã€æ€»ç»“</h1><h2 id="9-1-Code-Reviewå…³é”®ç‚¹"><a href="#9-1-Code-Reviewå…³é”®ç‚¹" class="headerlink" title="9.1 Code Reviewå…³é”®ç‚¹"></a>9.1 Code Reviewå…³é”®ç‚¹</h2><div class="note primary no-icon flat"><p><strong>å¼‚å¸¸å¤„ç†</strong>ï¼š</p>
<ul>
<li>æ˜ç¡®å¼‚å¸¸å¤„ç†çš„å±‚æ¬¡å’ŒèŒè´£</li>
<li>é¿å…åæ‰å¼‚å¸¸æˆ–è¿‡åº¦æ•è·</li>
<li>æä¾›æœ‰æ„ä¹‰çš„å¼‚å¸¸ä¿¡æ¯</li>
</ul>
<p><strong>æ—¥å¿—æ‰“å°</strong>ï¼š</p>
<ul>
<li>è®°å½•å…³é”®ä¸šåŠ¡æµç¨‹å’Œæ€§èƒ½æ•°æ®</li>
<li>é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯å’Œæ— æ„ä¹‰æ—¥å¿—</li>
<li>ä½¿ç”¨åˆé€‚çš„æ—¥å¿—çº§åˆ«</li>
</ul>
<p><strong>ä»£ç ç»“æ„</strong>ï¼š</p>
<ul>
<li>ä¿æŒæ¸…æ™°çš„åˆ†å±‚æ¶æ„</li>
<li>åˆç†åˆ’åˆ†åŒ…ç»“æ„</li>
<li>ä½¿ç”¨DTOè¿›è¡Œæ•°æ®ä¼ è¾“</li>
<li>é¢å‘æ¥å£ç¼–ç¨‹</li>
</ul>
<p><strong>ä»£ç è´¨é‡</strong>ï¼š</p>
<ul>
<li>ç¼–å†™å•å…ƒæµ‹è¯•</li>
<li>é¿å…è¿‡é•¿å‡½æ•°å’Œè¿‡å¤§ç±»</li>
<li>éµå¾ªå•ä¸€èŒè´£åŸåˆ™</li>
<li>ä¿æŒä»£ç ç®€æ´å’Œå¯è¯»æ€§</li>
</ul>
</div>

<h2 id="9-2-æœ€ä½³å®è·µå»ºè®®"><a href="#9-2-æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="9.2 æœ€ä½³å®è·µå»ºè®®"></a>9.2 æœ€ä½³å®è·µå»ºè®®</h2><ol>
<li><strong>å»ºç«‹Code Reviewæ–‡åŒ–</strong>ï¼šè®©Code Reviewæˆä¸ºå¼€å‘æµç¨‹çš„å¿…è¦ç¯èŠ‚</li>
<li><strong>åˆ¶å®šç¼–ç è§„èŒƒ</strong>ï¼šå›¢é˜Ÿç»Ÿä¸€çš„ç¼–ç æ ‡å‡†å’Œæœ€ä½³å®è·µ</li>
<li><strong>ä½¿ç”¨å·¥å…·è¾…åŠ©</strong>ï¼šé›†æˆé™æ€ä»£ç åˆ†æå·¥å…·</li>
<li><strong>æŒç»­å­¦ä¹ æ”¹è¿›</strong>ï¼šå®šæœŸå›é¡¾å’Œæ€»ç»“Code Reviewä¸­å‘ç°çš„é—®é¢˜</li>
<li><strong>æ³¨é‡ä»£ç å¯è¯»æ€§</strong>ï¼šä»£ç æ˜¯ç»™äººè¯»çš„ï¼Œä¸ä»…ä»…æ˜¯ç»™æœºå™¨æ‰§è¡Œçš„</li>
</ol>
<p>é€šè¿‡è§„èŒƒçš„Code Reviewæµç¨‹å’Œæ ‡å‡†ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ä»£ç è´¨é‡ï¼Œå‡å°‘ç”Ÿäº§ç¯å¢ƒé—®é¢˜ï¼Œæå‡å›¢é˜Ÿæ•´ä½“çš„å¼€å‘æ°´å¹³ã€‚<br>        User result &#x3D; userService.createUser(request);</p>
<pre><code>    // Then
    assertThat(result).isNotNull();
    assertThat(result.getId()).isEqualTo(1L);
    assertThat(result.getUsername()).isEqualTo(&quot;testuser&quot;);
    
    verify(userDAO).existsByUsername(&quot;testuser&quot;);
    verify(userDAO).save(any(User.class));
&#125;

@Test
void createUser_ThrowException_WhenUsernameIsBlank() &#123;
    // Given
    CreateUserRequest request = new CreateUserRequest();
    request.setUsername(&quot;&quot;);
    
    // When &amp; Then
    assertThatThrownBy(() -&gt; userService.createUser(request))
        .isInstanceOf(IllegalArgumentException.class)
        .hasMessage(&quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;);
    
    verify(userDAO, never()).existsByUsername(anyString());
    verify(userDAO, never()).save(any(User.class));
&#125;

@Test
void createUser_ThrowException_WhenUsernameExists() &#123;
    // Given
    CreateUserRequest request = new CreateUserRequest();
    request.setUsername(&quot;existinguser&quot;);
    
    when(userDAO.existsByUsername(&quot;existinguser&quot;)).thenReturn(true);
    
    // When
</code></pre>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>ä»£ç è§„èŒƒ</tag>
        <tag>Code Review</tag>
        <tag>å¼‚å¸¸å¤„ç†</tag>
        <tag>æ—¥å¿—æ‰“å°</tag>
        <tag>é¡¹ç›®åˆ†å±‚</tag>
        <tag>å•å…ƒæµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆâ€œä¼ªå…±äº«â€é—®é¢˜</title>
    <url>/2022/01/20/java/qian-tan-wei-gong-xiang-wen-ti/</url>
    <content><![CDATA[<blockquote>
<p>éåŸåˆ›ï¼Œè½¬è½½äºï¼š<a href="https://www.liuyj.top/false_sharing.html">https://www.liuyj.top/false_sharing.html</a></p>
</blockquote>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å­¦ä¹ çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªåè¯â€”â€”ä¼ªå…±äº«ï¼Œå‡ºäºå¯¹çŸ¥è¯†çš„å…´è¶£ï¼Œä¸Šç½‘æŸ¥é˜…äº†ä¸€äº›åšæ–‡ï¼Œç ”ç©¶äº†ä¼ªå…±äº«çš„é—®é¢˜ï¼Œå†™æ­¤æ–‡ç« æ€»ç»“è®°å½•ã€‚</p>
<p>è¦å¾ˆå¥½çš„ç†è§£ä¼ªå…±äº«é—®é¢˜ï¼Œæˆ‘ä»¬è¦å…ˆä»CPUçš„ç¼“å­˜å¼€å§‹è¯´èµ·ã€‚</p>
<h2 id="CPUç¼“å­˜æ¶æ„"><a href="#CPUç¼“å­˜æ¶æ„" class="headerlink" title="CPUç¼“å­˜æ¶æ„"></a>CPUç¼“å­˜æ¶æ„</h2><p>CPU æ˜¯è®¡ç®—æœºçš„å¿ƒè„ï¼Œæ‰€æœ‰è¿ç®—å’Œç¨‹åºæœ€ç»ˆéƒ½è¦ç”±å®ƒæ¥æ‰§è¡Œã€‚</p>
<p>ä¸»å†…å­˜ï¼ˆRAMï¼‰æ˜¯æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼ŒCPU å’Œä¸»å†…å­˜ä¹‹é—´æœ‰å¥½å‡ çº§ç¼“å­˜ï¼Œå› ä¸ºå³ä½¿ç›´æ¥è®¿é—®ä¸»å†…å­˜ä¹Ÿæ˜¯éå¸¸æ…¢çš„ã€‚</p>
<p><img src="/2022/01/20/java/qian-tan-wei-gong-xiang-wen-ti/%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84.png" alt="ç¼“å­˜æ¶æ„"></p>
<p>å¦‚æœå¯¹ä¸€å—æ•°æ®åšç›¸åŒçš„è¿ç®—å¤šæ¬¡ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè¿ç®—çš„æ—¶å€™æŠŠå®ƒåŠ è½½åˆ°ç¦» CPU å¾ˆè¿‘çš„åœ°æ–¹å°±æœ‰æ„ä¹‰äº†ï¼Œæ¯”å¦‚ä¸€ä¸ªå¾ªç¯è®¡æ•°ï¼Œä½ ä¸æƒ³æ¯æ¬¡å¾ªç¯éƒ½è·‘åˆ°ä¸»å†…å­˜å»å–è¿™ä¸ªæ•°æ®æ¥å¢é•¿å®ƒå§ã€‚</p>
<p>å†å¯¹ç¼“å­˜çš„æ¦‚å¿µåšä¸€äº›è¯´æ˜ï¼š</p>
<blockquote>
<p>è¶Šé è¿‘ CPU çš„ç¼“å­˜è¶Šå¿«ä¹Ÿè¶Šå°ã€‚<br>æ‰€ä»¥ L1 ç¼“å­˜å¾ˆå°ä½†å¾ˆå¿«ï¼Œå¹¶ä¸”ç´§é ç€åœ¨ä½¿ç”¨å®ƒçš„ CPU å†…æ ¸ã€‚<br>L2 å¤§ä¸€äº›ï¼Œä¹Ÿæ…¢ä¸€äº›ï¼Œå¹¶ä¸”ä»ç„¶åªèƒ½è¢«ä¸€ä¸ªå•ç‹¬çš„ CPU æ ¸ä½¿ç”¨ã€‚<br>L3 åœ¨ç°ä»£å¤šæ ¸æœºå™¨ä¸­æ›´æ™®éï¼Œä»ç„¶æ›´å¤§ï¼Œæ›´æ…¢ï¼Œå¹¶ä¸”è¢«<code>å•ä¸ªæ’æ§½ä¸Šçš„æ‰€æœ‰ CPU æ ¸å…±äº«</code>ã€‚<br>æœ€åï¼Œä¸»å­˜ä¿å­˜ç€ç¨‹åºè¿è¡Œçš„æ‰€æœ‰æ•°æ®ï¼Œå®ƒæ›´å¤§ï¼Œæ›´æ…¢ï¼Œç”±<code>å…¨éƒ¨æ’æ§½ä¸Šçš„æ‰€æœ‰ CPU æ ¸å…±äº«</code>ã€‚</p>
</blockquote>
<p>å½“ CPU æ‰§è¡Œè¿ç®—çš„æ—¶å€™ï¼Œå®ƒå…ˆå» L1 æŸ¥æ‰¾æ‰€éœ€çš„æ•°æ®ï¼Œå†å» L2ï¼Œç„¶åæ˜¯ L3ï¼Œæœ€åå¦‚æœè¿™äº›ç¼“å­˜ä¸­éƒ½æ²¡æœ‰ï¼Œæ‰€éœ€çš„æ•°æ®å°±è¦å»ä¸»å†…å­˜æ‹¿ã€‚</p>
<p>èµ°å¾—è¶Šè¿œï¼Œè¿ç®—è€—è´¹çš„æ—¶é—´å°±è¶Šé•¿ã€‚</p>
<p>æ‰€ä»¥å¦‚æœè¿›è¡Œä¸€äº›å¾ˆé¢‘ç¹çš„è¿ç®—ï¼Œè¦ç¡®ä¿æ•°æ®åœ¨ L1 ç¼“å­˜ä¸­ã€‚</p>
<h2 id="CPUç¼“å­˜è¡Œ"><a href="#CPUç¼“å­˜è¡Œ" class="headerlink" title="CPUç¼“å­˜è¡Œ"></a>CPUç¼“å­˜è¡Œ</h2><p>ç¼“å­˜æ˜¯ç”±ç¼“å­˜è¡Œç»„æˆçš„ï¼Œé€šå¸¸æ˜¯ 64 å­—èŠ‚ï¼ˆå¸¸ç”¨å¤„ç†å™¨çš„ç¼“å­˜è¡Œæ˜¯ 64 å­—èŠ‚çš„ï¼Œæ¯”è¾ƒæ—§çš„å¤„ç†å™¨ç¼“å­˜è¡Œæ˜¯ 32 å­—èŠ‚ï¼‰ï¼Œå¹¶ä¸”å®ƒæœ‰æ•ˆåœ°å¼•ç”¨ä¸»å†…å­˜ä¸­çš„ä¸€å—åœ°å€ã€‚</p>
<p>ä¸€ä¸ª Java çš„ long ç±»å‹æ˜¯ 8 å­—èŠ‚ï¼Œå› æ­¤åœ¨ä¸€ä¸ªç¼“å­˜è¡Œä¸­å¯ä»¥å­˜ 8 ä¸ª long ç±»å‹çš„å˜é‡ã€‚</p>
<p><img src="/2022/01/20/java/qian-tan-wei-gong-xiang-wen-ti/cpu%E7%BC%93%E5%AD%98%E8%A1%8C.png" alt="cpuç¼“å­˜è¡Œ"></p>
<p>åœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜æ¯æ¬¡æ›´æ–°éƒ½ä»ä¸»å†…å­˜ä¸­åŠ è½½è¿ç»­çš„ 64 ä¸ªå­—èŠ‚ã€‚å› æ­¤ï¼Œå¦‚æœè®¿é—®ä¸€ä¸ª long ç±»å‹çš„æ•°ç»„æ—¶ï¼Œå½“æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­æ—¶ï¼Œå¦å¤– 7 ä¸ªå…ƒç´ ä¹Ÿä¼šè¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„æ•°æ®ç»“æ„ä¸­çš„é¡¹åœ¨å†…å­˜ä¸­ä¸æ˜¯å½¼æ­¤ç›¸é‚»çš„ï¼Œæ¯”å¦‚é“¾è¡¨ï¼Œé‚£ä¹ˆå°†å¾—ä¸åˆ°å…è´¹ç¼“å­˜åŠ è½½å¸¦æ¥çš„å¥½å¤„ã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™ç§å…è´¹åŠ è½½ä¹Ÿæœ‰ä¸€ä¸ªåå¤„ã€‚è®¾æƒ³å¦‚æœæˆ‘ä»¬æœ‰ä¸ª long ç±»å‹çš„å˜é‡ aï¼Œå®ƒä¸æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„å˜é‡ï¼Œå¹¶ä¸”è¿˜æœ‰å¦å¤–ä¸€ä¸ª long ç±»å‹çš„å˜é‡ b ç´§æŒ¨ç€å®ƒï¼Œé‚£ä¹ˆå½“åŠ è½½ a çš„æ—¶å€™å°†å…è´¹åŠ è½½ bã€‚</p>
<p>çœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæ¯›ç—…ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹åœ¨å¯¹ a è¿›è¡Œä¿®æ”¹ï¼Œå¦ä¸€ä¸ª CPU æ ¸å¿ƒçš„çº¿ç¨‹å´åœ¨å¯¹ b è¿›è¡Œè¯»å–ã€‚</p>
<p>å½“å‰è€…ä¿®æ”¹ a æ—¶ï¼Œä¼šæŠŠ a å’Œ b åŒæ—¶åŠ è½½åˆ°å‰è€…æ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­ï¼Œæ›´æ–°å®Œ a åå…¶å®ƒæ‰€æœ‰åŒ…å« a çš„ç¼“å­˜è¡Œéƒ½å°†å¤±æ•ˆï¼Œå› ä¸ºå…¶å®ƒç¼“å­˜ä¸­çš„ a ä¸æ˜¯æœ€æ–°å€¼äº†ã€‚</p>
<p>è€Œå½“åè€…è¯»å– b æ—¶ï¼Œå‘ç°è¿™ä¸ªç¼“å­˜è¡Œå·²ç»å¤±æ•ˆäº†ï¼Œéœ€è¦ä»ä¸»å†…å­˜ä¸­é‡æ–°åŠ è½½ã€‚</p>
<p>è¯·è®°ä½ï¼Œæˆ‘ä»¬çš„ç¼“å­˜éƒ½æ˜¯ä»¥ç¼“å­˜è¡Œä½œä¸ºä¸€ä¸ªå•ä½æ¥å¤„ç†çš„ï¼Œæ‰€ä»¥å¤±æ•ˆ a çš„ç¼“å­˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šæŠŠ b å¤±æ•ˆï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p><img src="/2022/01/20/java/qian-tan-wei-gong-xiang-wen-ti/cpu%E7%BC%93%E5%AD%98%E8%A1%8C-1.png" alt="cpuç¼“å­˜è¡Œ-1"></p>
<p>è¿™æ ·å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œb å’Œ a å®Œå…¨ä¸ç›¸å¹²ï¼Œæ¯æ¬¡å´è¦å› ä¸º a çš„æ›´æ–°éœ€è¦ä»ä¸»å†…å­˜é‡æ–°è¯»å–ï¼Œå®ƒè¢«ç¼“å­˜æœªå‘½ä¸­ç»™æ‹–æ…¢äº†ã€‚</p>
<p>è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„<code>ä¼ªå…±äº«</code>ã€‚</p>
<h2 id="ä½•ä¸ºä¼ªå…±äº«ï¼ˆFalse-Sharingï¼‰"><a href="#ä½•ä¸ºä¼ªå…±äº«ï¼ˆFalse-Sharingï¼‰" class="headerlink" title="ä½•ä¸ºä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰"></a>ä½•ä¸ºä¼ªå…±äº«ï¼ˆFalse Sharingï¼‰</h2><p>ä»ä¸Šé¢æˆ‘ä»¬çš„åŸç†è®²è§£ä¸­ï¼Œå¯¹<code>ä¼ªå…±äº«</code>æœ‰äº†ç†æ€§çš„è®¤è¯†ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆç»™<code>ä¼ªå…±äº«</code>ä¸‹ä¸ªå®šä¹‰ï¼š</p>
<blockquote>
<p>å½“å¤šçº¿ç¨‹ä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šæ— æ„ä¸­å½±å“å½¼æ­¤çš„æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­æ¥çœ‹â€ä¼ªå…±äº«â€äº§ç”Ÿçš„ä½œç”¨ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">public class FalseSharingTest &#123;  
    public static void main(String[] args) throws InterruptedException &#123;  
        testPointer(new Pointer());  
    &#125;  

    private static void testPointer(Pointer pointer) throws InterruptedException &#123;  
        long start &#x3D; System.currentTimeMillis();  
        Thread t1 &#x3D; new Thread(() -&gt; &#123;  
            for (int i &#x3D; 0; i &lt; 100000000; i++) &#123;  
                pointer.x++;  
            &#125;  
        &#125;);  
        Thread t2 &#x3D; new Thread(() -&gt; &#123;  
            for (int i &#x3D; 0; i &lt; 100000000; i++) &#123;  
                pointer.y++;  
            &#125;  
        &#125;);  
        tstart();  
        tstart();  
        tjoin();  
        tjoin();  
        System.out.println(System.currentTimeMillis() - start);  
        System.out.println(&quot;x: &quot;+pointer.x);  
        System.out.println(&quot;y: &quot;+pointer.y);  
    &#125;  
&#125;  

class Pointer &#123;  
    volatile long x;  
    volatile long y;  
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª Pointer çš„ç±»ï¼Œå®ƒåŒ…å« x å’Œ y ä¸¤ä¸ªå˜é‡ï¼ˆå¿…é¡»å£°æ˜ä¸ºvolatileï¼Œä¿è¯å¯è§æ€§ï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ x è¿›è¡Œè‡ªå¢1äº¿æ¬¡ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ y è¿›è¡Œè‡ªå¢1äº¿æ¬¡ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œx å’Œ y å®Œå…¨æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä½†æ˜¯æ›´æ–° x çš„æ—¶å€™ä¼šæŠŠå…¶å®ƒåŒ…å« x çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼ŒåŒæ—¶ä¹Ÿå°±å¤±æ•ˆäº† yï¼Œè¿è¡Œè¿™æ®µç¨‹åºè¾“å‡ºçš„æ—¶é—´ä¸º <code>3458ms</code>ã€‚</p>
<p>è¿è¡Œç»“æœï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">3458  
x: 100000000  
y: 100000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>è¿è¡Œäº†å¤šæ¬¡ï¼Œç»“æœéƒ½æ˜¯åœ¨3000mså·¦å³ã€‚</p>
<p>è™½ç„¶ä»è¿™ä¸ªæ—¶é—´ä¸Šæˆ‘ä»¬å¥½åƒçœ‹ä¸å‡ºæ¥æœ‰ä»€ä¹ˆä¼ªå…±äº«çš„é—®é¢˜ï¼Œæ— éå¯èƒ½æœ‰ç‚¹æ…¢è€Œå·²ï¼Œä½†æˆ‘ä»¬æ²¡æœ‰åˆ«çš„è¯æ®ã€‚åˆ«æ€¥ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼šæœ‰ç­”æ¡ˆçš„ã€‚</p>
<h2 id="é¿å…ä¼ªå…±äº«"><a href="#é¿å…ä¼ªå…±äº«" class="headerlink" title="é¿å…ä¼ªå…±äº«"></a>é¿å…ä¼ªå…±äº«</h2><p>ä¼ªå…±äº«çš„åŸç†æˆ‘ä»¬çŸ¥é“äº†ï¼Œä¸€ä¸ªç¼“å­˜è¡Œæ˜¯ 64 ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ª long ç±»å‹æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥é¿å…ä¼ªå…±äº«ä¹Ÿå¾ˆç®€å•ï¼Œå¤§æ¦‚æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ã€‚</p>
<h2 id="æ–¹æ³•ä¸€-å¡«å……-Padding"><a href="#æ–¹æ³•ä¸€-å¡«å……-Padding" class="headerlink" title="æ–¹æ³•ä¸€ å¡«å……(Padding)"></a>æ–¹æ³•ä¸€ å¡«å……(Padding)</h2><p>é¡¾åæ€ä¹‰ï¼Œå¡«å……çš„æ€æƒ³å°±æ˜¯åœ¨ä¸¤ä¸ªå˜é‡ä¹‹é—´å¡«å……åˆ°64ä¸ªå­—èŠ‚ï¼ŒæŠŠç¬¬äºŒä¸ªå˜é‡æŒ¤åˆ°ä¸‹ä¸€ä¸ªç¼“å­˜è¡Œã€‚</p>
<p>æˆ‘ä»¬çš„ä¾‹å­ä¸­åœ¨ä¸¤ä¸ª long ç±»å‹çš„å˜é‡ä¹‹é—´å†åŠ  7 ä¸ª long ç±»å‹ï¼ŒæŠŠPointeræ”¹æˆä¸‹é¢çš„ç»“æ„ä¹‹åï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">class Pointer &#123;  
    volatile long x;  
    long p1, p2, p3, p4, p5, p6, p7;  
    volatile long y;  
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‘ç°æ—¶é—´ç¥å¥‡çš„ç¼©çŸ­äº†4åˆ†ä¹‹ä¸€ï¼Œå¤šæ¬¡è¯•éªŒï¼Œå¤§æ¦‚éƒ½åœ¨800mså·¦å³ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">720  
x: 100000000  
y: 100000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>è¿™ä¸ªç»“æœä¹Ÿå……åˆ†è¯æ˜äº†<code>ä¼ªå…±äº«</code>çš„å­˜åœ¨ã€‚</p>
<p><code>æ³¨æ„</code>ï¼šåœ¨è€ƒè™‘ä½¿ç”¨å¡«å……ä¹‹å‰ï¼Œå¿…é¡»è¦äº†è§£çš„ä¸€ç‚¹æ˜¯JVMå¯èƒ½ä¼šæ¸…é™¤æ— ç”¨å­—æ®µæˆ–é‡æ’æ— ç”¨å­—æ®µçš„ä½ç½®ï¼Œè¿™æ ·çš„è¯ï¼Œå¯èƒ½æ— å½¢ä¸­åˆä¼šå¼•å…¥ä¼ªå…±äº«ã€‚æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ³•æŒ‡å®šå¯¹è±¡åœ¨å †å†…é©»ç•™çš„ä½ç½®ã€‚</p>
<h2 id="æ–¹æ³•äºŒ-è‡ªå·±åˆ›å»ºå¯¹è±¡"><a href="#æ–¹æ³•äºŒ-è‡ªå·±åˆ›å»ºå¯¹è±¡" class="headerlink" title="æ–¹æ³•äºŒ è‡ªå·±åˆ›å»ºå¯¹è±¡"></a>æ–¹æ³•äºŒ è‡ªå·±åˆ›å»ºå¯¹è±¡</h2><p>æˆ‘ä»¬å°è¯•ä½¿ç”¨å¦å¤–ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬é‡æ–°åˆ›å»ºè‡ªå·±çš„longç±»å‹ï¼Œè€Œä¸æ˜¯Javaè‡ªå¸¦çš„longï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">class Pointer &#123;  
    MyLong x&#x3D;new MyLong();  
    MyLong y&#x3D;new MyLong();  
&#125;  

class MyLong&#123;  
    volatile long value;  
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åŒæ—¶æŠŠ <code>pointer.x++;</code> ä¿®æ”¹ä¸º <code>pointer.x.value++;</code>ï¼ŒæŠŠ <code>pointer.y++;</code> ä¿®æ”¹ä¸º <code>pointer.y.value++;</code>ï¼Œå†æ¬¡è¿è¡Œç¨‹åºå‘ç°æ—¶é—´æ˜¯ <code>752ms</code>ã€‚<br>å¯ä»¥çœ‹åˆ°ä¹Ÿè§£å†³äº†ä¼ªå…±äº«é—®é¢˜ã€‚</p>
<h2 id="æ–¹æ³•ä¸‰-ä½¿ç”¨-sun-misc-Contended-æ³¨è§£ï¼ˆjava8ï¼‰"><a href="#æ–¹æ³•ä¸‰-ä½¿ç”¨-sun-misc-Contended-æ³¨è§£ï¼ˆjava8ï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ ä½¿ç”¨ @sun.misc.Contended æ³¨è§£ï¼ˆjava8ï¼‰"></a>æ–¹æ³•ä¸‰ ä½¿ç”¨ @sun.misc.Contended æ³¨è§£ï¼ˆjava8ï¼‰</h2><p>é™¤äº†å¯¹å­—æ®µè¿›è¡Œå¡«å……ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…çˆ½çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯å¯¹éœ€è¦é¿å…é™·å…¥ä¼ªå…±äº«çš„å­—æ®µè¿›è¡Œæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£æš—ç¤ºJVMåº”å½“å°†å­—æ®µæ”¾å…¥ä¸åŒçš„ç¼“å­˜è¡Œã€‚</p>
<p>å¦‚ä¸‹æ·»åŠ @Contendedæ³¨è§£ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">import sun.misc.Contended;  
class Pointer &#123;  
   @Contended  
   volatile long x;  

   volatile long y;  
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é»˜è®¤ä½¿ç”¨è¿™ä¸ªæ³¨è§£æ˜¯æ— æ•ˆçš„ï¼Œéœ€è¦åœ¨JVMå¯åŠ¨å‚æ•°åŠ ä¸Š <code>-XX:-RestrictContended</code>æ‰ä¼šç”Ÿæ•ˆï¼š</p>
<p>å†æ¬¡è¿è¡Œç¨‹åºå‘ç°æ—¶é—´æ˜¯ 749msï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">749  
x: 100000000  
y: 100000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼šå¼•å…¥äº†<code>@Contented</code>æ³¨è§£ï¼Œè¢«è¿™ä¸ªæ³¨è§£ä¿®é¥°çš„å­—æ®µåº”å½“å’Œå…¶ä»–çš„å­—æ®µé©»ç•™åœ¨ä¸åŒçš„ä½ç½®ã€‚ä¸Šé¢çš„ä»£ç å°†xå’Œyç½®äºä¸åŒçš„ç¼“å­˜è¡Œã€‚@Contentedæ³¨è§£å°†yç§»åŠ¨åˆ°è¿œç¦»å¯¹è±¡å¤´éƒ¨çš„åœ°æ–¹ï¼Œ(ä»¥é¿å…å’Œxä¸€èµ·è¢«åŠ è½½åˆ°åŒä¸€ä¸ªç¼“å­˜è¡Œ)ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<p>æ‚è°ˆ ä»€ä¹ˆæ˜¯ä¼ªå…±äº«ï¼ˆfalse sharingï¼‰ï¼Ÿ ï¼ˆæ³¨ï¼šè¿™ç¯‡æ–‡ç« ä¸­çš„é¿å…ä¼ªå…±äº«çš„æ–¹æ¡ˆä¸­çš„ä»£ç åŠè§£é‡Šæœ‰è¯¯ï¼Œæœ¬æ–‡å·²çº æ­£ï¼‰<br>Java8ä¸­@Contendedå’Œä¼ªå…±äº«</p>
</blockquote>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ï¼ˆ1ï¼‰CPUå…·æœ‰å¤šçº§ç¼“å­˜ï¼Œè¶Šæ¥è¿‘CPUçš„ç¼“å­˜è¶Šå°ä¹Ÿè¶Šå¿«ï¼›</p>
<p>ï¼ˆ2ï¼‰CPUç¼“å­˜ä¸­çš„æ•°æ®æ˜¯ä»¥ç¼“å­˜è¡Œä¸ºå•ä½å¤„ç†çš„ï¼›</p>
<p>ï¼ˆ3ï¼‰CPUç¼“å­˜è¡Œèƒ½å¸¦æ¥å…è´¹åŠ è½½æ•°æ®çš„å¥½å¤„ï¼Œæ‰€ä»¥å¤„ç†æ•°ç»„æ€§èƒ½éå¸¸é«˜ï¼›</p>
<p>ï¼ˆ4ï¼‰CPUç¼“å­˜è¡Œä¹Ÿå¸¦æ¥äº†å¼Šç«¯ï¼Œå¤šçº¿ç¨‹å¤„ç†ä¸ç›¸å¹²çš„å˜é‡æ—¶ä¼šç›¸äº’å½±å“ï¼Œä¹Ÿå°±æ˜¯ä¼ªå…±äº«ï¼›</p>
<p>ï¼ˆ5ï¼‰é¿å…ä¼ªå…±äº«çš„ä¸»è¦æ€è·¯å°±æ˜¯è®©ä¸ç›¸å¹²çš„å˜é‡ä¸è¦å‡ºç°åœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼Œå¸¸è§çš„æœ‰å¡«å……ã€åˆ›å»ºè‡ªå·±çš„å˜é‡ã€ä½¿ç”¨æ³¨è§£ä¸‰ç§æ–¹å¼é¿å…ä¼ªå…±äº«ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>ä¼ªå…±äº«</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ·é‡ä¸šåŠ¡æ•°æ®åŠ è§£å¯†æ–¹æ¡ˆçš„è½åœ°ä¸å®è·µ</title>
    <url>/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>æ ¹æ®æ•°æ®å®‰å…¨è§„èŒƒä¸æ ‡å‡†åŠä¼ä¸šåˆæ³•åˆè§„è¿è¥ï¼Œä¸šåŠ¡ç³»ç»Ÿéœ€è¦å¯¹æµ·é‡çš„ä¸šåŠ¡æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨ã€‚</p>
<h2 id="1-1-ä¸šåŠ¡æ•°æ®çš„å®‰å…¨æ€§è¦æ±‚"><a href="#1-1-ä¸šåŠ¡æ•°æ®çš„å®‰å…¨æ€§è¦æ±‚" class="headerlink" title="1.1 ä¸šåŠ¡æ•°æ®çš„å®‰å…¨æ€§è¦æ±‚"></a>1.1 ä¸šåŠ¡æ•°æ®çš„å®‰å…¨æ€§è¦æ±‚</h2><ul>
<li>æ•æ„Ÿä¸šåŠ¡æ•°æ®éœ€è¦åŠ å¯†å­˜å‚¨</li>
<li>æ•°æ®æŸ¥è¯¢éœ€è¦è¿›è¡Œè§£å¯†</li>
<li>åŠ å¯†æ•°æ®çš„å¯†é’¥æ”¯æŒå®šæœŸè½®æ¢</li>
</ul>
<h1 id="äºŒã€æ–¹æ¡ˆé¢„ç ”"><a href="#äºŒã€æ–¹æ¡ˆé¢„ç ”" class="headerlink" title="äºŒã€æ–¹æ¡ˆé¢„ç ”"></a>äºŒã€æ–¹æ¡ˆé¢„ç ”</h1><p>å¯¹äºä¸Šè¿°ä¸šåŠ¡æ•°æ®çš„åŠ å¯†è¦æ±‚ï¼Œä¸€èˆ¬é‡‡ç”¨åŠ å¯†æ€§èƒ½è¾ƒé«˜çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¦‚ï¼šAESã€å›½å¯†SM4ç­‰ã€‚ç³»ç»Ÿçš„æ•°æ®åŠ è§£å¯†åŠå¯†é’¥çš„ç®¡ç†åŠå®šæœŸè½®æ¢ï¼Œè¡Œä¸šå†…ä¸€èˆ¬æ˜¯é‡‡ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆKey Management Serviceï¼Œç®€ç§°KMSï¼‰æ¥è§£å†³ï¼Œä¸‹é¢æˆ‘ä»¬å°±é¢„ç ”ä¸€ä¸‹KMSçš„ä½¿ç”¨ã€‚</p>
<h2 id="2-1-å¯†é’¥ç®¡ç†æœåŠ¡KMS"><a href="#2-1-å¯†é’¥ç®¡ç†æœåŠ¡KMS" class="headerlink" title="2.1 å¯†é’¥ç®¡ç†æœåŠ¡KMS"></a>2.1 å¯†é’¥ç®¡ç†æœåŠ¡KMS</h2><p>å¯†é’¥ç®¡ç†ï¼Œå³å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆKey Management Serviceï¼ŒKMSï¼‰ï¼Œæ˜¯ä¸€ç§å®‰å…¨ã€å¯é ã€ç®€å•æ˜“ç”¨çš„å¯†é’¥æ‰˜ç®¡æœåŠ¡ï¼Œå¸®åŠ©æ‚¨è½»æ¾åˆ›å»ºå’Œç®¡ç†å¯†é’¥ï¼Œä¿æŠ¤å¯†é’¥çš„å®‰å…¨ã€‚</p>
<p>KMSé€šè¿‡ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ¨¡å—HSMï¼ˆHardware Security Moduleï¼‰ä¿æŠ¤å¯†é’¥çš„å®‰å…¨ï¼Œæ‰€æœ‰çš„ç”¨æˆ·å¯†é’¥éƒ½ç”±HSMä¸­çš„æ ¹å¯†é’¥ä¿æŠ¤ï¼Œé¿å…å¯†é’¥æ³„éœ²ã€‚</p>
<p>KMSå¯¹å¯†é’¥çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šè¿›è¡Œè®¿é—®æ§åˆ¶åŠæ—¥å¿—è·Ÿè¸ªï¼Œæä¾›æ‰€æœ‰å¯†é’¥çš„ä½¿ç”¨è®°å½•ï¼Œæ»¡è¶³å®¡è®¡å’Œåˆè§„æ€§è¦æ±‚ã€‚</p>
<h2 id="2-2-KMSæœåŠ¡é€‰å‹"><a href="#2-2-KMSæœåŠ¡é€‰å‹" class="headerlink" title="2.2 KMSæœåŠ¡é€‰å‹"></a>2.2 KMSæœåŠ¡é€‰å‹</h2><p>å¯†é’¥ç®¡ç†æœåŠ¡ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ¨¡å—HSMï¼ˆHardware Security Moduleï¼‰ä¿æŠ¤å¯†é’¥çš„å®‰å…¨ï¼Œä¼ä¸šå†…éƒ¨å¦‚æœæ˜¯è¦è‡ªå·±æ­å»ºå¯†é’¥ç®¡ç†æœåŠ¡ï¼Œåˆ™éœ€è¦é‡‡è´­ä¸“ä¸šçš„ç¡¬ä»¶è®¾å¤‡è¿›è¡Œæ­å»ºã€‚å¯¹äºæ²¡æœ‰ä¸“ä¸šçš„å®‰å…¨å›¢é˜Ÿçš„å…¬å¸ï¼Œé€‰æ‹©äº‘å‚å•†æä¾›çš„KMSæœåŠ¡æ˜¯ä¸€ä¸ªæ›´åŠ é«˜æ•ˆä¾¿æ·çš„é€”å¾„ã€‚</p>
<p>ç›®å‰æä¾›KMSäº‘æœåŠ¡èƒ½åŠ›çš„å‚å•†ï¼š</p>
<ul>
<li><a href="https://www.aliyun.com/product/kms">é˜¿é‡Œäº‘KMS</a></li>
<li><a href="https://www.huaweicloud.com/product/dew.html?utm_source=3.baidu.com&utm_medium=organic&utm_adplace=kapian">åä¸ºäº‘DEW</a></li>
<li><a href="https://cloud.tencent.com/product/kms">è…¾è®¯äº‘KMS</a></li>
<li><a href="https://aws.amazon.com/cn/kms/">äºšé©¬é€ŠKMS</a></li>
<li><a href="https://cloud.google.com/kms/docs/key-management-service?hl=zh-cn">è°·æ­ŒKMS</a></li>
</ul>
<p>ä¸Šè¿°äº‘å‚å•†æä¾›çš„KMSæœåŠ¡èƒ½åŠ›åŸºæœ¬ç›¸åŒï¼Œä»‹äºä¼ä¸šå†…éƒ¨ä½¿ç”¨åä¸ºäº‘ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºåä¸ºäº‘KMSçš„æµ·é‡ä¸šåŠ¡æ•°æ®åŠ å¯†åœºæ™¯çš„è½åœ°ã€‚</p>
<h1 id="ä¸‰ã€åä¸ºäº‘KMSç®€ä»‹"><a href="#ä¸‰ã€åä¸ºäº‘KMSç®€ä»‹" class="headerlink" title="ä¸‰ã€åä¸ºäº‘KMSç®€ä»‹"></a>ä¸‰ã€åä¸ºäº‘KMSç®€ä»‹</h1><p>åä¸ºäº‘æä¾›ç»Ÿä¸€ç®¡ç†å¯†é’¥ã€æ•æ„Ÿæ•°æ®åŠ å¯†ã€åä¸ºäº‘æœåŠ¡åŠ å¯†ã€æ•°æ®æ•°å­—ç­¾åã€å®‰å…¨åˆè§„(PCI-DSSã€ç­‰ä¿ç­‰)ç­‰èƒ½åŠ›ã€‚</p>
<h2 id="3-1-åŠŸèƒ½æ€»è§ˆ"><a href="#3-1-åŠŸèƒ½æ€»è§ˆ" class="headerlink" title="3.1 åŠŸèƒ½æ€»è§ˆ"></a>3.1 åŠŸèƒ½æ€»è§ˆ</h2><table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>å¯†é’¥ç®¡ç†</td>
<td>å¯†é’¥ç®¡ç†ï¼Œå³å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆKey Management Serviceï¼ŒKMSï¼‰ï¼Œæ˜¯ä¸€ç§å®‰å…¨ã€å¯é ã€ç®€å•æ˜“ç”¨çš„å¯†é’¥æ‰˜ç®¡æœåŠ¡ï¼Œå¸®åŠ©æ‚¨è½»æ¾åˆ›å»ºå’Œç®¡ç†å¯†é’¥ï¼Œä¿æŠ¤å¯†é’¥çš„å®‰å…¨ã€‚ <br>KMSé€šè¿‡ä½¿ç”¨ç¡¬ä»¶å®‰å…¨æ¨¡å—HSMï¼ˆHardware Security Moduleï¼‰ä¿æŠ¤å¯†é’¥çš„å®‰å…¨ï¼Œæ‰€æœ‰çš„ç”¨æˆ·å¯†é’¥éƒ½ç”±HSMä¸­çš„æ ¹å¯†é’¥ä¿æŠ¤ï¼Œé¿å…å¯†é’¥æ³„éœ²ã€‚</td>
</tr>
<tr>
<td>åˆ›å»ºå¯†é’¥</td>
<td>ç”¨æˆ·ä¸»å¯†é’¥æœ‰å¯†é’¥å…ƒæ•°æ®ï¼ˆå¯†é’¥IDã€å¯†é’¥åˆ«åã€æè¿°ã€å¯†é’¥çŠ¶æ€ä¸åˆ›å»ºæ—¥æœŸï¼‰å’Œç”¨äºåŠ è§£å¯†æ•°æ®çš„å¯†é’¥ææ–™ã€‚ <br> ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ§åˆ¶å°åˆ›å»ºå¯†é’¥ï¼Œè¯¥å¯†é’¥ä¼šè‡ªåŠ¨ç”Ÿæˆå¯†é’¥ææ–™ã€‚</td>
</tr>
<tr>
<td>å¯†é’¥å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</td>
<td>ç”¨æˆ·å¯ä»¥é€šè¿‡å¯†é’¥ç®¡ç†ç•Œé¢ï¼Œå¯¹ç”¨æˆ·ä¸»å¯†é’¥è¿›è¡Œå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ï¼ˆå¯ç”¨ã€ç¦ç”¨ã€åˆ é™¤ï¼‰</td>
</tr>
<tr>
<td>æ•°æ®åŠ è§£å¯†</td>
<td>å½“æœ‰å°‘é‡æ•°æ®ï¼ˆä¾‹å¦‚ï¼šå£ä»¤ã€è¯ä¹¦ã€ç”µè¯å·ç ç­‰ï¼‰éœ€è¦åŠ è§£å¯†æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆKey Management Serviceï¼ŒKMSï¼‰ç•Œé¢ä½¿ç”¨åœ¨çº¿å·¥å…·åŠ è§£å¯†æ•°æ®ï¼Œæˆ–è€…è°ƒç”¨KMSçš„APIæ¥å£ä½¿ç”¨æŒ‡å®šçš„ç”¨æˆ·ä¸»å¯†é’¥ç›´æ¥åŠ å¯†ã€è§£å¯†æ•°æ®ã€‚ <br> å½“æœ‰å¤§é‡æ•°æ®ï¼ˆä¾‹å¦‚ï¼šç…§ç‰‡ã€è§†é¢‘æˆ–è€…æ•°æ®åº“æ–‡ä»¶ç­‰ï¼‰éœ€è¦åŠ è§£å¯†æ—¶ï¼Œç”¨æˆ·å¯é‡‡ç”¨<font color="red">ä¿¡å°åŠ å¯†</font>æ–¹å¼åŠ è§£å¯†æ•°æ®ï¼Œæ— éœ€é€šè¿‡ç½‘ç»œä¼ è¾“å¤§é‡æ•°æ®å³å¯å®Œæˆæ•°æ®åŠ è§£å¯†ã€‚</td>
</tr>
<tr>
<td>å¯†é’¥è½®æ¢</td>
<td>å¹¿æ³›é‡å¤çš„ä½¿ç”¨åŠ å¯†å¯†é’¥ï¼Œä¼šå¯¹åŠ å¯†å¯†é’¥çš„å®‰å…¨é€ æˆé£é™©ã€‚ä¸ºäº†ç¡®ä¿åŠ å¯†å¯†é’¥çš„å®‰å…¨æ€§ï¼Œå»ºè®®æ‚¨å®šæœŸè½®æ¢å¯†é’¥ï¼Œæ›´æ”¹åŸå¯†é’¥çš„å¯†é’¥ææ–™ã€‚ <br> å¼€é€šå¯†é’¥è½®è½¬åï¼Œä¼šæ”¶å–ç›¸åº”çš„å¯†é’¥å­˜å‚¨è´¹ç”¨ï¼Œæ¯ä¸ªè½®è½¬çš„ç‰ˆæœ¬å°†ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ä¸»å¯†é’¥èµ„æºè¿›è¡Œè®¡ç®—ã€‚</td>
</tr>
<tr>
<td>ä¸“å±å¯†é’¥åº“</td>
<td>KMSé€šè¿‡ä¸“å±å¯†é’¥åº“æ”¯æŒHYOKåŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å®Œå…¨è‡ªä¸»å¯æ§åä¸‹çš„ç”¨æˆ·ä¸»å¯†é’¥ï¼Œç”¨æˆ·ä¸»å¯†é’¥ä¸è„±ç¦»åŠ å¯†æœºï¼Œå¹¶ä¸”å¯†ç è¿ç®—å®Œå…¨åœ¨åŠ å¯†æœºä¸­å®Œæˆã€‚ <br> è¯´æ˜ï¼šåœ¨å¤–éƒ¨å¯†é’¥å­˜å‚¨ä¸­ä½¿ç”¨ KMS å¯†é’¥çš„åŠ å¯†å’Œè§£å¯†æ“ä½œï¼Œç”±æ‚¨çš„å¤–éƒ¨å¯†é’¥ç®¡ç†å™¨ä½¿ç”¨åŠ å¯†å¯†é’¥ææ–™æ‰§è¡Œï¼Œè¯¥åŠŸèƒ½ç§°ä¸ºæŒæœ‰è‡ªå·±çš„å¯†é’¥ï¼ˆHYOKï¼‰ã€‚</td>
</tr>
<tr>
<td>ç­¾åéªŒç­¾</td>
<td>ç­¾åéªŒç­¾æ˜¯ä¸€ç§åŠ å¯†æœºåˆ¶ï¼Œæ˜¯ä¿è¯æ•°æ®ä¼ è¾“å®‰å…¨æ€§ä»¥åŠå®Œæ•´æ€§çš„é‡è¦æ‰‹æ®µã€‚<br> é€šè¿‡ç­¾åéªŒç­¾çš„æ–¹å¼ï¼Œå¯ä»¥é˜²æ­¢ä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹æˆ–ä¼ªé€ ã€‚</td>
</tr>
<tr>
<td>å¯†é’¥æˆæƒ</td>
<td>ç”¨æˆ·å¯ä»¥ä¸ºå…¶ä»–IAMç”¨æˆ·æˆ–è´¦å·åˆ›å»ºæˆæƒï¼Œæˆäºˆå…¶ä½¿ç”¨è‡ªèº«çš„è‡ªå®šä¹‰å¯†é’¥çš„æƒé™ã€‚è¢«æˆæƒç”¨æˆ·å¯ä»¥é€šè¿‡è°ƒç”¨APIæ¥å£ï¼Œå³å¯ä½¿ç”¨è¢«æˆæƒçš„æƒé™ã€‚ <br> ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆæƒç”¨æˆ·å¯ä»¥é€šè¿‡å¯†é’¥ç®¡ç†ç•Œé¢æ’¤é”€æˆæƒï¼š<br>  Â· å½“è¢«æˆæƒç”¨æˆ·ä¸å†ä½¿ç”¨æˆæƒç”¨æˆ·çš„è‡ªå®šä¹‰å¯†é’¥æ—¶ï¼Œè¢«æˆæƒç”¨æˆ·å¯å‘ŠçŸ¥æˆæƒç”¨æˆ·æ’¤é”€æˆæƒï¼Œæˆ–è€…é€šè¿‡APIæ¥å£ç›´æ¥é€€å½¹æˆæƒã€‚ <br> Â·  å½“æˆæƒç”¨æˆ·æƒ³æ”¶å›è‡ªå®šä¹‰å¯†é’¥çš„æ“ä½œæƒé™æ—¶ï¼Œæˆæƒç”¨æˆ·å¯å¼ºåˆ¶æ’¤é”€æˆæƒã€‚</td>
</tr>
<tr>
<td>å¯†é’¥åŒºåŸŸæ€§</td>
<td>KMSé€šè¿‡å¯†é’¥åŒºåŸŸæ€§ï¼Œå®ç°å¯†é’¥è·¨åŒºåŸŸä½¿ç”¨ã€‚æ¯ç»„ç”¨æˆ·ä¸»å¯†é’¥ä¸å‰¯æœ¬å¯†é’¥å…·æœ‰ç›¸åŒçš„å¯†é’¥ææ–™ï¼Œå³å¯ä»¥å®ç°åœ¨ä¸åŒåŒºåŸŸçš„å¯†é’¥å…±äº«ã€‚<br>  Â·Â åˆ›å»ºå‰¯æœ¬å¯†é’¥ <br> Â·Â ä½¿ç”¨å‰¯æœ¬å¯†é’¥</td>
</tr>
</tbody></table>
<h2 id="3-2-ä¿¡å°åŠ å¯†æœ¯è¯­è¯´æ˜ï¼ˆè°·æ­ŒKMSï¼‰"><a href="#3-2-ä¿¡å°åŠ å¯†æœ¯è¯­è¯´æ˜ï¼ˆè°·æ­ŒKMSï¼‰" class="headerlink" title="3.2 ä¿¡å°åŠ å¯†æœ¯è¯­è¯´æ˜ï¼ˆè°·æ­ŒKMSï¼‰"></a>3.2 ä¿¡å°åŠ å¯†æœ¯è¯­è¯´æ˜ï¼ˆ<a href="https://cloud.google.com/kms/docs/envelope-encryption?hl=zh-cn">è°·æ­ŒKMS</a>ï¼‰</h2><p>å¯¹äºæµ·é‡çš„ä¸šåŠ¡æ•°æ®åŠ è§£å¯†åœºæ™¯ï¼Œé‡‡ç”¨ä¿¡å°åŠ å¯†çš„æ–¹å¼å¯¹ä¸šåŠ¡è¿›è¡ŒåŠ å¯†ï¼Œä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹ä½•ä¸ºä¿¡å°åŠ å¯†ã€‚</p>
<div class="note success no-icon flat"><h3 id="æ•°æ®åŠ å¯†å¯†é’¥ï¼ˆDEKï¼‰"><a href="#æ•°æ®åŠ å¯†å¯†é’¥ï¼ˆDEKï¼‰" class="headerlink" title="æ•°æ®åŠ å¯†å¯†é’¥ï¼ˆDEKï¼‰"></a>æ•°æ®åŠ å¯†å¯†é’¥ï¼ˆDEKï¼‰</h3><p>ç”¨äºåŠ å¯†æ•°æ®å¯†é’¥æœ¬èº«ç§°ä¸ºæ•°æ®åŠ å¯†å¯†é’¥ (Data Encryption Keyï¼Œ ç®€ç§°DEK)ã€‚<br>ä»¥ä¸‹æ˜¯ç®¡ç† DEK çš„æœ€ä½³åšæ³•ï¼š</p>
<ul>
<li>åœ¨æœ¬åœ°ç”Ÿæˆ DEKã€‚</li>
<li>å­˜å‚¨æ—¶ï¼Œå§‹ç»ˆç¡®ä¿ DEK è¿›è¡Œé™æ€åŠ å¯†ã€‚</li>
<li>ä¸ºä¾¿äºè®¿é—®ï¼Œ<strong>è¯·å°† DEK å­˜å‚¨åœ¨ç”¨å…¶è¿›è¡ŒåŠ å¯†çš„æ•°æ®é™„è¿‘</strong>ã€‚</li>
<li>æ¯æ¬¡å†™å…¥æ•°æ®æ—¶å‡ç”Ÿæˆä¸€ä¸ªæ–°çš„ DEKã€‚è¿™æ„å‘³ç€æ‚¨æ— éœ€è½®æ›¿ DEKã€‚</li>
<li>è¯·å‹¿ä½¿ç”¨ç›¸åŒçš„ DEK æ¥åŠ å¯†æ¥è‡ªä¸¤ä¸ªä¸åŒç”¨æˆ·çš„æ•°æ®ã€‚</li>
<li>åœ¨ä¼½ç½—ç“¦è®¡æ•°å™¨æ¨¡å¼ (GCM) ä¸­ä½¿ç”¨å¼ºå¤§çš„ç®—æ³•ï¼ˆå¦‚ 256 ä½é«˜çº§åŠ å¯†æ ‡å‡† (AES)ï¼‰ã€‚</li>
</ul>
</div>

<div class="note success no-icon flat"><h3 id="å¯†é’¥åŠ å¯†å¯†é’¥ï¼ˆKEKï¼‰"><a href="#å¯†é’¥åŠ å¯†å¯†é’¥ï¼ˆKEKï¼‰" class="headerlink" title="å¯†é’¥åŠ å¯†å¯†é’¥ï¼ˆKEKï¼‰"></a>å¯†é’¥åŠ å¯†å¯†é’¥ï¼ˆKEKï¼‰</h3><p>DEK ä½¿ç”¨â€œå¯†é’¥åŠ å¯†å¯†é’¥â€(Key Encryption Keyï¼Œ ç®€ç§°KEK) è¿›è¡ŒåŠ å¯†ï¼ˆä¹Ÿç§°ä¸ºâ€œå°è£…â€ï¼‰ã€‚ ç”¨å¦ä¸€ä¸ªå¯†é’¥å¯¹å¯†é’¥è¿›è¡ŒåŠ å¯†çš„è¿‡ç¨‹ç§°ä¸ºâ€œä¿¡å°åŠ å¯†â€ã€‚<br><em><strong>è¯´æ˜ï¼š KEKæ˜¯è°·æ­Œçš„å‘½åæ–¹å¼ï¼Œåä¸ºäº‘çš„å‘½åæ˜¯CMKï¼ˆCustomer Master Keyï¼‰ï¼Œæ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚</strong></em><br>ä»¥ä¸‹æ˜¯ç®¡ç† DEK çš„æœ€ä½³åšæ³•ï¼š</p>
<ul>
<li>é›†ä¸­å­˜å‚¨ KEKã€‚</li>
<li>æ ¹æ®ç”¨ä¾‹åŠ å¯†è®¾ç½® KEK åŠ å¯†çš„ DEK çš„ç²’åº¦ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘éœ€è¦å¤šä¸ª DEK æ¥åŠ å¯†å…¶æ•°æ®åŒºå—çš„å·¥ä½œè´Ÿè½½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å•ä¸ª KEK æ¥å°è£…è´Ÿè´£è¯¥å·¥ä½œè´Ÿè½½åŠ å¯†çš„æ‰€æœ‰ DEKã€‚</li>
<li>å®šæœŸæˆ–å¯ç–‘äº‹ä»¶å‘ç”Ÿåè½®æ›¿å¯†é’¥ã€‚</li>
</ul>
</div>

<div class="note success no-icon flat"><h3 id="å¹³è¡¡-DEK-å’Œ-KEK"><a href="#å¹³è¡¡-DEK-å’Œ-KEK" class="headerlink" title="å¹³è¡¡ DEK å’Œ KEK"></a>å¹³è¡¡ DEK å’Œ KEK</h3><p>é€šè¿‡è®© KEK çš„æ•°é‡å°‘äº DEK å¹¶ä¸”ä½¿ç”¨é›†ä¸­å¼å¯†é’¥ç®¡ç†æœåŠ¡ï¼Œæˆ‘ä»¬å¾—ä»¥è®©å¤§è§„æ¨¡çš„æ•°æ®å­˜å‚¨å’ŒåŠ å¯†å·¥ä½œå˜å¾—æ›´åŠ åˆ‡å®å¯è¡Œã€‚ä¸­å¤®å¯†é’¥æœåŠ¡è¿˜å¯ä»¥ä½œä¸ºä¸€ä¸ªç‚¹ï¼Œç”¨äºæ›´è½»æ¾åœ°å®¡æ ¸å’Œé™åˆ¶æ•°æ®è®¿é—®ã€‚</p>
<p>æ ¹æ®æ‚¨çš„æƒ…å†µå’Œè¦åŠ å¯†çš„æ•°æ®é‡ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨ç±»ä¼¼çš„æ¨¡å‹ã€‚å•ä¸ª KEK å¯ç”¨äºä¿æŠ¤è®¸å¤š DEKï¼›è¯¥æ¨¡å‹å…è®¸å„ä¸ªæ•°æ®å¯¹è±¡å„è‡ªæ‹¥æœ‰è‡ªå·±çš„ DEKï¼Œè€Œä¸ä¼šå¤§é‡å¢åŠ å­˜å‚¨åœ¨ä¸­å¤®å¯†é’¥ç®¡ç†æœåŠ¡ä¸­çš„å¯†é’¥é‡ã€‚</p>
</div>

<h2 id="3-3-åä¸ºäº‘KMSä¿¡å°åŠ å¯†ç®€ä»‹-å®˜ç½‘"><a href="#3-3-åä¸ºäº‘KMSä¿¡å°åŠ å¯†ç®€ä»‹-å®˜ç½‘" class="headerlink" title="3.3 åä¸ºäº‘KMSä¿¡å°åŠ å¯†ç®€ä»‹(å®˜ç½‘)"></a>3.3 åä¸ºäº‘KMSä¿¡å°åŠ å¯†ç®€ä»‹(<a href="https://support.huaweicloud.com/bestpractice-dew/dew_06_0013.html">å®˜ç½‘</a>)</h2><p>å½“æœ‰å¤§é‡æ•°æ®ï¼ˆä¾‹å¦‚ï¼šç…§ç‰‡ã€è§†é¢‘æˆ–è€…æ•°æ®åº“æ–‡ä»¶ç­‰ï¼‰éœ€è¦åŠ è§£å¯†æ—¶ï¼Œç”¨æˆ·å¯é‡‡ç”¨ä¿¡å°åŠ å¯†æ–¹å¼åŠ è§£å¯†æ•°æ®ï¼Œæ— éœ€é€šè¿‡ç½‘ç»œä¼ è¾“å¤§é‡æ•°æ®å³å¯å®Œæˆæ•°æ®åŠ è§£å¯†ã€‚</p>
<h3 id="å¤§é‡æ•°æ®åŠ å¯†"><a href="#å¤§é‡æ•°æ®åŠ å¯†" class="headerlink" title="å¤§é‡æ•°æ®åŠ å¯†"></a>å¤§é‡æ•°æ®åŠ å¯†</h3><p><img src="/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/%E5%8A%A0%E5%AF%86.png" alt="å¤§é‡æ•°æ®åŠ å¯†"><br><strong>è¯´æ˜å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>ç”¨æˆ·éœ€è¦åœ¨KMSä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·ä¸»å¯†é’¥ã€‚</li>
<li>ç”¨æˆ·è°ƒç”¨KMSçš„â€œcreate-datakeyâ€æ¥å£åˆ›å»ºæ•°æ®åŠ å¯†å¯†é’¥ã€‚ç”¨æˆ·å¾—åˆ°ä¸€ä¸ªæ˜æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥å’Œä¸€ä¸ªå¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥ã€‚å…¶ä¸­å¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥æ˜¯ç”±æŒ‡å®šçš„ç”¨æˆ·ä¸»å¯†é’¥åŠ å¯†æ˜æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥ç”Ÿæˆçš„ã€‚</li>
<li>ç”¨æˆ·ä½¿ç”¨æ˜æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥æ¥åŠ å¯†æ˜æ–‡æ–‡ä»¶ï¼Œç”Ÿæˆå¯†æ–‡æ–‡ä»¶ã€‚</li>
<li>ç”¨æˆ·å°†å¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥å’Œå¯†æ–‡æ–‡ä»¶ä¸€åŒå­˜å‚¨åˆ°æŒä¹…åŒ–å­˜å‚¨è®¾å¤‡æˆ–æœåŠ¡ä¸­ã€‚</li>
</ol>
<h3 id="å¤§é‡æ•°æ®è§£å¯†"><a href="#å¤§é‡æ•°æ®è§£å¯†" class="headerlink" title="å¤§é‡æ•°æ®è§£å¯†"></a>å¤§é‡æ•°æ®è§£å¯†</h3><p><img src="/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/%E8%A7%A3%E5%AF%86.png" alt="å¤§é‡æ•°æ®è§£å¯†"><br><strong>è¯´æ˜å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>ç”¨æˆ·ä»æŒä¹…åŒ–å­˜å‚¨è®¾å¤‡æˆ–æœåŠ¡ä¸­è¯»å–å¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥å’Œå¯†æ–‡æ–‡ä»¶ã€‚</li>
<li>ç”¨æˆ·è°ƒç”¨KMSçš„â€œdecrypt-datakeyâ€æ¥å£ï¼Œä½¿ç”¨å¯¹åº”çš„ç”¨æˆ·ä¸»å¯†é’¥ï¼ˆå³ç”Ÿæˆå¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥æ—¶æ‰€ä½¿ç”¨çš„ç”¨æˆ·ä¸»å¯†é’¥ï¼‰æ¥è§£å¯†å¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥ï¼Œå–å¾—æ˜æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥ã€‚<br>å¦‚æœå¯¹åº”çš„ç”¨æˆ·ä¸»å¯†é’¥è¢«è¯¯åˆ é™¤ï¼Œä¼šå¯¼è‡´è§£å¯†å¤±è´¥ã€‚å› æ­¤ï¼Œéœ€è¦å¦¥å–„ç®¡ç†å¥½ç”¨æˆ·ä¸»å¯†é’¥ã€‚</li>
<li>ç”¨æˆ·ä½¿ç”¨æ˜æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥æ¥è§£å¯†å¯†æ–‡æ–‡ä»¶ã€‚</li>
</ol>
<h1 id="å››ã€æœ¬åœ°æ•°æ®åŠ è§£å¯†æ–¹æ¡ˆå®è·µ"><a href="#å››ã€æœ¬åœ°æ•°æ®åŠ è§£å¯†æ–¹æ¡ˆå®è·µ" class="headerlink" title="å››ã€æœ¬åœ°æ•°æ®åŠ è§£å¯†æ–¹æ¡ˆå®è·µ"></a>å››ã€æœ¬åœ°æ•°æ®åŠ è§£å¯†æ–¹æ¡ˆå®è·µ</h1><div class="note primary no-icon flat"><p>åœ¨ä¸Šè¿°äº‘å‚å•†çš„KMSæœåŠ¡æä¾›çš„å¤§é‡æ•°æ®åŠ è§£å¯†çš„æ¡ˆä¾‹ä¸­ï¼ŒåŠ å¯†åçš„æ•°æ®å’ŒåŠ å¯†åçš„æ•°æ®åŠ å¯†å¯†é’¥DEKä¸€èµ·è¿›è¡Œå­˜å‚¨ã€‚<br>åŸºäºæ•°æ®å®‰å…¨çš„éœ€æ±‚ï¼Œéœ€è¦å¯¹æ•°æ®åŠ å¯†å¯†é’¥è¿›è¡Œå®šæœŸçš„è½®æ¢ã€‚å¯¹äºåŠ å¯†åçš„æ•°æ®ï¼Œä¸šåŠ¡åœºæ™¯å­˜åœ¨å¯¹åŠ å¯†æ•°æ®è¿›è¡Œç²¾ç¡®æŸ¥è¯¢çš„éœ€æ±‚ï¼Œéœ€è¦æ ¹æ®æ•°æ®åŠ å¯†å¯†é’¥å¯¹æŸ¥è¯¢<strong>å‚æ•°è¿›è¡ŒåŠ å¯†æŸ¥è¯¢</strong>ã€‚</p>
</div>
<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯¹KMSçš„ä¿¡å°åŠ å¯†çš„æ ‡å‡†æµç¨‹è¿›è¡Œä¸€äº›æœ¬åœ°é¡¹ç›®è½åœ°çš„è°ƒæ•´ã€‚<br><img src="/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%A7%A3%E5%AF%86.png" alt="æµ·é‡æ•°æ®åŠ è§£å¯†"></p>
<p><strong>æ–¹æ¡ˆè¯´æ˜ï¼š</strong></p>
<ol>
<li>æœ¬åœ°å¼€å‘ä¸€ä¸ªå¯†é’¥ç®¡ç†æœåŠ¡ï¼Œå®ç°æ•°æ®åŠ å¯†å¯†é’¥çš„ç®¡ç†</li>
<li>æ•°æ®åŠ å¯†å¯†é’¥å®šæœŸè½®æ¢ï¼Œå¹¶æŒ‡å®šæ•°æ®åŠ å¯†å¯†é’¥çš„<strong>æ•°æ®ç±»å‹</strong>ã€<strong>ç”Ÿæ•ˆæ—¶é—´</strong>ã€<strong>ç‰ˆæœ¬å·</strong></li>
<li>åº”ç”¨å¼•å…¥å®šåˆ¶åŠ è§£å¯†SDKï¼Œæ•°æ®åŠ å¯†æ—¶æ ¹æ®<strong>æ•°æ®ç±»å‹</strong>ã€<strong>ç”Ÿæ•ˆæ—¶é—´</strong>é€‰æ‹©å¯¹åº”ç‰ˆæœ¬å·çš„æ•°æ®åŠ å¯†å¯†é’¥è¿›è¡ŒåŠ å¯†</li>
<li>åŠ å¯†åçš„å¯†æ–‡åŒæ—¶æ‹¼æ¥åŠ å¯†æ‰€ç”¨çš„å¯†é’¥ç‰ˆæœ¬å·</li>
<li>åŠ å¯†æ•°æ®æŸ¥è¯¢æ—¶ï¼Œæ ¹æ®æŸ¥è¯¢æ•°æ®çš„ç±»å‹åŠæ—¶é—´ï¼Œé€‰æ‹©å¯¹åº”ç‰ˆæœ¬å·çš„æ•°æ®åŠ å¯†å¯†é’¥å¯¹å‚æ•°åŠ å¯†åè¿›è¡Œç²¾ç¡®æŸ¥è¯¢</li>
</ol>
<h2 id="4-1-æ•°æ®åŠ å¯†å¯†é’¥çš„æ•°æ®å®‰å…¨åˆ†æ"><a href="#4-1-æ•°æ®åŠ å¯†å¯†é’¥çš„æ•°æ®å®‰å…¨åˆ†æ" class="headerlink" title="4.1 æ•°æ®åŠ å¯†å¯†é’¥çš„æ•°æ®å®‰å…¨åˆ†æ"></a>4.1 æ•°æ®åŠ å¯†å¯†é’¥çš„æ•°æ®å®‰å…¨åˆ†æ</h2><div class="note success no-icon flat"><h3 id="å¯†é’¥æœåŠ¡çš„å¯†é’¥æ•°æ®"><a href="#å¯†é’¥æœåŠ¡çš„å¯†é’¥æ•°æ®" class="headerlink" title="å¯†é’¥æœåŠ¡çš„å¯†é’¥æ•°æ®"></a>å¯†é’¥æœåŠ¡çš„å¯†é’¥æ•°æ®</h3><ol>
<li>å¯†é’¥æœåŠ¡éœ€è¦å¯¹å¯†é’¥æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜ï¼Œå¹¶åšæ•°æ®çš„å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢å¯†é’¥æ•°æ®ä¸¢å¤±</li>
<li>å¯†é’¥æœåŠ¡æŒä¹…åŒ–çš„å¯†é’¥æ•°æ®æ˜¯ä½¿ç”¨KMSä¸Šçš„ç”¨æˆ·ä¸»å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œå¿…é¡»è°ƒç”¨åä¸ºäº‘KMSçš„æ¥å£æ‰èƒ½å¯¹å¯†é’¥æ•°æ®è§£å¯†</li>
<li>åä¸ºäº‘KMSæ¥å£ä½¿ç”¨IAMè´¦å·è¿›è¡Œé‰´æƒï¼Œé‰´æƒé€šè¿‡IAMè´¦å·çš„è®¿é—®å¯†é’¥ï¼ˆAK&#x2F;SKï¼ŒAccess Key ID&#x2F;Secret Access Keyï¼‰</li>
</ol>
</div>

<div class="note success no-icon flat"><h3 id="åä¸ºäº‘IAMè´¦å·è®¿é—®å¯†é’¥AK-SK"><a href="#åä¸ºäº‘IAMè´¦å·è®¿é—®å¯†é’¥AK-SK" class="headerlink" title="åä¸ºäº‘IAMè´¦å·è®¿é—®å¯†é’¥AK&#x2F;SK"></a>åä¸ºäº‘IAMè´¦å·è®¿é—®å¯†é’¥AK&#x2F;SK</h3><ol>
<li>ä½¿ç”¨K8sçš„secretså­˜å‚¨åä¸ºäº‘æ¥å£çš„AK&#x2F;SKä¿¡æ¯ï¼Œé¿å…æ¥å£è´¦å·ä¿¡æ¯æ³„æ¼ã€‚</li>
</ol>
</div>

<div class="note success no-icon flat"><h3 id="SDKä¸å¯†é’¥æœåŠ¡è®¿é—®"><a href="#SDKä¸å¯†é’¥æœåŠ¡è®¿é—®" class="headerlink" title="SDKä¸å¯†é’¥æœåŠ¡è®¿é—®"></a>SDKä¸å¯†é’¥æœåŠ¡è®¿é—®</h3><ol>
<li>ä½¿ç”¨IPç™½åå•è¿›è¡Œé™åˆ¶è®¿é—®</li>
<li>ä½¿ç”¨appIdã€appSecretè¿›è¡Œèº«ä»½é‰´æƒ</li>
<li>åŸºäºåº”ç”¨ä¿¡æ¯è¿›è¡Œç­¾åéªŒè¯ç­‰</li>
</ol>
</div>

<h1 id="äº”ã€åä¸ºäº‘KMSéªŒè¯"><a href="#äº”ã€åä¸ºäº‘KMSéªŒè¯" class="headerlink" title="äº”ã€åä¸ºäº‘KMSéªŒè¯"></a>äº”ã€åä¸ºäº‘KMSéªŒè¯</h1><p>åœ¨åŸºäºåä¸ºäº‘KMSæœåŠ¡è¿›è¡Œæµ·é‡æ•°æ®åŠ è§£å¯†çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨åˆ°ä¸€ä¸‹3ä¸ªæ¥å£ï¼š</p>
<ol>
<li>æ§åˆ¶å°åˆ›å»ºä¸»å¯†é’¥</li>
<li>æ¥å£åˆ›å»ºæ•°æ®å¯†é’¥</li>
<li>æ¥å£è§£å¯†æ•°æ®å¯†é’¥</li>
</ol>
<h2 id="5-1-æ§åˆ¶å°åˆ›å»ºä¸»å¯†é’¥"><a href="#5-1-æ§åˆ¶å°åˆ›å»ºä¸»å¯†é’¥" class="headerlink" title="5.1 æ§åˆ¶å°åˆ›å»ºä¸»å¯†é’¥"></a>5.1 æ§åˆ¶å°åˆ›å»ºä¸»å¯†é’¥</h2><p><img src="/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%AF%86%E9%92%A5.png" alt="åˆ›å»ºä¸»å¯†é’¥"></p>
<h2 id="5-2-åˆ›å»ºæ•°æ®å¯†é’¥"><a href="#5-2-åˆ›å»ºæ•°æ®å¯†é’¥" class="headerlink" title="5.2 åˆ›å»ºæ•°æ®å¯†é’¥"></a>5.2 åˆ›å»ºæ•°æ®å¯†é’¥</h2><p><img src="/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%AF%86%E9%92%A5.png" alt="åˆ›å»ºæ•°æ®åŠ å¯†å¯†é’¥"><br>è°ƒç”¨åä¸ºäº‘åˆ›å»ºæ•°æ®åŠ å¯†å¯†é’¥çš„æ¥å£ï¼Œä¼šè¿”å›æ˜æ–‡å’Œå¯†æ–‡çš„æ•°æ®åŠ å¯†å¯†é’¥ï¼ˆDEKï¼‰ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
 <span class="token property">"plain_text"</span><span class="token operator">:</span> <span class="token string">"43456936300d023645e0d7898d44c3a98b98c1b67cf611ccbfe8b9f5460d7095"</span><span class="token punctuation">,</span>
 <span class="token property">"key_id"</span><span class="token operator">:</span> <span class="token string">"2eef7f6e-7686-45c5-95c4-ddd6459d2e83"</span><span class="token punctuation">,</span>
 <span class="token property">"cipher_text"</span><span class="token operator">:</span> <span class="token string">"050064004ab28a42d6fff08045cd023000e738415a5de6ebccb0cebab73c14369fcc33e5dbc1d36c96739a4edd989eae2be4155a95374dfb04eef8581b95b6df32656566376636652d373638362d343563352d393563342d6464643634353964326538330000000014131211100f0e0d0c0b0a090807060504030201e3b815d0aae3791dfc9947897bfc20188f71c8ab4827c10f555bf3cc894cbbfe"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-3-è§£å¯†æ•°æ®å¯†é’¥"><a href="#5-3-è§£å¯†æ•°æ®å¯†é’¥" class="headerlink" title="5.3 è§£å¯†æ•°æ®å¯†é’¥"></a>5.3 è§£å¯†æ•°æ®å¯†é’¥</h2><p><img src="/2024/12/08/java/hai-liang-ye-wu-shu-ju-jia-jie-mi-fang-an-de-luo-di-yu-shi-jian/%E8%A7%A3%E5%AF%86%E6%95%B0%E6%8D%AE%E5%AF%86%E9%92%A5.png" alt="è§£å¯†æ•°æ®å¯†é’¥"><br>è°ƒç”¨è§£å¯†æ•°æ®å¯†é’¥æ¥å£ï¼Œå¯¹æœ¬åœ°å­˜å‚¨çš„åŠ å¯†åçš„æ•°æ®å¯†é’¥è¿›è¡Œè§£å¯†ã€‚</p>
<h3 id="è¯·æ±‚å‚æ•°"><a href="#è¯·æ±‚å‚æ•°" class="headerlink" title="è¯·æ±‚å‚æ•°"></a>è¯·æ±‚å‚æ•°</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
 <span class="token property">"key_id"</span><span class="token operator">:</span> <span class="token string">"2eef7f6e-7686-45c5-95c4-ddd6459d2e83"</span><span class="token punctuation">,</span>
 <span class="token property">"cipher_text"</span><span class="token operator">:</span> <span class="token string">"050064004ab28a42d6fff08045cd023000e738415a5de6ebccb0cebab73c14369fcc33e5dbc1d36c96739a4edd989eae2be4155a95374dfb04eef8581b95b6df32656566376636652d373638362d343563352d393563342d6464643634353964326538330000000014131211100f0e0d0c0b0a090807060504030201e3b815d0aae3791dfc9947897bfc20188f71c8ab4827c10f555bf3cc894cbbfe"</span><span class="token punctuation">,</span>
 <span class="token property">"datakey_cipher_length"</span><span class="token operator">:</span> <span class="token string">"312"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å“åº”å‚æ•°"><a href="#å“åº”å‚æ•°" class="headerlink" title="å“åº”å‚æ•°"></a>å“åº”å‚æ•°</h3><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
 <span class="token property">"datakey_dgst"</span><span class="token operator">:</span> <span class="token string">"1a96e1bcf8849e04e9e6786b4fcfa779260fac66ecd2233a413dc35c1d48fecb"</span><span class="token punctuation">,</span>
 <span class="token property">"data_key"</span><span class="token operator">:</span> <span class="token string">"43456936300d023645e0d7898d44c3a98b98c1b67cf611ccbfe8b9f5460d7095"</span><span class="token punctuation">,</span>
 <span class="token property">"datakey_length"</span><span class="token operator">:</span> <span class="token string">"32"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦ä»‹ç»åŸºäºKMSçš„æµ·é‡æ•°æ®åŠ è§£å¯†æ–¹å¼ï¼Œåœ¨æœ¬åœ°å¤§é‡æ•°æ®åŠ è§£å¯†çš„åœºæ™¯ä¸‹ï¼Œä¸€èˆ¬é‡‡ç”¨<font color="red"><strong>ä¿¡å°åŠ å¯†</strong></font>çš„æ–¹å¼å¯¹ä¸šåŠ¡æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚åœ¨æœ¬åœ°ä¸šåŠ¡è½åœ°è¿‡ç¨‹ä¸­ï¼ŒåŸºäºåŠ å¯†æ•°æ®æŸ¥è¯¢çš„éœ€æ±‚åŠæ•°æ®å­˜å‚¨çš„è¦æ±‚ï¼Œæˆ‘ä»¬å¯¹æ ‡å‡†çš„ä¿¡å°åŠ å¯†æ–¹å¼è¿›è¡Œè°ƒæ•´ï¼Œå¼•å…¥æœ¬åœ°å¯†é’¥æœåŠ¡ï¼Œå®ç°å¯¹æ•°æ®åŠ å¯†å¯†é’¥ç”Ÿæ•ˆæ—¶é—´å’Œç‰ˆæœ¬çš„ç®¡ç†ï¼Œæ›´å¥½çš„é€‚é…æœ¬åœ°æµ·é‡ä¸šåŠ¡æ•°æ®åŠ å¯†çš„åœºæ™¯ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>æ•°æ®åŠ å¯†</tag>
        <tag>KMS</tag>
        <tag>ä¿¡å°åŠ å¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutor</title>
    <url>/2019/05/06/java/shen-ru-li-jie-java-xian-cheng-chi-threadpoolexecutor/</url>
    <content><![CDATA[<p>çœ‹å®ŒThreadPoolExecutorçº¿ç¨‹æ± æºç å‡†å¤‡å†™åšå®¢è®°å½•ä¸€ä¸‹ï¼Œä½†æ˜¯å‘ç°ä¸€ç¯‡åšå®¢å¯¹ThreadPoolExecutoræºç åˆ†æå¾ˆè¯¦ç»†ï¼Œè¿™é‡Œä¸å†é‡å¤é€ è½®å­ï¼Œæ‰€ä»¥ç›´æ¥è½¬è½½äº†è¿™ç¯‡æ–‡ç« ã€‚</p>
<blockquote>
<p>åŸæ–‡åœ°å€ï¼š<a href="http://www.ideabuffer.cn/2017/04/04/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9AThreadPoolExecutor/">æ·±å…¥ç†è§£Javaçº¿ç¨‹æ± ï¼šThreadPoolExecutor</a></p>
</blockquote>
<h2 id="çº¿ç¨‹æ± ä»‹ç»"><a href="#çº¿ç¨‹æ± ä»‹ç»" class="headerlink" title="çº¿ç¨‹æ± ä»‹ç»"></a>çº¿ç¨‹æ± ä»‹ç»</h2><p>åœ¨webå¼€å‘ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦æ¥å—å¹¶å¤„ç†è¯·æ±‚ï¼Œæ‰€ä»¥ä¼šä¸ºä¸€ä¸ªè¯·æ±‚æ¥åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ¥è¿›è¡Œå¤„ç†ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„è¯å®ç°èµ·æ¥éå¸¸ç®€ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p><strong>å¦‚æœå¹¶å‘çš„è¯·æ±‚æ•°é‡éå¸¸å¤šï¼Œä½†æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´å¾ˆçŸ­ï¼Œè¿™æ ·å°±ä¼šé¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œå¦‚æ­¤ä¸€æ¥ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ã€‚å¯èƒ½å‡ºç°æœåŠ¡å™¨åœ¨ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°çº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹ä¸ŠèŠ±è´¹çš„æ—¶é—´å’Œæ¶ˆè€—çš„ç³»ç»Ÿèµ„æºè¦æ¯”å¤„ç†å®é™…çš„ç”¨æˆ·è¯·æ±‚çš„æ—¶é—´å’Œèµ„æºæ›´å¤šã€‚</strong></p>
<p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ä½¿æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸è¢«é”€æ¯ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡å‘¢ï¼Ÿ</p>
<p>è¿™å°±æ˜¯çº¿ç¨‹æ± çš„ç›®çš„äº†ã€‚çº¿ç¨‹æ± ä¸ºçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å¼€é”€å’Œèµ„æºä¸è¶³é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å¯¹å¤šä¸ªä»»åŠ¡é‡ç”¨çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ›å»ºçš„å¼€é”€è¢«åˆ†æ‘Šåˆ°äº†å¤šä¸ªä»»åŠ¡ä¸Šã€‚</p>
<p><strong>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</strong></p>
<ul>
<li>å•ä¸ªä»»åŠ¡å¤„ç†æ—¶é—´æ¯”è¾ƒçŸ­</li>
<li>éœ€è¦å¤„ç†çš„ä»»åŠ¡æ•°é‡å¾ˆå¤§</li>
</ul>
<p><strong>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„</strong></p>
<p>å¼•ç”¨è‡ª <a href="http://ifeve.com/java-threadpool/">http://ifeve.com/java-threadpool/</a> çš„è¯´æ˜ï¼š</p>
<ul>
<li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li>
<li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li>
</ul>
<p>Javaä¸­çš„çº¿ç¨‹æ± æ˜¯ç”¨ThreadPoolExecutorç±»æ¥å®ç°çš„. æœ¬æ–‡å°±ç»“åˆJDK 1.8å¯¹è¯¥ç±»çš„æºç æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªç±»å†…éƒ¨å¯¹äºçº¿ç¨‹çš„åˆ›å»º, ç®¡ç†ä»¥åŠåå°ä»»åŠ¡çš„è°ƒåº¦ç­‰æ–¹é¢çš„æ‰§è¡ŒåŸç†ã€‚</p>
<p>å…ˆçœ‹ä¸€ä¸‹çº¿ç¨‹æ± çš„ç±»å›¾ï¼š</p>
<p><img src="http://www.ideabuffer.cn/2017/04/04/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9AThreadPoolExecutor/QQ20170331-004227.png" alt="ThreadPoolExecutor.png"></p>
<h2 id="Executoræ¡†æ¶æ¥å£"><a href="#Executoræ¡†æ¶æ¥å£" class="headerlink" title="Executoræ¡†æ¶æ¥å£"></a>Executoræ¡†æ¶æ¥å£</h2><p>Executoræ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶ï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§å°†â€ä»»åŠ¡æäº¤â€ä¸â€ä»»åŠ¡å¦‚ä½•è¿è¡Œâ€åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚</p>
<p>J.U.Cä¸­æœ‰ä¸‰ä¸ªExecutoræ¥å£ï¼š</p>
<ul>
<li><strong>Executor</strong>ï¼šä¸€ä¸ªè¿è¡Œæ–°ä»»åŠ¡çš„ç®€å•æ¥å£ï¼›</li>
<li><strong>ExecutorService</strong>ï¼šæ‰©å±•äº†Executoræ¥å£ã€‚æ·»åŠ äº†ä¸€äº›ç”¨æ¥ç®¡ç†æ‰§è¡Œå™¨ç”Ÿå‘½å‘¨æœŸå’Œä»»åŠ¡ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼›</li>
<li><strong>ScheduledExecutorService</strong>ï¼šæ‰©å±•äº†ExecutorServiceã€‚æ”¯æŒFutureå’Œå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚</li>
</ul>
<h3 id="Executoræ¥å£"><a href="#Executoræ¥å£" class="headerlink" title="Executoræ¥å£"></a>Executoræ¥å£</h3><pre class="line-numbers language-none"><code class="language-none">public interface Executor &#123;
    void execute(Runnable command);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Executoræ¥å£åªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ï¼Œç”¨æ¥æ›¿ä»£é€šå¸¸åˆ›å»ºæˆ–å¯åŠ¨çº¿ç¨‹çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Threadæ¥åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Thread t &#x3D; new Thread();
t.start();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨Executoræ¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Thread t &#x3D; new Thread();
executor.execute(t);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å¯¹äºä¸åŒçš„Executorå®ç°ï¼Œexecute()æ–¹æ³•å¯èƒ½æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶ç«‹å³å¯åŠ¨ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä½¿ç”¨å·²æœ‰çš„å·¥ä½œçº¿ç¨‹æ¥è¿è¡Œä¼ å…¥çš„ä»»åŠ¡ï¼Œä¹Ÿå¯èƒ½æ˜¯æ ¹æ®è®¾ç½®çº¿ç¨‹æ± çš„å®¹é‡æˆ–è€…é˜»å¡é˜Ÿåˆ—çš„å®¹é‡æ¥å†³å®šæ˜¯å¦è¦å°†ä¼ å…¥çš„çº¿ç¨‹æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­æˆ–è€…æ‹’ç»æ¥æ”¶ä¼ å…¥çš„çº¿ç¨‹ã€‚</p>
<h3 id="ExecutorServiceæ¥å£"><a href="#ExecutorServiceæ¥å£" class="headerlink" title="ExecutorServiceæ¥å£"></a>ExecutorServiceæ¥å£</h3><p>ExecutorServiceæ¥å£ç»§æ‰¿è‡ªExecutoræ¥å£ï¼Œæä¾›äº†ç®¡ç†ç»ˆæ­¢çš„æ–¹æ³•ï¼Œä»¥åŠå¯ä¸ºè·Ÿè¸ªä¸€ä¸ªæˆ–å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ‰§è¡ŒçŠ¶å†µè€Œç”Ÿæˆ Future çš„æ–¹æ³•ã€‚å¢åŠ äº†shutDown()ï¼ŒshutDownNow()ï¼ŒinvokeAll()ï¼ŒinvokeAny()å’Œsubmit()ç­‰æ–¹æ³•ã€‚å¦‚æœéœ€è¦æ”¯æŒå³æ—¶å…³é—­ï¼Œä¹Ÿå°±æ˜¯shutDownNow()æ–¹æ³•ï¼Œåˆ™ä»»åŠ¡éœ€è¦æ­£ç¡®å¤„ç†ä¸­æ–­ã€‚</p>
<h3 id="ScheduledExecutorServiceæ¥å£"><a href="#ScheduledExecutorServiceæ¥å£" class="headerlink" title="ScheduledExecutorServiceæ¥å£"></a>ScheduledExecutorServiceæ¥å£</h3><p>ScheduledExecutorServiceæ‰©å±•ExecutorServiceæ¥å£å¹¶å¢åŠ äº†scheduleæ–¹æ³•ã€‚è°ƒç”¨scheduleæ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šçš„å»¶æ—¶åæ‰§è¡Œä¸€ä¸ªRunnableæˆ–è€…Callableä»»åŠ¡ã€‚ScheduledExecutorServiceæ¥å£è¿˜å®šä¹‰äº†æŒ‰ç…§æŒ‡å®šæ—¶é—´é—´éš”å®šæœŸæ‰§è¡Œä»»åŠ¡çš„scheduleAtFixedRate()æ–¹æ³•å’ŒscheduleWithFixedDelay()æ–¹æ³•ã€‚</p>
<h2 id="ThreadPoolExecutoråˆ†æ"><a href="#ThreadPoolExecutoråˆ†æ" class="headerlink" title="ThreadPoolExecutoråˆ†æ"></a>ThreadPoolExecutoråˆ†æ</h2><p>ThreadPoolExecutorç»§æ‰¿è‡ªAbstractExecutorServiceï¼Œä¹Ÿæ˜¯å®ç°äº†ExecutorServiceæ¥å£ã€‚</p>
<h3 id="å‡ ä¸ªé‡è¦çš„å­—æ®µ"><a href="#å‡ ä¸ªé‡è¦çš„å­—æ®µ" class="headerlink" title="å‡ ä¸ªé‡è¦çš„å­—æ®µ"></a>å‡ ä¸ªé‡è¦çš„å­—æ®µ</h3><pre class="line-numbers language-none"><code class="language-none">private final AtomicInteger ctl &#x3D; new AtomicInteger(ctlOf(RUNNING, 0));
private static final int COUNT_BITS &#x3D; Integer.SIZE - 3;
private static final int CAPACITY   &#x3D; (1 &lt;&lt; COUNT_BITS) - 1;

&#x2F;&#x2F; runState is stored in the high-order bits
private static final int RUNNING    &#x3D; -1 &lt;&lt; COUNT_BITS;
private static final int SHUTDOWN   &#x3D;  0 &lt;&lt; COUNT_BITS;
private static final int STOP       &#x3D;  1 &lt;&lt; COUNT_BITS;
private static final int TIDYING    &#x3D;  2 &lt;&lt; COUNT_BITS;
private static final int TERMINATED &#x3D;  3 &lt;&lt; COUNT_BITS;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>ctl</code>æ˜¯å¯¹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡è¿›è¡Œæ§åˆ¶çš„ä¸€ä¸ªå­—æ®µï¼Œ å®ƒåŒ…å«ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯: çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (runState) å’Œçº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (workerCount)ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†Integerç±»å‹æ¥ä¿å­˜ï¼Œé«˜3ä½ä¿å­˜runStateï¼Œä½29ä½ä¿å­˜workerCountã€‚COUNT_BITS å°±æ˜¯29ï¼ŒCAPACITYå°±æ˜¯1å·¦ç§»29ä½å‡1ï¼ˆ29ä¸ª1ï¼‰ï¼Œè¿™ä¸ªå¸¸é‡è¡¨ç¤ºworkerCountçš„ä¸Šé™å€¼ï¼Œå¤§çº¦æ˜¯5äº¿ã€‚</p>
<p>ä¸‹é¢å†ä»‹ç»ä¸‹çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€. çº¿ç¨‹æ± ä¸€å…±æœ‰äº”ç§çŠ¶æ€, åˆ†åˆ«æ˜¯:</p>
<ol>
<li><p><strong>RUNNING</strong> ï¼šèƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼›</p>
</li>
<li><p><strong>SHUTDOWN</strong>ï¼šå…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å´å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡ã€‚åœ¨çº¿ç¨‹æ± å¤„äº RUNNING çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ shutdown()æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚ï¼ˆfinalize() æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šè°ƒç”¨shutdown()æ–¹æ³•è¿›å…¥è¯¥çŠ¶æ€ï¼‰ï¼›</p>
</li>
<li><p><strong>STOP</strong>ï¼šä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº RUNNING æˆ– SHUTDOWN çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ shutdownNow() æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ï¼›</p>
</li>
<li><p><strong>TIDYING</strong>ï¼šå¦‚æœæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼ŒworkerCount (æœ‰æ•ˆçº¿ç¨‹æ•°) ä¸º0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨ terminated() æ–¹æ³•è¿›å…¥TERMINATED çŠ¶æ€ã€‚</p>
</li>
<li><p>TERMINATED</p>
<p>ï¼šåœ¨terminated() æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€ï¼Œé»˜è®¤terminated()æ–¹æ³•ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚</p>
<p>è¿›å…¥TERMINATEDçš„æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>çº¿ç¨‹æ± ä¸æ˜¯RUNNINGçŠ¶æ€ï¼›</li>
<li>çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯TIDYINGçŠ¶æ€æˆ–TERMINATEDçŠ¶æ€ï¼›</li>
<li>å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯SHUTDOWNå¹¶ä¸”workerQueueä¸ºç©ºï¼›</li>
<li>workerCountä¸º0ï¼›</li>
<li>è®¾ç½®TIDYINGçŠ¶æ€æˆåŠŸã€‚</li>
</ul>
</li>
</ol>
<p>ä¸‹å›¾ä¸ºçº¿ç¨‹æ± çš„çŠ¶æ€è½¬æ¢è¿‡ç¨‹ï¼š</p>
<p><img src="http://www.ideabuffer.cn/2017/04/04/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9AThreadPoolExecutor/threadpool-status.png" alt="threadpool-status.png"></p>
<h3 id="ctlç›¸å…³æ–¹æ³•"><a href="#ctlç›¸å…³æ–¹æ³•" class="headerlink" title="ctlç›¸å…³æ–¹æ³•"></a>ctlç›¸å…³æ–¹æ³•</h3><p>è¿™é‡Œè¿˜æœ‰å‡ ä¸ªå¯¹ctlè¿›è¡Œè®¡ç®—çš„æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">private static int runStateOf(int c)     &#123; return c &amp; ~CAPACITY; &#125;
private static int workerCountOf(int c)  &#123; return c &amp; CAPACITY; &#125;
private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><strong>runStateOf</strong>ï¼šè·å–è¿è¡ŒçŠ¶æ€ï¼›</li>
<li><strong>workerCountOf</strong>ï¼šè·å–æ´»åŠ¨çº¿ç¨‹æ•°ï¼›</li>
<li><strong>ctlOf</strong>ï¼šè·å–è¿è¡ŒçŠ¶æ€å’Œæ´»åŠ¨çº¿ç¨‹æ•°çš„å€¼ã€‚</li>
</ul>
<h3 id="ThreadPoolExecutoræ„é€ æ–¹æ³•"><a href="#ThreadPoolExecutoræ„é€ æ–¹æ³•" class="headerlink" title="ThreadPoolExecutoræ„é€ æ–¹æ³•"></a>ThreadPoolExecutoræ„é€ æ–¹æ³•</h3><pre class="line-numbers language-none"><code class="language-none">public ThreadPoolExecutor(int corePoolSize,
                          int maximumPoolSize,
                          long keepAliveTime,
                          TimeUnit unit,
                          BlockingQueue&lt;Runnable&gt; workQueue,
                          ThreadFactory threadFactory,
                          RejectedExecutionHandler handler) &#123;
    if (corePoolSize &lt; 0 ||
        maximumPoolSize &lt;&#x3D; 0 ||
        maximumPoolSize &lt; corePoolSize ||
        keepAliveTime &lt; 0)
        throw new IllegalArgumentException();
    if (workQueue &#x3D;&#x3D; null || threadFactory &#x3D;&#x3D; null || handler &#x3D;&#x3D; null)
        throw new NullPointerException();
    this.corePoolSize &#x3D; corePoolSize;
    this.maximumPoolSize &#x3D; maximumPoolSize;
    this.workQueue &#x3D; workQueue;
    this.keepAliveTime &#x3D; unit.toNanos(keepAliveTime);
    this.threadFactory &#x3D; threadFactory;
    this.handler &#x3D; handler;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ„é€ æ–¹æ³•ä¸­çš„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><p><strong>corePoolSize</strong>ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œå½“æœ‰æ–°ä»»åŠ¡åœ¨execute()æ–¹æ³•æäº¤æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š</p>
<ol>
<li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äº corePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ï¼›</li>
<li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº corePoolSize ä¸”å°äº maximumPoolSizeï¼Œåˆ™åªæœ‰å½“workQueueæ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼›</li>
<li>å¦‚æœè®¾ç½®çš„corePoolSize å’Œ maximumPoolSizeç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œè¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥workQueueæœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥workQueueä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä»workQueueä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼›</li>
<li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºmaximumPoolSizeï¼Œè¿™æ—¶å¦‚æœworkQueueå·²ç»æ»¡äº†ï¼Œåˆ™é€šè¿‡handleræ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼›</li>
</ol>
<p>æ‰€ä»¥ï¼Œä»»åŠ¡æäº¤æ—¶ï¼Œåˆ¤æ–­çš„é¡ºåºä¸º corePoolSize â€“&gt; workQueue â€“&gt; maximumPoolSizeã€‚</p>
</li>
<li><p><strong>maximumPoolSize</strong>ï¼šæœ€å¤§çº¿ç¨‹æ•°é‡ï¼›</p>
</li>
<li><p><strong>workQueue</strong>ï¼šç­‰å¾…é˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡æäº¤æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºcorePoolSizeçš„æ—¶å€™ï¼ŒæŠŠè¯¥ä»»åŠ¡å°è£…æˆä¸€ä¸ªWorkerå¯¹è±¡æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ï¼›</p>
</li>
<li><p>workQueue</p>
<p>ï¼šä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œå½“æäº¤ä¸€ä¸ªæ–°çš„ä»»åŠ¡åˆ°çº¿ç¨‹æ± ä»¥å, çº¿ç¨‹æ± ä¼šæ ¹æ®å½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨è¿è¡Œç€çš„çº¿ç¨‹çš„æ•°é‡æ¥å†³å®šå¯¹è¯¥ä»»åŠ¡çš„å¤„ç†æ–¹å¼ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§å¤„ç†æ–¹å¼:</p>
<ol>
<li><p><strong>ç›´æ¥åˆ‡æ¢</strong>ï¼šè¿™ç§æ–¹å¼å¸¸ç”¨çš„é˜Ÿåˆ—æ˜¯SynchronousQueueï¼Œä½†ç°åœ¨è¿˜æ²¡æœ‰ç ”ç©¶è¿‡è¯¥é˜Ÿåˆ—ï¼Œè¿™é‡Œæš‚æ—¶è¿˜æ²¡æ³•ä»‹ç»ï¼›</p>
</li>
<li><p><strong>ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—</strong>ï¼šä¸€èˆ¬ä½¿ç”¨åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueã€‚å¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¸­èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°å°±æ˜¯corePoolSizeï¼Œè€ŒmaximumPoolSizeå°±ä¸ä¼šèµ·ä½œç”¨äº†ï¼ˆåé¢ä¹Ÿä¼šè¯´åˆ°ï¼‰ã€‚å½“çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ ¸å¿ƒçº¿ç¨‹éƒ½æ˜¯RUNNINGçŠ¶æ€æ—¶ï¼Œè¿™æ—¶ä¸€ä¸ªæ–°çš„ä»»åŠ¡æäº¤å°±ä¼šæ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</p>
</li>
<li><p>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</p>
<p>ï¼šä¸€èˆ¬ä½¿ç”¨ArrayBlockingQueueã€‚ä½¿ç”¨è¯¥æ–¹å¼å¯ä»¥å°†çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°é‡é™åˆ¶ä¸ºmaximumPoolSizeï¼Œè¿™æ ·èƒ½å¤Ÿé™ä½èµ„æºçš„æ¶ˆè€—ï¼Œä½†åŒæ—¶è¿™ç§æ–¹å¼ä¹Ÿä½¿å¾—çº¿ç¨‹æ± å¯¹çº¿ç¨‹çš„è°ƒåº¦å˜å¾—æ›´å›°éš¾ï¼Œå› ä¸ºçº¿ç¨‹æ± å’Œé˜Ÿåˆ—çš„å®¹é‡éƒ½æ˜¯æœ‰é™çš„å€¼ï¼Œæ‰€ä»¥è¦æƒ³ä½¿çº¿ç¨‹æ± å¤„ç†ä»»åŠ¡çš„ååç‡è¾¾åˆ°ä¸€ä¸ªç›¸å¯¹åˆç†çš„èŒƒå›´ï¼Œåˆæƒ³ä½¿çº¿ç¨‹è°ƒåº¦ç›¸å¯¹ç®€å•ï¼Œå¹¶ä¸”è¿˜è¦å°½å¯èƒ½çš„é™ä½çº¿ç¨‹æ± å¯¹èµ„æºçš„æ¶ˆè€—ï¼Œå°±éœ€è¦åˆç†çš„è®¾ç½®è¿™ä¸¤ä¸ªæ•°é‡ã€‚</p>
<ul>
<li>å¦‚æœè¦æƒ³é™ä½ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼ˆåŒ…æ‹¬CPUçš„ä½¿ç”¨ç‡ï¼Œæ“ä½œç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œä¸Šä¸‹æ–‡ç¯å¢ƒåˆ‡æ¢çš„å¼€é”€ç­‰ï¼‰, å¯ä»¥è®¾ç½®è¾ƒå¤§çš„é˜Ÿåˆ—å®¹é‡å’Œè¾ƒå°çš„çº¿ç¨‹æ± å®¹é‡, ä½†è¿™æ ·ä¹Ÿä¼šé™ä½çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„ååé‡ã€‚</li>
<li>å¦‚æœæäº¤çš„ä»»åŠ¡ç»å¸¸å‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é€šè¿‡è°ƒç”¨ setMaximumPoolSize() æ–¹æ³•æ¥é‡æ–°è®¾å®šçº¿ç¨‹æ± çš„å®¹é‡ã€‚</li>
<li>å¦‚æœé˜Ÿåˆ—çš„å®¹é‡è®¾ç½®çš„è¾ƒå°ï¼Œé€šå¸¸éœ€è¦å°†çº¿ç¨‹æ± çš„å®¹é‡è®¾ç½®å¤§ä¸€ç‚¹ï¼Œè¿™æ ·CPUçš„ä½¿ç”¨ç‡ä¼šç›¸å¯¹çš„é«˜ä¸€äº›ã€‚ä½†å¦‚æœçº¿ç¨‹æ± çš„å®¹é‡è®¾ç½®çš„è¿‡å¤§ï¼Œåˆ™åœ¨æäº¤çš„ä»»åŠ¡æ•°é‡å¤ªå¤šçš„æƒ…å†µä¸‹ï¼Œå¹¶å‘é‡ä¼šå¢åŠ ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦å°±æ˜¯ä¸€ä¸ªè¦è€ƒè™‘çš„é—®é¢˜ï¼Œå› ä¸ºè¿™æ ·åè€Œæœ‰å¯èƒ½é™ä½å¤„ç†ä»»åŠ¡çš„ååé‡ã€‚</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>keepAliveTime</strong>ï¼šçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeçš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº†keepAliveTimeï¼›</p>
</li>
<li><p><strong>threadFactory</strong>ï¼šå®ƒæ˜¯ThreadFactoryç±»å‹çš„å˜é‡ï¼Œç”¨æ¥åˆ›å»ºæ–°çº¿ç¨‹ã€‚é»˜è®¤ä½¿ç”¨Executors.defaultThreadFactory() æ¥åˆ›å»ºçº¿ç¨‹ã€‚ä½¿ç”¨é»˜è®¤çš„ThreadFactoryæ¥åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¼šä½¿æ–°åˆ›å»ºçš„çº¿ç¨‹å…·æœ‰ç›¸åŒçš„NORM_PRIORITYä¼˜å…ˆçº§å¹¶ä¸”æ˜¯éå®ˆæŠ¤çº¿ç¨‹ï¼ŒåŒæ—¶ä¹Ÿè®¾ç½®äº†çº¿ç¨‹çš„åç§°ã€‚</p>
</li>
<li><p>handler</p>
<p>ï¼šå®ƒæ˜¯RejectedExecutionHandlerç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºçº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥ã€‚å¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œè¿™æ—¶å¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå°±éœ€è¦é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ã€‚çº¿ç¨‹æ± æä¾›äº†4ç§ç­–ç•¥ï¼š</p>
<ol>
<li>AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥ï¼›</li>
<li>CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</li>
<li>DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</li>
<li>DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›</li>
</ol>
</li>
</ul>
<h3 id="executeæ–¹æ³•"><a href="#executeæ–¹æ³•" class="headerlink" title="executeæ–¹æ³•"></a>executeæ–¹æ³•</h3><p>execute()æ–¹æ³•ç”¨æ¥æäº¤ä»»åŠ¡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">public void execute(Runnable command) &#123;
    if (command &#x3D;&#x3D; null)
        throw new NullPointerException();
    &#x2F;*
     * cltè®°å½•ç€runStateå’ŒworkerCount
     *&#x2F;
    int c &#x3D; ctl.get();
    &#x2F;*
     * workerCountOfæ–¹æ³•å–å‡ºä½29ä½çš„å€¼ï¼Œè¡¨ç¤ºå½“å‰æ´»åŠ¨çš„çº¿ç¨‹æ•°ï¼›
     * å¦‚æœå½“å‰æ´»åŠ¨çº¿ç¨‹æ•°å°äºcorePoolSizeï¼Œåˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼›
     * å¹¶æŠŠä»»åŠ¡æ·»åŠ åˆ°è¯¥çº¿ç¨‹ä¸­ã€‚
     *&#x2F;
    if (workerCountOf(c) &lt; corePoolSize) &#123;
        &#x2F;*
         * addWorkerä¸­çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºé™åˆ¶æ·»åŠ çº¿ç¨‹çš„æ•°é‡æ˜¯æ ¹æ®corePoolSizeæ¥åˆ¤æ–­è¿˜æ˜¯maximumPoolSizeæ¥åˆ¤æ–­ï¼›
         * å¦‚æœä¸ºtrueï¼Œæ ¹æ®corePoolSizeæ¥åˆ¤æ–­ï¼›
         * å¦‚æœä¸ºfalseï¼Œåˆ™æ ¹æ®maximumPoolSizeæ¥åˆ¤æ–­
         *&#x2F;
        if (addWorker(command, true))
            return;
        &#x2F;*
         * å¦‚æœæ·»åŠ å¤±è´¥ï¼Œåˆ™é‡æ–°è·å–ctlå€¼
         *&#x2F;
        c &#x3D; ctl.get();
    &#125;
    &#x2F;*
     * å¦‚æœå½“å‰çº¿ç¨‹æ± æ˜¯è¿è¡ŒçŠ¶æ€å¹¶ä¸”ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—æˆåŠŸ
     *&#x2F;
    if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;
        &#x2F;&#x2F; é‡æ–°è·å–ctlå€¼
        int recheck &#x3D; ctl.get();
        &#x2F;&#x2F; å†æ¬¡åˆ¤æ–­çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œç”±äºä¹‹å‰å·²ç»æŠŠcommandæ·»åŠ åˆ°workQueueä¸­äº†ï¼Œ
        &#x2F;&#x2F; è¿™æ—¶éœ€è¦ç§»é™¤è¯¥command
        &#x2F;&#x2F; æ‰§è¡Œè¿‡åé€šè¿‡handlerä½¿ç”¨æ‹’ç»ç­–ç•¥å¯¹è¯¥ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œæ•´ä¸ªæ–¹æ³•è¿”å›
        if (! isRunning(recheck) &amp;&amp; remove(command))
            reject(command);
        &#x2F;*
         * è·å–çº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°ï¼Œå¦‚æœæ•°é‡æ˜¯0ï¼Œåˆ™æ‰§è¡ŒaddWorkeræ–¹æ³•
         * è¿™é‡Œä¼ å…¥çš„å‚æ•°è¡¨ç¤ºï¼š
         * 1. ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œè¡¨ç¤ºåœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½†ä¸å»å¯åŠ¨ï¼›
         * 2. ç¬¬äºŒä¸ªå‚æ•°ä¸ºfalseï¼Œå°†çº¿ç¨‹æ± çš„æœ‰é™çº¿ç¨‹æ•°é‡çš„ä¸Šé™è®¾ç½®ä¸ºmaximumPoolSizeï¼Œæ·»åŠ çº¿ç¨‹æ—¶æ ¹æ®maximumPoolSizeæ¥åˆ¤æ–­ï¼›
         * å¦‚æœåˆ¤æ–­workerCountå¤§äº0ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œåœ¨workQueueä¸­æ–°å¢çš„commandä¼šåœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»è¢«æ‰§è¡Œã€‚
         *&#x2F;
        else if (workerCountOf(recheck) &#x3D;&#x3D; 0)
            addWorker(null, false);
    &#125;
    &#x2F;*
     * å¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š
     * 1. çº¿ç¨‹æ± å·²ç»ä¸æ˜¯RUNNINGçŠ¶æ€ï¼›
     * 2. çº¿ç¨‹æ± æ˜¯RUNNINGçŠ¶æ€ï¼Œä½†workerCount &gt;&#x3D; corePoolSizeå¹¶ä¸”workQueueå·²æ»¡ã€‚
     * è¿™æ—¶ï¼Œå†æ¬¡è°ƒç”¨addWorkeræ–¹æ³•ï¼Œä½†ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸ºfalseï¼Œå°†çº¿ç¨‹æ± çš„æœ‰é™çº¿ç¨‹æ•°é‡çš„ä¸Šé™è®¾ç½®ä¸ºmaximumPoolSizeï¼›
     * å¦‚æœå¤±è´¥åˆ™æ‹’ç»è¯¥ä»»åŠ¡
     *&#x2F;
    else if (!addWorker(command, false))
        reject(command);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç®€å•æ¥è¯´ï¼Œåœ¨æ‰§è¡Œexecute()æ–¹æ³•æ—¶å¦‚æœçŠ¶æ€ä¸€ç›´æ˜¯RUNNINGæ—¶ï¼Œçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœ<code>workerCount &lt; corePoolSize</code>ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼›</li>
<li>å¦‚æœ<code>workerCount &gt;= corePoolSize</code>ï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼›</li>
<li>å¦‚æœ<code>workerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSize</code>ï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼›</li>
<li>å¦‚æœ<code>workerCount &gt;= maximumPoolSize</code>ï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡, åˆ™æ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¯¥ä»»åŠ¡, é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚</li>
</ol>
<p>è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹<code>addWorker(null, false);</code>ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½†å¹¶æ²¡æœ‰ä¼ å…¥ä»»åŠ¡ï¼Œå› ä¸ºä»»åŠ¡å·²ç»è¢«æ·»åŠ åˆ°workQueueä¸­äº†ï¼Œæ‰€ä»¥workeråœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šç›´æ¥ä»workQueueä¸­è·å–ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œåœ¨<code>workerCountOf(recheck) == 0</code>æ—¶æ‰§è¡Œ<code>addWorker(null, false);</code>ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹æ± åœ¨RUNNINGçŠ¶æ€ä¸‹å¿…é¡»è¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>executeæ–¹æ³•æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="http://www.ideabuffer.cn/2017/04/04/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9AThreadPoolExecutor/executor.png" alt="executor.png"></p>
<h3 id="addWorkeræ–¹æ³•"><a href="#addWorkeræ–¹æ³•" class="headerlink" title="addWorkeræ–¹æ³•"></a>addWorkeræ–¹æ³•</h3><p>addWorkeræ–¹æ³•çš„ä¸»è¦å·¥ä½œæ˜¯åœ¨çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œï¼ŒfirstTaskå‚æ•° ç”¨äºæŒ‡å®šæ–°å¢çš„çº¿ç¨‹æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œcoreå‚æ•°ä¸ºtrueè¡¨ç¤ºåœ¨æ–°å¢çº¿ç¨‹æ—¶ä¼šåˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºcorePoolSizeï¼Œfalseè¡¨ç¤ºæ–°å¢çº¿ç¨‹å‰éœ€è¦åˆ¤æ–­å½“å‰æ´»åŠ¨çº¿ç¨‹æ•°æ˜¯å¦å°‘äºmaximumPoolSizeï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">private boolean addWorker(Runnable firstTask, boolean core) &#123;
    retry:
    for (;;) &#123;
        int c &#x3D; ctl.get();
        &#x2F;&#x2F; è·å–è¿è¡ŒçŠ¶æ€
        int rs &#x3D; runStateOf(c);
        
        &#x2F;*
         * è¿™ä¸ªifåˆ¤æ–­
         * å¦‚æœrs &gt;&#x3D; SHUTDOWNï¼Œåˆ™è¡¨ç¤ºæ­¤æ—¶ä¸å†æ¥æ”¶æ–°ä»»åŠ¡ï¼›
         * æ¥ç€åˆ¤æ–­ä»¥ä¸‹3ä¸ªæ¡ä»¶ï¼Œåªè¦æœ‰1ä¸ªä¸æ»¡è¶³ï¼Œåˆ™è¿”å›falseï¼š
         * 1. rs &#x3D;&#x3D; SHUTDOWNï¼Œè¿™æ—¶è¡¨ç¤ºå…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å´å¯ä»¥ç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­å·²ä¿å­˜çš„ä»»åŠ¡
         * 2. firsTaskä¸ºç©º
         * 3. é˜»å¡é˜Ÿåˆ—ä¸ä¸ºç©º
         * 
         * é¦–å…ˆè€ƒè™‘rs &#x3D;&#x3D; SHUTDOWNçš„æƒ…å†µ
         * è¿™ç§æƒ…å†µä¸‹ä¸ä¼šæ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œæ‰€ä»¥åœ¨firstTaskä¸ä¸ºç©ºçš„æ—¶å€™ä¼šè¿”å›falseï¼›
         * ç„¶åï¼Œå¦‚æœfirstTaskä¸ºç©ºï¼Œå¹¶ä¸”workQueueä¹Ÿä¸ºç©ºï¼Œåˆ™è¿”å›falseï¼Œ
         * å› ä¸ºé˜Ÿåˆ—ä¸­å·²ç»æ²¡æœ‰ä»»åŠ¡äº†ï¼Œä¸éœ€è¦å†æ·»åŠ çº¿ç¨‹äº†
         *&#x2F;
        &#x2F;&#x2F; Check if queue empty only if necessary.
        if (rs &gt;&#x3D; SHUTDOWN &amp;&amp;
            ! (rs &#x3D;&#x3D; SHUTDOWN &amp;&amp;
               firstTask &#x3D;&#x3D; null &amp;&amp;
               ! workQueue.isEmpty()))
            return false;

        for (;;) &#123;
            &#x2F;&#x2F; è·å–çº¿ç¨‹æ•°
            int wc &#x3D; workerCountOf(c);
            &#x2F;&#x2F; å¦‚æœwcè¶…è¿‡CAPACITYï¼Œä¹Ÿå°±æ˜¯ctlçš„ä½29ä½çš„æœ€å¤§å€¼ï¼ˆäºŒè¿›åˆ¶æ˜¯29ä¸ª1ï¼‰ï¼Œè¿”å›falseï¼›
            &#x2F;&#x2F; è¿™é‡Œçš„coreæ˜¯addWorkeræ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœä¸ºtrueè¡¨ç¤ºæ ¹æ®corePoolSizeæ¥æ¯”è¾ƒï¼Œ
            &#x2F;&#x2F; å¦‚æœä¸ºfalseåˆ™æ ¹æ®maximumPoolSizeæ¥æ¯”è¾ƒã€‚
            &#x2F;&#x2F; 
            if (wc &gt;&#x3D; CAPACITY ||
                wc &gt;&#x3D; (core ? corePoolSize : maximumPoolSize))
                return false;
            &#x2F;&#x2F; å°è¯•å¢åŠ workerCountï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è·³å‡ºç¬¬ä¸€ä¸ªforå¾ªç¯
            if (compareAndIncrementWorkerCount(c))
                break retry;
            &#x2F;&#x2F; å¦‚æœå¢åŠ workerCountå¤±è´¥ï¼Œåˆ™é‡æ–°è·å–ctlçš„å€¼
            c &#x3D; ctl.get();  &#x2F;&#x2F; Re-read ctl
            &#x2F;&#x2F; å¦‚æœå½“å‰çš„è¿è¡ŒçŠ¶æ€ä¸ç­‰äºrsï¼Œè¯´æ˜çŠ¶æ€å·²è¢«æ”¹å˜ï¼Œè¿”å›ç¬¬ä¸€ä¸ªforå¾ªç¯ç»§ç»­æ‰§è¡Œ
            if (runStateOf(c) !&#x3D; rs)
                continue retry;
            &#x2F;&#x2F; else CAS failed due to workerCount change; retry inner loop
        &#125;
    &#125;

    boolean workerStarted &#x3D; false;
    boolean workerAdded &#x3D; false;
    Worker w &#x3D; null;
    try &#123;
        &#x2F;&#x2F; æ ¹æ®firstTaskæ¥åˆ›å»ºWorkerå¯¹è±¡
        w &#x3D; new Worker(firstTask);
        &#x2F;&#x2F; æ¯ä¸€ä¸ªWorkerå¯¹è±¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹
        final Thread t &#x3D; w.thread;
        if (t !&#x3D; null) &#123;
            final ReentrantLock mainLock &#x3D; this.mainLock;
            mainLock.lock();
            try &#123;
                &#x2F;&#x2F; Recheck while holding lock.
                &#x2F;&#x2F; Back out on ThreadFactory failure or if
                &#x2F;&#x2F; shut down before lock acquired.
                int rs &#x3D; runStateOf(ctl.get());
                &#x2F;&#x2F; rs &lt; SHUTDOWNè¡¨ç¤ºæ˜¯RUNNINGçŠ¶æ€ï¼›
                &#x2F;&#x2F; å¦‚æœrsæ˜¯RUNNINGçŠ¶æ€æˆ–è€…rsæ˜¯SHUTDOWNçŠ¶æ€å¹¶ä¸”firstTaskä¸ºnullï¼Œå‘çº¿ç¨‹æ± ä¸­æ·»åŠ çº¿ç¨‹ã€‚
                &#x2F;&#x2F; å› ä¸ºåœ¨SHUTDOWNæ—¶ä¸ä¼šåœ¨æ·»åŠ æ–°çš„ä»»åŠ¡ï¼Œä½†è¿˜æ˜¯ä¼šæ‰§è¡ŒworkQueueä¸­çš„ä»»åŠ¡
                if (rs &lt; SHUTDOWN ||
                    (rs &#x3D;&#x3D; SHUTDOWN &amp;&amp; firstTask &#x3D;&#x3D; null)) &#123;
                    if (t.isAlive()) &#x2F;&#x2F; precheck that t is startable
                        throw new IllegalThreadStateException();
                    &#x2F;&#x2F; workersæ˜¯ä¸€ä¸ªHashSet
                    workers.add(w);
                    int s &#x3D; workers.size();
                    &#x2F;&#x2F; largestPoolSizeè®°å½•ç€çº¿ç¨‹æ± ä¸­å‡ºç°è¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡
                    if (s &gt; largestPoolSize)
                        largestPoolSize &#x3D; s;
                    workerAdded &#x3D; true;
                &#125;
            &#125; finally &#123;
                mainLock.unlock();
            &#125;
            if (workerAdded) &#123;
                &#x2F;&#x2F; å¯åŠ¨çº¿ç¨‹
                t.start();
                workerStarted &#x3D; true;
            &#125;
        &#125;
    &#125; finally &#123;
        if (! workerStarted)
            addWorkerFailed(w);
    &#125;
    return workerStarted;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„<code>t.start()</code>è¿™ä¸ªè¯­å¥ï¼Œå¯åŠ¨æ—¶ä¼šè°ƒç”¨Workerç±»ä¸­çš„runæ–¹æ³•ï¼ŒWorkeræœ¬èº«å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥ä¸€ä¸ªWorkerç±»å‹çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<h3 id="Workerç±»"><a href="#Workerç±»" class="headerlink" title="Workerç±»"></a>Workerç±»</h3><p>çº¿ç¨‹æ± ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹è¢«å°è£…æˆä¸€ä¸ªWorkerå¯¹è±¡ï¼ŒThreadPoolç»´æŠ¤çš„å…¶å®å°±æ˜¯ä¸€ç»„Workerå¯¹è±¡ï¼Œçœ‹ä¸€ä¸‹Workerçš„å®šä¹‰ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">private final class Worker
        extends AbstractQueuedSynchronizer
        implements Runnable
&#123;
    &#x2F;**
     * This class will never be serialized, but we provide a
     * serialVersionUID to suppress a javac warning.
     *&#x2F;
    private static final long serialVersionUID &#x3D; 6138294804551838833L;

    &#x2F;** Thread this worker is running in.  Null if factory fails. *&#x2F;
    final Thread thread;
    &#x2F;** Initial task to run.  Possibly null. *&#x2F;
    Runnable firstTask;
    &#x2F;** Per-thread task counter *&#x2F;
    volatile long completedTasks;

    &#x2F;**
     * Creates with given first task and thread from ThreadFactory.
     * @param firstTask the first task (null if none)
     *&#x2F;
    Worker(Runnable firstTask) &#123;
        setState(-1); &#x2F;&#x2F; inhibit interrupts until runWorker
        this.firstTask &#x3D; firstTask;
        this.thread &#x3D; getThreadFactory().newThread(this);
    &#125;

    &#x2F;** Delegates main run loop to outer runWorker  *&#x2F;
    public void run() &#123;
        runWorker(this);
    &#125;

    &#x2F;&#x2F; Lock methods
    &#x2F;&#x2F;
    &#x2F;&#x2F; The value 0 represents the unlocked state.
    &#x2F;&#x2F; The value 1 represents the locked state.

    protected boolean isHeldExclusively() &#123;
        return getState() !&#x3D; 0;
    &#125;

    protected boolean tryAcquire(int unused) &#123;
        if (compareAndSetState(0, 1)) &#123;
            setExclusiveOwnerThread(Thread.currentThread());
            return true;
        &#125;
        return false;
    &#125;

    protected boolean tryRelease(int unused) &#123;
        setExclusiveOwnerThread(null);
        setState(0);
        return true;
    &#125;

    public void lock()        &#123; acquire(1); &#125;
    public boolean tryLock()  &#123; return tryAcquire(1); &#125;
    public void unlock()      &#123; release(1); &#125;
    public boolean isLocked() &#123; return isHeldExclusively(); &#125;

    void interruptIfStarted() &#123;
        Thread t;
        if (getState() &gt;&#x3D; 0 &amp;&amp; (t &#x3D; thread) !&#x3D; null &amp;&amp; !t.isInterrupted()) &#123;
            try &#123;
                t.interrupt();
            &#125; catch (SecurityException ignore) &#123;
            &#125;
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Workerç±»ç»§æ‰¿äº†AQSï¼Œå¹¶å®ç°äº†Runnableæ¥å£ï¼Œæ³¨æ„å…¶ä¸­çš„firstTaskå’Œthreadå±æ€§ï¼šfirstTaskç”¨å®ƒæ¥ä¿å­˜ä¼ å…¥çš„ä»»åŠ¡ï¼›threadæ˜¯åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶é€šè¿‡ThreadFactoryæ¥åˆ›å»ºçš„çº¿ç¨‹ï¼Œæ˜¯ç”¨æ¥å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚</p>
<p>åœ¨è°ƒç”¨æ„é€ æ–¹æ³•æ—¶ï¼Œéœ€è¦æŠŠä»»åŠ¡ä¼ å…¥ï¼Œè¿™é‡Œé€šè¿‡<code>getThreadFactory().newThread(this);</code>æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼ŒnewThreadæ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯thisï¼Œå› ä¸ºWorkeræœ¬èº«ç»§æ‰¿äº†Runnableæ¥å£ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€ä¸ªWorkerå¯¹è±¡åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨Workerç±»ä¸­çš„runæ–¹æ³•ã€‚</p>
<p>Workerç»§æ‰¿äº†AQSï¼Œä½¿ç”¨AQSæ¥å®ç°ç‹¬å é”çš„åŠŸèƒ½ã€‚ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ReentrantLockæ¥å®ç°å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°tryAcquireæ–¹æ³•ï¼Œå®ƒæ˜¯ä¸å…è®¸é‡å…¥çš„ï¼Œè€ŒReentrantLockæ˜¯å…è®¸é‡å…¥çš„ï¼š</p>
<ol>
<li>lockæ–¹æ³•ä¸€æ—¦è·å–äº†ç‹¬å é”ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä»»åŠ¡ä¸­ï¼›</li>
<li>å¦‚æœæ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™ä¸åº”è¯¥ä¸­æ–­çº¿ç¨‹ï¼›</li>
<li>å¦‚æœè¯¥çº¿ç¨‹ç°åœ¨ä¸æ˜¯ç‹¬å é”çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„çŠ¶æ€ï¼Œè¯´æ˜å®ƒæ²¡æœ‰åœ¨å¤„ç†ä»»åŠ¡ï¼Œè¿™æ—¶å¯ä»¥å¯¹è¯¥çº¿ç¨‹è¿›è¡Œä¸­æ–­ï¼›</li>
<li>çº¿ç¨‹æ± åœ¨æ‰§è¡Œshutdownæ–¹æ³•æˆ–tryTerminateæ–¹æ³•æ—¶ä¼šè°ƒç”¨interruptIdleWorkersæ–¹æ³•æ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæ–¹æ³•ä¼šä½¿ç”¨tryLockæ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çŠ¶æ€ï¼›</li>
<li>ä¹‹æ‰€ä»¥è®¾ç½®ä¸ºä¸å¯é‡å…¥ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›ä»»åŠ¡åœ¨è°ƒç”¨åƒsetCorePoolSizeè¿™æ ·çš„çº¿ç¨‹æ± æ§åˆ¶æ–¹æ³•æ—¶é‡æ–°è·å–é”ã€‚å¦‚æœä½¿ç”¨ReentrantLockï¼Œå®ƒæ˜¯å¯é‡å…¥çš„ï¼Œè¿™æ ·å¦‚æœåœ¨ä»»åŠ¡ä¸­è°ƒç”¨äº†å¦‚setCorePoolSizeè¿™ç±»çº¿ç¨‹æ± æ§åˆ¶çš„æ–¹æ³•ï¼Œä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼ŒWorkerç»§æ‰¿è‡ªAQSï¼Œç”¨äºåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ç©ºé—²ä»¥åŠæ˜¯å¦å¯ä»¥è¢«ä¸­æ–­ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œäº†<code>setState(-1);</code>ï¼ŒæŠŠstateå˜é‡è®¾ç½®ä¸º-1ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿæ˜¯å› ä¸ºAQSä¸­é»˜è®¤çš„stateæ˜¯0ï¼Œå¦‚æœåˆšåˆ›å»ºäº†ä¸€ä¸ªWorkerå¯¹è±¡ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œè¿™æ—¶å°±ä¸åº”è¯¥è¢«ä¸­æ–­ï¼Œçœ‹ä¸€ä¸‹tryAquireæ–¹æ³•ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">protected boolean tryAcquire(int unused) &#123;
    if (compareAndSetState(0, 1)) &#123;
        setExclusiveOwnerThread(Thread.currentThread());
        return true;
    &#125;
    return false;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>tryAcquireæ–¹æ³•æ˜¯æ ¹æ®stateæ˜¯å¦æ˜¯0æ¥åˆ¤æ–­çš„ï¼Œæ‰€ä»¥ï¼Œ<code>setState(-1);</code>å°†stateè®¾ç½®ä¸º-1æ˜¯ä¸ºäº†ç¦æ­¢åœ¨æ‰§è¡Œä»»åŠ¡å‰å¯¹çº¿ç¨‹è¿›è¡Œä¸­æ–­ã€‚</p>
<p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨runWorkeræ–¹æ³•ä¸­ä¼šå…ˆè°ƒç”¨Workerå¯¹è±¡çš„unlockæ–¹æ³•å°†stateè®¾ç½®ä¸º0.</p>
<h3 id="runWorkeræ–¹æ³•"><a href="#runWorkeræ–¹æ³•" class="headerlink" title="runWorkeræ–¹æ³•"></a>runWorkeræ–¹æ³•</h3><p>åœ¨Workerç±»ä¸­çš„runæ–¹æ³•è°ƒç”¨äº†runWorkeræ–¹æ³•æ¥æ‰§è¡Œä»»åŠ¡ï¼ŒrunWorkeræ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">final void runWorker(Worker w) &#123;
    Thread wt &#x3D; Thread.currentThread();
    &#x2F;&#x2F; è·å–ç¬¬ä¸€ä¸ªä»»åŠ¡
    Runnable task &#x3D; w.firstTask;
    w.firstTask &#x3D; null;
    &#x2F;&#x2F; å…è®¸ä¸­æ–­
    w.unlock(); &#x2F;&#x2F; allow interrupts
    &#x2F;&#x2F; æ˜¯å¦å› ä¸ºå¼‚å¸¸é€€å‡ºå¾ªç¯
    boolean completedAbruptly &#x3D; true;
    try &#123;
        &#x2F;&#x2F; å¦‚æœtaskä¸ºç©ºï¼Œåˆ™é€šè¿‡getTaskæ¥è·å–ä»»åŠ¡
        while (task !&#x3D; null || (task &#x3D; getTask()) !&#x3D; null) &#123;
            w.lock();
            &#x2F;&#x2F; If pool is stopping, ensure thread is interrupted;
            &#x2F;&#x2F; if not, ensure thread is not interrupted.  This
            &#x2F;&#x2F; requires a recheck in second case to deal with
            &#x2F;&#x2F; shutdownNow race while clearing interrupt
            if ((runStateAtLeast(ctl.get(), STOP) ||
                 (Thread.interrupted() &amp;&amp;
                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;
                !wt.isInterrupted())
                wt.interrupt();
            try &#123;
                beforeExecute(wt, task);
                Throwable thrown &#x3D; null;
                try &#123;
                    task.run();
                &#125; catch (RuntimeException x) &#123;
                    thrown &#x3D; x; throw x;
                &#125; catch (Error x) &#123;
                    thrown &#x3D; x; throw x;
                &#125; catch (Throwable x) &#123;
                    thrown &#x3D; x; throw new Error(x);
                &#125; finally &#123;
                    afterExecute(task, thrown);
                &#125;
            &#125; finally &#123;
                task &#x3D; null;
                w.completedTasks++;
                w.unlock();
            &#125;
        &#125;
        completedAbruptly &#x3D; false;
    &#125; finally &#123;
        processWorkerExit(w, completedAbruptly);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œç›®çš„æ˜¯ï¼š</p>
<ul>
<li>å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼›</li>
<li>å¦‚æœä¸æ˜¯çš„è¯ï¼Œåˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ï¼›</li>
</ul>
<p>è¿™é‡Œè¦è€ƒè™‘åœ¨æ‰§è¡Œè¯¥ifè¯­å¥æœŸé—´å¯èƒ½ä¹Ÿæ‰§è¡Œäº†shutdownNowæ–¹æ³•ï¼ŒshutdownNowæ–¹æ³•ä¼šæŠŠçŠ¶æ€è®¾ç½®ä¸ºSTOPï¼Œå›é¡¾ä¸€ä¸‹STOPçŠ¶æ€ï¼š</p>
<blockquote>
<p>ä¸èƒ½æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº RUNNING æˆ– SHUTDOWN çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ shutdownNow() æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚</p>
</blockquote>
<p>STOPçŠ¶æ€è¦ä¸­æ–­çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œè¿™é‡Œä½¿ç”¨<code>Thread.interrupted()</code>æ¥åˆ¤æ–­æ˜¯å¦ä¸­æ–­æ˜¯ä¸ºäº†ç¡®ä¿åœ¨RUNNINGæˆ–è€…SHUTDOWNçŠ¶æ€æ—¶çº¿ç¨‹æ˜¯éä¸­æ–­çŠ¶æ€çš„ï¼Œå› ä¸ºThread.interrupted()æ–¹æ³•ä¼šå¤ä½ä¸­æ–­çš„çŠ¶æ€ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹runWorkeræ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>whileå¾ªç¯ä¸æ–­åœ°é€šè¿‡getTask()æ–¹æ³•è·å–ä»»åŠ¡ï¼›</li>
<li>getTask()æ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ï¼›</li>
<li>å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œé‚£ä¹ˆè¦ä¿è¯å½“å‰çº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œå¦åˆ™è¦ä¿è¯å½“å‰çº¿ç¨‹ä¸æ˜¯ä¸­æ–­çŠ¶æ€ï¼›</li>
<li>è°ƒç”¨<code>task.run()</code>æ‰§è¡Œä»»åŠ¡ï¼›</li>
<li>å¦‚æœtaskä¸ºnullåˆ™è·³å‡ºå¾ªç¯ï¼Œæ‰§è¡ŒprocessWorkerExit()æ–¹æ³•ï¼›</li>
<li>runWorkeræ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä»£è¡¨ç€Workerä¸­çš„runæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œé”€æ¯çº¿ç¨‹ã€‚</li>
</ol>
<p>è¿™é‡Œçš„beforeExecuteæ–¹æ³•å’ŒafterExecuteæ–¹æ³•åœ¨ThreadPoolExecutorç±»ä¸­æ˜¯ç©ºçš„ï¼Œç•™ç»™å­ç±»æ¥å®ç°ã€‚</p>
<p>completedAbruptlyå˜é‡æ¥è¡¨ç¤ºåœ¨æ‰§è¡Œä»»åŠ¡è¿‡ç¨‹ä¸­æ˜¯å¦å‡ºç°äº†å¼‚å¸¸ï¼Œåœ¨processWorkerExitæ–¹æ³•ä¸­ä¼šå¯¹è¯¥å˜é‡çš„å€¼è¿›è¡Œåˆ¤æ–­ã€‚</p>
<h3 id="getTaskæ–¹æ³•"><a href="#getTaskæ–¹æ³•" class="headerlink" title="getTaskæ–¹æ³•"></a>getTaskæ–¹æ³•</h3><p>getTaskæ–¹æ³•ç”¨æ¥ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">private Runnable getTask() &#123;
    &#x2F;&#x2F; timeOutå˜é‡çš„å€¼è¡¨ç¤ºä¸Šæ¬¡ä»é˜»å¡é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ—¶æ˜¯å¦è¶…æ—¶
    boolean timedOut &#x3D; false; &#x2F;&#x2F; Did the last poll() time out?

    for (;;) &#123;
        int c &#x3D; ctl.get();
        int rs &#x3D; runStateOf(c);

        &#x2F;&#x2F; Check if queue empty only if necessary.
        &#x2F;*
         * å¦‚æœçº¿ç¨‹æ± çŠ¶æ€rs &gt;&#x3D; SHUTDOWNï¼Œä¹Ÿå°±æ˜¯éRUNNINGçŠ¶æ€ï¼Œå†è¿›è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š
         * 1. rs &gt;&#x3D; STOPï¼Œçº¿ç¨‹æ± æ˜¯å¦æ­£åœ¨stopï¼›
         * 2. é˜»å¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚
         * å¦‚æœä»¥ä¸Šæ¡ä»¶æ»¡è¶³ï¼Œåˆ™å°†workerCountå‡1å¹¶è¿”å›nullã€‚
         * å› ä¸ºå¦‚æœå½“å‰çº¿ç¨‹æ± çŠ¶æ€çš„å€¼æ˜¯SHUTDOWNæˆ–ä»¥ä¸Šæ—¶ï¼Œä¸å…è®¸å†å‘é˜»å¡é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ã€‚
         *&#x2F;
        if (rs &gt;&#x3D; SHUTDOWN &amp;&amp; (rs &gt;&#x3D; STOP || workQueue.isEmpty())) &#123;
            decrementWorkerCount();
            return null;
        &#125;

        int wc &#x3D; workerCountOf(c);

        &#x2F;&#x2F; Are workers subject to culling?
        &#x2F;&#x2F; timedå˜é‡ç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œè¶…æ—¶æ§åˆ¶ã€‚
        &#x2F;&#x2F; allowCoreThreadTimeOuté»˜è®¤æ˜¯falseï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¸å…è®¸è¿›è¡Œè¶…æ—¶ï¼›
        &#x2F;&#x2F; wc &gt; corePoolSizeï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼›
        &#x2F;&#x2F; å¯¹äºè¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„è¿™äº›çº¿ç¨‹ï¼Œéœ€è¦è¿›è¡Œè¶…æ—¶æ§åˆ¶
        boolean timed &#x3D; allowCoreThreadTimeOut || wc &gt; corePoolSize;
        
        &#x2F;*
         * wc &gt; maximumPoolSizeçš„æƒ…å†µæ˜¯å› ä¸ºå¯èƒ½åœ¨æ­¤æ–¹æ³•æ‰§è¡Œé˜¶æ®µåŒæ—¶æ‰§è¡Œäº†setMaximumPoolSizeæ–¹æ³•ï¼›
         * timed &amp;&amp; timedOut å¦‚æœä¸ºtrueï¼Œè¡¨ç¤ºå½“å‰æ“ä½œéœ€è¦è¿›è¡Œè¶…æ—¶æ§åˆ¶ï¼Œå¹¶ä¸”ä¸Šæ¬¡ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å‘ç”Ÿäº†è¶…æ—¶
         * æ¥ä¸‹æ¥åˆ¤æ–­ï¼Œå¦‚æœæœ‰æ•ˆçº¿ç¨‹æ•°é‡å¤§äº1ï¼Œæˆ–è€…é˜»å¡é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°è¯•å°†workerCountå‡1ï¼›
         * å¦‚æœå‡1å¤±è´¥ï¼Œåˆ™è¿”å›é‡è¯•ã€‚
         * å¦‚æœwc &#x3D;&#x3D; 1æ—¶ï¼Œä¹Ÿå°±è¯´æ˜å½“å‰çº¿ç¨‹æ˜¯çº¿ç¨‹æ± ä¸­å”¯ä¸€çš„ä¸€ä¸ªçº¿ç¨‹äº†ã€‚
         *&#x2F;
        if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut))
            &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) &#123;
            if (compareAndDecrementWorkerCount(c))
                return null;
            continue;
        &#125;

        try &#123;
            &#x2F;*
             * æ ¹æ®timedæ¥åˆ¤æ–­ï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™é€šè¿‡é˜»å¡é˜Ÿåˆ—çš„pollæ–¹æ³•è¿›è¡Œè¶…æ—¶æ§åˆ¶ï¼Œå¦‚æœåœ¨keepAliveTimeæ—¶é—´å†…æ²¡æœ‰è·å–åˆ°ä»»åŠ¡ï¼Œåˆ™è¿”å›nullï¼›
             * å¦åˆ™é€šè¿‡takeæ–¹æ³•ï¼Œå¦‚æœè¿™æ—¶é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™takeæ–¹æ³•ä¼šé˜»å¡ç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©ºã€‚
             * 
             *&#x2F;
            Runnable r &#x3D; timed ?
                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :
                workQueue.take();
            if (r !&#x3D; null)
                return r;
            &#x2F;&#x2F; å¦‚æœ r &#x3D;&#x3D; nullï¼Œè¯´æ˜å·²ç»è¶…æ—¶ï¼ŒtimedOutè®¾ç½®ä¸ºtrue
            timedOut &#x3D; true;
        &#125; catch (InterruptedException retry) &#123;
            &#x2F;&#x2F; å¦‚æœè·å–ä»»åŠ¡æ—¶å½“å‰çº¿ç¨‹å‘ç”Ÿäº†ä¸­æ–­ï¼Œåˆ™è®¾ç½®timedOutä¸ºfalseå¹¶è¿”å›å¾ªç¯é‡è¯•
            timedOut &#x3D; false;
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œé‡è¦çš„åœ°æ–¹æ˜¯ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œç›®çš„æ˜¯æ§åˆ¶çº¿ç¨‹æ± çš„æœ‰æ•ˆçº¿ç¨‹æ•°é‡ã€‚ç”±ä¸Šæ–‡ä¸­çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œåœ¨æ‰§è¡Œexecuteæ–¹æ³•æ—¶ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡è¶…è¿‡äº†corePoolSizeä¸”å°äºmaximumPoolSizeï¼Œå¹¶ä¸”workQueueå·²æ»¡æ—¶ï¼Œåˆ™å¯ä»¥å¢åŠ å·¥ä½œçº¿ç¨‹ï¼Œä½†è¿™æ—¶å¦‚æœè¶…æ—¶æ²¡æœ‰è·å–åˆ°ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯timedOutä¸ºtrueçš„æƒ…å†µï¼Œè¯´æ˜workQueueå·²ç»ä¸ºç©ºäº†ï¼Œä¹Ÿå°±è¯´æ˜äº†å½“å‰çº¿ç¨‹æ± ä¸­ä¸éœ€è¦é‚£ä¹ˆå¤šçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡äº†ï¼Œå¯ä»¥æŠŠå¤šäºcorePoolSizeæ•°é‡çš„çº¿ç¨‹é”€æ¯æ‰ï¼Œä¿æŒçº¿ç¨‹æ•°é‡åœ¨corePoolSizeå³å¯ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™ä¼šé”€æ¯ï¼Ÿå½“ç„¶æ˜¯runWorkeræ–¹æ³•æ‰§è¡Œå®Œä¹‹åï¼Œä¹Ÿå°±æ˜¯Workerä¸­çš„runæ–¹æ³•æ‰§è¡Œå®Œï¼Œç”±JVMè‡ªåŠ¨å›æ”¶ã€‚</p>
<p>getTaskæ–¹æ³•è¿”å›nullæ—¶ï¼Œåœ¨runWorkeræ–¹æ³•ä¸­ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œç„¶åä¼šæ‰§è¡ŒprocessWorkerExitæ–¹æ³•ã€‚</p>
<h3 id="processWorkerExitæ–¹æ³•"><a href="#processWorkerExitæ–¹æ³•" class="headerlink" title="processWorkerExitæ–¹æ³•"></a>processWorkerExitæ–¹æ³•</h3><pre class="line-numbers language-none"><code class="language-none">private void processWorkerExit(Worker w, boolean completedAbruptly) &#123;
    &#x2F;&#x2F; å¦‚æœcompletedAbruptlyå€¼ä¸ºtrueï¼Œåˆ™è¯´æ˜çº¿ç¨‹æ‰§è¡Œæ—¶å‡ºç°äº†å¼‚å¸¸ï¼Œéœ€è¦å°†workerCountå‡1ï¼›
    &#x2F;&#x2F; å¦‚æœçº¿ç¨‹æ‰§è¡Œæ—¶æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œè¯´æ˜åœ¨getTask()æ–¹æ³•ä¸­å·²ç»å·²ç»å¯¹workerCountè¿›è¡Œäº†å‡1æ“ä½œï¼Œè¿™é‡Œå°±ä¸å¿…å†å‡äº†ã€‚  
    if (completedAbruptly) &#x2F;&#x2F; If abrupt, then workerCount wasn&#39;t adjusted
        decrementWorkerCount();

    final ReentrantLock mainLock &#x3D; this.mainLock;
    mainLock.lock();
    try &#123;
        &#x2F;&#x2F;ç»Ÿè®¡å®Œæˆçš„ä»»åŠ¡æ•°
        completedTaskCount +&#x3D; w.completedTasks;
        &#x2F;&#x2F; ä»workersä¸­ç§»é™¤ï¼Œä¹Ÿå°±è¡¨ç¤ºç€ä»çº¿ç¨‹æ± ä¸­ç§»é™¤äº†ä¸€ä¸ªå·¥ä½œçº¿ç¨‹
        workers.remove(w);
    &#125; finally &#123;
        mainLock.unlock();
    &#125;

    &#x2F;&#x2F; æ ¹æ®çº¿ç¨‹æ± çŠ¶æ€è¿›è¡Œåˆ¤æ–­æ˜¯å¦ç»“æŸçº¿ç¨‹æ± 
    tryTerminate();

    int c &#x3D; ctl.get();
    &#x2F;*
     * å½“çº¿ç¨‹æ± æ˜¯RUNNINGæˆ–SHUTDOWNçŠ¶æ€æ—¶ï¼Œå¦‚æœworkeræ˜¯å¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šç›´æ¥addWorkerï¼›
     * å¦‚æœallowCoreThreadTimeOut&#x3D;trueï¼Œå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—æœ‰ä»»åŠ¡ï¼Œè‡³å°‘ä¿ç•™ä¸€ä¸ªworkerï¼›
     * å¦‚æœallowCoreThreadTimeOut&#x3D;falseï¼ŒworkerCountä¸å°‘äºcorePoolSizeã€‚
     *&#x2F;
    if (runStateLessThan(c, STOP)) &#123;
        if (!completedAbruptly) &#123;
            int min &#x3D; allowCoreThreadTimeOut ? 0 : corePoolSize;
            if (min &#x3D;&#x3D; 0 &amp;&amp; ! workQueue.isEmpty())
                min &#x3D; 1;
            if (workerCountOf(c) &gt;&#x3D; min)
                return; &#x2F;&#x2F; replacement not needed
        &#125;
        addWorker(null, false);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è‡³æ­¤ï¼ŒprocessWorkerExitæ‰§è¡Œå®Œä¹‹åï¼Œå·¥ä½œçº¿ç¨‹è¢«é”€æ¯ï¼Œä»¥ä¸Šå°±æ˜¯æ•´ä¸ªå·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»executeæ–¹æ³•å¼€å§‹ï¼ŒWorkerä½¿ç”¨ThreadFactoryåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼ŒrunWorkeré€šè¿‡getTaskè·å–ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœgetTaskè¿”å›nullï¼Œè¿›å…¥processWorkerExitæ–¹æ³•ï¼Œæ•´ä¸ªçº¿ç¨‹ç»“æŸï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://www.ideabuffer.cn/2017/04/04/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9AThreadPoolExecutor/threadpool-lifecycle.png" alt="threadpool-lifecycle.png"></p>
<h3 id="tryTerminateæ–¹æ³•"><a href="#tryTerminateæ–¹æ³•" class="headerlink" title="tryTerminateæ–¹æ³•"></a>tryTerminateæ–¹æ³•</h3><p>tryTerminateæ–¹æ³•æ ¹æ®çº¿ç¨‹æ± çŠ¶æ€è¿›è¡Œåˆ¤æ–­æ˜¯å¦ç»“æŸçº¿ç¨‹æ± ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">final void tryTerminate() &#123;
    for (;;) &#123;
        int c &#x3D; ctl.get();
        &#x2F;*
         * å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µæ—¶ï¼Œç›´æ¥è¿”å›ï¼š
         * 1. RUNNINGï¼Œå› ä¸ºè¿˜åœ¨è¿è¡Œä¸­ï¼Œä¸èƒ½åœæ­¢ï¼›
         * 2. TIDYINGæˆ–TERMINATEDï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­å·²ç»æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹äº†ï¼›
         * 3. SHUTDOWNå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—éç©ºï¼Œè¿™æ—¶è¦æ‰§è¡Œå®ŒworkQueueä¸­çš„taskï¼›
         *&#x2F;
        if (isRunning(c) ||
            runStateAtLeast(c, TIDYING) ||
            (runStateOf(c) &#x3D;&#x3D; SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))
            return;
        &#x2F;&#x2F; å¦‚æœçº¿ç¨‹æ•°é‡ä¸ä¸º0ï¼Œåˆ™ä¸­æ–­ä¸€ä¸ªç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶è¿”å›
        if (workerCountOf(c) !&#x3D; 0) &#123; &#x2F;&#x2F; Eligible to terminate
            interruptIdleWorkers(ONLY_ONE);
            return;
        &#125;

        final ReentrantLock mainLock &#x3D; this.mainLock;
        mainLock.lock();
        try &#123;
            &#x2F;&#x2F; è¿™é‡Œå°è¯•è®¾ç½®çŠ¶æ€ä¸ºTIDYINGï¼Œå¦‚æœè®¾ç½®æˆåŠŸï¼Œåˆ™è°ƒç”¨terminatedæ–¹æ³•
            if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) &#123;
                try &#123;
                    &#x2F;&#x2F; terminatedæ–¹æ³•é»˜è®¤ä»€ä¹ˆéƒ½ä¸åšï¼Œç•™ç»™å­ç±»å®ç°
                    terminated();
                &#125; finally &#123;
                    &#x2F;&#x2F; è®¾ç½®çŠ¶æ€ä¸ºTERMINATED
                    ctl.set(ctlOf(TERMINATED, 0));
                    termination.signalAll();
                &#125;
                return;
            &#125;
        &#125; finally &#123;
            mainLock.unlock();
        &#125;
        &#x2F;&#x2F; else retry on failed CAS
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>interruptIdleWorkers(ONLY_ONE);</code>çš„ä½œç”¨æ˜¯å› ä¸ºåœ¨getTaskæ–¹æ³•ä¸­æ‰§è¡Œ<code>workQueue.take()</code>æ—¶ï¼Œå¦‚æœä¸æ‰§è¡Œä¸­æ–­ä¼šä¸€ç›´é˜»å¡ã€‚åœ¨ä¸‹é¢ä»‹ç»çš„shutdownæ–¹æ³•ä¸­ï¼Œä¼šä¸­æ–­æ‰€æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœåœ¨æ‰§è¡Œshutdownæ—¶å·¥ä½œçº¿ç¨‹æ²¡æœ‰ç©ºé—²ï¼Œç„¶ååˆå»è°ƒç”¨äº†getTaskæ–¹æ³•ï¼Œè¿™æ—¶å¦‚æœworkQueueä¸­æ²¡æœ‰ä»»åŠ¡äº†ï¼Œè°ƒç”¨<code>workQueue.take()</code>æ—¶å°±ä¼šä¸€ç›´é˜»å¡ã€‚æ‰€ä»¥æ¯æ¬¡åœ¨å·¥ä½œçº¿ç¨‹ç»“æŸæ—¶è°ƒç”¨tryTerminateæ–¹æ³•æ¥å°è¯•ä¸­æ–­ä¸€ä¸ªç©ºé—²å·¥ä½œçº¿ç¨‹ï¼Œé¿å…åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶å–ä»»åŠ¡ä¸€ç›´é˜»å¡çš„æƒ…å†µã€‚</p>
<h3 id="shutdownæ–¹æ³•"><a href="#shutdownæ–¹æ³•" class="headerlink" title="shutdownæ–¹æ³•"></a>shutdownæ–¹æ³•</h3><p>shutdownæ–¹æ³•è¦å°†çº¿ç¨‹æ± åˆ‡æ¢åˆ°SHUTDOWNçŠ¶æ€ï¼Œå¹¶è°ƒç”¨interruptIdleWorkersæ–¹æ³•è¯·æ±‚ä¸­æ–­æ‰€æœ‰ç©ºé—²çš„workerï¼Œæœ€åè°ƒç”¨tryTerminateå°è¯•ç»“æŸçº¿ç¨‹æ± ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">public void shutdown() &#123;
    final ReentrantLock mainLock &#x3D; this.mainLock;
    mainLock.lock();
    try &#123;
        &#x2F;&#x2F; å®‰å…¨ç­–ç•¥åˆ¤æ–­
        checkShutdownAccess();
        &#x2F;&#x2F; åˆ‡æ¢çŠ¶æ€ä¸ºSHUTDOWN
        advanceRunState(SHUTDOWN);
        &#x2F;&#x2F; ä¸­æ–­ç©ºé—²çº¿ç¨‹
        interruptIdleWorkers();
        onShutdown(); &#x2F;&#x2F; hook for ScheduledThreadPoolExecutor
    &#125; finally &#123;
        mainLock.unlock();
    &#125;
    &#x2F;&#x2F; å°è¯•ç»“æŸçº¿ç¨‹æ± 
    tryTerminate();
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šåœ¨runWorkeræ–¹æ³•ä¸­ï¼Œæ‰§è¡Œä»»åŠ¡æ—¶å¯¹Workerå¯¹è±¡wè¿›è¡Œäº†lockæ“ä½œï¼Œä¸ºä»€ä¹ˆè¦åœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™å¯¹æ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½åŠ é”å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢ä»”ç»†åˆ†æä¸€ä¸‹ï¼š</p>
<ul>
<li>åœ¨getTaskæ–¹æ³•ä¸­ï¼Œå¦‚æœè¿™æ—¶çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯SHUTDOWNå¹¶ä¸”workQueueä¸ºç©ºï¼Œé‚£ä¹ˆå°±åº”è¯¥è¿”å›nullæ¥ç»“æŸè¿™ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œè€Œä½¿çº¿ç¨‹æ± è¿›å…¥SHUTDOWNçŠ¶æ€éœ€è¦è°ƒç”¨shutdownæ–¹æ³•ï¼›</li>
<li>shutdownæ–¹æ³•ä¼šè°ƒç”¨interruptIdleWorkersæ¥ä¸­æ–­ç©ºé—²çš„çº¿ç¨‹ï¼ŒinterruptIdleWorkersæŒæœ‰mainLockï¼Œä¼šéå†workersæ¥é€ä¸ªåˆ¤æ–­å·¥ä½œçº¿ç¨‹æ˜¯å¦ç©ºé—²ã€‚ä½†getTaskæ–¹æ³•ä¸­æ²¡æœ‰mainLockï¼›</li>
<li>åœ¨getTaskä¸­ï¼Œå¦‚æœåˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€æ˜¯RUNNINGï¼Œå¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆä¼šè°ƒç”¨<code>workQueue.take()</code>è¿›è¡Œé˜»å¡ï¼›</li>
<li>å¦‚æœåœ¨åˆ¤æ–­å½“å‰çº¿ç¨‹æ± çŠ¶æ€æ˜¯RUNNINGåï¼Œè¿™æ—¶è°ƒç”¨äº†shutdownæ–¹æ³•æŠŠçŠ¶æ€æ”¹ä¸ºäº†SHUTDOWNï¼Œè¿™æ—¶å¦‚æœä¸è¿›è¡Œä¸­æ–­ï¼Œé‚£ä¹ˆå½“å‰çš„å·¥ä½œçº¿ç¨‹åœ¨è°ƒç”¨äº†<code>workQueue.take()</code>åä¼šä¸€ç›´é˜»å¡è€Œä¸ä¼šè¢«é”€æ¯ï¼Œå› ä¸ºåœ¨SHUTDOWNçŠ¶æ€ä¸‹ä¸å…è®¸å†æœ‰æ–°çš„ä»»åŠ¡æ·»åŠ åˆ°workQueueä¸­ï¼Œè¿™æ ·ä¸€æ¥çº¿ç¨‹æ± æ°¸è¿œéƒ½å…³é—­ä¸äº†äº†ï¼›</li>
<li>ç”±ä¸Šå¯çŸ¥ï¼Œshutdownæ–¹æ³•ä¸getTaskæ–¹æ³•ï¼ˆä»é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ—¶ï¼‰å­˜åœ¨ç«æ€æ¡ä»¶ï¼›</li>
<li>è§£å†³è¿™ä¸€é—®é¢˜å°±éœ€è¦ç”¨åˆ°çº¿ç¨‹çš„ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦ç”¨interruptIdleWorkersæ–¹æ³•ã€‚åœ¨è°ƒç”¨<code>workQueue.take()</code>æ—¶ï¼Œå¦‚æœå‘ç°å½“å‰çº¿ç¨‹åœ¨æ‰§è¡Œä¹‹å‰æˆ–è€…æ‰§è¡ŒæœŸé—´æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œåˆ™ä¼šæŠ›å‡ºInterruptedExceptionï¼Œè§£é™¤é˜»å¡çš„çŠ¶æ€ï¼›</li>
<li>ä½†æ˜¯è¦ä¸­æ–­å·¥ä½œçº¿ç¨‹ï¼Œè¿˜è¦åˆ¤æ–­å·¥ä½œçº¿ç¨‹æ˜¯å¦æ˜¯ç©ºé—²çš„ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ­£åœ¨å¤„ç†ä»»åŠ¡ï¼Œå°±ä¸åº”è¯¥å‘ç”Ÿä¸­æ–­ï¼›</li>
<li>æ‰€ä»¥Workerç»§æ‰¿è‡ªAQSï¼Œåœ¨å·¥ä½œçº¿ç¨‹å¤„ç†ä»»åŠ¡æ—¶ä¼šè¿›è¡Œlockï¼ŒinterruptIdleWorkersåœ¨è¿›è¡Œä¸­æ–­æ—¶ä¼šä½¿ç”¨tryLockæ¥åˆ¤æ–­è¯¥å·¥ä½œçº¿ç¨‹æ˜¯å¦æ­£åœ¨å¤„ç†ä»»åŠ¡ï¼Œå¦‚æœtryLockè¿”å›trueï¼Œè¯´æ˜è¯¥å·¥ä½œçº¿ç¨‹å½“å‰æœªæ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ—¶æ‰å¯ä»¥è¢«ä¸­æ–­ã€‚</li>
</ul>
<p>ä¸‹é¢å°±æ¥åˆ†æä¸€ä¸‹interruptIdleWorkersæ–¹æ³•ã€‚</p>
<h3 id="interruptIdleWorkersæ–¹æ³•"><a href="#interruptIdleWorkersæ–¹æ³•" class="headerlink" title="interruptIdleWorkersæ–¹æ³•"></a>interruptIdleWorkersæ–¹æ³•</h3><pre class="line-numbers language-none"><code class="language-none">private void interruptIdleWorkers() &#123;
    interruptIdleWorkers(false);
&#125;

private void interruptIdleWorkers(boolean onlyOne) &#123;
    final ReentrantLock mainLock &#x3D; this.mainLock;
    mainLock.lock();
    try &#123;
        for (Worker w : workers) &#123;
            Thread t &#x3D; w.thread;
            if (!t.isInterrupted() &amp;&amp; w.tryLock()) &#123;
                try &#123;
                    t.interrupt();
                &#125; catch (SecurityException ignore) &#123;
                &#125; finally &#123;
                    w.unlock();
                &#125;
            &#125;
            if (onlyOne)
                break;
        &#125;
    &#125; finally &#123;
        mainLock.unlock();
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>interruptIdleWorkerséå†workersä¸­æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œè‹¥çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­tryLockæˆåŠŸï¼Œå°±ä¸­æ–­è¯¥çº¿ç¨‹ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦æŒæœ‰mainLockï¼Ÿå› ä¸ºworkersæ˜¯HashSetç±»å‹çš„ï¼Œä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h3 id="shutdownNowæ–¹æ³•"><a href="#shutdownNowæ–¹æ³•" class="headerlink" title="shutdownNowæ–¹æ³•"></a>shutdownNowæ–¹æ³•</h3><pre class="line-numbers language-none"><code class="language-none">public List&lt;Runnable&gt; shutdownNow() &#123;
    List&lt;Runnable&gt; tasks;
    final ReentrantLock mainLock &#x3D; this.mainLock;
    mainLock.lock();
    try &#123;
        checkShutdownAccess();
        advanceRunState(STOP);
        &#x2F;&#x2F; ä¸­æ–­æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦ç©ºé—²
        interruptWorkers();
        &#x2F;&#x2F; å–å‡ºé˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡
        tasks &#x3D; drainQueue();
    &#125; finally &#123;
        mainLock.unlock();
    &#125;
    tryTerminate();
    return tasks;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>shutdownNowæ–¹æ³•ä¸shutdownæ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼š</p>
<ol>
<li>è®¾ç½®çŠ¶æ€ä¸ºSTOPï¼›</li>
<li>ä¸­æ–­æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æ˜¯ç©ºé—²çš„ï¼›</li>
<li>å–å‡ºé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿”å›ã€‚</li>
</ol>
<p>shutdownNowæ–¹æ³•æ‰§è¡Œå®Œä¹‹åè°ƒç”¨tryTerminateæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨ä¸Šæ–‡å·²ç»åˆ†æè¿‡äº†ï¼Œç›®çš„å°±æ˜¯ä½¿çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®ä¸ºTERMINATEDã€‚</p>
<h2 id="çº¿ç¨‹æ± çš„ç›‘æ§"><a href="#çº¿ç¨‹æ± çš„ç›‘æ§" class="headerlink" title="çº¿ç¨‹æ± çš„ç›‘æ§"></a>çº¿ç¨‹æ± çš„ç›‘æ§</h2><p>é€šè¿‡çº¿ç¨‹æ± æä¾›çš„å‚æ•°è¿›è¡Œç›‘æ§ã€‚çº¿ç¨‹æ± é‡Œæœ‰ä¸€äº›å±æ€§åœ¨ç›‘æ§çº¿ç¨‹æ± çš„æ—¶å€™å¯ä»¥ä½¿ç”¨</p>
<ul>
<li><strong>getTaskCount</strong>ï¼šçº¿ç¨‹æ± å·²ç»æ‰§è¡Œçš„å’Œæœªæ‰§è¡Œçš„ä»»åŠ¡æ€»æ•°ï¼›</li>
<li><strong>getCompletedTaskCount</strong>ï¼šçº¿ç¨‹æ± å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼Œè¯¥å€¼å°äºç­‰äºtaskCountï¼›</li>
<li><strong>getLargestPoolSize</strong>ï¼šçº¿ç¨‹æ± æ›¾ç»åˆ›å»ºè¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡è¿™ä¸ªæ•°æ®å¯ä»¥çŸ¥é“çº¿ç¨‹æ± æ˜¯å¦æ»¡è¿‡ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº†maximumPoolSizeï¼›</li>
<li><strong>getPoolSize</strong>ï¼šçº¿ç¨‹æ± å½“å‰çš„çº¿ç¨‹æ•°é‡ï¼›</li>
<li><strong>getActiveCount</strong>ï¼šå½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ã€‚</li>
</ul>
<p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥å¯¹çº¿ç¨‹æ± è¿›è¡Œç›‘æ§ï¼Œåœ¨ThreadPoolExecutorç±»ä¸­æä¾›äº†å‡ ä¸ªç©ºæ–¹æ³•ï¼Œå¦‚beforeExecuteæ–¹æ³•ï¼ŒafterExecuteæ–¹æ³•å’Œterminatedæ–¹æ³•ï¼Œå¯ä»¥æ‰©å±•è¿™äº›æ–¹æ³•åœ¨æ‰§è¡Œå‰æˆ–æ‰§è¡Œåå¢åŠ ä¸€äº›æ–°çš„æ“ä½œï¼Œä¾‹å¦‚ç»Ÿè®¡çº¿ç¨‹æ± çš„æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ç­‰ï¼Œå¯ä»¥ç»§æ‰¿è‡ªThreadPoolExecutoræ¥è¿›è¡Œæ‰©å±•ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡æ¯”è¾ƒè¯¦ç»†çš„åˆ†æäº†çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Œæ€»ä½“æ¥è¯´æœ‰å¦‚ä¸‹å‡ ä¸ªå†…å®¹ï¼š</p>
<ul>
<li>åˆ†æäº†çº¿ç¨‹çš„åˆ›å»ºï¼Œä»»åŠ¡çš„æäº¤ï¼ŒçŠ¶æ€çš„è½¬æ¢ä»¥åŠçº¿ç¨‹æ± çš„å…³é—­ï¼›</li>
<li>è¿™é‡Œé€šè¿‡executeæ–¹æ³•æ¥å±•å¼€çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹ï¼Œexecuteæ–¹æ³•é€šè¿‡corePoolSizeï¼ŒmaximumPoolSizeä»¥åŠé˜»å¡é˜Ÿåˆ—çš„å¤§å°æ¥åˆ¤æ–­å†³å®šä¼ å…¥çš„ä»»åŠ¡åº”è¯¥è¢«ç«‹å³æ‰§è¡Œï¼Œè¿˜æ˜¯åº”è¯¥æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè¿˜æ˜¯åº”è¯¥æ‹’ç»ä»»åŠ¡ã€‚</li>
<li>ä»‹ç»äº†çº¿ç¨‹æ± å…³é—­æ—¶çš„è¿‡ç¨‹ï¼Œä¹Ÿåˆ†æäº†shutdownæ–¹æ³•ä¸getTaskæ–¹æ³•å­˜åœ¨ç«æ€æ¡ä»¶ï¼›</li>
<li>åœ¨è·å–ä»»åŠ¡æ—¶ï¼Œè¦é€šè¿‡çº¿ç¨‹æ± çš„çŠ¶æ€æ¥åˆ¤æ–­åº”è¯¥ç»“æŸå·¥ä½œçº¿ç¨‹è¿˜æ˜¯é˜»å¡çº¿ç¨‹ç­‰å¾…æ–°çš„ä»»åŠ¡ï¼Œä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå…³é—­çº¿ç¨‹æ± æ—¶è¦ä¸­æ–­å·¥ä½œçº¿ç¨‹ä»¥åŠä¸ºä»€ä¹ˆæ¯ä¸€ä¸ªworkeréƒ½éœ€è¦lockã€‚</li>
</ul>
<p>åœ¨å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æ—¶ï¼Œé™¤äº†executeæ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªsubmitæ–¹æ³•ï¼Œsubmitæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªFutureå¯¹è±¡ç”¨äºè·å–è¿”å›å€¼ï¼Œæœ‰å…³Futureå’ŒCallableè¯·è‡ªè¡Œäº†è§£ä¸€ä¸‹ç›¸å…³çš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>çº¿ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆ</title>
    <url>/2020/01/26/jpa/jpa-zai-bu-tong-shu-ju-ku-lei-xia-id-sheng-cheng-ce-lue-gua-pei-fang-an/</url>
    <content><![CDATA[<h1 id="JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆâ€”â€”æŠ€æœ¯è§£å†³æ–¹æ¡ˆ"><a href="#JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆâ€”â€”æŠ€æœ¯è§£å†³æ–¹æ¡ˆ" class="headerlink" title="JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆâ€”â€”æŠ€æœ¯è§£å†³æ–¹æ¡ˆ"></a>JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆâ€”â€”æŠ€æœ¯è§£å†³æ–¹æ¡ˆ</h1><span id="more"></span>
<div class="pdf-container" style="width: 100%; height: 600px; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe src="./JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆ.pdf" width="100%" height="100%" frameborder="0" style="border: none; border-radius: 8px;">
      <div style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 8px;">
        <p style="margin: 0; color: #666;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºPDFæ–‡ä»¶</p>
        <a href="./JPAåœ¨ä¸åŒæ•°æ®åº“ç±»ä¸‹IDç”Ÿæˆç­–ç•¥é€‚é…æ–¹æ¡ˆ.pdf" target="_blank" style="color: #409eff; text-decoration: none; font-weight: 500;">ğŸ“¥ ç‚¹å‡»è¿™é‡Œä¸‹è½½PDFæ–‡ä»¶</a>
      </div>
    </iframe>
  </div>]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>JPA</tag>
      </tags>
  </entry>
  <entry>
    <title>Kube-Prometheusç›‘æ§Nacosï¼ˆäº”ï¼‰</title>
    <url>/2023/05/09/k8s/kube-prometheus-jian-kong-nacos/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kube-Prometheus ç›‘æ§ Nacos æœåŠ¡ã€‚Nacos è‡ªå¸¦ Prometheus æŒ‡æ ‡æ¥å£ï¼Œæ— éœ€é¢å¤–éƒ¨ç½² Exporterï¼Œåªéœ€é€šè¿‡ Endpoint å’Œ ServiceMonitor é…ç½®å³å¯å®ç°ç›‘æ§ã€‚</p>
<p><strong>ç›‘æ§æ–¹å¼ï¼š</strong></p>
<ul>
<li>Nacos å†…ç½®äº† Micrometer æŒ‡æ ‡ï¼Œé€šè¿‡ <code>/nacos/actuator/prometheus</code> æ¥å£æš´éœ²</li>
<li>ä½¿ç”¨ Endpoints æ‰‹åŠ¨æŒ‡å®š Nacos é›†ç¾¤èŠ‚ç‚¹ IP</li>
<li>é€šè¿‡ ServiceMonitor é…ç½® Prometheus é‡‡é›†è§„åˆ™</li>
</ul>
<h2 id="äºŒã€é…ç½®éƒ¨ç½²"><a href="#äºŒã€é…ç½®éƒ¨ç½²" class="headerlink" title="äºŒã€é…ç½®éƒ¨ç½²"></a>äºŒã€é…ç½®éƒ¨ç½²</h2><h3 id="2-1-åˆ›å»º-Endpoints"><a href="#2-1-åˆ›å»º-Endpoints" class="headerlink" title="2.1 åˆ›å»º Endpoints"></a>2.1 åˆ›å»º Endpoints</h3><p>ç”±äº Nacos é€šå¸¸éƒ¨ç½²åœ¨ K8s é›†ç¾¤å¤–éƒ¨ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º Endpoints æŒ‡å‘ Nacos æœåŠ¡å™¨ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Endpoints
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">subsets</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> <span class="token comment"># åˆ—ä¸¾ nacos çš„æœºå™¨çš„ip1</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> <span class="token comment"># åˆ—ä¸¾ nacos çš„æœºå™¨çš„ip2 ...</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8848</span>  <span class="token comment"># nacos-exporter ç«¯å£</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>addresses</code>ï¼šåˆ—ä¸¾æ‰€æœ‰ Nacos é›†ç¾¤èŠ‚ç‚¹çš„ IP åœ°å€</li>
<li><code>port: 8848</code>ï¼šNacos é»˜è®¤ç«¯å£ï¼Œä¹Ÿæ˜¯ Prometheus æŒ‡æ ‡æš´éœ²ç«¯å£</li>
</ul>
<h3 id="2-2-åˆ›å»º-Service"><a href="#2-2-åˆ›å»º-Service" class="headerlink" title="2.2 åˆ›å»º Service"></a>2.2 åˆ›å»º Service</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>exporter
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">version</span><span class="token punctuation">:</span> 1.4.4
    <span class="token key atrule">platform</span><span class="token punctuation">:</span> mos
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8848</span>  <span class="token comment"># nacos-exporter ç«¯å£</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li>Service ä¸éœ€è¦ selectorï¼Œå› ä¸ºå®ƒå…³è”çš„æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ Endpoints</li>
<li><code>platform: mos</code>ï¼šè‡ªå®šä¹‰æ ‡ç­¾ï¼Œç”¨äºç¯å¢ƒåŒºåˆ†</li>
</ul>
<h3 id="2-3-åˆ›å»º-ServiceMonitor"><a href="#2-3-åˆ›å»º-ServiceMonitor" class="headerlink" title="2.3 åˆ›å»º ServiceMonitor"></a>2.3 åˆ›å»º ServiceMonitor</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceMonitor
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">interval</span><span class="token punctuation">:</span> 15s
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /nacos/actuator/prometheus
    <span class="token key atrule">port</span><span class="token punctuation">:</span> http
  <span class="token key atrule">targetLabels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>platform<span class="token punctuation">]</span>
  <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchNames</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> monitoring
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>exporter
      <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>path: /nacos/actuator/prometheus</code>ï¼šNacos çš„ Prometheus æŒ‡æ ‡è·¯å¾„</li>
<li><code>interval: 15s</code>ï¼šæ¯ 15 ç§’é‡‡é›†ä¸€æ¬¡æŒ‡æ ‡</li>
<li><code>targetLabels</code>ï¼šå°† Service çš„ <code>platform</code> æ ‡ç­¾æ·»åŠ åˆ°é‡‡é›†çš„æŒ‡æ ‡ä¸­</li>
</ul>
<h2 id="ä¸‰ã€éªŒè¯éƒ¨ç½²"><a href="#ä¸‰ã€éªŒè¯éƒ¨ç½²" class="headerlink" title="ä¸‰ã€éªŒè¯éƒ¨ç½²"></a>ä¸‰ã€éªŒè¯éƒ¨ç½²</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ£€æŸ¥ Endpoints æ˜¯å¦åˆ›å»ºæˆåŠŸ</span>
kubectl get endpoints nacos-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æ£€æŸ¥ Service çŠ¶æ€</span>
kubectl get svc nacos-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æ£€æŸ¥ ServiceMonitor</span>
kubectl get servicemonitor nacos-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æµ‹è¯•è®¿é—® Nacos æŒ‡æ ‡æ¥å£</span>
<span class="token function">curl</span> http://<span class="token operator">&lt;</span>nacos-ip<span class="token operator">></span>:8848/nacos/actuator/prometheus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h2><p>Nacos æä¾›çš„æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š</p>
<ul>
<li><code>nacos_monitor&#123;name=&quot;serviceCount&quot;&#125;</code>ï¼šæœåŠ¡æ•°é‡</li>
<li><code>nacos_monitor&#123;name=&quot;instanceCount&quot;&#125;</code>ï¼šå®ä¾‹æ•°é‡</li>
<li><code>nacos_monitor&#123;name=&quot;configCount&quot;&#125;</code>ï¼šé…ç½®æ•°é‡</li>
<li><code>nacos_monitor&#123;name=&quot;publishSuccessCount&quot;&#125;</code>ï¼šé…ç½®å‘å¸ƒæˆåŠŸæ¬¡æ•°</li>
<li><code>nacos_monitor&#123;name=&quot;publishFailCount&quot;&#125;</code>ï¼šé…ç½®å‘å¸ƒå¤±è´¥æ¬¡æ•°</li>
<li><code>http_server_requests_seconds_*</code>ï¼šHTTP è¯·æ±‚çš„å“åº”æ—¶é—´ç»Ÿè®¡</li>
<li><code>jvm_*</code>ï¼šJVM ç›¸å…³æŒ‡æ ‡ï¼ˆå†…å­˜ã€çº¿ç¨‹ã€GC ç­‰ï¼‰</li>
</ul>
<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>Nacos ç‰ˆæœ¬è¦æ±‚</strong>ï¼šNacos 1.4.0 åŠä»¥ä¸Šç‰ˆæœ¬æ‰æ”¯æŒ Prometheus æŒ‡æ ‡æš´éœ²</li>
<li><strong>ç½‘ç»œè®¿é—®</strong>ï¼šç¡®ä¿ K8s é›†ç¾¤èƒ½å¤Ÿè®¿é—® Nacos æœåŠ¡å™¨çš„ 8848 ç«¯å£</li>
<li><strong>å¤šèŠ‚ç‚¹é…ç½®</strong>ï¼šNacos é›†ç¾¤éœ€è¦åœ¨ Endpoints ä¸­åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹ IP</li>
<li><strong>æŒ‡æ ‡è·¯å¾„</strong>ï¼šä¸åŒ Nacos ç‰ˆæœ¬å¯èƒ½æŒ‡æ ‡è·¯å¾„æœ‰å·®å¼‚ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</li>
</ol>
]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>Prometheus</tag>
        <tag>exporter</tag>
        <tag>Nacos</tag>
      </tags>
  </entry>
  <entry>
    <title>Kube-Prometheusç›‘æ§MySQLï¼ˆäºŒï¼‰</title>
    <url>/2023/05/06/k8s/kube-prometheus-jian-kong-mysql/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kube-Prometheus ç›‘æ§ MySQL æ•°æ®åº“ã€‚é€šè¿‡éƒ¨ç½² MySQL Exporterï¼Œå°† MySQL çš„æ€§èƒ½æŒ‡æ ‡æš´éœ²ç»™ Prometheus è¿›è¡Œé‡‡é›†å’Œç›‘æ§ã€‚</p>
<p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>MySQL Exporter</strong>ï¼šç”¨äºæš´éœ² MySQL æŒ‡æ ‡çš„ Exporterï¼ˆé•œåƒç‰ˆæœ¬ï¼šv0.14.0ï¼‰</li>
<li><strong>ServiceMonitor</strong>ï¼šPrometheus Operator çš„ CRDï¼Œç”¨äºæœåŠ¡å‘ç°å’ŒæŒ‡æ ‡é‡‡é›†é…ç½®</li>
</ul>
<h2 id="äºŒã€éƒ¨ç½²-MySQL-Exporter"><a href="#äºŒã€éƒ¨ç½²-MySQL-Exporter" class="headerlink" title="äºŒã€éƒ¨ç½² MySQL Exporter"></a>äºŒã€éƒ¨ç½² MySQL Exporter</h2><h3 id="2-1-åˆ›å»º-Deployment"><a href="#2-1-åˆ›å»º-Deployment" class="headerlink" title="2.1 åˆ›å»º Deployment"></a>2.1 åˆ›å»º Deployment</h3><p>é€šè¿‡ Deployment éƒ¨ç½² MySQL Exporterï¼Œéœ€è¦é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment">#è®¾ç½®å”¯ä¸€åç§°ï¼Œå»ºè®®æ·»åŠ æ•°æ®åº“å®ä¾‹ip</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span>  mysql<span class="token punctuation">-</span>exporter<span class="token punctuation">-</span>172.16.1.77 
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> v0.14.0
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
        <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> v0.14.0
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
          <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/mysqld<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>v0.14.0
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DATA_SOURCE_NAME
              <span class="token comment"># æ ¼å¼ï¼šç”¨æˆ·å:å¯†ç @(æ•°æ®åº“åœ°å€:ç«¯å£)/</span>
              <span class="token comment"># ç¤ºä¾‹ï¼šroot:password@(mysql-service.share-components:3306)/</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"root:password@(mysql-service.share-components:3306)/"</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 20m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 20Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 30Mi
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9104</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> localtime
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> localtime
          <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /usr/share/zoneinfo/Asia/Shanghai
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>DATA_SOURCE_NAME</code>ï¼šMySQL è¿æ¥ä¸²ï¼Œéœ€æ›¿æ¢ä¸ºå®é™…çš„ç”¨æˆ·åã€å¯†ç å’Œåœ°å€</li>
<li><code>resources</code>ï¼šèµ„æºé™åˆ¶ï¼Œæ ¹æ®å®é™…ç›‘æ§è§„æ¨¡è°ƒæ•´</li>
<li><code>volumeMounts</code>ï¼šæŒ‚è½½å®¿ä¸»æœºæ—¶åŒºæ–‡ä»¶ï¼Œç¡®ä¿å®¹å™¨æ—¶åŒºæ­£ç¡®</li>
</ul>
<h3 id="2-2-åˆ›å»º-Service"><a href="#2-2-åˆ›å»º-Service" class="headerlink" title="2.2 åˆ›å»º Service"></a>2.2 åˆ›å»º Service</h3><p>ä¸º MySQL Exporter åˆ›å»º Serviceï¼Œæš´éœ²ç›‘æ§ç«¯å£ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> v0.14.0
    <span class="token key atrule">platform</span><span class="token punctuation">:</span> mos
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9104</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>port: 9104</code>ï¼šMySQL Exporter é»˜è®¤æš´éœ²ç«¯å£</li>
<li><code>platform: mos</code>ï¼šè‡ªå®šä¹‰æ ‡ç­¾ï¼Œç”¨äºåŒºåˆ†ä¸åŒç¯å¢ƒ</li>
</ul>
<h3 id="2-3-åˆ›å»º-ServiceMonitor"><a href="#2-3-åˆ›å»º-ServiceMonitor" class="headerlink" title="2.3 åˆ›å»º ServiceMonitor"></a>2.3 åˆ›å»º ServiceMonitor</h3><p>ServiceMonitor ç”¨äºå‘Šè¯‰ Prometheus å¦‚ä½•é‡‡é›† MySQL Exporter çš„æŒ‡æ ‡ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceMonitor
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> v0.14.0
  <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">interval</span><span class="token punctuation">:</span> 15s
      <span class="token key atrule">port</span><span class="token punctuation">:</span> http
      <span class="token key atrule">relabelings</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> replace
          <span class="token key atrule">regex</span><span class="token punctuation">:</span> (.<span class="token important">*)</span>
          <span class="token key atrule">replacement</span><span class="token punctuation">:</span> $1
          <span class="token key atrule">sourceLabels</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> __meta_kubernetes_pod_node_name
          <span class="token key atrule">targetLabel</span><span class="token punctuation">:</span> instance
      <span class="token key atrule">scheme</span><span class="token punctuation">:</span> http
  <span class="token key atrule">jobLabel</span><span class="token punctuation">:</span> app.kubernetes.io/name
  <span class="token key atrule">targetLabels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>platform<span class="token punctuation">]</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> mysql<span class="token punctuation">-</span>exporter
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>interval: 15s</code>ï¼šæ¯ 15 ç§’é‡‡é›†ä¸€æ¬¡æŒ‡æ ‡</li>
<li><code>relabelings</code>ï¼šæŒ‡æ ‡é‡å†™è§„åˆ™ï¼Œå°† Pod èŠ‚ç‚¹åä½œä¸º instance æ ‡ç­¾å€¼</li>
<li><code>targetLabels</code>ï¼šå°† Service çš„ <code>platform</code> æ ‡ç­¾æ·»åŠ åˆ°é‡‡é›†çš„æŒ‡æ ‡ä¸­</li>
</ul>
<h2 id="ä¸‰ã€éªŒè¯éƒ¨ç½²"><a href="#ä¸‰ã€éªŒè¯éƒ¨ç½²" class="headerlink" title="ä¸‰ã€éªŒè¯éƒ¨ç½²"></a>ä¸‰ã€éªŒè¯éƒ¨ç½²</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ Deployment çŠ¶æ€</span>
kubectl get deployment mysql-exporter-172.16.1.77 <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹ Pod æ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># è®¿é—® Exporter æŒ‡æ ‡æ¥å£</span>
kubectl port-forward svc/mysql-exporter <span class="token number">9104</span>:9104 <span class="token parameter variable">-n</span> monitoring
<span class="token function">curl</span> http://localhost:9104/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h2><p>MySQL Exporter æä¾›çš„æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š</p>
<ul>
<li><code>mysql_up</code>ï¼šMySQL å®ä¾‹æ˜¯å¦å¯ç”¨</li>
<li><code>mysql_global_status_threads_connected</code>ï¼šå½“å‰è¿æ¥æ•°</li>
<li><code>mysql_global_status_queries</code>ï¼šæŸ¥è¯¢æ€»æ•°</li>
<li><code>mysql_global_status_slow_queries</code>ï¼šæ…¢æŸ¥è¯¢æ•°é‡</li>
<li><code>mysql_global_variables_max_connections</code>ï¼šæœ€å¤§è¿æ¥æ•°é…ç½®</li>
</ul>
<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>æ•°æ®åº“æƒé™</strong>ï¼šMySQL Exporter éœ€è¦çš„æœ€å°æƒé™ä¸º <code>PROCESS, REPLICATION CLIENT, SELECT</code></li>
<li><strong>å¤šå®ä¾‹ç›‘æ§</strong>ï¼šç›‘æ§å¤šä¸ª MySQL å®ä¾‹æ—¶ï¼Œéœ€ä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»ºç‹¬ç«‹çš„ Deploymentï¼Œé€šè¿‡ name åŒºåˆ†</li>
<li><strong>å®‰å…¨é…ç½®</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Secret å­˜å‚¨æ•°æ®åº“å¯†ç ï¼Œè€Œéæ˜æ–‡é…ç½®</li>
</ol>
]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>Prometheus</tag>
        <tag>exporter</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Kube-Prometheusç›‘æ§ä¸»æœºå’Œä¸­é—´ä»¶ï¼ˆä¸€ï¼‰</title>
    <url>/2023/05/05/k8s/kube-prometheus-jian-kong-zhu-ji-he-zhong-jian-jian/</url>
    <content><![CDATA[<h2 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h2><p>éšç€ä¸šåŠ¡å‘äº‘åŸç”Ÿæ¶æ„è¿ç§»ï¼ŒåŸæœ‰çš„ç›‘æ§ç³»ç»Ÿéœ€è¦å‡çº§ä»¥é€‚åº”å®¹å™¨åŒ–ç¯å¢ƒã€‚æœ¬ç³»åˆ—æ–‡ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kube-Prometheus ç›‘æ§ K8s é›†ç¾¤å¤–éƒ¨çš„ä¸»æœºå’Œä¸­é—´ä»¶æœåŠ¡ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ”¯æŒç›‘æ§ K8s é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼ˆMySQLã€Redisã€RocketMQ ç­‰ï¼‰</li>
<li>é€šè¿‡ç¯å¢ƒæ ‡ç­¾ï¼ˆplatformï¼‰åŒºåˆ†ä¸åŒç¯å¢ƒçš„ç›‘æ§æ•°æ®</li>
<li>åŸºäº Prometheus Operator çš„ ServiceMonitor æœºåˆ¶å®ç°æœåŠ¡å‘ç°</li>
</ul>
<h2 id="äºŒã€æŠ€æœ¯åŸç†"><a href="#äºŒã€æŠ€æœ¯åŸç†" class="headerlink" title="äºŒã€æŠ€æœ¯åŸç†"></a>äºŒã€æŠ€æœ¯åŸç†</h2><h3 id="2-1-K8s-è®¿é—®å¤–éƒ¨æœåŠ¡"><a href="#2-1-K8s-è®¿é—®å¤–éƒ¨æœåŠ¡" class="headerlink" title="2.1 K8s è®¿é—®å¤–éƒ¨æœåŠ¡"></a>2.1 K8s è®¿é—®å¤–éƒ¨æœåŠ¡</h3><p>K8s é›†ç¾¤å†…çš„ Pod è®¿é—®å¤–éƒ¨æœåŠ¡çš„åŸç†ï¼š</p>
<p><img src="/2023/05/05/k8s/kube-prometheus-jian-kong-zhu-ji-he-zhong-jian-jian/k8s%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1.png"></p>
<p><strong>å…³é”®æ­¥éª¤ï¼š</strong></p>
<ol>
<li>åˆ›å»º <strong>Endpoints</strong> èµ„æºï¼ŒæŒ‡å‘å¤–éƒ¨æœåŠ¡çš„ IP åœ°å€</li>
<li>åˆ›å»º <strong>Service</strong> èµ„æºï¼Œä¸é…ç½® selectorï¼Œå…³è”åˆ°æ‰‹åŠ¨åˆ›å»ºçš„ Endpoints</li>
<li>Pod é€šè¿‡ Service åç§°è®¿é—®å¤–éƒ¨æœåŠ¡</li>
</ol>
<p><img src="/2023/05/05/k8s/kube-prometheus-jian-kong-zhu-ji-he-zhong-jian-jian/k8s%E5%88%9B%E5%BB%BAService.png"></p>
<h3 id="2-2-ServiceMonitor-åŸç†"><a href="#2-2-ServiceMonitor-åŸç†" class="headerlink" title="2.2 ServiceMonitor åŸç†"></a>2.2 ServiceMonitor åŸç†</h3><p>Prometheus Operator é€šè¿‡ ServiceMonitor å®ç°æœåŠ¡å‘ç°ï¼š</p>
<p><img src="/2023/05/05/k8s/kube-prometheus-jian-kong-zhu-ji-he-zhong-jian-jian/k8s%E7%9A%84ServiceMonitor.png"></p>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li>ServiceMonitor é€šè¿‡ selector é€‰æ‹©ç›®æ ‡ Service</li>
<li>Prometheus Operator ç›‘å¬ ServiceMonitor å˜åŒ–ï¼Œæ›´æ–° Prometheus é…ç½®</li>
<li>Prometheus æ ¹æ®é…ç½®å‘ç° Endpointsï¼Œé‡‡é›†æŒ‡æ ‡æ•°æ®</li>
</ol>
<h2 id="ä¸‰ã€ç¯å¢ƒå‡†å¤‡"><a href="#ä¸‰ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ä¸‰ã€ç¯å¢ƒå‡†å¤‡"></a>ä¸‰ã€ç¯å¢ƒå‡†å¤‡</h2><h3 id="3-1-åˆ›å»ºå‘½åç©ºé—´"><a href="#3-1-åˆ›å»ºå‘½åç©ºé—´" class="headerlink" title="3.1 åˆ›å»ºå‘½åç©ºé—´"></a>3.1 åˆ›å»ºå‘½åç©ºé—´</h3><pre class="line-numbers language-none"><code class="language-none">kubectl create namespace monitoring
# æ‰§è¡Œç»“æœï¼šnamespace&#x2F;monitoring created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="é…ç½®è§’è‰²å’Œæƒé™"><a href="#é…ç½®è§’è‰²å’Œæƒé™" class="headerlink" title="é…ç½®è§’è‰²å’Œæƒé™"></a>é…ç½®è§’è‰²å’Œæƒé™</h2><h3 id="monitoring-role-yaml"><a href="#monitoring-role-yaml" class="headerlink" title="monitoring-role.yaml"></a>monitoring-role.yaml</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus<span class="token punctuation">-</span>k8s
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> mos<span class="token punctuation">-</span>monitoring
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> services
      <span class="token punctuation">-</span> endpoints
      <span class="token punctuation">-</span> pods
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> extensions
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="monitoring-role-binding-yaml"><a href="#monitoring-role-binding-yaml" class="headerlink" title="monitoring-role-binding.yaml"></a>monitoring-role-binding.yaml</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus<span class="token punctuation">-</span>k8s
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> mos<span class="token punctuation">-</span>monitoring
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus<span class="token punctuation">-</span>k8s
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus<span class="token punctuation">-</span>k8s
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li>Role å®šä¹‰äº† Prometheus åœ¨ä¸šåŠ¡å‘½åç©ºé—´ä¸­çš„è®¿é—®æƒé™</li>
<li>RoleBinding å°† Role ç»‘å®šåˆ° Prometheus çš„ ServiceAccount</li>
</ul>
<h2 id="å››ã€ç›‘æ§å®æ–½"><a href="#å››ã€ç›‘æ§å®æ–½" class="headerlink" title="å››ã€ç›‘æ§å®æ–½"></a>å››ã€ç›‘æ§å®æ–½</h2><p><strong>ç¯å¢ƒéš”ç¦»æ–¹æ¡ˆï¼š</strong><br>ä¸ºäº†åŒºåˆ†ä¸åŒç¯å¢ƒçš„ç›‘æ§æ•°æ®ï¼Œåœ¨ Service ä¸­æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾ <code>platform: &lt;env&gt;</code>ï¼Œé€šè¿‡ ServiceMonitor çš„ <code>targetLabels</code> é…ç½®å°†è¯¥æ ‡ç­¾æ·»åŠ åˆ°æŒ‡æ ‡ä¸­ã€‚</p>
<p><strong>åç»­ç« èŠ‚å†…å®¹ï¼š</strong></p>
<ul>
<li><a href="/k8s/Kube-Prometheus%E7%9B%91%E6%8E%A7MySQL/">ç›‘æ§ MySQL</a></li>
<li><a href="/k8s/Kube-Prometheus%E7%9B%91%E6%8E%A7Redis/">ç›‘æ§ Redis</a></li>
<li><a href="/k8s/Kube-Prometheus%E7%9B%91%E6%8E%A7RocketMQ/">ç›‘æ§ RocketMQ</a></li>
<li><a href="/k8s/Kube-Prometheus%E7%9B%91%E6%8E%A7Nacos/">ç›‘æ§ Nacos</a></li>
</ul>
<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>ç½‘ç»œè¿é€šæ€§</strong>ï¼šç¡®ä¿ K8s é›†ç¾¤èƒ½å¤Ÿè®¿é—®å¤–éƒ¨æœåŠ¡çš„ç½‘ç»œå’Œç«¯å£</li>
<li><strong>æƒé™é…ç½®</strong>ï¼šæ¯ä¸ªä¸šåŠ¡å‘½åç©ºé—´éƒ½éœ€è¦é…ç½® Role å’Œ RoleBinding</li>
<li><strong>æ ‡ç­¾ç»Ÿä¸€</strong>ï¼šä¿æŒæ‰€æœ‰ç›‘æ§ç»„ä»¶çš„æ ‡ç­¾ä¸€è‡´æ€§ï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥è¯¢</li>
<li><strong>ç¯å¢ƒåŒºåˆ†</strong>ï¼šé€šè¿‡ <code>platform</code> æ ‡ç­¾åŒºåˆ†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ</li>
</ol>
]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>Prometheus</tag>
        <tag>ä¸­é—´ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>k8så®¹å™¨éƒ¨ç½²æ—¶åŒºé—®é¢˜å¤„ç†</title>
    <url>/2023/11/15/k8s/k8s-rong-qi-bu-shu-shi-qu-wen-ti-chu-li/</url>
    <content><![CDATA[<h2 id="ä¸€ã€é—®é¢˜æè¿°"><a href="#ä¸€ã€é—®é¢˜æè¿°" class="headerlink" title="ä¸€ã€é—®é¢˜æè¿°"></a>ä¸€ã€é—®é¢˜æè¿°</h2><p>åœ¨ K8s ç¯å¢ƒä¸‹éƒ¨ç½²åº”ç”¨åï¼Œå‘ç°æ•°æ®åº“ä¸­è®°å½•çš„æ—¶é—´æ¯”åŒ—äº¬æ—¶é—´æ™šäº† 8 å°æ—¶ï¼Œå¯¼è‡´æŒ‰æ—¶é—´æŸ¥è¯¢æ•°æ®æ—¶æ— æ³•æŸ¥åˆ°æ­£ç¡®ç»“æœã€‚è¿™æ˜¯å…¸å‹çš„æ—¶åŒºä¸ä¸€è‡´é—®é¢˜ã€‚</p>
<p><strong>æ¶©åŠçš„æ—¶åŒºé…ç½®ç‚¹ï¼š</strong></p>
<ul>
<li>MySQL æ•°æ®åº“æœåŠ¡å™¨çš„æ—¶åŒºè®¾ç½®</li>
<li>MySQL æ•°æ®åº“æ—¶åŒºé…ç½®</li>
<li>JDBC æ•°æ®åº“è¿æ¥çš„æ—¶åŒºé…ç½®</li>
<li>åº”ç”¨æœåŠ¡å™¨æ—¶åŒºé…ç½®</li>
<li>åº”ç”¨å®¹å™¨çš„æ—¶åŒºé…ç½®</li>
</ul>
<h2 id="äºŒã€é—®é¢˜æ’æŸ¥"><a href="#äºŒã€é—®é¢˜æ’æŸ¥" class="headerlink" title="äºŒã€é—®é¢˜æ’æŸ¥"></a>äºŒã€é—®é¢˜æ’æŸ¥</h2><h3 id="2-1-æœåŠ¡å™¨æ—¶åŒºæ£€æŸ¥"><a href="#2-1-æœåŠ¡å™¨æ—¶åŒºæ£€æŸ¥" class="headerlink" title="2.1 æœåŠ¡å™¨æ—¶åŒºæ£€æŸ¥"></a>2.1 æœåŠ¡å™¨æ—¶åŒºæ£€æŸ¥</h3><p>é¦–å…ˆç¡®è®¤å„ä¸ªæœåŠ¡å™¨çš„æ—¶åŒºï¼Œä½¿ç”¨å‘½ä»¤ <code>date</code> æˆ– <code>date -R</code>ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@host-172 ~<span class="token punctuation">]</span>$ <span class="token function">date</span>
<span class="token number">2023</span>å¹´ <span class="token number">11</span>æœˆ <span class="token number">15</span>æ—¥ æ˜ŸæœŸä¸‰ <span class="token number">21</span>:19:02 CST
<span class="token punctuation">[</span>root@host-172 ~<span class="token punctuation">]</span>$ <span class="token function">date</span> <span class="token parameter variable">-R</span>
Wed, <span class="token number">15</span> Nov <span class="token number">2023</span> <span class="token number">21</span>:19:06 +0800<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç»“æœæ˜¾ç¤ºæœåŠ¡å™¨æ—¶åŒºä¸º CSTï¼ˆä¸œå…«åŒºï¼‰ã€‚</p>
<h3 id="2-2-æ•°æ®åº“æ—¶åŒºæ£€æŸ¥"><a href="#2-2-æ•°æ®åº“æ—¶åŒºæ£€æŸ¥" class="headerlink" title="2.2 æ•°æ®åº“æ—¶åŒºæ£€æŸ¥"></a>2.2 æ•°æ®åº“æ—¶åŒºæ£€æŸ¥</h3><p>åœ¨ç¡®è®¤æœåŠ¡å™¨æ—¶åŒºåï¼Œè¿›ä¸€æ­¥ç¡®è®¤æ•°æ®åº“çš„æ—¶åŒºï¼Œåœ¨æ•°æ®åº“æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%time_zone%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">variable_name</th>
<th align="left">value</th>
</tr>
</thead>
<tbody><tr>
<td align="left">system_time_zone</td>
<td align="left">CST</td>
</tr>
<tr>
<td align="left">time_zone</td>
<td align="left">SYSTEM</td>
</tr>
</tbody></table>
<p>ä¸Šè¿°æŸ¥è¯¢ç»“æœè¡¨æ˜ï¼Œæ•°æ®åº“æœåŠ¡å™¨çš„æ—¶åŒºä¸ºCSTï¼Œæ•°æ®é»˜è®¤ä½¿ç”¨æœåŠ¡å™¨çš„æ—¶åŒºåˆ™ä¹Ÿæ˜¯CSTã€‚</p>
<h3 id="2-3-Java-è·å–æ—¶åŒºæœºåˆ¶"><a href="#2-3-Java-è·å–æ—¶åŒºæœºåˆ¶" class="headerlink" title="2.3 Java è·å–æ—¶åŒºæœºåˆ¶"></a>2.3 Java è·å–æ—¶åŒºæœºåˆ¶</h3><p>åœ¨Javaä»£ç ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸‹æ–¹å¼è·å–ç³»ç»Ÿæ—¶åŒºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è·å–é»˜è®¤æ—¶åŒº</span>
<span class="token class-name">TimeZone</span> timeZone <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">sun.util.calendar.ZoneInfo[id&#x3D;&quot;Asia&#x2F;Shanghai&quot;,offset&#x3D;28800000,dstSavings&#x3D;0,useDaylight&#x3D;false,transitions&#x3D;29,lastRule&#x3D;null]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-4-Java-é»˜è®¤æ—¶åŒºè·å–é€»è¾‘"><a href="#2-4-Java-é»˜è®¤æ—¶åŒºè·å–é€»è¾‘" class="headerlink" title="2.4 Java é»˜è®¤æ—¶åŒºè·å–é€»è¾‘"></a>2.4 Java é»˜è®¤æ—¶åŒºè·å–é€»è¾‘</h3><p>Java è·å–é»˜è®¤æ—¶åŒºçš„æ­¥éª¤ï¼š</p>
<ol>
<li>æŸ¥æ‰¾ <code>TZ</code> ç¯å¢ƒå˜é‡</li>
<li>è‹¥æœªè®¾ç½®ï¼Œè¯»å– <code>/etc/timezone</code> æ–‡ä»¶</li>
<li>è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ¯”è¾ƒ <code>/etc/localtime</code> ä¸ <code>/usr/share/zoneinfo</code> ç›®å½•ä¸‹çš„æ—¶åŒºæ–‡ä»¶</li>
<li>éƒ½æœªæ‰¾åˆ°ï¼Œé»˜è®¤ä½¿ç”¨ GMT æ—¶åŒº</li>
</ol>
<blockquote>
<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/darange/p/9368245.html">Javaè¯»å–ç³»ç»Ÿé»˜è®¤æ—¶åŒº</a></p>
</blockquote>
<h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="3-1-æŒ‚è½½æ—¶åŒºæ–‡ä»¶"><a href="#3-1-æŒ‚è½½æ—¶åŒºæ–‡ä»¶" class="headerlink" title="3.1 æŒ‚è½½æ—¶åŒºæ–‡ä»¶"></a>3.1 æŒ‚è½½æ—¶åŒºæ–‡ä»¶</h3><p>å°†å®¿ä¸»æœºçš„<code>/etc/localtime</code>è·¯å¾„æŒ‚è½½åˆ°å®¹å™¨ï¼Œå¯ä»¥ä¿æŒå®¹å™¨ä¸å®¿ä¸»æœºæ—¶é—´åŒæ­¥ï¼Œé¿å…ç”±äºæ—¶é—´åŒæ­¥å¼•èµ·çš„åº”ç”¨å±‚çš„é—®é¢˜ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">labels</span><span class="token punctuation">:</span> 
    <span class="token key atrule">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
     
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>pod
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
      <span class="token key atrule">hostPath</span><span class="token punctuation">:</span> 
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>**ä½œç”¨ï¼š**å°†å®¿ä¸»æœºçš„ <code>/etc/localtime</code> è·¯å¾„æŒ‚è½½åˆ°å®¹å™¨ï¼Œä¿æŒå®¹å™¨ä¸å®¿ä¸»æœºæ—¶é—´åŒæ­¥ã€‚</p>
<h3 id="3-2-è®¾ç½®ç¯å¢ƒå˜é‡-TZ"><a href="#3-2-è®¾ç½®ç¯å¢ƒå˜é‡-TZ" class="headerlink" title="3.2 è®¾ç½®ç¯å¢ƒå˜é‡ TZ"></a>3.2 è®¾ç½®ç¯å¢ƒå˜é‡ TZ</h3><p>å³ä½¿æŒ‚è½½äº†æ—¶åŒºæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® <code>TZ</code> ç¯å¢ƒå˜é‡ï¼ŒJava åº”ç”¨å¯èƒ½ä»ç„¶ä½¿ç”¨å®¹å™¨çš„é»˜è®¤æ—¶åŒºã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>env<span class="token punctuation">-</span>tz
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ngx<span class="token punctuation">-</span>time
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TZ
        <span class="token key atrule">value</span><span class="token punctuation">:</span> Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>**ä½œç”¨ï¼š**è®¾ç½® <code>TZ</code> ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ Java åº”ç”¨èƒ½è·å–æ­£ç¡®çš„æ—¶åŒºã€‚</p>
<h3 id="3-3-å®Œæ•´é…ç½®ç¤ºä¾‹"><a href="#3-3-å®Œæ•´é…ç½®ç¤ºä¾‹" class="headerlink" title="3.3 å®Œæ•´é…ç½®ç¤ºä¾‹"></a>3.3 å®Œæ•´é…ç½®ç¤ºä¾‹</h3><p>æ¨èçš„å®¹å™¨æ—¶åŒºé…ç½®æ–¹æ¡ˆï¼ˆåŒæ—¶é…ç½®ç¯å¢ƒå˜é‡å’ŒæŒ‚è½½æ—¶åŒºæ–‡ä»¶ï¼‰ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>pod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
    <span class="token key atrule">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>app<span class="token punctuation">:</span>latest
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TZ
        <span class="token key atrule">value</span><span class="token punctuation">:</span> Asia/Shanghai
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
        <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>time
      <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€éªŒè¯æ–¹æ³•"><a href="#å››ã€éªŒè¯æ–¹æ³•" class="headerlink" title="å››ã€éªŒè¯æ–¹æ³•"></a>å››ã€éªŒè¯æ–¹æ³•</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿›å…¥å®¹å™¨</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> -- /bin/bash

<span class="token comment"># æ£€æŸ¥å®¹å™¨æ—¶åŒº</span>
<span class="token function">date</span>
<span class="token function">date</span> <span class="token parameter variable">-R</span>

<span class="token comment"># æ£€æŸ¥ TZ ç¯å¢ƒå˜é‡</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$TZ</span>

<span class="token comment"># æ£€æŸ¥ Java åº”ç”¨è·å–çš„æ—¶åŒºï¼ˆåœ¨åº”ç”¨ä»£ç ä¸­ï¼‰</span>
TimeZone.getDefault<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>åŒé‡é…ç½®</strong>ï¼šå»ºè®®åŒæ—¶é…ç½® <code>TZ</code> ç¯å¢ƒå˜é‡å’ŒæŒ‚è½½ <code>/etc/localtime</code>ï¼Œç¡®ä¿æ—¶åŒºä¸€è‡´</li>
<li><strong>æ•°æ®åº“è¿æ¥</strong>ï¼šJDBC è¿æ¥ä¸²ä¹Ÿå¯ä»¥é…ç½®æ—¶åŒºï¼Œå¦‚ <code>serverTimezone=Asia/Shanghai</code></li>
<li><strong>é•œåƒæ„å»º</strong>ï¼šå¦‚æœåœ¨ Dockerfile ä¸­è®¾ç½®æ—¶åŒºï¼Œå¯ä»¥é¿å…éƒ¨ç½²æ—¶é…ç½®</li>
<li><strong>æ—¶åŒºæ–‡ä»¶è·¯å¾„</strong>ï¼šä¸åŒçš„ Linux å‘è¡Œç‰ˆæ—¶åŒºæ–‡ä»¶è·¯å¾„å¯èƒ½ä¸åŒï¼Œæ³¨æ„é€‚é…</li>
</ol>
<h2 id="å…­ã€å‚è€ƒæ–‡ç« "><a href="#å…­ã€å‚è€ƒæ–‡ç« " class="headerlink" title="å…­ã€å‚è€ƒæ–‡ç« "></a>å…­ã€å‚è€ƒæ–‡ç« </h2><ul>
<li><a href="https://www.cnblogs.com/darange/p/9368245.html">Javaè¯»å–ç³»ç»Ÿé»˜è®¤æ—¶åŒº</a></li>
<li><a href="https://juejin.cn/post/6844903924806189063">k8s podæ—¶åŒºæ›´æ”¹</a></li>
</ul>
]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>å®¹å™¨</tag>
        <tag>æ—¶åŒº</tag>
      </tags>
  </entry>
  <entry>
    <title>Kube-Prometheusç›‘æ§RocketMQï¼ˆå››ï¼‰</title>
    <url>/2023/05/08/k8s/kube-prometheus-jian-kong-rocketmq/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kube-Prometheus ç›‘æ§ RocketMQã€‚é€šè¿‡éƒ¨ç½² RocketMQ Exporterï¼Œå°† RocketMQ çš„æ¶ˆæ¯é˜Ÿåˆ—æŒ‡æ ‡æš´éœ²ç»™ Prometheus è¿›è¡Œé‡‡é›†å’Œç›‘æ§ã€‚</p>
<p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>RocketMQ Exporter</strong>ï¼šç”¨äºæš´éœ² RocketMQ æŒ‡æ ‡çš„ Exporter</li>
<li><strong>ServiceMonitor</strong>ï¼šPrometheus Operator çš„ CRDï¼Œç”¨äºæœåŠ¡å‘ç°å’ŒæŒ‡æ ‡é‡‡é›†é…ç½®</li>
</ul>
<h2 id="äºŒã€éƒ¨ç½²-RocketMQ-Exporter"><a href="#äºŒã€éƒ¨ç½²-RocketMQ-Exporter" class="headerlink" title="äºŒã€éƒ¨ç½² RocketMQ Exporter"></a>äºŒã€éƒ¨ç½² RocketMQ Exporter</h2><h3 id="2-1-åˆ›å»º-Deployment"><a href="#2-1-åˆ›å»º-Deployment" class="headerlink" title="2.1 åˆ›å»º Deployment"></a>2.1 åˆ›å»º Deployment</h3><p>é€šè¿‡ Deployment éƒ¨ç½² RocketMQ Exporterï¼Œéœ€è¦é…ç½® NameServer åœ°å€ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
   <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
   <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
   <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">progressDeadlineSeconds</span><span class="token punctuation">:</span> <span class="token number">600</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> 25%
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> 25%
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">'--rocketmq.config.namesrvAddr=172.16.15.121:9876'</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>latest
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">5557</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 500m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1024Mi
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 10m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 512Mi
          <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
          <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /home/exporter/logs
              <span class="token key atrule">name</span><span class="token punctuation">:</span> exporter<span class="token punctuation">-</span>log
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
              <span class="token key atrule">name</span><span class="token punctuation">:</span> date<span class="token punctuation">-</span>config
      <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>secret<span class="token punctuation">-</span>harbor
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
      <span class="token key atrule">schedulerName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>scheduler
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> exporter<span class="token punctuation">-</span>log
        <span class="token punctuation">-</span> <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/localtime
            <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">''</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> date<span class="token punctuation">-</span>config
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>args</code>ï¼šRocketMQ Exporter å¯åŠ¨å‚æ•°<ul>
<li><code>--rocketmq.config.namesrvAddr</code>ï¼šRocketMQ NameServer åœ°å€ï¼Œå¤šä¸ªåœ°å€ç”¨åˆ†å·åˆ†éš”</li>
</ul>
</li>
<li><code>port: 5557</code>ï¼šRocketMQ Exporter é»˜è®¤æš´éœ²ç«¯å£</li>
<li><code>imagePullSecrets</code>ï¼šç§æœ‰é•œåƒä»“åº“çš„è®¤è¯ä¿¡æ¯</li>
<li><code>resources</code>ï¼šèµ„æºé™åˆ¶ï¼Œæ ¹æ®ç›‘æ§çš„ RocketMQ è§„æ¨¡è°ƒæ•´</li>
</ul>
<h3 id="2-2-åˆ›å»º-Service"><a href="#2-2-åˆ›å»º-Service" class="headerlink" title="2.2 åˆ›å»º Service"></a>2.2 åˆ›å»º Service</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceMonitor
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">interval</span><span class="token punctuation">:</span> 15s
      <span class="token key atrule">port</span><span class="token punctuation">:</span> http
      <span class="token key atrule">relabelings</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> replace
          <span class="token key atrule">regex</span><span class="token punctuation">:</span> (.<span class="token important">*)</span>
          <span class="token key atrule">replacement</span><span class="token punctuation">:</span> $1
          <span class="token key atrule">sourceLabels</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> __meta_kubernetes_pod_node_name
          <span class="token key atrule">targetLabel</span><span class="token punctuation">:</span> instance
      <span class="token key atrule">scheme</span><span class="token punctuation">:</span> http
  <span class="token key atrule">jobLabel</span><span class="token punctuation">:</span> app.kubernetes.io/name
  <span class="token key atrule">targetLabels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>platform<span class="token punctuation">]</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>exporter
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>interval: 15s</code>ï¼šæ¯ 15 ç§’é‡‡é›†ä¸€æ¬¡æŒ‡æ ‡</li>
<li><code>relabelings</code>ï¼šæŒ‡æ ‡é‡å†™è§„åˆ™ï¼Œå°† Pod èŠ‚ç‚¹åä½œä¸º instance æ ‡ç­¾å€¼</li>
<li><code>targetLabels</code>ï¼šå°† Service çš„ <code>platform</code> æ ‡ç­¾æ·»åŠ åˆ°é‡‡é›†çš„æŒ‡æ ‡ä¸­</li>
</ul>
<h2 id="ä¸‰ã€éªŒè¯éƒ¨ç½²"><a href="#ä¸‰ã€éªŒè¯éƒ¨ç½²" class="headerlink" title="ä¸‰ã€éªŒè¯éƒ¨ç½²"></a>ä¸‰ã€éªŒè¯éƒ¨ç½²</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ Deployment çŠ¶æ€</span>
kubectl get deployment rocketmq-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹ Pod æ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># è®¿é—® Exporter æŒ‡æ ‡æ¥å£</span>
kubectl port-forward svc/rocketmq-exporter <span class="token number">5557</span>:5557 <span class="token parameter variable">-n</span> monitoring
<span class="token function">curl</span> http://localhost:5557/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h2><p>RocketMQ Exporter æä¾›çš„æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š</p>
<ul>
<li><code>rocketmq_broker_tps</code>ï¼šBroker çš„ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰</li>
<li><code>rocketmq_broker_qps</code>ï¼šBroker çš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰</li>
<li><code>rocketmq_producer_message_size</code>ï¼šç”Ÿäº§è€…æ¶ˆæ¯å¤§å°</li>
<li><code>rocketmq_consumer_tps</code>ï¼šæ¶ˆè´¹è€… TPS</li>
<li><code>rocketmq_consumer_message_size</code>ï¼šæ¶ˆè´¹è€…æ¶ˆæ¯å¤§å°</li>
<li><code>rocketmq_group_get_latency</code>ï¼šæ¶ˆè´¹ç»„æ¶ˆè´¹å»¶è¿Ÿ</li>
<li><code>rocketmq_group_diff</code>ï¼šæ¶ˆè´¹ç»„ç§¯å‹æ¶ˆæ¯æ•°</li>
</ul>
<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>NameServer åœ°å€</strong>ï¼šéœ€è¦é…ç½®æ­£ç¡®çš„ RocketMQ NameServer åœ°å€ï¼Œæ”¯æŒå¤šä¸ªåœ°å€</li>
<li><strong>ç½‘ç»œè®¿é—®</strong>ï¼šç¡®ä¿ K8s é›†ç¾¤èƒ½å¤Ÿè®¿é—® RocketMQ NameServer</li>
<li><strong>é•œåƒå‡†å¤‡</strong>ï¼šRocketMQ Exporter éœ€è¦æå‰æ„å»ºå¹¶æ¨é€åˆ°é•œåƒä»“åº“</li>
<li><strong>èµ„æºé…ç½®</strong>ï¼šæ ¹æ® RocketMQ é›†ç¾¤è§„æ¨¡è°ƒæ•´ Exporter çš„å†…å­˜èµ„æºï¼Œé¿å… OOM</li>
</ol>
<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>interval: 15s</code>ï¼šæ¯ 15 ç§’é‡‡é›†ä¸€æ¬¡æŒ‡æ ‡</li>
<li><code>relabelings</code>ï¼šæŒ‡æ ‡é‡å†™è§„åˆ™ï¼Œå°† Pod èŠ‚ç‚¹åä½œä¸º instance æ ‡ç­¾å€¼</li>
<li><code>targetLabels</code>ï¼šå°† Service çš„ <code>platform</code> æ ‡ç­¾æ·»åŠ åˆ°é‡‡é›†çš„æŒ‡æ ‡ä¸­</li>
</ul>
<h2 id="ä¸‰ã€éªŒè¯éƒ¨ç½²-1"><a href="#ä¸‰ã€éªŒè¯éƒ¨ç½²-1" class="headerlink" title="ä¸‰ã€éªŒè¯éƒ¨ç½²"></a>ä¸‰ã€éªŒè¯éƒ¨ç½²</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ Deployment çŠ¶æ€</span>
kubectl get deployment rocketmq-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹ Pod æ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># è®¿é—® Exporter æŒ‡æ ‡æ¥å£</span>
kubectl port-forward svc/rocketmq-exporter <span class="token number">5557</span>:5557 <span class="token parameter variable">-n</span> monitoring
<span class="token function">curl</span> http://localhost:5557/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜-1"><a href="#å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜-1" class="headerlink" title="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h2><p>RocketMQ Exporter æä¾›çš„æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š</p>
<ul>
<li><code>rocketmq_broker_tps</code>ï¼šBroker çš„ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰</li>
<li><code>rocketmq_broker_qps</code>ï¼šBroker çš„ QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰</li>
<li><code>rocketmq_producer_message_size</code>ï¼šç”Ÿäº§è€…æ¶ˆæ¯å¤§å°</li>
<li><code>rocketmq_consumer_tps</code>ï¼šæ¶ˆè´¹è€… TPS</li>
<li><code>rocketmq_consumer_message_size</code>ï¼šæ¶ˆè´¹è€…æ¶ˆæ¯å¤§å°</li>
<li><code>rocketmq_group_get_latency</code>ï¼šæ¶ˆè´¹ç»„æ¶ˆè´¹å»¶è¿Ÿ</li>
<li><code>rocketmq_group_diff</code>ï¼šæ¶ˆè´¹ç»„ç§¯å‹æ¶ˆæ¯æ•°</li>
</ul>
<h2 id="äº”ã€æ³¨æ„äº‹é¡¹-1"><a href="#äº”ã€æ³¨æ„äº‹é¡¹-1" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>NameServer åœ°å€</strong>ï¼šéœ€è¦é…ç½®æ­£ç¡®çš„ RocketMQ NameServer åœ°å€ï¼Œæ”¯æŒå¤šä¸ªåœ°å€</li>
<li><strong>ç½‘ç»œè®¿é—®</strong>ï¼šç¡®ä¿ K8s é›†ç¾¤èƒ½å¤Ÿè®¿é—® RocketMQ NameServer</li>
<li><strong>é•œåƒå‡†å¤‡</strong>ï¼šRocketMQ Exporter éœ€è¦æå‰æ„å»ºå¹¶æ¨é€åˆ°é•œåƒä»“åº“</li>
<li><strong>èµ„æºé…ç½®</strong>ï¼šæ ¹æ® RocketMQ é›†ç¾¤è§„æ¨¡è°ƒæ•´ Exporter çš„å†…å­˜èµ„æºï¼Œé¿å… OOM</li>
</ol>
]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>Prometheus</tag>
        <tag>exporter</tag>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä»½k8sçš„Deploymenté…ç½®æ–‡ä»¶è¯¦è§£</title>
    <url>/2023/11/03/k8s/yi-fen-k8s-de-deployment-pei-zhi-wen-jian-xiang-jie/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>æœ¬æ–‡æä¾›ä¸€ä»½ K8s Deployment é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼Œå¹¶å¯¹å…³é”®é…ç½®é¡¹è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼Œæ–¹ä¾¿åœ¨å®é™…é¡¹ç›®éƒ¨ç½²æ—¶å‚è€ƒå’Œä½¿ç”¨ã€‚</p>
<h2 id="äºŒã€é…ç½®ç¤ºä¾‹"><a href="#äºŒã€é…ç½®ç¤ºä¾‹" class="headerlink" title="äºŒã€é…ç½®ç¤ºä¾‹"></a>äºŒã€é…ç½®ç¤ºä¾‹</h2><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server
    <span class="token key atrule">k8s.kuboard.cn/name</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server<span class="token punctuation">-</span>deployment
  <span class="token key atrule">name</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> hw<span class="token punctuation">-</span>msmp
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">'10843811'</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">progressDeadlineSeconds</span><span class="token punctuation">:</span> <span class="token number">600</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server
      <span class="token key atrule">env</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> 25%
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> 25%
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubectl.kubernetes.io/restartedAt</span><span class="token punctuation">:</span> <span class="token string">'2023-11-03T17:39:17+08:00'</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server
        <span class="token key atrule">env</span><span class="token punctuation">:</span> dev
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TZ
              <span class="token key atrule">value</span><span class="token punctuation">:</span> Asia/Shanghai
          <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'harbor.mos.com/hw/mt-server:v4.0.7'</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">name</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">'16'</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 32Gi
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">'2'</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 4Gi
          <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
          <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/mt<span class="token punctuation">-</span>server/cache
              <span class="token key atrule">name</span><span class="token punctuation">:</span> cache
              <span class="token key atrule">subPath</span><span class="token punctuation">:</span> cache
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/mt<span class="token punctuation">-</span>server/logs
              <span class="token key atrule">name</span><span class="token punctuation">:</span> cache
              <span class="token key atrule">subPath</span><span class="token punctuation">:</span> logs
      <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
      <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> host<span class="token punctuation">-</span>172.16.1.113
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
      <span class="token key atrule">schedulerName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>scheduler
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">420</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> hw2<span class="token punctuation">-</span>msmp<span class="token punctuation">-</span>config
          <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume
        <span class="token punctuation">-</span> <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /home/msmp/
            <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">''</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ä¸‰ã€é…ç½®é¡¹è¯¦è§£"><a href="#ä¸‰ã€é…ç½®é¡¹è¯¦è§£" class="headerlink" title="ä¸‰ã€é…ç½®é¡¹è¯¦è§£"></a>ä¸‰ã€é…ç½®é¡¹è¯¦è§£</h2><h3 id="3-1-å…ƒæ•°æ®-metadata"><a href="#3-1-å…ƒæ•°æ®-metadata" class="headerlink" title="3.1 å…ƒæ•°æ® (metadata)"></a>3.1 å…ƒæ•°æ® (metadata)</h3><table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>Deployment çš„åç§°ï¼Œåœ¨å‘½åç©ºé—´ä¸­å¿…é¡»å”¯ä¸€</td>
</tr>
<tr>
<td><code>namespace</code></td>
<td>æ‰€å±çš„å‘½åç©ºé—´</td>
</tr>
<tr>
<td><code>labels</code></td>
<td>æ ‡ç­¾ï¼Œç”¨äºèµ„æºçš„ç»„ç»‡å’Œé€‰æ‹©</td>
</tr>
<tr>
<td><code>annotations</code></td>
<td>æ³¨è§£ï¼Œå­˜å‚¨éè¯†åˆ«ä¿¡æ¯ï¼Œå¦‚é‡å¯æ—¶é—´ç­‰</td>
</tr>
</tbody></table>
<h3 id="3-2-è§„æ ¼é…ç½®-spec"><a href="#3-2-è§„æ ¼é…ç½®-spec" class="headerlink" title="3.2 è§„æ ¼é…ç½® (spec)"></a>3.2 è§„æ ¼é…ç½® (spec)</h3><h4 id="3-2-1-åŸºæœ¬é…ç½®"><a href="#3-2-1-åŸºæœ¬é…ç½®" class="headerlink" title="3.2.1 åŸºæœ¬é…ç½®"></a>3.2.1 åŸºæœ¬é…ç½®</h4><table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>replicas</code></td>
<td>Pod å‰¯æœ¬æ•°é‡ï¼Œæ­¤å¤„ä¸º 1</td>
</tr>
<tr>
<td><code>revisionHistoryLimit</code></td>
<td>ä¿ç•™çš„å†å²ç‰ˆæœ¬æ•°ï¼Œç”¨äºå›æ»š</td>
</tr>
<tr>
<td><code>progressDeadlineSeconds</code></td>
<td>Deployment è¿›å±•è¶…æ—¶æ—¶é—´ï¼ˆ600ç§’ï¼‰</td>
</tr>
</tbody></table>
<h4 id="3-2-2-é€‰æ‹©å™¨-selector"><a href="#3-2-2-é€‰æ‹©å™¨-selector" class="headerlink" title="3.2.2 é€‰æ‹©å™¨ (selector)"></a>3.2.2 é€‰æ‹©å™¨ (selector)</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">selector</span><span class="token punctuation">:</span>
  <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> msmp<span class="token punctuation">-</span>mt<span class="token punctuation">-</span>server
    <span class="token key atrule">env</span><span class="token punctuation">:</span> dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç”¨äºé€‰æ‹© Deployment ç®¡ç†çš„ Podï¼Œå¿…é¡»ä¸ Pod æ¨¡æ¿ä¸­çš„ labels åŒ¹é…ã€‚</p>
<h4 id="3-2-3-æ›´æ–°ç­–ç•¥-strategy"><a href="#3-2-3-æ›´æ–°ç­–ç•¥-strategy" class="headerlink" title="3.2.3 æ›´æ–°ç­–ç•¥ (strategy)"></a>3.2.3 æ›´æ–°ç­–ç•¥ (strategy)</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">strategy</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
  <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
    <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> 25%
    <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> 25%<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>type</code></td>
<td>æ›´æ–°ç±»å‹ï¼ŒRollingUpdateï¼ˆæ»šåŠ¨æ›´æ–°ï¼‰æˆ– Recreateï¼ˆé‡å»ºï¼‰</td>
</tr>
<tr>
<td><code>maxSurge</code></td>
<td>æ›´æ–°æ—¶æœ€å¤šå¯ä»¥è¶…å‡ºæœŸæœ› Pod æ•°çš„æ¯”ä¾‹&#x2F;æ•°é‡</td>
</tr>
<tr>
<td><code>maxUnavailable</code></td>
<td>æ›´æ–°æ—¶æœ€å¤šä¸å¯ç”¨ Pod æ•°çš„æ¯”ä¾‹&#x2F;æ•°é‡</td>
</tr>
</tbody></table>
<h3 id="3-3-Pod-æ¨¡æ¿-template"><a href="#3-3-Pod-æ¨¡æ¿-template" class="headerlink" title="3.3 Pod æ¨¡æ¿ (template)"></a>3.3 Pod æ¨¡æ¿ (template)</h3><h4 id="3-3-1-å®¹å™¨é…ç½®-containers"><a href="#3-3-1-å®¹å™¨é…ç½®-containers" class="headerlink" title="3.3.1 å®¹å™¨é…ç½® (containers)"></a>3.3.1 å®¹å™¨é…ç½® (containers)</h4><p><strong>é•œåƒé…ç½®ï¼š</strong></p>
<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>image</code></td>
<td>å®¹å™¨é•œåƒåœ°å€å’Œç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>imagePullPolicy</code></td>
<td>é•œåƒæ‹‰å–ç­–ç•¥ï¼šAlwaysï¼ˆæ€»æ˜¯æ‹‰å–ï¼‰ã€IfNotPresentã€Never</td>
</tr>
</tbody></table>
<p><strong>ç¯å¢ƒå˜é‡ï¼š</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">env</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TZ
    <span class="token key atrule">value</span><span class="token punctuation">:</span> Asia/Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>è®¾ç½®å®¹å™¨çš„æ—¶åŒºä¸ºä¸œå…«åŒºï¼Œé¿å…æ—¶é—´é—®é¢˜ã€‚</p>
<p><strong>èµ„æºé…ç½®ï¼š</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">requests</span><span class="token punctuation">:</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"2"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> 4Gi
  <span class="token key atrule">limits</span><span class="token punctuation">:</span>
    <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"16"</span>
    <span class="token key atrule">memory</span><span class="token punctuation">:</span> 32Gi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>requests</code></td>
<td>å®¹å™¨è¯·æ±‚çš„æœ€å°èµ„æºï¼Œç”¨äºè°ƒåº¦</td>
</tr>
<tr>
<td><code>limits</code></td>
<td>å®¹å™¨å¯ä½¿ç”¨çš„æœ€å¤§èµ„æºï¼Œè¶…å‡ºä¼šè¢«é™åˆ¶æˆ–æ€æ­»</td>
</tr>
</tbody></table>
<p><strong>ç«¯å£é…ç½®ï¼š</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>å£°æ˜å®¹å™¨æš´éœ²çš„ç«¯å£ï¼Œä¸»è¦ç”¨äºæ–‡æ¡£è¯´æ˜å’Œ Service å…³è”ã€‚</p>
<h4 id="3-3-2-å·é…ç½®-volumes"><a href="#3-3-2-å·é…ç½®-volumes" class="headerlink" title="3.3.2 å·é…ç½® (volumes)"></a>3.3.2 å·é…ç½® (volumes)</h4><p><strong>æŒ‚è½½å·ï¼š</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/mt<span class="token punctuation">-</span>server/cache
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cache
    <span class="token key atrule">subPath</span><span class="token punctuation">:</span> cache
  <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/mt<span class="token punctuation">-</span>server/logs
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cache
    <span class="token key atrule">subPath</span><span class="token punctuation">:</span> logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å®šä¹‰å·ï¼š</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">420</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> hw2<span class="token punctuation">-</span>msmp<span class="token punctuation">-</span>config
    <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume
  <span class="token punctuation">-</span> <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /home/msmp/
      <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>å·ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>configMap</code></td>
<td>ä» ConfigMap æŒ‚è½½é…ç½®æ–‡ä»¶</td>
</tr>
<tr>
<td><code>hostPath</code></td>
<td>æŒ‚è½½å®¿ä¸»æœºè·¯å¾„ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨</td>
</tr>
<tr>
<td><code>emptyDir</code></td>
<td>ä¸´æ—¶ç›®å½•ï¼ŒPod åˆ é™¤æ—¶æ•°æ®ä¹Ÿä¼šåˆ é™¤</td>
</tr>
</tbody></table>
<h4 id="3-3-3-å…¶ä»–é…ç½®"><a href="#3-3-3-å…¶ä»–é…ç½®" class="headerlink" title="3.3.3 å…¶ä»–é…ç½®"></a>3.3.3 å…¶ä»–é…ç½®</h4><table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>restartPolicy</code></td>
<td>é‡å¯ç­–ç•¥ï¼šAlwaysï¼ˆæ€»æ˜¯é‡å¯ï¼‰ã€OnFailureã€Never</td>
</tr>
<tr>
<td><code>dnsPolicy</code></td>
<td>DNS ç­–ç•¥ï¼ŒClusterFirst ä½¿ç”¨é›†ç¾¤ DNS</td>
</tr>
<tr>
<td><code>nodeName</code></td>
<td>æŒ‡å®šè°ƒåº¦åˆ°çš„èŠ‚ç‚¹åç§°ï¼ˆä¸å»ºè®®æ‰‹åŠ¨æŒ‡å®šï¼‰</td>
</tr>
<tr>
<td><code>terminationGracePeriodSeconds</code></td>
<td>Pod ç»ˆæ­¢å®½é™æœŸï¼ˆ30ç§’ï¼‰</td>
</tr>
</tbody></table>
<h2 id="å››ã€ä½¿ç”¨ç¤ºä¾‹"><a href="#å››ã€ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="å››ã€ä½¿ç”¨ç¤ºä¾‹"></a>å››ã€ä½¿ç”¨ç¤ºä¾‹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»º Deployment</span>
kubectl apply <span class="token parameter variable">-f</span> deployment.yaml

<span class="token comment"># æŸ¥çœ‹ Deployment çŠ¶æ€</span>
kubectl get deployment msmp-mt-server-deployment <span class="token parameter variable">-n</span> hw-msmp

<span class="token comment"># æŸ¥çœ‹ Pod çŠ¶æ€</span>
kubectl get pods <span class="token parameter variable">-n</span> hw-msmp <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>msmp-mt-server

<span class="token comment"># æŸ¥çœ‹ Deployment è¯¦æƒ…</span>
kubectl describe deployment msmp-mt-server-deployment <span class="token parameter variable">-n</span> hw-msmp

<span class="token comment"># æ‰©å®¹/ç¼©å®¹</span>
kubectl scale deployment msmp-mt-server-deployment <span class="token parameter variable">--replicas</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">-n</span> hw-msmp

<span class="token comment"># æ›´æ–°é•œåƒ</span>
kubectl <span class="token builtin class-name">set</span> image deployment/msmp-mt-server-deployment msmp-mt-server<span class="token operator">=</span>harbor.mos.com/hw/mt-server:v4.0.8 <span class="token parameter variable">-n</span> hw-msmp

<span class="token comment"># æŸ¥çœ‹æ»šåŠ¨æ›´æ–°çŠ¶æ€</span>
kubectl rollout status deployment/msmp-mt-server-deployment <span class="token parameter variable">-n</span> hw-msmp

<span class="token comment"># å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</span>
kubectl rollout undo deployment/msmp-mt-server-deployment <span class="token parameter variable">-n</span> hw-msmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>èµ„æºé…ç½®</strong>ï¼šåˆç†è®¾ç½® requests å’Œ limitsï¼Œé¿å…èµ„æºæµªè´¹æˆ– OOM</li>
<li><strong>æ—¶åŒºé…ç½®</strong>ï¼šå¿…é¡»é…ç½® <code>TZ</code> ç¯å¢ƒå˜é‡ï¼Œç¡®ä¿åº”ç”¨æ—¶é—´æ­£ç¡®</li>
<li><strong>æŒä¹…åŒ–å­˜å‚¨</strong>ï¼šhostPath ä¼šå°† Pod ç»‘å®šåˆ°ç‰¹å®šèŠ‚ç‚¹ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ PV&#x2F;PVC</li>
<li><strong>æ›´æ–°ç­–ç•¥</strong>ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´ maxSurge å’Œ maxUnavailableï¼Œå¹³è¡¡æ›´æ–°é€Ÿåº¦å’ŒæœåŠ¡å¯ç”¨æ€§</li>
<li><strong>æ ‡ç­¾åŒ¹é…</strong>ï¼šselector å¿…é¡»ä¸ Pod template ä¸­çš„ labels å®Œå…¨åŒ¹é…</li>
</ol>
]]></content>
      <categories>
        <category>K8s</category>
      </categories>
      <tags>
        <tag>K8s</tag>
        <tag>Deployment</tag>
      </tags>
  </entry>
  <entry>
    <title>Kube-Prometheusç›‘æ§Redisï¼ˆä¸‰ï¼‰</title>
    <url>/2023/05/07/k8s/kube-prometheus-jian-kong-redis/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kube-Prometheus ç›‘æ§ Redisã€‚é€šè¿‡éƒ¨ç½² Redis Exporterï¼Œå°† Redis çš„æ€§èƒ½æŒ‡æ ‡æš´éœ²ç»™ Prometheus è¿›è¡Œé‡‡é›†å’Œç›‘æ§ã€‚</p>
<p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>Redis Exporter</strong>ï¼šç”¨äºæš´éœ² Redis æŒ‡æ ‡çš„ Exporterï¼ˆé•œåƒç‰ˆæœ¬ï¼šv1.37.0ï¼‰</li>
<li><strong>ServiceMonitor</strong>ï¼šPrometheus Operator çš„ CRDï¼Œç”¨äºæœåŠ¡å‘ç°å’ŒæŒ‡æ ‡é‡‡é›†é…ç½®</li>
</ul>
<h2 id="äºŒã€éƒ¨ç½²-Redis-Exporter"><a href="#äºŒã€éƒ¨ç½²-Redis-Exporter" class="headerlink" title="äºŒã€éƒ¨ç½² Redis Exporter"></a>äºŒã€éƒ¨ç½² Redis Exporter</h2><h3 id="2-1-åˆ›å»º-Deployment"><a href="#2-1-åˆ›å»º-Deployment" class="headerlink" title="2.1 åˆ›å»º Deployment"></a>2.1 åˆ›å»º Deployment</h3><p>é€šè¿‡ Deployment éƒ¨ç½² Redis Exporterï¼Œéœ€è¦é…ç½® Redis è¿æ¥ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment">#è®¾ç½®å”¯ä¸€åç§°ï¼Œå»ºè®®æ·»åŠ æ•°æ®åº“å®ä¾‹ip</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span>  redis<span class="token punctuation">-</span>exporter<span class="token punctuation">-</span>172.16.1.77
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.37.0
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
        <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.37.0
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
          <span class="token key atrule">image</span><span class="token punctuation">:</span> oliver006/redis_exporter<span class="token punctuation">:</span>v1.37.0
          <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"-redis.addr"</span><span class="token punctuation">,</span><span class="token string">"redis://cpaas-redis-cluster.share-components:6379"</span><span class="token punctuation">,</span><span class="token string">"-redis.password"</span><span class="token punctuation">,</span><span class="token string">"AoSshx9Drq"</span><span class="token punctuation">]</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 20m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 20Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 30Mi
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9121</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> http
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> localtime
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> localtime
          <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /usr/share/zoneinfo/Asia/Shanghai
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>args</code>ï¼šRedis Exporter å¯åŠ¨å‚æ•°<ul>
<li><code>-redis.addr</code>ï¼šRedis åœ°å€ï¼Œæ”¯æŒå•æœºå’Œé›†ç¾¤æ¨¡å¼</li>
<li><code>-redis.password</code>ï¼šRedis å¯†ç ï¼ˆå»ºè®®ä½¿ç”¨ Secret ç®¡ç†ï¼‰</li>
</ul>
</li>
<li><code>port: 9121</code>ï¼šRedis Exporter é»˜è®¤æš´éœ²ç«¯å£</li>
<li><code>resources</code>ï¼šèµ„æºé™åˆ¶ï¼Œæ ¹æ®å®é™…ç›‘æ§è§„æ¨¡è°ƒæ•´</li>
</ul>
<h3 id="2-2-åˆ›å»º-Service"><a href="#2-2-åˆ›å»º-Service" class="headerlink" title="2.2 åˆ›å»º Service"></a>2.2 åˆ›å»º Service</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.37.0
    <span class="token key atrule">platform</span><span class="token punctuation">:</span> mos
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9121</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>platform: mos</code>ï¼šè‡ªå®šä¹‰æ ‡ç­¾ï¼Œç”¨äºåŒºåˆ†ä¸åŒç¯å¢ƒ</li>
</ul>
<h3 id="2-3-åˆ›å»º-ServiceMonitor"><a href="#2-3-åˆ›å»º-ServiceMonitor" class="headerlink" title="2.3 åˆ›å»º ServiceMonitor"></a>2.3 åˆ›å»º ServiceMonitor</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceMonitor
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus
    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 1.37.0
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>  <span class="token comment"># æŒ‡æ ‡é‡‡é›†é…ç½®</span>
    <span class="token punctuation">-</span> <span class="token key atrule">interval</span><span class="token punctuation">:</span> 15s <span class="token comment"># æ¯ 15 ç§’é‡‡é›†ä¸€æ¬¡</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> http    <span class="token comment"># Service å®šä¹‰çš„ port åç§°</span>
      <span class="token key atrule">relabelings</span><span class="token punctuation">:</span>  <span class="token comment"># æŒ‡æ ‡é‡å†™è§„åˆ™</span>
        <span class="token punctuation">-</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> replace
          <span class="token key atrule">regex</span><span class="token punctuation">:</span> (.<span class="token important">*)</span>
          <span class="token key atrule">replacement</span><span class="token punctuation">:</span> $1
          <span class="token key atrule">sourceLabels</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> __meta_kubernetes_pod_node_name
          <span class="token key atrule">targetLabel</span><span class="token punctuation">:</span> instance
      <span class="token key atrule">scheme</span><span class="token punctuation">:</span> http
  <span class="token key atrule">jobLabel</span><span class="token punctuation">:</span> app.kubernetes.io/name
  <span class="token key atrule">targetLabels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>platform<span class="token punctuation">]</span>
  <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchNames</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> monitoring
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> <span class="token comment"># é€‰æ‹©å™¨ï¼Œå‘Šè¯‰ Prometheus å¦‚ä½•è·å–ç›®æ ‡ Pod</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>é…ç½®è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>interval: 15s</code>ï¼šæ¯ 15 ç§’é‡‡é›†ä¸€æ¬¡æŒ‡æ ‡</li>
<li><code>relabelings</code>ï¼šæŒ‡æ ‡é‡å†™è§„åˆ™ï¼Œå°† Pod èŠ‚ç‚¹åä½œä¸º instance æ ‡ç­¾å€¼</li>
<li><code>targetLabels</code>ï¼šå°† Service çš„ <code>platform</code> æ ‡ç­¾æ·»åŠ åˆ°é‡‡é›†çš„æŒ‡æ ‡ä¸­</li>
</ul>
<h2 id="ä¸‰ã€éªŒè¯éƒ¨ç½²"><a href="#ä¸‰ã€éªŒè¯éƒ¨ç½²" class="headerlink" title="ä¸‰ã€éªŒè¯éƒ¨ç½²"></a>ä¸‰ã€éªŒè¯éƒ¨ç½²</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹ Deployment çŠ¶æ€</span>
kubectl get deployment redis-exporter-172.16.1.77 <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹ Pod æ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> <span class="token operator">&lt;</span>pod-name<span class="token operator">></span> <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># è®¿é—® Exporter æŒ‡æ ‡æ¥å£</span>
kubectl port-forward svc/redis-exporter <span class="token number">9121</span>:9121 <span class="token parameter variable">-n</span> monitoring
<span class="token function">curl</span> http://localhost:9121/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h2><p>Redis Exporter æä¾›çš„æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š</p>
<ul>
<li><code>redis_up</code>ï¼šRedis å®ä¾‹æ˜¯å¦å¯ç”¨</li>
<li><code>redis_connected_clients</code>ï¼šå·²è¿æ¥å®¢æˆ·ç«¯æ•°é‡</li>
<li><code>redis_used_memory_bytes</code>ï¼šå†…å­˜ä½¿ç”¨é‡</li>
<li><code>redis_commands_processed_total</code>ï¼šå‘½ä»¤å¤„ç†æ€»æ•°</li>
<li><code>redis_keyspace_hits_total</code>ï¼šç¼“å­˜å‘½ä¸­æ¬¡æ•°</li>
<li><code>redis_keyspace_misses_total</code>ï¼šç¼“å­˜æœªå‘½ä¸­æ¬¡æ•°</li>
<li><code>redis_evicted_keys_total</code>ï¼šè¢«é€å‡ºçš„ key æ•°é‡</li>
</ul>
<h2 id="äº”ã€æ³¨æ„äº‹é¡¹"><a href="#äº”ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="äº”ã€æ³¨æ„äº‹é¡¹"></a>äº”ã€æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>Redis é›†ç¾¤ç›‘æ§</strong>ï¼šç›‘æ§ Redis é›†ç¾¤æ—¶ï¼Œåªéœ€é…ç½®ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹åœ°å€ï¼ŒExporter ä¼šè‡ªåŠ¨å‘ç°æ•´ä¸ªé›†ç¾¤</li>
<li><strong>å¯†ç å®‰å…¨</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Secret å­˜å‚¨ Redis å¯†ç ï¼Œè€Œéæ˜æ–‡é…ç½®</li>
<li><strong>å¤šå®ä¾‹ç›‘æ§</strong>ï¼šç›‘æ§å¤šä¸ª Redis å®ä¾‹æ—¶ï¼Œéœ€ä¸ºæ¯ä¸ªå®ä¾‹åˆ›å»ºç‹¬ç«‹çš„ Deployment</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼šExporter é‡‡é›†æŒ‡æ ‡ä¼šæ‰§è¡Œ <code>INFO</code> å‘½ä»¤ï¼Œå¯¹ Redis æ€§èƒ½å½±å“æå°</li>
</ol>
]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
        <tag>Prometheus</tag>
        <tag>exporter</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡Javaè¿›ç¨‹ç‰©ç†å†…å­˜å ç”¨è¶…è¿‡æœ€å¤§å †å†…å­˜åˆ†æ</title>
    <url>/2020/11/30/linux/yi-ci-java-jin-cheng-wu-li-nei-cun-zhan-yong-chao-guo-zui-da-dui-nei-cun-fen-xi/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯è¯´æ˜"><a href="#ä¸€ã€èƒŒæ™¯è¯´æ˜" class="headerlink" title="ä¸€ã€èƒŒæ™¯è¯´æ˜"></a>ä¸€ã€èƒŒæ™¯è¯´æ˜</h1><p>é¡¹ç›®æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæµ‹è¯•äººå‘˜åé¦ˆä½¿ç”¨Excelå¯¼å…¥100ä¸‡å·ç æ—¶æŠ¥é”™ï¼Œé€šè¿‡Topå‘½ä»¤æŸ¥çœ‹åˆ°è¯¥javaè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜å¤§å°ä¸º3.4Gï¼Œè€Œä¸”å†…å­˜æŒç»­å ç”¨ï¼Œä¸€ç›´æ²¡æœ‰é‡Šæ”¾ï¼Œæ€€ç–‘æ˜¯ä¸æ˜¯æœ‰å†…å­˜æ³„éœ²çš„æƒ…å†µã€‚</p>
<p><img src="/2020/11/30/linux/yi-ci-java-jin-cheng-wu-li-nei-cun-zhan-yong-chao-guo-zui-da-dui-nei-cun-fen-xi/top.jpg" alt="topç»“æœ"></p>
<p><em>PSï¼šä¸Šå›¾ä¸ºåç»­é‡æ–°æˆªçš„å›¾,æ¯”ç¬¬ä¸€æ¬¡ç‰©ç†å†…å­˜å ç”¨å°</em></p>
<blockquote>
<p>JVMé…ç½®å‚æ•°å¦‚ä¸‹ï¼š</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">server.java.opts&#x3D;-d64 -XX:MaxPermSize&#x3D;192M -Xms3000M -Xmx3000M -XX:+HeapDumpOnOutOfMemoryError<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="äºŒã€é—®é¢˜æ’æŸ¥"><a href="#äºŒã€é—®é¢˜æ’æŸ¥" class="headerlink" title="äºŒã€é—®é¢˜æ’æŸ¥"></a>äºŒã€é—®é¢˜æ’æŸ¥</h1><p>æŸ¥çœ‹æ—¥å¿—å‘ç°å‡ºç°äº†<code>OOM</code>, æŠ¥é”™ä¿¡æ¯æœªï¼š<code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code>ï¼Œå¹¶ç”Ÿæˆäº†å †å†…å­˜å¿«ç…§æ–‡ä»¶java_pid31734.hprofã€‚<br>é€šè¿‡jVisualVMå·¥å…·åˆ†æ<code>java_pid31734.hprof</code>æ–‡ä»¶ã€‚</p>
<p><img src="/2020/11/30/linux/yi-ci-java-jin-cheng-wu-li-nei-cun-zhan-yong-chao-guo-zui-da-dui-nei-cun-fen-xi/hprof.jpg" alt="hprof"></p>
<p>javaè¿›ç¨‹å‘ç”ŸOOMæ—¶ç”Ÿæˆçš„å †å†…å­˜å¿«ç…§æ–‡ä»¶å¤§å°ä¸º3.4Gã€‚</p>
<p><img src="/2020/11/30/linux/yi-ci-java-jin-cheng-wu-li-nei-cun-zhan-yong-chao-guo-zui-da-dui-nei-cun-fen-xi/hprof_class.jpg" alt="hprof_class"></p>
<p>ç”±äºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>POI</code>å»è¯»å–Excelæ–‡ä»¶çš„ï¼Œä»å†…å­˜å¿«ç…§ä¸­å¯ä»¥çœ‹åˆ°å¤§é‡çš„å†…å­˜è¢«<code>POI</code>ç›¸å…³çš„å¯¹è±¡å ç”¨ã€‚</p>
<p>å‘ç”ŸOOMåjavaè¿›ç¨‹å¹¶æ²¡æœ‰é€€å‡ºï¼Œä»å¯ä»¥æ­£å¸¸è®¿é—®ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹Javaè¿›ç¨‹çš„å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p>
<p><img src="/2020/11/30/linux/yi-ci-java-jin-cheng-wu-li-nei-cun-zhan-yong-chao-guo-zui-da-dui-nei-cun-fen-xi/jmap.jpg" alt="jmap result"></p>
<p>é€šè¿‡<code>jmap</code>æŸ¥çœ‹JVMå †å†…å­˜ä½¿ç”¨æ€»è®¡çº¦ä¸º152.8 MBï¼š100.07ï¼ˆå¹´è½»ä»£ï¼‰ + 52.73ï¼ˆè€å¹´ä»£ï¼‰ï¼Œè¯´æ˜å‡ºç°<code>OOM</code>åï¼Œå ç”¨çš„å †å†…å­˜å·²ç»æ­£å¸¸é‡Šæ”¾ã€‚</p>
<h2 id="2-1-ä¸ºä»€ä¹ˆå †å†…å­˜é‡Šæ”¾åjavaè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜æ²¡æœ‰æ”¶ç¼©ï¼Ÿ"><a href="#2-1-ä¸ºä»€ä¹ˆå †å†…å­˜é‡Šæ”¾åjavaè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜æ²¡æœ‰æ”¶ç¼©ï¼Ÿ" class="headerlink" title="2.1 ä¸ºä»€ä¹ˆå †å†…å­˜é‡Šæ”¾åjavaè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜æ²¡æœ‰æ”¶ç¼©ï¼Ÿ"></a>2.1 ä¸ºä»€ä¹ˆå †å†…å­˜é‡Šæ”¾åjavaè¿›ç¨‹å ç”¨çš„ç‰©ç†å†…å­˜æ²¡æœ‰æ”¶ç¼©ï¼Ÿ</h2><p>é¡¹ç›®å¯åŠ¨åï¼Œè¯¥javaè¿›ç¨‹å ç”¨å†…å­˜ä¹Ÿå°±1Gå¤šä¸€ç‚¹ï¼Œè¿›è¡Œå¯¼å…¥Excelæ–‡ä»¶æ“ä½œåï¼Œå‡ºç°äº†OOMï¼Œä½†æ˜¯åé¢å †å†…å­˜å·²ç»æ­£å¸¸é‡Šæ”¾ï¼Œä¸ºä»€ä¹ˆè¯¥javaè¿›ç¨‹å ç”¨ç‰©ç†å†…å­˜æ²¡æœ‰é‡Šæ”¾ï¼Ÿ</p>
<h3 id="æ“ä½œç³»ç»Ÿå†…å­˜åˆ†é…æœºåˆ¶"><a href="#æ“ä½œç³»ç»Ÿå†…å­˜åˆ†é…æœºåˆ¶" class="headerlink" title="æ“ä½œç³»ç»Ÿå†…å­˜åˆ†é…æœºåˆ¶"></a>æ“ä½œç³»ç»Ÿå†…å­˜åˆ†é…æœºåˆ¶</h3><blockquote>
<p>è¿›ç¨‹å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿåˆ†é…ç»™è¿›ç¨‹çš„æ˜¯è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œåªæœ‰è¿›ç¨‹çœŸæ­£è®¿é—®è¿™å—å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šç»™è¿›ç¨‹åˆ†é…ç‰©ç†å†…å­˜ã€‚</p>
</blockquote>
<p>JVMå¯åŠ¨æ—¶ï¼Œå‘æ“ä½œç³»ç»Ÿç”³è¯·äº†<code>3000M</code>çš„å†…å­˜ï¼Œä½†æ˜¯è¿™<code>3000M</code>å†…å­˜ç©ºé—´æ˜¯è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œåªæœ‰åœ¨javaè¿›ç¨‹çœŸæ­£ä½¿ç”¨è¿™äº›å†…å­˜æ—¶æ“ä½œç³»ç»Ÿæ‰ä¼šå»åˆ†é…ç‰©ç†å†…ã€‚<br>ç”±äºJVMå¯åŠ¨åï¼Œæ²¡æœ‰è¿›è¡Œè€—å†…å­˜çš„æ“ä½œï¼Œå®é™…ä½¿ç”¨çš„å†…å­˜ç©ºé—´è¾ƒå°ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿåªåˆ†é…çœŸæ­£ä½¿ç”¨åˆ°çš„ç‰©ç†å†…å­˜ç»™JVMï¼Œæ‰€ä»¥é€šè¿‡Topå‘½ä»¤æŸ¥çœ‹åˆ°çš„ç‰©ç†å†…å­˜å ç”¨å°äº<code>3000M</code>ã€‚<br>ä½†æ˜¯åœ¨å¤„ç†Excelå¯¼å…¥æ—¶å‘ç”Ÿäº†OOMï¼Œè¯´æ˜javaè¿›ç¨‹å·²ç»ä½¿ç”¨äº†å…¨éƒ¨çš„å †å†…å­˜ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šå°†å †å†…å­˜å¤§å°çš„ç‰©ç†å†…å­˜å…¨éƒ¨åˆ†é…ç»™JVMã€‚<br>ä¸Šè¿°JVMå¯åŠ¨å‚æ•°é…ç½®ä¸º<code>-Xms3000M -Xmx3000M</code>, <code>Xms</code>ä¸ºæœ€å°å †å†…å­˜ï¼Œ<code>Xmx</code>ä¸ºæœ€å¤§å †å¤§å°ï¼Œç”±äºè¿™ä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒï¼Œæ‰€ä»¥JVMåœ¨å †å†…å­˜ç©ºé—²æ—¶ä»ä¸ä¼šå½’è¿˜ç‰©ç†å†…å­˜ç»™æ“ä½œç³»ç»Ÿã€‚<br>å¯ä»¥é€šè¿‡<code>pmap</code>å‘½ä»¤çœ‹ä¸€ä¸‹è¿›ç¨‹å†…å­˜å ç”¨æƒ…å†µ:</p>
<p><img src="/2020/11/30/linux/yi-ci-java-jin-cheng-wu-li-nei-cun-zhan-yong-chao-guo-zui-da-dui-nei-cun-fen-xi/pmap.jpg" alt="pmap"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºå †å†…å­˜é‡Šæ”¾åï¼ŒJVMåº•å±‚å¹¶æœªå°†ç‰©ç†å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚</p>
<h2 id="2-2-ä¸ºä»€ä¹ˆjavaè¿›ç¨‹å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†å †å†…å­˜å¤§å°ï¼Ÿ"><a href="#2-2-ä¸ºä»€ä¹ˆjavaè¿›ç¨‹å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†å †å†…å­˜å¤§å°ï¼Ÿ" class="headerlink" title="2.2 ä¸ºä»€ä¹ˆjavaè¿›ç¨‹å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†å †å†…å­˜å¤§å°ï¼Ÿ"></a>2.2 ä¸ºä»€ä¹ˆjavaè¿›ç¨‹å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†å †å†…å­˜å¤§å°ï¼Ÿ</h2><p>JVM çš„å†…å­˜å¤§æ¦‚åˆ†ä¸ºä¸‹é¢è¿™å‡ ä¸ªéƒ¨åˆ†</p>
<ul>
<li><p>å †ï¼ˆHeapï¼‰ï¼šedenã€survivorã€old åŒºåŸŸç­‰</p>
</li>
<li><p>çº¿ç¨‹æ ˆï¼ˆThread Stackï¼‰ï¼šæ¯ä¸ªçº¿ç¨‹æ ˆé¢„ç•™ 1M çš„çº¿ç¨‹æ ˆå¤§å°</p>
</li>
<li><p>éå †ï¼ˆNon-heapï¼‰ï¼šåŒ…æ‹¬ code_cacheã€metaspace ç­‰</p>
</li>
<li><p>å †å¤–å†…å­˜ï¼šunsafe.allocateMemory å’Œ DirectByteBufferç”³è¯·çš„å †å¤–å†…å­˜</p>
</li>
<li><p>native ï¼ˆC&#x2F;C++ ä»£ç ï¼‰ç”³è¯·çš„å†…å­˜</p>
</li>
<li><p>è¿˜æœ‰ JVM è¿è¡Œæœ¬èº«éœ€è¦çš„å†…å­˜ï¼Œæ¯”å¦‚ GC ç­‰ã€‚</p>
</li>
</ul>
<p>é™¤å»JVMå †å†…å­˜å¤–ï¼Œjavaè¿›ç¨‹æœ¬èº«ä¼šå ç”¨ä¸€äº›å†…å­˜ï¼Œæ‰€ä»¥ä¼šå‡ºç°javaè¿›ç¨‹çš„å ç”¨çš„æ€»å†…å­˜ä¼šæ¯”æœ€å¤§å †å†…å­˜å¤§çš„æƒ…å†µã€‚</p>
<h1 id="ä¸‰ã€POIè¯»å–è¶…å¤§Excelæ–‡ä»¶OOMé—®é¢˜"><a href="#ä¸‰ã€POIè¯»å–è¶…å¤§Excelæ–‡ä»¶OOMé—®é¢˜" class="headerlink" title="ä¸‰ã€POIè¯»å–è¶…å¤§Excelæ–‡ä»¶OOMé—®é¢˜"></a>ä¸‰ã€POIè¯»å–è¶…å¤§Excelæ–‡ä»¶OOMé—®é¢˜</h1><p><code>POI</code>æ˜¯è¯»å†™Excelçš„å¸¸ç”¨å·¥å…·åŒ…ï¼ŒåŠŸèƒ½éå¸¸ä¸°å¯Œã€‚ä½†æ˜¯<code>POI</code>çš„ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œåœ¨å¯¼å…¥100ä¸‡æ‰‹æœºå·ç çš„Excelæ–‡ä»¶æ—¶ï¼Œå³ä½¿æœ€å¤§å †è®¾ç½®ä¸º<code>4000M</code>ä¹Ÿè¿˜æ˜¯ä¼šå‘ç”ŸOOMçš„ã€‚<br>æ‰€ä»¥é¡¹ç›®åç»­é‡‡ç”¨äº†é˜¿é‡Œå¼€æºçš„<code>easyexcel</code>ï¼Œ<code>easyexcel</code><a href="https://github.com/alibaba/easyexcel">å®˜ç½‘</a>ç»™å‡ºçš„æ•°æ®ä¸ºï¼š64Må†…å­˜1åˆ†é’Ÿå†…è¯»å–75M(46Wè¡Œ25åˆ—)çš„Excelã€‚<br>ä½¿ç”¨<code>easyexcel</code>åæˆåŠŸè§£å†³è¯»å–ç™¾ä¸‡ä»¥ä¸ŠExcelæ•°æ®OOMé—®é¢˜ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://club.perfma.com/article/1709425">ä¸€æ¬¡ Java è¿›ç¨‹ OOM çš„æ’æŸ¥åˆ†æï¼ˆglibc ç¯‡ï¼‰</a><br><a href="https://club.perfma.com/article/1850399">è®°ä¸€æ¬¡å †å¤–å†…å­˜æ³„æ¼æ’æŸ¥è¿‡ç¨‹</a><br><a href="https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/">Understanding glibc malloc</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å†…å­˜æ³„éœ²</tag>
        <tag>OOM</tag>
      </tags>
  </entry>
  <entry>
    <title>çªç„¶æ¶ˆå¤±çš„Javaè¿›ç¨‹</title>
    <url>/2020/11/19/linux/tu-ran-xiao-shi-de-java-jin-cheng/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯è¯´æ˜"><a href="#ä¸€ã€èƒŒæ™¯è¯´æ˜" class="headerlink" title="ä¸€ã€èƒŒæ™¯è¯´æ˜"></a>ä¸€ã€èƒŒæ™¯è¯´æ˜</h1><p>åœ¨ä¸€æ¬¡å¤§æ‰¹é‡æ•°æ®æµ‹è¯•æ—¶ï¼Œä¸€ä¸ªJavaæœåŠ¡æ¨¡å—çªç„¶å®•æ‰ï¼Œå¹¶ä¸”è¿ç»­å‡ºç°äº†å¥½å‡ æ¬¡ã€‚æ£€æŸ¥æœåŠ¡å·²ç»å¼€å¯äº†æ‰“å°å †æ ˆä¿¡æ¯<code>-XX:+HeapDumpOnOutOfMemoryError</code>,<br>ä½†æ˜¯åœ¨æœåŠ¡å™¨è¿è¡Œç›®å½•ä¸‹å¹¶æ²¡æœ‰å‘ç°.hprofæ–‡ä»¶ç”Ÿæˆã€‚æœåŠ¡å™¨æ€»å†…å­˜ä¸º16Gï¼Œå½“å‰JavaæœåŠ¡è®¾ç½®çš„å†…å­˜ä¸ºï¼š<code>-Xms5000M -Xmx8000M</code>ã€‚</p>
<h1 id="äºŒã€åŸå› åˆ†æ"><a href="#äºŒã€åŸå› åˆ†æ" class="headerlink" title="äºŒã€åŸå› åˆ†æ"></a>äºŒã€åŸå› åˆ†æ</h1><p>Javaè¿›ç¨‹çªç„¶è¢«å¹²æ‰æ— å¤–ä¹ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>Linux OOM killer æ€æ­»äº†Javaè¿›ç¨‹</li>
<li>JVMè‡ªèº«æ•…éšœ</li>
<li>JVM OOMå¯¼è‡´è¿›ç¨‹é€€å‡º</li>
</ul>
<h2 id="2-1-Linux-çš„OOM-killer"><a href="#2-1-Linux-çš„OOM-killer" class="headerlink" title="2.1 Linux çš„OOM killer"></a>2.1 Linux çš„OOM killer</h2><p>Linuxå†…æ ¸æœ‰ä¸€ä¸ªOOM(out of memory) killeræœºåˆ¶ï¼Œå½“ç³»ç»Ÿå†…å­˜ä¸¥é‡ä¸è¶³æ—¶ï¼ŒOOM killerä¼šé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹æ€æ­»ã€‚å…³äºOOM killeræœºåˆ¶å¯å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« <a href="https://www.mpoom.cn/2020/11/19/Linux%E4%B8%AD%E7%9A%84CommitLimit%E4%B8%8EOOMKiller/">Linuxä¸­çš„CommitLimitä¸OOM Killer</a>.ã€‚<br>å› æ­¤ï¼Œå½“javaè¿›ç¨‹çªç„¶æ¶ˆå¤±æ—¶ï¼Œé¦–å…ˆæ€€ç–‘æ˜¯ä¸æ˜¯è¢«OOM killeræ€æ‰äº†ã€‚</p>
<blockquote>
<p>æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶<code>/var/log/messages</code></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">$egrep -i &#39;killed process&#39; &#x2F;var&#x2F;log&#x2F;messages
Nov 19 16:24:31 localhost kernel: Killed process 26980 (java) total-vm:14316628kB, anon-rss:6138236kB, file-rss:0kB, shmem-rss:0kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>æŸ¥çœ‹linuxç³»ç»Ÿå†…æ ¸æ—¥å¿—</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">$dmesg | grep java
[3571149.337671] Out of memory: Kill process 26980 (java) score 243 or sacrifice child
[3571149.338458] Killed process 26980 (java) total-vm:14316628kB, anon-rss:6138236kB, file-rss:0kB, shmem-rss:0kB
[3571149.395860] java: page allocation failure: order:0, mode:0x201da
[3571149.395864] CPU: 0 PID: 26980 Comm: java Kdump: loaded Tainted: G             L ------------ T 3.10.0-957.el7.x86_64 #1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-JVMçš„è‡ªèº«æ•…éšœ"><a href="#2-2-JVMçš„è‡ªèº«æ•…éšœ" class="headerlink" title="2.2 JVMçš„è‡ªèº«æ•…éšœ"></a>2.2 JVMçš„è‡ªèº«æ•…éšœ</h2><p>å½“JVMå‘ç”Ÿè‡´å‘½é”™è¯¯å¯¼è‡´å´©æºƒæ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªhs_err_pid_xxx.logè¿™æ ·çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†å¯¼è‡´ JVM crash çš„é‡è¦ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†æè¯¥æ–‡ä»¶å®šä½åˆ°å¯¼è‡´ JVM Crash çš„åŸå› ï¼Œä»è€Œä¿®å¤ä¿è¯ç³»ç»Ÿç¨³å®šã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ–‡ä»¶æ˜¯ç”Ÿæˆåœ¨å·¥ä½œç›®å½•ä¸‹çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ JVM å‚æ•°æŒ‡å®šç”Ÿæˆè·¯å¾„ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">-XX:ErrorFile&#x3D;&#x2F;var&#x2F;log&#x2F;hs_err_pid&lt;pid&gt;.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ä¸ªæ–‡ä»¶ä¸»è¦åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>æ—¥å¿—å¤´æ–‡ä»¶</li>
<li>å¯¼è‡´ crash çš„çº¿ç¨‹ä¿¡æ¯</li>
<li>æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯</li>
<li>å®‰å…¨ç‚¹å’Œé”ä¿¡æ¯</li>
<li>å †ä¿¡æ¯</li>
<li>æœ¬åœ°ä»£ç ç¼“å­˜</li>
<li>ç¼–è¯‘äº‹ä»¶</li>
<li>gc ç›¸å…³è®°å½•</li>
<li>jvm å†…å­˜æ˜ å°„</li>
<li>jvm å¯åŠ¨å‚æ•°</li>
<li>æœåŠ¡å™¨ä¿¡æ¯</li>
</ul>
<h2 id="2-3-JVMçš„OOM"><a href="#2-3-JVMçš„OOM" class="headerlink" title="2.3 JVMçš„OOM"></a>2.3 JVMçš„OOM</h2><p>JVMç”±äºæœ‰GCæœºåˆ¶ï¼Œä¸€èˆ¬å¾ˆå°‘å‘ç”ŸOOMï¼Œä½†æ˜¯å¦‚æœå‡ºç°å†…å­˜æ³„éœ²ï¼Œå°±å¯èƒ½å‘ç”ŸOOMå¯¼è‡´javaè¿›ç¨‹é€€å‡ºã€‚<br>å¯ä»¥æ ¹æ®JVMçš„ä¸‹é¢ä¸¤ä¸ªå‚æ•°æŸ¥æ‰¾å †å†…å­˜å¿«ç…§æ–‡ä»¶å®šä½é—®é¢˜ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath&#x3D;*&#x2F;java.hprof<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ‰¾åˆ°dumpå¿«ç…§æ–‡ä»¶ï¼Œå€ŸåŠ©ä¸€äº›MATæˆ–VisualVMè¿™ä¸€ç±»å¯è§†åŒ–å·¥å…·åˆ†æé—®é¢˜åŸå› ã€‚</p>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>å½“javaè¿›ç¨‹çªç„¶æ¶ˆå¤±æ—¶ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹æ˜¯å¦æœ‰dumpæ–‡ä»¶ï¼›å¦‚æœæ²¡æœ‰dumpæ–‡ä»¶ï¼Œå†æŸ¥çœ‹æ˜¯å¦æœ‰hs_err_pid.logæ—¥å¿—ï¼›å¦‚æœä¹Ÿæ²¡æœ‰ï¼Œåˆ™æŸ¥çœ‹å†…æ ¸æ—¥å¿—ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.cnblogs.com/rjzheng/p/11317889.html">JAVAè¿›ç¨‹çªç„¶æ¶ˆå¤±çš„åŸå› ?</a><br><a href="https://www.jianshu.com/p/7652f931cafd">JVMè‡´å‘½é”™è¯¯æ—¥å¿—(hs_err_pid.log)åˆ†æ</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Nacosç®€ä»‹åŠä½¿ç”¨</title>
    <url>/2021/08/25/middleware/nacos-jian-jie-ji-shi-yong/</url>
    <content><![CDATA[<h1 id="ã€ŠNacosç®€ä»‹åŠä½¿ç”¨ã€‹"><a href="#ã€ŠNacosç®€ä»‹åŠä½¿ç”¨ã€‹" class="headerlink" title="ã€ŠNacosç®€ä»‹åŠä½¿ç”¨ã€‹"></a>ã€ŠNacosç®€ä»‹åŠä½¿ç”¨ã€‹</h1><span id="more"></span>
<div class="pdf-container" style="width: 100%; height: 600px; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe src="./Nacosç®€ä»‹åŠä½¿ç”¨.pdf" width="100%" height="100%" frameborder="0" style="border: none; border-radius: 8px;">
      <div style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 8px;">
        <p style="margin: 0; color: #666;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºPDFæ–‡ä»¶</p>
        <a href="./Nacosç®€ä»‹åŠä½¿ç”¨.pdf" target="_blank" style="color: #409eff; text-decoration: none; font-weight: 500;">ğŸ“¥ ç‚¹å‡»è¿™é‡Œä¸‹è½½PDFæ–‡ä»¶</a>
      </div>
    </iframe>
  </div>]]></content>
      <categories>
        <category>ä¸­é—´ä»¶</category>
      </categories>
      <tags>
        <tag>Nacos</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸­çš„CommitLimitä¸OOM Killer</title>
    <url>/2020/11/19/linux/linux-zhong-de-commitlimit-yu-oomkiller/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯è¯´æ˜"><a href="#ä¸€ã€èƒŒæ™¯è¯´æ˜" class="headerlink" title="ä¸€ã€èƒŒæ™¯è¯´æ˜"></a>ä¸€ã€èƒŒæ™¯è¯´æ˜</h1><p>åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°ä¸€ä¸ªJavaè¿›ç¨‹ç”±äºç”³è¯·å†…å­˜è¿‡å¤§å¯¼è‡´è¢«Linux OOM killeræ€æ‰çš„é—®é¢˜ï¼Œæ‰€ä»¥æ¥åˆ†æä¸€ä¸‹Linuxä¸­çš„CommitLimitä¸OMM killeræœºåˆ¶ã€‚</p>
<h1 id="äºŒã€Linuxå†…å­˜åˆ†é…æœºåˆ¶"><a href="#äºŒã€Linuxå†…å­˜åˆ†é…æœºåˆ¶" class="headerlink" title="äºŒã€Linuxå†…å­˜åˆ†é…æœºåˆ¶"></a>äºŒã€Linuxå†…å­˜åˆ†é…æœºåˆ¶</h1><p>ã€€ã€€Linuxç³»ç»Ÿå…è®¸ç¨‹åºç”³è¯·æ¯”ç³»ç»Ÿå¯ç”¨å†…å­˜æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè¿™ä¸ªç‰¹æ€§å«åš <code>overcommit</code> ç‰¹æ€§ï¼Œè¿™æ ·åšå¯èƒ½æ˜¯ä¸ºäº†ç³»ç»Ÿçš„ä¼˜åŒ–ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„ç¨‹åºç”³è¯·äº†å†…å­˜å°±ä¼šç«‹åˆ»ä½¿ç”¨ï¼Œå½“çœŸæ­£çš„ä½¿ç”¨æ—¶ï¼Œç³»ç»Ÿå¯èƒ½å·²ç»å›æ”¶äº†ä¸€äº›å†…å­˜ã€‚ä¸ºäº†é¿å…å†…å­˜çš„æµªè´¹ï¼Œåœ¨åˆ†é…é¡µé¢æ—¶ï¼ŒLinux é‡‡ç”¨çš„æ˜¯æŒ‰éœ€åˆ†é…ç‰©ç†é¡µé¢çš„æ–¹å¼ã€‚è­¬å¦‚è¯´ï¼ŒæŸä¸ªè¿›ç¨‹è°ƒç”¨malloc()ç”³è¯·äº†ä¸€å—å°å†…å­˜ï¼Œè¿™æ—¶å†…æ ¸ä¼šåˆ†é…ä¸€ä¸ªè™šæ‹Ÿé¡µé¢ï¼Œä½†è¿™ä¸ªé¡µé¢ä¸ä¼šæ˜ å°„åˆ°å®é™…çš„ç‰©ç†é¡µé¢ã€‚<br><img src="/2020/11/19/linux/linux-zhong-de-commitlimit-yu-oomkiller/oom1.png" alt="OSå†…å­˜åˆ†é…"><br>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“ç¨‹åºé¦–æ¬¡è®¿é—®è¿™ä¸ªè™šæ‹Ÿé¡µé¢æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ (page fault)ã€‚è¿™æ—¶å†…æ ¸ä¼šåˆ†é…ä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œè®©è™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°è¿™ä¸ªç‰©ç†é¡µé¢ï¼ŒåŒæ—¶æ›´æ–°è¿›ç¨‹çš„é¡µè¡¨ (page table)ã€‚</p>
<h2 id="2-1-Linuxçš„Memory-Overcommit"><a href="#2-1-Linuxçš„Memory-Overcommit" class="headerlink" title="2.1 Linuxçš„Memory Overcommit"></a>2.1 Linuxçš„Memory Overcommit</h2><p>è¿™ç§æŒ‰éœ€åˆ†é…ç‰©ç†é¡µé¢çš„æ–¹å¼ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœç‰©ç†å†…å­˜çš„ä½¿ç”¨ï¼Œä½†æœ‰æ—¶ä¼šå¯¼è‡´ Memory Overcommitã€‚æ‰€è°“ Memory Overcommitï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜è¶…è¿‡äº†ç³»ç»Ÿçš„ç‰©ç†å†…å­˜å’Œäº¤æ¢ç©ºé—´çš„æ€»å’Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux æ˜¯å…è®¸ Memory Overcommit çš„ã€‚å¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒMemory Overcommit ä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå¾ˆå¤šè¿›ç¨‹åªæ˜¯ç”³è¯·äº†å¾ˆå¤šå†…å­˜ï¼Œä½†å®é™…ä½¿ç”¨åˆ°çš„å†…å­˜å¹¶ä¸å¤šã€‚</p>
<p>ä½†ä¸‡ä¸€å¾ˆå¤šè¿›ç¨‹éƒ½ä½¿ç”¨äº†ç”³è¯·æ¥çš„å¤§éƒ¨åˆ†å†…å­˜ï¼Œå°±å¯èƒ½å¯¼è‡´ç‰©ç†å†…å­˜å’Œäº¤æ¢ç©ºé—´ä¸å¤Ÿç”¨äº†ï¼Œè¿™æ—¶å†…æ ¸çš„ OOM Killer å°±ä¼šå‡ºé©¬ï¼Œå®ƒä¼šé€‰æ‹©æ€æ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å°±èƒ½è…¾å‡ºä¸€äº›å†…å­˜ç»™å…¶å®ƒè¿›ç¨‹ä½¿ç”¨ã€‚</p>
<p>Linuxè®¾è®¡äº†ä¸€ä¸ªOOM killeræœºåˆ¶(out of memory killer)æ¥å¤„ç†è¿™ç§å±æœºï¼šæŒ‘é€‰ä¸€ä¸ªè¿›ç¨‹å‡ºæ¥æ€æ­»ï¼Œä»¥è…¾å‡ºéƒ¨åˆ†å†…å­˜ï¼Œå¦‚æœè¿˜ä¸å¤Ÿå°±ç»§ç»­æ€â€¦ä¹Ÿå¯é€šè¿‡è®¾ç½®å†…æ ¸å‚æ•° vm.panic_on_oom ä½¿å¾—å‘ç”ŸOOMæ—¶è‡ªåŠ¨é‡å¯ç³»ç»Ÿã€‚</p>
<p>Linux 2.6ä¹‹åå…è®¸é€šè¿‡å†…æ ¸å‚æ•° vm.overcommit_memory ç¦æ­¢memory overcommitã€‚<br>å†…æ ¸å‚æ•° vm.overcommit_memory æ¥å—ä¸‰ç§å–å€¼ï¼š</p>
<table>
<thead>
<tr>
<th>å–å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>Heuristic overcommit handling. è¿™æ˜¯ç¼ºçœå€¼ï¼Œå®ƒå…è®¸overcommitï¼Œä½†è¿‡äºæ˜ç›®å¼ èƒ†çš„overcommitä¼šè¢«æ‹’ç»ï¼Œæ¯”å¦‚mallocä¸€æ¬¡æ€§ç”³è¯·çš„å†…å­˜å¤§å°å°±è¶…è¿‡äº†ç³»ç»Ÿæ€»å†…å­˜ã€‚</td>
</tr>
<tr>
<td>1</td>
<td>Always overcommit. å…è®¸overcommitï¼Œå¯¹å†…å­˜ç”³è¯·æ¥è€…ä¸æ‹’</td>
</tr>
<tr>
<td>2</td>
<td>Donâ€™t overcommit. ç¦æ­¢overcommitã€‚</td>
</tr>
</tbody></table>
<h3 id="å¦‚ä½•æ‰ç®—-overcommitï¼Ÿ"><a href="#å¦‚ä½•æ‰ç®—-overcommitï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‰ç®— overcommitï¼Ÿ"></a>å¦‚ä½•æ‰ç®— overcommitï¼Ÿ</h3><p>Linux è®¾å®šäº†ä¸€ä¸ªé˜ˆå€¼ï¼Œå«åš CommitLimitï¼Œå¦‚æœæ‰€æœ‰è¿›ç¨‹ç”³è¯·çš„æ€»å†…å­˜è¶…è¿‡äº† CommitLimitï¼Œé‚£å°±ç®—æ˜¯ overcommit äº†ã€‚åœ¨&#x2F;proc&#x2F;meminfoä¸­å¯ä»¥çœ‹åˆ° CommitLimit çš„å¤§å°ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">$ grep -i commit &#x2F;proc&#x2F;meminfo
CommitLimit:    32905144 kB
Committed_AS:   30462700 kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>CommitLimit ï¼š overcommitçš„é˜ˆå€¼</li>
<li>Committed_AS : è¡¨ç¤ºæ‰€æœ‰è¿›ç¨‹å·²ç»ç”³è¯·çš„å†…å­˜æ€»å¤§å°</li>
</ul>
<blockquote>
<p>æ³¨æ„ Committed_ASæ˜¯å·²ç»ç”³è¯·çš„ï¼Œä¸æ˜¯å·²ç»åˆ†é…çš„ï¼Œå¦‚æœ Committed_AS è¶…è¿‡ CommitLimit å°±è¡¨ç¤ºå‘ç”Ÿäº† overcommitï¼Œè¶…å‡ºè¶Šå¤šè¡¨ç¤º overcommit è¶Šä¸¥é‡ã€‚</p>
</blockquote>
<h3 id="CommitLimitè®¡ç®—æ–¹å¼"><a href="#CommitLimitè®¡ç®—æ–¹å¼" class="headerlink" title="CommitLimitè®¡ç®—æ–¹å¼"></a>CommitLimitè®¡ç®—æ–¹å¼</h3><pre class="line-numbers language-none"><code class="language-none">CommitLimit &#x3D; [swap size] + [RAM size] * vm.overcommit_ratio &#x2F; 100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>[swap size] : äº¤æ¢åŒºç©ºé—´å¤§å°</li>
<li>[RAM size] : å†…å­˜ç©ºé—´å¤§å°</li>
<li>vm.overcommit_ratio : vm.overcommit_ratio æ˜¯å†…æ ¸å‚æ•°ï¼Œç¼ºçœå€¼æ˜¯50ï¼Œè¡¨ç¤ºç‰©ç†å†…å­˜çš„50%</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">$ free
              total        used        free      shared  buff&#x2F;cache   available
Mem:       32780152    16704624     2104672     1442992    13970856    14124620
Swap:      16515068      127488    16387580<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>CommitLimit &#x3D; 16515068 + 32780152 * 50 &#x2F; 100 &#x3D; 32905144</p>
</blockquote>
<h2 id="2-2-Linux-OOM-Killer"><a href="#2-2-Linux-OOM-Killer" class="headerlink" title="2.2 Linux OOM Killer"></a>2.2 Linux OOM Killer</h2><p>å½“ç‰©ç†å†…å­˜ä¸¥é‡ä¸è¶³æ—¶ï¼ŒLinuxå†…æ ¸è°ƒç”¨OOM Killeræ¥æ£€æŸ¥æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å¹¶æ€æ­»å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œä»¥é‡Šæ”¾ç³»ç»Ÿå†…å­˜å¹¶ä¿æŒç³»ç»Ÿè¿è¡Œã€‚</p>
<h3 id="OOM-Killerå¦‚ä½•é€‰æ‹©è¿›ç¨‹ï¼Ÿ"><a href="#OOM-Killerå¦‚ä½•é€‰æ‹©è¿›ç¨‹ï¼Ÿ" class="headerlink" title="OOM Killerå¦‚ä½•é€‰æ‹©è¿›ç¨‹ï¼Ÿ"></a>OOM Killerå¦‚ä½•é€‰æ‹©è¿›ç¨‹ï¼Ÿ</h3><p>Linuxå†…æ ¸ç»™æ¯ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹è¯„åˆ†oom_scoreï¼Œè¯¥è¯„åˆ†æ˜¾ç¤ºäº†åœ¨å¯ç”¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ç»ˆæ­¢è¯¥è¿›ç¨‹çš„å¯èƒ½æ€§ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">oom_score &#x3D; 10 x [percent of memory used by process]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>oom_scoreæœ€å¤§å¾—åˆ†ä¸º<code>100% x 10 = 1000</code> ã€‚æ­¤å¤–ï¼Œå¦‚æœè¿›ç¨‹ä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œï¼Œåˆ™ä¸æ™®é€šç”¨æˆ·è¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„å†…å­˜ç›¸æ¯”ï¼Œè¯¥è¿›ç¨‹çš„oom_scoreç•¥ä½ã€‚</p>
</blockquote>
<p>Linux çš„æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª<code>oom_score</code> (ä½äº&#x2F;proc&#x2F;$pid&#x2F;oom_score)ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼Œå°±è¶Šæœ‰å¯èƒ½è¢« OOM Killer é€‰ä¸­ã€‚<br>è¿™ä¸ªå€¼æ˜¯ç³»ç»Ÿç»¼åˆè¿›ç¨‹çš„å†…å­˜æ¶ˆè€—é‡ã€CPUæ—¶é—´(utime + stime)ã€å­˜æ´»æ—¶é—´(uptime - start time)å’Œoom_adjè®¡ç®—å‡ºçš„ï¼Œæ¶ˆè€—å†…å­˜è¶Šå¤šåˆ†è¶Šé«˜ï¼Œå­˜æ´»æ—¶é—´è¶Šé•¿åˆ†è¶Šä½ã€‚</p>
<h3 id="å¦‚ä½•é¿å…è¿›ç¨‹è¢«OOM-Killeræ€æ­»ï¼Ÿ"><a href="#å¦‚ä½•é¿å…è¿›ç¨‹è¢«OOM-Killeræ€æ­»ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…è¿›ç¨‹è¢«OOM Killeræ€æ­»ï¼Ÿ"></a>å¦‚ä½•é¿å…è¿›ç¨‹è¢«OOM Killeræ€æ­»ï¼Ÿ</h3><h4 id="oom-score-adj"><a href="#oom-score-adj" class="headerlink" title="oom_score_adj"></a>oom_score_adj</h4><p> OOM killeræ£€æŸ¥oom_score_adjä»¥è°ƒæ•´å…¶æœ€ç»ˆè®¡ç®—å‡ºçš„åˆ†æ•°ã€‚è¯¥æ–‡ä»¶ä½äº&#x2F;proc&#x2F;$pid&#x2F;oom_score_adjä¸­,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç»™ä¸€ä¸ªå¤§çš„è´Ÿæ•°ï¼Œä»¥é™ä½è¯¥è¿›ç¨‹è¢«é€‰ä¸­å¹¶ç»ˆæ­¢çš„å¯èƒ½æ€§ã€‚oom_score_adjå–å€¼èŒƒå›´åœ¨-1000åˆ°1000ä¹‹é—´ã€‚å¦‚æœä½ ç»™äº†-1000ï¼Œè¿›ç¨‹å³ä½¿ä½¿ç”¨äº†100%çš„å†…å­˜ä¹Ÿä¸ä¼šè¢«OOM Killeræ€æ­»ã€‚</p>
<blockquote>
<p>ä¿®æ”¹pidä¸º42çš„è¿›ç¨‹çš„oom_score_adjçš„æ–¹æ³•ï¼š</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">sudo echo -200 &gt; &#x2F;proc&#x2F;42&#x2F;oom_score_adj<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>éœ€è¦ä»¥rootç”¨æˆ·æˆ–sudoçš„èº«ä»½æ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºLinuxä¸å…è®¸æ™®é€šç”¨æˆ·é™ä½OOMåˆ†æ•°ã€‚æ‚¨å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•ç‰¹æ®Šæƒé™çš„æƒ…å†µä¸‹ä»¥æ™®é€šç”¨æˆ·èº«ä»½æé«˜OOMåˆ†æ•°ã€‚ä¾‹å¦‚:</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">echo 100&gt; &#x2F;proc&#x2F;42&#x2F;oom_score_adj<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="oom-adj"><a href="#oom-adj" class="headerlink" title="oom_adj"></a>oom_adj</h4><p> å¦å¤–è¿˜æœ‰ä¸€ä¸ªè¾ƒç»†ç²’åº¦çš„åˆ†æ•°ï¼Œç§°ä¸ºoom_adjï¼Œè¯¥æ–‡ä»¶ä½äº&#x2F;proc&#x2F;$pid&#x2F;oom_adjï¼ŒèŒƒå›´ä»-16åˆ°15ã€‚ä¸oom_score_adjç±»ä¼¼ã€‚ å®é™…ä¸Šï¼Œè®¾ç½®oom_score_adjæ—¶ï¼Œå†…æ ¸ä¼šè‡ªåŠ¨å°†å…¶æŒ‰æ¯”ä¾‹ç¼©å°å¹¶è®¡ç®—oom_adjã€‚<br> å½“oom_adjçš„é­”æœ¯å€¼ä¸º-17ï¼ŒæŒ‡ç¤ºç»™å®šçš„è¿›ç¨‹æ°¸è¿œä¸èƒ½è¢«OOMæ€æ‰‹æ€æ­»ã€‚</p>
<h4 id="æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„OOMåˆ†æ•°"><a href="#æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„OOMåˆ†æ•°" class="headerlink" title="æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„OOMåˆ†æ•°"></a>æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„OOMåˆ†æ•°</h4><p> è¯¥è„šæœ¬ä»¥OOMåˆ†æ•°çš„é™åºæ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„OOMåˆ†æ•°å’ŒOOMè°ƒæ•´åçš„åˆ†æ•°ï¼š</p>
 <pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash
# Displays running processes in descending order of OOM score
printf &#39;PID\tOOM Score\tOOM Adj\tCommand\n&#39;
while read -r pid comm; do [ -f &#x2F;proc&#x2F;$pid&#x2F;oom_score ] &amp;&amp; [ $(cat &#x2F;proc&#x2F;$pid&#x2F;oom_score) !&#x3D; 0 ] &amp;&amp; printf &#39;%d\t%d\t\t%d\t%s\n&#39; &quot;$pid&quot; &quot;$(cat &#x2F;proc&#x2F;$pid&#x2F;oom_score)&quot; &quot;$(cat &#x2F;proc&#x2F;$pid&#x2F;oom_score_adj)&quot; &quot;$comm&quot;; done &lt; &lt;(ps -e -o pid&#x3D; -o comm&#x3D;) | sort -k 2nr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å·²è¢«OOMæ€æ­»"><a href="#æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å·²è¢«OOMæ€æ­»" class="headerlink" title="æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å·²è¢«OOMæ€æ­»"></a>æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å·²è¢«OOMæ€æ­»</h4> <pre class="line-numbers language-none"><code class="language-none"> $ egrep -i &#39;killed process&#39; &#x2F;var&#x2F;log&#x2F;messages
Nov 19 16:24:31 localhost kernel: Killed process 26980 (java) total-vm:14316628kB, anon-rss:6138236kB, file-rss:0kB, shmem-rss:0kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="http://linuxperf.com/?p=102">ç†è§£LINUXçš„MEMORY OVERCOMMIT</a><br><a href="http://senlinzhan.github.io/2017/07/03/oom-killer/">Linux çš„ OOM Killer æœºåˆ¶åˆ†æ</a><br><a href="https://learning-kernel.readthedocs.io/en/latest/mem-management.html">å†…å­˜ç®¡ç†</a><br><a href="https://dev.to/rrampage/surviving-the-linux-oom-killer-2ki9">Surviving the Linux OOM Killer</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Linux</tag>
        <tag>CommitLimit</tag>
        <tag>OOM killer</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven Resources Plugin äºŒè¿›åˆ¶æ–‡ä»¶filtering</title>
    <url>/2020/12/18/other/mavenresourcesplugin-binaryfiltering/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>Mavené¡¹ç›®ä¸­æ‰“åŒ…ä½¿ç”¨Maven Resources Pluginæ‹·è´é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨Filteringæ¥å¤„ç†é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­çš„å˜é‡ï¼ŒPOMæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;resources&gt;
    &lt;resource&gt;
        &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;
        &lt;filtering&gt;true&lt;&#x2F;filtering&gt;
    &lt;&#x2F;resource&gt;
&lt;&#x2F;resources&gt;
&lt;testResources&gt;
    &lt;testResource&gt;
        &lt;directory&gt;src&#x2F;test&#x2F;resources&lt;&#x2F;directory&gt;
        &lt;filtering&gt;true&lt;&#x2F;filtering&gt;
    &lt;&#x2F;testResource&gt;
&lt;&#x2F;testResources&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½†æ˜¯å¯¹äºé¡¹ç›®é…ç½®æ–‡ä»¶ç›®å½•ä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç»è¿‡Filteringå¤„ç†åï¼Œæ–‡ä»¶å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚<code>pdf</code>, <code>ddl</code>æ–‡ä»¶å†…å®¹è¢«ä¿®æ”¹ï¼Œå¯¼è‡´æ‰“åŒ…åçš„æ–‡ä»¶æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚</p>
<h1 id="äºŒã€è§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€è§£å†³æ–¹æ¡ˆ"></a>äºŒã€è§£å†³æ–¹æ¡ˆ</h1><p>Maven Resources Pluginæä¾›äº†Binary filteringé…ç½®é¡¹ï¼Œé˜»æ­¢äºŒè¿›åˆ¶æ–‡ä»¶è¢«filteringï¼Œé…ç½®æ¡ˆä¾‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;project&gt;
  ...
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;
        &lt;artifactId&gt;maven-resources-plugin&lt;&#x2F;artifactId&gt;
        &lt;version&gt;3.2.0&lt;&#x2F;version&gt;
        &lt;configuration&gt;
          ...
          &lt;nonFilteredFileExtensions&gt;
            &lt;nonFilteredFileExtension&gt;pdf&lt;&#x2F;nonFilteredFileExtension&gt;
            &lt;nonFilteredFileExtension&gt;swf&lt;&#x2F;nonFilteredFileExtension&gt;
          &lt;&#x2F;nonFilteredFileExtensions&gt;
          ...
        &lt;&#x2F;configuration&gt;
      &lt;&#x2F;plugin&gt;
    &lt;&#x2F;plugins&gt;
    ...
  &lt;&#x2F;build&gt;
  ...
&lt;&#x2F;project&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨<code>nonFilteredFileExtension</code>æ·»åŠ æ–‡ä»¶æ‰©å±•åå¯ä»¥é˜»æ­¢æ–‡ä»¶è¢«filteringã€‚</p>
<h3 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h3><p><a href="https://maven.apache.org/plugins/maven-resources-plugin/">Apache Maven Resources Plugin</a><br><a href="https://maven.apache.org/plugins/maven-resources-plugin/examples/binaries-filtering.html">Apache Maven Resources Plugin&#x2F; Binaries Filtering</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Hexoæ­å»ºä¸ªäººåšå®¢</title>
    <url>/2018/07/25/other/shi-yong-hexo-da-jian-ge-ren-bo-ke/</url>
    <content><![CDATA[<p>è®°å½•ä¸€ä¸‹è‡ªå·±ä½¿ç”¨Hexoæ­å»ºä¸ªäººåšå®¢çš„è¿‡ç¨‹ï¼Œä»¥åŠæ­å»ºè¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ã€‚<br> <strong>Hexoç®€ä»‹</strong><br>è¿™é‡Œå¼•ç”¨<a href="https://hexo.io/">Hexo</a>å®˜ç½‘ä»‹ç»ï¼š  </p>
<blockquote>
<p>å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶<br>A fast, simple &amp; powerful blog framework.</p>
</blockquote>
<h1 id="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Hexo"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Hexo" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Hexo"></a>ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©Hexo</h1><p>ä¹‹å‰ä¹Ÿæƒ³è¿‡è‡ªå·±ç”¨javaå†™ä¸€ä¸ªåšå®¢ç³»ç»Ÿï¼Œé¡ºä¾¿èƒ½å­¦ä¹ ä¸€äº›å¼€å‘æŠ€æœ¯ã€‚é€šè¿‡ä¸€æ®µæ—¶é—´çš„æŠ˜è…¾ï¼Œä¸»è¦å‘ç°æœ‰ä¸€ä¸‹å‡ ä¸ªé—®é¢˜ï¼Œäºæ˜¯æ”¾å¼ƒäº†è‡ªå·±å¼€å‘çš„è®¡åˆ’è½¬è€Œé‡‡ç”¨å¼€æºæ¡†æ¶ã€‚</p>
<blockquote>
<p>ä½¿ç”¨javaè‡ªè¡Œå¼€å‘ä¸ªäººåšå®¢ç³»ç»Ÿé‡åˆ°çš„é—®é¢˜ï¼š</p>
</blockquote>
<ul>
<li>å¼€å‘å‘¨æœŸé•¿ï¼šè™½ç„¶å¯ä»¥ä½¿ç”¨ä¸€äº›è„šæ‰‹æ¶å¿«é€Ÿæ­å»ºåšå®¢ç³»ç»Ÿæ¡†æ¶ï¼Œä½†æ˜¯ä»éœ€è¦ä¸ªäººå¤§é‡çš„å¼€å‘æ—¶é—´å»å®ç°åŠè°ƒè¯•ä»£ç ã€‚</li>
<li>UIæ ·å¼ä¸ç¾è§‚: ç”±äºæœ¬äººæ˜¯éå‰ç«¯å¼€å‘äººå‘˜ï¼Œåªèƒ½é€šè¿‡å‰ç«¯çš„ä¸€äº›è„šæ‰‹æ¶å»æ­å»ºåšå®¢å‰ç«¯ï¼ŒUIè®¾è®¡ä¸å¤Ÿç¾è§‚ã€‚</li>
<li>åç¦»åˆå§‹ç›®æ ‡ï¼šè‡ªå·±å¼€å‘åšå®¢çš„ç›®æ ‡æ˜¯é€šè¿‡å¼€å‘è¿‡ç¨‹æé«˜ç¼–ç æ°´å¹³ï¼Œä½†æ˜¯éšç€åœ¨å·¥ä½œä¸­çš„æˆé•¿ï¼ŒçŸ¥è¯†é¢å·²ç»é“ºå¼€ï¼Œæ­å»ºä¸ªäººåšå®¢å·²ç»æ— æ³•å¸¦æ¥æŠ€æœ¯æ·±å±‚é¢æˆé•¿ï¼Œåªæ˜¯é‡å¤é€ è½®å­ç½¢äº†ã€‚</li>
</ul>
<h2 id="hexo-åšå®¢çš„ä¼˜ç‚¹"><a href="#hexo-åšå®¢çš„ä¼˜ç‚¹" class="headerlink" title="hexo åšå®¢çš„ä¼˜ç‚¹"></a>hexo åšå®¢çš„ä¼˜ç‚¹</h2><ul>
<li>æ”¯æŒMarkDownæ ¼å¼</li>
<li>ä½¿ç”¨Node.jsç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œéƒ¨ç½²ç®€ä¾¿</li>
<li>æœ‰ä¸°å¯Œçš„ä¸»é¢˜å¯ä»¥é€‰æ‹©</li>
<li>æœ‰ä¸°å¯Œçš„æ’ä»¶æ‰©å±•æ€§å¼º</li>
</ul>
<p>é€‰æ‹©hexoæ­å»ºä¸ªäººåšå®¢å®Œå…¨æ»¡è¶³æˆ‘ä¸ªäººå†™åšå®¢çš„è¦æ±‚ï¼Œæœ€ç»ˆé€‰æ‹©ä½¿ç”¨hexoæ¥æ­å»ºä¸ªäººåšå®¢ã€‚</p>
<h1 id="äºŒã€å¦‚ä½•ç®¡ç†ä¸ªäººåšå®¢"><a href="#äºŒã€å¦‚ä½•ç®¡ç†ä¸ªäººåšå®¢" class="headerlink" title="äºŒã€å¦‚ä½•ç®¡ç†ä¸ªäººåšå®¢"></a>äºŒã€å¦‚ä½•ç®¡ç†ä¸ªäººåšå®¢</h1><h2 id="2-1-åšå®¢èµ„æºæ–‡ä»¶å­˜å‚¨"><a href="#2-1-åšå®¢èµ„æºæ–‡ä»¶å­˜å‚¨" class="headerlink" title="2.1 åšå®¢èµ„æºæ–‡ä»¶å­˜å‚¨"></a>2.1 åšå®¢èµ„æºæ–‡ä»¶å­˜å‚¨</h2><p>ä¸ªäººåšå®¢æ˜¯ä»¥Node.jsé¡¹ç›®å½¢å¼æ‰˜ç®¡åˆ°githubçš„ç§æœ‰ä»“åº“ä¸­çš„ï¼Œæ–¹ä¾¿æˆ‘åœ¨ä»»æ„è®¾å¤‡å»ç¼–è¾‘å‘å¸ƒåšå®¢ã€‚</p>
<h2 id="2-2-å†™ä½œåŠæäº¤æ–°æ–‡ç« "><a href="#2-2-å†™ä½œåŠæäº¤æ–°æ–‡ç« " class="headerlink" title="2.2 å†™ä½œåŠæäº¤æ–°æ–‡ç« "></a>2.2 å†™ä½œåŠæäº¤æ–°æ–‡ç« </h2><p>ä»githubæ£€å‡ºé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>jetbrain</code>ç³»åˆ—çš„å¼€å‘å·¥å…·å®‰è£…MarkDownæ’ä»¶åè¿›è¡Œå†™ä½œæ–°æ–‡ç« ï¼Œæˆ–è€…ä½¿ç”¨å¸¸ç”¨MarkDownè½¯ä»¶è¿›è¡Œå†™ä½œï¼Œå®Œæˆåå°†æ–‡ç« æäº¤åˆ°githubä»“åº“ã€‚</p>
<h2 id="2-3-æ–‡ç« å‘å¸ƒæ›´æ–°"><a href="#2-3-æ–‡ç« å‘å¸ƒæ›´æ–°" class="headerlink" title="2.3 æ–‡ç« å‘å¸ƒæ›´æ–°"></a>2.3 æ–‡ç« å‘å¸ƒæ›´æ–°</h2><blockquote>
<p><strong>å‰ç½®æ¡ä»¶</strong><br>ç›®å‰ä¸ªäººåšå®¢æ˜¯éƒ¨ç½²åœ¨ä¸ªäººè´­ä¹°çš„åä¸ºäº‘æœåŠ¡å™¨ä¸Šï¼Œä½¿ç”¨Nginxè¿›è¡Œæ‰˜ç®¡çš„ã€‚<br>äº‘æœåŠ¡å™¨å®‰è£…Node.jsåŠhexoç¯å¢ƒï¼Œå°†githubä¸Šçš„åšå®¢ä»“åº“å…‹éš†åˆ°æœ¬åœ°,åœ¨Nginxä¸­å°†åšå®¢çš„æ‰˜ç®¡è·¯å¾„è®¾ç½®ä¸ºhexoåšå®¢æ„å»ºç›®å½•ã€‚</p>
</blockquote>
<p>æ–‡ç« å‘å¸ƒæ—¶åªåœ¨æœ¬åœ°ä»“åº“ä¸‹æ‰§è¡Œ<code>git pull</code>å’Œ<code>hexo g</code>ä¸¤ä¸ªå‘½ä»¤å³å¯ç”Ÿæˆåšå®¢å†…å®¹ã€‚<br>ä¸ºç®€åŒ–æ“ä½œï¼Œå°†ä¸Šè¿°è„šæœ¬å†™å…¥shellè„šæœ¬ï¼Œé€šè¿‡æ‰§è¡Œè„šæœ¬è¿›è¡Œå‘å¸ƒæ–‡ç« ã€‚å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½å»æ‰‹åŠ¨å‘å¸ƒï¼Œå¯ä»¥æ·»åŠ ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ï¼Œåšåˆ°å®šæ—¶æ‰§è¡Œè„šæœ¬å»å‘å¸ƒæ–‡ç« ã€‚</p>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>ä½¿ç”¨githubæ‰˜ç®¡åšå®¢ä¸»è¦çš„ä¼˜ç‚¹åœ¨äºæ·»åŠ æ–°æ–‡ç« æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨MarkDownå†™å®Œæ–‡ç« åï¼Œå¯ä»¥æ–¹ä¾¿çš„æäº¤åˆ°itHubè¿›è¡Œç®¡ç†ï¼›ç„¶åå¯ä»¥åœ¨ä»»æ„åœ°æ–¹å»ç¼–è¾‘ä¿®æ”¹åŠéƒ¨ç½²ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>åšå®¢</tag>
      </tags>
  </entry>
  <entry>
    <title>LinuxæœåŠ¡å™¨é‡å¯åmysqld.serviceæœªåˆ›å»º/var/run/mysqld</title>
    <url>/2021/12/20/mysql/linux-fu-wu-qi-chong-qi-hou-mysqld.service-wei-chuang-jian-mysqld.pid-fu-mu-lu-wen-ti/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>å¼€å‘ç¯å¢ƒçš„æ•°æ®åº“æœåŠ¡å™¨é‡å¯åï¼Œå¯åŠ¨MySQlæœåŠ¡æŠ¥é”™ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">[ERROR] &#x2F;usr&#x2F;sbin&#x2F;mysqld: Can&#39;t create&#x2F;write to file &#39;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid&#39; (Errcode: 2 - No such file or directory)
[ERROR] Can&#39;t start server: can&#39;t create PID file: No such file or directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä¹‹å‰çœ‹åˆ°ä¸Šé¢é”™è¯¯æ—¥å¿—éƒ½æ˜¯æ‰‹åŠ¨åˆ›å»º<code>/var/run/mysqld</code>ç›®å½•ï¼Œç„¶åå°†ç›®å½•çš„å±ä¸»ä¿®æ”¹ä¸ºmysqlç”¨æˆ·ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">mkdir -p &#x2F;var&#x2F;run&#x2F;mysqld
chown mysql:mysql &#x2F;var&#x2F;run&#x2F;mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä¸Šé¢æ–¹å¼ï¼Œæ¯æ¬¡æœåŠ¡å™¨é‡å¯åéƒ½è¦é‡æ–°æ‰§è¡Œï¼Œæ‰€ä»¥åˆ†æä¸€ä¸‹é—®é¢˜åŸå› ï¼Œæ¢ç´¢ä¸€ç§æ°¸ä¹…çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>MySQLç‰ˆæœ¬ä¿¡æ¯<br>mysql  Ver 14.14 Distrib 5.7.10, for Linux (x86_64) using  EditLine wrapper</p>
</blockquote>
<h1 id="äºŒã€é—®é¢˜åŸå› "><a href="#äºŒã€é—®é¢˜åŸå› " class="headerlink" title="äºŒã€é—®é¢˜åŸå› "></a>äºŒã€é—®é¢˜åŸå› </h1><p>é€šè¿‡æŸ¥æ‰¾å‘ç°è¯¥é—®é¢˜æ˜¯MySQL5.7çš„ä¸€ä¸ªå°bugï¼Œè¯¦è§ï¼š<br><a href="https://bugs.mysql.com/bug.php?id=100506">Bug #100506	mysqld.service does not create &#x2F;var&#x2F;run&#x2F;mysqld after reboot</a></p>
<p>è¯¥é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯&#x2F;var&#x2F;runç›®å½•æ˜¯ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œå­˜åœ¨äºå†…å­˜ä¹‹ä¸­ï¼Œç³»ç»Ÿé‡å¯å&#x2F;var&#x2F;runç›®å½•ä¸‹çš„æ–‡ä»¶å°†ä¼šè¢«æ“¦é™¤ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">[root@develop log]# ll &#x2F;var&#x2F;run
lrwxrwxrwx. 1 root root 6 Sep 27 22:33 &#x2F;var&#x2F;run -&gt; ..&#x2F;run

[root@develop log]# df -hT
Filesystem                Type      Size  Used Avail Use% Mounted on
&#x2F;dev&#x2F;mapper&#x2F;centos00-root xfs        30G   22G  8.0G  74% &#x2F;
devtmpfs                  devtmpfs   16G     0   16G   0% &#x2F;dev
tmpfs                     tmpfs      16G     0   16G   0% &#x2F;dev&#x2F;shm
tmpfs                     tmpfs      16G  682M   15G   5% &#x2F;run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>/var/run</code>ç›®å½•é€šè¿‡è½¯è¿æ¥æŒ‚è½½åœ¨<code>/run</code>ç›®å½•ä¸‹ï¼Œ<code>/run</code>ç›®å½•æ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸º<code>tmpfs</code></p>
<h2 id="åŸå› æ€»ç»“ï¼š"><a href="#åŸå› æ€»ç»“ï¼š" class="headerlink" title="åŸå› æ€»ç»“ï¼š"></a>åŸå› æ€»ç»“ï¼š</h2><p>å®‰è£…MySQLæ—¶ï¼Œmysql-community-server-5.7.31-1.el7.x86_64 rpm åˆ›å»ºäº†<code>/var/run/mysqld</code>ç›®å½•ï¼Œç³»ç»Ÿé‡å¯åè¿™ä¸ªç›®å½•è¢«æ“¦é™¤äº†ã€‚</p>
<h1 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h1><h2 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h2><p>ä½¿ç”¨<code>tmpfiles.d</code>åœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™åˆ›å»º<code>/var/run/mysqld</code>ç›®å½•ï¼Œ<a href="https://www.freedesktop.org/software/systemd/man/tmpfiles.d.html">tmpfiles.dç®€ä»‹</a>ã€‚<br>åœ¨<code>/usr/lib/tmpfiles.d</code>ç›®å½•ä¸‹åˆ›å»º<code>mysql.conf</code>æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">d &#x2F;run&#x2F;mysqld 0755 mysql mysql  -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æˆ–ç›´æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">echo &quot;d &#x2F;var&#x2F;run&#x2F;mysqld 0755 mysql mysql -&quot; &gt; &#x2F;usr&#x2F;lib&#x2F;tmpfiles.d&#x2F;mysql.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ“ä½œç³»ç»Ÿé‡å¯åä¼šæ ¹æ®<code>/usr/lib/tmpfiles.d/mysql.conf</code>åˆ›å»º<code>/var/run/mysqld</code>ç›®å½•ã€‚</p>
<h2 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h2><p>ä¿®æ”¹MySQLé…ç½®æ–‡ä»¶<code>/etc/my.cnf</code>ä¸­çš„<code>pid-file</code>çš„è·¯å¾„ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">
datadir&#x3D;&#x2F;data&#x2F;deploy&#x2F;mysql&#x2F;data
socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links&#x3D;0

log-error&#x3D;&#x2F;var&#x2F;log&#x2F;mysqld.log
pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid

skip-external-locking
key_buffer_size &#x3D; 256M
max_allowed_packet &#x3D; 16M
table_open_cache &#x3D; 2048
sort_buffer_size &#x3D; 2M
read_buffer_size &#x3D; 2M
read_rnd_buffer_size &#x3D; 8M
myisam_sort_buffer_size &#x3D; 64M
thread_cache_size &#x3D; 64
query_cache_size &#x3D; 256M
max_connections &#x3D; 1024

default-storage-engine&#x3D;INNODB
lower_case_table_names&#x3D;1
explicit_defaults_for_timestamp&#x3D;true
sql_mode&#x3D;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
character_set_server&#x3D; utf8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å°†â€™pid-file<code>æ–‡ä»¶è·¯å¾„ä¿®æ”¹ä¸º</code>&#x2F;var&#x2F;lib&#x2F;mysql&#96;.</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨æ–‡æœ¬åˆ†ç±»æ¨¡å‹ç®€ä»‹</title>
    <url>/2024/03/06/machine-learning/chang-yong-wen-ben-fen-lei-mo-xing/</url>
    <content><![CDATA[<h1 id="1-èƒŒæ™¯ç®€ä»‹"><a href="#1-èƒŒæ™¯ç®€ä»‹" class="headerlink" title="1.èƒŒæ™¯ç®€ä»‹"></a>1.èƒŒæ™¯ç®€ä»‹</h1><p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¸¸è§çš„æ–‡æœ¬åˆ†ç±»ç®—æ³•æ¨¡å‹åŠå…¶ä¼˜ç¼ºç‚¹ï¼Œä¸‹é¢å…³é”®æ”¶é›†è‡ªäº’è”ç½‘ï¼ŒæŒ‰éœ€è·å–ã€‚</p>
<h1 id="2-æ–‡æœ¬åˆ†ç±»æ¨¡å‹"><a href="#2-æ–‡æœ¬åˆ†ç±»æ¨¡å‹" class="headerlink" title="2.æ–‡æœ¬åˆ†ç±»æ¨¡å‹"></a>2.æ–‡æœ¬åˆ†ç±»æ¨¡å‹</h1><p>åœ¨æ–‡æœ¬åˆ†ç±»ä¸­ï¼Œæœ‰å¤šç§æ¨¡å‹å¯ä»¥è¿›è¡Œé€‰æ‹©ï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“é€‰å“ªä¸ªï¼Œå¯ä»¥é€‰æ‹©CNN è¿›è¡Œå°è¯•ï¼Œå…¼é¡¾äº†è¿è¡Œæ•ˆç‡å’Œæœ€ç»ˆç»“æœã€‚ä»¥ä¸‹æ˜¯æ¨¡å‹çš„è¯´æ˜ï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„å…·ä½“åœºæ™¯ï¼Œé€‰æ‹©ä¸€ä¸ªæ›´é€‚åˆçš„æ¨¡å‹ã€‚</p>
<ul>
<li><p><strong>FastText</strong> : åˆ†ç±»æ¨¡å‹é€Ÿåº¦å¿«ï¼Œè®¡ç®—èµ„æºè¦æ±‚ä½ï¼Œé€‚åˆæ ·æœ¬æ•°é‡å¤§ã€ç±»åˆ«æ ‡ç­¾å¤šï¼Œé€‚åˆä¸éœ€è¦å¤ªå¤šè¯­ä¹‰ç†è§£çš„ä»»åŠ¡ã€‚</p>
</li>
<li><p><strong>CNN</strong>: åˆ†ç±»æ¨¡å‹ç›¸æ¯”FastText æ¨¡å‹ï¼ŒCNN é€‚ç”¨å¤æ‚åº¦æ›´é«˜çš„åœºæ™¯ï¼Œå¯æ•æ‰æ›´å¤šã€æ›´å¹¿ã€æ›´ç»†è‡´çš„æ–‡æœ¬ç‰¹å¾ï¼Œé€‚åˆéœ€è¦ä¸€å®šè¯­ä¹‰ç†è§£çš„ä»»åŠ¡ã€‚å¯¹æ¯”FastText é€šå¸¸æ•ˆæœè¦å¥½ä¸€äº›ï¼Œä½†è®­ç»ƒæ—¶é—´ä¹Ÿä¼šæ›´é•¿ã€‚</p>
</li>
<li><p><strong>Self-Attention</strong>: åˆ†ç±»æ¨¡å‹ç›¸æ¯”FastText æ¨¡å‹ï¼ŒSelf-Attention é€‚åº”å¤æ‚åº¦æ›´é«˜çš„åœºæ™¯ï¼Œå¯æ•æ‰æ›´å¤šã€æ›´å¹¿ã€æ›´ç»†è‡´çš„ç‰¹å¾ï¼›è·ŸCNN ç›¸æ¯”ï¼Œèƒ½æ›´å¥½åœ°æ•æ‰æ–‡æœ¬é‡Œçš„é•¿æœŸä¾èµ–ã€‚é€‚åˆéœ€è¦ä¸€å®šè¯­ä¹‰ç†è§£çš„ä»»åŠ¡ã€‚è®­ç»ƒæ—¶é—´è·Ÿæ•ˆæœè·Ÿ CNN ç±»ä¼¼ã€‚</p>
</li>
<li><p><strong>BERT</strong>: å°æ ·æœ¬åˆ†ç±»æ¨¡å‹ï¼Œä¸»è¦åŸç†ä¸ºä½¿ç”¨ BERTæ¨¡å‹ ä»å¤§é‡æ— æ ‡æ³¨è¯­æ–™è¿›è¡Œé¢„è®­ç»ƒã€‚é€‚ç”¨äºæ ‡æ³¨è¯­æ–™æœ‰é™çš„åœºæ™¯ï¼Œè®­ç»ƒå’Œé¢„æµ‹æ—¶é—´è¾ƒé•¿ã€‚</p>
</li>
<li><p><strong>StructBERT</strong>: ä¸»è¦åŸç†ä¸ºä½¿ç”¨StructBERTæ¨¡å‹ ä»å¤§é‡æ— æ ‡æ³¨è¯­æ–™è¿›è¡Œé¢„è®­ç»ƒï¼Œç²¾åº¦è¾ƒé«˜ï¼Œæ¨ç†é€Ÿåº¦è¾ƒæ…¢ã€‚</p>
</li>
<li><p><strong>StructBERTå°æ ·æœ¬åˆ†ç±»</strong>: åŸºäºStructBert-baseï¼Œåœ¨xnliæ•°æ®é›†ï¼ˆå°†è‹±æ–‡æ•°æ®é›†é‡æ–°ç¿»è¯‘å¾—åˆ°ä¸­æ–‡æ•°æ®é›†ï¼‰ä¸Šé¢è¿›è¡Œäº†è‡ªç„¶è¯­è¨€æ¨ç†ä»»åŠ¡è®­ç»ƒã€‚<br>é€‚ç”¨åœºæ™¯ï¼šé¢å‘æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯å¤šå±‚çº§ï¼ˆæœ€å¤š3çº§ï¼‰ã€æ ‡ç­¾æ•°ç›®å¤§ï¼Œè®­ç»ƒæ ·æœ¬å°‘çš„ä½èµ„æºåœºæ™¯ã€‚æ—¶é—´å¼€é”€ä¼šæ¯”è¾ƒå¤§<br>å…¸å‹è¾“å…¥æ ·ä¾‹ï¼šæ”¯æŒæœ€å¤š3å±‚çš„å±‚çº§åˆ†ç±»ï¼Œ3å±‚æ ‡ç­¾å­—æ®µå›ºå®šä¸ºâ€œä¸€çº§æ ‡ç­¾â€ã€â€œäºŒçº§æ ‡ç­¾â€å’Œâ€œä¸‰çº§æ ‡ç­¾â€ã€‚æ¯ä¸€å±‚ä¸ºå•æ ‡ç­¾åˆ†ç±»</p>
</li>
</ul>
<h1 id="3-å¼€æºä»“åº“"><a href="#3-å¼€æºä»“åº“" class="headerlink" title="3.å¼€æºä»“åº“"></a>3.å¼€æºä»“åº“</h1><p><a href="https://github.com/649453932/Chinese-Text-Classification-Pytorch">Chinese-Text-Classification-Pytorch</a></p>
<p><a href="https://github.com/649453932/Bert-Chinese-Text-Classification-Pytorch">Bert-Chinese-Text-Classification-Pytorch</a></p>
<h1 id="4-å‚è€ƒæ–‡æ¡£"><a href="#4-å‚è€ƒæ–‡æ¡£" class="headerlink" title="4.å‚è€ƒæ–‡æ¡£"></a>4.å‚è€ƒæ–‡æ¡£</h1><p><a href="https://zhuanlan.zhihu.com/p/73176084">ä¸­æ–‡æ–‡æœ¬åˆ†ç±» pytorchå®ç°</a></p>
<p><a href="https://help.aliyun.com/document_detail/162446.html?spm=a2c4g.162450.0.0.53fb36f1QHZ5iE">æ¨¡å‹è¯´æ˜</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ–‡æœ¬åˆ†ç±»</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸­MVCCæ˜¯å¦çœŸçš„èƒ½å¤Ÿè§£å†³å¹»è¯»é—®é¢˜ï¼Ÿ</title>
    <url>/2019/04/30/mysql/mysql-zhong-mvcc-shi-fou-zhen-de-neng-gou-jie-jue-huan-du-wen-ti/</url>
    <content><![CDATA[<p>&emsp;&emsp;å¶ç„¶é—´çœ‹åˆ°åŒäº‹åœ¨çœ‹MySQLçš„MVCCé—®é¢˜ï¼Œå°±éšå£æ’äº†ä¸€å¥ï¼Œâ€œMVCCæ¨¡å¼è§£å†³äº†MySQLä¸­çš„å¹»è¯»é—®é¢˜â€ï¼Œä½†æ˜¯</p>
<p>åŒäº‹å‘Šè¯‰æˆ‘å¹¶æ²¡æœ‰ï¼Œæˆ‘è¯´ä¸å¯èƒ½ï¼Œæˆ‘æ¸…æ¥šçš„è®°å¾—åœ¨çœ‹ã€Šé«˜æ€§èƒ½MySQL ç¬¬3ç‰ˆã€‹ä¸€ä¹¦çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸­çš„ï¼Œåœ¨ä»‹ç»**REPEATABLE READ **éš”ç¦»çº§åˆ«æ—¶å€™æè¿‡ï¼ŒMVCCè§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚è¯´å®Œæˆ‘è¿˜æ‰¾åˆ°äº†ä¹¦ä¸­å†…å®¹ç»™ä»–çœ‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<p>è‹±æ–‡åŸç‰ˆï¼š</p>
<blockquote>
<ul>
<li>REPEATABLE READ</li>
</ul>
<p> REPEATABLE READ solves the problems that READ UNCOMMITTED allows. It guarantees<br> that any rows a transaction reads will â€œlook the sameâ€ in subsequent reads within<br> the same transaction, but in theory it still allows another tricky problem: phantom<br> reads. Simply put, a phantom read can happen when you select some range of rows,<br> another transaction inserts a new row into the range, and then you select the same<br> range again; you will then see the new â€œphantomâ€ row. InnoDB and XtraDB solve<br> the phantom read problem with multiversion concurrency control, which we explain later in this chapter.<br> REPEATABLE READ is MySQLâ€™s default transaction isolation level. </p>
</blockquote>
<p>ä¸­æ–‡ç‰ˆï¼š</p>
<blockquote>
<ul>
<li><p>REPEATABLE READ(å¯é‡å¤è¯»)</p>
<p>REPEATABLE READè§£å†³äº†è„è¯»çš„é—®é¢˜ã€‚è¯¥çº§åˆ«ä¿è¯äº†åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·è®°å½•çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯ç†è®ºä¸Š,å¯é‡å¤è¯»éš”ç¦»çº§åˆ«è¿˜æ˜¯æ— æ³•è§£å†³å¦å¤–ä¸€ä¸ªå¹»è¯»( Phantom read)çš„é—®é¢˜ã€‚æ‰€è°“å¹»è¯»,æŒ‡çš„æ˜¯å½“æŸä¸ªäº‹åŠ¡åœ¨è¯»å–æŸä¸ªèŒƒå›´å†…çš„è®°å½•æ—¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°çš„è®°å½•,å½“ä¹‹å‰çš„äº‹åŠ¡å†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶,ä¼šäº§ç”Ÿå¹»è¡Œ( Phantom row)ã€‚ InnoDBå’Œ XtraDBå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC, Multiversion Concurrency Control)è§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚æœ¬ç« ç¨åä¼šåšè¿›ä¸€æ­¥çš„è®¨è®ºã€‚</p>
<p>å¯é‡å¤è¯»æ˜¯ MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚</p>
</li>
</ul>
</blockquote>
<p>åŒäº‹è¯´è¿™ä¹Ÿæ˜¯ä»–æ­£åœ¨æŸ¥æ‰¾çš„é—®é¢˜ï¼Œå¹¶ç»™æˆ‘æ¼”ç¤ºäº†ä¸€ä¸ªæ¡ˆä¾‹ï¼Œç›¸å…³è¡¨ç»“æ„æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">CREATE TABLE &#96;employee&#96; (
  &#96;Id&#96; int(11) NOT NULL AUTO_INCREMENT,
  &#96;Name&#96; varchar(50) DEFAULT NULL,
  &#96;Salary&#96; int(11) DEFAULT NULL,
  &#96;DepartmentId&#96; int(11) DEFAULT NULL,
  PRIMARY KEY (&#96;Id&#96;)
) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;5 DEFAULT CHARSET&#x3D;utf8;

insert  into &#96;employee&#96;(&#96;Id&#96;,&#96;Name&#96;,&#96;Salary&#96;,&#96;DepartmentId&#96;) values (1,&#39;Joe&#39;,70000,1);
insert  into &#96;employee&#96;(&#96;Id&#96;,&#96;Name&#96;,&#96;Salary&#96;,&#96;DepartmentId&#96;) values (2,&#39;Henry&#39;,80000,2);
insert  into &#96;employee&#96;(&#96;Id&#96;,&#96;Name&#96;,&#96;Salary&#96;,&#96;DepartmentId&#96;) values (3,&#39;Sam&#39;,6000,2);
insert  into &#96;employee&#96;(&#96;Id&#96;,&#96;Name&#96;,&#96;Salary&#96;,&#96;DepartmentId&#96;) values (4,&#39;Max&#39;,90000,1);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>äº‹åŠ¡æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2019/04/30/mysql/mysql-zhong-mvcc-shi-fou-zhen-de-neng-gou-jie-jue-huan-du-wen-ti/%E4%BA%8B%E5%8A%A1%E6%BC%94%E7%A4%BA.png" alt="MySQLå¹»è¯»çš„æƒ…æ™¯æ¼”ç¤º"></p>
<ul>
<li><p>1ã€å¼€å§‹äº‹åŠ¡A</p>
</li>
<li><p>2ã€æŸ¥è¯¢employeeè¡¨ä¸­æ‰€æœ‰æ•°æ®</p>
<p><img src="/2019/04/30/mysql/mysql-zhong-mvcc-shi-fou-zhen-de-neng-gou-jie-jue-huan-du-wen-ti/%E5%BC%80%E5%A7%8B%E4%BA%8B%E5%8A%A1A.png" alt="å¼€å§‹äº‹åŠ¡A"></p>
</li>
<li><p>3ã€å¼€å§‹äº‹åŠ¡B</p>
</li>
<li><p>4ã€å‘employeeè¡¨ä¸­æ’å…¥2æ¡æ•°æ®</p>
</li>
<li><p>5ã€æäº¤äº‹åŠ¡B</p>
<p><img src="/2019/04/30/mysql/mysql-zhong-mvcc-shi-fou-zhen-de-neng-gou-jie-jue-huan-du-wen-ti/%E6%89%A7%E8%A1%8C%E4%BA%8B%E5%8A%A1B.png" alt="æ‰§è¡Œäº‹åŠ¡B"></p>
</li>
<li><p>6ã€åœ¨äº‹åŠ¡Aä¸­æ‰§è¡ŒæŸ¥è¯¢</p>
<p><img src="/2019/04/30/mysql/mysql-zhong-mvcc-shi-fou-zhen-de-neng-gou-jie-jue-huan-du-wen-ti/%E4%BA%8B%E5%8A%A1B%E6%8F%90%E4%BA%A4%E5%90%8E%E5%86%8D%E6%AC%A1%E5%9C%A8%E4%BA%8B%E5%8A%A1A%E4%B8%AD%E6%9F%A5%E8%AF%A2.png" alt="äº‹åŠ¡Bæäº¤åå†æ¬¡åœ¨äº‹åŠ¡Aä¸­æŸ¥è¯¢"></p>
</li>
</ul>
<p>&emsp;&emsp;ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºMySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆREPEATABLE READï¼‰è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºå¹»è¯»æˆ‘ä»¬ç»§ç»­éªŒè¯ã€‚</p>
<ul>
<li><p>7ã€æ›´æ–°employeeè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œ å°†DepartmentIdéƒ½è®¾ç½®ä¸º1</p>
</li>
<li><p>8ã€æ›´æ–°æ“ä½œæ‰§è¡Œåå†æ¬¡æŸ¥è¯¢</p>
<p><img src="/2019/04/30/mysql/mysql-zhong-mvcc-shi-fou-zhen-de-neng-gou-jie-jue-huan-du-wen-ti/%E6%9B%B4%E6%96%B0%E5%90%8E%E5%86%8D%E6%AC%A1%E6%9F%A5%E8%AF%A2.png" alt="æ›´æ–°åå†æ¬¡æŸ¥è¯¢"></p>
</li>
</ul>
<p>æ­¤æ—¶æˆ‘ä»¬å‘ç°ï¼Œåœ¨Aäº‹åŠ¡ä¸­ç«Ÿç„¶èƒ½å¤ŸæŸ¥çœ‹åˆ°Bäº‹åŠ¡æ’å…¥çš„2æ¡æ•°æ®ï¼Œæˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„å®šä¹‰åŠç°è±¡ï¼š</p>
<p>ä»¥ä¸‹å†…å®¹å‡æ¥è‡ªMySQLå®˜ç½‘ï¼š<a href="https://dev.mysql.com/doc/refman/5.7/en/">https://dev.mysql.com/doc/refman/5.7/en/</a></p>
<p><strong>è„è¯»ï¼š</strong></p>
<blockquote>
<ul>
<li><p>dirty read </p>
<p>An operation that retrieves unreliable data, data that was updated by another transaction but not yet committed. It is only possible with the isolation level known as read uncommitted.</p>
</li>
</ul>
</blockquote>
<p>è„è¯»æ„å‘³ç€ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®,è€Œè¿™ä¸ªæ•°æ®æ˜¯æœ‰å¯èƒ½å›æ»šã€‚</p>
<p><strong>ä¸å¯é‡å¤è¯»ï¼š</strong></p>
<blockquote>
<ul>
<li><p>non-repeatable read </p>
<p>The situation when a query retrieves data, and a later query within the same transaction retrieves what should be the same data, but the queries return different results (changed by another transaction committing in the meantime).</p>
</li>
</ul>
</blockquote>
<p>ä¸å¯é‡å¤è¯»æ„å‘³ç€åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸åŒæ—¶é—´çš„ç›¸åŒæŸ¥è¯¢çš„è¿”å›ç»“æœä¸ä¸€è‡´ï¼Œç”±äºå¦å¤–å·²æäº¤çš„äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ã€‚</p>
<p><strong>å¹»è¯»ï¼š</strong></p>
<blockquote>
<ul>
<li><p>phantom </p>
<p>A row that appears in the result set of a query, but not in the result set of an earlier query. For example, if a query is run twice within a transaction, and in the meantime, another transaction commits after inserting a new row or updating a row so that it matches the WHERE clause of the query.</p>
</li>
</ul>
</blockquote>
<p>å¹»è¯»æ„å‘³ç€åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç›¸åŒçš„æŸ¥è¯¢åœ¨æœ€æ–°çš„ç»“æœé›†ä¸­å‡ºç°äº†æ–°çš„è¡Œæ•°æ®ã€‚</p>
<p>æ€»ç»“ï¼šæ ¹æ®ä¸Šé¢çš„å®éªŒæ¡ˆä¾‹ä»¥åŠå¹»è¯»çš„å®šä¹‰ï¼Œä¸Šè¿°æ¡ˆä¾‹ç¡®å®å­˜åœ¨å¹»è¯»çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹MVCCçš„å®ç°åŸç†ï¼Œå¹¶ç»“åˆMySQLæºç åˆ†æä¸€ä¸‹å¹»è¯»äº§ç”Ÿçš„åŸå› ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯MVCCï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯MVCCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯MVCCï¼Ÿ"></a>ä»€ä¹ˆæ˜¯MVCCï¼Ÿ</h1><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°å¹»è¯»çš„é—®é¢˜ï¼Ÿåœ¨è§£é‡Šè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•ä»‹ç»ä¸€ä¸‹MySQLä¸­MVCCã€‚</p>
<p><strong>MVCCç®€ä»‹ï¼š</strong></p>
<p>å¼•ç”¨ï¼š<a href="http://mysql.taobao.org/monthly/2017/12/01/">[é˜¿é‡Œæ•°æ®åº“å†…æ ¸â€™2017&#x2F;12â€™æœˆæŠ¥]</a></p>
<blockquote>
<p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(Multiversion concurrency controlï¼Œ MCC æˆ– <strong>MVCC</strong>)æŒ‡çš„æ˜¯ä¸€ç§æé«˜å¹¶å‘çš„æŠ€æœ¯ã€‚æœ€æ—©çš„æ•°æ®åº“ç³»ç»Ÿï¼Œåªæœ‰è¯»è¯»ä¹‹é—´å¯ä»¥å¹¶å‘ï¼Œè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™éƒ½è¦é˜»å¡ã€‚å¼•å…¥å¤šç‰ˆæœ¬ä¹‹åï¼Œåªæœ‰å†™å†™ä¹‹é—´ç›¸äº’é˜»å¡ï¼Œå…¶ä»–ä¸‰ç§æ“ä½œéƒ½å¯ä»¥å¹¶è¡Œï¼Œè¿™æ ·å¤§å¹…åº¦æé«˜äº†InnoDBçš„å¹¶å‘åº¦ã€‚åœ¨å†…éƒ¨å®ç°ä¸­ï¼Œä¸Postgresåœ¨æ•°æ®è¡Œä¸Šå®ç°å¤šç‰ˆæœ¬ä¸åŒï¼ŒInnoDBæ˜¯åœ¨undologä¸­å®ç°çš„ï¼Œé€šè¿‡undologå¯ä»¥æ‰¾å›æ•°æ®çš„å†å²ç‰ˆæœ¬ã€‚æ‰¾å›çš„æ•°æ®å†å²ç‰ˆæœ¬å¯ä»¥æä¾›ç»™ç”¨æˆ·è¯»(æŒ‰ç…§éš”ç¦»çº§åˆ«çš„å®šä¹‰ï¼Œæœ‰äº›è¯»è¯·æ±‚åªèƒ½çœ‹åˆ°æ¯”è¾ƒè€çš„æ•°æ®ç‰ˆæœ¬)ï¼Œä¹Ÿå¯ä»¥åœ¨å›æ»šçš„æ—¶å€™è¦†ç›–æ•°æ®é¡µä¸Šçš„æ•°æ®ã€‚åœ¨InnoDBå†…éƒ¨ä¸­ï¼Œä¼šè®°å½•ä¸€ä¸ªå…¨å±€çš„æ´»è·ƒè¯»å†™äº‹åŠ¡æ•°ç»„ï¼Œå…¶ä¸»è¦ç”¨æ¥åˆ¤æ–­äº‹åŠ¡çš„å¯è§æ€§ã€‚</p>
</blockquote>
<p>ä¸‹é¢ä¸¤ç¯‡æ–‡ç« å¯¹MySQLçš„InnoDBçš„MVCCå®ç°è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼š</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000012650596">MySQL-InnoDB-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</a></li>
<li><a href="http://mysql.taobao.org/monthly/2017/12/01/">[é˜¿é‡Œæ•°æ®åº“å†…æ ¸â€™2017&#x2F;12â€™æœˆæŠ¥]</a></li>
</ul>
<h1 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°å¹»è¯»ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°å¹»è¯»ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°å¹»è¯»ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°å¹»è¯»ï¼Ÿ</h1><p>åœ¨äº†è§£äº†MVCCçš„åŸç†ä¹‹åæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æºç </p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">UNIV_INTERN
dberr_t
row_search_for_mysql(
&#x2F;*&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;*&#x2F;
  byte*   buf,    &#x2F;* ç”¨æ¥å­˜æ”¾è®°å½•çš„ç©ºé—´åœ°å€ *&#x2F;
  ulint   mode,   &#x2F;* InnoDBé¡µæ‰«æé¡ºåº *&#x2F;
  row_prebuilt_t* prebuilt, &#x2F;* InnoDBæ‰«æéœ€è¦çš„æ‰€æœ‰ä¿¡æ¯éƒ½åŒ…å«åœ¨è¿™ä¸ªç»“æ„ä½“ï¼Œæ¯”å¦‚è¡¨ä»¥åŠIndexç­‰ä¿¡æ¯ *&#x2F;
  ulint   match_mode, &#x2F;* å¯¹äºIndexçš„åŒ¹é…æ¨¡å¼ï¼Œæ˜¯ç²¾ç¡®åŒ¹é…è¿˜æ˜¯å‰ç¼€ç´¢å¼•åŒ¹é… *&#x2F;
  ulint   direction)  &#x2F;* æŒ‡å®šæ‰«æé¡ºåºï¼Œæ­£åºè¿˜æ˜¯å€’å™æ‰«æ *&#x2F;
&#123;
	...
	&#x2F;* ä»è¿™é‡Œæˆ‘ä»¬çœ‹å‡ºå¼€å§‹ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶éæ˜¯ä»æ‰§è¡ŒBEGINè¯­å¥ä½ç½®å¼€å§‹ï¼Œè€Œæ˜¯ä»å…¶åå¼€å§‹æ‰§è¡Œçš„ç¬¬ä¸€æ¡è¯­å¥å¼€å§‹åˆ†é…äº‹åŠ¡ID *&#x2F;
	trx_start_if_not_started(trx, ((trx-&gt;mysql_thd
          &amp;&amp; thd_is_select(trx-&gt;mysql_thd)
          ) || srv_read_only_mode) ? FALSE : TRUE); 

	...
	&#x2F;&#x2F; å¦‚æœæ˜¯SQLè¯­å¥ç¬¬ä¸€æ¬¡å¼€å§‹æ‰§è¡Œï¼Œéœ€è¦è€ƒè™‘å¯¹TABLEå¢åŠ æ„å‘æ‰€

	 if (!prebuilt-&gt;sql_stat_start) &#123;
	 &#x2F;&#x2F; è¿™é‡Œæ ‡è®°SQLè¯­å¥å·²ç»å¼€å§‹æ‰§è¡Œï¼Œå¤„ç†ä¸€æ¡SQLè¯­å¥å¾ªç¯æ‰«æè®°å½•çš„è¿‡ç¨‹
    &#x2F;* No need to set an intention lock or assign a read view *&#x2F;

    if (UNIV_UNLIKELY
        (trx-&gt;read_view &#x3D;&#x3D; NULL 
         &amp;&amp; prebuilt-&gt;select_lock_type &#x3D;&#x3D; LOCK_NONE)) &#123;
      ...
	    &#125;
  &#125; else if (prebuilt-&gt;select_lock_type &#x3D;&#x3D; LOCK_NONE) &#123;
	...
  &#125; else &#123;
	&#x2F;&#x2F; è¿™é‡Œå¼€å§‹éINSERTçš„DMLæ“ä½œï¼Œå› ä¸ºDMLä¼šå¯¹è®°å½•å¢åŠ è®°å½•æ’ä»–é”ã€‚å…·ä½“éœ€è¦å¢åŠ ä»€ä¹ˆç±»å‹çš„é”ï¼Œå¯ä»¥å‚è€ƒhttps:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;innodb-locking.html
 wait_table_again:
	&#x2F;&#x2F; è¿™é‡Œè¦å¯¹TABLEåŠ æ„å‘é”
    err &#x3D; lock_table(0, index-&gt;table,
         prebuilt-&gt;select_lock_type &#x3D;&#x3D; LOCK_S
         ? LOCK_IS : LOCK_IX, thr);

    if (err !&#x3D; DB_SUCCESS) &#123;

      table_lock_waited &#x3D; TRUE;
      goto lock_table_wait;
    &#125;    
    prebuilt-&gt;sql_stat_start &#x3D; FALSE;
  &#125;

	...
  if (prebuilt-&gt;select_lock_type !&#x3D; LOCK_NONE) &#123;
	 ulint lock_type;

    if (!set_also_gap_locks
        || srv_locks_unsafe_for_binlog
        || trx-&gt;isolation_level &lt;&#x3D; TRX_ISO_READ_COMMITTED
        || (unique_search &amp;&amp; !rec_get_deleted_flag(rec, comp))) &#123;
	  &#x2F;&#x2F; è¿™é‡Œå¯¹äºREAD_UNCOMMITTEDä»¥åŠREAD_COMMITTED,æˆ–è€…å”¯ä¸€é”®æ‰«æä¸éœ€è¦ä½¿ç”¨gapé”
      goto no_gap_lock;
    &#125; else &#123;
      lock_type &#x3D; LOCK_ORDINARY;
    &#125;
	
	&#x2F;* If we are doing a &#39;greater or equal than a primary key
    value&#39; search from a clustered index, and we find a record
    that has that exact primary key value, then there is no need
    to lock the gap before the record, because no insert in the
    gap can be in our search range. That is, no phantom row can
    appear that way.

    An example: if col1 is the primary key, the search is WHERE
    col1 &gt;&#x3D; 100, and we find a record where col1 &#x3D; 100, then no
    need to lock the gap before that record. *&#x2F;

    if (index &#x3D;&#x3D; clust_index
        &amp;&amp; mode &#x3D;&#x3D; PAGE_CUR_GE
        &amp;&amp; direction &#x3D;&#x3D; 0
        &amp;&amp; dtuple_get_n_fields_cmp(search_tuple)
        &#x3D;&#x3D; dict_index_get_n_unique(index)
        &amp;&amp; 0 &#x3D;&#x3D; cmp_dtuple_rec(search_tuple, rec, offsets)) &#123;
no_gap_lock:
      lock_type &#x3D; LOCK_REC_NOT_GAP;
    &#125;

	    err &#x3D; sel_set_rec_lock(btr_pcur_get_block(pcur),
               rec, index, offsets,
               prebuilt-&gt;select_lock_type,
               lock_type, thr);

    switch (err) &#123;
      const rec_t*  old_vers;
    case DB_SUCCESS_LOCKED_REC:
      if (srv_locks_unsafe_for_binlog
          || trx-&gt;isolation_level
          &lt;&#x3D; TRX_ISO_READ_COMMITTED) &#123;
        &#x2F;* Note that a record of
        prebuilt-&gt;index was locked. *&#x2F;
        prebuilt-&gt;new_rec_locks &#x3D; 1;
      &#125;
      err &#x3D; DB_SUCCESS;
    case DB_SUCCESS:
	 &#x2F;&#x2F; åŠ é”æˆåŠŸåå°±è®¤ä¸ºè®°å½•å¯è§äº†ï¼Œå¹¶æœªåƒSELECTè¯­å¥ä¸€æ ·æ ¹æ®äº‹åŠ¡å¼€å§‹çš„READ_VIEWè¿›è¡Œå¯è§æ€§åˆ¤æ–­ã€‚æ‰€ä»¥å¯¹äºDMLæ¥è¯´ï¼Œæ‰€æœ‰æäº¤çš„äº‹åŠ¡éƒ½æ˜¯å¯è§çš„ã€‚
      break;
    case DB_LOCK_WAIT:
	      &#x2F;* Never unlock rows that were part of a conflict. *&#x2F;
	  &#x2F;&#x2F; å¦‚æœå­˜åœ¨é”å†²çªï¼Œä¹Ÿå°±æ˜¯å…¶ä»–äº‹åŠ¡æ­£åœ¨æ›´æ–°åŒä¸€è¡Œ
      prebuilt-&gt;new_rec_locks &#x3D; 0;

      if (UNIV_LIKELY(prebuilt-&gt;row_read_type
          !&#x3D; ROW_READ_TRY_SEMI_CONSISTENT)
          || unique_search
          || index !&#x3D; clust_index) &#123;

        goto lock_wait_or_error;
      &#125;

      &#x2F;* The following call returns &#39;offsets&#39;
      associated with &#39;old_vers&#39; *&#x2F;
	  &#x2F;&#x2F; è¿™é‡Œéœ€è¦æŸ¥çœ‹æ˜¯å¦æœ‰åˆ«çš„äº‹åŠ¡æäº¤äº†ï¼Œä»¥ä¾¿è·å–æœ€æ–°ç‰ˆæœ¬çš„è®°å½•
      row_sel_build_committed_vers_for_mysql(
        clust_index, prebuilt, rec,
        &amp;offsets, &amp;heap, &amp;old_vers, &amp;mtr);

      &#x2F;* Check whether it was a deadlock or not, if not
      a deadlock and the transaction had to wait then
      release the lock it is waiting on. *&#x2F;
	        err &#x3D; lock_trx_handle_wait(trx);

      switch (err) &#123;
      case DB_SUCCESS:
        &#x2F;* The lock was granted while we were
        searching for the last committed version.
        Do a normal locking read. *&#x2F;

        offsets &#x3D; rec_get_offsets(
          rec, index, offsets, ULINT_UNDEFINED,
          &amp;heap);
        goto locks_ok;
      case DB_DEADLOCK:
        goto lock_wait_or_error;
      case DB_LOCK_WAIT:
        err &#x3D; DB_SUCCESS;
        break;
      default:
        ut_error;
      &#125;
	        if (old_vers &#x3D;&#x3D; NULL) &#123;
        &#x2F;* The row was not yet committed *&#x2F;

        goto next_rec;
      &#125;
	  did_semi_consistent_read &#x3D; TRUE;
      rec &#x3D; old_vers;
      break;
    default:

      goto lock_wait_or_error;
    &#125;

	&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºUPDATEæ“ä½œæ›´æ–°çš„è®°å½•åŒ…å«å¹»è¯»è¯»å–åˆ°çš„å·²æäº¤äº‹åŠ¡çš„æœ€æ–°è®°å½•ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸ºä»€ä¹ˆUPDATEä¹‹åçš„SELECTè¯­å¥å¯¹äºUPDATEä¹‹åçš„æ‰€æœ‰è¯­å¥éƒ½å¯è§äº†ï¼Ÿ åŸå› æ˜¯å‰é¢çš„UPDATEè¯­å¥æ‰§è¡Œä¹‹åï¼Œä¼šå°†å½“å‰è®°å½•ä¸Šå­˜å‚¨çš„äº‹åŠ¡ä¿¡æ¯æ›´æ–°ä¸ºå½“å‰çš„äº‹åŠ¡ï¼Œè€Œå½“å‰äº‹åŠ¡æ‰€åšçš„ä»»ä½•æ›´æ–°ï¼Œå¯¹æœ¬äº‹åŠ¡æ‰€æœ‰SELECTæŸ¥è¯¢éƒ½å˜çš„å¯è§ï¼Œå› æ­¤æœ€åè¾“å‡ºçš„ç»“æœæ˜¯UPDATEæ‰§è¡Œåæ›´æ–°çš„æ‰€æœ‰è®°å½•ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»ä¸Šæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒMySQLçš„**REPEATABLE READ **éš”ç¦»çº§åˆ«å’ŒMVCCåªè§£å†³äº†éƒ¨åˆ†å¹»è¯»çš„é—®é¢˜ï¼Œæ„å‘³ç€è¿™ä¸€éš”ç¦»çº§åˆ«ä»æ—§å¯èƒ½å‡ºç°å¹»è¯»ã€‚è¯¥é—®é¢˜çš„å‘ç°åŒæ—¶ä¹Ÿæé†’ç€ä»¥åä¸èƒ½æ­»è¯»ä¹¦ï¼Œåº”è¯¥è¾¹è¯»è¾¹æƒ³å¤šå®è·µï¼ŒæŠŠä¹¦ä¸­çš„çŸ¥è¯†è½¬æ¢ä¸ºæˆ‘ä»¬è‡ªå·±çš„æƒ³æ³•ï¼Œè€Œä¸æ˜¯ç”Ÿæ¬ç¡¬å¥—ã€‚</p>
<blockquote>
<p><strong>å¼•ç”¨å‚è€ƒ</strong></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-multi-versioning.html">MySQLå®˜ç½‘</a></p>
<p><a href="http://mysql.taobao.org/monthly/2017/06/07/">MySQL Â· æºç åˆ†æ Â· InnoDB Repeatable Readéš”ç¦»çº§åˆ«ä¹‹å¤§ä¸åŒ</a></p>
<p><a href="http://mysql.taobao.org/monthly/2017/12/01/">[é˜¿é‡Œæ•°æ®åº“å†…æ ¸â€™2017&#x2F;12â€™æœˆæŠ¥]</a></p>
<p><a href="http://mysql.taobao.org/monthly/2017/06">[æ•°æ®åº“å†…æ ¸æœˆæŠ¥ 2017 &#x2F; 06]</a></p>
</blockquote>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mysql mvcc</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç´¢å¼•åˆå¹¶ä¼˜åŒ–</title>
    <url>/2022/01/07/mysql/mysql-suo-yin-he-bing-you-hua/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>ä¹‹å‰é‡åˆ°è¿‡ä¸€ä¸ªå…³äºMySQLç´¢å¼•çš„é¢è¯•é¢˜ï¼Œé—®é¢˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ä¸€å¼ æ•°æ®åº“è¡¨tå…¶ä¸­æœ‰3åˆ—ä¸ºaã€bã€cï¼Œåˆ†åˆ«ä¸ºæ¯ä¸€ä¸ªåˆ—å•ç‹¬å»ºç«‹ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼Œé‚£ä¹ˆç°åœ¨æœ‰ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶<code>select * from t where a=? and b=? and c=?</code><br>è¯·é—®ä¸Šè¿°SQLè¯­å¥ï¼ŒMySQLå­˜å‚¨å¼•æ“åœ¨æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå“ªäº›ç´¢å¼•å°†ä¼šè¢«ä½¿ç”¨åˆ°ï¼Ÿ</p>
</blockquote>
<p>å½“æ—¶ä¸€é¡¿åˆ†æï¼Œè¿˜è°ˆåˆ°äº†MySQLåŸºäºæˆæœ¬ä¼°ç®—çš„ä¼˜åŒ–ï¼Œè®¤ä¸ºMySQLä¼˜åŒ–å™¨å…ˆåŸºäºaã€bã€cä¸‰ä¸ªåˆ—çš„ç´¢å¼•åŒºåˆ†åº¦ï¼Œé€‰æ‹©ç´¢å¼•åŒºåˆ†åº¦è¾ƒé«˜çš„ç´¢å¼•è¿›è¡Œæ‰«æï¼Œæ ¹æ®ç¬¬ä¸€ä¸ªç´¢å¼•çš„æ‰«æç»“æœï¼Œå¦‚æœç¬¬ä¸€ä¸ªç´¢å¼•çš„æ‰«æç»“æœé›†é«˜äºä¸€ä¸ªå›ºå®šé‡çº§ï¼Œåˆ™ç»§ç»­é€‰æ‹©ç¬¬äºŒä¸ªç´¢å¼•è¿›è¡Œæ‰«æï¼Œä¾æ¬¡åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨ç¬¬ä¸‰ä¸ªç´¢å¼•ï¼Œå¦‚æœç¬¬ä¸€ä¸ªç´¢å¼•çš„æ‰«æç»“æœé›†å°äºä¸€ä¸ªå›ºå®šé‡çº§ï¼Œåˆ™ç›´æ¥æ ¹æ®ç¬¬ä¸€ä¸ªç´¢å¼•çš„æ‰«æç»“æœé›†è¿›è¡Œå›è¡¨æŸ¥è¯¢åˆ°åˆ—è®°å½•ï¼Œå†æ ¹æ®æœªä½¿ç”¨åˆ°çš„2åˆ—è¿›è¡Œè¿‡æ»¤ã€‚</p>
<p>æœ€åå¾—å‡ºçš„ç»“æœæ˜¯ï¼šaã€bã€c 3ä¸ªç´¢å¼•éƒ½å¯èƒ½è¢«ä½¿ç”¨åˆ°ï¼Œå…·ä½“ä½¿ç”¨åˆ°å“ªäº›ç´¢å¼•ï¼Œå–å†³äº3ä¸ªç´¢å¼•çš„åŒºåˆ†åº¦ä»¥åŠè¡¨çš„æ•°æ®é‡ã€‚</p>
<h2 id="æ­£ç¡®ç­”æ¡ˆ"><a href="#æ­£ç¡®ç­”æ¡ˆ" class="headerlink" title="æ­£ç¡®ç­”æ¡ˆ"></a>æ­£ç¡®ç­”æ¡ˆ</h2><p>ä¸Šé¢çš„é—®é¢˜åº”è¯¥ç”¨<code>ç´¢å¼•åˆå¹¶ä¼˜åŒ–</code>çš„åŸç†æ¥åˆ†æï¼Œä¸Šè¿°çš„SQLçš„whereæ¡ä»¶æ»¡è¶³äº†ç´¢å¼•åˆå¹¶ä¼˜åŒ–ä¸­çš„<code>Index Merge Intersection Access Algorithm</code>,<br>å­˜å‚¨å¼•æ“å°†ä¼šåŒæ—¶ä½¿ç”¨3ä¸ªç´¢å¼•è¿›è¡Œæ‰«æï¼Œå°†æ‰«æåˆ°çš„ç»“æœé›†å–äº¤é›†åè¿”å›ç»™MySQL Serverï¼Œç„¶åå†è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p>
<h1 id="äºŒã€ç´¢å¼•åˆå¹¶ä¼˜åŒ–"><a href="#äºŒã€ç´¢å¼•åˆå¹¶ä¼˜åŒ–" class="headerlink" title="äºŒã€ç´¢å¼•åˆå¹¶ä¼˜åŒ–"></a>äºŒã€ç´¢å¼•åˆå¹¶ä¼˜åŒ–</h1><p>ç´¢å¼•åˆå¹¶è®¿é—®æ–¹æ³•æ£€ç´¢å…·æœ‰å¤šä¸ªèŒƒå›´æ‰«æçš„è¡Œå¹¶å°†å…¶ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªã€‚ æ­¤è®¿é—®æ–¹æ³•ä»…åˆå¹¶æ¥è‡ªå•ä¸ªè¡¨çš„ç´¢å¼•æ‰«æï¼Œè€Œä¸æ˜¯è·¨å¤šä¸ªè¡¨çš„æ‰«æã€‚ åˆå¹¶å¯ä»¥ç”Ÿæˆå…¶åº•å±‚æ‰«æçš„å¹¶é›†ã€äº¤é›†æˆ–äº¤é›†å¹¶é›†ã€‚</p>
<h2 id="ç´¢å¼•åˆå¹¶çš„æŸ¥è¯¢æ¡ˆä¾‹"><a href="#ç´¢å¼•åˆå¹¶çš„æŸ¥è¯¢æ¡ˆä¾‹" class="headerlink" title="ç´¢å¼•åˆå¹¶çš„æŸ¥è¯¢æ¡ˆä¾‹"></a>ç´¢å¼•åˆå¹¶çš„æŸ¥è¯¢æ¡ˆä¾‹</h2><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM tbl_name WHERE key1 &#x3D; 10 OR key2 &#x3D; 20;

SELECT * FROM tbl_name
  WHERE (key1 &#x3D; 10 OR key2 &#x3D; 20) AND non_key &#x3D; 30;

SELECT * FROM t1, t2
  WHERE (t1.key1 IN (1,2) OR t1.key2 LIKE &#39;value%&#39;)
  AND t2.key1 &#x3D; t1.some_col;

SELECT * FROM t1, t2
  WHERE t1.key1 &#x3D; 1
  AND (t2.key1 &#x3D; t1.some_col OR t2.key2 &#x3D; t1.some_col2);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<h3 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h3><p>ç´¢å¼•åˆå¹¶ä¼˜åŒ–å…·æœ‰ä»¥ä¸‹å·²çŸ¥é™åˆ¶ï¼š</p>
<ul>
<li>å¦‚æœæ‚¨çš„æŸ¥è¯¢æœ‰ä¸€ä¸ªå¸¦æœ‰æ·±åº¦ AND&#x2F;OR åµŒå¥—çš„å¤æ‚ WHERE å­å¥ï¼Œå¹¶ä¸” MySQL æ²¡æœ‰é€‰æ‹©æœ€ä½³è®¡åˆ’ï¼Œè¯·å°è¯•ä½¿ç”¨ä»¥ä¸‹èº«ä»½è½¬æ¢åˆ†é…æœ¯è¯­ï¼š</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">(x AND y) OR z &#x3D;&gt; (x OR z) AND (y OR z)
(x OR y) AND z &#x3D;&gt; (x AND z) OR (y AND z)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>ç´¢å¼•åˆå¹¶ä¸é€‚ç”¨äºå…¨æ–‡ç´¢å¼•</li>
</ul>
</blockquote>
<p>åœ¨ <code>EXPLAIN</code> è¾“å‡ºä¸­ï¼ŒIndex Merge æ–¹æ³•åœ¨ <code>type</code> åˆ—ä¸­æ˜¾ç¤ºä¸º <code>index_merge</code>ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé”®åˆ—åŒ…å«ä½¿ç”¨çš„ç´¢å¼•åˆ—è¡¨ï¼Œè€Œ <code>key_len</code> åŒ…å«è¿™äº›ç´¢å¼•çš„æœ€é•¿é”®éƒ¨åˆ†çš„åˆ—è¡¨ã€‚</p>
<p>Index Merge è®¿é—®æ–¹æ³•æœ‰å‡ ç§ç®—æ³•ï¼Œæ˜¾ç¤ºåœ¨ EXPLAIN è¾“å‡ºçš„ Extra å­—æ®µä¸­ï¼š</p>
<ul>
<li><p>Using intersect(â€¦)</p>
</li>
<li><p>Using union(â€¦)</p>
</li>
<li><p>Using sort_union(â€¦)</p>
</li>
</ul>
<p>ä»¥ä¸‹éƒ¨åˆ†æ›´è¯¦ç»†åœ°æè¿°äº†è¿™äº›ç®—æ³•ã€‚ ä¼˜åŒ–å™¨æ ¹æ®å„ç§å¯ç”¨é€‰é¡¹çš„æˆæœ¬ä¼°è®¡åœ¨ä¸åŒå¯èƒ½çš„ç´¢å¼•åˆå¹¶ç®—æ³•å’Œå…¶ä»–è®¿é—®æ–¹æ³•ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚</p>
<p>ç´¢å¼•åˆå¹¶çš„ä½¿ç”¨å–å†³äºMySQLä¼˜åŒ–å™¨å¼€å…³,åˆ†åˆ«æ˜¯ç³»ç»Ÿå˜é‡ index_mergeã€index_merge_intersectionã€index_merge_union å’Œ index_merge_sort_union æ ‡å¿—çš„å€¼ã€‚<br>è¯·å‚è§ç¬¬ 8.9.2 èŠ‚ï¼Œâ€œå¯åˆ‡æ¢çš„ä¼˜åŒ–â€ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¿™äº›æ ‡å¿—éƒ½æ‰“å¼€ã€‚<br>è¦ä»…å¯ç”¨æŸäº›ç®—æ³•ï¼Œè¯·å°† index_merge è®¾ç½®ä¸ºå…³é—­ï¼Œå¹¶ä»…å¯ç”¨åº”å…è®¸çš„å…¶ä»–ç®—æ³•ã€‚</p>
<ul>
<li><p>Index Merge Intersection Access Algorithm</p>
</li>
<li><p>Index Merge Union Access Algorithm</p>
</li>
<li><p>Index Merge Sort-Union Access Algorithm</p>
</li>
</ul>
<h2 id="Index-Merge-Intersection-Access-Algorithmï¼ˆç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•ï¼‰"><a href="#Index-Merge-Intersection-Access-Algorithmï¼ˆç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•ï¼‰" class="headerlink" title="Index Merge Intersection Access Algorithmï¼ˆç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•ï¼‰"></a>Index Merge Intersection Access Algorithmï¼ˆç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•ï¼‰</h2><p>æ­¤è®¿é—®ç®—æ³•é€‚ç”¨äºå°† WHERE å­å¥è½¬æ¢ä¸ºä¸ AND ç»“åˆçš„ä¸åŒé”®ä¸Šçš„å¤šä¸ªèŒƒå›´æ¡ä»¶çš„æƒ…å†µï¼Œå¹¶ä¸”æ¯ä¸ªæ¡ä»¶éƒ½æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p>
<ul>
<li>è¿™ç§å½¢å¼çš„ N éƒ¨åˆ†è¡¨è¾¾å¼ï¼Œå…¶ä¸­ç´¢å¼•æ­£å¥½æœ‰ N éƒ¨åˆ†ï¼ˆå³ï¼Œç»„åˆç´¢å¼•æ‰€æœ‰ç´¢å¼•éƒ¨åˆ†éƒ½è¢«è¦†ç›–ï¼‰ï¼š</li>
</ul>
 <pre class="line-numbers language-none"><code class="language-none">-- äºŒçº§ç´¢å¼•å¿…é¡»æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œåˆ™ç»„åˆç´¢å¼•çš„æ¯ä¸€åˆ—éƒ½å¿…é¡»è¦†ç›–åˆ°
key_part1 &#x3D; const1 AND key_part2 &#x3D; const2 ... AND key_partN &#x3D; constN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>InnoDB è¡¨çš„ä¸»é”®ä¸Šçš„ä»»ä½•èŒƒå›´æ¡ä»¶ã€‚</li>
</ul>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM innodb_table
  WHERE primary_key &lt; 10 AND key_col1 &#x3D; 20;

SELECT * FROM tbl_name
  WHERE key1_part1 &#x3D; 1 AND key1_part2 &#x3D; 2 AND key2 &#x3D; 2;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç´¢å¼•åˆå¹¶äº¤é›†ç®—æ³•å¯¹æ‰€æœ‰ä½¿ç”¨çš„ç´¢å¼•æ‰§è¡ŒåŒæ—¶æ‰«æï¼Œå¹¶ç”Ÿæˆå®ƒä»åˆå¹¶ç´¢å¼•æ‰«ææ¥æ”¶çš„è¡Œåºåˆ—çš„äº¤é›†ã€‚</p>
<ul>
<li>å¦‚æœæŸ¥è¯¢ä¸­ä½¿ç”¨çš„æ‰€æœ‰åˆ—éƒ½è¢«ä½¿ç”¨çš„ç´¢å¼•è¦†ç›–ï¼Œåˆ™ä¸ä¼šæ£€ç´¢å®Œæ•´çš„è¡¨è¡Œï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒEXPLAIN è¾“å‡ºåŒ…å«åœ¨ Extra å­—æ®µä¸­ä½¿ç”¨ç´¢å¼•ï¼‰ã€‚ä»¥ä¸‹æ˜¯æ­¤ç±»æŸ¥è¯¢çš„ç¤ºä¾‹ï¼š</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">SELECT COUNT(*) FROM t1 WHERE key1 &#x3D; 1 AND key2 &#x3D; 1;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>å¦‚æœä½¿ç”¨çš„ç´¢å¼•æœªè¦†ç›–æŸ¥è¯¢ä¸­ä½¿ç”¨çš„æ‰€æœ‰åˆ—ï¼Œåˆ™ä»…å½“æ»¡è¶³æ‰€æœ‰ä½¿ç”¨çš„é”®çš„èŒƒå›´æ¡ä»¶æ—¶æ‰æ£€ç´¢å®Œæ•´çš„è¡Œã€‚</li>
<li>å¦‚æœå…¶ä¸­ä¸€ä¸ªåˆå¹¶æ¡ä»¶æ˜¯å¯¹ InnoDB è¡¨çš„ä¸»é”®çš„æ¡ä»¶ï¼Œåˆ™å®ƒä¸ç”¨äºè¡Œæ£€ç´¢ï¼Œè€Œæ˜¯ç”¨äºè¿‡æ»¤æ‰ä½¿ç”¨å…¶ä»–æ¡ä»¶æ£€ç´¢åˆ°çš„è¡Œã€‚</li>
</ul>
<h2 id="Index-Merge-Union-Access-Algorithm-ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•ï¼‰"><a href="#Index-Merge-Union-Access-Algorithm-ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•ï¼‰" class="headerlink" title="Index Merge Union Access Algorithm(ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•ï¼‰"></a>Index Merge Union Access Algorithm(ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•ï¼‰</h2><p>æ­¤ç®—æ³•çš„æ ‡å‡†ç±»ä¼¼äºç´¢å¼•åˆå¹¶äº¤é›†ç®—æ³•çš„æ ‡å‡†ã€‚ è¯¥ç®—æ³•é€‚ç”¨äºå°†è¡¨çš„ WHERE å­å¥è½¬æ¢ä¸ºä¸åŒé”®ä¸Šçš„å¤šä¸ªèŒƒå›´æ¡ä»¶å¹¶ç»“åˆ OR çš„æƒ…å†µï¼Œå¹¶ä¸”æ¯ä¸ªæ¡ä»¶éƒ½æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p>
<ul>
<li>è¿™ç§å½¢å¼çš„ N éƒ¨åˆ†è¡¨è¾¾å¼ï¼Œå…¶ä¸­ç´¢å¼•æ­£å¥½æœ‰ N éƒ¨åˆ†ï¼ˆå³ï¼Œç»„åˆç´¢å¼•æ‰€æœ‰ç´¢å¼•éƒ¨åˆ†éƒ½è¢«è¦†ç›–ï¼‰ï¼š</li>
</ul>
 <pre class="line-numbers language-none"><code class="language-none">key_part1 &#x3D; const1 AND key_part2 &#x3D; const2 ... AND key_partN &#x3D; constN<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>InnoDB è¡¨çš„ä¸»é”®ä¸Šçš„ä»»ä½•èŒƒå›´æ¡ä»¶ã€‚</li>
<li>ç´¢å¼•åˆå¹¶äº¤é›†ç®—æ³•é€‚ç”¨çš„æ¡ä»¶ã€‚</li>
</ul>
<h3 id="Examples-1"><a href="#Examples-1" class="headerlink" title="Examples"></a>Examples</h3><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM t1
  WHERE key1 &#x3D; 1 OR key2 &#x3D; 2 OR key3 &#x3D; 3;

SELECT * FROM innodb_table
  WHERE (key1 &#x3D; 1 AND key2 &#x3D; 2)
     OR (key3 &#x3D; &#39;foo&#39; AND key4 &#x3D; &#39;bar&#39;) AND key5 &#x3D; 5;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Index-Merge-Sort-Union-Access-Algorithm-ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•"><a href="#Index-Merge-Sort-Union-Access-Algorithm-ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•" class="headerlink" title="Index Merge Sort-Union Access Algorithm(ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•)"></a>Index Merge Sort-Union Access Algorithm(ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•)</h2><p>è¯¥è®¿é—®ç®—æ³•é€‚ç”¨äºWHEREå­å¥è½¬æ¢ä¸ºå¤šä¸ªORç»„åˆçš„èŒƒå›´æ¡ä»¶ï¼Œä½†ä¸é€‚ç”¨Index Merge unionç®—æ³•ã€‚</p>
<h3 id="Examples-2"><a href="#Examples-2" class="headerlink" title="Examples"></a>Examples</h3><pre class="line-numbers language-none"><code class="language-none">SELECT * FROM tbl_name
  WHERE key_col1 &lt; 10 OR key_col2 &lt; 20;

SELECT * FROM tbl_name
  WHERE (key_col1 &gt; 10 OR key_col2 &#x3D; 20) AND nonkey_col &#x3D; 30;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ’åºå¹¶é›†ç®—æ³•å’Œå¹¶é›†ç®—æ³•ä¹‹é—´çš„åŒºåˆ«åœ¨äºæ’åºå¹¶é›†ç®—æ³•å¿…é¡»é¦–å…ˆè·å–æ‰€æœ‰è¡Œçš„è¡Œ ID å¹¶åœ¨è¿”å›ä»»ä½•è¡Œä¹‹å‰å¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚</p>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><h2 id="ç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•"><a href="#ç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•" class="headerlink" title="ç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•"></a>ç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•</h2><p><code>WHERE</code>æ¡ä»¶ä¹‹é—´ä½¿ç”¨<code>AND</code>ç»“åˆï¼Œè€Œä¸”æ¯ä¸ªæ¡ä»¶å¿…é¡»æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>äºŒçº§ç´¢å¼•å¿…é¡»æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œç»„åˆç´¢å¼•çš„æ¯ä¸€åˆ—éƒ½å¿…é¡»è¦†ç›–åˆ°</li>
<li>InnoDBè¡¨çš„ä¸»é”®èŒƒå›´æ¡ä»¶æŸ¥è¯¢</li>
</ul>
<h2 id="ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•"><a href="#ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•" class="headerlink" title="ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•"></a>ç´¢å¼•åˆå¹¶å¹¶é›†è®¿é—®ç®—æ³•</h2><p>ä¸<code>ç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•</code>ç±»ä¼¼ï¼Œä¸è¿‡ä½¿ç”¨äº†<code>OR</code>è¿æ¥æ¡ä»¶ï¼Œä¸”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>äºŒçº§ç´¢å¼•å¿…é¡»æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œç»„åˆç´¢å¼•çš„æ¯ä¸€åˆ—éƒ½å¿…é¡»è¦†ç›–åˆ°</li>
<li>InnoDBè¡¨çš„ä¸»é”®èŒƒå›´æ¡ä»¶æŸ¥è¯¢</li>
<li>ç¬¦åˆ<code>ç´¢å¼•åˆå¹¶äº¤é›†è®¿é—®ç®—æ³•</code>çš„æ¡ä»¶</li>
</ul>
<h2 id="ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•"><a href="#ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•" class="headerlink" title="ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•"></a>ç´¢å¼•åˆå¹¶æ’åºå¹¶é›†è®¿é—®ç®—æ³•</h2><p>äºŒçº§ç´¢å¼•ä¸å¿…ç­‰å€¼æŸ¥è¯¢ï¼Œè”åˆç´¢å¼•ä¹Ÿä¸å¿…åŒ¹é…æ‰€æœ‰çš„ç´¢å¼•é¡¹</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://dev.mysql.com/doc/refman/5.7/en/index-merge-optimization.html">8.2.1.3 Index Merge Optimization</a></p>
<p><a href="https://gentlezuo.github.io/2019/09/11/MySQL%EF%BC%9A%E7%B4%A2%E5%BC%95%E5%90%88%E5%B9%B6/#%E7%B4%A2%E5%BC%95%E5%90%88%E5%B9%B6">MySQLï¼šç´¢å¼•åˆå¹¶</a></p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>ç´¢å¼•åˆå¹¶</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæ’å…¥é€Ÿåº¦æµ‹è¯•</title>
    <url>/2019/07/02/mysql/mysql-cha-ru-su-du-ce-shi/</url>
    <content><![CDATA[<h2 id="ä¸€ã€æµ‹è¯•ç¯å¢ƒ"><a href="#ä¸€ã€æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="ä¸€ã€æµ‹è¯•ç¯å¢ƒ"></a>ä¸€ã€æµ‹è¯•ç¯å¢ƒ</h2><h3 id="1-1-ç¡¬ä»¶ç¯å¢ƒ"><a href="#1-1-ç¡¬ä»¶ç¯å¢ƒ" class="headerlink" title="1.1 ç¡¬ä»¶ç¯å¢ƒ"></a>1.1 ç¡¬ä»¶ç¯å¢ƒ</h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>é…ç½®</th>
</tr>
</thead>
<tbody><tr>
<td>æ“ä½œç³»ç»Ÿ</td>
<td>win7 64ä½</td>
</tr>
<tr>
<td>CPU</td>
<td>4æ ¸4çº¿ç¨‹ i5-4590</td>
</tr>
<tr>
<td>å†…å­˜</td>
<td>16G</td>
</tr>
<tr>
<td>ç¡¬ç›˜</td>
<td>128G SSD</td>
</tr>
<tr>
<td>MySQL</td>
<td>Version 5.6</td>
</tr>
</tbody></table>
<h3 id="1-2-æ•°æ®åº“è¡¨ç»“æ„"><a href="#1-2-æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="1.2 æ•°æ®åº“è¡¨ç»“æ„"></a>1.2 æ•°æ®åº“è¡¨ç»“æ„</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>phone<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="äºŒã€æ’å…¥å®éªŒ"><a href="#äºŒã€æ’å…¥å®éªŒ" class="headerlink" title="äºŒã€æ’å…¥å®éªŒ"></a>äºŒã€æ’å…¥å®éªŒ</h2><h3 id="2-1-æ™®é€šæ’å…¥"><a href="#2-1-æ™®é€šæ’å…¥" class="headerlink" title="2.1 æ™®é€šæ’å…¥"></a>2.1 æ™®é€šæ’å…¥</h3><table>
<thead>
<tr>
<th>çº¿ç¨‹æ•°</th>
<th>æ’å…¥é‡ï¼ˆä¸‡ï¼‰</th>
<th>æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰</th>
<th>å¹³å‡æ’å…¥é€Ÿåº¦ï¼ˆæ¡&#x2F;ç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>100</td>
<td>342844</td>
<td>2923</td>
</tr>
<tr>
<td>4</td>
<td>400</td>
<td>480112</td>
<td>8333</td>
</tr>
<tr>
<td>8</td>
<td>800</td>
<td>693702</td>
<td>11544</td>
</tr>
<tr>
<td>16</td>
<td>1600</td>
<td>1246522</td>
<td>12841</td>
</tr>
</tbody></table>
<h3 id="2-2-æ‰¹é‡æ’å…¥"><a href="#2-2-æ‰¹é‡æ’å…¥" class="headerlink" title="2.2 æ‰¹é‡æ’å…¥"></a>2.2 æ‰¹é‡æ’å…¥</h3><blockquote>
<p>æ‰¹æ¬¡å¤§å°ï¼š 500æ¡</p>
</blockquote>
<table>
<thead>
<tr>
<th>çº¿ç¨‹æ•°</th>
<th>æ’å…¥é‡ï¼ˆä¸‡ï¼‰</th>
<th>æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰</th>
<th>å¹³å‡æ’å…¥é€Ÿåº¦ï¼ˆæ¡&#x2F;ç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>100</td>
<td>42793</td>
<td>23364</td>
</tr>
<tr>
<td>4</td>
<td>400</td>
<td>58856</td>
<td>68027</td>
</tr>
<tr>
<td>8</td>
<td>800</td>
<td>109688</td>
<td>72939</td>
</tr>
<tr>
<td>16</td>
<td>1600</td>
<td>216542</td>
<td>73903</td>
</tr>
</tbody></table>
<blockquote>
<p>æ‰¹æ¬¡å¤§å°ï¼š 1000æ¡</p>
</blockquote>
<table>
<thead>
<tr>
<th>çº¿ç¨‹æ•°</th>
<th>æ’å…¥é‡ï¼ˆä¸‡ï¼‰</th>
<th>æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰</th>
<th>å¹³å‡æ’å…¥é€Ÿåº¦ï¼ˆæ¡&#x2F;ç§’ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>100</td>
<td>42771</td>
<td>23380</td>
</tr>
<tr>
<td>4</td>
<td>400</td>
<td>55098</td>
<td>72595</td>
</tr>
<tr>
<td>8</td>
<td>800</td>
<td>106554</td>
<td>75082</td>
</tr>
<tr>
<td>16</td>
<td>1600</td>
<td>216353</td>
<td>73971</td>
</tr>
</tbody></table>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>æœ¬æ¬¡å®éªŒä¸»è¦æ˜¯æµ‹è¯•ä¸€ä¸‹MySQLçš„æ’å…¥é€Ÿåº¦åˆ°åº•æœ‰å¤šå¿«ï¼Œè®©æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¿ƒç†æœ‰åº•ï¼Œæµ‹è¯•æ•°æ®åº“æ–‡ä»¶æ˜¯å­˜å‚¨åˆ°å›ºæ€ç¡¬ç›˜ä¸Šçš„ï¼Œæ‰€ä»¥é€Ÿåº¦è‚¯å®šæ¯”åœ¨æ™®é€šç£ç›˜ä¸Šå¿«ã€‚æµ‹è¯•ä¸»è¦å›´ç»•å¤šçº¿ç¨‹æ’å…¥å’Œæ‰¹é‡æ’å…¥è¿™ä¸¤ä¸ªç‚¹ï¼Œä»å®éªŒç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š</p>
<ul>
<li>å¤šçº¿ç¨‹æ’å…¥ç¡®å®æ˜¯èƒ½å¤Ÿæé«˜MySQLçš„æ’å…¥é€Ÿåº¦ï¼Œä½†æ˜¯çº¿ç¨‹æ•°è¶…è¿‡ç³»ç»Ÿæ ¸å¿ƒçº¿ç¨‹æ•°åï¼Œå·²ç»æ²¡æœ‰å¤ªå¤§æå‡æ•ˆæœï¼Œæ‰€ä»¥å»ºè®®å¤šçº¿ç¨‹æ’å…¥æ—¶ï¼Œçº¿ç¨‹æ•°ä¿æŒå’Œç³»ç»Ÿæ ¸å¿ƒçº¿ç¨‹æ•°ä¸€è‡´ã€‚</li>
<li>MySQLæ‰¹é‡æ’å…¥èƒ½æå¤§æé«˜æ’å…¥é€Ÿåº¦ï¼Œæ¯æ‰¹æ¬¡1000æ¡æ’å…¥çš„é€Ÿåº¦æ˜¯å•æ¡æ’å…¥é€Ÿåº¦çš„8å€å·¦å³ï¼Œåœ¨å¤§æ•°æ®é‡æ’å…¥æ—¶å»ºè®®ä½¿ç”¨æ‰¹é‡æ’å…¥çš„æ–¹å¼ï¼Œæ‰¹æ¬¡å¤§å°å»ºè®®è®¾ç½®ä¸º1000æ¡å·¦å³ï¼Œå¯æ ¹æ®å…·ä½“çš„ä¸šåŠ¡æƒ…å†µè°ƒæ•´ã€‚MySQLæ•°æ®åŒ…é»˜è®¤å¤§å°ä¸º4Mï¼Œè¶…è¿‡è¯¥å€¼ä¼šå¯¼è‡´æ’å…¥æˆ–æ›´æ–°å¤±è´¥ï¼Œæ‰¹é‡æ’å…¥æ—¶åº”è€ƒè™‘è¯¥å› ç´ ï¼Œå¯é€šè¿‡<code>SHOW VARIABLES LIKE &#39;%max_allowed_packet%&#39;</code>æŸ¥çœ‹ï¼Œè¯¥å€¼å¯ä»¥ä¿®æ”¹ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«</title>
    <url>/2020/04/27/mysql/mysql-diao-you-an-li-fen-xiang/</url>
    <content><![CDATA[<h1 id="MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«â€”â€”æŠ€æœ¯åˆ†äº«"><a href="#MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«â€”â€”æŠ€æœ¯åˆ†äº«" class="headerlink" title="MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«â€”â€”æŠ€æœ¯åˆ†äº«"></a>MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«â€”â€”æŠ€æœ¯åˆ†äº«</h1><span id="more"></span>
<div class="pdf-container" style="width: 100%; height: 600px; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe src="./MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«.pdf" width="100%" height="100%" frameborder="0" style="border: none; border-radius: 8px;">
      <div style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 8px;">
        <p style="margin: 0; color: #666;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºPDFæ–‡ä»¶</p>
        <a href="./MySQLè°ƒä¼˜æ¡ˆä¾‹åˆ†äº«.pdf" target="_blank" style="color: #409eff; text-decoration: none; font-weight: 500;">ğŸ“¥ ç‚¹å‡»è¿™é‡Œä¸‹è½½PDFæ–‡ä»¶</a>
      </div>
    </iframe>
  </div>]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLè¡Œé”å‡çº§é‚»é”®é”çš„Bugå¼•èµ·æ­»é”é—®é¢˜æ’æŸ¥</title>
    <url>/2023/03/09/mysql/yi-ge-qi-guai-de-shu-ju-ku-si-suo-wen-ti-pai-cha/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜ç°è±¡"><a href="#ä¸€ã€é—®é¢˜ç°è±¡" class="headerlink" title="ä¸€ã€é—®é¢˜ç°è±¡"></a>ä¸€ã€é—®é¢˜ç°è±¡</h1><p>çº¿ä¸Šæ¥å£åœ¨å¹¶å‘è¯·æ±‚çš„åœºæ™¯éƒ¨åˆ†è¯·æ±‚å¤±è´¥ï¼ŒæŸ¥è¯¢çº¿ä¸Šæ—¥å¿—å‘ç°æ—¶å‡ºç°æ­»é”ï¼Œå¼‚å¸¸æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span>PersistenceException</span><span class="token operator">:</span>
### <span class="token class-name">Error</span> querying <span class="token class-name"><span class="token namespace">database<span class="token punctuation">.</span></span> Cause</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>jdbc4<span class="token punctuation">.</span></span>MySQLTransactionRollbackException</span><span class="token operator">:</span> <span class="token class-name">Deadlock</span> found when trying <span class="token keyword">to</span> <span class="token namespace">get</span> lock<span class="token punctuation">;</span> <span class="token keyword">try</span> restarting transaction
### <span class="token class-name">The</span> error may exist in com<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>/dao<span class="token operator">/</span>mapper<span class="token operator">/</span><span class="token class-name">ShortLinkMapper</span><span class="token punctuation">.</span>xml
### <span class="token class-name">The</span> error may involve defaultParameterMap
### <span class="token class-name">The</span> error occurred <span class="token keyword">while</span> setting parameters
### <span class="token constant">SQL</span><span class="token operator">:</span> select <span class="token operator">*</span> from short_link_id_map where table_name_index <span class="token operator">=</span> <span class="token operator">?</span> and year <span class="token operator">=</span> <span class="token operator">?</span> <span class="token keyword">for</span> update
### <span class="token class-name">Cause</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>jdbc4<span class="token punctuation">.</span></span>MySQLTransactionRollbackException</span><span class="token operator">:</span> <span class="token class-name">Deadlock</span> found when trying <span class="token keyword">to</span> <span class="token namespace">get</span> lock<span class="token punctuation">;</span> <span class="token keyword">try</span> restarting transaction<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ ¹æ®å¼‚å¸¸æ—¥å¿—ï¼Œæ˜¯åœ¨æ‰§è¡Œ<code>select for update</code>æ—¶äº§ç”Ÿäº†æ­»é”ï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹æ­»é”æ—¥å¿—å¹¶ç»“åˆä¸šåŠ¡é€»è¾‘åˆ†æå‡ºæ­»é”çš„åŸå› ã€‚</p>
<h1 id="äºŒã€ä¸šåŠ¡é€»è¾‘åˆ†æ"><a href="#äºŒã€ä¸šåŠ¡é€»è¾‘åˆ†æ" class="headerlink" title="äºŒã€ä¸šåŠ¡é€»è¾‘åˆ†æ"></a>äºŒã€ä¸šåŠ¡é€»è¾‘åˆ†æ</h1><p>è¯¥æ¥å£æ˜¯ä¸€ä¸ªçŸ­é“¾ç”Ÿæˆæ¥å£ï¼Œæä¾›æ‰¹é‡ç”ŸæˆçŸ­é“¾çš„èƒ½åŠ›ï¼Œä¸šåŠ¡é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ul>
<li>1.å®¢æˆ·ç«¯è°ƒç”¨IDçŸ­é“¾æ¥å£ï¼Œæ‰¹é‡ç”ŸæˆçŸ­é“¾</li>
<li>2.æ¥å£ä»ç¼“å­˜é˜Ÿåˆ—ä¸­è·å–çŸ­é“¾IDï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºåˆ™å…ˆæ‰¹é‡è·å–1000ä¸ªçŸ­é“¾IDåŠ å…¥é˜Ÿåˆ—</li>
<li>3.è·å–çŸ­é“¾IDå®Œæˆåï¼ŒåŒæ­¥æ›´æ–°çŸ­é“¾IDæ˜ å°„è¡¨</li>
</ul>
<blockquote>
<p>çŸ­é“¾IDæ˜ å°„è¡¨ï¼šçŸ­é“¾è®°å½•æŒ‰å¤©åˆ†è¡¨ï¼Œæ ¹æ®çŸ­é“¾IDæ˜ å°„è¡¨ç¡®è®¤çŸ­é“¾æ‰€åœ¨çš„åˆ†è¡¨<br><img src="/2023/03/09/mysql/yi-ge-qi-guai-de-shu-ju-ku-si-suo-wen-ti-pai-cha/%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B.png" alt="ä¸šåŠ¡é€»è¾‘"></p>
</blockquote>
<h2 id="æ•°æ®åº“è¡¨ç»“æ„"><a href="#æ•°æ®åº“è¡¨ç»“æ„" class="headerlink" title="æ•°æ®åº“è¡¨ç»“æ„"></a>æ•°æ®åº“è¡¨ç»“æ„</h2><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">create table short_link_id_map
(
    year             int not null comment &#39;å¹´ä»½&#39;,
    table_name_index varchar(10)      not null comment &#39;çŸ­è¿æ¥è¡¨ååç¼€ï¼Œä¸»é”®&#39;,
    start_id         bigint           null comment &#39;å¼€å§‹ID&#39;,
    end_id           bigint           null comment &#39;ç»“æŸID&#39;,
    primary key (year, table_name_index)
)
    comment &#39;çŸ­è¿æ¥IDæ˜ å°„è¡¨&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="äº§ç”Ÿæ­»é”çš„äº‹åŠ¡"><a href="#äº§ç”Ÿæ­»é”çš„äº‹åŠ¡" class="headerlink" title="äº§ç”Ÿæ­»é”çš„äº‹åŠ¡"></a>äº§ç”Ÿæ­»é”çš„äº‹åŠ¡</h2><pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">-- 1.è·å–IDçŸ­é“¾æ˜ å°„è®°å½•ï¼Œåªä¼šæœ‰ä¸€æ¡è®°å½•
select * from short_link_id_map
where table_name_index &#x3D; #&#123;tableNameIndex&#125; and year &#x3D; #&#123;year&#125;
for update;
-- 2.çŸ­é“¾IDæ˜ å°„è®°å½•å­˜åœ¨ï¼Œåˆ™æ›´æ–°endId
update short_link_id_map set end_id &#x3D; #&#123;endId&#125;
where table_name_index&#x3D;$&#123;tableNameIndex&#125; and year&#x3D;#&#123;year&#125;
and end_id &lt; #&#123;endId&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>äº§ç”Ÿæ­»é”çš„äº‹åŠ¡å¦‚ä¸Šï¼Œå…¶ä¸­äº‹åŠ¡ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ä½¿ç”¨äº†<code>select for update</code>ï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³å¤šèŠ‚ç‚¹å¹¶å‘æ’å…¥å¼•èµ·ä¸»é”®å†²çªã€‚</p>
<h2 id="äº‹åŠ¡æ‰§è¡Œåœºæ™¯"><a href="#äº‹åŠ¡æ‰§è¡Œåœºæ™¯" class="headerlink" title="äº‹åŠ¡æ‰§è¡Œåœºæ™¯"></a>äº‹åŠ¡æ‰§è¡Œåœºæ™¯</h2><p>æ ¹æ®çº¿ä¸Šç¯å¢ƒï¼Œäº‹åŠ¡æ‰§è¡Œçš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2023/03/09/mysql/yi-ge-qi-guai-de-shu-ju-ku-si-suo-wen-ti-pai-cha/%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="äº‹åŠ¡æ‰§è¡Œç¤ºæ„å›¾"><br>åœ¨å•èŠ‚ç‚¹ä¸‹ä¸ä¼šå‡ºç°æ­»é”ï¼Œè€Œå¤šä¸ªèŠ‚ç‚¹å¹¶å‘çš„æ‰§è¡Œä¸Šé¢çš„äº‹åŠ¡ï¼Œå°±ä¼šå‡ºç°æ­»é”çš„ç°è±¡ã€‚<br><img src="/2023/03/09/mysql/yi-ge-qi-guai-de-shu-ju-ku-si-suo-wen-ti-pai-cha/%E6%AD%BB%E9%94%81%E6%97%A5%E5%BF%97.png" alt="æ­»é”æ—¥å¿—"></p>
<h2 id="æ­»é”åˆ†æ"><a href="#æ­»é”åˆ†æ" class="headerlink" title="æ­»é”åˆ†æ"></a>æ­»é”åˆ†æ</h2><p>é¦–å…ˆæˆ‘ä»¬å¾—äº†è§£MySQLä¸­åŠ é”çš„åŸºæœ¬å•ä½æ˜¯é‚»é”®é”ï¼ˆè¡Œé” + é—´éš™é”ï¼‰ï¼Œå¦‚æœé‡åˆ°å”¯ä¸€ç´¢å¼•ï¼Œåˆ™é‚»é”®é”é€€åŒ–ä¸ºè¡Œé”ï¼Œè¯¦æƒ…è¯·å‚é˜…<a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking.html">MySQLå®˜ç½‘</a>ã€‚<br>ç¬¬ä¸€æ¡SQLï¼š<code>select for update</code> ,whereæ¡ä»¶ä½¿ç”¨äº†ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥åœ¨æŸ¥è¯¢è®°å½•ä¸ŠåŠ è¡Œé”ã€‚<br>ç¬¬äºŒæ¡SQLï¼š<code>update</code>, ç”±äºwhereæ¡ä»¶æ˜¯ä¼šèµ°ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯åœ¨è¦æ›´æ–°çš„è®°å½•ä¸ŠåŠ è¡Œé”ã€‚<br>æ ¹æ®äº‹åŠ¡ä¸­çš„SQLæ“ä½œï¼Œä¸¤æ¡SQLä¼šå¯¹åŒä¸€ä¸ªè¡Œè®°å½•åŠ è¡Œé”ï¼Œç†è®ºä¸Šæ˜¯ä¸ä¼šäº§ç”Ÿæ­»é”çš„ã€‚ä»SQLä¸­æ— æ³•åˆ†æå‡ºäº§ç”Ÿæ­»é”å…·ä½“åŸå› ï¼Œæ‰€ä»¥éœ€è¦æŸ¥çœ‹MySQLçš„æ­»é”æ—¥å¿—ã€‚</p>
<h1 id="ä¸‰ã€æ­»é”æ—¥å¿—"><a href="#ä¸‰ã€æ­»é”æ—¥å¿—" class="headerlink" title="ä¸‰ã€æ­»é”æ—¥å¿—"></a>ä¸‰ã€æ­»é”æ—¥å¿—</h1><p>ä½¿ç”¨<code>SHOW ENGINE INNODB STATUS;</code>å‘½ä»¤æŸ¥çœ‹æœ€åä¸€ä¸ªæ­»é”æ—¥å¿—ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
2023-03-07 12:58:29 0x7fe705b44700 INNODB MONITOR OUTPUT
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Per second averages calculated from the last 9 seconds
-----------------
BACKGROUND THREAD
-----------------
srv_master_thread loops: 100159 srv_active, 0 srv_shutdown, 1185548 srv_idle
srv_master_thread log flush and writes: 1285611
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 209834
OS WAIT ARRAY INFO: signal count 212844
RW-shared spins 0, rounds 407264, OS waits 186247
RW-excl spins 0, rounds 316974, OS waits 7975
RW-sx spins 28, rounds 627, OS waits 12
Spin rounds per wait: 407264.00 RW-shared, 316974.00 RW-excl, 22.39 RW-sx
------------------------
LATEST DETECTED DEADLOCK
------------------------
2023-03-07 12:57:09 0x7fe72781c700
*** (1) TRANSACTION:
TRANSACTION 1686739378, ACTIVE 0 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 2 lock struct(s), heap size 1136, 1 row lock(s)
MySQL thread id 10768, OS thread handle 140630204196608, query id 4101047 172.16.124.217 root statistics
select *
        from short_link_id_map
        where table_name_index &#x3D; &#39;0303&#39;
          and year &#x3D; 2023
        for update
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
-- äº‹åŠ¡1ï¼šç­‰å¾…ä¸€ä¸ªè¡Œé”ï¼Œè¿™ä¸ªè¡Œé”æ˜¯æ·»åŠ åˆ°ä¸»é”®ç´¢å¼•ä¸Šçš„
RECORD LOCKS space id 25270 page no 3 n bits 160 index PRIMARY of table &#96;db&#96;.&#96;short_link_id_map&#96; trx id 1686739378 lock_mode X locks rec but not gap waiting
-- äº‹åŠ¡1ï¼šç­‰å¾…çš„è¡Œé”å¯¹åº”çš„è¡Œå†…å®¹å¦‚ä¸‹ï¼š
Record lock, heap no 88 PHYSICAL RECORD: n_fields 6; compact format; info bits 0
 0: len 4; hex 800007e7; asc     ;;
 1: len 4; hex 30333033; asc 0303;;
 2: len 6; hex 000064899693; asc   d   ;;
 3: len 7; hex 6c000014e80d9a; asc l      ;;
 4: len 8; hex 8000000002e70503; asc         ;;
 5: len 8; hex 8000000002e70513; asc         ;;
 
*** (2) TRANSACTION:
TRANSACTION 1686739377, ACTIVE 0 sec starting index read
mysql tables in use 1, locked 1
3 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 10760, OS thread handle 140630776989440, query id 4101048 172.16.124.217 root updating
update short_link_id_map
         SET end_id &#x3D; 48694547
        where table_name_index&#x3D;0303 and year&#x3D;2023
          
            and end_id &lt; 48694547
*** (2) HOLDS THE LOCK(S):
-- äº‹åŠ¡2ï¼šæŒæœ‰ä¸€ä¸ªè¡Œé”ï¼Œè¿™ä¸ªè¡Œé”æ˜¯æ·»åŠ åˆ°ä¸»é”®ç´¢å¼•ä¸Šçš„
RECORD LOCKS space id 25270 page no 3 n bits 160 index PRIMARY of table &#96;db&#96;.&#96;short_link_id_map&#96; trx id 1686739377 lock_mode X locks rec but not gap
-- äº‹åŠ¡2ï¼šæŒæœ‰çš„è¡Œé”å¯¹åº”çš„è¡Œå†…å®¹å¦‚ä¸‹ï¼š
Record lock, heap no 88 PHYSICAL RECORD: n_fields 6; compact format; info bits 0
 0: len 4; hex 800007e7; asc     ;;
 1: len 4; hex 30333033; asc 0303;;
 2: len 6; hex 000064899693; asc   d   ;;
 3: len 7; hex 6c000014e80d9a; asc l      ;;
 4: len 8; hex 8000000002e70503; asc         ;;
 5: len 8; hex 8000000002e70513; asc         ;;
 
*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
-- äº‹åŠ¡2ï¼šç­‰å¸¦ä¸€ä¸ªé‚»é”®é”ï¼Œè¿™ä¸ªè¡Œé”æ˜¯æ·»åŠ åˆ°ä¸»é”®ç´¢å¼•ä¸Šçš„
RECORD LOCKS space id 25270 page no 3 n bits 160 index PRIMARY of table &#96;db&#96;.&#96;short_link_id_map&#96; trx id 1686739377 lock_mode X waiting
-- äº‹åŠ¡2:ç­‰å¾…çš„åŠ é”çš„è®°å½•å†…å®¹å¦‚ä¸‹ï¼š
Record lock, heap no 88 PHYSICAL RECORD: n_fields 6; compact format; info bits 0
 0: len 4; hex 800007e7; asc     ;;
 1: len 4; hex 30333033; asc 0303;;
 2: len 6; hex 000064899693; asc   d   ;;
 3: len 7; hex 6c000014e80d9a; asc l      ;;
 4: len 8; hex 8000000002e70503; asc         ;;
 5: len 8; hex 8000000002e70513; asc         ;;
 
*** WE ROLL BACK TRANSACTION (1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æ—¥å¿—åˆ†æ"><a href="#æ—¥å¿—åˆ†æ" class="headerlink" title="æ—¥å¿—åˆ†æ"></a>æ—¥å¿—åˆ†æ</h2><p>æ ¹æ®ä»¥ä¸Šå¼‚å¸¸æ—¥å¿—ï¼Œæˆ‘ä»¬è¯¦ç»†åˆ†æå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºã€‚</p>
<ul>
<li>äº‹åŠ¡1ï¼šç­‰å¾…è¡Œé”ï¼ˆlock_mode X locks rec but not gap waitingï¼‰</li>
<li>äº‹åŠ¡2ï¼šæŒæœ‰è¡Œé”ï¼ˆlock_mode X locks rec but not gapï¼‰</li>
<li>äº‹åŠ¡2ï¼šç­‰å¾…é‚»é”®é”ï¼ˆlock_mode X waitingï¼‰</li>
</ul>
<p>æ ¹æ®äº‹åŠ¡æ¨è¿›é¡ºåºï¼Œ<code>äº‹åŠ¡2</code>æŒæœ‰ä¸€ä¸ªè¡Œé”ï¼Œ<code>äº‹åŠ¡1</code>ç­‰å¾…<code>äº‹åŠ¡2</code>æŒæœ‰çš„è¡Œé”ï¼Œ<code>äº‹åŠ¡2</code>ç”³è¯·ä¸€ä¸ªé‚»é”®é”ï¼Œè€Œä¸”è¿™ä¸ªé‚»é”®é”ç­‰å¾…<code>äº‹åŠ¡2</code>è‡ªå·±æŒæœ‰çš„è¡Œé”ã€‚ä»è€Œè§¦å‘æ­»é”æ£€æµ‹æ¡ä»¶ï¼Œæœ€åå›æ»š<code>äº‹åŠ¡1</code>ï¼Œå¯¼è‡´<code>äº‹åŠ¡1</code>å¯¹åº”çš„è¯·æ±‚å¤±è´¥ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿæ­»é”ï¼Ÿ</h2><p>ä»ä»¥ä¸Šçš„æ­»é”æ—¥å¿—æ¥çœ‹ï¼Œå‘ç”Ÿæ­»é”çš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œ<code>äº‹åŠ¡1</code>åªæ˜¯åœ¨ç­‰å¾…é”å¹¶æ²¡æœ‰æŒæœ‰é”ï¼Œè€Œ<code>äº‹åŠ¡2</code>æŒæœ‰ä¸€ä¸ªè¡Œé”ï¼Œå†æ¬¡ç”³è¯·è¯¥è¡Œé”å¯¹åº”çš„é‚»é”®é”æ—¶è§¦å‘äº†æ­»é”æ£€æµ‹ï¼Œå¯¼è‡´<code>äº‹åŠ¡1</code>å›æ»šã€‚<br>è€Œæ ¹æ®æˆ‘ä»¬çš„åˆ†æï¼Œæ­¤æ—¶å¹¶ä¸å­˜åœ¨é”ç«äº‰ï¼Œä¸ºä»€ä¹ˆå°±æ­»é”äº†å‘¢ï¼Ÿ</p>
<h2 id="ä¸ç¬¦åˆç†è®ºçš„ç°è±¡"><a href="#ä¸ç¬¦åˆç†è®ºçš„ç°è±¡" class="headerlink" title="ä¸ç¬¦åˆç†è®ºçš„ç°è±¡"></a>ä¸ç¬¦åˆç†è®ºçš„ç°è±¡</h2><p>è€Œä¸”æ›´ä¸ºå¥‡æ€ªçš„æ˜¯ä¸ºä»€ä¹ˆç¬¬äºŒæ¡SQLæ‰§è¡Œupdateè¯­å¥çš„SQLè¯·æ±‚çš„æ˜¯ä¸€ä¸ª<code>é‚»é”®é”</code>ï¼Œupdateè¯­å¥æ˜æ˜¾æ˜¯èµ°äº†ä¸»é”®ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•åˆ™ä¼šå°†<code>é‚»é”®é”</code>é€€åŒ–ä¸º<code>è¡Œé”</code>ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªäº‹åŠ¡ä¸­<code>é‚»é”®é”</code>æ²¡æœ‰é€€åŒ–ä¸º<code>è¡Œé”</code>ï¼Ÿ</p>
<h2 id="æ­»é”é‡ç°"><a href="#æ­»é”é‡ç°" class="headerlink" title="æ­»é”é‡ç°"></a>æ­»é”é‡ç°</h2><p>åœ¨æœ¬åœ°ç¯å¢ƒåŒæ—¶å¼€å¯ä¸¤ä¸ªä¼šè¯ï¼ŒæŒ‰ç…§ä¸Šè¿°äº‹åŠ¡æ¨è¿›é¡ºåºè¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚ä½†æ˜¯æœ¬åœ°ç¯å¢ƒåœ¨è¿›è¡Œå¹¶å‘æµ‹è¯•çš„æ—¶å€™ï¼Œåˆ™ä¼šé¢‘ç¹å‡ºç°æ­»é”ã€‚</p>
<h2 id="æ­»é”äº§ç”Ÿçš„åœºæ™¯"><a href="#æ­»é”äº§ç”Ÿçš„åœºæ™¯" class="headerlink" title="æ­»é”äº§ç”Ÿçš„åœºæ™¯"></a>æ­»é”äº§ç”Ÿçš„åœºæ™¯</h2><p>å¯¹äºæ­»é”æ£€æµ‹çš„æœºåˆ¶å’Œæˆ‘ä»¬å¯¹æ­»é”çš„è®¤çŸ¥å­˜åœ¨ä¸€å®šçš„åŒºåˆ«ï¼Œæˆ‘åœ¨ä¸€ä¸ªMySQLçš„ä¸€ä¸ªbugæ¸…å•ä¸­æ‰¾åˆ°äº†MySQLå›¢é˜Ÿç»™äºˆçš„å›å¤ï¼š</p>
<blockquote>
<p>The very misleading part of the output is that the section is titled â€œHOLDS THE LOCK(S)â€, while in fact not every lock mentioned in this section is actually â€œheldâ€. Itâ€™s still in the process of acquisition, as evidenced by the word â€œwaitingâ€.<br>The reason this lock is listed in the section titled â€œHOLDS THE LOCK(S)â€ is because for the purpose of deadlock detection algorithm, a request for an X-lock is treated very similarly to already holding an X-lock.<br>And this is done to correctly model the fact, that transactions which request S-lock, have to wait not only for transactions already holding an X-lock, but also for transactions which merely requested it, but still wait for it to be granted - this is done to avoid the problem of â€œstarvation of writers by readersâ€.<br>Another reason (perhaps more important for your case) which is a bit similar, is that a transaction which requests an X-lock, has to wait for its turn, giving priority to transaction which already waits for an X-lock (in mysql 5.6 and 5.7 thereâ€™s simply a FIFO queue, and in 8.0 there is also CATS algorithm, but both algorithms try to ensure that new-coming transaction waits for those already in queue). This again is done to avoid starvation: this time among writers themselves.<br>So, given that InnoDB forces transactions to wait for a transaction which waits for an X-lock, it might mean that a deadlock is possible, in which one of the edges in the deadlock cycle involves waiting for transaction which still waits for an X-lock.<br>And the simplest way to model it in the deadlock checking algorithm is to treat the â€œX-lock being waited forâ€ as â€œalready heldâ€.</p>
</blockquote>
<p>è¾“å‡ºä¸­éå¸¸å…·æœ‰è¯¯å¯¼æ€§çš„éƒ¨åˆ†æ˜¯è¯¥éƒ¨åˆ†æ ‡é¢˜ä¸ºâ€œHOLDS THE LOCK(S)â€ï¼Œè€Œå®é™…ä¸Šå¹¶éæœ¬èŠ‚ä¸­æåˆ°çš„æ¯ä¸ªé”å®é™…ä¸Šéƒ½â€œæŒæœ‰â€ã€‚ è¿˜åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œâ€œå¾…â€å­—å°±æ˜¯æ˜è¯ã€‚<br>è¿™ä¸ªé”è¢«åˆ—åœ¨æ ‡é¢˜ä¸ºâ€œHOLDS THE LOCK(S)â€çš„éƒ¨åˆ†ä¸­çš„åŸå› æ˜¯å‡ºäºæ­»é”æ£€æµ‹ç®—æ³•çš„ç›®çš„ï¼Œå¯¹ X é”çš„è¯·æ±‚ä¸å·²ç»æŒæœ‰ X é”çš„å¤„ç†æ–¹å¼éå¸¸ç›¸ä¼¼ã€‚<br>è¿™æ ·åšæ˜¯ä¸ºäº†æ­£ç¡®åœ°æ¨¡æ‹Ÿè¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³è¯·æ±‚ S é”çš„äº‹åŠ¡ä¸ä»…è¦ç­‰å¾…å·²ç»æŒæœ‰ X é”çš„äº‹åŠ¡ï¼Œè¿˜è¦ç­‰å¾…ä»…è¯·æ±‚å®ƒä½†ä»åœ¨ç­‰å¾…å®ƒè¢«æˆäºˆçš„äº‹åŠ¡â€”â€” è¿™æ ·åšæ˜¯ä¸ºäº†é¿å…â€œè¯»è¯·æ±‚é¥¿æ­»å†™è¯·æ±‚â€çš„é—®é¢˜ã€‚<br>å¦ä¸€ä¸ªæœ‰ç‚¹ç›¸ä¼¼çš„åŸå› ï¼ˆå¯¹äºæ‚¨çš„æƒ…å†µå¯èƒ½æ›´é‡è¦ï¼‰æ˜¯è¯·æ±‚ X é”çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…è½®åˆ°å®ƒï¼Œä¼˜å…ˆè€ƒè™‘å·²ç»ç­‰å¾… X é”çš„äº‹åŠ¡ï¼ˆåœ¨ mysql 5.6 ä¸­ 5.7 æœ‰ä¸€ä¸ªç®€å•çš„ FIFO é˜Ÿåˆ—ï¼Œ8.0 ä¹Ÿæœ‰ CATS ç®—æ³•ï¼Œä½†ä¸¤ç§ç®—æ³•éƒ½è¯•å›¾ç¡®ä¿æ–°åˆ°æ¥çš„äº‹åŠ¡ç­‰å¾…å·²ç»åœ¨é˜Ÿåˆ—ä¸­çš„äº‹åŠ¡ï¼‰ã€‚ è¿™æ ·åšä¹Ÿæ˜¯ä¸ºäº†é¿å…é¥¥é¥¿ï¼šè¿™æ¬¡æ˜¯åœ¨å†™è¯·æ±‚è‡ªå·±ä¸­é—´ã€‚<br>å› æ­¤ï¼Œé‰´äº InnoDB å¼ºåˆ¶äº‹åŠ¡ç­‰å¾… X é”çš„äº‹åŠ¡ï¼Œè¿™å¯èƒ½æ„å‘³ç€æ­»é”æ˜¯å¯èƒ½çš„ï¼Œå…¶ä¸­æ­»é”å‘¨æœŸä¸­çš„ä¸€ä¸ªè¾¹ç¼˜æ¶‰åŠç­‰å¾…ä»åœ¨ç­‰å¾… X- çš„äº‹åŠ¡é”ã€‚<br>åœ¨æ­»é”æ£€æŸ¥ç®—æ³•ä¸­å¯¹å…¶å»ºæ¨¡çš„æœ€ç®€å•æ–¹æ³•æ˜¯å°†â€œæ­£åœ¨ç­‰å¾…çš„ X é”â€è§†ä¸ºâ€œå·²æŒæœ‰â€ã€‚</p>
<p>æ–‡ç« è§ï¼š<a href="https://bugs.mysql.com/bug.php?id=101695">Weird deadlock behavior where a transaction holds a lock on an index, and the SAME transactions also waits for a lock on the exact SAME index</a></p>
<p>æ€»ç»“æ¥è¯´å°±æ˜¯MySQLæ­»é”æ£€æµ‹ç®—æ³•æŒ‰ç…§ç›¸ä¼¼æ–¹å¼å¤„ç†<code>è¯·æ±‚Xé”çš„äº‹åŠ¡</code>ä¸<code>æŒæœ‰Xé”çš„äº‹åŠ¡</code>,å› ä¸ºå¤šä¸ªäº‹åŠ¡è¯·æ±‚Xé”æ—¶éœ€è¦è¿›è¡Œæ’é˜Ÿï¼Œè€ŒXé”é‡Šæ”¾åä¼šæŒ‰ç…§é˜Ÿåˆ—ä¸­çš„é¡ºåºå»è·å¾—é”ã€‚<br>æ ¹æ®ä»¥ä¸Šç»“è®ºï¼Œæ­»é”äº§ç”Ÿçš„åŸå› ä¸ºï¼šäº‹åŠ¡2æŒæœ‰è¡Œé”ï¼Œäº‹åŠ¡1è¯·æ±‚è¡Œé”ï¼Œäº‹åŠ¡2è¯·æ±‚é‚»é”®é”éœ€è¦åœ¨äº‹åŠ¡1åæ’é˜Ÿè¡Œç¨‹ç¯è·¯ï¼Œä»è€Œè§¦å‘äº†æ­»é”æ£€æµ‹ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><img src="/2023/03/09/mysql/yi-ge-qi-guai-de-shu-ju-ku-si-suo-wen-ti-pai-cha/%E6%AD%BB%E9%94%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="æ­»é”ç¤ºæ„å›¾"></p>
<h2 id="ä»å­˜åœ¨çš„ä¸¤ä¸ªç–‘é—®ï¼Ÿ"><a href="#ä»å­˜åœ¨çš„ä¸¤ä¸ªç–‘é—®ï¼Ÿ" class="headerlink" title="ä»å­˜åœ¨çš„ä¸¤ä¸ªç–‘é—®ï¼Ÿ"></a>ä»å­˜åœ¨çš„ä¸¤ä¸ªç–‘é—®ï¼Ÿ</h2><p>é€šè¿‡ä¸Šè¿°çš„è§£é‡Šï¼Œæˆ‘ä»¬æ˜ç™½äº†æ­»é”äº§ç”Ÿçš„åœºæ™¯ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜ä»ç„¶å­˜åœ¨ç–‘é—®ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆäº‹åŠ¡2åœ¨æŒæœ‰è¡Œé”çš„æƒ…å†µä¸‹ï¼Œå†è¯·æ±‚ä¸€ä¸ªé‚»é”®é”ï¼ˆè¡Œé”ä¸é—´éš™é”çš„ç»„åˆï¼‰æ—¶è¢«æ£€æµ‹ä¸ºæ­»é”å‘¢ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆåœ¨æ‰§è¡Œç¬¬äºŒæ¡updateæ—¶æ˜æ˜¾èµ°äº†ä¸»é”®ç´¢å¼•ï¼Œä½†è¯·æ±‚çš„æ˜¯é‚»é”®é”è€Œä¸æ˜¯è¡Œé”ï¼Ÿ</li>
</ul>
<h1 id="å››ã€MySQLçš„ä¸€ä¸ªBUG"><a href="#å››ã€MySQLçš„ä¸€ä¸ªBUG" class="headerlink" title="å››ã€MySQLçš„ä¸€ä¸ªBUG"></a>å››ã€MySQLçš„ä¸€ä¸ªBUG</h1><p>é€šè¿‡æŸ¥çœ‹MySLQåŠ é”çš„æºç è§£æï¼Œå‘ç°MySQLå­˜åœ¨çš„ä¸€ä¸ªbugï¼Œè¯¦æƒ…å‚è§ä»¥ä¸‹æ–‡ç« ï¼š<br><a href="https://leviathan.vip/2021/02/25/mysql-deadlock-bugfix-23755664/">InnoDB æ­»é” Bug æ’æŸ¥</a><br><a href="https://bugs.mysql.com/bug.php?id=99095">Bug #82127	Deadlock with 3 concurrent DELETEs by UNIQUE key</a></p>
<h2 id="ç®€è€Œè¨€ä¹‹"><a href="#ç®€è€Œè¨€ä¹‹" class="headerlink" title="ç®€è€Œè¨€ä¹‹"></a>ç®€è€Œè¨€ä¹‹</h2><p>å®˜æ–¹åœ¨ 8.0.18 ç‰ˆæœ¬å¯¹æ­»é”æ£€æµ‹è¿›è¡Œäº†ä¼˜åŒ–, å°†åŸå…ˆçš„æ­»é”æ£€æµ‹æœºåˆ¶äº¤ç»™äº†<code>background thread</code> æ¥å¤„ç†, å…·ä½“çš„Patché“¾æ¥:<a href="https://github.com/mysql/mysql-server/commit/3859219875b62154b921e8c6078c751198071b9c">MySQL-8.0.18 æ­»é”æ£€æµ‹ä¼˜åŒ–</a>. å…·ä½“çš„æ€è·¯æ˜¯å°†å½“å‰äº‹åŠ¡ç³»ç»Ÿçš„ lock ä¿¡æ¯æ‰“ä¸€ä»½å¿«ç…§, ç”±è¿™ä»½å¿«ç…§åˆ¤æ–­æ˜¯å¦å­˜åœ¨å›ç¯, å‡å¦‚å­˜åœ¨æ­»é”å³å”¤é†’ç­‰å¾…äº‹åŠ¡.<br>è€Œåœ¨ 8.0.17 ç‰ˆæœ¬ä¾ç„¶é‡‡ç”¨æ—§çš„æ­»é”æ£€æµ‹æ–¹æ³•,æ¯æ¬¡ç”³è¯·<code>lock</code>å¤±è´¥è¿›å…¥<code>wait</code>çŠ¶æ€åè§¦å‘ä¸€ä¸‹æ­»é”æ£€æµ‹,ç”±äºå­˜åœ¨é”ç­‰å¾…çš„ç¯è·¯ï¼Œæ‰€ä»¥è¢«æ£€æµ‹ä¸ºæ­»é”ã€‚<br>ç”¨ä¸€å¥è¯æ¥è¯´å°±æ˜¯MySQL 8.0.18ä¹‹å‰ä¸æ”¯æŒè¡Œé”å‡çº§åˆ°é‚»é”®é”ï¼Œæ‰€ä»¥åœ¨æŒæœ‰è¡Œé”çš„æƒ…å†µä¸‹ï¼ŒåŸºäºæ­¤è¡Œé”å‡çº§è‡³é‚»é”®é”æ—¶ï¼Œç”±äºå­˜åœ¨ç­‰å¾…ç¯è·¯ï¼Œè€Œè¢«æ£€æµ‹ä¸ºæ­»é”ã€‚</p>
<h1 id="äº”ã€é‚»é”®é”ä¸ºä»€ä¹ˆæ²¡æœ‰é€€åŒ–ä¸ºè¡Œé”"><a href="#äº”ã€é‚»é”®é”ä¸ºä»€ä¹ˆæ²¡æœ‰é€€åŒ–ä¸ºè¡Œé”" class="headerlink" title="äº”ã€é‚»é”®é”ä¸ºä»€ä¹ˆæ²¡æœ‰é€€åŒ–ä¸ºè¡Œé”"></a>äº”ã€é‚»é”®é”ä¸ºä»€ä¹ˆæ²¡æœ‰é€€åŒ–ä¸ºè¡Œé”</h1><p>é€šè¿‡ä¸Šè¿°MySQLçš„bugåˆ†æï¼Œæˆ‘ä»¬äº†è§£åˆ°MySQLä¸æ”¯æŒé”å‡çº§å¯¼è‡´äº†æ­»é”çš„äº§ç”Ÿã€‚<br>ä½†æ˜¯ç›®å‰è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œäº‹åŠ¡ä¸­ç¬¬äºŒæ¡æ›´æ–°è¯­å¥ä½¿ç”¨åˆ°ä¸»é”®ç´¢å¼•ï¼Œé€šè¿‡æ‰§è¡Œè®¡åˆ’çœ‹ä¹Ÿæ˜¯ä¼šèµ°ä¸»é”®ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œçš„é‚»é”®é”æ²¡æœ‰é€€åŒ–ä¸ºè¡Œé”å‘¢ï¼Ÿ</p>
<pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">update short_link_id_map set end_id &#x3D; #&#123;endId&#125;
where table_name_index&#x3D;$&#123;tableNameIndex&#125; and year&#x3D;#&#123;year&#125;
and end_id &lt; #&#123;endId&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="çŒœæƒ³ä¸éªŒè¯"><a href="#çŒœæƒ³ä¸éªŒè¯" class="headerlink" title="çŒœæƒ³ä¸éªŒè¯"></a>çŒœæƒ³ä¸éªŒè¯</h2><p>å› ä¸ºè¿™ä¸ªè¡¨çš„è®°å½•å¹¶ä¸å¤šï¼Œæ€»å…±ä¸è¶…è¿‡1000è¡Œï¼Œè€ŒMySQLçš„æŸ¥è¯¢åŸºäºæˆæœ¬ä¼˜åŒ–ï¼Œæ˜¯ä¸æ˜¯åœ¨æˆæœ¬ä¼˜åŒ–åï¼Œæ²¡æœ‰é€‰æ‹©èµ°ä¸»é”®ç´¢å¼•ï¼ŒäºŒæ˜¯èµ°äº†å…¨è¡¨æ‰«æå‘¢ï¼Ÿ<br>æˆ‘ä»¬æ›´æ–°æ¡ä»¶ä¸­é™¤äº†æœ‰ä¸»è§ç´¢å¼•å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ™®é€šåˆ—ï¼Œæ˜¯å¦æŸ¥è¯¢æ¡ä»¶ä¼šå½±å“MySQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œæˆ‘ä»¬å°†updateä¿®æ”¹ä¸ºselecté€šè¿‡æ‰§è¡Œè®¡åˆ’éªŒè¯ä¸€ä¸‹ï¼š<br><img src="/2023/03/09/mysql/yi-ge-qi-guai-de-shu-ju-ku-si-suo-wen-ti-pai-cha/%E5%85%A8%E8%A1%A8%E6%89%AB%E6%8F%8F%E9%AA%8C%E8%AF%81.png" alt="å…¨è¡¨æ‰«æéªŒè¯"><br>æ ¹æ®ä»¥ä¸ŠéªŒè¯ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹whereæ¡ä»¶ä¸­çš„ä¸»é”®ç´¢å¼•åé¢çš„æ¡ä»¶æ—¶ï¼Œæ‰§è¡Œè®¡åˆ’æ˜¾ç¤ºä¼šå­˜åœ¨èµ°å…¨è¡¨æ‰«æçš„æƒ…å†µã€‚</p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ›´æ–°æ“ä½œè™½ç„¶ä½¿ç”¨äº†ä¸»é”®ç´¢å¼•ï¼Œä½†æ˜¯åŒæ—¶å­˜åœ¨ä¸€ä¸ªæ™®é€šçš„whereæ¡ä»¶ï¼Œè€Œä¸”ç”±äºè¡¨å†…å®¹è¾ƒå°‘ï¼Œåœ¨å¹¶å‘è¯·æ±‚æ—¶æœ‰ä¸€å®šçš„æ¦‚ç‡èµ°å…¨è¡¨æ‰«æï¼Œè€Œå…¨è¡¨æ‰«æåˆ™ä¼šåŠ é‚»é”®é”ã€‚</p>
<h1 id="å…­ã€è§£å†³æ–¹æ¡ˆ"><a href="#å…­ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…­ã€è§£å†³æ–¹æ¡ˆ"></a>å…­ã€è§£å†³æ–¹æ¡ˆ</h1><p>æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>select for update</code>ä¸»è¦æ—¶ä¸ºäº†è§£å†³å¹¶å‘æ’å…¥ä¸»é”®å†²çªçš„é—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡ä¸­ä¸€å¤©åªä¼šè¿›è¡Œä¸€æ¬¡æ’å…¥ï¼Œå…¶ä½™çš„éƒ½æ˜¯æ›´æ–°æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥å»é™¤äº†selectä¸­çš„<code>for update</code>,å‡å°äº†äº‹åŠ¡ï¼Œå¯¹äºå¹¶å‘æ’å…¥é—®é¢˜ï¼Œä½¿ç”¨<code>insert ... on duplicate key update</code>è§£å†³å¹¶å‘æ’å…¥çš„é—®é¢˜ã€‚</p>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p><code>insert ... on duplicate key update</code>åœ¨å¹¶å‘æƒ…å†µä¸‹ä¹Ÿä¼šäº§ç”Ÿæ­»é”ï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡ä¸­å¹¶å­˜åœ¨è¿™ç§åœºæ™¯ã€‚å…·ä½“åŸå› è¿™é‡Œä¸åšå±•å¼€ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±æ¢ç´¢ä¸€ä¸‹ï¼Œæ­»é”æ—¥å¿—å¦‚ä¸‹ï¼›</p>
<pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
2023-03-07 16:01:08 0x7fe705b44700 INNODB MONITOR OUTPUT
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
Per second averages calculated from the last 46 seconds
-----------------
BACKGROUND THREAD
-----------------
srv_master_thread loops: 100781 srv_active, 0 srv_shutdown, 1195883 srv_idle
srv_master_thread log flush and writes: 1296568
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 211624
OS WAIT ARRAY INFO: signal count 214692
RW-shared spins 0, rounds 410284, OS waits 187670
RW-excl spins 0, rounds 326082, OS waits 8247
RW-sx spins 29, rounds 657, OS waits 12
Spin rounds per wait: 410284.00 RW-shared, 326082.00 RW-excl, 22.66 RW-sx
------------------------
LATEST DETECTED DEADLOCK
------------------------
2023-03-07 15:51:02 0x7fe705556700
*** (1) TRANSACTION:
TRANSACTION 1686742571, ACTIVE 0 sec inserting
mysql tables in use 1, locked 1
LOCK WAIT 4 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 10937, OS thread handle 140630203115264, query id 4160546 172.16.124.217 root update
insert into short_link_id_map (year, table_name_index, start_id, end_id)
        values (2023, &#39;0304&#39;, 48694560,
                48694570)
        on duplicate key update end_id &#x3D; if(end_id  &lt; 48694570, 48694570, end_id)
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 25270 page no 3 n bits 160 index PRIMARY of table &#96;cmp_gsms_2.0&#96;.&#96;gsms_short_link_id_map&#96; trx id 1686742571 lock_mode X locks gap before rec insert intention waiting
Record lock, heap no 89 PHYSICAL RECORD: n_fields 6; compact format; info bits 0
 0: len 4; hex 80000833; asc    3;;
 1: len 4; hex 31323331; asc 1231;;
 2: len 6; hex 0000648995f6; asc   d   ;;
 3: len 7; hex 6f000014de10a9; asc o      ;;
 4: len 8; hex 8000000000000004; asc         ;;
 5: len 8; hex 8000000000001130; asc        0;;
 
*** (2) TRANSACTION:
TRANSACTION 1686742572, ACTIVE 0 sec inserting
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1136, 2 row lock(s)
MySQL thread id 10938, OS thread handle 140630203655936, query id 4160547 172.16.124.217 root update
insert into gsms_short_link_id_map (year, table_name_index, start_id, end_id)
        values (2023, &#39;0304&#39;, 48694560,
                48694570)
        on duplicate key update end_id &#x3D; if(end_id  &lt; 48694570, 48694570, end_id)
*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 25270 page no 3 n bits 160 index PRIMARY of table &#96;cmp_gsms_2.0&#96;.&#96;gsms_short_link_id_map&#96; trx id 1686742572 lock_mode X locks gap before rec
Record lock, heap no 89 PHYSICAL RECORD: n_fields 6; compact format; info bits 0
 0: len 4; hex 80000833; asc    3;;
 1: len 4; hex 31323331; asc 1231;;
 2: len 6; hex 0000648995f6; asc   d   ;;
 3: len 7; hex 6f000014de10a9; asc o      ;;
 4: len 8; hex 8000000000000004; asc         ;;
 5: len 8; hex 8000000000001130; asc        0;;
 
*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 25270 page no 3 n bits 160 index PRIMARY of table &#96;cmp_gsms_2.0&#96;.&#96;gsms_short_link_id_map&#96; trx id 1686742572 lock_mode X locks gap before rec insert intention waiting
Record lock, heap no 89 PHYSICAL RECORD: n_fields 6; compact format; info bits 0
 0: len 4; hex 80000833; asc    3;;
 1: len 4; hex 31323331; asc 1231;;
 2: len 6; hex 0000648995f6; asc   d   ;;
 3: len 7; hex 6f000014de10a9; asc o      ;;
 4: len 8; hex 8000000000000004; asc         ;;
 5: len 8; hex 8000000000001130; asc        0;;
 
*** WE ROLL BACK TRANSACTION (2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h1><ul>
<li>MySQLçš„æ­»é”æ£€æµ‹ç®—æ³•ä¸­ï¼Œè™½ç„¶ä¸€ä¸ªäº‹åŠ¡åœ¨è¯·æ±‚Xé”è€Œå¹¶ä¸æŒæœ‰Xé”ï¼Œä»ä¼šè§¦å‘æ­»é”æ£€æµ‹ï¼ŒåŸå› ç”±äºè¯·æ±‚Xé”ä¼šè¿›è¡Œæ’é˜Ÿï¼›</li>
<li>MySQL 8.0.18 ç‰ˆæœ¬ä¹‹å‰ä¸æ”¯æŒè¡Œé”å‡çº§è‡³é‚»é”®é”æˆ–æ›´ä¸¥æ ¼çš„é”ï¼Œè¿™ä¸MySQLçš„æ­»é”é”®é”å®ç°æœºåˆ¶ç›¸å…³ï¼›</li>
<li>updateæ“ä½œçš„whereæ¡ä»¶ä¸­å­˜åœ¨ä¸»é”®ç´¢å¼•ä¸æ™®é€šåˆ—ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œå­˜åœ¨ä¸€å®šæ¦‚ç‡èµ°å…¨è¡¨æ‰«æï¼Œè€Œè‡³äºä¸ºä»€ä¹ˆä¼šèµ°å…¨è¡¨ï¼Œåˆ™éœ€è¦æ¢ç´¢MySQLçš„æˆæœ¬ä¼˜åŒ–æœºåˆ¶ã€‚</li>
</ul>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://keithlan.github.io/2017/06/05/innodb_locks_1/">https://keithlan.github.io/2017/06/05/innodb_locks_1/</a><br><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-locking.html">https://dev.mysql.com/doc/refman/5.7/en/innodb-locking.html</a><br><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html">https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html</a><br><a href="https://leviathan.vip/2021/02/25/mysql-deadlock-bugfix-23755664/">https://leviathan.vip/2021/02/25/mysql-deadlock-bugfix-23755664/</a><br><a href="https://bugs.mysql.com/bug.php?id=82127">https://bugs.mysql.com/bug.php?id=82127</a></p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>æ­»é”</tag>
        <tag>è¡Œé”</tag>
        <tag>é‚»é”®é”</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†åº“åˆ†è¡¨è®¾è®¡æ–¹æ¡ˆ</title>
    <url>/2021/03/04/mysql/fen-ku-fen-biao-she-ji-fang-an/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h1><p>ç³»ç»Ÿæ•°æ®åº“ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªæ˜¯ä¸»è¦çš„ä¸šåŠ¡æ•°æ®å­˜å‚¨åº“ï¼Œåœ¨è¯¥åº“ä¸‹è¿›è¡Œäº†åˆ†è¡¨æ“ä½œï¼›å¦ä¸€ä¸ªæ˜¯ä¸šåŠ¡å…³è”æ€§è¾ƒå°çš„æ•°æ®åº“ï¼Œæœªè¿›è¡Œåˆ†è¡¨ã€‚åœ¨å½“å‰ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œç³»ç»Ÿæ¯å¤©çš„æ¶ˆæ¯å‘é€é‡åŸºæœ¬åˆ†å¸ƒåœ¨100ä¸‡ ~ 3000ä¸‡ä¹‹é—´ã€‚æ¶ˆæ¯ä¸‹å‘åï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ¶ˆæ¯å‘é€è®°å½•ï¼ŒåŠç”¨æˆ·æ¥å—çŠ¶æ€ã€‚ç³»ç»Ÿé‡‡ç”¨äº†æŒ‰å¤©åˆ†è¡¨çš„ç­–ç•¥ï¼Œæå‰ä¸ºå­˜å‚¨æ¶ˆæ¯è®°å½•çš„è¡¨æŒ‰å¤©åˆ›å»ºåˆ†è¡¨ï¼Œæ¯ä¸ªå¤§è¡¨å°†ä¼šæŒ‰å¤©åˆ›å»º366ä¸ªåˆ†è¡¨ï¼Œåˆ†è¡¨ä»¥æœˆæ—¥ä¸ºåç¼€ã€‚</p>
<h2 id="1-1-æŒ‰å¤©åˆ†è¡¨çš„ä¼˜ç‚¹"><a href="#1-1-æŒ‰å¤©åˆ†è¡¨çš„ä¼˜ç‚¹" class="headerlink" title="1.1 æŒ‰å¤©åˆ†è¡¨çš„ä¼˜ç‚¹"></a>1.1 æŒ‰å¤©åˆ†è¡¨çš„ä¼˜ç‚¹</h2><ul>
<li>ç”¨æˆ·å¯ä»¥ä»¥å‘é€æ—¥æœŸä¸ºæ—¶é—´é™åº¦ï¼ŒæŸ¥è¯¢ã€å¯¼å‡ºå½“å¤©çš„å‘é€è®°å½•åŠç”¨æˆ·æ¥å—çŠ¶æ€ã€‚</li>
<li>å¯ä»¥é€šè¿‡æ—¥æœŸæ¡ä»¶ï¼Œé™å®šäº‹åŠ¡èŒƒå›´ï¼Œç®€åŒ–åˆ†è¡¨äº‹åŠ¡é—®é¢˜ã€‚</li>
<li>åˆ†è¡¨è§„åˆ™ç®€å•ï¼Œæ–¹ä¾¿åŸºäºæ•°æ®åº“å„ç±»è¿è¡¨æŸ¥è¯¢æ“ä½œã€‚</li>
</ul>
<h2 id="1-2-åˆ†åº“åˆ†è¡¨é‡åˆ°çš„é—®é¢˜"><a href="#1-2-åˆ†åº“åˆ†è¡¨é‡åˆ°çš„é—®é¢˜" class="headerlink" title="1.2 åˆ†åº“åˆ†è¡¨é‡åˆ°çš„é—®é¢˜"></a>1.2 åˆ†åº“åˆ†è¡¨é‡åˆ°çš„é—®é¢˜</h2><ul>
<li>åœ¨å¼€å‘æ–°ä¸šåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œåˆ†è¡¨æ•°é‡æ€¥é€Ÿå¢é•¿ï¼Œç›®å‰ç³»ç»Ÿçš„åˆ†è¡¨æ•°é‡å·²è¾¾7000å¤šã€‚</li>
<li>åˆ†è¡¨æ•°æ®åˆ†å¸ƒä¸å‡åŒ€ï¼Œæœ‰äº›è¡¨çš„æ•°æ®åº“åªæœ‰å‡ åä¸‡æˆ–æ›´å°‘ï¼Œè€Œæœ‰çš„è¡¨çš„é‡è¶…è¿‡äº†åƒä¸‡ã€‚</li>
<li>åˆ†è¡¨æ•°é‡è¶…è¿‡åƒä¸‡çº§ï¼Œå®¢æˆ·æŸ¥è¯¢æ—¶ä¼šå½±å“æ•°æ®åº“æ€§èƒ½ï¼Œå½“å‰çš„åˆ†è¡¨æœºåˆ¶æ— æ³•åšåŠ¨æ€æ‰©å®¹ã€‚</li>
</ul>
<h1 id="äºŒã€åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ"><a href="#äºŒã€åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ" class="headerlink" title="äºŒã€åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ"></a>äºŒã€åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ</h1><p>åˆ†åº“åˆ†è¡¨çš„é‡‡ç”¨çš„å¸¸è§æ–¹æ¡ˆå‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†ã€‚</p>
<h2 id="2-1-å‚ç›´æ‹†åˆ†"><a href="#2-1-å‚ç›´æ‹†åˆ†" class="headerlink" title="2.1 å‚ç›´æ‹†åˆ†"></a>2.1 å‚ç›´æ‹†åˆ†</h2><h3 id="å‚ç›´åˆ†è¡¨"><a href="#å‚ç›´åˆ†è¡¨" class="headerlink" title="å‚ç›´åˆ†è¡¨"></a>å‚ç›´åˆ†è¡¨</h3><p>å‚ç›´åˆ†è¡¨ä¸»è¦ä¸»è¦é’ˆå¯¹æ•°æ®åˆ—è¾ƒå¤šçš„å®½è¡¨ï¼Œä¸€èˆ¬æ˜¯è¡¨ä¸­çš„å­—æ®µè¾ƒå¤šï¼Œå°†ä¸å¸¸ç”¨çš„ï¼Œ æ•°æ®è¾ƒå¤§ï¼Œé•¿åº¦è¾ƒé•¿ï¼ˆæ¯”å¦‚textç±»å‹å­—æ®µï¼‰çš„åˆ—æ‹†åˆ†åˆ°â€œæ‰©å±•è¡¨â€œã€‚ ä¸€èˆ¬æ˜¯é’ˆå¯¹é‚£ç§å‡ ç™¾åˆ—çš„å¤§è¡¨ï¼Œä¹Ÿé¿å…æŸ¥è¯¢æ—¶ï¼Œæ•°æ®é‡å¤ªå¤§é€ æˆçš„â€œè·¨é¡µâ€é—®é¢˜ã€‚</p>
<h3 id="å‚ç›´åˆ†åº“"><a href="#å‚ç›´åˆ†åº“" class="headerlink" title="å‚ç›´åˆ†åº“"></a>å‚ç›´åˆ†åº“</h3><p>å‚ç›´åˆ†åº“ä¸»è¦æ˜¯å¯¹ç³»ç»Ÿä¸­ä¸šåŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œåˆ‡åˆ†åä¸åŒçš„ä¸šåŠ¡æ•°æ®å­˜æ”¾åˆ°ä¸åŒçš„æ•°æ®åº“ã€‚å¯ä»¥å°†è¿™äº›æ•°æ®åº“éƒ¨ç½²åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œé¿å…å•æœºCPUã€å†…å­˜ã€IOç“¶é¢ˆé—®é¢˜ã€‚æ­¤å¤–è¿˜å¯ä»¥ç‹¬ç«‹å¯¹é«˜å¹¶å‘çš„ä¸šåŠ¡è¿›è¡Œæ€§èƒ½å•ç‹¬ä¼˜åŒ–è€Œä¸å½±å“å…¶å®ƒä¸šåŠ¡ã€‚</p>
<h2 id="2-2-æ°´å¹³æ‹†åˆ†"><a href="#2-2-æ°´å¹³æ‹†åˆ†" class="headerlink" title="2.2 æ°´å¹³æ‹†åˆ†"></a>2.2 æ°´å¹³æ‹†åˆ†</h2><h3 id="æ°´å¹³åˆ†è¡¨"><a href="#æ°´å¹³åˆ†è¡¨" class="headerlink" title="æ°´å¹³åˆ†è¡¨"></a>æ°´å¹³åˆ†è¡¨</h3><p>é’ˆå¯¹æ•°æ®é‡å·¨å¤§æ‰“å•è¡¨ï¼ˆæ¯”å¦‚è®¢å•è¡¨ï¼‰æŒ‰ç…§æŸç§è§„åˆ™ï¼ˆå¦‚æ—¶é—´ï¼Œå“ˆå¸Œå–æ¨¡ç­‰ï¼‰ï¼Œå°†æ•°æ®è·¯ç”±åˆ°ä¸åŒçš„åˆ†è¡¨ä¸­ã€‚ä½†æ˜¯è¿™äº›åˆ†è¡¨ä»å¤„äºä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œå•åº“å…·æœ‰IOç“¶é¢ˆé—®é¢˜ã€‚</p>
<h3 id="æ°´å¹³åˆ†åº“åˆ†è¡¨"><a href="#æ°´å¹³åˆ†åº“åˆ†è¡¨" class="headerlink" title="æ°´å¹³åˆ†åº“åˆ†è¡¨"></a>æ°´å¹³åˆ†åº“åˆ†è¡¨</h3><p>å•ç‹¬çš„æ°´å¹³åˆ†è¡¨ä¼šé‡åˆ°å•æœºæ•°æ®åº“æ€§èƒ½ç“¶é¢ˆåŠå‹åŠ›ï¼Œå¦‚IOã€è¿æ¥æ•°ç­‰ç¡¬ä»¶èµ„æºçš„é™åˆ¶ã€‚å¯ä»¥å°†å•è¡¨æ•°æ®æŒ‰åˆ†è¡¨è§„åˆ™å…ˆè·¯ç”±åˆ°ä¸åŒçš„æ•°æ®åº“ï¼Œç„¶åå†è·¯ç”±æ•°æ®åº“å†…çš„ä¸åŒåˆ†è¡¨ä¹‹ä¸­ã€‚æ°´å¹³åˆ†åº“åˆ†è¡¨èƒ½å¤Ÿæœ‰æ•ˆçš„ç¼“è§£å•æœºå’Œå•åº“çš„æ€§èƒ½ç“¶é¢ˆå’Œå‹åŠ›ï¼Œçªç ´IOã€è¿æ¥æ•°ã€ç¡¬ä»¶èµ„æºç­‰çš„ç“¶é¢ˆã€‚</p>
<h2 id="2-3-æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™"><a href="#2-3-æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™" class="headerlink" title="2.3 æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™"></a>2.3 æ°´å¹³åˆ†åº“åˆ†è¡¨åˆ‡åˆ†è§„åˆ™</h2><h3 id="RANGE"><a href="#RANGE" class="headerlink" title="RANGE"></a>RANGE</h3><p>ä»0åˆ°1000ä¸‡ä¸€ä¸ªè¡¨ï¼Œ1000ä¸‡åˆ°2000ä¸‡ä¸€ä¸ªè¡¨ï¼›</p>
<h3 id="HASHå–æ¨¡"><a href="#HASHå–æ¨¡" class="headerlink" title="HASHå–æ¨¡"></a>HASHå–æ¨¡</h3><ul>
<li>æŒ‰ç”¨æˆ·IDå“ˆå¸Œå–æ¨¡ï¼ˆé¿å…åˆ†åº“äº‹åŠ¡ï¼Œä½†æ•°æ®å¯èƒ½ä¼šåˆ†å¸ƒä¸å‡åŒ€ï¼‰</li>
<li>æŒ‰è®¢å•IDå“ˆå¸Œå–æ¨¡ï¼ˆæ•°æ®åˆ†å¸ƒè¾ƒå‡åŒ€ï¼Œä¼šæœ‰åˆ†åº“äº‹åŠ¡é—®é¢˜ï¼‰</li>
</ul>
<h3 id="åŒºåŸŸ"><a href="#åŒºåŸŸ" class="headerlink" title="åŒºåŸŸ"></a>åŒºåŸŸ</h3><p>æ¯”å¦‚æŒ‰ç…§åä¸œï¼Œåå—ï¼ŒååŒ—è¿™æ ·æ¥åŒºåˆ†ä¸šåŠ¡ï¼Œä¸ƒç‰›äº‘åº”è¯¥å°±æ˜¯å¦‚æ­¤ã€‚</p>
<h3 id="æ—¶é—´"><a href="#æ—¶é—´" class="headerlink" title="æ—¶é—´"></a>æ—¶é—´</h3><p>æŒ‰ç…§æ—¶é—´åˆ‡åˆ†ï¼Œå°±æ˜¯å°†6ä¸ªæœˆå‰ï¼Œç”šè‡³ä¸€å¹´å‰çš„æ•°æ®åˆ‡å‡ºå»æ”¾åˆ°å¦å¤–çš„ä¸€å¼ è¡¨ï¼Œå› ä¸ºéšç€æ—¶é—´æµé€ï¼Œè¿™äº›è¡¨çš„æ•°æ® è¢«æŸ¥è¯¢çš„æ¦‚ç‡å˜å°ï¼Œæ‰€ä»¥æ²¡å¿…è¦å’Œâ€œçƒ­æ•°æ®â€æ”¾åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªä¹Ÿæ˜¯â€œå†·çƒ­æ•°æ®åˆ†ç¦»â€ã€‚</p>
<h1 id="ä¸‰ã€åˆ†åº“åˆ†è¡¨é¢ä¸´çš„é—®é¢˜"><a href="#ä¸‰ã€åˆ†åº“åˆ†è¡¨é¢ä¸´çš„é—®é¢˜" class="headerlink" title="ä¸‰ã€åˆ†åº“åˆ†è¡¨é¢ä¸´çš„é—®é¢˜"></a>ä¸‰ã€åˆ†åº“åˆ†è¡¨é¢ä¸´çš„é—®é¢˜</h1><ul>
<li><p>äº‹åŠ¡æ”¯æŒ<br>åˆ†åº“åˆ†è¡¨åï¼Œå°±æˆäº†åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚å¦‚æœä¾èµ–æ•°æ®åº“æœ¬èº«çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†åŠŸèƒ½å»æ‰§è¡Œäº‹åŠ¡ï¼Œå°†ä»˜å‡ºé«˜æ˜‚çš„æ€§èƒ½ä»£ä»·ï¼› å¦‚æœç”±åº”ç”¨ç¨‹åºå»ååŠ©æ§åˆ¶ï¼Œå½¢æˆç¨‹åºé€»è¾‘ä¸Šçš„äº‹åŠ¡ï¼Œåˆä¼šé€ æˆç¼–ç¨‹æ–¹é¢çš„è´Ÿæ‹…ã€‚</p>
</li>
<li><p>å¤šåº“ç»“æœé›†åˆå¹¶</p>
</li>
<li><p>è·¨åº“joinè¿æ¥æŸ¥è¯¢<br>åˆ†åº“åˆ†è¡¨åè¡¨ä¹‹é—´çš„å…³è”æ“ä½œå°†å—åˆ°é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•joinä½äºä¸åŒåˆ†åº“çš„è¡¨ï¼Œä¹Ÿæ— æ³•joinåˆ†è¡¨ç²’åº¦ä¸åŒçš„è¡¨ï¼Œ ç»“æœåŸæœ¬ä¸€æ¬¡æŸ¥è¯¢èƒ½å¤Ÿå®Œæˆçš„ä¸šåŠ¡ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡æŸ¥è¯¢æ‰èƒ½å®Œæˆã€‚ ç²—ç•¥çš„è§£å†³æ–¹æ³•ï¼š å…¨å±€è¡¨ï¼šåŸºç¡€æ•°æ®ï¼Œæ‰€æœ‰åº“éƒ½æ‹·è´ä¸€ä»½ã€‚ å­—æ®µå†—ä½™ï¼šè¿™æ ·æœ‰äº›å­—æ®µå°±ä¸ç”¨joinå»æŸ¥è¯¢äº†ã€‚ ç³»ç»Ÿå±‚ç»„è£…ï¼šåˆ†åˆ«æŸ¥è¯¢å‡ºæ‰€æœ‰ï¼Œç„¶åç»„è£…èµ·æ¥ï¼Œè¾ƒå¤æ‚ã€‚</p>
</li>
</ul>
<h1 id="å››ã€åˆ†åº“åˆ†è¡¨äº§å“"><a href="#å››ã€åˆ†åº“åˆ†è¡¨äº§å“" class="headerlink" title="å››ã€åˆ†åº“åˆ†è¡¨äº§å“"></a>å››ã€åˆ†åº“åˆ†è¡¨äº§å“</h1><p><img src="/2021/03/04/mysql/fen-ku-fen-biao-she-ji-fang-an/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%BA%A7%E5%93%81.jpg" alt="åˆ†åº“åˆ†è¡¨è®¾è®¡æ–¹æ¡ˆ"><br>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/fly910905/article/details/87101059">åˆ†åº“åˆ†è¡¨ï¼šä¸­é—´ä»¶æ–¹æ¡ˆå¯¹æ¯”</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ†åº“åˆ†è¡¨å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯å‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œåˆ†åº“åˆ†è¡¨è®¾è®¡æ—¶éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯åŠèµ„æºç¯å¢ƒå»å……åˆ†è€ƒè™‘ã€‚</p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>åˆ†åº“åˆ†è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxä»£ç†é…ç½®ä¸­çš„DNSç¼“å­˜é—®é¢˜</title>
    <url>/2020/08/04/nginx/nginx-dai-li-pei-zhi-zhong-de-dns-huan-cun-wen-ti/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>å®¢æˆ·å†…ç½‘ç¯å¢ƒä¸å…è®¸åº”ç”¨æœåŠ¡å™¨ç›´æ¥è®¿é—®å¤–ç½‘ï¼Œå¿…é¡»é€šè¿‡è·³æ¿æœºè®¿é—®å¤–ç½‘ï¼Œæ‰€åœ¨ä½¿ç”¨Nginxä»£ç†è®¿é—®å¤–ç½‘ï¼Œéƒ¨ç½²æ¶æ„å›¾å¯å‚è€ƒ<a href="https://www.mpoom.cn/2020/07/31/Nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86HTTP%E7%9A%84header%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98/">Nginxåå‘ä»£ç†HTTP headerè‡ªå®šä¹‰å‚æ•°ä¸¢å¤±é—®é¢˜</a>ã€‚<br>åœ¨éƒ¨ç½²å®Œæˆåï¼Œæµ‹è¯•ä»£ç†æ¥å£éƒ½æ­£å¸¸ï¼Œä½†æ˜¯ä¸€æ®µæ—¶é—´è¿‡åï¼Œå°±å‡ºç°äº†å¤–ç½‘æ¥å£è®¿é—®è¶…æ—¶çš„é—®é¢˜ã€‚</p>
<h1 id="äºŒã€é—®é¢˜æ’æŸ¥"><a href="#äºŒã€é—®é¢˜æ’æŸ¥" class="headerlink" title="äºŒã€é—®é¢˜æ’æŸ¥"></a>äºŒã€é—®é¢˜æ’æŸ¥</h1><p>Nginxä»£ç†çš„å¤–ç½‘æ¥å£éƒ½æ˜¯é€šè¿‡åŸŸåè¿›è¡Œè®¿é—®ï¼Œå‘ç°è¯·æ±‚è¶…æ—¶åï¼Œç›´æ¥åœ¨æœåŠ¡å™¨ä¸Špingè¯·æ±‚åœ°å€ä¸­çš„åŸŸåï¼Œå‘ç°åŸŸåæ˜¯å¯ä»¥pingé€šçš„ï¼Œåé¢ç»§ç»­è§‚å¯Ÿè¯·æ±‚è¶…æ—¶çš„æƒ…å†µï¼Œå‘ç°æ¯æ¬¡å‡ºç°è¯·æ±‚è¶…æ—¶æ—¶ï¼Œåœ¨æœåŠ¡å™¨éƒ½æ˜¯èƒ½ç›´æ¥pingé€šè¯·æ±‚ä¸­çš„åŸŸåï¼Œä½†æ˜¯æœåŠ¡å™¨æ¯æ¬¡pingå‘½ä»¤è§£æåçš„IPä¸ä¸Šä¸€æ¬¡ä¸åŒï¼Œåœ¨æœåŠ¡å™¨åˆ™æ— æ³•pingé€šä¸Šæ¬¡è§£æåçš„IPï¼Œæ‰€ä»¥æ€€ç–‘æ˜¯ä¸æ˜¯Nginxç¼“å­˜äº†DNSè§£æã€‚é€šè¿‡æŸ¥é˜…æ–‡æ¡£ï¼Œå‘ç°Nginxåœ¨å¯åŠ¨æ—¶ä¼šæ£€æŸ¥åŸŸåæ˜¯å¦èƒ½å¤Ÿè§£æï¼Œåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ä¼šç¼“å­˜DNSè§£æè®°å½•ï¼Œå¹¶ä¸”å¿½ç•¥äº†DNSä¸­çš„TTLå€¼æ°¸ä¹…ç¼“å­˜ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨Nginxè¿›è¡Œåå‘ä»£ç†æ—¶ï¼Œå¦‚æœé…ç½®çš„æ˜¯åŸŸåï¼Œçªç„¶å‡ºç°äº†404é—®é¢˜æ—¶ï¼Œå¯ä»¥æŸ¥çœ‹åŸŸåç»‘å®šçš„IPæ˜¯å¦å‘ç”Ÿäº†å˜æ›´ï¼Œå¦‚æœè¿™ç§å˜æ›´ä¸é¢‘ç¹ï¼Œå¯ä»¥é‡å¯Nginxè§£å†³ï¼Œé‡å¯NginxååŸŸåä¼šé‡æ–°è¿›è¡Œè§£æã€‚</p>
</blockquote>
<h1 id="ä¸‰ã€é—®é¢˜åˆ†æä¸è§£å†³"><a href="#ä¸‰ã€é—®é¢˜åˆ†æä¸è§£å†³" class="headerlink" title="ä¸‰ã€é—®é¢˜åˆ†æä¸è§£å†³"></a>ä¸‰ã€é—®é¢˜åˆ†æä¸è§£å†³</h1><p>å¤–ç½‘æ¥å£ä¸­çš„åŸŸåæ˜¯åŠ¨æ€è§£æçš„ï¼Œä¸åŒæ—¶é—´è®¿é—®æ—¶åŸŸåè§£æåçš„IPæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå®¢æˆ·å†…ç½‘ç¯å¢ƒåªèƒ½è®¿é—®åŸŸåå®æ—¶è§£æåçš„IPåœ°å€ï¼ˆå¤–ç½‘ç¯å¢ƒéªŒè¯è¿‡æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œä¸Šæ¬¡è§£æåçš„IPä¼šæœ‰æ— æ³•è®¿é—®çš„æƒ…å†µã€‚åˆšå¼€å§‹å‘ç°è¯·æ±‚è¶…æ—¶åï¼Œé‡å¯Nginxå³å¯è§£å†³è¶…æ—¶é—®é¢˜ï¼Œä½†è¿™åªèƒ½ä½œä¸ºä¸´æ—¶çš„è§£å†³æ–¹æ³•ã€‚</p>
<p>é€šè¿‡æŸ¥é˜…æ–‡æ¡£å¾—çŸ¥ï¼Œnginxæä¾›äº†<code>resolver</code>é…ç½®é¡¹ï¼Œå¯ä»¥è®¾ç½®åŸŸåè§£ææœåŠ¡å™¨ï¼Œå¹¶è®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæœŸï¼š</p>
<p>Nginxæ–‡æ¡£åœ°å€ï¼š<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#resolver">http://nginx.org/en/docs/http/ngx_http_core_module.html#resolver</a></p>
<pre class="line-numbers language-none"><code class="language-none">Syntax:	resolver address ... [valid&#x3D;time] [ipv6&#x3D;on|off] [status_zone&#x3D;zone];
Default:	â€”
Context:	http, server, location
Configures name servers used to resolve names of upstream servers into addresses, for example:

resolver 127.0.0.1 [::1]:5353;
The address can be specified as a domain name or IP address, with an optional port (1.3.1, 1.2.2). If port is not specified, the port 53 is used. Name servers are queried in a round-robin fashion.

Before version 1.1.7, only a single name server could be configured. Specifying name servers using IPv6 addresses is supported starting from versions 1.3.1 and 1.2.2.
By default, nginx will look up both IPv4 and IPv6 addresses while resolving. If looking up of IPv6 addresses is not desired, the ipv6&#x3D;off parameter can be specified.

Resolving of names into IPv6 addresses is supported starting from version 1.5.8.
By default, nginx caches answers using the TTL value of a response. An optional valid parameter allows overriding it:

resolver 127.0.0.1 [::1]:5353 valid&#x3D;30s;
Before version 1.1.9, tuning of caching time was not possible, and nginx always cached answers for the duration of 5 minutes.
To prevent DNS spoofing, it is recommended configuring DNS servers in a properly secured trusted local network.
The optional status_zone parameter (1.17.1) enables collection of DNS server statistics of requests and responses in the specified zone. The parameter is available as part of our commercial subscription.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       9000;
    server_name  localhost;
    resolver 114.114.114.114 valid&#x3D;60s;

    location &#x2F;ncs&#x2F;mobile&#x2F;phone-verify &#123;
        set $mobile www.cmpassport.com;
        proxy_pass https:&#x2F;&#x2F;$mobile&#x2F;openapi&#x2F;rs&#x2F;tokenValidate;
        proxy_read_timeout 300;
        proxy_connect_timeout 300;
        proxy_redirect off;
    
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>æ³¨æ„ï¼šéœ€è¦å°†ä»£ç†çš„åŸŸåè®¾ç½®ä¸ºå˜é‡ï¼Œå¦åˆ™åŸŸåæ— æ³•åŠ¨æ€è§£æ</p>
</blockquote>
<h1 id="å››ã€éªŒè¯"><a href="#å››ã€éªŒè¯" class="headerlink" title="å››ã€éªŒè¯"></a>å››ã€éªŒè¯</h1><p>ä¸Šè¿°é…ç½®ä¸­æˆ‘ä»¬è®¾ç½®DNSè§£æç¼“å­˜æ—¶é—´ä¸º60sï¼Œé€šè¿‡tcpdumpæŠ“å–è¯·æ±‚114.114.114.114 DNSæœåŠ¡å™¨çš„åŒ…ï¼Œåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ¯é—´éš”ä¸€åˆ†é’ŸNginxå°±ä¼šå»é‡æ–°è¯·æ±‚DNSæœåŠ¡å™¨ï¼Œé—®é¢˜è§£å†³ã€‚</p>
<p><img src="/2020/08/04/nginx/nginx-dai-li-pei-zhi-zhong-de-dns-huan-cun-wen-ti/dns%E8%A7%A3%E6%9E%90.jpg" alt="DNSè§£ææŠ“åŒ…"></p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>åå‘ä»£ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxåå‘ä»£ç†404é—®é¢˜</title>
    <url>/2020/07/13/nginx/nginx-fan-xiang-dai-li-404-wen-ti/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>   åœ¨æµ‹è¯•webåº”ç”¨çš„æ—¶å€™ï¼Œå‰ç«¯éœ€è¦è¿›è¡Œè·¨åŸŸè®¿é—®åç«¯æ¥å£ï¼Œç”±äºæœåŠ¡ç«¯è·¨åŸŸè®¿é—®åŠŸèƒ½ä¸å®Œå–„ï¼Œæ‰€ä»¥æ‰“ç®—é€šè¿‡åå‘ä»£ç†ä¸´æ—¶è§£å†³è·¨åŸŸé—®é¢˜ï¼Œä½†æ˜¯åå‘ä»£ç†é…ç½®æˆåŠŸåï¼Œè®¿é—®æ—¶æµè§ˆå™¨ç«¯è¿”å›404ï¼Œåœ¨nginxçš„è®¿é—®æ—¥å¿—ä¸­ä¹Ÿæç¤º404ï¼ŒNginxé…ç½®å¦‚ä¸‹ã€‚</p>
<h2 id="1-1-Nginxåå‘ä»£ç†é…ç½®"><a href="#1-1-Nginxåå‘ä»£ç†é…ç½®" class="headerlink" title="1.1 Nginxåå‘ä»£ç†é…ç½®"></a>1.1 Nginxåå‘ä»£ç†é…ç½®</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">&#123;</span>
    listen     <span class="token number">80</span><span class="token punctuation">;</span>
    server_name h5-verify.mpoom.cn<span class="token punctuation">;</span>
    location / <span class="token punctuation">&#123;</span>
        proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>

        proxy_pass http://127.0.0.1:8000<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

server <span class="token punctuation">&#123;</span>
    listen       <span class="token number">8000</span><span class="token punctuation">;</span>
    server_name  <span class="token number">127.0</span>.0.1 localhost<span class="token punctuation">;</span>

    <span class="token builtin class-name">set</span> <span class="token variable">$root_path</span> <span class="token string">"/home/ytx/jiyan-h5"</span><span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>

    location / <span class="token punctuation">&#123;</span>
        root   <span class="token variable">$root_path</span><span class="token punctuation">;</span>
        index  index.html index.htm<span class="token punctuation">;</span>
        try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    location /ytx-api/ <span class="token punctuation">&#123;</span>
        proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>

        proxy_buffering off<span class="token punctuation">;</span>
        proxy_connect_timeout 300s<span class="token punctuation">;</span>
        proxy_send_timeout 300s<span class="token punctuation">;</span>
        proxy_read_timeout 300s<span class="token punctuation">;</span>
        client_max_body_size 100M<span class="token punctuation">;</span>

        proxy_pass  https://www.139130.com<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-2-æµè§ˆå™¨è¯·æ±‚åŠå“åº”"><a href="#1-2-æµè§ˆå™¨è¯·æ±‚åŠå“åº”" class="headerlink" title="1.2 æµè§ˆå™¨è¯·æ±‚åŠå“åº”"></a>1.2 æµè§ˆå™¨è¯·æ±‚åŠå“åº”</h2><p>ï¼ˆ1ï¼‰headers</p>
<p>General</p>
<blockquote>
<p>Request URL: <a href="http://h5-verify.mpoom.cn/ytx-api/v1.0.0/phone/carrier-info">http://h5-verify.mpoom.cn/ytx-api/v1.0.0/phone/carrier-info</a><br>Request Method: GET<br>Status Code: 404 Not Found<br>Remote Address: 106.54.197.193:80<br>Referrer Policy: no-referrer-when-downgrade</p>
</blockquote>
<p>Response Headers</p>
<blockquote>
<p>Connection: keep-alive<br>Content-Length: 315<br>Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1<br>Date: Mon, 13 Jul 2020 09:24:37 GMT<br>Server: nginx&#x2F;1.9.9</p>
</blockquote>
<p>Request Headers</p>
<blockquote>
<p>Accept: <em>&#x2F;</em><br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q&#x3D;0.9<br>Cache-Control: no-cache<br>Connection: keep-alive<br>Content-Type: application&#x2F;json;charset&#x3D;UTF-8<br>Host: h5-verify.mpoom.cn<br>Pragma: no-cache<br>Referer: <a href="http://h5-verify.mpoom.cn/phone-verify">http://h5-verify.mpoom.cn/phone-verify</a><br>User-Agent: Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;83.0.4103.116 Safari&#x2F;537.36</p>
</blockquote>
<p>(2)preview</p>
<pre class="line-numbers language-none"><code class="language-none">Not Found
The requested URL &#x2F;ytx-api&#x2F;v1.0.0&#x2F;phone&#x2F;carrier-info was not found on this server.

Apache&#x2F;2.2.15 (CentOS) Server at h5-verify.mpoom.cn Port 80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-3-Nginx-access-logæ—¥å¿—"><a href="#1-3-Nginx-access-logæ—¥å¿—" class="headerlink" title="1.3 Nginx access.logæ—¥å¿—"></a>1.3 Nginx access.logæ—¥å¿—</h2><pre class="line-numbers language-none"><code class="language-none">127.0.0.1 - - [13&#x2F;Jul&#x2F;2020:17:32:33 +0800] &quot;GET &#x2F;ytx-api&#x2F;v1.0.0&#x2F;phone&#x2F;carrier-info HTTP&#x2F;1.0&quot; 404 315 &quot;http:&#x2F;&#x2F;h5-verify.mpoom.cn&#x2F;phone-verify&quot; &quot;Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;83.0.4103.116 Safari&#x2F;537.36&quot; &quot;183.238.58.120&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="äºŒã€é—®é¢˜åŸå› "><a href="#äºŒã€é—®é¢˜åŸå› " class="headerlink" title="äºŒã€é—®é¢˜åŸå› "></a>äºŒã€é—®é¢˜åŸå› </h1><p>åœ¨æœåŠ¡å™¨ä¸Šæœ‰ç±»ä¼¼åå‘ä»£ç†é…ç½®ï¼Œä½†éƒ½æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ï¼Œå”¯ä¸€ä¸ä¸Šè¿°é…ç½®æœ‰åŒºåˆ«çš„æ˜¯ï¼Œèƒ½æ­£å¸¸è®¿é—®çš„è¢«åå‘ä»£ç†çš„åº”ç”¨å’ŒNginxéƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ï¼Œè€Œä¸Šè¿°è¢«åå‘ä»£ç†çš„åº”ç”¨éƒ¨ç½²åœ¨ä¸€å°å…¬ç½‘æœåŠ¡å™¨ã€‚<br>è¯¥é—®çš„ä¸»è¦åŸå› åœ¨äºé…ç½®åå‘ä»£ç†æ—¶<code>proxy_set_header Host</code>çš„é…ç½®.</p>
<h2 id="2-1-Hostå®šä¹‰"><a href="#2-1-Hostå®šä¹‰" class="headerlink" title="2.1 Hostå®šä¹‰"></a>2.1 Hostå®šä¹‰</h2><blockquote>
<p>Host è¯·æ±‚å¤´æŒ‡æ˜äº†è¯·æ±‚å°†è¦å‘é€åˆ°çš„æœåŠ¡å™¨ä¸»æœºåå’Œç«¯å£å·ã€‚<br>ç»„æˆï¼šåŸŸå+ç«¯å£å·<br>ä¾‹å­ï¼štest.com:1998<br>å¦‚æœæ²¡æœ‰åŒ…å«ç«¯å£å·ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨è¢«è¯·æ±‚æœåŠ¡çš„é»˜è®¤ç«¯å£ï¼ˆæ¯”å¦‚HTTPS URLä½¿ç”¨443ç«¯å£ï¼ŒHTTP URLä½¿ç”¨80ç«¯å£ï¼‰<br>æ‰€æœ‰HTTP&#x2F;1.1 è¯·æ±‚æŠ¥æ–‡ä¸­å¿…é¡»åŒ…å«ä¸€ä¸ªHostå¤´å­—æ®µã€‚å¯¹äºç¼ºå°‘Hostå¤´æˆ–è€…å«æœ‰è¶…è¿‡ä¸€ä¸ªHostå¤´çš„HTTP&#x2F;1.1 è¯·æ±‚ï¼Œå¯èƒ½ä¼šæ”¶åˆ°400ï¼ˆBad Requestï¼‰çŠ¶æ€ç ã€‚</p>
</blockquote>
<p><strong>http1.1ä¸­ä¸èƒ½ç¼ºå¤±hostå­—æ®µï¼Œä½†hostå­—æ®µå¯ä»¥æ˜¯ç©ºå€¼</strong><br>ä¸Šè¿°é—®é¢˜æ˜¯ç”±äºwebå‰ç«¯ä½¿ç”¨äºŒçº§åŸŸå<code>h5-verify.mpoom.cn</code>å»è®¿é—®ï¼Œè¢«åå‘ä»£ç†çš„åº”ç”¨æ¥å£éƒ¨ç½²åœ¨å¦å¤–ä¸€å°æœåŠ¡å™¨å¹¶ä¸”ä½¿ç”¨äº†<code>www.139130.com</code>åŸŸåè¿›è¡Œè®¿é—®ï¼Œä¸Šè¿°åå‘ä»£ç†é…ç½®å°†Hostè®¾ç½®ä¸ºäº†<code>h5-verify.mpoom.cn</code>ï¼Œå»è®¿é—®è¿œç¨‹åº”ç”¨æ¥å£æ—¶æœåŠ¡å™¨æ—¶æ— æ³•è§£æ<code>h5-verify.mpoom.cn</code>è¿”å›404ã€‚</p>
<h1 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h1><blockquote>
<p>ï¼ˆ1ï¼‰è§£å†³æ–¹æ³•ä¸€<br>ä¿®æ”¹åå‘ä»£ç†ä¸­çš„Hosté…ç½®</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">proxy_set_header Host &quot;www.139130.com&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>ï¼ˆ2ï¼‰è§£å†³æ–¹æ³•äºŒ<br>æ³¨é‡Šæ‰nginxé…ç½®æ–‡ä»¶ä¸­çš„Hosté…ç½®</p>
</blockquote>
<blockquote>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
</blockquote>
<p><a href="https://zh.wikipedia.org/zh-hans/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5">https://zh.wikipedia.org/zh-hans/HTTP%E5%A4%B4%E5%AD%97%E6%AE%B5</a><br><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23">https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Host">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Host</a></p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>åå‘ä»£ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxç¦»çº¿å®‰è£…</title>
    <url>/2020/05/24/nginx/nginx-chi-xian-an-zhuang/</url>
    <content><![CDATA[<h1 id="ä¸€ã€æ¦‚è§ˆ"><a href="#ä¸€ã€æ¦‚è§ˆ" class="headerlink" title="ä¸€ã€æ¦‚è§ˆ"></a>ä¸€ã€æ¦‚è§ˆ</h1><blockquote>
<p>æœåŠ¡å™¨æ— æ³•è®¿é—®å¤–ç½‘çš„æƒ…å†µä¸‹ï¼ŒNginxåªèƒ½ç¦»çº¿å®‰è£…ï¼Œå®‰è£…ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
</blockquote>
<ul>
<li>å®‰è£…gccã€g++</li>
<li>å®‰è£…pcreã€zlib</li>
<li>å®‰è£…nginx</li>
</ul>
<h1 id="äºŒã€å®‰è£…gccã€g"><a href="#äºŒã€å®‰è£…gccã€g" class="headerlink" title="äºŒã€å®‰è£…gccã€g++"></a>äºŒã€å®‰è£…gccã€g++</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gcc <span class="token parameter variable">--version</span>
g++ <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨<code>gcc --version</code> <code>g++ --version</code>æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦å·²ç»å®‰è£…è¿‡<strong>gcc</strong>ã€<strong>g++</strong>ã€‚</p>
<h3 id="2-1-ä¸‹è½½"><a href="#2-1-ä¸‹è½½" class="headerlink" title="2.1 ä¸‹è½½"></a>2.1 ä¸‹è½½</h3><p>å¦‚æœæœªå®‰è£…ï¼Œè¯·ä¸‹è½½<strong>gcc</strong>ã€**g++**åŠå…¶ä¾èµ–åŒ…è¿›è¡Œå®‰è£…ï¼Œä¸‹é¢ä¸ºCentos7 x86_64ä¸‹ <strong>gcc</strong> ä¸ **g++ ** 4.8.5çš„ä¾èµ–åŒ…:</p>
<blockquote>
<p>gccä¾èµ–åŒ…è¯¦è§:<a href="https://centos.pkgs.org/7/centos-x86_64/gcc-4.8.5-39.el7.x86_64.rpm.html">gcc-4.8.5-39.el7.x86_64.rpm</a> </p>
</blockquote>
<p><img src="/2020/05/24/nginx/nginx-chi-xian-an-zhuang/gcc-requires.png" alt="gcc ä¾èµ–åŒ…"></p>
<blockquote>
<p>g++ä¾èµ–åŒ…è¯¦è§ï¼š<a href="https://centos.pkgs.org/7/centos-x86_64/gcc-c++-4.8.5-39.el7.x86_64.rpm.html">gcc-c++-4.8.5-39.el7.x86_64.rpm</a></p>
</blockquote>
<p><img src="/2020/05/24/nginx/nginx-chi-xian-an-zhuang/g++_requires.png" alt="g++ ä¾èµ–åŒ…"></p>
<p>æ ¹æ®ä¸Šè¿°ä¾èµ–åŒ…åˆ—è¡¨ä¸‹è½½å®‰è£…åŒ…ï¼Œä¸‹è½½åœ°å€ï¼š<a href="http://mirror.centos.org/centos/7/os/x86_64/Packages/">Centos Mirrors</a> ã€ <a href="http://mirrors.aliyun.com/centos/7/os/x86_64/Packages/">é˜¿é‡Œäº‘</a> ã€<a href="http://mirrors.163.com/centos/6/os/x86_64/Packages/">ç½‘æ˜“</a>,ä¸‹è½½åçš„ä¾èµ–åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2020/05/24/nginx/nginx-chi-xian-an-zhuang/gcc_g++_rpm%E5%AE%89%E8%A3%85%E5%8C%85.png" alt="gcc  g++ rpmå®‰è£…åŒ…"></p>
<p>ä¸Šè¿°å®‰è£…åŒ…å·²åˆ†äº«è‡³å¤©ç¿¼äº‘ç›˜<a href="https://cloud.189.cn/t/2M7vuyra6vM3">gcc g++ rpmå®‰è£…åŒ…</a></p>
<blockquote>
<p><em><strong>æ³¨æ„</strong></em></p>
<p><em>ä¸Šå›¾ä¸‹è½½çš„ä¾èµ–åŒ…æœ‰ä¸€äº›æ˜¯<code>gcc</code> <code>g++</code>ä¾èµ–åŒ…åˆ—è¡¨ä¸­ä¸å­˜åœ¨çš„ï¼Œæ˜¯å› ä¸ºé‚£éƒ¨åˆ†å®‰è£…åŒ…æ˜¯<code>gcc</code> <code>g++</code> ä¾èµ–åŒ…çš„ä¾èµ–åŒ…ï¼Œè¿™é‡Œå‚è€ƒç½‘ä¸Šä¸‹è½½äº†ç¼ºå°‘çš„ä¸€äº›åŒ…</em></p>
</blockquote>
<h3 id="2-2-å®‰è£…"><a href="#2-2-å®‰è£…" class="headerlink" title="2.2 å®‰è£…"></a>2.2 å®‰è£…</h3><p>è¿›å…¥å®‰è£…åŒ…ä¸‹è½½è·¯å¾„</p>
<pre class="line-numbers language-none"><code class="language-none">rpm  -ivh  *.rpm --nodeps --force<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>â€“nodeps: do not verify package dependencies</p>
<p>â€“force:  short hand for â€“replacepkgs â€“replacefiles</p>
<p>â€“replacefiles : ignore file conflicts between packages</p>
<p>â€“replacepkgs: reinstall if the package is already present</p>
</blockquote>
<h3 id="2-3-æ£€æŸ¥"><a href="#2-3-æ£€æŸ¥" class="headerlink" title="2.3 æ£€æŸ¥"></a>2.3 æ£€æŸ¥</h3><p>æ‰§è¡Œ<code>gcc --version</code> ã€<code>g++ version</code>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<h1 id="ä¸‰ã€å®‰è£…pcreã€zlib"><a href="#ä¸‰ã€å®‰è£…pcreã€zlib" class="headerlink" title="ä¸‰ã€å®‰è£…pcreã€zlib"></a>ä¸‰ã€å®‰è£…pcreã€zlib</h1><p>Nginxçš„gzipæ¨¡å—éœ€è¦zlibåº“ï¼Œrewriteæ¨¡å—éœ€è¦pcreåº“ï¼Œsslæ¨¡å—éœ€è¦opensslåº“.</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="http://mirror.centos.org/centos/7/os/x86_64/Packages/">http://mirror.centos.org/centos/7/os/x86_64&#x2F;Packages&#x2F;</a></p>
<h2 id="3-1-å®‰è£…pcre"><a href="#3-1-å®‰è£…pcre" class="headerlink" title="3.1 å®‰è£…pcre"></a>3.1 å®‰è£…pcre</h2><p>æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²ç»å®‰è£…äº†<code>pcre</code>ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> pcre<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¸‹è½½åœ°å€ï¼š<a href="http://mirror.centos.org/centos/7/os/x86_64/Packages/pcre-8.32-17.el7.x86_64.rpm">http://mirror.centos.org/centos/7/os/x86_64&#x2F;Packages&#x2F;pcre-8.32-17.el7.x86_64.rpm</a></p>
<pre class="line-numbers language-none"><code class="language-none">rpm -ivh pcre-8.32-17.el7.x86_64.rpm --force<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿›å…¥æ–‡ä»¶å­˜æ”¾è·¯å¾„æ‰§è¡Œä¸Šè¿°å‘½ä»¤å®‰è£…ï¼Œæœ€åæ‰§è¡Œ<code>rpm -q pcre</code>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<h2 id="3-2-å®‰è£…zlib"><a href="#3-2-å®‰è£…zlib" class="headerlink" title="3.2 å®‰è£…zlib"></a>3.2 å®‰è£…zlib</h2><p>æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å·²ç»å®‰è£…<code>zlib</code></p>
<pre class="line-numbers language-none"><code class="language-none">rpm -q zlib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¸‹è½½åœ°å€ï¼š<a href="http://mirror.centos.org/centos/7/os/x86_64/Packages/zlib-1.2.7-18.el7.x86_64.rpm">http://mirror.centos.org/centos/7/os/x86_64&#x2F;Packages&#x2F;zlib-1.2.7-18.el7.x86_64.rpm</a></p>
<pre class="line-numbers language-none"><code class="language-none">rpm -ivh zlib-1.2.7-18.el7.x86_64.rpm --force<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿›å…¥æ–‡ä»¶ä¸‹è½½è·¯å¾„æ‰§è¡Œä¸Šé¢å‘½ä»¤è¿›è¡Œå®‰è£…ï¼Œæœ€åæ‰§è¡Œ<code>rpm -q zlib</code>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<h1 id="å››ã€å®‰è£…Nginx"><a href="#å››ã€å®‰è£…Nginx" class="headerlink" title="å››ã€å®‰è£…Nginx"></a>å››ã€å®‰è£…Nginx</h1><p>ä»<a href="https://nginx.org/">Nginxå®˜ç½‘</a>ä¸‹è½½<strong>Stable version</strong>ï¼Œå½“å‰çš„Stable versionä¸º<code>nginx-1.18.0</code></p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://nginx.org/download/nginx-1.18.0.tar.gz">https://nginx.org/download/nginx-1.18.0.tar.gz</a></p>
<h2 id="3-1-ç¼–è¯‘å®‰è£…"><a href="#3-1-ç¼–è¯‘å®‰è£…" class="headerlink" title="3.1 ç¼–è¯‘å®‰è£…"></a>3.1 ç¼–è¯‘å®‰è£…</h2><pre class="line-numbers language-none"><code class="language-none">tar -zxvf nginx-1.18.0.tar.gz
cd nginx-1.18.0
.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx
make
make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸‹è½½è§£å‹åè¿›å…¥Nginxè§£å‹ç›®å½•è¿›è¡Œç¼–è¯‘å®‰è£…, ä¸Šé¢è®²Nginxå®‰è£…åˆ°äº†&#x2F;usr&#x2F;local&#x2F;nginxç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p>æŸ¥çœ‹Nginxç‰ˆæœ¬</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="3-2-é…ç½®ç¯å¢ƒå˜é‡"><a href="#3-2-é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3.2 é…ç½®ç¯å¢ƒå˜é‡"></a>3.2 é…ç½®ç¯å¢ƒå˜é‡</h2><p>ç¼–è¾‘&#x2F;etc&#x2F;profileæ·»åŠ ä¸‹é¢å†…å®¹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">export NGINX_HOME&#x3D; &#x2F;usr&#x2F;local&#x2F;nginx
export PATH&#x3D;$PATH:$NGINX_HOME&#x2F;sbin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å®Œæˆåæ‰§è¡Œ<code>source /etc/profile</code>,ä¹‹åå°±å¯ä»¥ç›´æ¥æ‰§è¡Œ<code>nginx -v</code>æŸ¥çœ‹Nginxç‰ˆæœ¬ã€‚</p>
<h2 id="3-3-è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#3-3-è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="3.3 è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>3.3 è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h2><p>1ã€åœ¨ç³»ç»ŸæœåŠ¡ç›®å½•é‡Œåˆ›å»ºnginx.serviceæ–‡ä»¶</p>
<pre class="line-numbers language-none"><code class="language-none">vim  &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2ã€åœ¨æ–‡ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</p>
<pre class="line-numbers language-none"><code class="language-none">[Unit]
Description&#x3D;nginx
After&#x3D;network.target
  
[Service]
Type&#x3D;forking
ExecStart&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx
ExecReload&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload
ExecStop&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s quit
PrivateTmp&#x3D;true
  
[Install]
WantedBy&#x3D;multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>Description:æè¿°æœåŠ¡<br>After:æè¿°æœåŠ¡ç±»åˆ«<br>[Service]æœåŠ¡è¿è¡Œå‚æ•°çš„è®¾ç½®<br>Type&#x3D;forkingæ˜¯åå°è¿è¡Œçš„å½¢å¼<br>ExecStartä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤<br>ExecReloadä¸ºé‡å¯å‘½ä»¤<br>ExecStopä¸ºåœæ­¢å‘½ä»¤<br>PrivateTmp&#x3D;Trueè¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´<br>æ³¨æ„ï¼š[Service]çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„<br>[Install]è¿è¡Œçº§åˆ«ä¸‹æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·ï¼Œå³ç³»ç»Ÿè¿è¡Œçº§åˆ«ä¸º3</p>
</blockquote>
<p>3ã€è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p>
<pre class="line-numbers language-none"><code class="language-none">systemctl enable nginx.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è‡³æ­¤Nginxçš„å®‰è£…å·²ç»å®Œæˆäº†ã€‚</p>
<h1 id="äº”ã€ä¸‹è½½"><a href="#äº”ã€ä¸‹è½½" class="headerlink" title="äº”ã€ä¸‹è½½"></a>äº”ã€ä¸‹è½½</h1><blockquote>
<p>Nginxç¦»çº¿å®‰è£…ä¸‹è½½ï¼š</p>
</blockquote>
<p><a href="https://cloud.189.cn/t/2M7vuyra6vM3">gccã€g++å®‰è£…åŒ…</a></p>
<p><a href="https://cloud.189.cn/t/IZNN3yFVZZne">nginxç¦»çº¿å®‰è£…åŒ…</a></p>
<p><em><strong>å‚è€ƒæ–‡ç« </strong></em></p>
<p><em><a href="%5Bhttps://linking.fun/2019/04/20/CentOS7%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Nginx/%5D(https://linking.fun/2019/04/20/CentOS7%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85Nginx/)">CentOS7ç¦»çº¿å®‰è£…Nginx</a></em></p>
<p><em><a href="https://blog.csdn.net/qq_29480353/article/details/80006246">linuxçš„ç¦»çº¿å®‰è£…nginx</a></em></p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxåå‘ä»£ç†HTTP headerè‡ªå®šä¹‰å‚æ•°ä¸¢å¤±é—®é¢˜</title>
    <url>/2020/07/31/nginx/nginx-fan-xiang-dai-li-http-de-header-zi-ding-yi-can-shu-diu-shi-wen-ti/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>å®¢æˆ·å†…ç½‘æœåŠ¡å™¨ä¸èƒ½ç›´æ¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦é€šè¿‡ä¸€å°è·³æ¿æœºæ‰èƒ½è®¿é—®å¤–ç½‘ï¼Œåœ¨è·³æ¿æœºå®‰è£…Nginxåå‘ä»£ç†å¤–ç½‘æ¥å£æœåŠ¡ï¼Œæ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/2020/07/31/nginx/nginx-fan-xiang-dai-li-http-de-header-zi-ding-yi-can-shu-diu-shi-wen-ti/nginx_proxy_pass_architecture_diagram.png" alt="nginxåå‘ä»£ç†ç»“æ„å›¾"><br>ä»£ç†è®¾ç½®å®Œæˆåï¼Œåœ¨è”è°ƒè¿‡ç¨‹ä¸­è¯·æ±‚å¤–ç½‘æ¥å£è¿”å›å‚æ•°é”™è¯¯ï¼Œä½†æ˜¯å¤–ç½‘ç¯å¢ƒä¸‹ä¸ç»è¿‡Nginxä»£ç†ç›´æ¥è®¿é—®å¤–ç½‘æ¥å£åˆ™èƒ½æ­£å¸¸è®¿é—®ï¼Œè¯´æ˜åœ¨ç»è¿‡Nginxä»£ç†æ—¶ï¼Œéƒ¨åˆ†å‚æ•°ä¸¢å¤±äº†ã€‚</p>
<h1 id="äºŒã€é—®é¢˜æ’æŸ¥"><a href="#äºŒã€é—®é¢˜æ’æŸ¥" class="headerlink" title="äºŒã€é—®é¢˜æ’æŸ¥"></a>äºŒã€é—®é¢˜æ’æŸ¥</h1><p>æ ¹æ®æ¥å£æŠ¥é”™ï¼Œå®šä½åˆ°æ˜¯HTTPheaderä¸­çš„ä¸€ä¸ªè‡ªå®šä¹‰å‚æ•°<code>client_id</code>å‚æ•°ç»è¿‡Nginxä»£ç†æ—¶æ²¡æœ‰è½¬å‘å‡ºå»,é—®é¢˜å‡ºç°åœ¨Nginxä»£ç†ä¸Šã€‚</p>
<blockquote>
<p>Nginxä¸»é…ç½®æ–‡ä»¶nginx.confå†…å®¹å¦‚ä¸‹</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">user  root;
worker_processes  1;

error_log  logs&#x2F;error.log;
error_log  logs&#x2F;error.log  notice;
error_log  logs&#x2F;error.log  info;

pid        logs&#x2F;nginx.pid;


events &#123;
    worker_connections  1024;
&#125;


http &#123;
    include       mime.types;
    default_type  application&#x2F;octet-stream;

    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  logs&#x2F;access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  0;
    #keepalive_timeout  65;

    gzip  on;
    include &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;conf.d&#x2F;*.conf;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>Nginxä»£ç†é…ç½®å†…å®¹å¦‚ä¸‹:</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       9000;
    server_name  localhost;
 
    location &#x2F;mobile&#x2F;verify &#123;
        proxy_pass https:&#x2F;&#x2F;www.cmpassport.com&#x2F;openapi&#x2F;rs&#x2F;tokenValidate;
        proxy_read_timeout 60;
        proxy_connect_timeout 60;
        proxy_redirect off;
    
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡æŸ¥é˜…æ–‡æ¡£å¾—çŸ¥ï¼ŒNginxé»˜è®¤ä¼šå¿½ç•¥http headerä¸­å¸¦æœ‰ä¸‹åˆ’çº¿çš„å‚æ•°ï¼š<br><img src="/2020/07/31/nginx/nginx-fan-xiang-dai-li-http-de-header-zi-ding-yi-can-shu-diu-shi-wen-ti/nginx-underscores-syntax.jpg" alt="Nginx Syntax"></p>
<h1 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h1><p>åœ¨nginxé…ç½®æ–‡ä»¶çš„httpæˆ–serveræ¨¡å—è®¾ç½®<code>underscores_in_headers</code>ä¸º<code>on</code>:</p>
<pre class="line-numbers language-none"><code class="language-none">#è¯¥å±æ€§é»˜è®¤ä¸ºoffï¼Œè¡¨ç¤ºå¦‚æœheader nameä¸­åŒ…å«ä¸‹åˆ’çº¿ï¼Œåˆ™å¿½ç•¥æ‰ã€‚
underscores_in_headers on;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ›´æ–°é…ç½®æ–‡ä»¶åé‡å¯Nginxï¼Œé—®é¢˜è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>åå‘ä»£ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>å•åŸŸåå¤šç½‘ç«™Nginxé…ç½®</title>
    <url>/2024/10/20/nginx/dan-yu-ming-duo-wang-zhan-nginx-pei-zhi/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>åœ¨æ­å»ºä¸ªäººåšå®¢æˆ–ç«™ç‚¹æ—¶ï¼Œä¸ºæ–¹ä¾¿ç”¨æˆ·è®°ä½è®¿é—®ç«™ç‚¹ï¼Œæˆ‘ä»¬å¤§å¤šç«™ç‚¹ç®¡ç†è€…ä¼šä½¿ç”¨åŸŸåè¿›è¡Œç½‘ç«™çš„è®¿é—®ã€‚</p>
<h1 id="äºŒã€åŸŸåNginxé…ç½®"><a href="#äºŒã€åŸŸåNginxé…ç½®" class="headerlink" title="äºŒã€åŸŸåNginxé…ç½®"></a>äºŒã€åŸŸåNginxé…ç½®</h1><h2 id="2-1-global-conf"><a href="#2-1-global-conf" class="headerlink" title="2.1 global.conf"></a>2.1 global.conf</h2><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">server &#123;
    listen 443 ssl;
    server_name mpoom.cn;
    #ssl on;
    ssl_certificate  cert&#x2F;mpoom.cn.pem;
    ssl_certificate_key cert&#x2F;mpoom.cn.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    client_max_body_size 100M;

    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:8060;
    &#125;
&#125;

server &#123;
    listen       80;
    server_name  mpoom.cn www.mpoom.cn;
    return 301 https:&#x2F;&#x2F;www.mpoom.cn$request_uri;
&#125;

server &#123;
    listen 443 ssl;
    server_name blog.mpoom.cn;
    ssl_certificate  cert&#x2F;blog.mpoom.cn.pem;
    ssl_certificate_key cert&#x2F;blog.mpoom.cn.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    client_max_body_size 100M;

    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:8060;
    &#125;
&#125;
server &#123;
    listen       80;
    server_name  blog.mpoom.cn;
    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:8060;
    &#125;
&#125;

server &#123;
    listen       80;
    server_name  p.mpoom.cn;
    client_max_body_size 100M;
    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:8090;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-blog-mpoom-conf"><a href="#2-2-blog-mpoom-conf" class="headerlink" title="2.2 blog_mpoom.conf"></a>2.2 blog_mpoom.conf</h2><pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       8060;
    server_name  127.0.0.1 localhost;

    set $root_path &quot;&#x2F;home&#x2F;github&#x2F;hexo-blog&#x2F;public&quot;;

    #charset koi8-r;
    #access_log  &#x2F;home&#x2F;running&#x2F;mpoom&#x2F;nginx-logs&#x2F;blog&#x2F;host.access.log;
    #error_log  &#x2F;home&#x2F;running&#x2F;mpoom&#x2F;nginx-logs&#x2F;blog&#x2F;error.log;

    location &#x2F; &#123;
        root   $root_path;
        index  index.html index.htm;
    &#125;

    #error_page  404              &#x2F;404.html;

    # redirect server error pages to the static page &#x2F;50x.html
    #
    error_page   500 502 503 504  &#x2F;50x.html;
    location &#x3D; &#x2F;50x.html &#123;
        root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;
    &#125;

    # deny access to .htaccess files, if Apache&#39;s document root
    # concurs with nginx&#39;s one
    #
    #location ~ &#x2F;\.ht &#123;
    #    deny  all;
    #&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>åŸŸå, nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxè´Ÿè½½å‡è¡¡å¤±è´¥é‡è¯•</title>
    <url>/2021/04/26/nginx/nginx-fu-zai-jun-heng-shi-bai-chong-shi/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>åœ¨å¯¹ä¸€ä¸ªæ¥å£è¿›è¡Œåå‘ä»£ç†æ—¶ï¼Œnginxæ€»æ˜¯ä¼šæ‰“å°erroræ—¥å¿—ï¼Œä½†æ˜¯è¯·æ±‚æ˜¯æ­£å¸¸çš„ã€‚æ ¹æ®nginxçš„erroræ—¥å¿—ï¼Œå‘ç°æ˜¯è¯·æ±‚åˆ°ipv6åœ°å€å¤±è´¥ï¼Œä½†æ˜¯æœ€ç»ˆçš„ä»£ç†è¯·æ±‚æ˜¯æˆåŠŸçš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹nginxçš„è´Ÿè½½å‡è¡¡åŠå¤±è´¥é‡è¯•æœºåˆ¶ã€‚</p>
<p>nginxé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       9000;
    server_name  localhost;
    #proxy_next_upstream off;
    location &#x2F;ncs&#x2F;telecom&#x2F;phone-verify &#123;
        proxy_pass https:&#x2F;&#x2F;open.e.189.cn&#x2F;auth&#x2F;verifyinfo.do;
        proxy_read_timeout 300;
        proxy_connect_timeout 300;
        proxy_redirect off;
    
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host &#39;open.e.189.cn&#39;;
        proxy_set_header X-Real-IP $remote_addr;
    &#125;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>nginx erroræ—¥å¿—å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">[error] 3587705#0: *3471 connect() to [240e:698:100::2]:443 failed (101: Network is unreachable) while connecting to upstream, client: 127.0.0.1, server: localhost, request: &quot;GET &#x2F;ncs&#x2F;telecom&#x2F;phone-verify HTTP&#x2F;1.1&quot;, upstream: &quot;https:&#x2F;&#x2F;[240e:698:100::2]:443&#x2F;auth&#x2F;verifyinfo.do&quot;, host: &quot;localhost:9000&quot;
[error] 3587705#0: *3471 connect() to [240e:698:100::4]:443 failed (101: Network is unreachable) while connecting to upstream, client: 127.0.0.1, server: localhost, request: &quot;GET &#x2F;ncs&#x2F;telecom&#x2F;phone-verify HTTP&#x2F;1.1&quot;, upstream: &quot;https:&#x2F;&#x2F;[240e:698:100::4]:443&#x2F;auth&#x2F;verifyinfo.do&quot;, host: &quot;localhost:9000&quot;
[error] 3587705#0: *3471 connect() to [240e:698:100::5]:443 failed (101: Network is unreachable) while connecting to upstream, client: 127.0.0.1, server: localhost, request: &quot;GET &#x2F;ncs&#x2F;telecom&#x2F;phone-verify HTTP&#x2F;1.1&quot;, upstream: &quot;https:&#x2F;&#x2F;[240e:698:100::5]:443&#x2F;auth&#x2F;verifyinfo.do&quot;, host: &quot;localhost:9000&quot;
[error] 3587705#0: *3471 connect() to [240e:698:100::3]:443 failed (101: Network is unreachable) while connecting to upstream, client: 127.0.0.1, server: localhost, request: &quot;GET &#x2F;ncs&#x2F;telecom&#x2F;phone-verify HTTP&#x2F;1.1&quot;, upstream: &quot;https:&#x2F;&#x2F;[240e:698:100::3]:443&#x2F;auth&#x2F;verifyinfo.do&quot;, host: &quot;localhost:9000&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="äºŒã€proxy-pass"><a href="#äºŒã€proxy-pass" class="headerlink" title="äºŒã€proxy_pass"></a>äºŒã€<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass">proxy_pass</a></h1><blockquote>
<p>Syntax:	proxy_pass URL;<br>Default:	â€”<br>Context:	location, if in location, limit_except</p>
</blockquote>
<p>Sets the protocol and address of a proxied server and an optional URI to which a location should be mapped. As a protocol, â€œhttpâ€ or â€œhttpsâ€ can be specified. The address can be specified as a domain name or IP address, and an optional port:</p>
<blockquote>
<p>proxy_pass <a href="http://localhost:8000/uri/">http://localhost:8000/uri/</a>;</p>
</blockquote>
<p>or as a UNIX-domain socket path specified after the word â€œunixâ€ and enclosed in colons:</p>
<blockquote>
<p>proxy_pass <a href="http://unix/tmp/backend.socket:/uri/">http://unix:/tmp/backend.socket:/uri/</a>;</p>
</blockquote>
<p>If a domain name resolves to several addresses, all of them will be used in a round-robin fashion. In addition, an address can be specified as a server group.</p>
<p>Parameter value can contain variables. In this case, if an address is specified as a domain name, the name is searched among the described server groups, and, if not found, is determined using a resolver.</p>
<p>æ ¹æ®<code>proxy_pass</code>çš„è¯´æ˜ï¼Œæˆ‘ä»¬çš„ä»£ç†åœ°å€å¯ä»¥æ˜¯åŸŸåæˆ–IPåœ°å€ï¼Œå¦‚æœåœ°å€æ˜¯åŸŸåå¹¶ä¸”è¿™ä¸ªåŸŸåè¢«è§£æåˆ°å¤šä¸ªåœ°å€æ—¶ï¼Œnginxä»¥è½®è¯¢çš„æ–¹å¼è®¿é—®è§£æåçš„è¿™äº›åœ°å€ã€‚<br>æ­¤å¤–ï¼Œå¯ä»¥å°†è¿™ä¸ªåœ°å€æŒ‡å®šä¸ºä¸€ä¸ªserver groupï¼Œå³æˆ‘ä»¬çš„ä»£ç†åœ°å€æ—¶ä¸€ä¸ªåŸŸåçš„æ—¶å€™ï¼ŒåŸŸåè§£æåçš„åœ°å€å°†ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª<code>upstream</code>æœåŠ¡ç»„ï¼Œä»¥é»˜è®¤è½®è¯¢çš„æ–¹å¼æä¾›æœåŠ¡ã€‚</p>
<p>ä»£ç†åœ°å€çš„å‚æ•°ä¸­å¯ä»¥åŒ…å«å˜é‡ï¼Œå½“ä»£ç†åœ°å€è¢«æŒ‡å®šä¸ºä¸€ä¸ªåŸŸåçš„æ—¶å€™ï¼Œåˆ™åœ¨æè¿°çš„æœåŠ¡å™¨ç»„ä¸­æœç´¢è¯¥åç§°ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä½¿ç”¨åŸŸåè§£æå™¨ç¡®å®šã€‚</p>
<h1 id="ä¸‰ã€resolver"><a href="#ä¸‰ã€resolver" class="headerlink" title="ä¸‰ã€resolver"></a>ä¸‰ã€<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#resolver">resolver</a></h1><blockquote>
<p>Syntax:	resolver address â€¦ [valid&#x3D;time] [ipv6&#x3D;on|off] [status_zone&#x3D;zone];<br>Default:	â€”<br>Context:	http, server, location</p>
</blockquote>
<p>Configures name servers used to resolve names of upstream servers into addresses, for example:</p>
<blockquote>
<p>resolver 127.0.0.1 [::1]:5353;</p>
</blockquote>
<p>The address can be specified as a domain name or IP address, with an optional port (1.3.1, 1.2.2). If port is not specified, the port 53 is used. Name servers are queried in a round-robin fashion.</p>
<blockquote>
<p>Before version 1.1.7, only a single name server could be configured. Specifying name servers using IPv6 addresses is supported starting from versions 1.3.1 and 1.2.2.</p>
</blockquote>
<p>By default, nginx will look up both IPv4 and IPv6 addresses while resolving. If looking up of IPv6 addresses is not desired, the ipv6&#x3D;off parameter can be specified.</p>
<blockquote>
<p>Resolving of names into IPv6 addresses is supported starting from version 1.5.8.</p>
</blockquote>
<p>By default, nginx caches answers using the TTL value of a response. An optional valid parameter allows overriding it:</p>
<blockquote>
<p>resolver 127.0.0.1 [::1]:5353 valid&#x3D;30s;</p>
</blockquote>
<p>é€šè¿‡<code>proxy_pass</code>çš„è¯´æ˜æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨nginxä¸­å¯ä»¥é…ç½®resolverå¯¹åŸŸåè¿›è¡Œè§£æï¼Œå¹¶å…³é—­ipv6çš„è§£æã€‚</p>
<p>æ‰€ä»¥nginxä»£ç†çš„çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       9000;
    server_name  localhost;
    resolver 114.114.114.114 valid&#x3D;60s ipv6&#x3D;off;
    
    location &#x2F;ncs&#x2F;telecom&#x2F;phone-verify &#123;
        set $telecom open.e.189.cn;
        proxy_pass https:&#x2F;&#x2F;$telecom&#x2F;auth&#x2F;verifyinfo.do;
        proxy_read_timeout 300;
        proxy_connect_timeout 300;
        proxy_redirect off;

        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host &#39;open.e.189.cn&#39;;
        proxy_set_header X-Real-IP $remote_addr;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡ä¸Šè¿°é…ç½®ï¼ˆæ³¨æ„ï¼šå¿…é¡»å°†<code>proxy_pass</code>å‚æ•°ä¸­çš„åŸŸåè®¾ç½®ä¸ºå˜é‡)ï¼Œæˆ‘ä»¬æŒ‡å®šä»£ç†åœ°å€ä¸­çš„åŸŸåæ¯é—´éš”60sè¿›è¡Œè§£æä¸€æ¬¡ï¼Œè§£ææ—¶æ’é™¤æ‰åŸŸåä¸­çš„ipv6åœ°å€ã€‚</p>
<p>åŸŸåopen.e.189.cnè§£æåçš„IPåœ°å€å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">[root@10-13-149-183 conf.d]# nslookup open.e.189.cn
Server:         10.13.255.1
Address:        10.13.255.1#53

Non-authoritative answer:
open.e.189.cn   canonical name &#x3D; open.e-189.21cn.com.
Name:   open.e-189.21cn.com
Address: 42.123.76.75
Name:   open.e-189.21cn.com
Address: 42.123.76.52
Name:   open.e-189.21cn.com
Address: 42.123.76.87
Name:   open.e-189.21cn.com
Address: 240e:698:100::3
Name:   open.e-189.21cn.com
Address: 240e:698:100::2
Name:   open.e-189.21cn.com
Address: 240e:698:100::5
Name:   open.e-189.21cn.com
Address: 240e:698:100::4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹nginxé…ç½®åé‡å¯ï¼Œå‘ç°erroræ—¥å¿—ä¸­å·²ç»æ²¡æœ‰æŠ¥é”™äº†ï¼Œè‡³æ­¤nginxä»£ç†è¯·æ±‚ipv6æŠ¥é”™çš„é—®é¢˜å·²ç»è§£å†³äº†ã€‚</p>
<p>å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼Œå³ä½¿åœ¨nginxæ‰“å°äº†è¯·æ±‚ipv6çš„å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œä½†æˆ‘ä»¬çš„è¯·æ±‚æœ€åä»æ˜¯æˆåŠŸçš„ï¼Œè¿™æ˜¯ç”±äºnginxçš„å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸€ä¸‹nginxçš„å¤±è´¥é‡è¯•æœºåˆ¶ã€‚</p>
<h1 id="å››ã€upstream"><a href="#å››ã€upstream" class="headerlink" title="å››ã€upstream"></a>å››ã€<a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html">upstream</a></h1><p>nginxçš„<code>ngx_http_upstream_module</code>çš„æ¨¡å—æ—¶ç”¨æ¥å®šä¹‰ä¸€ä¸ªæœåŠ¡ç»„çš„ï¼Œè¿™ä¸ªæœåŠ¡ç»„å¯ä»¥è¢«<code>proxy_pass</code>ç­‰æ¨¡å—å¼•ç”¨ã€‚<br>å‰é¢åœ¨<code>proxy_pass</code>ä¸­æåˆ°ï¼Œå½“æˆ‘ä»¬çš„ä»£ç†åœ°å€æ˜¯ä¸€ä¸ªåŸŸåçš„æ—¶å€™ï¼ŒåŸŸåè§£æåçš„åœ°å€å°†è¢«è½¬æ¢ä½ä¸€ä¸ª<code>upstream</code>æœåŠ¡ç»„ã€‚<br><code>upstream</code>çš„é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">resolver 10.0.0.1;

upstream dynamic &#123;
    zone upstream_dynamic 64k;

    server backend1.example.com      weight&#x3D;5;
    server backend2.example.com:8080 fail_timeout&#x3D;5s slow_start&#x3D;30s;
    server 192.0.2.1                 max_fails&#x3D;3;
    server backend3.example.com      resolve;
    server backend4.example.com      service&#x3D;http resolve;

    server backup1.example.com:8080  backup;
    server backup2.example.com:8080  backup;
&#125;

server &#123;
    location &#x2F; &#123;
        proxy_pass http:&#x2F;&#x2F;dynamic;
        health_check;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>Syntax:	server address [parameters];<br>Default:	â€”<br>Context:	upstream</p>
</blockquote>
<ul>
<li><p>max_fails&#x3D;number<br>sets the number of unsuccessful attempts to communicate with the server that should happen in the duration set by the fail_timeout parameter to consider the server unavailable for a duration also set by the fail_timeout parameter. By default, the number of unsuccessful attempts is set to 1. The zero value disables the accounting of attempts. What is considered an unsuccessful attempt is defined by the proxy_next_upstream, fastcgi_next_upstream, uwsgi_next_upstream, scgi_next_upstream, memcached_next_upstream, and grpc_next_upstream directives.</p>
</li>
<li><p>fail_timeout&#x3D;time<br>sets the time during which the specified number of unsuccessful attempts to communicate with the server should happen to consider the server unavailable;<br>and the period of time the server will be considered unavailable.<br>By default, the parameter is set to 10 seconds.</p>
</li>
</ul>
<p>nginxé»˜è®¤ä½¿ç”¨è½®è¯¢æœºåˆ¶è¯·æ±‚server groupä¸­æœåŠ¡ï¼Œé€šè¿‡<code>max_fails</code>å’Œ<code>fail_timeout</code>ä¸¤ä¸ªå‚æ•°æ§åˆ¶<code>upstream</code>ä¸‹çš„æœåŠ¡æ˜¯å¦å¯ç”¨ã€‚<br>è¿™ä¸ªä¸¤ä¸ªå‚æ•°è¡¨ç¤ºåœ¨<code>fail_timeout</code>æ—¶é—´å†…ï¼Œä¸€ä¸ªæœåŠ¡ç´¯è®¡çš„å¤±è´¥æ¬¡æ•°è¶…è¿‡<code>max_fails</code>ï¼Œåˆ™è¿™ä¸ªæœåŠ¡åœ¨æ¥ä¸€ä¸‹æ¥çš„<code>fail_timeout</code>æ—¶é—´å†…ä¸å¯ç”¨ã€‚<br><code>max_fails</code>é»˜è®¤å€¼ä¸º1ï¼Œè®¾ç½®ä¸º0è¡¨ç¤ºä¸é™åˆ¶ã€‚<code>fail_timeout</code>é»˜è®¤å€¼ä¸º10ï¼Œå³é»˜è®¤ä¸€ä¸ªæœåŠ¡åœ¨10så†…å¤±è´¥ä¸€æ¬¡ï¼Œåˆ™åœ¨æ¥ä¸€ä¸‹æ¥çš„10så†…ï¼Œè¿™ä¸ªæœåŠ¡å°†å˜ä¸ºä¸å¯ç”¨ã€‚</p>
<p>å½“server groupä¸­çš„ä¸€ä¸ªserverè¯·æ±‚å¤±è´¥æ—¶ï¼Œnginxçš„ä¼šè¿›è¡Œå¤±è´¥é‡è¯•ï¼Œå‚è§<code>proxy_next_upstream</code>æ¨¡å—ã€‚</p>
<h1 id="äº”ã€proxy-next-upstream"><a href="#äº”ã€proxy-next-upstream" class="headerlink" title="äº”ã€proxy_next_upstream"></a>äº”ã€<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream">proxy_next_upstream</a></h1><blockquote>
<p>Syntax:	proxy_next_upstream error | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | non_idempotent | off â€¦;<br>Default:	<br>proxy_next_upstream error timeout;<br>Context:	http, server, location</p>
</blockquote>
<p>Specifies in which cases a request should be passed to the next server:</p>
<ul>
<li>error<br>an error occurred while establishing a connection with the server, passing a request to it, or reading the response header;</li>
<li>timeout<br>a timeout has occurred while establishing a connection with the server, passing a request to it, or reading the response header;</li>
</ul>
<p>One should bear in mind that passing a request to the next server is only possible if nothing has been sent to a client yet. That is, if an error or timeout occurs in the middle of the transferring of a response, fixing this is impossible.</p>
<p>The directive also defines what is considered an unsuccessful attempt of communication with a server. The cases of error, timeout and invalid_header are always considered unsuccessful attempts, even if they are not specified in the directive. The cases of http_500, http_502, http_503, http_504, and http_429 are considered unsuccessful attempts only if they are specified in the directive. The cases of http_403 and http_404 are never considered unsuccessful attempts.</p>
<p>æ ¹æ®ä¸Šè¿°è¯´æ˜nginxé‡åˆ°<code>error</code>ã€<code>timeout</code>ç­‰é”™è¯¯æ—¶ï¼Œä¼šä¸‹ä¸€ä¸ªserverè¿›è¡Œé‡è¯•ã€‚æˆ‘ä»¬ä¹‹å‰é‡åˆ°çš„è¯·æ±‚çš„ipv6çš„é”™è¯¯å±äº<code>errror</code>æƒ…å†µï¼Œnignxä¼šè¿›è¡Œé‡è¯•ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ ¹æ®ä¸Šè¿°è¯´æ˜ï¼Œæˆ‘ä»¬å¯¹åŸŸååœ°å€è¿›è¡Œåå‘ä»£ç†æ—¶ï¼ŒåŸŸåè§£æåçš„åœ°å€ä¼šè¢«è½¬ä¸ºä¸€ä¸ª<code>upstream</code>çš„server groupï¼Œå¹¶ä»¥è½®è¯¢çš„æ–¹å¼è¿›è¡Œè®¿é—®ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®<code>resolver</code>æ¥è®¾ç½®åŸŸåè§£ææœåŠ¡å™¨åœ°å€ã€åŒæ—¶å¯ä»¥å…³é—­ipv6çš„è§£æï¼›<br>nginxå¯¹server groupä¸­çš„serverè¿›è¡Œè®¿é—®æ—¶ï¼Œä¼šæ ¹æ®<code>max_fails</code>å’Œ<code>fail_timeout</code>è¿ä¸ªå‚æ•°åˆ¤æ–­æœåŠ¡æ˜¯å¦å¯ç”¨ï¼Œåœ¨serverè¯·æ±‚å¤±è´¥åï¼Œä¼šæ ¹æ®é”™è¯¯ç±»å‹åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ä¸‹ä¸€ä¸ªserverè¿›è¡Œå¤±è´¥é‡è¯•ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass">Nginxå®˜ç½‘â€”â€”proxy_pass</a><br><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#resolver">Nginxå®˜ç½‘â€”â€”resolver</a><br><a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html">Nginxå®˜ç½‘â€”â€”upstream</a><br><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_next_upstream">Nginxå®˜ç½‘â€”â€”proxy_next_upstream</a></p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºNginxå®ç°ä¸‰çº§åŸŸåè®¿é—®å’Œhttpsè®¿é—®</title>
    <url>/2018/10/26/nginx/ji-yu-nginx-shi-xian-san-ji-yu-ming-fang-wen-he-https-fang-wen/</url>
    <content><![CDATA[<h1 id="Nginxå®ç°ä¸‰çº§åŸŸåè®¿é—®"><a href="#Nginxå®ç°ä¸‰çº§åŸŸåè®¿é—®" class="headerlink" title="Nginxå®ç°ä¸‰çº§åŸŸåè®¿é—®"></a>Nginxå®ç°ä¸‰çº§åŸŸåè®¿é—®</h1><p>æˆ‘çš„VPSä¸Šéƒ¨ç½²äº†<a href="https://www.mpoom.cn/">MPOOMå·¥ä½œå°</a>ã€<a href="http://blog.mpoom.cn/">ä¸ªäººåšå®¢</a>ã€<a href="http://m.mpoom.cn/">æ–‡ä»¶å…±äº«å¹³å°</a>ä¸‰ä¸ªç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨é˜¿é‡Œäº‘å¹³å°è´­ä¹°äº†åŸŸåï¼Œæƒ³è¦é€šè¿‡nginxå®ç°ä¸åŒçš„ä¸‰çº§åŸŸåè®¿é—®ä¸åŒçš„ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><p>MPOOMå·¥ä½œå°ï¼š<a href="http://www.mpoon.cn/">http://www.mpoon.cn</a></p>
</li>
<li><p>ä¸ªäººåšå®¢ï¼š <a href="http://blog.mpoom.cn/">http://blog.mpoom.cn</a></p>
</li>
<li><p>æ–‡ä»¶å…±äº«å¹³å°ï¼š<a href="http://m.mpoom.cn/">http://m.mpoom.cn</a></p>
</li>
</ul>
<p><em>psï¼šå¦‚æœåŸŸåè¦è§£æåˆ°å›½å†…äº‘æœåŠ¡å™¨ï¼ŒåŸŸåè¦æå‰åœ¨å·¥ä¿¡éƒ¨è¿›è¡Œå¤‡æ¡ˆï¼Œä½†æ˜¯å¦‚æœè§£æåˆ°å›½å¤–ï¼Œåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶.</em></p>
<blockquote>
<p>é…ç½®æ–‡ä»¶mpoom.confå¦‚ä¸‹:</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none"># mpoomå·¥ä½œå°
server &#123;
    listen       80;
    server_name  mpoom.cn www.mpoom.cn;
    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:8090;
    &#125;
&#125;
# ä¸ªäººåšå®¢
server &#123;
    listen       80;
    server_name  blog.mpoom.cn;

    set $root_path &quot;&#x2F;usr&#x2F;local&#x2F;webserver&#x2F;blog&#x2F;public&quot;;

    #charset koi8-r;
    access_log  &#x2F;home&#x2F;running&#x2F;blog&#x2F;blog-logs&#x2F;host.access.log;
    error_log  &#x2F;home&#x2F;running&#x2F;blog&#x2F;blog-logs&#x2F;error.log;
    # ä¸ªäººåšå®¢ç³»ç»Ÿæ˜¯ç”±hexoç”Ÿæˆçš„é™æ€é¡µé¢
    location &#x2F; &#123;
        root   $root_path;
        index  index.html index.htm;
    &#125;
&#125;
# æ–‡ä»¶å…±äº«å¹³å°
server &#123;
    listen       80;
    server_name  m.mpoom.cn;

    set $root_path &quot;&#x2F;home&#x2F;running&#x2F;web&#x2F;open-web&#x2F;&quot;;

    #charset koi8-r;
    access_log  &#x2F;home&#x2F;running&#x2F;web&#x2F;openweb-logs&#x2F;host.access.log;
    error_log  &#x2F;home&#x2F;running&#x2F;blog&#x2F;blog-logs&#x2F;error.log;

    location &#x2F; &#123;
        root   $root_path;
        index  index.html index.htm;
    &#125;

    location ~ ^&#x2F;service&#x2F; &#123;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Cookie $http_cookie;
        proxy_cookie_path &#x2F;service&#x2F; &#x2F;;

        proxy_buffering off;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:9000;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å·¥ä½œå°å’Œæ–‡ä»¶å…±äº«å¹³å°è¿›è¡Œäº†å‰åç«¯åˆ†ç¦»ï¼Œä¸”ä¸¤è€…å…±ç”¨åå°ç³»ç»Ÿï¼Œå‰ç«¯ä½¿ç”¨nginxä½œä¸ºæœåŠ¡å™¨ï¼Œåå°ä½¿ç”¨nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p>
<p>ç„¶ååœ¨nginxä¸»é…ç½®æ–‡ä»¶nginx.confçš„httpæ¨¡å—å¼•å…¥ä¸Šé¢mpoom.confé…ç½®æ–‡ä»¶</p>
<pre class="line-numbers language-none"><code class="language-none">include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;mpoom.conf;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h1 id="Nginxå®ç°httpsè®¿é—®"><a href="#Nginxå®ç°httpsè®¿é—®" class="headerlink" title="Nginxå®ç°httpsè®¿é—®"></a>Nginxå®ç°httpsè®¿é—®</h1><p>ä¸ºä¿éšœMPOOMå·¥ä½œå°è®¿é—®å®‰å…¨æ€§ï¼Œä¸”åœ¨é˜¿é‡Œäº‘è´­å¯ä»¥è´­ä¹°å…è´¹çš„SSLè¯ä¹¦ï¼Œæ‰€ä»¥å†³å®šä½¿ç”¨httpsæ¥è¿›è¡Œè®¿é—®ã€‚</p>
<blockquote>
<p>NginxæœåŠ¡å™¨å®‰è£…SSLè¯ä¹¦æ­¥éª¤å¦‚ä¸‹</p>
</blockquote>
<ul>
<li><p>åœ¨é˜¿é‡Œäº‘è´­ä¹°å…è´¹çš„SSLè¯ä¹¦ï¼ŒéªŒè¯é€šè¿‡åï¼Œä¸‹è½½Nginxç‰ˆæœ¬è¯ä¹¦ã€‚</p>
</li>
<li><p>è¿›å…¥nginxå®‰è£…ç›®å½•ä¸‹çš„confç›®å½•ï¼Œåœ¨confç›®å½•ä¸‹åˆ›å»ºcertç›®å½•ï¼Œå°†ä¸‹è½½è§£å‹åçš„è¯ä¹¦ä¸Šä¼ åˆ°certç›®å½•ï¼Œä¸‹è½½åˆ°æœ¬åœ°çš„è¯ä¹¦å‹ç¼©æ–‡ä»¶åŒ…è§£å‹ååŒ…å«ï¼š</p>
<ul>
<li><strong>.crt</strong>æ–‡ä»¶ï¼šæ˜¯è¯ä¹¦æ–‡ä»¶ï¼Œcrtæ˜¯pemæ–‡ä»¶çš„æ‰©å±•åã€‚</li>
<li><strong>.key</strong>æ–‡ä»¶ï¼šè¯ä¹¦çš„ç§é’¥æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><p>åœ¨nginxé…ç½®æ–‡ä»¶çš„httpæ¨¡å—ä¸‹æ–°å¢ä¸€ä¸ªserveræ¨¡å—,é…ç½®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen 443;
    server_name mpoom.cn;
    ssl on;
    ssl_certificate  cert&#x2F;***_www.mpoom.cn.pem;
    ssl_certificate_key cert&#x2F;***_www.mpoom.cn.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;

    location &#x2F; &#123;
        proxy_pass  http:&#x2F;&#x2F;127.0.0.1:8090;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>å¼ºåˆ¶httpè·³è½¬è‡³httpsï¼Œå°†å·¥ä½œå°çš„serveræ¨¡å—æ›´æ–°ä¸ºå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       80;
    server_name  mpoom.cn www.mpoom.cn;
    return 301 https:&#x2F;&#x2F;www.mpoom.cn$request_uri;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>é‡å¯nginxã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Forecasting Research on the Wireless Mesh Network Throughput Based on the Support Vector Machine</title>
    <url>/2017/12/26/paper/ji-yu-zhi-chi-xiang-liang-ji-de-wu-xian-mesh-wang-luo-tun-tu-liang-yu-ce/</url>
    <content><![CDATA[<h1 id="ã€ŠåŸºäºæ”¯æŒå‘é‡æœºçš„æ— çº¿Meshç½‘ç»œååé‡é¢„æµ‹ã€‹-â€”â€”-è®ºæ–‡"><a href="#ã€ŠåŸºäºæ”¯æŒå‘é‡æœºçš„æ— çº¿Meshç½‘ç»œååé‡é¢„æµ‹ã€‹-â€”â€”-è®ºæ–‡" class="headerlink" title="ã€ŠåŸºäºæ”¯æŒå‘é‡æœºçš„æ— çº¿Meshç½‘ç»œååé‡é¢„æµ‹ã€‹ â€”â€” è®ºæ–‡"></a>ã€ŠåŸºäºæ”¯æŒå‘é‡æœºçš„æ— çº¿Meshç½‘ç»œååé‡é¢„æµ‹ã€‹ â€”â€” è®ºæ–‡</h1><span id="more"></span>
<div class="pdf-container" style="width: 100%; height: 600px; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe src="./åŸºäºæ”¯æŒå‘é‡æœºçš„æ— çº¿Meshç½‘ç»œååé‡é¢„æµ‹.pdf" width="100%" height="100%" frameborder="0" style="border: none; border-radius: 8px;">
      <div style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 8px;">
        <p style="margin: 0; color: #666;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºPDFæ–‡ä»¶</p>
        <a href="./åŸºäºæ”¯æŒå‘é‡æœºçš„æ— çº¿Meshç½‘ç»œååé‡é¢„æµ‹.pdf" target="_blank" style="color: #409eff; text-decoration: none; font-weight: 500;">ğŸ“¥ ç‚¹å‡»è¿™é‡Œä¸‹è½½PDFæ–‡ä»¶</a>
      </div>
    </iframe>
  </div>]]></content>
      <categories>
        <category>è®ºæ–‡</category>
      </categories>
      <tags>
        <tag>è®ºæ–‡</tag>
      </tags>
  </entry>
  <entry>
    <title>JMX-Exporterè™šæ‹ŸæœºJVMç›‘æ§é‡‡é›†éƒ¨ç½²</title>
    <url>/2024/12/30/prometheus/jmx-exporter-xu-ni-ji-jvm-jian-kong-cai-ji-bu-shu/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>è™šæ‹Ÿæœºéƒ¨ç½²çš„Javaåº”ç”¨æ²¡æœ‰é›†æˆSpringBootè‡ªå¸¦ç›‘æ§Actuatorï¼Œéœ€è¦é¢å¤–æ‰‹åŠ¨é…ç½®é‡‡é›†JVMç›‘æ§ã€‚JMX-Exporterä½œä¸ºPrometheusç”Ÿæ€ç³»ç»Ÿä¸­é‡è¦çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿå°†JMXï¼ˆJava Management Extensionsï¼‰æŒ‡æ ‡è½¬æ¢ä¸ºPrometheusæ ¼å¼ï¼Œå®ç°å¯¹Javaåº”ç”¨çš„æ·±åº¦ç›‘æ§ã€‚</p>
<div class="note primary no-icon flat"><p><strong>æ ¸å¿ƒè§£å†³é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¼ ç»ŸJavaåº”ç”¨ç¼ºä¹ç°ä»£åŒ–ç›‘æ§æŒ‡æ ‡æš´éœ²</li>
<li>éœ€è¦ç»Ÿä¸€ç›‘æ§æ•°æ®æ ¼å¼å¯¹æ¥Prometheus</li>
<li>å®ç°JVMæ€§èƒ½æŒ‡æ ‡çš„å®æ—¶é‡‡é›†å’Œåˆ†æ</li>
</ul>
</div>

<span id="more"></span>

<h1 id="äºŒã€JMX-Agentéƒ¨ç½²æ­¥éª¤"><a href="#äºŒã€JMX-Agentéƒ¨ç½²æ­¥éª¤" class="headerlink" title="äºŒã€JMX Agentéƒ¨ç½²æ­¥éª¤"></a>äºŒã€JMX Agentéƒ¨ç½²æ­¥éª¤</h1><h2 id="2-1-éƒ¨ç½²æ–‡ä»¶"><a href="#2-1-éƒ¨ç½²æ–‡ä»¶" class="headerlink" title="2.1. éƒ¨ç½²æ–‡ä»¶"></a>2.1. éƒ¨ç½²æ–‡ä»¶</h2><p>åœ¨å¼€å§‹éƒ¨ç½²ä¹‹å‰ï¼Œéœ€è¦å‡†å¤‡ä»¥ä¸‹æ ¸å¿ƒæ–‡ä»¶ï¼š</p>
<table>
<thead>
<tr>
<th>æ–‡ä»¶ç±»å‹</th>
<th>æ–‡ä»¶åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>JVMç›‘æ§Agent</td>
<td><code>jmx_prometheus_javaagent-1.2.0.jar</code></td>
<td>JMXæŒ‡æ ‡æ”¶é›†å™¨</td>
</tr>
<tr>
<td>ç›‘æ§é…ç½®æ–‡ä»¶</td>
<td><code>exporter.yaml</code></td>
<td>JMXæŒ‡æ ‡é‡‡é›†è§„åˆ™é…ç½®</td>
</tr>
</tbody></table>
<h3 id="exporter-yaml"><a href="#exporter-yaml" class="headerlink" title="exporter.yaml"></a>exporter.yaml</h3><pre class="line-numbers language-none"><code class="language-none">rules:
  - pattern: &quot;.*&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<div class="note info no-icon flat"><p><strong>ç‰ˆæœ¬è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å»ºè®®ä½¿ç”¨JMX Prometheus JavaAgent 1.2.0æˆ–æ›´æ–°ç‰ˆæœ¬</li>
<li>é…ç½®æ–‡ä»¶éœ€è¦æ ¹æ®åº”ç”¨ç‰¹ç‚¹è¿›è¡Œå®šåˆ¶åŒ–è°ƒæ•´</li>
</ul>
</div>

<h2 id="2-2-éƒ¨ç½²æ­¥éª¤"><a href="#2-2-éƒ¨ç½²æ­¥éª¤" class="headerlink" title="2.2. éƒ¨ç½²æ­¥éª¤"></a>2.2. éƒ¨ç½²æ­¥éª¤</h2><h3 id="ï¼ˆ1ï¼‰æ–‡ä»¶éƒ¨ç½²"><a href="#ï¼ˆ1ï¼‰æ–‡ä»¶éƒ¨ç½²" class="headerlink" title="ï¼ˆ1ï¼‰æ–‡ä»¶éƒ¨ç½²"></a>ï¼ˆ1ï¼‰æ–‡ä»¶éƒ¨ç½²</h3><ol>
<li><strong>Agentéƒ¨ç½²</strong>ï¼šå°†<code>jmx_prometheus_javaagent-1.2.0.jar</code>æ–‡ä»¶æ·»åŠ åˆ°Javaåº”ç”¨æ¨¡å—çš„<code>lib</code>ç›®å½•ä¸‹</li>
<li><strong>é…ç½®æ–‡ä»¶éƒ¨ç½²</strong>ï¼šå°†<code>exporter.yaml</code>é…ç½®æ–‡ä»¶æ·»åŠ åˆ°åº”ç”¨æ¨¡å—çš„<code>conf</code>ç›®å½•ä¸‹</li>
<li><strong>å¯åŠ¨è„šæœ¬ä¿®æ”¹</strong>ï¼šä¿®æ”¹Javaåº”ç”¨æ¨¡å—çš„å¯åŠ¨è„šæœ¬ï¼Œå¢åŠ jmx-agentçš„å¯åŠ¨å‚æ•°</li>
</ol>
<h3 id="ï¼ˆ2ï¼‰ä¿®æ”¹åº”ç”¨å¯åŠ¨è„šæœ¬é…ç½®"><a href="#ï¼ˆ2ï¼‰ä¿®æ”¹åº”ç”¨å¯åŠ¨è„šæœ¬é…ç½®" class="headerlink" title="ï¼ˆ2ï¼‰ä¿®æ”¹åº”ç”¨å¯åŠ¨è„šæœ¬é…ç½®"></a>ï¼ˆ2ï¼‰ä¿®æ”¹åº”ç”¨å¯åŠ¨è„šæœ¬é…ç½®</h3><p><strong>åŸºç¡€é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> -javaagent:./lib/jmx_prometheus_javaagent-1.2.0.jar<span class="token operator">=</span><span class="token number">8585</span>:./conf/exporter.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>å®Œæ•´å¯åŠ¨è„šæœ¬ç¤ºä¾‹ï¼š</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> -javaagent:./lib/jmx_prometheus_javaagent-1.2.0.jar<span class="token operator">=</span><span class="token number">8585</span>:./conf/exporter.yaml <span class="token punctuation">\</span>
     <span class="token variable">$&#123;JAVA_OPTS&#125;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">-cp</span> <span class="token variable">$&#123;CLASSPATH&#125;</span> <span class="token punctuation">\</span>
     com.example.application.server.ApplicationServer <span class="token punctuation">\</span>
     <span class="token operator">></span> <span class="token variable">$&#123;SERVER_LOG&#125;</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note warning no-icon flat"><p><strong>é…ç½®è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>ç«¯å£8585å¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼Œéœ€ç¡®ä¿ç«¯å£æœªè¢«å ç”¨</li>
<li>javaagentå‚æ•°å¿…é¡»åœ¨ä¸»ç±»ä¹‹å‰æŒ‡å®š</li>
<li>è·¯å¾„å¿…é¡»ä¸å®é™…æ–‡ä»¶ä½ç½®ä¿æŒä¸€è‡´</li>
</ul>
</div>

<h2 id="2-3-é‡å¯åº”ç”¨æ¨¡å—"><a href="#2-3-é‡å¯åº”ç”¨æ¨¡å—" class="headerlink" title="2.3. é‡å¯åº”ç”¨æ¨¡å—"></a>2.3. é‡å¯åº”ç”¨æ¨¡å—</h2><p>ä¿®æ”¹å¯åŠ¨è„šæœ¬åï¼Œéœ€è¦é‡å¯åº”ç”¨æ¨¡å—ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åœæ­¢åº”ç”¨</span>
./stop.sh

<span class="token comment"># å¯åŠ¨åº”ç”¨</span>
./start.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-4-éªŒè¯Agentå¯åŠ¨"><a href="#2-4-éªŒè¯Agentå¯åŠ¨" class="headerlink" title="2.4. éªŒè¯Agentå¯åŠ¨"></a>2.4. éªŒè¯Agentå¯åŠ¨</h2><p>ä½¿ç”¨æµè§ˆå™¨æˆ–curlå‘½ä»¤éªŒè¯JMX-Exporteræ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://host:8585/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<div class="note success no-icon flat"><p><strong>éªŒè¯æˆåŠŸæ ‡å¿—</strong>ï¼š</p>
<ul>
<li>è¿”å›Prometheusæ ¼å¼çš„æŒ‡æ ‡æ•°æ®</li>
<li>åŒ…å«JVMç›¸å…³æŒ‡æ ‡å¦‚<code>jvm_memory_bytes_used</code>ã€<code>jvm_gc_duration_seconds</code>ç­‰</li>
<li>HTTPçŠ¶æ€ç ä¸º200</li>
</ul>
</div>

<h1 id="ä¸‰ã€Prometheusç›‘æ§é‡‡é›†é…ç½®"><a href="#ä¸‰ã€Prometheusç›‘æ§é‡‡é›†é…ç½®" class="headerlink" title="ä¸‰ã€Prometheusç›‘æ§é‡‡é›†é…ç½®"></a>ä¸‰ã€Prometheusç›‘æ§é‡‡é›†é…ç½®</h1><h2 id="3-1-é…ç½®Kubernetes-Endpoints"><a href="#3-1-é…ç½®Kubernetes-Endpoints" class="headerlink" title="3.1. é…ç½®Kubernetes Endpoints"></a>3.1. é…ç½®Kubernetes Endpoints</h2><p>åˆ›å»º<code>åº”ç”¨åç§°-jmx-exporter-endpoints.yaml</code>æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Endpoints
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> åº”ç”¨åç§°<span class="token punctuation">-</span>jmx<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">subsets</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> 192.168.1.10  <span class="token comment"># JMXæœåŠ¡å™¨IP1</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> 192.168.1.11  <span class="token comment"># JMXæœåŠ¡å™¨IP2</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8585</span>  <span class="token comment"># jmx-exporterç«¯å£</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note info no-icon flat"><p><strong>é…ç½®è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ›¿æ¢<code>åº”ç”¨åç§°</code>ä¸ºå®é™…åº”ç”¨æ ‡è¯†</li>
<li><code>ip</code>å­—æ®µå¡«å†™éƒ¨ç½²JMX-Exporterçš„æœåŠ¡å™¨IPåœ°å€</li>
<li><code>port</code>éœ€ä¸å¯åŠ¨è„šæœ¬ä¸­é…ç½®çš„ç«¯å£ä¿æŒä¸€è‡´</li>
</ul>
</div>

<h2 id="3-2-é…ç½®Kubernetes-Service"><a href="#3-2-é…ç½®Kubernetes-Service" class="headerlink" title="3.2. é…ç½®Kubernetes Service"></a>3.2. é…ç½®Kubernetes Service</h2><p>åˆ›å»º<code>åº”ç”¨åç§°-jmx-exporter-service.yaml</code>æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> jmx<span class="token punctuation">-</span>exporter
    <span class="token key atrule">platform</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>platform          <span class="token comment"># åº”ç”¨æ‰€å±å¹³å°</span>
    <span class="token key atrule">modules</span><span class="token punctuation">:</span> åº”ç”¨åç§°        <span class="token comment"># å…·ä½“åº”ç”¨æ¨¡å—å</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> jmx<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8585</span>              <span class="token comment"># jmx-exporterç«¯å£</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note primary no-icon flat"><p><strong>å…³é”®é…ç½®é¡¹</strong>ï¼š</p>
<ul>
<li><code>platform</code>ï¼šæ ‡è¯†åº”ç”¨æ‰€å±çš„ä¸šåŠ¡å¹³å°</li>
<li><code>modules</code>ï¼šæ ‡è¯†å…·ä½“çš„åº”ç”¨æ¨¡å—åç§°</li>
<li>è¿™äº›æ ‡ç­¾å°†ç”¨äºPrometheusçš„æŒ‡æ ‡åˆ†ç±»å’ŒæŸ¥è¯¢</li>
</ul>
</div>

<h2 id="3-3-é…ç½®ServiceMonitor"><a href="#3-3-é…ç½®ServiceMonitor" class="headerlink" title="3.3. é…ç½®ServiceMonitor"></a>3.3. é…ç½®ServiceMonitor</h2><p>åˆ›å»º<code>jmx-exporter-monitor.yaml</code>æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceMonitor
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> jmx<span class="token punctuation">-</span>exporter
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">interval</span><span class="token punctuation">:</span> 15s           <span class="token comment"># é‡‡é›†é—´éš”</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /metrics          <span class="token comment"># æŒ‡æ ‡æš´éœ²è·¯å¾„</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> http
  <span class="token key atrule">targetLabels</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> platform
  <span class="token punctuation">-</span> modules
  <span class="token key atrule">namespaceSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchNames</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> monitoring
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> jmx<span class="token punctuation">-</span>exporter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note success no-icon flat"><p><strong>ServiceMonitoråŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨å‘ç°ç¬¦åˆæ¡ä»¶çš„Service</li>
<li>å®šæ—¶é‡‡é›†JMXæŒ‡æ ‡æ•°æ®</li>
<li>å°†æ ‡ç­¾ä¿¡æ¯ä¼ é€’ç»™Prometheus</li>
</ul>
</div>

<h2 id="3-4-å¯ç”¨é…ç½®"><a href="#3-4-å¯ç”¨é…ç½®" class="headerlink" title="3.4. å¯ç”¨é…ç½®"></a>3.4. å¯ç”¨é…ç½®</h2><p>æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ç”¨ç›‘æ§é…ç½®ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»ºEndpoints</span>
kubectl apply <span class="token parameter variable">-f</span> åº”ç”¨åç§°-jmx-exporter-endpoints.yaml

<span class="token comment"># åˆ›å»ºService</span>
kubectl apply <span class="token parameter variable">-f</span> åº”ç”¨åç§°-jmx-exporter-service.yaml

<span class="token comment"># åˆ›å»ºServiceMonitor</span>
kubectl apply <span class="token parameter variable">-f</span> jmx-exporter-monitor.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>éªŒè¯é…ç½®ç”Ÿæ•ˆï¼š</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹EndpointsçŠ¶æ€</span>
kubectl get endpoints <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> jmx-exporter

<span class="token comment"># æŸ¥çœ‹ServiceçŠ¶æ€</span>
kubectl get <span class="token function">service</span> <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> jmx-exporter

<span class="token comment"># æŸ¥çœ‹ServiceMonitorçŠ¶æ€</span>
kubectl get servicemonitor <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> jmx-exporter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å››ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h1><h2 id="4-1-æ ¸å¿ƒJVMæŒ‡æ ‡"><a href="#4-1-æ ¸å¿ƒJVMæŒ‡æ ‡" class="headerlink" title="4.1. æ ¸å¿ƒJVMæŒ‡æ ‡"></a>4.1. æ ¸å¿ƒJVMæŒ‡æ ‡</h2><p>JMX-Exporteré‡‡é›†çš„ä¸»è¦JVMæŒ‡æ ‡åŒ…æ‹¬ï¼š</p>
<div class="note info no-icon flat"><p><strong>å†…å­˜æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>jvm_memory_bytes_used</code>ï¼šJVMå†…å­˜ä½¿ç”¨é‡</li>
<li><code>jvm_memory_bytes_max</code>ï¼šJVMæœ€å¤§å†…å­˜</li>
<li><code>jvm_memory_pool_bytes_used</code>ï¼šå†…å­˜æ± ä½¿ç”¨æƒ…å†µ</li>
</ul>
<p><strong>åƒåœ¾å›æ”¶æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>jvm_gc_duration_seconds</code>ï¼šGCè€—æ—¶ç»Ÿè®¡</li>
<li><code>jvm_gc_collection_seconds</code>ï¼šGCæ”¶é›†æ—¶é—´</li>
<li><code>jvm_memory_pool_allocated_bytes_total</code>ï¼šå†…å­˜åˆ†é…æ€»é‡</li>
</ul>
<p><strong>çº¿ç¨‹æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>jvm_threads_current</code>ï¼šå½“å‰çº¿ç¨‹æ•°</li>
<li><code>jvm_threads_peak</code>ï¼šçº¿ç¨‹å³°å€¼</li>
<li><code>jvm_threads_daemon</code>ï¼šå®ˆæŠ¤çº¿ç¨‹æ•°</li>
</ul>
</div>

<h2 id="4-2-å‘Šè­¦è§„åˆ™é…ç½®"><a href="#4-2-å‘Šè­¦è§„åˆ™é…ç½®" class="headerlink" title="4.2. å‘Šè­¦è§„åˆ™é…ç½®"></a>4.2. å‘Šè­¦è§„åˆ™é…ç½®</h2><p>åŸºäºJMXæŒ‡æ ‡å¯ä»¥é…ç½®ç›¸åº”çš„å‘Šè­¦è§„åˆ™ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> jvm_alerts
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> JVMMemoryHigh
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> jvm_memory_bytes_used / jvm_memory_bytes_max <span class="token punctuation">></span> 0.9
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"JVMå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; JVMå†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%"</span>
      
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> JVMGCTimeHigh
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> rate(jvm_gc_duration_seconds_sum<span class="token punctuation">[</span>5m<span class="token punctuation">]</span>) <span class="token punctuation">></span> 0.1
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"JVM GCæ—¶é—´è¿‡é•¿"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; GCæ—¶é—´å æ¯”è¶…è¿‡10%"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="äº”ã€æ•…éšœæ’æŸ¥"><a href="#äº”ã€æ•…éšœæ’æŸ¥" class="headerlink" title="äº”ã€æ•…éšœæ’æŸ¥"></a>äº”ã€æ•…éšœæ’æŸ¥</h1><h2 id="5-1-å¸¸è§é—®é¢˜"><a href="#5-1-å¸¸è§é—®é¢˜" class="headerlink" title="5.1. å¸¸è§é—®é¢˜"></a>5.1. å¸¸è§é—®é¢˜</h2><div class="note warning no-icon flat"><p><strong>Agentå¯åŠ¨å¤±è´¥</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥jaræ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®</li>
<li>éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®</li>
<li>ç¡®è®¤ç«¯å£æ˜¯å¦è¢«å ç”¨</li>
</ul>
<p><strong>æŒ‡æ ‡é‡‡é›†å¼‚å¸¸</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ç½‘ç»œè¿é€šæ€§</li>
<li>éªŒè¯ServiceMonitoré…ç½®</li>
<li>æŸ¥çœ‹Prometheusæ—¥å¿—</li>
</ul>
</div>

<h2 id="5-2-æ—¥å¿—æ’æŸ¥"><a href="#5-2-æ—¥å¿—æ’æŸ¥" class="headerlink" title="5.2. æ—¥å¿—æ’æŸ¥"></a>5.2. æ—¥å¿—æ’æŸ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹åº”ç”¨å¯åŠ¨æ—¥å¿—</span>
<span class="token function">tail</span> <span class="token parameter variable">-f</span> application.log

<span class="token comment"># æŸ¥çœ‹Prometheusé‡‡é›†æ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-n</span> monitoring prometheus-xxx

<span class="token comment"># æ£€æŸ¥ServiceMonitorçŠ¶æ€</span>
kubectl describe servicemonitor jmx-exporter <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>JMX-Exporterä¸ºä¼ ç»ŸJavaåº”ç”¨æä¾›äº†ç°ä»£åŒ–çš„ç›‘æ§èƒ½åŠ›ï¼Œé€šè¿‡æœ¬æ–¹æ¡ˆå¯ä»¥å®ç°ï¼š</p>
<ol>
<li><strong>ç»Ÿä¸€ç›‘æ§ä½“ç³»</strong>ï¼šå°†JMXæŒ‡æ ‡çº³å…¥Prometheusç›‘æ§ç”Ÿæ€</li>
<li><strong>è‡ªåŠ¨åŒ–é‡‡é›†</strong>ï¼šé€šè¿‡KubernetesåŸç”Ÿç»„ä»¶å®ç°è‡ªåŠ¨å‘ç°å’Œé‡‡é›†</li>
<li><strong>çµæ´»é…ç½®</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡é‡‡é›†è§„åˆ™å’Œå‘Šè­¦ç­–ç•¥</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒå¤šå®ä¾‹ã€å¤šåº”ç”¨çš„ç»Ÿä¸€ç®¡ç†</li>
</ol>
<p>é€šè¿‡æ ‡å‡†åŒ–çš„éƒ¨ç½²æµç¨‹ï¼Œå¯ä»¥å¿«é€Ÿä¸ºç°æœ‰Javaåº”ç”¨æ·»åŠ å®Œå–„çš„JVMç›‘æ§èƒ½åŠ›ï¼Œæå‡ç³»ç»Ÿå¯è§‚æµ‹æ€§ã€‚</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li><a href="https://github.com/prometheus/jmx_exporter">JMX Exporterå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://prometheus-operator.dev/docs/operator/design/#servicemonitor">Prometheus ServiceMonitoré…ç½®</a></li>
<li><a href="https://prometheus.io/docs/guides/java-monitoring/">JVMç›‘æ§æœ€ä½³å®è·µ</a></li>
<li><a href="https://docs.oracle.com/en/industries/energy-water/advanced-meter/2.9.0.0.0/c2m-server-admin-guide/index.html#page/C2M_SERVER_ADMIN_29000/C2M_Server_Admin_Monitoring.05.5.html">OracleæŒ‡æ ‡è¯´æ˜</a></li>
</ul>
]]></content>
      <categories>
        <category>ç³»ç»Ÿç›‘æ§</category>
      </categories>
      <tags>
        <tag>Prometheus</tag>
        <tag>JMX-Exporter</tag>
        <tag>JVM</tag>
        <tag>ç›‘æ§é‡‡é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸»ä»ç›‘æ§é…ç½®-Helméƒ¨ç½²æ–¹æ¡ˆ</title>
    <url>/2024/12/30/prometheus/mysql-zhu-cong-jian-kong-pei-zhi-helm-bu-shu-fang-an/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>ç”Ÿäº§ç¯å¢ƒçš„MySQLç›‘æ§é¢ä¸´ç€éƒ¨ç½²å¤æ‚ã€æ ‡ç­¾ä¸ç»Ÿä¸€ã€ç®¡ç†å›°éš¾ç­‰é—®é¢˜ã€‚ä¼ ç»Ÿæ–¹å¼ä¸­æ¯ä¸ªMySQLå®ä¾‹éƒ½éœ€è¦å•ç‹¬éƒ¨ç½²ä¸€ä¸ªexporterï¼Œéƒ¨ç½²æ–¹å¼ç¹çï¼Œé‡‡é›†çš„æŒ‡æ ‡æ ‡ç­¾ä¸ç»Ÿä¸€ï¼Œæ— æ³•åœ¨ç›‘æ§å›¾è¡¨ä¸Šå¿«é€Ÿæ£€ç´¢æŸ¥çœ‹ã€‚</p>
<div class="note primary no-icon flat"><p><strong>æ ¸å¿ƒè§£å†³é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ç®€åŒ–MySQLç›‘æ§çš„éƒ¨ç½²æµç¨‹</li>
<li>ç»Ÿä¸€ç›‘æ§æŒ‡æ ‡æ ‡ç­¾æ ¼å¼</li>
<li>æ”¯æŒçµæ´»çš„å¤šå®ä¾‹ç›‘æ§ç®¡ç†</li>
<li>æä¾›å®‰å…¨çš„è®¤è¯ä¿¡æ¯å­˜å‚¨</li>
</ul>
</div>

<p>æœ¬æ–¹æ¡ˆé‡‡ç”¨Helméƒ¨ç½²mysql-exporterå®ç°MySQLç›‘æ§é‡‡é›†ï¼Œå¯ä»¥çµæ´»å¢åŠ mysqlç›‘æ§å®ä¾‹ï¼Œå¤§å¤§ç®€åŒ–äº†è¿ç»´ç®¡ç†å¤æ‚åº¦ã€‚</p>
<span id="more"></span>

<h1 id="äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡"><a href="#äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡" class="headerlink" title="äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡"></a>äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡</h1><h2 id="2-1-å¿…éœ€æ–‡ä»¶æ¸…å•"><a href="#2-1-å¿…éœ€æ–‡ä»¶æ¸…å•" class="headerlink" title="2.1. å¿…éœ€æ–‡ä»¶æ¸…å•"></a>2.1. å¿…éœ€æ–‡ä»¶æ¸…å•</h2><table>
<thead>
<tr>
<th>æ–‡ä»¶ç±»å‹</th>
<th>æ–‡ä»¶åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Helm Charts</td>
<td><code>prometheus-mysql-exporter-2.10.0.tgz</code></td>
<td>prometheus-mysql-exporter chartéƒ¨ç½²åŒ…</td>
</tr>
<tr>
<td>é…ç½®æ–‡ä»¶</td>
<td><code>mysql-exporter-values.yaml</code></td>
<td>mysql-exporteré…ç½®æ–‡ä»¶</td>
</tr>
</tbody></table>
<div class="note info no-icon flat"><p><strong>ç‰ˆæœ¬è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ¨èä½¿ç”¨prometheus-mysql-exporter 2.10.0æˆ–æ›´æ–°ç‰ˆæœ¬</li>
<li>ChartåŒ…åŒ…å«äº†å®Œæ•´çš„Kubernetesèµ„æºå®šä¹‰</li>
<li>values.yamlæ–‡ä»¶ç”¨äºå®šåˆ¶åŒ–é…ç½®å‚æ•°</li>
</ul>
</div>

<h2 id="2-2-ç¯å¢ƒè¦æ±‚"><a href="#2-2-ç¯å¢ƒè¦æ±‚" class="headerlink" title="2.2. ç¯å¢ƒè¦æ±‚"></a>2.2. ç¯å¢ƒè¦æ±‚</h2><ul>
<li>Kubernetesé›†ç¾¤ç¯å¢ƒ</li>
<li>Helm 3.xå·²å®‰è£…é…ç½®</li>
<li>Prometheus Operatorå·²éƒ¨ç½²</li>
<li>å…·å¤‡é›†ç¾¤ç®¡ç†æƒé™</li>
</ul>
<h1 id="ä¸‰ã€é…ç½®æ­¥éª¤"><a href="#ä¸‰ã€é…ç½®æ­¥éª¤" class="headerlink" title="ä¸‰ã€é…ç½®æ­¥éª¤"></a>ä¸‰ã€é…ç½®æ­¥éª¤</h1><h2 id="3-1-MySQLç›‘æ§è´¦å·åˆ›å»º"><a href="#3-1-MySQLç›‘æ§è´¦å·åˆ›å»º" class="headerlink" title="3.1. MySQLç›‘æ§è´¦å·åˆ›å»º"></a>3.1. MySQLç›‘æ§è´¦å·åˆ›å»º</h2><p>MySQLç›‘æ§è´¦å·ç”¨äºé‡‡é›†MySQLç›‘æ§æ•°æ®ï¼Œéœ€è¦å…·å¤‡ç‰¹å®šçš„æƒé™ä»¥ç¡®ä¿èƒ½å¤Ÿè·å–å®Œæ•´çš„ç›‘æ§æŒ‡æ ‡ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰åˆ›å»ºç›‘æ§ç”¨æˆ·"><a href="#ï¼ˆ1ï¼‰åˆ›å»ºç›‘æ§ç”¨æˆ·" class="headerlink" title="ï¼ˆ1ï¼‰åˆ›å»ºç›‘æ§ç”¨æˆ·"></a>ï¼ˆ1ï¼‰åˆ›å»ºç›‘æ§ç”¨æˆ·</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'exporter'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'your-secure-password'</span> <span class="token keyword">WITH</span> MAX_USER_CONNECTIONS <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰æˆæƒå¿…è¦æƒé™"><a href="#ï¼ˆ2ï¼‰æˆæƒå¿…è¦æƒé™" class="headerlink" title="ï¼ˆ2ï¼‰æˆæƒå¿…è¦æƒé™"></a>ï¼ˆ2ï¼‰æˆæƒå¿…è¦æƒé™</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> PROCESS<span class="token punctuation">,</span> <span class="token keyword">REPLICATION</span> CLIENT<span class="token punctuation">,</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'exporter'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<div class="note warning no-icon flat"><p><strong>å®‰å…¨é…ç½®è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>å°†<code>&#39;exporter&#39;@&#39;%&#39;</code>ä¸­çš„<code>%</code>è°ƒæ•´ä¸ºç”Ÿäº§ç¯å¢ƒK8sçš„å…·ä½“IPæ®µ</li>
<li>è®¾ç½®<code>MAX_USER_CONNECTIONS 3</code>é¿å…ç›‘æ§è¿æ¥è¿‡å¤šå¯¼è‡´æ•°æ®åº“è¿‡è½½</li>
<li>ä½¿ç”¨å¼ºå¯†ç å¹¶å®šæœŸè½®æ¢</li>
<li>ä»…æˆæƒå¿…è¦çš„æœ€å°æƒé™é›†</li>
</ul>
</div>

<h3 id="ï¼ˆ3ï¼‰æƒé™è¯´æ˜"><a href="#ï¼ˆ3ï¼‰æƒé™è¯´æ˜" class="headerlink" title="ï¼ˆ3ï¼‰æƒé™è¯´æ˜"></a>ï¼ˆ3ï¼‰æƒé™è¯´æ˜</h3><table>
<thead>
<tr>
<th>æƒé™ç±»å‹</th>
<th>ç”¨é€”è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>PROCESS</code></td>
<td>æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼Œè·å–è¿æ¥çŠ¶æ€ä¿¡æ¯</td>
</tr>
<tr>
<td><code>REPLICATION CLIENT</code></td>
<td>è·å–ä¸»ä»å¤åˆ¶çŠ¶æ€ä¿¡æ¯</td>
</tr>
<tr>
<td><code>SELECT</code></td>
<td>æŸ¥è¯¢performance_schemaç­‰ç³»ç»Ÿè¡¨</td>
</tr>
</tbody></table>
<h2 id="3-2-é…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#3-2-é…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="3.2. é…ç½®æ–‡ä»¶ä¿®æ”¹"></a>3.2. é…ç½®æ–‡ä»¶ä¿®æ”¹</h2><p>ä¿®æ”¹<code>mysql-exporter-values.yaml</code>é…ç½®æ–‡ä»¶ä¸­çš„å…³é”®é…ç½®é¡¹ï¼š</p>
<h3 id="ï¼ˆ1ï¼‰å¤šç›®æ ‡é…ç½®ç»“æ„"><a href="#ï¼ˆ1ï¼‰å¤šç›®æ ‡é…ç½®ç»“æ„" class="headerlink" title="ï¼ˆ1ï¼‰å¤šç›®æ ‡é…ç½®ç»“æ„"></a>ï¼ˆ1ï¼‰å¤šç›®æ ‡é…ç½®ç»“æ„</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">serviceMonitor</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">additionalLabels</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token key atrule">jobLabel</span><span class="token punctuation">:</span> <span class="token string">""</span>
  <span class="token key atrule">targetLabels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">podTargetLabels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">metricRelabelings</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">relabelings</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token comment"># å¯ç”¨å¤šç›®æ ‡é‡‡é›†</span>
  <span class="token key atrule">multipleTarget</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">targets</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> 172.16.1.15
      <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>db<span class="token punctuation">-</span>write<span class="token punctuation">-</span>master
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3306</span>
      <span class="token key atrule">user</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">password</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>secure<span class="token punctuation">-</span>password
    <span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> 172.16.1.17
      <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>db<span class="token punctuation">-</span>backup<span class="token punctuation">-</span>master
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3306</span>
      <span class="token key atrule">user</span><span class="token punctuation">:</span> exporter
      <span class="token key atrule">password</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>secure<span class="token punctuation">-</span>password
      
  <span class="token comment"># å…±äº«è®¤è¯é…ç½®ï¼ˆå¯é€‰ï¼‰</span>
  <span class="token key atrule">sharedSecret</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰é…ç½®å‚æ•°è¯¦è§£"><a href="#ï¼ˆ2ï¼‰é…ç½®å‚æ•°è¯¦è§£" class="headerlink" title="ï¼ˆ2ï¼‰é…ç½®å‚æ•°è¯¦è§£"></a>ï¼ˆ2ï¼‰é…ç½®å‚æ•°è¯¦è§£</h3><table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>ç¤ºä¾‹å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>endpoint</code></td>
<td><code>172.16.1.15</code></td>
<td>MySQLå®ä¾‹çš„IPåœ°å€æˆ–åŸŸå<br><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨åŸŸåé…ç½®å¤šä¸ªIPæ—¶éœ€ä½¿ç”¨å…·ä½“IPé¿å…æ•°æ®æ··ä¹±</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>app-db-write-master</code></td>
<td>èŠ‚ç‚¹æ ‡è¯†åç§°ï¼Œç”¨äºç›‘æ§é¡µé¢ç­›é€‰<br><strong>å‘½åè§„èŒƒ</strong>ï¼šå¹³å°-ç”¨é€”-è§’è‰²</td>
</tr>
<tr>
<td><code>port</code></td>
<td><code>3306</code></td>
<td>MySQLç«¯å£ï¼Œé»˜è®¤3306ï¼Œå¯é€‰é…ç½®</td>
</tr>
<tr>
<td><code>user</code></td>
<td><code>exporter</code></td>
<td>ç›‘æ§è´¦å·ç”¨æˆ·å</td>
</tr>
<tr>
<td><code>password</code></td>
<td><code>your-secure-password</code></td>
<td>ç›‘æ§è´¦å·å¯†ç <br><strong>æ³¨æ„</strong>ï¼šé¿å…ä½¿ç”¨<code>#</code>ç­‰ç‰¹æ®Šå­—ç¬¦</td>
</tr>
</tbody></table>
<h3 id="ï¼ˆ3ï¼‰å‘½åè§„èŒƒç¤ºä¾‹"><a href="#ï¼ˆ3ï¼‰å‘½åè§„èŒƒç¤ºä¾‹" class="headerlink" title="ï¼ˆ3ï¼‰å‘½åè§„èŒƒç¤ºä¾‹"></a>ï¼ˆ3ï¼‰å‘½åè§„èŒƒç¤ºä¾‹</h3><div class="note success no-icon flat"><p><strong>æ ‡å‡†å‘½åæ ¼å¼</strong>ï¼š<code>å¹³å°-åœ°åŒº-ç”¨é€”-è§’è‰²[-é™„åŠ ä¿¡æ¯]</code></p>
<p><strong>ç¤ºä¾‹è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>app-db-write-master</code>ï¼šåº”ç”¨æ•°æ®åº“å†™å…¥ä¸»èŠ‚ç‚¹</li>
<li><code>app-db-backup-master</code>ï¼šåº”ç”¨æ•°æ®åº“å¤‡ä»½ä¸»èŠ‚ç‚¹  </li>
<li><code>app-db-write-master-slave</code>ï¼šåº”ç”¨æ•°æ®åº“å†™å…¥ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹</li>
<li><code>app-cache-backup-master</code>ï¼šåº”ç”¨ç¼“å­˜å¤‡ä»½ä¸»èŠ‚ç‚¹</li>
<li><code>app-cache-backup-slave</code>ï¼šåº”ç”¨ç¼“å­˜å¤‡ä»½ä»èŠ‚ç‚¹</li>
</ul>
<p><strong>å‘½åçº¦æŸ</strong>ï¼š</p>
<ul>
<li>ä¸èƒ½åŒ…å«<code>.</code>ç­‰ç‰¹æ®Šå­—ç¬¦</li>
<li>å»ºè®®ä½¿ç”¨è‹±æ–‡å­—æ¯å’ŒçŸ­æ¨ªçº¿<code>-</code></li>
<li>ä¿æŒç®€æ´æ˜äº†ï¼Œä¾¿äºè¯†åˆ«</li>
</ul>
</div>

<h1 id="å››ã€éƒ¨ç½²å®æ–½"><a href="#å››ã€éƒ¨ç½²å®æ–½" class="headerlink" title="å››ã€éƒ¨ç½²å®æ–½"></a>å››ã€éƒ¨ç½²å®æ–½</h1><h2 id="4-1-éƒ¨ç½²å‘½ä»¤"><a href="#4-1-éƒ¨ç½²å‘½ä»¤" class="headerlink" title="4.1. éƒ¨ç½²å‘½ä»¤"></a>4.1. éƒ¨ç½²å‘½ä»¤</h2><p>åœ¨å…·å¤‡Helmç¯å¢ƒçš„ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># éƒ¨ç½²MySQLç›‘æ§</span>
helm <span class="token function">install</span> prometheus-mysql-exporter <span class="token punctuation">\</span>
  prometheus-mysql-exporter-2.10.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">2.10</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> mysql-exporter-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-2-éƒ¨ç½²éªŒè¯"><a href="#4-2-éƒ¨ç½²éªŒè¯" class="headerlink" title="4.2. éƒ¨ç½²éªŒè¯"></a>4.2. éƒ¨ç½²éªŒè¯</h2><h3 id="ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€"><a href="#ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€" class="headerlink" title="ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€"></a>ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹PodçŠ¶æ€</span>
kubectl get pods <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> mysql-exporter

<span class="token comment"># æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯</span>
kubectl describe pod <span class="token operator">&lt;</span>mysql-exporter-pod-name<span class="token operator">></span> <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor"><a href="#ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor" class="headerlink" title="ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor"></a>ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹Service</span>
kubectl get <span class="token function">service</span> <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> mysql-exporter

<span class="token comment"># æŸ¥çœ‹ServiceMonitor</span>
kubectl get servicemonitor <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> mysql-exporter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†"><a href="#ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†" class="headerlink" title="ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†"></a>ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç«¯å£è½¬å‘æµ‹è¯•</span>
kubectl port-forward service/prometheus-mysql-exporter <span class="token number">9104</span>:9104 <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># è®¿é—®æŒ‡æ ‡ç«¯ç‚¹</span>
<span class="token function">curl</span> http://localhost:9104/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-å®‰å…¨æ¸…ç†"><a href="#4-3-å®‰å…¨æ¸…ç†" class="headerlink" title="4.3. å®‰å…¨æ¸…ç†"></a>4.3. å®‰å…¨æ¸…ç†</h2><div class="note warning no-icon flat"><p><strong>é‡è¦æé†’</strong>ï¼šéƒ¨ç½²å®Œæˆåï¼Œä¸ºé¿å…é…ç½®æ–‡ä»¶ä¸­æ•°æ®åº“ç›‘æ§è´¦å·åŠå¯†ç æ³„æ¼ï¼Œåº”ç«‹å³åˆ é™¤æœ¬åœ°é…ç½®æ–‡ä»¶ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ é™¤æœ¬åœ°é…ç½®æ–‡ä»¶</span>
<span class="token function">rm</span> mysql-exporter-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>åç»­æŸ¥çœ‹é…ç½®æ–¹å¼</strong>ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é€šè¿‡HelmæŸ¥çœ‹å½“å‰é…ç½®</span>
helm get values prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>

<h1 id="äº”ã€ç›‘æ§é…ç½®ç®¡ç†"><a href="#äº”ã€ç›‘æ§é…ç½®ç®¡ç†" class="headerlink" title="äº”ã€ç›‘æ§é…ç½®ç®¡ç†"></a>äº”ã€ç›‘æ§é…ç½®ç®¡ç†</h1><h2 id="5-1-æ·»åŠ æ–°çš„MySQLå®ä¾‹"><a href="#5-1-æ·»åŠ æ–°çš„MySQLå®ä¾‹" class="headerlink" title="5.1. æ·»åŠ æ–°çš„MySQLå®ä¾‹"></a>5.1. æ·»åŠ æ–°çš„MySQLå®ä¾‹</h2><h3 id="ï¼ˆ1ï¼‰è·å–å½“å‰é…ç½®"><a href="#ï¼ˆ1ï¼‰è·å–å½“å‰é…ç½®" class="headerlink" title="ï¼ˆ1ï¼‰è·å–å½“å‰é…ç½®"></a>ï¼ˆ1ï¼‰è·å–å½“å‰é…ç½®</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯¼å‡ºå½“å‰é…ç½®</span>
helm get values prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring <span class="token operator">></span> current-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰ä¿®æ”¹é…ç½®æ·»åŠ æ–°å®ä¾‹"><a href="#ï¼ˆ2ï¼‰ä¿®æ”¹é…ç½®æ·»åŠ æ–°å®ä¾‹" class="headerlink" title="ï¼ˆ2ï¼‰ä¿®æ”¹é…ç½®æ·»åŠ æ–°å®ä¾‹"></a>ï¼ˆ2ï¼‰ä¿®æ”¹é…ç½®æ·»åŠ æ–°å®ä¾‹</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># åœ¨targetsä¸­æ·»åŠ æ–°çš„MySQLå®ä¾‹</span>
<span class="token key atrule">targets</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> 172.16.1.18
  <span class="token key atrule">name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>write<span class="token punctuation">-</span>master
  <span class="token key atrule">user</span><span class="token punctuation">:</span> exporter
  <span class="token key atrule">password</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>secure<span class="token punctuation">-</span>password<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²"><a href="#ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²" class="headerlink" title="ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²"></a>ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›´æ–°Helméƒ¨ç½²</span>
helm upgrade prometheus-mysql-exporter <span class="token punctuation">\</span>
  prometheus-mysql-exporter-2.10.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">2.10</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> current-values.yaml
  
<span class="token comment"># æ¸…ç†ä¸´æ—¶é…ç½®æ–‡ä»¶</span>
<span class="token function">rm</span> current-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5-2-ç§»é™¤MySQLå®ä¾‹"><a href="#5-2-ç§»é™¤MySQLå®ä¾‹" class="headerlink" title="5.2. ç§»é™¤MySQLå®ä¾‹"></a>5.2. ç§»é™¤MySQLå®ä¾‹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯¼å‡ºé…ç½®å¹¶ç¼–è¾‘</span>
helm get values prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring <span class="token operator">></span> temp-values.yaml

<span class="token comment"># ç¼–è¾‘æ–‡ä»¶ç§»é™¤ä¸éœ€è¦çš„targetsé…ç½®</span>
<span class="token function">vim</span> temp-values.yaml

<span class="token comment"># åº”ç”¨æ›´æ–°</span>
helm upgrade prometheus-mysql-exporter <span class="token punctuation">\</span>
  prometheus-mysql-exporter-2.10.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">2.10</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> temp-values.yaml

<span class="token comment"># æ¸…ç†æ–‡ä»¶</span>
<span class="token function">rm</span> temp-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5-3-å®Œå…¨å¸è½½"><a href="#5-3-å®Œå…¨å¸è½½" class="headerlink" title="5.3. å®Œå…¨å¸è½½"></a>5.3. å®Œå…¨å¸è½½</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¸è½½Helméƒ¨ç½²</span>
helm uninstall prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æ¸…ç†ç›¸å…³Secretï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
kubectl delete secret prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…­ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#å…­ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="å…­ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>å…­ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h1><h2 id="6-1-æ ¸å¿ƒMySQLæŒ‡æ ‡"><a href="#6-1-æ ¸å¿ƒMySQLæŒ‡æ ‡" class="headerlink" title="6.1. æ ¸å¿ƒMySQLæŒ‡æ ‡"></a>6.1. æ ¸å¿ƒMySQLæŒ‡æ ‡</h2><div class="note info no-icon flat"><p><strong>è¿æ¥æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>mysql_global_status_threads_connected</code>ï¼šå½“å‰è¿æ¥æ•°</li>
<li><code>mysql_global_status_threads_running</code>ï¼šæ´»è·ƒè¿æ¥æ•°</li>
<li><code>mysql_global_status_max_used_connections</code>ï¼šå†å²æœ€å¤§è¿æ¥æ•°</li>
</ul>
<p><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>mysql_global_status_queries</code>ï¼šæŸ¥è¯¢æ€»æ•°</li>
<li><code>mysql_global_status_slow_queries</code>ï¼šæ…¢æŸ¥è¯¢æ•°é‡</li>
<li><code>mysql_global_status_innodb_buffer_pool_reads</code>ï¼šç¼“å†²æ± è¯»å–æ¬¡æ•°</li>
</ul>
<p><strong>å¤åˆ¶æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>mysql_slave_lag_seconds</code>ï¼šä¸»ä»å»¶è¿Ÿæ—¶é—´</li>
<li><code>mysql_slave_sql_running</code>ï¼šSQLçº¿ç¨‹è¿è¡ŒçŠ¶æ€</li>
<li><code>mysql_slave_io_running</code>ï¼šIOçº¿ç¨‹è¿è¡ŒçŠ¶æ€</li>
</ul>
</div>

<h2 id="6-2-å‘Šè­¦è§„åˆ™é…ç½®"><a href="#6-2-å‘Šè­¦è§„åˆ™é…ç½®" class="headerlink" title="6.2. å‘Šè­¦è§„åˆ™é…ç½®"></a>6.2. å‘Šè­¦è§„åˆ™é…ç½®</h2><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mysql_alerts
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> MySQLDown
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> mysql_up == 0
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"MySQLå®ä¾‹ä¸å¯ç”¨"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; MySQLå®ä¾‹å·²ä¸‹çº¿"</span>
      
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> MySQLSlaveLag
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> mysql_slave_lag_seconds <span class="token punctuation">></span> 300
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"MySQLä¸»ä»å»¶è¿Ÿè¿‡é«˜"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; ä¸»ä»å»¶è¿Ÿ &#123;&#123; $value &#125;&#125; ç§’"</span>
      
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> MySQLConnectionsHigh
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> mysql_global_status_threads_connected / mysql_global_variables_max_connections <span class="token punctuation">></span> 0.8
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"MySQLè¿æ¥æ•°è¿‡é«˜"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; è¿æ¥ä½¿ç”¨ç‡è¶…è¿‡80%"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸ƒã€æ•…éšœæ’æŸ¥"><a href="#ä¸ƒã€æ•…éšœæ’æŸ¥" class="headerlink" title="ä¸ƒã€æ•…éšœæ’æŸ¥"></a>ä¸ƒã€æ•…éšœæ’æŸ¥</h1><h2 id="7-1-å¸¸è§é—®é¢˜"><a href="#7-1-å¸¸è§é—®é¢˜" class="headerlink" title="7.1. å¸¸è§é—®é¢˜"></a>7.1. å¸¸è§é—®é¢˜</h2><div class="note warning no-icon flat"><p><strong>éƒ¨ç½²å¤±è´¥</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥Helm Chartç‰ˆæœ¬å…¼å®¹æ€§</li>
<li>éªŒè¯namespaceæ˜¯å¦å­˜åœ¨</li>
<li>ç¡®è®¤RBACæƒé™é…ç½®</li>
</ul>
<p><strong>è¿æ¥å¤±è´¥</strong>ï¼š</p>
<ul>
<li>éªŒè¯MySQLè´¦å·æƒé™</li>
<li>æ£€æŸ¥ç½‘ç»œè¿é€šæ€§</li>
<li>ç¡®è®¤é˜²ç«å¢™è§„åˆ™</li>
</ul>
<p><strong>æŒ‡æ ‡ç¼ºå¤±</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ServiceMonitoré…ç½®</li>
<li>éªŒè¯Prometheusé…ç½®</li>
<li>æŸ¥çœ‹exporteræ—¥å¿—</li>
</ul>
</div>

<h2 id="7-2-æ—¥å¿—æ’æŸ¥"><a href="#7-2-æ—¥å¿—æ’æŸ¥" class="headerlink" title="7.2. æ—¥å¿—æ’æŸ¥"></a>7.2. æ—¥å¿—æ’æŸ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹exporteræ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> deployment/prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹Prometheusæ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> prometheus-prometheus-kube-prometheus-prometheus-0 <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æ£€æŸ¥ServiceMonitorçŠ¶æ€</span>
kubectl describe servicemonitor prometheus-mysql-exporter <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é€šè¿‡Helméƒ¨ç½²MySQLç›‘æ§æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>ç®€åŒ–éƒ¨ç½²</strong>ï¼šä¸€æ¬¡æ€§é…ç½®å¤šä¸ªMySQLå®ä¾‹ç›‘æ§</li>
<li><strong>ç»Ÿä¸€ç®¡ç†</strong>ï¼šé›†ä¸­åŒ–çš„é…ç½®ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶</li>
<li><strong>å®‰å…¨å­˜å‚¨</strong>ï¼šæ•æ„Ÿä¿¡æ¯é€šè¿‡Kubernetes Secretå®‰å…¨å­˜å‚¨</li>
<li><strong>çµæ´»æ‰©å±•</strong>ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ å’Œç§»é™¤ç›‘æ§å®ä¾‹</li>
<li><strong>æ ‡å‡†åŒ–</strong>ï¼šç»Ÿä¸€çš„å‘½åè§„èŒƒå’Œæ ‡ç­¾ä½“ç³»</li>
</ol>
<p>æœ¬æ–¹æ¡ˆå¤§å¤§é™ä½äº†MySQLç›‘æ§çš„è¿ç»´å¤æ‚åº¦ï¼Œæå‡äº†ç›‘æ§ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li><a href="https://github.com/prometheus/mysqld_exporter">Prometheus MySQL Exporter</a></li>
<li><a href="https://helm.sh/docs/chart_best_practices/">Helm Chartsæœ€ä½³å®è·µ</a></li>
<li><a href="https://prometheus.io/docs/guides/mysql-monitoring/">MySQLç›‘æ§æŒ‡æ ‡è¯¦è§£</a></li>
</ul>
]]></content>
      <categories>
        <category>ç³»ç»Ÿç›‘æ§</category>
      </categories>
      <tags>
        <tag>Prometheus</tag>
        <tag>MySQL</tag>
        <tag>Helm</tag>
        <tag>æ•°æ®åº“ç›‘æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisé›†ç¾¤ç›‘æ§é…ç½®-Helméƒ¨ç½²æ–¹æ¡ˆ</title>
    <url>/2024/12/30/prometheus/redis-ji-qun-jian-kong-pei-zhi-helm-bu-shu-fang-an/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>ç”Ÿäº§ç¯å¢ƒçš„Redisç›‘æ§å‘Šè­¦ä¸€ç›´å­˜åœ¨å‡†ç¡®æ€§é—®é¢˜ï¼Œé€šè¿‡æ·±å…¥æ’æŸ¥å‘ç°redis-exporteré‡‡é›†æ–¹å¼ä¸æ­£ç¡®ï¼Œå¯¼è‡´ç›‘æ§æŒ‡æ ‡åå·®å’Œå‘Šè­¦è¯¯æŠ¥ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œé‡‡ç”¨æ ‡å‡†åŒ–çš„Helméƒ¨ç½²æ–¹å¼æ¥å®ç°Redisé›†ç¾¤ç›‘æ§é‡‡é›†ã€‚</p>
<p><img src="/2024/12/30/prometheus/redis-ji-qun-jian-kong-pei-zhi-helm-bu-shu-fang-an/Redis%E7%9B%91%E6%8E%A7%E9%87%87%E9%9B%86%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94%E8%AF%B4%E6%98%8E.png" alt="Redisç›‘æ§é‡‡é›†æ–¹å¼å¯¹æ¯”è¯´æ˜"></p>
<div class="note primary no-icon flat"><p><strong>æ ¸å¿ƒè§£å†³é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¿®å¤Redisç›‘æ§æŒ‡æ ‡é‡‡é›†ä¸å‡†ç¡®çš„é—®é¢˜</li>
<li>ç»Ÿä¸€Redisé›†ç¾¤ç›‘æ§éƒ¨ç½²æ–¹å¼</li>
<li>æä¾›å®‰å…¨çš„è®¤è¯ä¿¡æ¯ç®¡ç†</li>
<li>æ”¯æŒå¤šé›†ç¾¤çš„çµæ´»é…ç½®ç®¡ç†</li>
</ul>
</div>

<p>æœ¬æ–¹æ¡ˆé€šè¿‡Helméƒ¨ç½²redis-exporterå®ç°Redisé›†ç¾¤ç›‘æ§é‡‡é›†ï¼Œç¡®ä¿ç›‘æ§æ•°æ®çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</p>
<span id="more"></span>

<h1 id="äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡"><a href="#äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡" class="headerlink" title="äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡"></a>äºŒã€éƒ¨ç½²æ–‡ä»¶å‡†å¤‡</h1><h2 id="2-1-å¿…éœ€æ–‡ä»¶æ¸…å•"><a href="#2-1-å¿…éœ€æ–‡ä»¶æ¸…å•" class="headerlink" title="2.1. å¿…éœ€æ–‡ä»¶æ¸…å•"></a>2.1. å¿…éœ€æ–‡ä»¶æ¸…å•</h2><table>
<thead>
<tr>
<th>æ–‡ä»¶ç±»å‹</th>
<th>æ–‡ä»¶åç§°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Helm Charts</td>
<td><code>prometheus-redis-exporter-6.9.0.tgz</code></td>
<td>prometheus-redis-exporter chartéƒ¨ç½²åŒ…</td>
</tr>
<tr>
<td>é…ç½®æ–‡ä»¶</td>
<td><code>redis-exporter-values.yaml</code></td>
<td>redis-exporteré…ç½®æ–‡ä»¶</td>
</tr>
</tbody></table>
<div class="note info no-icon flat"><p><strong>ç‰ˆæœ¬è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ¨èä½¿ç”¨prometheus-redis-exporter 6.9.0æˆ–æ›´æ–°ç‰ˆæœ¬</li>
<li>ChartåŒ…åŒ…å«äº†å®Œæ•´çš„Kubernetesèµ„æºå®šä¹‰</li>
<li>values.yamlæ–‡ä»¶æ”¯æŒé›†ç¾¤å¤šèŠ‚ç‚¹é…ç½®</li>
</ul>
</div>

<h2 id="2-2-ç¯å¢ƒè¦æ±‚"><a href="#2-2-ç¯å¢ƒè¦æ±‚" class="headerlink" title="2.2. ç¯å¢ƒè¦æ±‚"></a>2.2. ç¯å¢ƒè¦æ±‚</h2><ul>
<li>Kubernetesé›†ç¾¤ç¯å¢ƒ</li>
<li>Helm 3.xå·²å®‰è£…é…ç½®</li>
<li>Prometheus Operatorå·²éƒ¨ç½²</li>
<li>Redisé›†ç¾¤å·²æ­£å¸¸è¿è¡Œ</li>
<li>å…·å¤‡é›†ç¾¤ç®¡ç†æƒé™</li>
</ul>
<h1 id="ä¸‰ã€é…ç½®æ­¥éª¤"><a href="#ä¸‰ã€é…ç½®æ­¥éª¤" class="headerlink" title="ä¸‰ã€é…ç½®æ­¥éª¤"></a>ä¸‰ã€é…ç½®æ­¥éª¤</h1><h2 id="3-1-Rediså¯†é’¥åˆ›å»º"><a href="#3-1-Rediså¯†é’¥åˆ›å»º" class="headerlink" title="3.1. Rediså¯†é’¥åˆ›å»º"></a>3.1. Rediså¯†é’¥åˆ›å»º</h2><p>Rediså¯†é’¥ç”¨äºå®‰å…¨å­˜å‚¨Redisé›†ç¾¤çš„è®¤è¯ä¿¡æ¯ï¼Œé¿å…æ˜æ–‡å¯†ç æ³„éœ²ã€‚</p>
<h3 id="ï¼ˆ1ï¼‰åˆ›å»ºSecretå‘½ä»¤"><a href="#ï¼ˆ1ï¼‰åˆ›å»ºSecretå‘½ä»¤" class="headerlink" title="ï¼ˆ1ï¼‰åˆ›å»ºSecretå‘½ä»¤"></a>ï¼ˆ1ï¼‰åˆ›å»ºSecretå‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kubectl create secret generic app-redis-cluster-secret <span class="token punctuation">\</span>
  --from-literal<span class="token operator">=</span>redis-password<span class="token operator">=</span><span class="token string">'your-redis-password'</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰å‚æ•°è¯´æ˜"><a href="#ï¼ˆ2ï¼‰å‚æ•°è¯´æ˜" class="headerlink" title="ï¼ˆ2ï¼‰å‚æ•°è¯´æ˜"></a>ï¼ˆ2ï¼‰å‚æ•°è¯´æ˜</h3><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç¤ºä¾‹å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Secretåç§°</td>
<td><code>app-redis-cluster-secret</code></td>
<td>Rediså¯†é’¥æ ‡è¯†åç§°</td>
</tr>
<tr>
<td>å¯†ç é”®å</td>
<td><code>redis-password</code></td>
<td>å¯†ç åœ¨Secretä¸­çš„é”®å</td>
</tr>
<tr>
<td>å¯†ç å€¼</td>
<td><code>your-redis-password</code></td>
<td>Redisé›†ç¾¤å®é™…å¯†ç </td>
</tr>
<tr>
<td>å‘½åç©ºé—´</td>
<td><code>monitoring</code></td>
<td>Secretå­˜å‚¨çš„å‘½åç©ºé—´</td>
</tr>
</tbody></table>
<div class="note warning no-icon flat"><p><strong>å®‰å…¨é…ç½®è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>å°†ç¤ºä¾‹ä¸­çš„å¯†é’¥åç§°å’Œå¯†ç æ›¿æ¢ä¸ºç”Ÿäº§ç¯å¢ƒçš„å®é™…å€¼</li>
<li>å¯†ç åº”ç¬¦åˆå¼ºå¯†ç ç­–ç•¥è¦æ±‚</li>
<li>Secretåˆ›å»ºåå¯é€šè¿‡<code>kubectl get secret</code>éªŒè¯</li>
<li>å®šæœŸè½®æ¢Rediså¯†ç å¹¶æ›´æ–°Secret</li>
</ul>
</div>

<h3 id="ï¼ˆ3ï¼‰éªŒè¯Secretåˆ›å»º"><a href="#ï¼ˆ3ï¼‰éªŒè¯Secretåˆ›å»º" class="headerlink" title="ï¼ˆ3ï¼‰éªŒè¯Secretåˆ›å»º"></a>ï¼ˆ3ï¼‰éªŒè¯Secretåˆ›å»º</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ£€æŸ¥Secretæ˜¯å¦åˆ›å»ºæˆåŠŸ</span>
kubectl get secret app-redis-cluster-secret <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹Secretè¯¦ç»†ä¿¡æ¯ï¼ˆä¸æ˜¾ç¤ºå¯†ç å†…å®¹ï¼‰</span>
kubectl describe secret app-redis-cluster-secret <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-2-é…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#3-2-é…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="3.2. é…ç½®æ–‡ä»¶ä¿®æ”¹"></a>3.2. é…ç½®æ–‡ä»¶ä¿®æ”¹</h2><p>ä¿®æ”¹<code>redis-exporter-values.yaml</code>é…ç½®æ–‡ä»¶ä¸­çš„å…³é”®é…ç½®é¡¹ï¼š</p>
<h3 id="ï¼ˆ1ï¼‰æ ¸å¿ƒé…ç½®å‚æ•°"><a href="#ï¼ˆ1ï¼‰æ ¸å¿ƒé…ç½®å‚æ•°" class="headerlink" title="ï¼ˆ1ï¼‰æ ¸å¿ƒé…ç½®å‚æ•°"></a>ï¼ˆ1ï¼‰æ ¸å¿ƒé…ç½®å‚æ•°</h3><table>
<thead>
<tr>
<th>é…ç½®é¡¹</th>
<th>ç¤ºä¾‹å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>service.labels.platform</code></td>
<td><code>app-platform</code></td>
<td>å¹³å°æ ‡è¯†ï¼Œå¦‚ï¼šplatform-aã€platform-bã€platform-c</td>
</tr>
<tr>
<td><code>serviceMonitor.targets</code></td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
<td>Redisé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹é…ç½®</td>
</tr>
<tr>
<td><code>serviceMonitor.interval</code></td>
<td><code>60s</code></td>
<td>ç›‘æ§é‡‡é›†å‘¨æœŸï¼Œå»ºè®®60s</td>
</tr>
<tr>
<td><code>auth.secret.name</code></td>
<td><code>app-redis-cluster-secret</code></td>
<td>æ­¥éª¤3.1åˆ›å»ºçš„å¯†é’¥åç§°</td>
</tr>
</tbody></table>
<h3 id="ï¼ˆ2ï¼‰å®Œæ•´é…ç½®ç¤ºä¾‹"><a href="#ï¼ˆ2ï¼‰å®Œæ•´é…ç½®ç¤ºä¾‹" class="headerlink" title="ï¼ˆ2ï¼‰å®Œæ•´é…ç½®ç¤ºä¾‹"></a>ï¼ˆ2ï¼‰å®Œæ•´é…ç½®ç¤ºä¾‹</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">service</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9121</span>
  <span class="token key atrule">portName</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>exporter
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">platform</span><span class="token punctuation">:</span> <span class="token string">"app-platform"</span>  <span class="token comment"># ä¿®æ”¹ä¸ºå¯¹åº”å¹³å°æ ‡è¯†</span>

<span class="token key atrule">serviceMonitor</span><span class="token punctuation">:</span>
  <span class="token comment"># å¯ç”¨ServiceMonitor</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">multipleTarget</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">targets</span><span class="token punctuation">:</span>
    <span class="token comment"># Redisé›†ç¾¤èŠ‚ç‚¹é…ç½® - éœ€é…ç½®æ‰€æœ‰èŠ‚ç‚¹</span>
    <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"172.16.1.15:6383"</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"app-redis-cluster-node-6383"</span>
    <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"172.16.1.15:6384"</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"app-redis-cluster-node-6384"</span>
    <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"172.16.1.15:6385"</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"app-redis-cluster-node-6385"</span>
  
  <span class="token key atrule">additionalMetricsRelabels</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token key atrule">additionalRelabeling</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token comment"># ServiceMonitoréƒ¨ç½²å‘½åç©ºé—´</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring
  
  <span class="token comment"># Prometheusé‡‡é›†é—´éš”ï¼ˆé‡è¦é…ç½®ï¼‰</span>
  <span class="token key atrule">interval</span><span class="token punctuation">:</span> 60s  <span class="token comment"># ä»é»˜è®¤15sè°ƒæ•´ä¸º60s</span>

<span class="token key atrule">auth</span><span class="token punctuation">:</span>
  <span class="token comment"># å¯ç”¨å¯†ç è®¤è¯</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># ä½¿ç”¨å·²å­˜åœ¨çš„Secret</span>
  <span class="token key atrule">secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"app-redis-cluster-secret"</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token string">"redis-password"</span>
  <span class="token comment"># å½“ä¸ä½¿ç”¨Secretæ—¶çš„å¯†ç é…ç½®ï¼ˆç•™ç©ºï¼‰</span>
  <span class="token key atrule">redisPassword</span><span class="token punctuation">:</span> <span class="token string">""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰é…ç½®è¦ç‚¹è¯´æ˜"><a href="#ï¼ˆ3ï¼‰é…ç½®è¦ç‚¹è¯´æ˜" class="headerlink" title="ï¼ˆ3ï¼‰é…ç½®è¦ç‚¹è¯´æ˜"></a>ï¼ˆ3ï¼‰é…ç½®è¦ç‚¹è¯´æ˜</h3><div class="note success no-icon flat"><p><strong>targetsé…ç½®è§„èŒƒ</strong>ï¼š</p>
<ul>
<li><code>url</code>ï¼šRedisèŠ‚ç‚¹çš„IPå’Œç«¯å£ï¼Œæ ¼å¼ä¸ºâ€IP:PORTâ€</li>
<li><code>name</code>ï¼šèŠ‚ç‚¹æ ‡è¯†åç§°ï¼Œå»ºè®®æ ¼å¼ï¼šâ€å¹³å°-redis-cluster-node-ç«¯å£â€</li>
<li><strong>å¿…é¡»é…ç½®é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹</strong>ï¼Œç¡®ä¿ç›‘æ§è¦†ç›–å®Œæ•´</li>
</ul>
<p><strong>intervalè°ƒæ•´åŸå› </strong>ï¼š</p>
<ul>
<li>Redis-exporterä½¿ç”¨çŸ­è¿æ¥æ–¹å¼é‡‡é›†æ•°æ®</li>
<li>é»˜è®¤15sé—´éš”å¯èƒ½å¯¹Redisé€ æˆå‹åŠ›</li>
<li>è°ƒæ•´ä¸º60så¯å‡å°‘è¿æ¥é¢‘ç‡ï¼Œæå‡ç¨³å®šæ€§</li>
</ul>
</div>

<h2 id="3-3-å¹³å°æ ‡è¯†é…ç½®"><a href="#3-3-å¹³å°æ ‡è¯†é…ç½®" class="headerlink" title="3.3. å¹³å°æ ‡è¯†é…ç½®"></a>3.3. å¹³å°æ ‡è¯†é…ç½®</h2><p>æ ¹æ®ä¸åŒçš„ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®ç›¸åº”çš„å¹³å°æ ‡è¯†ï¼š</p>
<table>
<thead>
<tr>
<th>ç¯å¢ƒç±»å‹</th>
<th>platformé…ç½®å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>åº”ç”¨å¹³å°A</td>
<td><code>platform-a</code></td>
<td>åº”ç”¨å¹³å°Aç¯å¢ƒ</td>
</tr>
<tr>
<td>åº”ç”¨å¹³å°B</td>
<td><code>platform-b</code></td>
<td>åº”ç”¨å¹³å°Bç¯å¢ƒ</td>
</tr>
<tr>
<td>åº”ç”¨å¹³å°C</td>
<td><code>platform-c</code></td>
<td>åº”ç”¨å¹³å°Cç¯å¢ƒ</td>
</tr>
<tr>
<td>æ•°æ®å¹³å°</td>
<td><code>data-platform</code></td>
<td>æ•°æ®å¹³å°ç¯å¢ƒ</td>
</tr>
<tr>
<td>æµ‹è¯•ç¯å¢ƒ</td>
<td><code>test-env</code></td>
<td>æµ‹è¯•ç¯å¢ƒ</td>
</tr>
</tbody></table>
<h1 id="å››ã€éƒ¨ç½²å®æ–½"><a href="#å››ã€éƒ¨ç½²å®æ–½" class="headerlink" title="å››ã€éƒ¨ç½²å®æ–½"></a>å››ã€éƒ¨ç½²å®æ–½</h1><h2 id="4-1-Helmå‘å¸ƒåç§°è§„èŒƒ"><a href="#4-1-Helmå‘å¸ƒåç§°è§„èŒƒ" class="headerlink" title="4.1. Helmå‘å¸ƒåç§°è§„èŒƒ"></a>4.1. Helmå‘å¸ƒåç§°è§„èŒƒ</h2><div class="note info no-icon flat"><p><strong>å‘½åè§„èŒƒ</strong>ï¼š<code>å¹³å°å‰ç¼€-prometheus-redis-exporter</code></p>
<p><strong>æ ‡å‡†ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li><code>platform-a-prometheus-redis-exporter</code></li>
<li><code>platform-b-prometheus-redis-exporter</code></li>
<li><code>data-platform-prometheus-redis-exporter</code></li>
<li><code>app-cluster-prometheus-redis-exporter</code></li>
<li><code>test-env-prometheus-redis-exporter</code></li>
</ul>
<p><strong>é‡è¦è¯´æ˜</strong>ï¼šå¿…é¡»ä¿ç•™<code>prometheus-redis-exporter</code>åç¼€ï¼Œå¦åˆ™Helmä¼šè‡ªåŠ¨æ·»åŠ è¯¥åç¼€å¯¼è‡´åç§°ä¸è§„èŒƒã€‚</p>
</div>

<h2 id="4-2-éƒ¨ç½²å‘½ä»¤"><a href="#4-2-éƒ¨ç½²å‘½ä»¤" class="headerlink" title="4.2. éƒ¨ç½²å‘½ä»¤"></a>4.2. éƒ¨ç½²å‘½ä»¤</h2><p>åœ¨å…·å¤‡Helmç¯å¢ƒçš„ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># éƒ¨ç½²Redisç›‘æ§</span>
helm <span class="token function">install</span> app-prometheus-redis-exporter <span class="token punctuation">\</span>
  prometheus-redis-exporter-6.9.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">6.9</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> redis-exporter-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å¤šç¯å¢ƒéƒ¨ç½²ç¤ºä¾‹"><a href="#å¤šç¯å¢ƒéƒ¨ç½²ç¤ºä¾‹" class="headerlink" title="å¤šç¯å¢ƒéƒ¨ç½²ç¤ºä¾‹"></a>å¤šç¯å¢ƒéƒ¨ç½²ç¤ºä¾‹</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¹³å°Aç¯å¢ƒ</span>
helm <span class="token function">install</span> platform-a-prometheus-redis-exporter <span class="token punctuation">\</span>
  prometheus-redis-exporter-6.9.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">6.9</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> platform-a-redis-exporter-values.yaml

<span class="token comment"># å¹³å°Bç¯å¢ƒ</span>
helm <span class="token function">install</span> platform-b-prometheus-redis-exporter <span class="token punctuation">\</span>
  prometheus-redis-exporter-6.9.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">6.9</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> platform-b-redis-exporter-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-éƒ¨ç½²éªŒè¯"><a href="#4-3-éƒ¨ç½²éªŒè¯" class="headerlink" title="4.3. éƒ¨ç½²éªŒè¯"></a>4.3. éƒ¨ç½²éªŒè¯</h2><h3 id="ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€"><a href="#ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€" class="headerlink" title="ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€"></a>ï¼ˆ1ï¼‰æ£€æŸ¥PodçŠ¶æ€</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹Redis-exporter PodçŠ¶æ€</span>
kubectl get pods <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> redis-exporter

<span class="token comment"># æŸ¥çœ‹å…·ä½“Podè¯¦æƒ…</span>
kubectl describe pod <span class="token operator">&lt;</span>redis-exporter-pod-name<span class="token operator">></span> <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor"><a href="#ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor" class="headerlink" title="ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor"></a>ï¼ˆ2ï¼‰éªŒè¯Serviceå’ŒServiceMonitor</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹Service</span>
kubectl get <span class="token function">service</span> <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> redis-exporter

<span class="token comment"># æŸ¥çœ‹ServiceMonitor</span>
kubectl get servicemonitor <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> redis-exporter<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†"><a href="#ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†" class="headerlink" title="ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†"></a>ï¼ˆ3ï¼‰éªŒè¯æŒ‡æ ‡é‡‡é›†</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç«¯å£è½¬å‘æµ‹è¯•</span>
kubectl port-forward service/app-prometheus-redis-exporter <span class="token number">9121</span>:9121 <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># è®¿é—®æŒ‡æ ‡ç«¯ç‚¹</span>
<span class="token function">curl</span> http://localhost:9121/metrics<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-4-éªŒè¯Redisè¿æ¥"><a href="#4-4-éªŒè¯Redisè¿æ¥" class="headerlink" title="4.4. éªŒè¯Redisè¿æ¥"></a>4.4. éªŒè¯Redisè¿æ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹exporteræ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> deployment/app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æ£€æŸ¥æ˜¯å¦æœ‰è¿æ¥é”™è¯¯</span>
kubectl logs deployment/app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> error<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="äº”ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"><a href="#äº”ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜" class="headerlink" title="äº”ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜"></a>äº”ã€ç›‘æ§æŒ‡æ ‡è¯´æ˜</h1><h2 id="5-1-æ ¸å¿ƒRedisæŒ‡æ ‡"><a href="#5-1-æ ¸å¿ƒRedisæŒ‡æ ‡" class="headerlink" title="5.1. æ ¸å¿ƒRedisæŒ‡æ ‡"></a>5.1. æ ¸å¿ƒRedisæŒ‡æ ‡</h2><div class="note info no-icon flat"><p><strong>è¿æ¥æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>redis_connected_clients</code>ï¼šå½“å‰è¿æ¥çš„å®¢æˆ·ç«¯æ•°é‡</li>
<li><code>redis_connected_slaves</code>ï¼šè¿æ¥çš„ä»èŠ‚ç‚¹æ•°é‡</li>
<li><code>redis_blocked_clients</code>ï¼šé˜»å¡çš„å®¢æˆ·ç«¯æ•°é‡</li>
</ul>
<p><strong>å†…å­˜æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>redis_memory_used_bytes</code>ï¼šRedisä½¿ç”¨çš„å†…å­˜å­—èŠ‚æ•°</li>
<li><code>redis_memory_max_bytes</code>ï¼šRedisæœ€å¤§å¯ç”¨å†…å­˜</li>
<li><code>redis_memory_fragmentation_ratio</code>ï¼šå†…å­˜ç¢ç‰‡ç‡</li>
</ul>
<p><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>redis_total_commands_processed</code>ï¼šæ€»å‘½ä»¤å¤„ç†æ•°</li>
<li><code>redis_instantaneous_ops_per_sec</code>ï¼šæ¯ç§’æ“ä½œæ•°</li>
<li><code>redis_keyspace_hits_total</code>ï¼šé”®ç©ºé—´å‘½ä¸­æ¬¡æ•°</li>
<li><code>redis_keyspace_misses_total</code>ï¼šé”®ç©ºé—´æœªå‘½ä¸­æ¬¡æ•°</li>
</ul>
<p><strong>é›†ç¾¤æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li><code>redis_cluster_enabled</code>ï¼šé›†ç¾¤æ¨¡å¼çŠ¶æ€</li>
<li><code>redis_cluster_slots_assigned</code>ï¼šåˆ†é…çš„é›†ç¾¤æ§½ä½æ•°</li>
<li><code>redis_cluster_slots_ok</code>ï¼šæ­£å¸¸çš„é›†ç¾¤æ§½ä½æ•°</li>
</ul>
</div>

<h2 id="5-2-å‘Šè­¦è§„åˆ™é…ç½®"><a href="#5-2-å‘Šè­¦è§„åˆ™é…ç½®" class="headerlink" title="5.2. å‘Šè­¦è§„åˆ™é…ç½®"></a>5.2. å‘Šè­¦è§„åˆ™é…ç½®</h2><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis_alerts
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> RedisDown
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> redis_up == 0
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Rediså®ä¾‹ä¸å¯ç”¨"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; Rediså®ä¾‹å·²ä¸‹çº¿"</span>
      
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> RedisMemoryHigh
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> redis_memory_used_bytes / redis_memory_max_bytes <span class="token punctuation">></span> 0.9
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Rediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%"</span>
      
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> RedisConnectionsHigh
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> redis_connected_clients <span class="token punctuation">></span> 1000
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 2m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Redisè¿æ¥æ•°è¿‡é«˜"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; è¿æ¥æ•°è¶…è¿‡1000"</span>
      
  <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> RedisClusterSlotsMissing
    <span class="token key atrule">expr</span><span class="token punctuation">:</span> redis_cluster_slots_assigned &lt; redis_cluster_slots_ok
    <span class="token key atrule">for</span><span class="token punctuation">:</span> 1m
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"Redisé›†ç¾¤æ§½ä½å¼‚å¸¸"</span>
      <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; $labels.instance &#125;&#125; é›†ç¾¤æ§½ä½åˆ†é…å¼‚å¸¸"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…­ã€Grafanaç›‘æ§é…ç½®"><a href="#å…­ã€Grafanaç›‘æ§é…ç½®" class="headerlink" title="å…­ã€Grafanaç›‘æ§é…ç½®"></a>å…­ã€Grafanaç›‘æ§é…ç½®</h1><h2 id="6-1-å®˜æ–¹Dashboard"><a href="#6-1-å®˜æ–¹Dashboard" class="headerlink" title="6.1. å®˜æ–¹Dashboard"></a>6.1. å®˜æ–¹Dashboard</h2><p>Redis-exporteræä¾›äº†å®˜æ–¹çš„Grafana Dashboardé…ç½®ï¼š</p>
<div class="note success no-icon flat"><p><strong>Dashboardåœ°å€</strong>ï¼š<br><a href="https://github.com/oliver006/redis_exporter/blob/master/contrib/grafana_prometheus_redis_dashboard.json">https://github.com/oliver006/redis_exporter/blob/master/contrib/grafana_prometheus_redis_dashboard.json</a></p>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š</p>
<ol>
<li>ä¸‹è½½JSONé…ç½®æ–‡ä»¶</li>
<li>åœ¨Grafanaä¸­å¯¼å…¥Dashboard</li>
<li>é…ç½®æ•°æ®æºä¸ºå¯¹åº”çš„Prometheus</li>
<li>æ ¹æ®å®é™…æ ‡ç­¾è°ƒæ•´æŸ¥è¯¢æ¡ä»¶</li>
</ol>
</div>

<h2 id="6-2-è‡ªå®šä¹‰ç›‘æ§é¢æ¿"><a href="#6-2-è‡ªå®šä¹‰ç›‘æ§é¢æ¿" class="headerlink" title="6.2. è‡ªå®šä¹‰ç›‘æ§é¢æ¿"></a>6.2. è‡ªå®šä¹‰ç›‘æ§é¢æ¿</h2><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"dashboard"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Redisé›†ç¾¤ç›‘æ§"</span><span class="token punctuation">,</span>
    <span class="token property">"panels"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Redisè¿æ¥æ•°"</span><span class="token punctuation">,</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"graph"</span><span class="token punctuation">,</span>
        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"redis_connected_clients&#123;platform=\"$platform\"&#125;"</span><span class="token punctuation">,</span>
            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"&#123;&#123;instance&#125;&#125; - è¿æ¥æ•°"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"å†…å­˜ä½¿ç”¨ç‡"</span><span class="token punctuation">,</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"graph"</span><span class="token punctuation">,</span>
        <span class="token property">"targets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"expr"</span><span class="token operator">:</span> <span class="token string">"redis_memory_used_bytes&#123;platform=\"$platform\"&#125; / redis_memory_max_bytes&#123;platform=\"$platform\"&#125; * 100"</span><span class="token punctuation">,</span>
            <span class="token property">"legendFormat"</span><span class="token operator">:</span> <span class="token string">"&#123;&#123;instance&#125;&#125; - å†…å­˜ä½¿ç”¨ç‡%"</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ä¸ƒã€é…ç½®ç®¡ç†"><a href="#ä¸ƒã€é…ç½®ç®¡ç†" class="headerlink" title="ä¸ƒã€é…ç½®ç®¡ç†"></a>ä¸ƒã€é…ç½®ç®¡ç†</h1><h2 id="7-1-æ·»åŠ æ–°çš„RedisèŠ‚ç‚¹"><a href="#7-1-æ·»åŠ æ–°çš„RedisèŠ‚ç‚¹" class="headerlink" title="7.1. æ·»åŠ æ–°çš„RedisèŠ‚ç‚¹"></a>7.1. æ·»åŠ æ–°çš„RedisèŠ‚ç‚¹</h2><h3 id="ï¼ˆ1ï¼‰æ›´æ–°é…ç½®æ–‡ä»¶"><a href="#ï¼ˆ1ï¼‰æ›´æ–°é…ç½®æ–‡ä»¶" class="headerlink" title="ï¼ˆ1ï¼‰æ›´æ–°é…ç½®æ–‡ä»¶"></a>ï¼ˆ1ï¼‰æ›´æ–°é…ç½®æ–‡ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è·å–å½“å‰é…ç½®</span>
helm get values app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring <span class="token operator">></span> current-values.yaml

<span class="token comment"># ç¼–è¾‘é…ç½®æ·»åŠ æ–°èŠ‚ç‚¹</span>
<span class="token function">vim</span> current-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ2ï¼‰åœ¨targetsä¸­æ·»åŠ æ–°èŠ‚ç‚¹"><a href="#ï¼ˆ2ï¼‰åœ¨targetsä¸­æ·»åŠ æ–°èŠ‚ç‚¹" class="headerlink" title="ï¼ˆ2ï¼‰åœ¨targetsä¸­æ·»åŠ æ–°èŠ‚ç‚¹"></a>ï¼ˆ2ï¼‰åœ¨targetsä¸­æ·»åŠ æ–°èŠ‚ç‚¹</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">targets</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">"172.16.1.15:6386"</span>  <span class="token comment"># æ–°èŠ‚ç‚¹</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"app-redis-cluster-node-6386"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²"><a href="#ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²" class="headerlink" title="ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²"></a>ï¼ˆ3ï¼‰æ›´æ–°éƒ¨ç½²</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ›´æ–°Helméƒ¨ç½²</span>
helm upgrade app-prometheus-redis-exporter <span class="token punctuation">\</span>
  prometheus-redis-exporter-6.9.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">6.9</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> current-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="7-2-ä¿®æ”¹ç›‘æ§é—´éš”"><a href="#7-2-ä¿®æ”¹ç›‘æ§é—´éš”" class="headerlink" title="7.2. ä¿®æ”¹ç›‘æ§é—´éš”"></a>7.2. ä¿®æ”¹ç›‘æ§é—´éš”</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä¿®æ”¹intervalé…ç½®</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/interval: 60s/interval: 30s/g'</span> current-values.yaml

<span class="token comment"># åº”ç”¨æ›´æ–°</span>
helm upgrade app-prometheus-redis-exporter <span class="token punctuation">\</span>
  prometheus-redis-exporter-6.9.0.tgz <span class="token punctuation">\</span>
  <span class="token parameter variable">--version</span> <span class="token number">6.9</span>.0 <span class="token punctuation">\</span>
  <span class="token parameter variable">-n</span> monitoring <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> current-values.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="7-3-å®Œå…¨å¸è½½"><a href="#7-3-å®Œå…¨å¸è½½" class="headerlink" title="7.3. å®Œå…¨å¸è½½"></a>7.3. å®Œå…¨å¸è½½</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¸è½½Helméƒ¨ç½²</span>
helm uninstall app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æ¸…ç†Secretï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
kubectl delete secret app-redis-cluster-secret <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="å…«ã€æ•…éšœæ’æŸ¥"><a href="#å…«ã€æ•…éšœæ’æŸ¥" class="headerlink" title="å…«ã€æ•…éšœæ’æŸ¥"></a>å…«ã€æ•…éšœæ’æŸ¥</h1><h2 id="8-1-å¸¸è§é—®é¢˜"><a href="#8-1-å¸¸è§é—®é¢˜" class="headerlink" title="8.1. å¸¸è§é—®é¢˜"></a>8.1. å¸¸è§é—®é¢˜</h2><div class="note warning no-icon flat"><p><strong>éƒ¨ç½²å¤±è´¥</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥Secretæ˜¯å¦æ­£ç¡®åˆ›å»º</li>
<li>éªŒè¯Redisé›†ç¾¤è¿é€šæ€§</li>
<li>ç¡®è®¤Helm Chartç‰ˆæœ¬å…¼å®¹æ€§</li>
</ul>
<p><strong>è¿æ¥å¤±è´¥</strong>ï¼š</p>
<ul>
<li>éªŒè¯Rediså¯†ç æ­£ç¡®æ€§</li>
<li>æ£€æŸ¥ç½‘ç»œè¿é€šæ€§å’Œé˜²ç«å¢™</li>
<li>ç¡®è®¤Redisé…ç½®å…è®¸å¤–éƒ¨è¿æ¥</li>
</ul>
<p><strong>æŒ‡æ ‡ç¼ºå¤±</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥ServiceMonitoré…ç½®</li>
<li>éªŒè¯targetsé…ç½®æ­£ç¡®æ€§</li>
<li>æŸ¥çœ‹exporteræ—¥å¿—é”™è¯¯ä¿¡æ¯</li>
</ul>
</div>

<h2 id="8-2-æ—¥å¿—æ’æŸ¥"><a href="#8-2-æ—¥å¿—æ’æŸ¥" class="headerlink" title="8.2. æ—¥å¿—æ’æŸ¥"></a>8.2. æ—¥å¿—æ’æŸ¥</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æŸ¥çœ‹exporteræ—¥å¿—</span>
kubectl logs <span class="token parameter variable">-f</span> deployment/app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring

<span class="token comment"># æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯æ—¥å¿—</span>
kubectl logs deployment/app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring <span class="token parameter variable">--tail</span><span class="token operator">=</span><span class="token number">100</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> error

<span class="token comment"># æ£€æŸ¥ServiceMonitorçŠ¶æ€</span>
kubectl describe servicemonitor app-prometheus-redis-exporter <span class="token parameter variable">-n</span> monitoring<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="8-3-è¿æ¥æµ‹è¯•"><a href="#8-3-è¿æ¥æµ‹è¯•" class="headerlink" title="8.3. è¿æ¥æµ‹è¯•"></a>8.3. è¿æ¥æµ‹è¯•</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æµ‹è¯•Redisè¿æ¥</span>
redis-cli <span class="token parameter variable">-h</span> <span class="token number">172.16</span>.1.15 <span class="token parameter variable">-p</span> <span class="token number">6383</span> <span class="token parameter variable">-a</span> your-password <span class="token function">ping</span>

<span class="token comment"># æ£€æŸ¥é›†ç¾¤çŠ¶æ€</span>
redis-cli <span class="token parameter variable">-h</span> <span class="token number">172.16</span>.1.15 <span class="token parameter variable">-p</span> <span class="token number">6383</span> <span class="token parameter variable">-a</span> your-password cluster nodes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é€šè¿‡Helméƒ¨ç½²Redisé›†ç¾¤ç›‘æ§æ–¹æ¡ˆè§£å†³äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š</p>
<ol>
<li><strong>å‡†ç¡®æ€§æå‡</strong>ï¼šä¿®å¤äº†åŸæœ‰é‡‡é›†æ–¹å¼çš„é—®é¢˜ï¼Œç¡®ä¿ç›‘æ§æ•°æ®å‡†ç¡®æ€§</li>
<li><strong>æ ‡å‡†åŒ–éƒ¨ç½²</strong>ï¼šç»Ÿä¸€çš„Helm Chartç®¡ç†ï¼Œç®€åŒ–éƒ¨ç½²å’Œç»´æŠ¤æµç¨‹</li>
<li><strong>å®‰å…¨ç®¡ç†</strong>ï¼šé€šè¿‡Kubernetes Secretå®‰å…¨å­˜å‚¨è®¤è¯ä¿¡æ¯</li>
<li><strong>çµæ´»é…ç½®</strong>ï¼šæ”¯æŒå¤šé›†ç¾¤ã€å¤šèŠ‚ç‚¹çš„çµæ´»é…ç½®ç®¡ç†</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåˆç†çš„é‡‡é›†é—´éš”é…ç½®ï¼Œé™ä½å¯¹Redisçš„å½±å“</li>
</ol>
<p>æœ¬æ–¹æ¡ˆä¸ºRedisé›†ç¾¤ç›‘æ§æä¾›äº†å¯é çš„åŸºç¡€è®¾æ–½ï¼Œç¡®ä¿äº†ç”Ÿäº§ç¯å¢ƒç›‘æ§çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li><a href="https://github.com/oliver006/redis_exporter">Redis Exporterå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://prometheus.io/docs/guides/redis-monitoring/">Prometheus Redisç›‘æ§æœ€ä½³å®è·µ</a></li>
<li><a href="https://helm.sh/docs/chart_best_practices/">Helm Chartsæœ€ä½³å®è·µ</a></li>
</ul>
]]></content>
      <categories>
        <category>ç³»ç»Ÿç›‘æ§</category>
      </categories>
      <tags>
        <tag>Prometheus</tag>
        <tag>Redis</tag>
        <tag>Helm</tag>
        <tag>é›†ç¾¤ç›‘æ§</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”Ÿäº§åº”ç”¨æ—¥å¿—ç›‘æ§å‘Šè­¦æ–¹æ¡ˆ</title>
    <url>/2024/12/30/prometheus/sheng-chan-ying-yong-ri-zhi-jian-kong-gao-jing-fang-an/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>ç”Ÿäº§ä¹‹å‰å‡ºç°è¿‡è®¸å¤šä¸šåŠ¡å¼‚å¸¸çš„æƒ…å†µæœªèƒ½åŠæ—¶å‘ç°ï¼Œè¿™äº›å¼‚å¸¸å‡ºç°æ—¶æœ‰å¤§é‡çš„å¼‚å¸¸æ—¥å¿—æ‰“å°ï¼Œä½†æ˜¯ç”±äºç¼ºä¹æ—¥å¿—ç›‘æ§ï¼Œæœªèƒ½åŠæ—¶å‘ç°å¼‚å¸¸å¹¶è¿›è¡Œå¤„ç†ã€‚</p>
<p>è¯¥æ–¹æ¡ˆè®¡åˆ’å¯¹ç”Ÿäº§æ‰€æœ‰çš„å¼‚å¸¸æ—¥å¿—è¿›è¡Œç›‘æ§åŠå‘Šè­¦é…ç½®ï¼ŒåŠæ—¶å‘ç°ç”Ÿäº§æ—¥å¿—å¼‚å¸¸ï¼Œå¿«é€Ÿå“åº”å¤„ç†ã€‚</p>
<span id="more"></span>

<h1 id="äºŒã€æ—¥å¿—åŠç›‘æ§é‡‡é›†æ–¹æ¡ˆ"><a href="#äºŒã€æ—¥å¿—åŠç›‘æ§é‡‡é›†æ–¹æ¡ˆ" class="headerlink" title="äºŒã€æ—¥å¿—åŠç›‘æ§é‡‡é›†æ–¹æ¡ˆ"></a>äºŒã€æ—¥å¿—åŠç›‘æ§é‡‡é›†æ–¹æ¡ˆ</h1><p>ç”Ÿäº§çš„æ—¥å¿—é‡‡é›†å’Œç›‘æ§å‡åŸºäºPromtailç»„ä»¶å®ç°ï¼Œå…·ä½“çš„åŸç†å¦‚ä¸‹ï¼š</p>
<div class="note info no-icon flat"><ol>
<li>Promtailç›‘å¬æ—¥å¿—æ–‡ä»¶å˜åŒ–ï¼Œä¸»åŠ¨å°†æ—¥å¿—æ•°æ®æ¨é€åˆ°LokiæœåŠ¡ç«¯å®ç°æ—¥å¿—æ•°æ®é‡‡é›†ï¼›</li>
<li>Promtailé‡‡é›†æ—¥å¿—å†…å®¹æ—¶æ ¹æ®é…ç½®åšæ—¥å¿—ç›‘æ§æŒ‡æ ‡èšåˆè¿ç®—ï¼ŒPrometheusä¸»åŠ¨åˆ°Promtailæ‹‰å–èšåˆçš„æ—¥å¿—ç›‘æ§æŒ‡æ ‡ï¼›</li>
</ol>
</div>

<p><img src="/2024/12/30/prometheus/sheng-chan-ying-yong-ri-zhi-jian-kong-gao-jing-fang-an/%E5%9F%BA%E4%BA%8EPromtail%E7%9A%84%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="åŸºäºPromtailçš„æ—¥å¿—ç›‘æ§æ¶æ„å›¾"><br><em>å›¾ï¼šåŸºäºPromtailçš„æ—¥å¿—å’Œæ—¥å¿—ç›‘æ§é‡‡é›†æ¶æ„</em></p>
<h2 id="2-1-æ—¥å¿—ç›‘æ§ä¸¤ç§å®ç°æ–¹å¼å¯¹æ¯”"><a href="#2-1-æ—¥å¿—ç›‘æ§ä¸¤ç§å®ç°æ–¹å¼å¯¹æ¯”" class="headerlink" title="2.1. æ—¥å¿—ç›‘æ§ä¸¤ç§å®ç°æ–¹å¼å¯¹æ¯”"></a>2.1. æ—¥å¿—ç›‘æ§ä¸¤ç§å®ç°æ–¹å¼å¯¹æ¯”</h2><p>æ—¥å¿—ç›‘æ§ä¸¤ç§å®ç°æ–¹å¼åŒ…æ‹¬ï¼šPromtail ä¸­çš„ metrics é˜¶æ®µå’Œ Loki çš„ ruler ç»„ä»¶ã€‚</p>
<div class="note primary no-icon flat"><p><strong>æ–¹æ¡ˆä¸€ï¼šPromtailåœ¨æ—¥å¿—é‡‡é›†æ—¶è¿›è¡Œæ—¥å¿—ç›‘æ§æŒ‡æ ‡çš„æ”¶é›†</strong></p>
<ul>
<li>ç›‘æ§æŒ‡æ ‡é‡‡é›†é€Ÿåº¦é«˜ã€æ— å»¶è¿Ÿ</li>
<li>å‘Šè­¦è§„åˆ™ä½¿ç”¨Prometheusçš„å‘Šè­¦è§„åˆ™å³å¯</li>
<li>éœ€è¦åœ¨Promtailä¾§é…ç½®æ—¥å¿—å‘Šè­¦æŒ‡æ ‡</li>
</ul>
</div>

<div class="note warning no-icon flat"><p><strong>æ–¹æ¡ˆäºŒï¼šLokiçš„Rulerç»„ä»¶å®šæ—¶æ ¹æ®é…ç½®æŸ¥è¯¢</strong></p>
<ul>
<li>æ ¹æ®é…ç½®çš„å‘Šè­¦è§„åˆ™è§¦å‘å‘Šè­¦</li>
<li>å­˜åœ¨æ—¥å¿—é‡‡é›†å»¶è¿Ÿã€æµ·é‡æ—¥å¿—æŸ¥è¯¢æ€§èƒ½å·®ç­‰é—®é¢˜</li>
<li>å‘Šè­¦è§„åˆ™éœ€è¦åœ¨Lokiä¾§ç‹¬ç«‹é…ç½®ç®¡ç†</li>
</ul>
</div>

<p><img src="/2024/12/30/prometheus/sheng-chan-ying-yong-ri-zhi-jian-kong-gao-jing-fang-an/%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.png" alt="æ—¥å¿—ç›‘æ§æ–¹æ¡ˆå¯¹æ¯”"><br><em>å›¾ï¼šPromtailçš„Metrics VS Lokiçš„Ruleç»„ä»¶å¯¹æ¯”</em></p>
<p><strong>æ€»ç»“</strong>ï¼šä»æ€§èƒ½å’ŒåŠæ—¶æ€§ç»¼åˆè¯„ä¼°ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ–¹æ¡ˆä¸€æ›´é€‚åˆã€‚</p>
<h1 id="ä¸‰ã€æ—¥å¿—é‡‡é›†é…ç½®"><a href="#ä¸‰ã€æ—¥å¿—é‡‡é›†é…ç½®" class="headerlink" title="ä¸‰ã€æ—¥å¿—é‡‡é›†é…ç½®"></a>ä¸‰ã€æ—¥å¿—é‡‡é›†é…ç½®</h1><p>ç”Ÿäº§ç¯å¢ƒç›®å‰æ‰€æœ‰åº”ç”¨å‡å·²å®ç°åŸºäºPromtailçš„æ—¥å¿—é‡‡é›†ï¼Œä½†æ˜¯æœ‰è™šæ‹Ÿæœºå’ŒK8så®¹å™¨ç¯å¢ƒä¸¤ç§åŒºåˆ«ã€‚</p>
<h2 id="3-1-è™šæ‹Ÿæœºæ—¥å¿—é‡‡é›†é…ç½®"><a href="#3-1-è™šæ‹Ÿæœºæ—¥å¿—é‡‡é›†é…ç½®" class="headerlink" title="3.1. è™šæ‹Ÿæœºæ—¥å¿—é‡‡é›†é…ç½®"></a>3.1. è™šæ‹Ÿæœºæ—¥å¿—é‡‡é›†é…ç½®</h2><p>è™šæ‹Ÿæœºè¿›è¡Œæ—¥å¿—é‡‡é›†æ—¶ï¼Œä¸Šä¼ Promtailç»„ä»¶åˆ°æœåŠ¡å™¨ï¼Œç„¶åé…ç½®Promtailçš„é…ç½®æ–‡ä»¶ï¼š</p>
<p><strong>config.yamlé…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#promtailå½“ä½œä¸€ä¸ªæœåŠ¡ç«¯ï¼ŒPrometheusé€šè¿‡è¯¥æœåŠ¡æŠ“å–ç›‘æ§æŒ‡æ ‡</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">http_listen_port</span><span class="token punctuation">:</span> <span class="token number">9080</span>
  <span class="token key atrule">grpc_listen_port</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token comment">#2.7.2ç‰ˆæœ¬å¢åŠ çš„ä»æ–°åŠ è½½é…ç½®æ–‡ä»¶çš„é…ç½®ï¼Œå¯ä»¥è®¿é—®:http://ip:9080/reloadæ¥ä»æ–°åŠ è½½é…ç½®æ–‡ä»¶</span>
<span class="token key atrule">enable_runtime_reload</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">clients</span><span class="token punctuation">:</span>
  <span class="token comment">#éœ€è¦æ¨é€ç»™çš„LokiæœåŠ¡ç«¯çš„åœ°å€ï¼Œå¯ä»¥é…ç½®å¤šä¸ªï¼ŒåŒæ—¶æœå‘å¤šä¸ªLokiæ¨é€æ—¥å¿—</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki.example.com<span class="token punctuation">:</span>30669/loki/api/v1/push

<span class="token key atrule">positions</span><span class="token punctuation">:</span>
  <span class="token comment">#Promtailé‡‡é›†åˆ°æ—¥å¿—çš„æ—¶å€™ï¼Œä¼šæŠŠå·²ç»å‘é€ç»™LokiæˆåŠŸçš„æ—¥å¿—çš„å­—èŠ‚åç§»é‡è®°å½•åˆ°è¿™ä¸ªæ–‡ä»¶å½“ä¸­</span>
  <span class="token key atrule">filename</span><span class="token punctuation">:</span> ./positions.yaml

<span class="token key atrule">target_config</span><span class="token punctuation">:</span>
  <span class="token comment">#è¿™ä¸ªæ˜¯åŒæ­¥é‡‡é›†çš„targetçš„fileçš„ç›‘æ§çš„çš„æ—¶é—´ï¼Œé»˜è®¤ä¹Ÿæ˜¯10s</span>
  <span class="token key atrule">sync_period</span><span class="token punctuation">:</span> 10s

<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>system<span class="token punctuation">-</span>log
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> localhost
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">node</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>node
          <span class="token key atrule">job</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>system<span class="token punctuation">-</span>log
          <span class="token key atrule">type</span><span class="token punctuation">:</span> system
          <span class="token key atrule">__path__</span><span class="token punctuation">:</span> /var/log/syslog
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>logs <span class="token comment">#jobçš„åå­—ï¼Œå¯ä»¥åœ¨lokiä¸Šé¢æœç´¢æ¡ä»¶:job="pod-logs"</span>
    <span class="token key atrule">kubernetes_sd_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> pod<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-1-1-å¯åŠ¨å‘½ä»¤"><a href="#3-1-1-å¯åŠ¨å‘½ä»¤" class="headerlink" title="3.1.1. å¯åŠ¨å‘½ä»¤"></a>3.1.1. å¯åŠ¨å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nohup</span> ./promtail-linux-amd64 <span class="token parameter variable">-config.file</span><span class="token operator">=</span>./config.yaml <span class="token operator">></span> promtail.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Promtailå¯åŠ¨åä¼šæ ¹æ®é…ç½®æ–‡ä»¶config.yamlä¸­çš„é…ç½®çš„__path__è·¯å¾„ï¼Œç›‘å¬è·¯å¾„ä¸‹æ–‡ä»¶ï¼Œé‡‡é›†ä¸ŠæŠ¥è‡³Lokiã€‚</p>
<h2 id="3-2-k8så®¹å™¨æ—¥å¿—é‡‡é›†é…ç½®"><a href="#3-2-k8så®¹å™¨æ—¥å¿—é‡‡é›†é…ç½®" class="headerlink" title="3.2. k8så®¹å™¨æ—¥å¿—é‡‡é›†é…ç½®"></a>3.2. k8så®¹å™¨æ—¥å¿—é‡‡é›†é…ç½®</h2><p>åœ¨å®¹å™¨ç¯å¢ƒä¸­ï¼ŒPromtailé‡‡ç”¨DaemonSetçš„éƒ¨ç½²ï¼Œé‡‡é›†Podä¸­çš„æ—¥å¿—ä¿¡æ¯ã€‚</p>
<div class="note info no-icon flat"><p><strong>DaemonSetç®€ä»‹</strong>ï¼š</p>
<ul>
<li>DaemonSet å®šä¹‰äº†æä¾›èŠ‚ç‚¹æœ¬åœ°è®¾æ–½çš„ Pod</li>
<li>DaemonSet ç¡®ä¿å…¨éƒ¨ï¼ˆæˆ–è€…æŸäº›ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ª Pod çš„å‰¯æœ¬</li>
<li>å½“æœ‰èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ï¼Œä¹Ÿä¼šä¸ºä»–ä»¬æ–°å¢ä¸€ä¸ª Pod</li>
<li>å½“æœ‰èŠ‚ç‚¹ä»é›†ç¾¤ç§»é™¤æ—¶ï¼Œè¿™äº› Pod ä¹Ÿä¼šè¢«å›æ”¶</li>
</ul>
</div>

<p><strong>DaemonSet çš„å…¸å‹ç”¨æ³•ï¼š</strong></p>
<ul>
<li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œé›†ç¾¤å®ˆæŠ¤è¿›ç¨‹</li>
<li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œæ—¥å¿—æ”¶é›†å®ˆæŠ¤è¿›ç¨‹</li>
<li>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç›‘æ§å®ˆæŠ¤è¿›ç¨‹</li>
</ul>
<p>DaemonSetä¸­é€šè¿‡configMapé…ç½®Promtailçš„é…ç½®æ–‡ä»¶ã€‚</p>
<p><img src="/2024/12/30/prometheus/sheng-chan-ying-yong-ri-zhi-jian-kong-gao-jing-fang-an/k8s-daemonset-architecture.png" alt="K8s DaemonSetéƒ¨ç½²æ¶æ„"><br><em>å›¾ï¼šK8sç¯å¢ƒä¸­DaemonSetéƒ¨ç½²Promtailçš„æ¶æ„ç¤ºæ„</em></p>
<h1 id="å››ã€æ—¥å¿—ç›‘æ§é…ç½®"><a href="#å››ã€æ—¥å¿—ç›‘æ§é…ç½®" class="headerlink" title="å››ã€æ—¥å¿—ç›‘æ§é…ç½®"></a>å››ã€æ—¥å¿—ç›‘æ§é…ç½®</h1><p>åœ¨ç¬¬ä¸‰ç« èŠ‚ä¸­ï¼Œä»‹ç»äº†Promtailæ—¥å¿—é‡‡é›†çš„é…ç½®ï¼Œè¿™ä¸ªç« èŠ‚ä»‹ç»å¦‚æœé…ç½®æ—¥å¿—ç›‘æ§ã€‚</p>
<h2 id="4-1-æ—¥å¿—ç›‘æ§åŸç†"><a href="#4-1-æ—¥å¿—ç›‘æ§åŸç†" class="headerlink" title="4.1. æ—¥å¿—ç›‘æ§åŸç†"></a>4.1. æ—¥å¿—ç›‘æ§åŸç†</h2><p>Promtailçš„æ—¥å¿—ç›‘æ§åŸºäºPipelineå®ç°ï¼ŒPromtailçš„Pipelineå…¶å®å°±æ˜¯ç”¨æ¥å¯¹ä¸€è¡Œæ—¥å¿—æ‰§è¡Œæ“ä½œçš„æµæ°´çº¿ï¼Œç”±ç»Ÿç§°ä¸ºstages(é˜¶æ®µ)è¿™ä¸ªä¸“ä¸šæœ¯è¯­æ¥ç»„æˆçš„ã€‚</p>
<div class="note primary no-icon flat"><p><strong>Pipelineä¸»è¦åˆ†ä¸ºå››ç§ç±»å‹çš„stagesï¼š</strong></p>
<ol>
<li><strong>Parsing stages</strong>ï¼šè§£æå½“å‰çš„æ—¥å¿—è¡Œï¼Œæå–æ•°æ®ï¼Œæå–çš„æ•°æ®äº¤ç»™ä¸‹ä¸€ä¸ªstageså¤„ç†</li>
<li><strong>Transform stages</strong>ï¼šè½¬æ¢æå–çš„æ•°æ®ï¼Œä»ä¸€ä¸ªç»„æ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªç»„</li>
<li><strong>Action stages</strong>ï¼šæ‹¿åˆ°æå–çš„æ•°æ®åšå¤„ç†ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹çš„åŠ¨ä½œï¼š<ul>
<li>å¯¹æ ‡ç­¾æ‰§è¡Œæ–°å¢&#x2F;ä¿®æ”¹&#x2F;åˆ é™¤</li>
<li>ä¿®æ”¹æ—¥å¿—è¡Œçš„timestamp</li>
<li>ä¿®æ”¹æ—¥å¿—çš„å†…å®¹</li>
<li>åŸºäºæå–çš„æ•°æ®åˆ›å»ºä¸€ä¸ªæŒ‡æ ‡(æˆ‘ä»¬éœ€è¦çš„)</li>
</ul>
</li>
</ol>
</div>

<blockquote>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://grafana.com/docs/loki/latest/send-data/promtail/stages/">https://grafana.com/docs/loki/latest/send-data/promtail/stages/</a></p>
</blockquote>
<p>æ—¥å¿—ç›‘æ§ä¸»è¦åŸºäºPromtail Pipelineçš„regexå’Œmetricsä¸¤ä¸ªstageï¼š</p>
<ol>
<li><strong>regex</strong>ï¼šä½¿ç”¨æ­£åˆ™æå–æ•°æ®</li>
<li><strong>metrics</strong>ï¼šæ ¹æ®æå–çš„æ•°æ®ç›‘æ§æŒ‡æ ‡</li>
</ol>
<p><img src="/2024/12/30/prometheus/sheng-chan-ying-yong-ri-zhi-jian-kong-gao-jing-fang-an/promtail-pipeline-flow.png" alt="Promtail Pipelineå¤„ç†æµç¨‹"><br><em>å›¾ï¼šPromtail Pipelineçš„æ—¥å¿—å¤„ç†æµç¨‹</em></p>
<h2 id="4-2-æ—¥å¿—ç›‘æ§é…ç½®è¯´æ˜"><a href="#4-2-æ—¥å¿—ç›‘æ§é…ç½®è¯´æ˜" class="headerlink" title="4.2. æ—¥å¿—ç›‘æ§é…ç½®è¯´æ˜"></a>4.2. æ—¥å¿—ç›‘æ§é…ç½®è¯´æ˜</h2><p>Promtail Pipelineå„ä¸ªStateçš„å˜é‡æ˜¯å¯ä»¥è¢«ç”¨äºä¸‹ä¸ªStageçš„ï¼Œæ—¥å¿—ç›‘æ§ä¸»è¦åŸºäºRegexå’ŒMetricsä¸¤ä¸ªStageé…ç½®å®ç°ã€‚</p>
<h3 id="4-2-1-Regex-Stageé…ç½®è¯´æ˜"><a href="#4-2-1-Regex-Stageé…ç½®è¯´æ˜" class="headerlink" title="4.2.1. Regex Stageé…ç½®è¯´æ˜"></a>4.2.1. Regex Stageé…ç½®è¯´æ˜</h3><p>regex Stageä¸»è¦ç”¨äºä»æ—¥å¿—ä¸­æå–æ•°æ®ï¼Œæå–æ•°æ®ä½¿ç”¨RE2 æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<blockquote>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://grafana.com/docs/loki/latest/send-data/promtail/stages/regex/">https://grafana.com/docs/loki/latest/send-data/promtail/stages/regex/</a></p>
</blockquote>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">regex</span><span class="token punctuation">:</span>
  <span class="token comment"># The RE2 regular expression. Each capture group must be named.</span>
  <span class="token key atrule">expression</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span>
  
  <span class="token comment"># Name from extracted data to parse. If empty, uses the log message.</span>
  <span class="token punctuation">[</span><span class="token key atrule">source</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note warning no-icon flat"><p><strong>é‡è¦è¯´æ˜</strong>ï¼š</p>
<ul>
<li>expression å¿…é¡»æ˜¯ Go RE2 æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²</li>
<li>æ¯ä¸ªæ•è·ç»„å¿…é¡»ä»¥å¦‚ä¸‹æ–¹å¼å‘½åï¼š<code>(?P&lt;name&gt;re)</code></li>
<li>æ•è·ç»„çš„åç§°å°†ç”¨ä½œæå–æ˜ å°„ä¸­çš„é”®</li>
</ul>
</div>

<blockquote>
<p>RE2æ­£åˆ™è¯­æ³•å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/google/re2/wiki/Syntax">https://github.com/google/re2/wiki/Syntax</a></p>
</blockquote>
<h3 id="4-2-2-Metrics-Stageé…ç½®è¯´æ˜"><a href="#4-2-2-Metrics-Stageé…ç½®è¯´æ˜" class="headerlink" title="4.2.2. Metrics Stageé…ç½®è¯´æ˜"></a>4.2.2. Metrics Stageé…ç½®è¯´æ˜</h3><p>Metrics Stageä¸»è¦ç”¨äºå®šä¹‰ç›‘æ§æŒ‡æ ‡åç§°ã€ç±»å‹ã€é‡‡é›†æ¬¡æ•°ã€‚</p>
<blockquote>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://grafana.com/docs/loki/latest/send-data/promtail/stages/metrics/">https://grafana.com/docs/loki/latest/send-data/promtail/stages/metrics/</a></p>
</blockquote>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">metrics</span><span class="token punctuation">:</span>
  <span class="token key atrule">http_get_total</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Counter  <span class="token comment">#Counterç±»å‹ï¼Œå‚çœ‹Prometheusçš„å››ç§æŒ‡æ ‡ç±»å‹</span>
    <span class="token key atrule">description</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span> <span class="token comment">#æè¿°ä¿¡æ¯</span>
    <span class="token key atrule">prefix</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span> <span class="token comment">#æŒ‡æ ‡çš„å‰ç¼€ï¼Œé»˜è®¤æ˜¯:promtail_custom_ï¼Œä¾‹å¦‚:promtail_custom_http_get_total</span>
    <span class="token key atrule">source</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span> <span class="token comment">#ä»æå–æ•°æ®ä¸­è·å–åˆ°çš„Keyä½œä¸ºç»Ÿè®¡çš„æŒ‡æ ‡æ¥æºï¼Œå¦‚æœä¸æä¾›ï¼Œå°±æ˜¯æŒ‡æ ‡åå­—</span>
    <span class="token key atrule">max_idle_duration</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span>  <span class="token comment">#æŒ‡æ ‡çš„å­˜æ´»æ—¶é—´ï¼Œé¿å…å‡ºç°ä¸šåŠ¡ä¸Šçš„æŒ‡æ ‡çš„ç§¯ç´¯çš„é—®é¢˜ï¼Œé»˜è®¤æ˜¯:5m</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">match_all</span><span class="token punctuation">:</span> &lt;bool<span class="token punctuation">></span> <span class="token comment">#å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ—¥å¿—è¡Œéƒ½ä¼šè¢«ç»Ÿè®¡åˆ°</span>
      <span class="token key atrule">count_entry_bytes</span><span class="token punctuation">:</span> &lt;bool<span class="token punctuation">></span> <span class="token comment">#å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ—¥å¿—è¡Œçš„byteséƒ½ä¼šè¢«ç»Ÿè®¡</span>
      <span class="token key atrule">value</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span> <span class="token comment">#åªæœ‰ç¬¦åˆvalueçš„æ‰ä¼šè¢«ç»Ÿè®¡ï¼Œå’Œmatch_allè¿˜æœ‰count_entry_bytesæœ‰ä¸€å®šçš„é…ç½®å†²çª</span>
      <span class="token key atrule">action</span><span class="token punctuation">:</span> &lt;string<span class="token punctuation">></span> <span class="token comment">#inc æˆ–è€… addè¿™ä¿©é€’å¢çš„æ„æ€ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-3-æ—¥å¿—ç›‘æ§é…ç½®ç¤ºä¾‹"><a href="#4-3-æ—¥å¿—ç›‘æ§é…ç½®ç¤ºä¾‹" class="headerlink" title="4.3. æ—¥å¿—ç›‘æ§é…ç½®ç¤ºä¾‹"></a>4.3. æ—¥å¿—ç›‘æ§é…ç½®ç¤ºä¾‹</h2><p>ä¸‹é¢ä¸ºä¸€ä¸ªæ—¥å¿—ç›‘æ§æŒ‡æ ‡ç¤ºä¾‹ï¼ŒæŒ‡æ ‡åä¸ºï¼š<code>data_truncation_total</code>ï¼Œ æŒ‡æ ‡ç±»å‹ä¸ºï¼šCounterï¼Œè¯¥æŒ‡æ ‡å¯¹æ—¥å¿—è¡Œå†…å®¹åŒ…å«â€Data truncationâ€å­—ç¬¦è®¡æ•°ï¼Œè¯¥å…³é”®å­—åœ¨æ—¥å¿—ä¸­æ¯å‡ºç°ä¸€æ¬¡ï¼ŒæŒ‡æ ‡å€¼åŠ 1ã€‚</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">http_listen_port</span><span class="token punctuation">:</span> <span class="token number">9080</span>
  <span class="token key atrule">grpc_listen_port</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token key atrule">enable_runtime_reload</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">clients</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//loki.example.com<span class="token punctuation">:</span>30669/loki/api/v1/push

<span class="token key atrule">positions</span><span class="token punctuation">:</span>
  <span class="token key atrule">filename</span><span class="token punctuation">:</span> ./positions.yaml

<span class="token key atrule">target_config</span><span class="token punctuation">:</span>
  <span class="token key atrule">sync_period</span><span class="token punctuation">:</span> 10s

<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>logs
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> localhost
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">job</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>logs
          <span class="token key atrule">__path__</span><span class="token punctuation">:</span> /var/log/app/<span class="token important">*.log</span>
    <span class="token key atrule">pipeline_stages</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">regex</span><span class="token punctuation">:</span>
          <span class="token key atrule">expression</span><span class="token punctuation">:</span> <span class="token string">'.*(?P&lt;error_content>Data truncation).*'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">metrics</span><span class="token punctuation">:</span>
          <span class="token key atrule">data_truncation_total</span><span class="token punctuation">:</span>
            <span class="token key atrule">type</span><span class="token punctuation">:</span> Counter
            <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Count of data truncation errors"</span>
            <span class="token key atrule">config</span><span class="token punctuation">:</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123;.error_content&#125;&#125;"</span>
              <span class="token key atrule">action</span><span class="token punctuation">:</span> inc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div class="note success no-icon flat"><p><strong>é…ç½®è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–åŒ…å«â€Data truncationâ€çš„æ—¥å¿—è¡Œ</li>
<li>å®šä¹‰Counterç±»å‹æŒ‡æ ‡è¿›è¡Œè®¡æ•°</li>
<li>æ¯å½“åŒ¹é…åˆ°ç›¸å…³é”™è¯¯æ—¶ï¼ŒæŒ‡æ ‡å€¼è‡ªåŠ¨é€’å¢</li>
</ul>
</div>

<h1 id="äº”ã€å‘Šè­¦é…ç½®"><a href="#äº”ã€å‘Šè­¦é…ç½®" class="headerlink" title="äº”ã€å‘Šè­¦é…ç½®"></a>äº”ã€å‘Šè­¦é…ç½®</h1><p>åŸºäºPromtailé‡‡é›†çš„æ—¥å¿—ç›‘æ§æŒ‡æ ‡ï¼Œå¯ä»¥åœ¨Prometheusä¸­é…ç½®ç›¸åº”çš„å‘Šè­¦è§„åˆ™ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> log_alerts
    <span class="token key atrule">rules</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> DataTruncationAlert
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> increase(promtail_custom_data_truncation_total<span class="token punctuation">[</span>5m<span class="token punctuation">]</span>) <span class="token punctuation">></span> 0
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 0m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">"æ£€æµ‹åˆ°æ•°æ®æˆªæ–­é”™è¯¯"</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"åœ¨è¿‡å»5åˆ†é’Ÿå†…æ£€æµ‹åˆ° &#123;&#123; $value &#125;&#125; æ¬¡æ•°æ®æˆªæ–­é”™è¯¯"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–¹æ¡ˆé€šè¿‡Promtailå®ç°äº†ç”Ÿäº§ç¯å¢ƒæ—¥å¿—çš„å®æ—¶ç›‘æ§å’Œå‘Šè­¦ï¼Œä¸»è¦ä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>å®æ—¶æ€§å¼º</strong>ï¼šåŸºäºPromtailçš„metricsé˜¶æ®µï¼Œæ— å»¶è¿Ÿç›‘æ§</li>
<li><strong>é…ç½®çµæ´»</strong>ï¼šæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çµæ´»åŒ¹é…æ—¥å¿—å†…å®¹</li>
<li><strong>é›†æˆä¾¿åˆ©</strong>ï¼šä¸ç°æœ‰Prometheusç›‘æ§ä½“ç³»æ— ç¼é›†æˆ</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒè™šæ‹Ÿæœºå’ŒK8sä¸¤ç§éƒ¨ç½²æ–¹å¼</li>
</ol>
<p>é€šè¿‡è¯¥æ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆæå‡ç”Ÿäº§ç¯å¢ƒå¼‚å¸¸å‘ç°çš„åŠæ—¶æ€§ï¼Œé™ä½ä¸šåŠ¡é£é™©ã€‚</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li><a href="https://grafana.com/docs/loki/latest/send-data/promtail/">Promtailå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/">Prometheuså‘Šè­¦è§„åˆ™</a></li>
<li><a href="https://github.com/google/re2/wiki/Syntax">RE2æ­£åˆ™è¯­æ³•</a></li>
</ul>
]]></content>
      <categories>
        <category>ç³»ç»Ÿç›‘æ§</category>
      </categories>
      <tags>
        <tag>Prometheus</tag>
        <tag>Promtail</tag>
        <tag>Loki</tag>
        <tag>æ—¥å¿—ç›‘æ§</tag>
        <tag>å‘Šè­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>Prometheusç›‘æ§æŒ‡æ ‡é‡‡é›†ä¸å›¾è¡¨é…ç½®</title>
    <url>/2024/04/20/prometheus/prometheus-jian-kong-zhi-biao-cai-ji-yu-tu-biao-pei-zhi/</url>
    <content><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯ç®€ä»‹"><a href="#ä¸€ã€èƒŒæ™¯ç®€ä»‹" class="headerlink" title="ä¸€ã€èƒŒæ™¯ç®€ä»‹"></a>ä¸€ã€èƒŒæ™¯ç®€ä»‹</h1><p>Prometheusç”±äºå¯¹äº‘åŸç”Ÿçš„ä¼˜ç§€çš„æ”¯æŒï¼Œæˆä¸ºå„ä¼ä¸šä¸Šäº‘ç›‘æ§é€‰å‹çš„é¦–é€‰ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»Prometheusç›‘æ§æŒ‡æ ‡é‡‡é›†åå›¾è¡¨çš„é…ç½®ã€‚</p>
<blockquote>
<p>Prometheuså—å¯å‘äºGoogleçš„Brogmonç›‘æ§ç³»ç»Ÿï¼ˆç›¸ä¼¼çš„Kubernetesæ˜¯ä»Googleçš„Brogç³»ç»Ÿæ¼”å˜è€Œæ¥ï¼‰ï¼Œä»2012å¹´å¼€å§‹ç”±å‰Googleå·¥ç¨‹å¸ˆåœ¨Soundcloudä»¥å¼€æºè½¯ä»¶çš„å½¢å¼è¿›è¡Œç ”å‘ï¼Œå¹¶ä¸”äº2015å¹´æ—©æœŸå¯¹å¤–å‘å¸ƒæ—©æœŸç‰ˆæœ¬ã€‚2016å¹´5æœˆç»§Kubernetesä¹‹åæˆä¸ºç¬¬äºŒä¸ªæ­£å¼åŠ å…¥CNCFåŸºé‡‘ä¼šçš„é¡¹ç›®ï¼ŒåŒå¹´6æœˆæ­£å¼å‘å¸ƒ1.0ç‰ˆæœ¬ã€‚2017å¹´åº•å‘å¸ƒäº†åŸºäºå…¨æ–°å­˜å‚¨å±‚çš„2.0ç‰ˆæœ¬ï¼Œèƒ½æ›´å¥½åœ°ä¸å®¹å™¨å¹³å°ã€äº‘å¹³å°é…åˆã€‚è¯¦è§ï¼š<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/quickstart/why-monitor">Prometheusç®€ä»‹</a></p>
</blockquote>
<h1 id="äºŒã€ç›‘æ§æŒ‡æ ‡æ•°æ®"><a href="#äºŒã€ç›‘æ§æŒ‡æ ‡æ•°æ®" class="headerlink" title="äºŒã€ç›‘æ§æŒ‡æ ‡æ•°æ®"></a>äºŒã€ç›‘æ§æŒ‡æ ‡æ•°æ®</h1><p>Prometheusä½¿ç”¨Pullæ¨¡å¼ä¸»åŠ¨æ‹‰å–ç›‘æ§æ•°æ®ï¼Œåœ¨åº”ç”¨å†…éƒ¨æˆ‘ä»¬å®ç°ç›‘æ§æŒ‡æ ‡æ•°æ®é‡‡é›†å¹¶æš´éœ²ä¸€ä¸ªæ•°æ®é‡‡é›†ç«¯å£ï¼Œåœ¨PrometheusæœåŠ¡ä¾§é…ç½®ç›‘æ§æŒ‡æ ‡é‡‡é›†ä»»åŠ¡è¿›è¡Œç›‘æ§æ•°æ®é‡‡é›†ï¼ˆPrometheusé»˜è®¤15sé‡‡é›†ä¸€æ¬¡ç›‘æ§æ•°æ®ï¼‰ã€‚</p>
<h2 id="æŒ‡æ ‡æ•°æ®æ ¼å¼"><a href="#æŒ‡æ ‡æ•°æ®æ ¼å¼" class="headerlink" title="æŒ‡æ ‡æ•°æ®æ ¼å¼"></a>æŒ‡æ ‡æ•°æ®æ ¼å¼</h2><blockquote>
<p>åœ¨spring-bootåº”ç”¨ä¸­ï¼Œé»˜è®¤ç›‘æ§é‡‡é›†è·¯å¾„ä¸ºï¼š <code>http://172.16.1.15:31744/actuator/prometheus</code>ã€‚</p>
</blockquote>
<p>Prometheusé‡‡é›†åˆ°ç›‘æ§æ•°æ®å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none"># HELP app_url_control_item_req_metric_seconds_max  
# TYPE app_url_control_item_req_metric_seconds_max gauge
app_url_control_item_req_metric_seconds_max&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 0.0
# HELP app_url_control_item_req_metric_seconds  
# TYPE app_url_control_item_req_metric_seconds summary
app_url_control_item_req_metric_seconds_count&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 1411.0
app_url_control_item_req_metric_seconds_sum&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 4.836

# HELP app_url_control_req_metric_seconds_max  
# TYPE app_url_control_req_metric_seconds_max gauge
app_url_control_req_metric_seconds_max&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 0.001
# HELP app_url_control_req_metric_seconds  
# TYPE app_url_control_req_metric_seconds summary
app_url_control_req_metric_seconds_count&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 1410.0
app_url_control_req_metric_seconds_sum&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 5.324<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ä¸Šè¿°Prometheusé‡‡é›†åˆ°çš„ç›‘æ§æŒ‡æ ‡æ•°æ®ä¸­ï¼Œæœ‰å‡ ä¸ªå…³é”®è¯ï¼š</p>
<ul>
<li>HELPï¼šè¡¨ç¤ºä¸€ä¸ªç›‘æ§æŒ‡æ ‡åç§°</li>
<li>TYPEï¼šè¡¨ç¤ºè¯¥ç›‘æ§æŒ‡æ ‡çš„ç±»å‹</li>
</ul>
<h1 id="ä¸‰ã€ç›‘æ§æŒ‡æ ‡ç±»å‹"><a href="#ä¸‰ã€ç›‘æ§æŒ‡æ ‡ç±»å‹" class="headerlink" title="ä¸‰ã€ç›‘æ§æŒ‡æ ‡ç±»å‹"></a>ä¸‰ã€ç›‘æ§æŒ‡æ ‡ç±»å‹</h1><p>Prometheuså®šä¹‰äº†4ç§ä¸åŒçš„æŒ‡æ ‡ç±»å‹(metric type)ï¼šCounterï¼ˆè®¡æ•°å™¨ï¼‰ã€Gaugeï¼ˆä»ªè¡¨ç›˜ï¼‰ã€Histogramï¼ˆç›´æ–¹å›¾ï¼‰ã€Summaryï¼ˆæ‘˜è¦ï¼‰ã€‚</p>
<h2 id="Counterï¼šåªå¢ä¸å‡çš„è®¡æ•°å™¨"><a href="#Counterï¼šåªå¢ä¸å‡çš„è®¡æ•°å™¨" class="headerlink" title="Counterï¼šåªå¢ä¸å‡çš„è®¡æ•°å™¨"></a>Counterï¼šåªå¢ä¸å‡çš„è®¡æ•°å™¨</h2><p>Counterç±»å‹çš„æŒ‡æ ‡å…¶å·¥ä½œæ–¹å¼å’Œè®¡æ•°å™¨ä¸€æ ·ï¼Œåªå¢ä¸å‡ï¼ˆé™¤éç³»ç»Ÿå‘ç”Ÿé‡ç½®ï¼‰ã€‚å¸¸è§çš„ç›‘æ§æŒ‡æ ‡ï¼Œå¦‚http_requests_totalï¼Œnode_cpuéƒ½æ˜¯Counterç±»å‹çš„ç›‘æ§æŒ‡æ ‡ã€‚ ä¸€èˆ¬åœ¨å®šä¹‰Counterç±»å‹æŒ‡æ ‡çš„åç§°æ—¶æ¨èä½¿ç”¨_totalä½œä¸ºåç¼€ã€‚</p>
<p>Counteræ˜¯ä¸€ä¸ªç®€å•ä½†æœ‰å¼ºå¤§çš„å·¥å…·ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®°å½•æŸäº›äº‹ä»¶å‘ç”Ÿçš„æ¬¡æ•°ï¼Œé€šè¿‡ä»¥æ—¶åºçš„å½¢å¼å­˜å‚¨è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„äº†è§£è¯¥äº‹ä»¶äº§ç”Ÿé€Ÿç‡çš„å˜åŒ–ã€‚ PromQLå†…ç½®çš„èšåˆæ“ä½œå’Œå‡½æ•°å¯ä»¥è®©ç”¨æˆ·å¯¹è¿™äº›æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æï¼š</p>
<p>ä¾‹å¦‚ï¼Œé€šè¿‡rate()å‡½æ•°è·å–HTTPè¯·æ±‚é‡çš„å¢é•¿ç‡ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">rate(http_requests_total[5m])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸­ï¼Œè®¿é—®é‡å‰10çš„HTTPåœ°å€ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">topk(10, http_requests_total)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="Gaugeï¼šå¯å¢å¯å‡çš„ä»ªè¡¨ç›˜"><a href="#Gaugeï¼šå¯å¢å¯å‡çš„ä»ªè¡¨ç›˜" class="headerlink" title="Gaugeï¼šå¯å¢å¯å‡çš„ä»ªè¡¨ç›˜"></a>Gaugeï¼šå¯å¢å¯å‡çš„ä»ªè¡¨ç›˜</h2><p>ä¸Counterä¸åŒï¼ŒGaugeç±»å‹çš„æŒ‡æ ‡ä¾§é‡äºååº”ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚å› æ­¤è¿™ç±»æŒ‡æ ‡çš„æ ·æœ¬æ•°æ®å¯å¢å¯å‡ã€‚å¸¸è§æŒ‡æ ‡å¦‚ï¼šnode_memory_MemFreeï¼ˆä¸»æœºå½“å‰ç©ºé—²çš„å†…å®¹å¤§å°ï¼‰ã€node_memory_MemAvailableï¼ˆå¯ç”¨å†…å­˜å¤§å°ï¼‰éƒ½æ˜¯Gaugeç±»å‹çš„ç›‘æ§æŒ‡æ ‡ã€‚</p>
<p>é€šè¿‡GaugeæŒ‡æ ‡ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥æŸ¥çœ‹ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">node_memory_MemFree<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¯¹äºGaugeç±»å‹çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡PromQLå†…ç½®å‡½æ•°delta()å¯ä»¥è·å–æ ·æœ¬åœ¨ä¸€æ®µæ—¶é—´è¿”å›å†…çš„å˜åŒ–æƒ…å†µã€‚ä¾‹å¦‚ï¼Œè®¡ç®—CPUæ¸©åº¦åœ¨ä¸¤ä¸ªå°æ—¶å†…çš„å·®å¼‚ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">delta(cpu_temp_celsius&#123;host&#x3D;&quot;zeus&quot;&#125;[2h])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿˜å¯ä»¥ä½¿ç”¨deriv()è®¡ç®—æ ·æœ¬çš„çº¿æ€§å›å½’æ¨¡å‹ï¼Œç”šè‡³æ˜¯ç›´æ¥ä½¿ç”¨predict_linear()å¯¹æ•°æ®çš„å˜åŒ–è¶‹åŠ¿è¿›è¡Œé¢„æµ‹ã€‚ä¾‹å¦‚ï¼Œé¢„æµ‹ç³»ç»Ÿç£ç›˜ç©ºé—´åœ¨4ä¸ªå°æ—¶ä¹‹åçš„å‰©ä½™æƒ…å†µï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">predict_linear(node_filesystem_free&#123;job&#x3D;&quot;node&quot;&#125;[1h], 4 * 3600)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="ä½¿ç”¨Histogramå’ŒSummaryåˆ†ææ•°æ®åˆ†å¸ƒæƒ…å†µ"><a href="#ä½¿ç”¨Histogramå’ŒSummaryåˆ†ææ•°æ®åˆ†å¸ƒæƒ…å†µ" class="headerlink" title="ä½¿ç”¨Histogramå’ŒSummaryåˆ†ææ•°æ®åˆ†å¸ƒæƒ…å†µ"></a>ä½¿ç”¨Histogramå’ŒSummaryåˆ†ææ•°æ®åˆ†å¸ƒæƒ…å†µ</h2><blockquote>
<p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://prometheus.io/docs/practices/histograms/#count-and-sum-of-observations">Histogram and Summary</a></p>
</blockquote>
<p>é™¤äº†Counterå’ŒGaugeç±»å‹çš„ç›‘æ§æŒ‡æ ‡ä»¥å¤–ï¼ŒPrometheusè¿˜å®šä¹‰äº†Histogramå’ŒSummaryçš„æŒ‡æ ‡ç±»å‹ã€‚Histogramå’ŒSummaryä¸»ç”¨ç”¨äºç»Ÿè®¡å’Œåˆ†ææ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹äººä»¬éƒ½å€¾å‘äºä½¿ç”¨æŸäº›é‡åŒ–æŒ‡æ ‡çš„å¹³å‡å€¼ï¼Œä¾‹å¦‚CPUçš„å¹³å‡ä½¿ç”¨ç‡ã€é¡µé¢çš„å¹³å‡å“åº”æ—¶é—´ã€‚è¿™ç§æ–¹å¼çš„é—®é¢˜å¾ˆæ˜æ˜¾ï¼Œä»¥ç³»ç»ŸAPIè°ƒç”¨çš„å¹³å‡å“åº”æ—¶é—´ä¸ºä¾‹ï¼šå¦‚æœå¤§å¤šæ•°APIè¯·æ±‚éƒ½ç»´æŒåœ¨100msçš„å“åº”æ—¶é—´èŒƒå›´å†…ï¼Œè€Œä¸ªåˆ«è¯·æ±‚çš„å“åº”æ—¶é—´éœ€è¦5sï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æŸäº›WEBé¡µé¢çš„å“åº”æ—¶é—´è½åˆ°ä¸­ä½æ•°çš„æƒ…å†µï¼Œè€Œè¿™ç§ç°è±¡è¢«ç§°ä¸ºé•¿å°¾é—®é¢˜ã€‚</p>
<p>ä¸ºäº†åŒºåˆ†æ˜¯å¹³å‡çš„æ…¢è¿˜æ˜¯é•¿å°¾çš„æ…¢ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æŒ‰ç…§è¯·æ±‚å»¶è¿Ÿçš„èŒƒå›´è¿›è¡Œåˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡å»¶è¿Ÿåœ¨0<del>10msä¹‹é—´çš„è¯·æ±‚æ•°æœ‰å¤šå°‘è€Œ10</del>20msä¹‹é—´çš„è¯·æ±‚æ•°åˆæœ‰å¤šå°‘ã€‚é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å¿«é€Ÿåˆ†æç³»ç»Ÿæ…¢çš„åŸå› ã€‚Histogramå’ŒSummaryéƒ½æ˜¯ä¸ºäº†èƒ½å¤Ÿè§£å†³è¿™æ ·é—®é¢˜çš„å­˜åœ¨ï¼Œé€šè¿‡Histogramå’ŒSummaryç±»å‹çš„ç›‘æ§æŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿäº†è§£ç›‘æ§æ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<p>ä¾‹å¦‚ï¼ŒæŒ‡æ ‡prometheus_tsdb_wal_fsync_duration_secondsçš„æŒ‡æ ‡ç±»å‹ä¸ºSummaryã€‚ å®ƒè®°å½•äº†Prometheus Serverä¸­wal_fsyncå¤„ç†çš„å¤„ç†æ—¶é—´ï¼Œé€šè¿‡è®¿é—®Prometheus Serverçš„&#x2F;metricsåœ°å€ï¼Œå¯ä»¥è·å–åˆ°ä»¥ä¸‹ç›‘æ§æ ·æœ¬æ•°æ®ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none"># HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.
# TYPE prometheus_tsdb_wal_fsync_duration_seconds summary
prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile&#x3D;&quot;0.5&quot;&#125; 0.012352463
prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile&#x3D;&quot;0.9&quot;&#125; 0.014458005
prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile&#x3D;&quot;0.99&quot;&#125; 0.017316173
prometheus_tsdb_wal_fsync_duration_seconds_sum 2.888716127000002
prometheus_tsdb_wal_fsync_duration_seconds_count 216<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»ä¸Šé¢çš„æ ·æœ¬ä¸­å¯ä»¥å¾—çŸ¥å½“å‰Prometheus Serverè¿›è¡Œwal_fsyncæ“ä½œçš„æ€»æ¬¡æ•°ä¸º216æ¬¡ï¼Œè€—æ—¶2.888716127000002sã€‚å…¶ä¸­ä¸­ä½æ•°ï¼ˆquantile&#x3D;0.5ï¼‰çš„è€—æ—¶ä¸º0.012352463ï¼Œ9åˆ†ä½æ•°ï¼ˆquantile&#x3D;0.9ï¼‰çš„è€—æ—¶ä¸º0.014458005sã€‚</p>
<p>åœ¨Prometheus Serverè‡ªèº«è¿”å›çš„æ ·æœ¬æ•°æ®ä¸­ï¼Œæˆ‘ä»¬è¿˜èƒ½æ‰¾åˆ°ç±»å‹ä¸ºHistogramçš„ç›‘æ§æŒ‡æ ‡:<code>prometheus_tsdb_compaction_chunk_range_bucket</code>ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none"># HELP prometheus_tsdb_compaction_chunk_range Final time range of chunks on their first compaction
# TYPE prometheus_tsdb_compaction_chunk_range histogram
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;100&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;400&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;1600&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;6400&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;25600&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;102400&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;409600&quot;&#125; 0
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;1.6384e+06&quot;&#125; 260
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;6.5536e+06&quot;&#125; 780
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;2.62144e+07&quot;&#125; 780
prometheus_tsdb_compaction_chunk_range_bucket&#123;le&#x3D;&quot;+Inf&quot;&#125; 780
prometheus_tsdb_compaction_chunk_range_sum 1.1540798e+09
prometheus_tsdb_compaction_chunk_range_count 780<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Summaryç±»å‹çš„æŒ‡æ ‡ç›¸ä¼¼ä¹‹å¤„åœ¨äºHistogramç±»å‹çš„æ ·æœ¬åŒæ ·ä¼šååº”å½“å‰æŒ‡æ ‡çš„è®°å½•çš„æ€»æ•°(ä»¥_countä½œä¸ºåç¼€)ä»¥åŠå…¶å€¼çš„æ€»é‡ï¼ˆä»¥_sumä½œä¸ºåç¼€ï¼‰ã€‚ä¸åŒåœ¨äºHistogramæŒ‡æ ‡ç›´æ¥ååº”äº†åœ¨ä¸åŒåŒºé—´å†…æ ·æœ¬çš„ä¸ªæ•°ï¼ŒåŒºé—´é€šè¿‡æ ‡ç­¾lenè¿›è¡Œå®šä¹‰ã€‚</p>
<p>åŒæ—¶å¯¹äºHistogramçš„æŒ‡æ ‡ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡histogram_quantile()å‡½æ•°è®¡ç®—å‡ºå…¶å€¼çš„åˆ†ä½æ•°ã€‚ä¸åŒåœ¨äºHistogramé€šè¿‡histogram_quantileå‡½æ•°æ˜¯åœ¨æœåŠ¡å™¨ç«¯è®¡ç®—çš„åˆ†ä½æ•°ã€‚ è€ŒSumamryçš„åˆ†ä½æ•°åˆ™æ˜¯ç›´æ¥åœ¨å®¢æˆ·ç«¯è®¡ç®—å®Œæˆã€‚å› æ­¤å¯¹äºåˆ†ä½æ•°çš„è®¡ç®—è€Œè¨€ï¼ŒSummaryåœ¨é€šè¿‡PromQLè¿›è¡ŒæŸ¥è¯¢æ—¶æœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼Œè€ŒHistogramåˆ™ä¼šæ¶ˆè€—æ›´å¤šçš„èµ„æºã€‚åä¹‹å¯¹äºå®¢æˆ·ç«¯è€Œè¨€Histogramæ¶ˆè€—çš„èµ„æºæ›´å°‘ã€‚åœ¨é€‰æ‹©è¿™ä¸¤ç§æ–¹å¼æ—¶ç”¨æˆ·åº”è¯¥æŒ‰ç…§è‡ªå·±çš„å®é™…åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚</p>
<h1 id="å››ã€ç›‘æ§å›¾è¡¨é…ç½®"><a href="#å››ã€ç›‘æ§å›¾è¡¨é…ç½®" class="headerlink" title="å››ã€ç›‘æ§å›¾è¡¨é…ç½®"></a>å››ã€ç›‘æ§å›¾è¡¨é…ç½®</h1><p>åœ¨Prometheusé…ä»¶ç›‘æ§æŒ‡æ ‡æ•°æ®é‡‡é›†ä»»åŠ¡åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡PromQLè¯­è¨€å®ç°ç›‘æ§æ•°æ®æŸ¥è¯¢ï¼Œå°†æŸ¥è¯¢ç»“æœæ˜¾ç¤ºGrafanaå›¾è¡¨æˆ–è¿›è¡Œå‘Šè­¦ï¼Œæœ¬æ–‡ä¸»è¦è®²è¿°å¯¹å¸¸è§ç±»å‹çš„ç›‘æ§æŒ‡æ ‡çš„å›¾è¡¨é…ç½®ã€‚</p>
<blockquote>
<p>PromQLçš„å­¦ä¹ å¯ä»¥å‚è€ƒä¸‹é¢æ–‡æ¡£ï¼š<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql">æ¢ç´¢PromQL</a>ã€‚</p>
</blockquote>
<h2 id="CounteræŒ‡æ ‡"><a href="#CounteræŒ‡æ ‡" class="headerlink" title="CounteræŒ‡æ ‡"></a>CounteræŒ‡æ ‡</h2><p>ç”±äºcounterç±»å‹çš„æŒ‡æ ‡æ˜¯ä¸€ä¸ªåªå¢ä¸å‡çš„è®¡æ•°å™¨ï¼Œæ‰€ä»¥å¦‚æœç›´æ¥åœ¨Grafanaçš„ç›‘æ§å›¾è¡¨å±•ç¤ºè¯¥æŒ‡æ ‡éå¸¸ä¸ç›´è§‚ï¼Œæ‰€ä»¥å¯¹äºcounterç±»å‹çš„æŒ‡æ ‡éœ€è¦ç”¨åˆ°PromQLçš„å‡ ä¸ªå¸¸ç”¨å†…ç½®å‡½æ•°ï¼š<code>rate</code> å’Œ <code>irate</code>ã€‚</p>
<p><code>increase(v range-vector)</code>å‡½æ•°æ˜¯PromQLä¸­æä¾›çš„ä¼—å¤šå†…ç½®å‡½æ•°ä¹‹ä¸€ã€‚å…¶ä¸­å‚æ•°væ˜¯ä¸€ä¸ªåŒºé—´å‘é‡ï¼Œincreaseå‡½æ•°è·å–åŒºé—´å‘é‡ä¸­çš„ç¬¬ä¸€ä¸ªåæœ€åä¸€ä¸ªæ ·æœ¬å¹¶è¿”å›å…¶å¢é•¿é‡ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹è¡¨è¾¾å¼Counterç±»å‹æŒ‡æ ‡çš„å¢é•¿ç‡ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">increase(node_cpu[2m]) &#x2F; 120<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™é‡Œé€šè¿‡node_cpu[2m]è·å–æ—¶é—´åºåˆ—æœ€è¿‘ä¸¤åˆ†é’Ÿçš„æ‰€æœ‰æ ·æœ¬ï¼Œincreaseè®¡ç®—å‡ºæœ€è¿‘ä¸¤åˆ†é’Ÿçš„å¢é•¿é‡ï¼Œæœ€åé™¤ä»¥æ—¶é—´120ç§’å¾—åˆ°node_cpuæ ·æœ¬åœ¨æœ€è¿‘ä¸¤åˆ†é’Ÿçš„å¹³å‡å¢é•¿ç‡ã€‚å¹¶ä¸”è¿™ä¸ªå€¼ä¹Ÿè¿‘ä¼¼äºä¸»æœºèŠ‚ç‚¹æœ€è¿‘ä¸¤åˆ†é’Ÿå†…çš„å¹³å‡CPUä½¿ç”¨ç‡ã€‚</p>
<p>é™¤äº†ä½¿ç”¨increaseå‡½æ•°ä»¥å¤–ï¼ŒPromQLä¸­è¿˜ç›´æ¥å†…ç½®äº†<code>rate(v range-vector)</code>å‡½æ•°ï¼Œrateå‡½æ•°å¯ä»¥ç›´æ¥è®¡ç®—åŒºé—´å‘é‡våœ¨æ—¶é—´çª—å£å†…å¹³å‡å¢é•¿é€Ÿç‡ã€‚å› æ­¤ï¼Œé€šè¿‡ä»¥ä¸‹è¡¨è¾¾å¼å¯ä»¥å¾—åˆ°ä¸increaseå‡½æ•°ç›¸åŒçš„ç»“æœï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">rate(node_cpu[2m])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨rateæˆ–è€…increaseå‡½æ•°å»è®¡ç®—æ ·æœ¬çš„å¹³å‡å¢é•¿é€Ÿç‡ï¼Œå®¹æ˜“é™·å…¥â€œé•¿å°¾é—®é¢˜â€å½“ä¸­ï¼Œå…¶æ— æ³•ååº”åœ¨æ—¶é—´çª—å£å†…æ ·æœ¬æ•°æ®çš„çªå‘å˜åŒ–ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºä¸»æœºè€Œè¨€åœ¨2åˆ†é’Ÿçš„æ—¶é—´çª—å£å†…ï¼Œå¯èƒ½åœ¨æŸä¸€ä¸ªç”±äºè®¿é—®é‡æˆ–è€…å…¶å®ƒé—®é¢˜å¯¼è‡´CPUå ç”¨100%çš„æƒ…å†µï¼Œä½†æ˜¯é€šè¿‡è®¡ç®—åœ¨æ—¶é—´çª—å£å†…çš„å¹³å‡å¢é•¿ç‡å´æ— æ³•ååº”å‡ºè¯¥é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼ŒPromQLæä¾›äº†å¦å¤–ä¸€ä¸ªçµæ•åº¦æ›´é«˜çš„å‡½æ•°<code>irate(v range-vector)</code>ã€‚irateåŒæ ·ç”¨äºè®¡ç®—åŒºé—´å‘é‡çš„è®¡ç®—ç‡ï¼Œä½†æ˜¯å…¶ååº”å‡ºçš„æ˜¯ç¬æ—¶å¢é•¿ç‡ã€‚irateå‡½æ•°æ˜¯é€šè¿‡åŒºé—´å‘é‡ä¸­æœ€åä¸¤ä¸ªæ ·æœ¬æ•°æ®æ¥è®¡ç®—åŒºé—´å‘é‡çš„å¢é•¿é€Ÿç‡ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…åœ¨æ—¶é—´çª—å£èŒƒå›´å†…çš„â€œé•¿å°¾é—®é¢˜â€ï¼Œå¹¶ä¸”ä½“ç°å‡ºæ›´å¥½çš„çµæ•åº¦ï¼Œé€šè¿‡irateå‡½æ•°ç»˜åˆ¶çš„å›¾æ ‡èƒ½å¤Ÿæ›´å¥½çš„ååº”æ ·æœ¬æ•°æ®çš„ç¬æ—¶å˜åŒ–çŠ¶æ€ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">irate(node_cpu[2m])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>irateå‡½æ•°ç›¸æ¯”äºrateå‡½æ•°æä¾›äº†æ›´é«˜çš„çµæ•åº¦ï¼Œä¸è¿‡å½“éœ€è¦åˆ†æé•¿æœŸè¶‹åŠ¿æˆ–è€…åœ¨å‘Šè­¦è§„åˆ™ä¸­ï¼Œirateçš„è¿™ç§çµæ•åº¦åè€Œå®¹æ˜“é€ æˆå¹²æ‰°ã€‚å› æ­¤åœ¨é•¿æœŸè¶‹åŠ¿åˆ†ææˆ–è€…å‘Šè­¦ä¸­æ›´æ¨èä½¿ç”¨rateå‡½æ•°ã€‚</p>
<blockquote>
<p>è¯¦ç»†å†…å®¹å‚è§ï¼š<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-functions">PromQLå†…ç½®å‡½æ•°</a></p>
</blockquote>
<h2 id="GaugeæŒ‡æ ‡"><a href="#GaugeæŒ‡æ ‡" class="headerlink" title="GaugeæŒ‡æ ‡"></a>GaugeæŒ‡æ ‡</h2><p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¸ºäº†ç¡®ä¿ä¸šåŠ¡çš„æŒç»­å¯ç”¨è¿è¡Œï¼Œä¼šé’ˆå¯¹æœåŠ¡å™¨çš„èµ„æºè®¾ç½®ç›¸åº”çš„å‘Šè­¦é˜ˆå€¼ã€‚ä¾‹å¦‚ï¼Œå½“ç£ç›˜ç©ºé—´åªå‰©512MBæ—¶å‘ç›¸å…³äººå‘˜å‘é€å‘Šè­¦é€šçŸ¥ã€‚ è¿™ç§åŸºäºé˜ˆå€¼çš„å‘Šè­¦æ¨¡å¼å¯¹äºå½“èµ„æºç”¨é‡æ˜¯å¹³æ»‘å¢é•¿çš„æƒ…å†µä¸‹æ˜¯èƒ½å¤Ÿæœ‰æ•ˆçš„å·¥ä½œçš„ã€‚ ä½†æ˜¯å¦‚æœèµ„æºä¸æ˜¯å¹³æ»‘å˜åŒ–çš„å‘¢ï¼Ÿ æ¯”å¦‚æœ‰äº›æŸäº›ä¸šåŠ¡å¢é•¿ï¼Œå­˜å‚¨ç©ºé—´çš„å¢é•¿é€Ÿç‡æå‡äº†é«˜å‡ å€ã€‚è¿™æ—¶ï¼Œå¦‚æœåŸºäºåŸæœ‰é˜ˆå€¼å»è§¦å‘å‘Šè­¦ï¼Œå½“ç³»ç»Ÿç®¡ç†å‘˜æ¥æ”¶åˆ°å‘Šè­¦ä»¥åå¯èƒ½è¿˜æ²¡æ¥å¾—åŠå»å¤„ç†é—®é¢˜ï¼Œç³»ç»Ÿå°±å·²ç»ä¸å¯ç”¨äº†ã€‚ å› æ­¤é˜ˆå€¼é€šå¸¸æ¥è¯´ä¸æ˜¯å›ºå®šçš„ï¼Œéœ€è¦å®šæœŸè¿›è¡Œè°ƒæ•´æ‰èƒ½ä¿è¯è¯¥å‘Šè­¦é˜ˆå€¼èƒ½å¤Ÿå‘æŒ¥å»ä½œç”¨ã€‚ é‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•å—ï¼Ÿ</p>
<p>PromQLä¸­å†…ç½®çš„<code>predict_linear(v range-vector, t scalar) </code>å‡½æ•°å¯ä»¥å¸®åŠ©ç³»ç»Ÿç®¡ç†å‘˜æ›´å¥½çš„å¤„ç†æ­¤ç±»æƒ…å†µï¼Œpredict_linearå‡½æ•°å¯ä»¥é¢„æµ‹æ—¶é—´åºåˆ—våœ¨tç§’åçš„å€¼ã€‚å®ƒåŸºäºç®€å•çº¿æ€§å›å½’çš„æ–¹å¼ï¼Œå¯¹æ—¶é—´çª—å£å†…çš„æ ·æœ¬æ•°æ®è¿›è¡Œç»Ÿè®¡ï¼Œä»è€Œå¯ä»¥å¯¹æ—¶é—´åºåˆ—çš„å˜åŒ–è¶‹åŠ¿åšå‡ºé¢„æµ‹ã€‚ä¾‹å¦‚ï¼ŒåŸºäº2å°æ—¶çš„æ ·æœ¬æ•°æ®ï¼Œæ¥é¢„æµ‹ä¸»æœºå¯ç”¨ç£ç›˜ç©ºé—´çš„æ˜¯å¦åœ¨4ä¸ªå°æ—¶å€™è¢«å æ»¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¡¨è¾¾å¼ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">predict_linear(node_filesystem_free&#123;job&#x3D;&quot;node&quot;&#125;[2h], 4 * 3600) &lt; 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="HistogramæŒ‡æ ‡"><a href="#HistogramæŒ‡æ ‡" class="headerlink" title="HistogramæŒ‡æ ‡"></a>HistogramæŒ‡æ ‡</h2><p>Histogramå’ŒSummaryéƒ½å¯ä»¥ç”¨äºç»Ÿè®¡å’Œåˆ†ææ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚åŒºåˆ«åœ¨äºSummaryæ˜¯ç›´æ¥åœ¨å®¢æˆ·ç«¯è®¡ç®—äº†æ•°æ®åˆ†å¸ƒçš„åˆ†ä½æ•°æƒ…å†µã€‚è€ŒHistogramçš„åˆ†ä½æ•°è®¡ç®—éœ€è¦é€šè¿‡histogram_quantile(Ï† float, b instant-vector)å‡½æ•°è¿›è¡Œè®¡ç®—ã€‚å…¶ä¸­Ï†ï¼ˆ0&lt;Ï†&lt;1ï¼‰è¡¨ç¤ºéœ€è¦è®¡ç®—çš„åˆ†ä½æ•°ï¼Œå¦‚æœéœ€è¦è®¡ç®—ä¸­ä½æ•°Ï†å–å€¼ä¸º0.5ï¼Œä»¥æ­¤ç±»æ¨å³å¯ã€‚</p>
<p>ä»¥æŒ‡æ ‡http_request_duration_seconds_bucketä¸ºä¾‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none"># HELP http_request_duration_seconds request duration histogram
# TYPE http_request_duration_seconds histogram
http_request_duration_seconds_bucket&#123;le&#x3D;&quot;0.5&quot;&#125; 0
http_request_duration_seconds_bucket&#123;le&#x3D;&quot;1&quot;&#125; 1
http_request_duration_seconds_bucket&#123;le&#x3D;&quot;2&quot;&#125; 2
http_request_duration_seconds_bucket&#123;le&#x3D;&quot;3&quot;&#125; 3
http_request_duration_seconds_bucket&#123;le&#x3D;&quot;5&quot;&#125; 3
http_request_duration_seconds_bucket&#123;le&#x3D;&quot;+Inf&quot;&#125; 3
http_request_duration_seconds_sum 6
http_request_duration_seconds_count 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“è®¡ç®—5åˆ†ä½æ•°æ—¶ï¼Œä½¿ç”¨å¦‚ä¸‹è¡¨è¾¾å¼ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">histogram_quantile(0.5, http_request_duration_seconds_bucket)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é€šè¿‡å¯¹Histogramç±»å‹çš„ç›‘æ§æŒ‡æ ‡ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾è·å–æ ·æœ¬æ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚åŒæ—¶åˆ†ä½æ•°çš„è®¡ç®—ï¼Œä¹Ÿå¯ä»¥éå¸¸æ–¹ä¾¿çš„ç”¨äºè¯„åˆ¤å½“å‰ç›‘æ§æŒ‡æ ‡çš„æœåŠ¡æ°´å¹³ã€‚</p>
<h2 id="SummaryæŒ‡æ ‡"><a href="#SummaryæŒ‡æ ‡" class="headerlink" title="SummaryæŒ‡æ ‡"></a>SummaryæŒ‡æ ‡</h2><blockquote>
<p>Histograms and summaries both sample observations, typically request durations or response sizes. They track the number of observations and the sum of the observed values, allowing you to calculate the average of the observed values. <strong>Note that the number of observations (showing up in Prometheus as a time series with a _count suffix) is inherently a counter (as described above, it only goes up). The sum of observations (showing up as a time series with a _sum suffix) behaves like a counter, too, as long as there are no negative observations</strong>. Obviously, request durations or response sizes are never negative. In principle, however, you can use summaries and histograms to observe negative values (e.g. temperatures in centigrade). In that case, the sum of observations can go down, so you cannot apply rate() to it anymore. In those rare cases where you need to apply rate() and cannot avoid negative observations, you can use two separate summaries, one for positive and one for negative observations (the latter with inverted sign), and combine the results later with suitable PromQL expressions.</p>
</blockquote>
<p>æ ¹æ®ä¸Šè¿°æè¿°ï¼ŒSummaryç±»å‹çš„æŒ‡æ ‡æ˜¯ä¸€ä¸ªå¤åˆç±»å‹æŒ‡æ ‡ï¼Œå…¶ä¸­çš„countå’Œsumæœ¬è´¨ä¸Šæ˜¯Counterç±»å‹æŒ‡æ ‡ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none"># HELP srcp_url_control_req_metric_seconds_max  
# TYPE srcp_url_control_req_metric_seconds_max gauge
app_url_control_req_metric_seconds_max&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 0.001
# HELP app_url_control_req_metric_seconds  
# TYPE app_url_control_req_metric_seconds summary
app_url_control_req_metric_seconds_count&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 1410.0
app_url_control_req_metric_seconds_sum&#123;application&#x3D;&quot;app-biz-server&quot;,&#125; 5.324<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢<code>srcp_url_control_req</code>æŒ‡æ ‡é‡‡é›†äº†é“¾æ¥ç®¡æ§è¯·æ±‚çš„è¯·æ±‚æ•°é‡ã€è¯·æ±‚å“åº”æ—¶é•¿æ€»å’Œã€è¯·æ±‚å“åº”æ—¶é•¿æœ€å¤§å€¼ã€‚åˆ™è®¡ç®—è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é•¿è¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">irate(app_url_control_item_req_metric_seconds_sum&#123;namespace&#x3D;&quot;app-test&quot;&#125;[5m])&#x2F; irate(app_url_control_item_req_metric_seconds_count&#123;namespace&#x3D;&quot;app-test&quot;&#125;[5m])<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="rate-vs-irate"><a href="#rate-vs-irate" class="headerlink" title="rate vs irate"></a>rate vs irate</h3><p><strong>rate</strong>ï¼šè®¡ç®—çš„æ—¶å€™æ˜¯é€‰æ‹©æŒ‡å®šæ—¶é—´èŒƒå›´ä¸‹çš„ç¬¬ä¸€å’Œæœ€åä¸€ä¸ªæ ·æœ¬è¿›è¡Œè®¡ç®—ï¼›<br><strong>irate</strong>ï¼š è¿‡åŒºé—´å‘é‡ä¸­æœ€åä¸¤ä¸ªæ ·æœ¬æ•°æ®æ¥è®¡ç®—åŒºé—´å‘é‡çš„å¢é•¿é€Ÿç‡ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…åœ¨æ—¶é—´çª—å£èŒƒå›´å†…çš„é•¿å°¾é—®é¢˜ã€‚</p>
<p><strong>irateæ—¶é—´èŒƒå›´è¯´æ˜</strong>ï¼širateä½¿ç”¨æœ€åä¸¤ä¸ªç‚¹è®¡ç®—ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦æŒ‡å®šç±»ä¼¼äº [1m] çš„æ—¶é—´èŒƒå›´å‘¢ï¼Ÿè¿™ä¸ª [1m] ä¸æ˜¯ç”¨æ¥è®¡ç®—çš„ï¼Œirate åœ¨è®¡ç®—çš„æ—¶å€™ä¼šæœ€å¤šå‘å‰åœ¨ [1m] èŒƒå›´å†…æ‰¾ç‚¹ï¼Œå¦‚æœè¶…è¿‡ [1m] æ²¡æœ‰æ‰¾åˆ°æ•°æ®ç‚¹ï¼Œè¿™ä¸ªç‚¹çš„è®¡ç®—å°±æ”¾å¼ƒäº†ã€‚</p>
<blockquote>
<p>è¯¦è§æ–‡æ¡£ï¼š<a href="https://cloud.tencent.com/developer/article/1891190">PromQLæŸ¥è¯¢ä¹‹rateå‡½æ•°çš„ä½¿ç”¨</a></p>
</blockquote>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡ç®€å•ä»‹ç»äº†PrometheusæŒ‡æ ‡æ•°æ®é‡‡é›†ã€æŒ‡æ ‡ç±»å‹åŠPromQLä½¿ç”¨ï¼Œè¯»è€…å¯ä»¥æ ¹æ®ç›‘æ§æŒ‡æ ‡ç±»å‹ç¼–å†™PromQLåœ¨Grafanaä¸­è¿›è¡ŒæŸ¥è¯¢é…ç½®å¯è§†åŒ–å›¾è¡¨ã€‚</p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><p><a href="https://cloud.tencent.com/developer/article/1891190">PromQLæŸ¥è¯¢ä¹‹rateå‡½æ•°çš„ä½¿ç”¨</a><br><a href="https://wl05.github.io/tech/monitor/data-visualization/histogram/#%E6%A0%B7%E4%BE%8B">ç›´æ–¹å›¾ ï¼ˆHistogramï¼‰</a></p>
]]></content>
      <categories>
        <category>ç³»ç»Ÿç›‘æ§</category>
      </categories>
      <tags>
        <tag>Prometheus</tag>
        <tag>Metrics</tag>
        <tag>Grafana</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡çº¿ä¸ŠRedisé›†ç¾¤èŠ‚ç‚¹ä¸»ä»åˆ‡æ¢å¼•èµ·çš„åº”ç”¨é‡å¯é—®é¢˜æ’æŸ¥å¤„ç†</title>
    <url>/2025/12/20/redis/yi-ci-xian-shang-redis-ji-qun-jie-dian-zhu-cong-qie-huan-yin-qi-de-ying-yong-chong-qi-wen-ti-pai-cha-chu-li/</url>
    <content><![CDATA[<h2 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h2><p>æŸæ—¥ç”Ÿäº§ç¯å¢ƒå‡ºç°å¤§è§„æ¨¡åº”ç”¨é‡å¯å‘Šè­¦ï¼Œç»è¿‡åˆæ­¥æ’æŸ¥å‘ç°ä¸Redisé›†ç¾¤èŠ‚ç‚¹ä¸»ä»åˆ‡æ¢æœ‰å…³ã€‚è¯¥é—®é¢˜å¯¼è‡´å¤šä¸ªæ ¸å¿ƒæœåŠ¡ä¸å¯ç”¨ï¼Œå¯¹ä¸šåŠ¡äº§ç”Ÿäº†è¾ƒå¤§å½±å“ã€‚</p>
<p><strong>é—®é¢˜ç¯å¢ƒï¼š</strong></p>
<ul>
<li>Redisé›†ç¾¤æ¶æ„</li>
<li>Kuberneteså®¹å™¨åŒ–éƒ¨ç½²</li>
<li>Spring Bootå¾®æœåŠ¡æ¶æ„</li>
</ul>
<h2 id="äºŒã€é—®é¢˜ç°è±¡"><a href="#äºŒã€é—®é¢˜ç°è±¡" class="headerlink" title="äºŒã€é—®é¢˜ç°è±¡"></a>äºŒã€é—®é¢˜ç°è±¡</h2><p>é—®é¢˜å‘ç”Ÿæ—¶ï¼Œç›‘æ§ç³»ç»Ÿæ˜¾ç¤ºå¤§é‡åº”ç”¨å®ä¾‹å‡ºç°é‡å¯ç°è±¡ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼š</p>
<ol>
<li><strong>åº”ç”¨å±‚é¢ï¼š</strong> å¤šä¸ªå¾®æœåŠ¡å®ä¾‹é¢‘ç¹é‡å¯</li>
<li><strong>æ—¥å¿—å¼‚å¸¸ï¼š</strong> åº”ç”¨æ—¥å¿—ä¸­å‡ºç°å¤§é‡Redisè¿æ¥å¼‚å¸¸</li>
<li><strong>ç›‘æ§æŒ‡æ ‡ï¼š</strong> Redisé›†ç¾¤ç›‘æ§æ˜¾ç¤ºæŸä¸ªèŠ‚ç‚¹å‘ç”Ÿä¸»ä»åˆ‡æ¢</li>
<li><strong>ä¸šåŠ¡å½±å“ï¼š</strong> éƒ¨åˆ†æ ¸å¿ƒæ¥å£å“åº”è¶…æ—¶ï¼Œç”¨æˆ·ä½“éªŒä¸‹é™</li>
</ol>
<p><img src="/2025/12/20/redis/yi-ci-xian-shang-redis-ji-qun-jie-dian-zhu-cong-qie-huan-yin-qi-de-ying-yong-chong-qi-wen-ti-pai-cha-chu-li/redis%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7.png" alt="Redisé›†ç¾¤èŠ‚ç‚¹èµ„æºç›‘æ§"></p>
<p><em>å›¾1ï¼šRedisé›†ç¾¤èŠ‚ç‚¹èµ„æºç›‘æ§å›¾ç¤º</em></p>
<h2 id="ä¸‰ã€æ’æŸ¥è¿‡ç¨‹"><a href="#ä¸‰ã€æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="ä¸‰ã€æ’æŸ¥è¿‡ç¨‹"></a>ä¸‰ã€æ’æŸ¥è¿‡ç¨‹</h2><h3 id="3-1-åˆæ­¥åˆ†æ"><a href="#3-1-åˆæ­¥åˆ†æ" class="headerlink" title="3.1 åˆæ­¥åˆ†æ"></a>3.1 åˆæ­¥åˆ†æ</h3><p>é€šè¿‡ç›‘æ§ç³»ç»Ÿåˆæ­¥å®šä½ï¼Œå‘ç°é—®é¢˜ä¸Redisé›†ç¾¤èŠ‚ç‚¹ä¸»ä»åˆ‡æ¢å­˜åœ¨å¼ºå…³è”æ€§ï¼š</p>
<ol>
<li>æ—¶é—´å…³è”æ€§ï¼šåº”ç”¨é‡å¯æ—¶é—´ä¸RedisèŠ‚ç‚¹ä¸»ä»åˆ‡æ¢æ—¶é—´é«˜åº¦å»åˆ</li>
<li>å½±å“èŒƒå›´ï¼šæ‰€æœ‰ä¾èµ–è¯¥Redisé›†ç¾¤çš„æœåŠ¡å‡å—åˆ°å½±å“</li>
<li>åˆæ­¥åˆ¤æ–­ï¼šå¯èƒ½æ˜¯Redisé›†ç¾¤æ‹“æ‰‘å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿æ¥</li>
</ol>
<h3 id="3-2-æ·±å…¥æ’æŸ¥"><a href="#3-2-æ·±å…¥æ’æŸ¥" class="headerlink" title="3.2 æ·±å…¥æ’æŸ¥"></a>3.2 æ·±å…¥æ’æŸ¥</h3><p>ä¸ºè¿›ä¸€æ­¥å®šä½é—®é¢˜æ ¹å› ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æ·±å…¥çš„æŠ€æœ¯æ’æŸ¥ï¼š</p>
<p><strong>æ’æŸ¥å·¥å…·ä¸æ–¹æ³•ï¼š</strong></p>
<ul>
<li>æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Œåˆ†æå¼‚å¸¸å †æ ˆä¿¡æ¯</li>
<li>æ£€æŸ¥Redisé›†ç¾¤çŠ¶æ€å’ŒèŠ‚ç‚¹ä¿¡æ¯</li>
<li>åˆ†æKubernetesäº‹ä»¶å’ŒPodçŠ¶æ€å˜åŒ–</li>
<li>å¯¹æ¯”åˆ‡æ¢å‰åé›†ç¾¤æ‹“æ‰‘ç»“æ„</li>
</ul>
<p><strong>å…³é”®å‘ç°ï¼š</strong></p>
<ul>
<li>åº”ç”¨æ—¥å¿—ä¸­åå¤å‡ºç°<code>Node xxx.xxx.xxx.xxx:xxxx is unknown to cluster</code>å¼‚å¸¸</li>
<li>Redisé›†ç¾¤å·²å®Œæˆä¸»ä»åˆ‡æ¢ï¼Œä½†åº”ç”¨ä»å°è¯•è¿æ¥å·²å¤±æ•ˆçš„èŠ‚ç‚¹</li>
<li>K8så¥åº·æ£€æŸ¥å› Rediså¥åº·æ£€æŸ¥å¤±è´¥è€Œåˆ¤å®šPodä¸å¥åº·ï¼Œè§¦å‘é‡å¯æœºåˆ¶</li>
</ul>
<p><img src="/2025/12/20/redis/yi-ci-xian-shang-redis-ji-qun-jie-dian-zhu-cong-qie-huan-yin-qi-de-ying-yong-chong-qi-wen-ti-pai-cha-chu-li/redis%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E6%97%A5%E5%BF%97.png" alt="Redisé›†ç¾¤èŠ‚ç‚¹æ—¥å¿—"></p>
<p><em>å›¾2ï¼šRedisé›†ç¾¤èŠ‚ç‚¹æ—¥å¿—æˆªå›¾</em></p>
<h3 id="3-3-æ ¹å› å®šä½"><a href="#3-3-æ ¹å› å®šä½" class="headerlink" title="3.3 æ ¹å› å®šä½"></a>3.3 æ ¹å› å®šä½</h3><p>é€šè¿‡æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬å®šä½åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼š</p>
<p><strong>Podé‡å¯çš„æ ¸å¿ƒåŸå› åˆ†æï¼š</strong></p>
<p>Redisé›†ç¾¤å¥åº·æ£€æŸ¥å¤±è´¥æ˜¯è§¦å‘Podé‡å¯çš„ç›´æ¥åŸå› ï¼Œè€Œå®¢æˆ·ç«¯æœªèƒ½åŠæ—¶æ„ŸçŸ¥é›†ç¾¤æ‹“æ‰‘å˜åŒ–æ˜¯é—®é¢˜çš„æ ¹æœ¬æ‰€åœ¨ï¼ŒäºŒè€…å…±åŒå¯¼è‡´Podè¢«K8såˆ¤å®šä¸ºâ€ä¸å¥åº·â€å¹¶é‡å¯ï¼š</p>
<ol>
<li><strong>ç›´æ¥è§¦å‘åŸå› ï¼šRedisé›†ç¾¤å¥åº·æ£€æŸ¥å¤±è´¥</strong><ul>
<li>æ—¥å¿—ä¸­åå¤å‡ºç°Redis health check failedåŠç›¸å…³å¼‚å¸¸ï¼š</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">org.springframework.dao.DataAccessResourceFailureException: Node x.x.x.x:xxxx is unknown to cluster<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>å«ä¹‰ï¼šSpring Boot Actuatorçš„Rediså¥åº·æ£€æŸ¥ç»„ä»¶å°è¯•è¿æ¥Redisé›†ç¾¤èŠ‚ç‚¹æ—¶ï¼Œå‘ç°è¯¥èŠ‚ç‚¹ä¸åœ¨é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ä¸­</li>
<li>è¿é”ååº”ï¼šK8sçš„å­˜æ´»&#x2F;å°±ç»ªæ¢é’ˆå› å¥åº·æ£€æŸ¥å¤±è´¥åˆ¤å®šPodä¸å¥åº·ï¼Œè¿›è€Œè§¦å‘Podé‡å¯</li>
</ul>
</li>
</ol>
<p><img src="/2025/12/20/redis/yi-ci-xian-shang-redis-ji-qun-jie-dian-zhu-cong-qie-huan-yin-qi-de-ying-yong-chong-qi-wen-ti-pai-cha-chu-li/k8s%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5.png" alt="k8säº‹ä»¶é€šçŸ¥"></p>
<p><em>å›¾3ï¼šKubernetesäº‹ä»¶é€šçŸ¥æˆªå›¾</em></p>
<h2 id="å››ã€é—®é¢˜åˆ†æ"><a href="#å››ã€é—®é¢˜åˆ†æ" class="headerlink" title="å››ã€é—®é¢˜åˆ†æ"></a>å››ã€é—®é¢˜åˆ†æ</h2><h3 id="4-1-æŠ€æœ¯åŸç†åˆ†æ"><a href="#4-1-æŠ€æœ¯åŸç†åˆ†æ" class="headerlink" title="4.1 æŠ€æœ¯åŸç†åˆ†æ"></a>4.1 æŠ€æœ¯åŸç†åˆ†æ</h3><p>Redisé›†ç¾¤ä¸»ä»åˆ‡æ¢ååº”ç”¨æŒç»­æŠ¥<code>Node x.x.x.x:xxxx is unknown to cluster</code>ï¼Œæ ¸å¿ƒåŸå› æ˜¯åº”ç”¨ä¾§æœªæ„ŸçŸ¥Redisé›†ç¾¤æ‹“æ‰‘å˜åŒ–ï¼Œä»ç¼“å­˜æ—§çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ˆå¤±æ•ˆçš„ä¸»èŠ‚ç‚¹ï¼‰ï¼Œè€Œæ–°çš„é›†ç¾¤æ‹“æ‰‘ä¸­å·²æ— è¯¥èŠ‚ç‚¹ã€‚</p>
<p><strong>ä¸»ä»åˆ‡æ¢åRedisé›†ç¾¤çš„æ ¸å¿ƒå˜åŒ–ï¼š</strong></p>
<ol>
<li><strong>èŠ‚ç‚¹è§’è‰²&#x2F;çŠ¶æ€å˜æ›´ï¼š</strong> åŸä¸»èŠ‚ç‚¹å¯èƒ½è¢«ä¸‹çº¿ã€é™çº§ä¸ºä»èŠ‚ç‚¹ï¼Œæˆ–åœ¨é›†ç¾¤é‡æ–°åˆ†ç‰‡åè¢«ç§»é™¤</li>
<li><strong>é›†ç¾¤æ‹“æ‰‘æ›´æ–°ï¼š</strong> Redisé›†ç¾¤ä¼šå°†æ–°çš„ä¸»èŠ‚ç‚¹ä¿¡æ¯åŒæ­¥åˆ°æ‰€æœ‰å­˜æ´»èŠ‚ç‚¹</li>
</ol>
<p><strong>å®¢æˆ·ç«¯æ„ŸçŸ¥é—®é¢˜ï¼š</strong> åº”ç”¨ä¾§ä¸ä¼šä¸»åŠ¨æ„ŸçŸ¥è¿™ä¸ªå˜åŒ–ï¼Œä»ä¾èµ–åˆå§‹åŒ–æ—¶åŠ è½½çš„æ—§æ‹“æ‰‘ã€‚</p>
<h3 id="4-2-ä¸ºä»€ä¹ˆæŠ¥é”™ä¼šâ€æŒç»­â€ï¼Ÿ"><a href="#4-2-ä¸ºä»€ä¹ˆæŠ¥é”™ä¼šâ€æŒç»­â€ï¼Ÿ" class="headerlink" title="4.2 ä¸ºä»€ä¹ˆæŠ¥é”™ä¼šâ€æŒç»­â€ï¼Ÿ"></a>4.2 ä¸ºä»€ä¹ˆæŠ¥é”™ä¼šâ€æŒç»­â€ï¼Ÿ</h3><ol>
<li><strong>ç¼“å­˜æœªè¿‡æœŸï¼š</strong> Jediså®¢æˆ·ç«¯çš„æ‹“æ‰‘ç¼“å­˜æ— è¿‡æœŸæœºåˆ¶ï¼Œé™¤éä¸»åŠ¨åˆ·æ–°æˆ–åº”ç”¨é‡å¯ï¼Œå¦åˆ™ä¸ä¼šæ›´æ–°</li>
<li><strong>å¥åº·æ£€æŸ¥å‘¨æœŸæ€§æ‰§è¡Œï¼š</strong> K8sæ¢é’ˆ&#x2F;Actuatorå¥åº·æ£€æŸ¥æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œæ¯æ¬¡éƒ½ä¼šå°è¯•è®¿é—®æ—§èŠ‚ç‚¹ï¼Œå¯¼è‡´æŠ¥é”™åå¤å‡ºç°</li>
<li><strong>æ— è¢«åŠ¨åˆ·æ–°è§¦å‘æ¡ä»¶ï¼š</strong> è‹¥åº”ç”¨è®¿é—®çš„keyå“ˆå¸Œæ§½æœªå‘½ä¸­è¯¥å¤±æ•ˆèŠ‚ç‚¹ï¼Œä¸ä¼šè§¦å‘MOVEDé‡å®šå‘ï¼ŒJedisæ— æ³•è¢«åŠ¨æ›´æ–°æ‹“æ‰‘</li>
</ol>
<p><img src="/2025/12/20/redis/yi-ci-xian-shang-redis-ji-qun-jie-dian-zhu-cong-qie-huan-yin-qi-de-ying-yong-chong-qi-wen-ti-pai-cha-chu-li/redis%E8%8A%82%E7%82%B9%E4%B8%BB%E4%BB%8E%E7%8A%B6%E6%80%81.png" alt="redisèŠ‚ç‚¹ä¸»ä»çŠ¶æ€"></p>
<p><em>å›¾4ï¼šRedisèŠ‚ç‚¹ä¸»ä»çŠ¶æ€å˜åŒ–å›¾ç¤º</em></p>
<h3 id="4-3-Redisä¸»ä»åˆ‡æ¢çš„æ ¹æœ¬åŸå› åˆ†æ"><a href="#4-3-Redisä¸»ä»åˆ‡æ¢çš„æ ¹æœ¬åŸå› åˆ†æ" class="headerlink" title="4.3 Redisä¸»ä»åˆ‡æ¢çš„æ ¹æœ¬åŸå› åˆ†æ"></a>4.3 Redisä¸»ä»åˆ‡æ¢çš„æ ¹æœ¬åŸå› åˆ†æ</h3><p>é€šè¿‡åˆ†æRedisèŠ‚ç‚¹æ—¥å¿—å’Œèµ„æºç›‘æ§æ•°æ®ï¼Œæˆ‘ä»¬å®šä½åˆ°ä¸»ä»åˆ‡æ¢çš„æ ¹æœ¬åŸå› ï¼š</p>
<p><strong>å…³é”®æ—¥å¿—åˆ†æï¼š</strong></p>
<p>ä»RedisèŠ‚ç‚¹æ—¥å¿—ä¸­å‘ç°äº†ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼ˆæ—¶é—´ç‚¹ï¼š2025-12-20 06:47-06:48ï¼‰ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">Asynchronous AOF fsync is taking too long (disk is busy?). 
Writing the AOF buffer without waiting for fsync to complete, this may slow down Redis.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>è¿™æ¡è­¦å‘Šåœ¨çŸ­æ—¶é—´å†…åå¤å‡ºç°ï¼Œè¡¨æ˜Redisåœ¨è¿›è¡ŒAOFæŒä¹…åŒ–æ—¶é‡åˆ°äº†ä¸¥é‡çš„ç£ç›˜IOç“¶é¢ˆã€‚</p>
<p><strong>èµ„æºç›‘æ§å…³é”®å‘ç°ï¼š</strong></p>
<p>ä»CPUç›‘æ§å›¾å¯ä»¥æ¸…æ™°çœ‹åˆ°ï¼š</p>
<ul>
<li><strong>06:48:30æ—¶åˆ»</strong>ï¼šCPUä½¿ç”¨ç‡çªç„¶é£™å‡è‡³100%</li>
<li><strong>iowaitå æ¯”é«˜è¾¾8.4%</strong>ï¼šè¯´æ˜ç³»ç»Ÿåœ¨ç­‰å¾…ç£ç›˜IOæ“ä½œå®Œæˆ</li>
<li><strong>æŒç»­æ—¶é—´</strong>ï¼šé«˜è´Ÿè½½çŠ¶æ€æŒç»­äº†ä¸€æ®µæ—¶é—´æ‰æ¢å¤</li>
</ul>
<p><strong>ä¸»ä»åˆ‡æ¢è§¦å‘é“¾è·¯ï¼š</strong></p>
<ol>
<li><p><strong>æŒä¹…åŒ–æ“ä½œè§¦å‘</strong>ï¼š</p>
<ul>
<li>æ—¥å¿—æ˜¾ç¤ºRedisæ­£åœ¨è¿›è¡ŒRDBæŒä¹…åŒ–ï¼ˆ<code>1000 changes in 60 seconds. Saving...</code>ï¼‰</li>
<li>åŒæ—¶è¿›è¡ŒAOFé‡å†™æ“ä½œï¼ˆ<code>Background saving started by pid 32198</code>ï¼‰</li>
<li>åˆ›å»ºä¸´æ—¶AOFæ–‡ä»¶ï¼ˆ<code>temp-rewriteaof-bg-32344.aof</code>ï¼‰</li>
</ul>
</li>
<li><p><strong>ç£ç›˜IOç“¶é¢ˆ</strong>ï¼š</p>
<ul>
<li>AOF fsyncæ“ä½œè€—æ—¶è¿‡é•¿ï¼Œç£ç›˜å¤„äºç¹å¿™çŠ¶æ€</li>
<li>Forkæ“ä½œçš„Copy-on-Writeæœºåˆ¶åŠ å‰§äº†å†…å­˜å’ŒIOå‹åŠ›</li>
<li>æ—¥å¿—æ˜¾ç¤ºFork CoWè¾¾åˆ°30MBï¼Œå³°å€¼30MB</li>
</ul>
</li>
<li><p><strong>ä¸»èŠ‚ç‚¹å“åº”ç¼“æ…¢</strong>ï¼š</p>
<ul>
<li>CPUèµ„æºè¢«æŒä¹…åŒ–æ“ä½œå¤§é‡å ç”¨ï¼ˆ100%ä½¿ç”¨ç‡ï¼‰</li>
<li>ä¸»èŠ‚ç‚¹æ— æ³•åŠæ—¶å“åº”ä»èŠ‚ç‚¹çš„å¿ƒè·³è¯·æ±‚</li>
<li>ä»èŠ‚ç‚¹è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸å¯ç”¨</li>
</ul>
</li>
<li><p><strong>é›†ç¾¤è‡ªåŠ¨æ•…éšœè½¬ç§»</strong>ï¼š</p>
<ul>
<li>æ—¥å¿—æ˜¾ç¤ºï¼š<code>failover auth denied to edb11b7514756aab7c2ddbe345f9e015269161Sd: its master is up</code></li>
<li>éšåè¿›è¡Œé…ç½®å˜æ›´ï¼š<code>Configuration change detected. Reconfiguring myself as a replica</code></li>
<li>æœ€ç»ˆå®Œæˆä¸»ä»åˆ‡æ¢ï¼š<code>MASTER &lt;-&gt; REPLICA sync started</code></li>
</ul>
</li>
</ol>
<p><strong>æ ¹æœ¬åŸå› æ€»ç»“ï¼š</strong></p>
<p>æ­¤æ¬¡ä¸»ä»åˆ‡æ¢çš„æ ¹æœ¬åŸå› æ˜¯<strong>RedisæŒä¹…åŒ–æ“ä½œï¼ˆRDB+AOFé‡å†™ï¼‰åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹è§¦å‘äº†ä¸¥é‡çš„ç£ç›˜IOç“¶é¢ˆ</strong>ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹CPUå’ŒIOèµ„æºè¢«å¤§é‡å ç”¨</li>
<li>ä¸»èŠ‚ç‚¹æ— æ³•åŠæ—¶å“åº”é›†ç¾¤å¿ƒè·³</li>
<li>ä»èŠ‚ç‚¹åˆ¤å®šä¸»èŠ‚ç‚¹å¤±æ•ˆï¼Œè§¦å‘è‡ªåŠ¨æ•…éšœè½¬ç§»</li>
<li>é›†ç¾¤æ‰§è¡Œä¸»ä»åˆ‡æ¢ä»¥ä¿è¯é«˜å¯ç”¨æ€§</li>
</ul>
<p>è¿™æ˜¯Redisé›†ç¾¤åœ¨é¢å¯¹æŒä¹…åŒ–å‹åŠ›æ—¶çš„æ­£å¸¸è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä½†ç”±äºåº”ç”¨ä¾§æœªèƒ½åŠæ—¶æ„ŸçŸ¥æ‹“æ‰‘å˜åŒ–ï¼Œå¯¼è‡´äº†åç»­çš„åº”ç”¨é‡å¯é—®é¢˜ã€‚</p>
<h2 id="äº”ã€è§£å†³æ–¹æ¡ˆ"><a href="#äº”ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äº”ã€è§£å†³æ–¹æ¡ˆ"></a>äº”ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="5-1-ä¸´æ—¶è§£å†³æªæ–½"><a href="#5-1-ä¸´æ—¶è§£å†³æªæ–½" class="headerlink" title="5.1 ä¸´æ—¶è§£å†³æªæ–½"></a>5.1 ä¸´æ—¶è§£å†³æªæ–½</h3><p><strong>ç´§æ€¥ä¿®å¤ï¼šé‡å¯åº”ç”¨</strong></p>
<p>é‡å¯å—å½±å“çš„åº”ç”¨å®ä¾‹ï¼Œä½¿å…¶é‡æ–°ä»Redisé›†ç¾¤ç§å­èŠ‚ç‚¹åŠ è½½æœ€æ–°æ‹“æ‰‘ï¼Œç›´æ¥è§£å†³ç¼“å­˜æ—§èŠ‚ç‚¹çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ç§æœ‰æ•ˆçš„åº”æ€¥å¤„ç†æªæ–½ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤æœåŠ¡ã€‚</p>
<h3 id="5-2-æ ¹æœ¬è§£å†³æ–¹æ¡ˆ"><a href="#5-2-æ ¹æœ¬è§£å†³æ–¹æ¡ˆ" class="headerlink" title="5.2 æ ¹æœ¬è§£å†³æ–¹æ¡ˆ"></a>5.2 æ ¹æœ¬è§£å†³æ–¹æ¡ˆ</h3><p><strong>é•¿æœŸä¼˜åŒ–ï¼šå¼€å¯Jedisé›†ç¾¤æ‹“æ‰‘è‡ªåŠ¨åˆ·æ–°</strong></p>
<p>ä¿®æ”¹Spring Redisé…ç½®ï¼Œå¼€å¯Jedisçš„æ‹“æ‰‘è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼Œè®©åº”ç”¨èƒ½å¤Ÿä¸»åŠ¨æ„ŸçŸ¥é›†ç¾¤æ‹“æ‰‘å˜åŒ–ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³æ­¤ç±»é—®é¢˜ï¼š</p>
<ol>
<li>é…ç½®JedisClusterçš„<code>refresh</code>å‚æ•°</li>
<li>è®¾ç½®åˆç†çš„åˆ·æ–°é—´éš”æ—¶é—´</li>
<li>å¯ç”¨é›†ç¾¤èŠ‚ç‚¹å˜åŒ–ç›‘å¬æœºåˆ¶</li>
<li>ä¼˜åŒ–å¥åº·æ£€æŸ¥é€»è¾‘ï¼Œå¢åŠ å®¹é”™æœºåˆ¶</li>
</ol>
<h3 id="5-3-æ–¹æ¡ˆå®æ–½"><a href="#5-3-æ–¹æ¡ˆå®æ–½" class="headerlink" title="5.3 æ–¹æ¡ˆå®æ–½"></a>5.3 æ–¹æ¡ˆå®æ–½</h3><p><strong>å®æ–½æ­¥éª¤ï¼š</strong></p>
<ol>
<li><p><strong>é…ç½®ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>åœ¨Spring Booté…ç½®æ–‡ä»¶ä¸­å¯ç”¨Jedisé›†ç¾¤æ‹“æ‰‘è‡ªåŠ¨åˆ·æ–°</li>
<li>è°ƒæ•´å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´å’Œé‡è¯•æœºåˆ¶</li>
<li>å¢åŠ é‡è¯•é€»è¾‘å’Œç†”æ–­æœºåˆ¶</li>
</ul>
</li>
<li><p><strong>ä»£ç æ”¹é€ ï¼š</strong></p>
<ul>
<li>ä¼˜åŒ–Rediså®¢æˆ·ç«¯åˆå§‹åŒ–é€»è¾‘</li>
<li>å¢åŠ é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€æ£€æµ‹æœºåˆ¶</li>
<li>å®ç°ä¼˜é›…é™çº§ç­–ç•¥</li>
</ul>
</li>
<li><p><strong>æµ‹è¯•éªŒè¯ï¼š</strong></p>
<ul>
<li>åœ¨æµ‹è¯•ç¯å¢ƒæ¨¡æ‹Ÿä¸»ä»åˆ‡æ¢åœºæ™¯</li>
<li>éªŒè¯åº”ç”¨æ˜¯å¦èƒ½æ­£ç¡®æ„ŸçŸ¥é›†ç¾¤å˜åŒ–</li>
<li>ç¡®è®¤å¥åº·æ£€æŸ¥æœºåˆ¶çš„ç¨³å®šæ€§</li>
</ul>
</li>
<li><p><strong>ä¸Šçº¿éƒ¨ç½²ï¼š</strong></p>
<ul>
<li>åˆ†æ‰¹ç°åº¦å‘å¸ƒé…ç½®å˜æ›´</li>
<li>ç›‘æ§ä¸Šçº¿åçš„ç³»ç»Ÿè¡¨ç°</li>
<li>å‡†å¤‡å›æ»šæ–¹æ¡ˆ</li>
</ul>
</li>
</ol>
<h2 id="å…­ã€ç»éªŒæ€»ç»“"><a href="#å…­ã€ç»éªŒæ€»ç»“" class="headerlink" title="å…­ã€ç»éªŒæ€»ç»“"></a>å…­ã€ç»éªŒæ€»ç»“</h2><p>é€šè¿‡æœ¬æ¬¡é—®é¢˜å¤„ç†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä»¥ä¸‹ç»éªŒæ•™è®­ï¼š</p>
<h3 id="6-1-é¿å…ç±»ä¼¼é—®é¢˜çš„æªæ–½"><a href="#6-1-é¿å…ç±»ä¼¼é—®é¢˜çš„æªæ–½" class="headerlink" title="6.1 é¿å…ç±»ä¼¼é—®é¢˜çš„æªæ–½"></a>6.1 é¿å…ç±»ä¼¼é—®é¢˜çš„æªæ–½</h3><p><strong>åº”ç”¨å±‚é¢ï¼š</strong></p>
<ol>
<li><strong>å®¢æˆ·ç«¯ä¼˜åŒ–ï¼š</strong> å¯ç”¨Rediså®¢æˆ·ç«¯çš„é›†ç¾¤æ‹“æ‰‘è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½</li>
<li><strong>å¥åº·æ£€æŸ¥æ”¹è¿›ï¼š</strong> ä¼˜åŒ–å¥åº·æ£€æŸ¥é€»è¾‘ï¼Œå¢åŠ å®¹é”™å’Œé‡è¯•æœºåˆ¶</li>
<li><strong>é…ç½®ç®¡ç†ï¼š</strong> å»ºç«‹å®Œå–„çš„é…ç½®ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿å…³é”®å‚æ•°æ­£ç¡®è®¾ç½®</li>
</ol>
<p><strong>Rediså±‚é¢ï¼š</strong></p>
<ol>
<li><p><strong>æŒä¹…åŒ–ä¼˜åŒ–ï¼š</strong> </p>
<ul>
<li>è°ƒæ•´AOFé‡å†™è§¦å‘æ¡ä»¶ï¼Œé¿å…ä¸RDBåŒæ—¶æ‰§è¡Œ</li>
<li>é…ç½®<code>no-appendfsync-on-rewrite yes</code>ï¼Œåœ¨é‡å†™æœŸé—´ä¸æ‰§è¡Œfsync</li>
<li>è€ƒè™‘ä½¿ç”¨Redis 7.0çš„Multi-Part AOFç‰¹æ€§</li>
</ul>
</li>
<li><p><strong>èµ„æºè§„åˆ’ï¼š</strong></p>
<ul>
<li>ç¡®ä¿RedisæœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„CPUå’ŒIOèµ„æº</li>
<li>ä½¿ç”¨SSDç£ç›˜æå‡IOæ€§èƒ½</li>
<li>åˆç†é…ç½®<code>maxmemory</code>å‚æ•°ï¼Œé¿å…Forkæ—¶çš„å†…å­˜å‹åŠ›</li>
</ul>
</li>
<li><p><strong>æŒä¹…åŒ–ç­–ç•¥ï¼š</strong></p>
<ul>
<li>æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æŒä¹…åŒ–ç­–ç•¥ï¼ˆRDB&#x2F;AOF&#x2F;æ··åˆï¼‰</li>
<li>é”™å³°æ‰§è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œé¿å¼€ä¸šåŠ¡é«˜å³°æœŸ</li>
<li>è€ƒè™‘åœ¨ä»èŠ‚ç‚¹è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li>
</ul>
</li>
</ol>
<h3 id="6-2-ç›‘æ§å‘Šè­¦æ”¹è¿›å»ºè®®"><a href="#6-2-ç›‘æ§å‘Šè­¦æ”¹è¿›å»ºè®®" class="headerlink" title="6.2 ç›‘æ§å‘Šè­¦æ”¹è¿›å»ºè®®"></a>6.2 ç›‘æ§å‘Šè­¦æ”¹è¿›å»ºè®®</h3><ol>
<li><strong>å¢åŠ ä¸“é¡¹ç›‘æ§ï¼š</strong> ç›‘æ§Redisé›†ç¾¤èŠ‚ç‚¹å˜åŒ–äº‹ä»¶</li>
<li><strong>å®Œå–„å‘Šè­¦ç­–ç•¥ï¼š</strong> åŒºåˆ†ç¬æ—¶æ•…éšœå’ŒæŒç»­å¼‚å¸¸</li>
<li><strong>å»ºç«‹å…³è”åˆ†æï¼š</strong> å…³è”Redisé›†ç¾¤çŠ¶æ€ä¸åº”ç”¨å¥åº·çŠ¶æ€</li>
</ol>
<h3 id="6-3-åº”æ€¥é¢„æ¡ˆå®Œå–„"><a href="#6-3-åº”æ€¥é¢„æ¡ˆå®Œå–„" class="headerlink" title="6.3 åº”æ€¥é¢„æ¡ˆå®Œå–„"></a>6.3 åº”æ€¥é¢„æ¡ˆå®Œå–„</h3><ol>
<li><strong>æ ‡å‡†åŒ–å¤„ç†æµç¨‹ï¼š</strong> åˆ¶å®šRedisé›†ç¾¤æ•…éšœåº”æ€¥å¤„ç†æ‰‹å†Œ</li>
<li><strong>è‡ªåŠ¨åŒ–æ¢å¤æœºåˆ¶ï¼š</strong> å¼€å‘è‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤è„šæœ¬</li>
<li><strong>å®šæœŸæ¼”ç»ƒï¼š</strong> å®šæœŸè¿›è¡Œæ•…éšœæ¢å¤æ¼”ç»ƒ</li>
</ol>
<h2 id="ä¸ƒã€å‚è€ƒèµ„æ–™"><a href="#ä¸ƒã€å‚è€ƒèµ„æ–™" class="headerlink" title="ä¸ƒã€å‚è€ƒèµ„æ–™"></a>ä¸ƒã€å‚è€ƒèµ„æ–™</h2><ol>
<li>Rediså®˜æ–¹æ–‡æ¡£ - é›†ç¾¤è§„èŒƒ</li>
<li>Spring Data Rediså®˜æ–¹æ–‡æ¡£</li>
<li>Jediså®¢æˆ·ç«¯ä½¿ç”¨æŒ‡å—</li>
<li>Kuberneteså¥åº·æ£€æŸ¥æœ€ä½³å®è·µ</li>
<li>å¾®æœåŠ¡æ¶æ„ä¸‹çš„æ•…éšœå¤„ç†æ¨¡å¼</li>
</ol>
]]></content>
      <categories>
        <category>middleware</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>é›†ç¾¤</tag>
        <tag>ä¸»ä»åˆ‡æ¢</tag>
        <tag>æ•…éšœæ’æŸ¥</tag>
        <tag>ç”Ÿäº§é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>Rediså“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼</title>
    <url>/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/</url>
    <content><![CDATA[<h1 id="ä¸€ã€Rediså“¨å…µæ¨¡å¼æ­å»º"><a href="#ä¸€ã€Rediså“¨å…µæ¨¡å¼æ­å»º" class="headerlink" title="ä¸€ã€Rediså“¨å…µæ¨¡å¼æ­å»º"></a>ä¸€ã€Rediså“¨å…µæ¨¡å¼æ­å»º</h1><h2 id="1-1-Redis-çš„-ä¸»ä»å¤åˆ¶æ¨¡å¼-å’Œ-Sentinel-é«˜å¯ç”¨æ¶æ„-çš„ç¤ºæ„å›¾"><a href="#1-1-Redis-çš„-ä¸»ä»å¤åˆ¶æ¨¡å¼-å’Œ-Sentinel-é«˜å¯ç”¨æ¶æ„-çš„ç¤ºæ„å›¾" class="headerlink" title="1.1Â RedisÂ çš„Â ä¸»ä»å¤åˆ¶æ¨¡å¼Â å’ŒÂ SentinelÂ é«˜å¯ç”¨æ¶æ„Â çš„ç¤ºæ„å›¾"></a>1.1Â RedisÂ çš„Â ä¸»ä»å¤åˆ¶æ¨¡å¼Â å’ŒÂ SentinelÂ é«˜å¯ç”¨æ¶æ„Â çš„ç¤ºæ„å›¾</h2><p><img src="/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8F%8Asentinel%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" alt="redisä¸»ä»å¤åˆ¶åŠsentinelé«˜å¯ç”¨æ¶æ„å›¾"></p>
<h2 id="1-2-åŸºäºDockeræ¢ä»¶æ­å»ºRediså“¨å…µæ¨¡å¼"><a href="#1-2-åŸºäºDockeræ¢ä»¶æ­å»ºRediså“¨å…µæ¨¡å¼" class="headerlink" title="1.2 åŸºäºDockeræ¢ä»¶æ­å»ºRediså“¨å…µæ¨¡å¼"></a>1.2 åŸºäºDockeræ¢ä»¶æ­å»ºRediså“¨å…µæ¨¡å¼</h2><p>æœ¬æ¬¡æ­å»ºRediså“¨å…µæ¨¡å¼ä»…ä¸ºæµ‹è¯•ä½¿ç”¨ï¼Œä¸”å› èµ„æºæœ‰é™ï¼Œåœ¨ä¸€å°äº‘ä¸»æœºä¸Šå®‰è£…dockerå¼•æ“ï¼Œé€šè¿‡dockerå®¹å™¨æ­å»ºå“¨å…µæ¨¡å¼ã€‚</p>
<h3 id="1-2-1-å®‰è£…ç¯å¢ƒ"><a href="#1-2-1-å®‰è£…ç¯å¢ƒ" class="headerlink" title="1.2.1 å®‰è£…ç¯å¢ƒ"></a>1.2.1 å®‰è£…ç¯å¢ƒ</h3><p>äº‘ä¸»æœºé…ç½®ï¼š1æ ¸2G</p>
<p>æ‰€éœ€è½¯ä»¶åŠç¯å¢ƒï¼šdockerï¼Œ docker-composeï¼Œ redisé•œåƒ</p>
<h3 id="1-2-2-Redisä¸»ä»å¤åˆ¶"><a href="#1-2-2-Redisä¸»ä»å¤åˆ¶" class="headerlink" title="1.2.2 Redisä¸»ä»å¤åˆ¶"></a>1.2.2 Redisä¸»ä»å¤åˆ¶</h3><p>åˆ›å»ºdocker-compose.ymlé…ç½®æ–‡ä»¶ï¼š</p>
<blockquote>
<p>docker-compose.yml</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">version: &#39;3&#39;
services:
  master:
    image: redis
    container_name: redis-master
    command: redis-server --requirepass redis_hyk  --masterauth redis_hyk
    ports:
      - 6379:6379
  slave1:
    image: redis
    container_name: redis-slave-1
    ports:
      - 6380:6379
    command:  redis-server --slaveof 172.16.16.37 6379 --requirepass redis_hyk --masterauth redis_hyk --replica-announce-ip 172.16.16.37 --replica-announce-port 6380
  slave2:
    image: redis
    container_name: redis-slave-2
    ports:
      - 6381:6379
    command: redis-server --slaveof 172.16.16.37 6379 --requirepass redis_hyk --masterauth redis_hyk --replica-announce-ip 172.16.16.37 --replica-announce-port 6381<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨dockerså®¹å™¨é…ç½®ä¸»ä»æ—¶ï¼ŒslaveèŠ‚ç‚¹é»˜è®¤ä½¿ç”¨çš„æ—¶å®¹å™¨å†…éƒ¨çš„ipï¼Œä¼šå¯¼è‡´åœ¨å®¹å™¨å¤–éƒ¨æ— æ³•è®¿é—®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®æŒ‡å®šipåŠç«¯å£<br>è¯¦æƒ…å‚è€ƒï¼š<a href="https://redis.io/topics/replication">Rediså®˜ç½‘ Replication</a><br>replica-announce-ip 172.16.16.37<br>replica-announce-port 6380</p>
</blockquote>
<p>æ‰§è¡Œdocker-compose up -d å¯åŠ¨å®¹å™¨ã€‚</p>
<h3 id="1-2-3-Redis-Sentinel"><a href="#1-2-3-Redis-Sentinel" class="headerlink" title="1.2.3 Redis Sentinel"></a>1.2.3 Redis Sentinel</h3><p>åˆ›å»ºdocker-compose.ymlé…ç½®æ–‡ä»¶ï¼š</p>
<blockquote>
<p>docker-compose.yml</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">version: &#39;3&#39;
services:
  sentinel1:
    image: redis
    container_name: redis-sentinel-1
    ports:
      - 26379:26379
    command: redis-sentinel &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;sentinel.conf
    volumes:
      - .&#x2F;sentinel1.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;sentinel.conf
      - .&#x2F;26379&#x2F;:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;
  sentinel2:
    image: redis
    container_name: redis-sentinel-2
    ports:
    - 26380:26379
    command: redis-sentinel &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;sentinel.conf
    volumes:
      - .&#x2F;sentinel2.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;sentinel.conf
      - .&#x2F;26380&#x2F;:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;
  sentinel3:
    image: redis
    container_name: redis-sentinel-3
    ports:
      - 26381:26379
    command: redis-sentinel &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;sentinel.conf
    volumes:
      - .&#x2F;sentinel3.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;sentinel.conf
      - .&#x2F;26381:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;
networks:
  default:
    external:
      name: redis_default
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŒ‚è½½Sentinelé…ç½®æ–‡ä»¶ï¼š</p>
<blockquote>
<p>sentinel1.conf</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">port 26379
dir &#x2F;tmp
# 172.18.0.3æ˜¯redisçš„ä¸»èŠ‚ç‚¹ip
# æŒ‡ç¤º Sentinel å»ç›‘è§†ä¸€ä¸ªåä¸º mymaster çš„ä¸»æœåŠ¡å™¨ï¼Œ è¿™ä¸ªä¸»æœåŠ¡å™¨çš„ IP åœ°å€ä¸º 172.18.0.3 ï¼ˆdocker inspect [containerIP]å¯ä»¥è·å–ï¼‰ ç«¯å£å·ä¸º 6379
# å°†è¿™ä¸ªä¸»æœåŠ¡å™¨åˆ¤æ–­ä¸ºå¤±æ•ˆè‡³å°‘éœ€è¦ 2 ä¸ª Sentinel åŒæ„ ï¼ˆåªè¦åŒæ„ Sentinel çš„æ•°é‡ä¸è¾¾æ ‡ï¼Œè‡ªåŠ¨æ•…éšœè¿ç§»å°±ä¸ä¼šæ‰§è¡Œï¼‰
sentinel monitor mymaster 172.18.0.3 6379 2
#
sentinel auth-pass mymaster redis_pwd
# æŒ‡å®šäº† Sentinel è®¤ä¸ºæœåŠ¡å™¨å·²ç»æ–­çº¿æ‰€éœ€çš„æ¯«ç§’æ•°ã€‚
sentinel down-after-milliseconds mymaster 30000
# æŒ‡å®šäº†åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œ æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ—¶å¯¹æ–°çš„ä¸»æœåŠ¡å™¨è¿›è¡ŒåŒæ­¥ï¼Œ
# è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œ å®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 180000
sentinel deny-scripts-reconfig yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>PS:ç”±äºsentinelå¯åŠ¨ä¼šå¯¹sentinel.confæ–‡ä»¶åšä¿®æ”¹ï¼Œæˆ‘ä»¬å¯åŠ¨äº†3ä¸ªsentinelèŠ‚ç‚¹ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶éœ€è¦å¤åˆ¶3ä»½åˆ†åˆ«å¯¹åº”æ¯ä¸€ä¸ªèŠ‚ç‚¹</p>
<p>æ‰§è¡Œdocker-compose up -d å¯åŠ¨å®¹å™¨ã€‚</p>
<h3 id="1-2-4-éªŒè¯"><a href="#1-2-4-éªŒè¯" class="headerlink" title="1.2.4 éªŒè¯"></a>1.2.4 éªŒè¯</h3><p>æŸ¥çœ‹dockerå®¹å™¨çŠ¶æ€ï¼š<br><img src="/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/docker%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81.png" alt="dockerå®¹å™¨çŠ¶æ€"></p>
<p>æŸ¥çœ‹Reids MasterèŠ‚ç‚¹çŠ¶æ€ï¼š<br><img src="/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/Master%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81.png" alt="MasterèŠ‚ç‚¹çŠ¶æ€"></p>
<p>æŸ¥çœ‹sentinelèŠ‚ç‚¹çŠ¶æ€ï¼š<br><img src="/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/sentinel%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%81.png" alt="sentinelèŠ‚ç‚¹çŠ¶æ€"><br><img src="/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/sentinel%E8%8A%82%E7%82%B9%E7%8A%B6%E6%80%812.png" alt="sentinelèŠ‚ç‚¹çŠ¶æ€2"></p>
<h2 id="1-3-Rediså“¨å…µæ¨¡å¼æ•…éšœè½¬ç§»æµ‹è¯•"><a href="#1-3-Rediså“¨å…µæ¨¡å¼æ•…éšœè½¬ç§»æµ‹è¯•" class="headerlink" title="1.3 Rediså“¨å…µæ¨¡å¼æ•…éšœè½¬ç§»æµ‹è¯•"></a>1.3 Rediså“¨å…µæ¨¡å¼æ•…éšœè½¬ç§»æµ‹è¯•</h2><h3 id="1-3-1-æ–°å»ºSpringBooté¡¹ç›®è¿æ¥åˆ°Redis"><a href="#1-3-1-æ–°å»ºSpringBooté¡¹ç›®è¿æ¥åˆ°Redis" class="headerlink" title="1.3.1 æ–°å»ºSpringBooté¡¹ç›®è¿æ¥åˆ°Redis"></a>1.3.1 æ–°å»ºSpringBooté¡¹ç›®è¿æ¥åˆ°Redis</h3><h4 id="åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œæ·»åŠ Redisä¾èµ–ï¼š"><a href="#åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œæ·»åŠ Redisä¾èµ–ï¼š" class="headerlink" title="åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œæ·»åŠ Redisä¾èµ–ï¼š"></a>åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œæ·»åŠ Redisä¾èµ–ï¼š</h4><pre class="line-numbers language-none"><code class="language-none">   &lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;
&lt;&#x2F;dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;
	&lt;artifactId&gt;commons-pool2&lt;&#x2F;artifactId&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="é…ç½®Redis"><a href="#é…ç½®Redis" class="headerlink" title="é…ç½®Redis"></a>é…ç½®Redis</h4><pre class="line-numbers language-none"><code class="language-none">spring:
  redis:
    password: redis_hyk
    sentinel:
      master: mymaster
      nodes: 172.16.16.37:26379,172.16.16.37:26380,172.16.16.37:26381<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="åœ¨SpringBooté¡¹ç›®ä¸­æŒç»­è¿›è¡Œå†™å…¥æ“ä½œ"><a href="#åœ¨SpringBooté¡¹ç›®ä¸­æŒç»­è¿›è¡Œå†™å…¥æ“ä½œ" class="headerlink" title="åœ¨SpringBooté¡¹ç›®ä¸­æŒç»­è¿›è¡Œå†™å…¥æ“ä½œ"></a>åœ¨SpringBooté¡¹ç›®ä¸­æŒç»­è¿›è¡Œå†™å…¥æ“ä½œ</h4><pre class="line-numbers language-none"><code class="language-none">@Component
public class RedisService &#123;

    @Autowired
    private RedisTemplate&lt;String, String&gt; stringRedisTemplate;

    @PostConstruct
    public void writeRedis() &#123;
        DateTimeFormatter formatter &#x3D; DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss SSS&quot;);
        while(true) &#123;
            try &#123;
                String time &#x3D; ZonedDateTime.now().format(formatter);
                stringRedisTemplate.opsForValue().set(&quot;master-failover&quot;, time);
                Thread.sleep(1000);
            &#125; catch (Exception e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="åœæ­¢æ‰Redisçš„MasterèŠ‚ç‚¹"><a href="#åœæ­¢æ‰Redisçš„MasterèŠ‚ç‚¹" class="headerlink" title="åœæ­¢æ‰Redisçš„MasterèŠ‚ç‚¹"></a>åœæ­¢æ‰Redisçš„MasterèŠ‚ç‚¹</h4><p><code>docker container stop 881</code></p>
<h4 id="SpringBooté¡¹ç›®æ—¥å¿—è¾“å…¥"><a href="#SpringBooté¡¹ç›®æ—¥å¿—è¾“å…¥" class="headerlink" title="SpringBooté¡¹ç›®æ—¥å¿—è¾“å…¥"></a>SpringBooté¡¹ç›®æ—¥å¿—è¾“å…¥</h4><pre class="line-numbers language-none"><code class="language-none">20:02:59.584  INFO 15128 --- [xecutorLoop-1-3] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was &#x2F;172.16.16.37:6379
20:03:01.657  WARN 15128 --- [ioEventLoop-4-4] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [172.16.16.37:6379]: Connection refused: no further information: &#x2F;172.16.16.37:6379
20:03:05.957  INFO 15128 --- [xecutorLoop-1-2] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was 172.16.16.37:6379
20:03:07.997  WARN 15128 --- [ioEventLoop-4-2] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [172.16.16.37:6379]: Connection refused: no further information: &#x2F;172.16.16.37:6379
20:03:12.464  INFO 15128 --- [xecutorLoop-1-4] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was 172.16.16.37:6379
20:03:14.517  WARN 15128 --- [ioEventLoop-4-4] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [172.16.16.37:6379]: Connection refused: no further information: &#x2F;172.16.16.37:6379
20:03:19.659  INFO 15128 --- [xecutorLoop-1-2] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was 172.16.16.37:6379
20:03:21.714  WARN 15128 --- [ioEventLoop-4-2] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [172.16.16.37:6379]: Connection refused: no further information: &#x2F;172.16.16.37:6379
20:03:26.961  INFO 15128 --- [xecutorLoop-1-2] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was 172.16.16.37:6379
20:03:29.030  WARN 15128 --- [ioEventLoop-4-2] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [172.16.16.37:6379]: Connection refused: no further information: &#x2F;172.16.16.37:6379
20:03:33.167  INFO 15128 --- [xecutorLoop-1-4] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was 172.16.16.37:6379
20:03:33.184  INFO 15128 --- [ioEventLoop-4-4] i.l.core.protocol.ReconnectionHandler    : Reconnected to 172.16.16.37:6381<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="SentinelèŠ‚ç‚¹æ—¥å¿—è¾“å‡º"><a href="#SentinelèŠ‚ç‚¹æ—¥å¿—è¾“å‡º" class="headerlink" title="SentinelèŠ‚ç‚¹æ—¥å¿—è¾“å‡º"></a>SentinelèŠ‚ç‚¹æ—¥å¿—è¾“å‡º</h4><pre class="line-numbers language-none"><code class="language-none">04:01:34.181 # +sdown master mymaster 172.16.16.37 6379
04:01:34.309 # +new-epoch 1
04:01:34.325 # +vote-for-leader a1d392603fe93637b2194b0f67f38cf1946efdc2 1
04:01:35.280 # +odown master mymaster 172.16.16.37 6379 #quorum 3&#x2F;2
04:01:35.281 # Next failover delay: I will not start a failover before 04:07:35 2021
04:01:35.449 # +config-update-from sentinel a1d392603fe93637b2194b0f67f38cf1946efdc2 172.16.16.37 26380 @ mymaster 172.16.16.37 6379
04:01:35.449 # +switch-master mymaster 172.16.16.37 6379 172.16.16.37 6381
04:01:35.449 * +slave slave 172.16.16.37:6380 172.16.16.37 6380 @ mymaster 172.16.16.37 6381
04:01:35.449 * +slave slave 172.16.16.37:6379 172.16.16.37 6379 @ mymaster 172.16.16.37 6381
04:02:05.508 # +sdown slave 172.16.16.37:6379 172.16.16.37 6379 @ mymaster 172.16.16.37 6381
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ ¹æ®æ—¥å¿—è¾“å‡ºå¯ä»¥çœ‹åˆ°rediså“¨å…µæ¨¡å¼åœ¨3åˆ†å†…å®Œæˆäº†æ•…éšœè½¬ç§»æ“ä½œã€‚<br><code>sentinel failover-timeout mymaster 180000</code></p>
<h1 id="äºŒã€Redisé›†ç¾¤æ¨¡å¼æ­å»º"><a href="#äºŒã€Redisé›†ç¾¤æ¨¡å¼æ­å»º" class="headerlink" title="äºŒã€Redisé›†ç¾¤æ¨¡å¼æ­å»º"></a>äºŒã€Redisé›†ç¾¤æ¨¡å¼æ­å»º</h1><h2 id="2-1Redisé›†ç¾¤æ¨¡å¼æ¶æ„å›¾"><a href="#2-1Redisé›†ç¾¤æ¨¡å¼æ¶æ„å›¾" class="headerlink" title="2.1Redisé›†ç¾¤æ¨¡å¼æ¶æ„å›¾"></a>2.1Redisé›†ç¾¤æ¨¡å¼æ¶æ„å›¾</h2><p><img src="/2020/12/25/redis/redis-shao-bing-mo-shi-he-ji-qun-mo-shi/Redis%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="Redisé›†ç¾¤æ¨¡å¼æ¶æ„å›¾"></p>
<p>Redisçš„é›†ç¾¤å®ç°æ–¹æ¡ˆï¼š<br>(1)å®˜æ–¹çš„ redis cluster çš„æ–¹æ¡ˆ<br>(2)ç±» codis çš„æ¶æ„</p>
<h2 id="2-2-è™šæ‹Ÿæœºç¯å¢ƒä¸‹æ­å»ºRedisé›†ç¾¤æ¨¡å¼"><a href="#2-2-è™šæ‹Ÿæœºç¯å¢ƒä¸‹æ­å»ºRedisé›†ç¾¤æ¨¡å¼" class="headerlink" title="2.2 è™šæ‹Ÿæœºç¯å¢ƒä¸‹æ­å»ºRedisé›†ç¾¤æ¨¡å¼"></a>2.2 è™šæ‹Ÿæœºç¯å¢ƒä¸‹æ­å»ºRedisé›†ç¾¤æ¨¡å¼</h2><h3 id="2-2-1-ä¸‹è½½ç¼–è¯‘Redis"><a href="#2-2-1-ä¸‹è½½ç¼–è¯‘Redis" class="headerlink" title="2.2.1 ä¸‹è½½ç¼–è¯‘Redis"></a>2.2.1 ä¸‹è½½ç¼–è¯‘Redis</h3><p>ä»rediså®˜ç½‘ä¸‹è½½Redisæºç å¹¶è¿›è¡Œç¼–è¯‘ã€‚Rediså®˜ç½‘ï¼š<a href="https://redis.io/download">https://redis.io/download</a></p>
<p>æ³¨æ„ï¼šåœ¨Centos7ä¸Šç¼–è¯‘Redis6.xéœ€è¦gccçš„ç‰ˆæœ¬åœ¨5.0ä»¥ä¸Šï¼ŒCentos7é»˜è®¤çš„gccç‰ˆæœ¬ä¸º4.8.5ã€‚gccç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º9.3.1</p>
<h3 id="2-2-2-æ­å»ºRedisé›†ç¾¤æ¨¡å¼"><a href="#2-2-2-æ­å»ºRedisé›†ç¾¤æ¨¡å¼" class="headerlink" title="2.2.2 æ­å»ºRedisé›†ç¾¤æ¨¡å¼"></a>2.2.2 æ­å»ºRedisé›†ç¾¤æ¨¡å¼</h3><p>æ ¹æ®Rediså®˜æ–¹æ–‡æ¡£ï¼Œæµ‹è¯•æ­å»ºRedisé›†ç¾¤æ¨¡å¼ï¼š</p>
<p>ï¼ˆ1ï¼‰æ‰‹åŠ¨åˆ›å»ºredis.confé…ç½®æ–‡ä»¶å¯åŠ¨rediså®ä¾‹ï¼Œæœ€åé€šè¿‡redis-cli çš„é›†ç¾¤å‘½ä»¤åˆ›å»ºé›†ç¾¤</p>
<p>ï¼ˆ2ï¼‰é€šè¿‡Redisæºç åŒ…ä¸‹çš„utilså·¥å…·åŒ…ä¸‹çš„è„šæœ¬åˆ›å»ºï¼ˆè„šæœ¬åˆ›å»ºæ›´æ–¹ä¾¿ï¼Œä½†æ˜¯æ‰‹åŠ¨åˆ›å»ºæœ‰åŠ©äºäº†è§£é›†ç¾¤åˆ›å»ºçš„è¿‡ç¨‹ï¼‰</p>
<p>å…³äºé›†ç¾¤åˆ›å»ºçš„æ“ä½œæ­¥éª¤å¯ä»¥å‚è€ƒRedisçš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://redis.io/topics/cluster-tutorial">https://redis.io/topics/cluster-tutorial</a></p>
<h2 id="2-3-Redisé›†ç¾¤æ€»ç»“"><a href="#2-3-Redisé›†ç¾¤æ€»ç»“" class="headerlink" title="2.3 Redisé›†ç¾¤æ€»ç»“"></a>2.3 Redisé›†ç¾¤æ€»ç»“</h2><p>ï¼ˆ1ï¼‰Redisé›†ç¾¤æ‹“æ‰‘ç»“æ„<br>Redisé›†ç¾¤æ˜¯ä¸€ä¸ªç½‘çŠ¶ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é€šè¿‡TCPè¿æ¥è·Ÿå…¶å®ƒæ¯ä¸ªèŠ‚ç‚¹è¿æ¥ã€‚</p>
<p>åœ¨ä¸€ä¸ªæœ‰Nä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰N-1ä¸ªæµå‡ºçš„TCPè¿æ¥å’ŒN-1ä¸ªæµå…¥çš„TCPè¿æ¥ï¼Œè¿™äº›TCPè¿æ¥ä¼šæ°¸ä¹…ä¿æŒï¼Œå¹¶ä¸æ˜¯æŒ‰éœ€åˆ›å»ºçš„</p>
<p>ï¼ˆ2ï¼‰Redis é›†ç¾¤çš„æ•°æ®åˆ†ç‰‡<br>Redisé›†ç¾¤çš„å®ç°æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>å®¢æˆ·ç«¯åˆ†åŒºï¼Œä»£è¡¨ä¸ºÂ Redis Sharding</p>
</li>
<li><p>ä»£ç†åˆ†åŒºæ–¹æ¡ˆï¼Œä¸»æµå®ç°çš„æœ‰æ–¹æ¡ˆæœ‰Â TwemproxyÂ å’ŒÂ Codis</p>
</li>
<li><p>æŸ¥è¯¢è·¯ç”±æ–¹æ¡ˆï¼ŒRedisé»˜è®¤å®ç°æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash, è€Œæ˜¯å¼•å…¥äº†Â å“ˆå¸Œæ§½çš„æ¦‚å¿µ.</p>
<p>Redis é›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½,æ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½.é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½,ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚å½“å‰é›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹,é‚£ä¹ˆ:</p>
<p>èŠ‚ç‚¹ A åŒ…å« 0 åˆ° 5500å·å“ˆå¸Œæ§½.<br>èŠ‚ç‚¹ B åŒ…å«5501 åˆ° 11000 å·å“ˆå¸Œæ§½.<br>èŠ‚ç‚¹ C åŒ…å«11001 åˆ° 16384å·å“ˆå¸Œæ§½.<br>è¿™ç§ç»“æ„å¾ˆå®¹æ˜“æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹. æ¯”å¦‚å¦‚æœæˆ‘æƒ³æ–°æ·»åŠ ä¸ªèŠ‚ç‚¹D, æˆ‘éœ€è¦ä»èŠ‚ç‚¹ A, B, Cä¸­å¾—éƒ¨åˆ†æ§½åˆ°Dä¸Š. å¦‚æœæˆ‘æƒ³ç§»é™¤èŠ‚ç‚¹A,éœ€è¦å°†Aä¸­çš„æ§½ç§»åˆ°Bå’ŒCèŠ‚ç‚¹ä¸Š,ç„¶åå°†æ²¡æœ‰ä»»ä½•æ§½çš„AèŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤å³å¯. ç”±äºä»ä¸€ä¸ªèŠ‚ç‚¹å°†å“ˆå¸Œæ§½ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼šåœæ­¢æœåŠ¡,æ‰€ä»¥æ— è®ºæ·»åŠ åˆ é™¤æˆ–è€…æ”¹å˜æŸä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œæ§½çš„æ•°é‡éƒ½ä¸ä¼šé€ æˆé›†ç¾¤ä¸å¯ç”¨çš„çŠ¶æ€.</p>
<p>ï¼ˆ3ï¼‰Redisé›†ç¾¤çš„ä¸»ä»å¤åˆ¶æ¨¡å‹<br>ä¸ºäº†ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æˆ–è€…å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡çš„æƒ…å†µä¸‹é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨äº†ä¸»ä»å¤åˆ¶æ¨¡å‹,æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰N-1ä¸ªå¤åˆ¶å“.</p>
<p>åœ¨æˆ‘ä»¬ä¾‹å­ä¸­å…·æœ‰Aï¼ŒBï¼ŒCä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤,åœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹,å¦‚æœèŠ‚ç‚¹Bå¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘5501-11000è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨.</p>
<p>ç„¶è€Œå¦‚æœåœ¨é›†ç¾¤åˆ›å»ºçš„æ—¶å€™ï¼ˆæˆ–è€…è¿‡ä¸€æ®µæ—¶é—´ï¼‰æˆ‘ä»¬ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªä»èŠ‚ç‚¹A1ï¼ŒB1ï¼ŒC1,é‚£ä¹ˆæ•´ä¸ªé›†ç¾¤ä¾¿æœ‰ä¸‰ä¸ªmasterèŠ‚ç‚¹å’Œä¸‰ä¸ªslaveèŠ‚ç‚¹ç»„æˆï¼Œè¿™æ ·åœ¨èŠ‚ç‚¹Bå¤±è´¥åï¼Œé›†ç¾¤ä¾¿ä¼šé€‰ä¸¾B1ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ç»§ç»­æœåŠ¡ï¼Œæ•´ä¸ªé›†ç¾¤ä¾¿ä¸ä¼šå› ä¸ºæ§½æ‰¾ä¸åˆ°è€Œä¸å¯ç”¨äº†</p>
<p>ä¸è¿‡å½“Bå’ŒB1 éƒ½å¤±è´¥åï¼Œé›†ç¾¤æ˜¯ä¸å¯ç”¨çš„.</p>
<p>ï¼ˆ4ï¼‰Redisé›†ç¾¤çš„ä¸€è‡´æ€§ä¿è¯<br>Redis å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§. è¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œ.</p>
<p>ç¬¬ä¸€ä¸ªåŸå› æ˜¯å› ä¸ºé›†ç¾¤æ˜¯ç”¨äº†å¼‚æ­¥å¤åˆ¶. å†™æ“ä½œè¿‡ç¨‹:</p>
<p>å®¢æˆ·ç«¯å‘ä¸»èŠ‚ç‚¹Bå†™å…¥ä¸€æ¡å‘½ä»¤.<br>ä¸»èŠ‚ç‚¹Bå‘å®¢æˆ·ç«¯å›å¤å‘½ä»¤çŠ¶æ€.<br>ä¸»èŠ‚ç‚¹å°†å†™æ“ä½œå¤åˆ¶ç»™ä»–å¾—ä»èŠ‚ç‚¹ B1, B2 å’Œ B3.<br>ä¸»èŠ‚ç‚¹å¯¹å‘½ä»¤çš„å¤åˆ¶å·¥ä½œå‘ç”Ÿåœ¨è¿”å›å‘½ä»¤å›å¤ä¹‹åï¼Œ å› ä¸ºå¦‚æœæ¯æ¬¡å¤„ç†å‘½ä»¤è¯·æ±‚éƒ½éœ€è¦ç­‰å¾…å¤åˆ¶æ“ä½œå®Œæˆçš„è¯ï¼Œ é‚£ä¹ˆä¸»èŠ‚ç‚¹å¤„ç†å‘½ä»¤è¯·æ±‚çš„é€Ÿåº¦å°†æå¤§åœ°é™ä½ â€”â€” æˆ‘ä»¬å¿…é¡»åœ¨æ€§èƒ½å’Œä¸€è‡´æ€§ä¹‹é—´åšå‡ºæƒè¡¡ã€‚ æ³¨æ„ï¼šRedis é›†ç¾¤å¯èƒ½ä¼šåœ¨å°†æ¥æä¾›åŒæ­¥å†™çš„æ–¹æ³•ã€‚ Redis é›†ç¾¤å¦å¤–ä¸€ç§å¯èƒ½ä¼šä¸¢å¤±å‘½ä»¤çš„æƒ…å†µæ˜¯é›†ç¾¤å‡ºç°äº†ç½‘ç»œåˆ†åŒºï¼Œ å¹¶ä¸”ä¸€ä¸ªå®¢æˆ·ç«¯ä¸è‡³å°‘åŒ…æ‹¬ä¸€ä¸ªä¸»èŠ‚ç‚¹åœ¨å†…çš„å°‘æ•°å®ä¾‹è¢«å­¤ç«‹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ å‡è®¾é›†ç¾¤åŒ…å« A ã€ B ã€ C ã€ A1 ã€ B1 ã€ C1 å…­ä¸ªèŠ‚ç‚¹ï¼Œ å…¶ä¸­ A ã€B ã€C ä¸ºä¸»èŠ‚ç‚¹ï¼Œ A1 ã€B1 ã€C1 ä¸ºAï¼ŒBï¼ŒCçš„ä»èŠ‚ç‚¹ï¼Œ è¿˜æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ Z1 å‡è®¾é›†ç¾¤ä¸­å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œé‚£ä¹ˆé›†ç¾¤å¯èƒ½ä¼šåˆ†ä¸ºä¸¤æ–¹ï¼Œå¤§éƒ¨åˆ†çš„ä¸€æ–¹åŒ…å«èŠ‚ç‚¹ A ã€C ã€A1 ã€B1 å’Œ C1 ï¼Œå°éƒ¨åˆ†çš„ä¸€æ–¹åˆ™åŒ…å«èŠ‚ç‚¹ B å’Œå®¢æˆ·ç«¯ Z1 .</p>
<p>Z1ä»ç„¶èƒ½å¤Ÿå‘ä¸»èŠ‚ç‚¹Bä¸­å†™å…¥, å¦‚æœç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶é—´è¾ƒçŸ­,é‚£ä¹ˆé›†ç¾¤å°†ä¼šç»§ç»­æ­£å¸¸è¿ä½œ,å¦‚æœåˆ†åŒºçš„æ—¶é—´è¶³å¤Ÿè®©å¤§éƒ¨åˆ†çš„ä¸€æ–¹å°†B1é€‰ä¸¾ä¸ºæ–°çš„masterï¼Œé‚£ä¹ˆZ1å†™å…¥Bä¸­å¾—æ•°æ®ä¾¿ä¸¢å¤±äº†.</p>
<p>æ³¨æ„ï¼Œ åœ¨ç½‘ç»œåˆ†è£‚å‡ºç°æœŸé—´ï¼Œ å®¢æˆ·ç«¯ Z1 å¯ä»¥å‘ä¸»èŠ‚ç‚¹ B å‘é€å†™å‘½ä»¤çš„æœ€å¤§æ—¶é—´æ˜¯æœ‰é™åˆ¶çš„ï¼Œ è¿™ä¸€æ—¶é—´é™åˆ¶ç§°ä¸ºèŠ‚ç‚¹è¶…æ—¶æ—¶é—´ï¼ˆnode timeoutï¼‰ï¼Œ æ˜¯ Redis é›†ç¾¤çš„ä¸€ä¸ªé‡è¦çš„é…ç½®é€‰é¡¹ã€‚</p>
<p>ï¼ˆ5ï¼‰Redisé›†ç¾¤åœ¨çº¿é‡é…ç½®<br>Redis é›†ç¾¤æ”¯æŒåœ¨é›†ç¾¤è¿è¡Œè¿‡ç¨‹ä¸­æ·»åŠ æˆ–ç§»é™¤èŠ‚ç‚¹ã€‚å®é™…ä¸Šï¼Œæ·»åŠ æˆ–ç§»é™¤èŠ‚ç‚¹éƒ½è¢«æŠ½è±¡ä¸ºåŒä¸€ä¸ªæ“ä½œï¼Œé‚£å°±æ˜¯æŠŠå“ˆå¸Œæ§½ä»ä¸€ä¸ªèŠ‚ç‚¹ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>å‘é›†ç¾¤æ·»åŠ ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªç©ºèŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­å¹¶æŠŠæŸäº›å“ˆå¸Œæ§½ä»å·²å­˜åœ¨çš„èŠ‚ç‚¹ç§»åˆ°æ–°èŠ‚ç‚¹ä¸Šã€‚<br>ä»é›†ç¾¤ä¸­ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯æŠŠè¯¥èŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½ç§»åˆ°å…¶ä»–å·²å­˜åœ¨çš„èŠ‚ç‚¹ä¸Šã€‚<br>æ‰€ä»¥å®ç°è¿™ä¸ªçš„æ ¸å¿ƒæ˜¯èƒ½æŠŠå“ˆå¸Œæ§½ç§»æ¥ç§»å»ã€‚ä»å®é™…è§’åº¦çœ‹ï¼Œå“ˆå¸Œæ§½å°±åªæ˜¯ä¸€å †é”®ï¼Œæ‰€ä»¥ Redis é›†ç¾¤åœ¨é‡ç»„ç¢ç‰‡ï¼ˆreshardï¼‰æ—¶åšçš„å°±æ˜¯æŠŠé”®ä»ä¸€ä¸ªèŠ‚ç‚¹ç§»åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br>ä¸ºäº†ç†è§£è¿™æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç» CLUSTER çš„å­å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯ç”¨æ¥æ“ä½œ Redis é›†ç¾¤èŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½è½¬æ¢è¡¨ï¼ˆslots translation tableï¼‰ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å¯ç”¨çš„å­å‘½ä»¤ï¼š</p>
<p>CLUSTER ADDSLOTSÂ slot1 [slot2] â€¦ [slotN]<br>CLUSTER DELSLOTSÂ slot1 [slot2] â€¦ [slotN]<br>CLUSTER SETSLOTÂ slot NODE node<br>CLUSTER SETSLOTÂ slot MIGRATING node<br>CLUSTER SETSLOTÂ slot IMPORTING node<br>å¤´ä¸¤ä¸ªå‘½ä»¤ï¼ŒADDSLOTS å’Œ DELSLOTSï¼Œå°±æ˜¯ç®€å•åœ°ç”¨æ¥ç»™ä¸€ä¸ª Redis èŠ‚ç‚¹æŒ‡æ´¾ï¼ˆassignï¼‰æˆ–ç§»é™¤å“ˆå¸Œæ§½ã€‚ åœ¨å“ˆå¸Œæ§½è¢«æŒ‡æ´¾åï¼ŒèŠ‚ç‚¹ä¼šå°†è¿™ä¸ªæ¶ˆæ¯é€šè¿‡ gossip åè®®å‘æ•´ä¸ªé›†ç¾¤ä¼ æ’­ã€‚ADDSLOTS å‘½ä»¤é€šå¸¸æ˜¯ç”¨äºåœ¨ä¸€ä¸ªé›†ç¾¤åˆšå»ºç«‹çš„æ—¶å€™å¿«é€Ÿç»™æ‰€æœ‰èŠ‚ç‚¹æŒ‡æ´¾å“ˆå¸Œæ§½ã€‚<br>å½“ SETSLOT å­å‘½ä»¤ä½¿ç”¨ NODE å½¢å¼çš„æ—¶å€™ï¼Œç”¨æ¥ç»™æŒ‡å®š ID çš„èŠ‚ç‚¹æŒ‡æ´¾å“ˆå¸Œæ§½ã€‚ é™¤æ­¤ä¹‹å¤–å“ˆå¸Œæ§½èƒ½é€šè¿‡ä¸¤ä¸ªç‰¹æ®Šçš„çŠ¶æ€æ¥è®¾å®šï¼ŒMIGRATING å’Œ IMPORTINGï¼š</p>
<p>å½“ä¸€ä¸ªæ§½è¢«è®¾ç½®ä¸º MIGRATINGï¼ŒåŸæ¥æŒæœ‰è¯¥å“ˆå¸Œæ§½çš„èŠ‚ç‚¹ä»ä¼šæ¥å—æ‰€æœ‰è·Ÿè¿™ä¸ªå“ˆå¸Œæ§½æœ‰å…³çš„è¯·æ±‚ï¼Œä½†åªæœ‰å½“æŸ¥è¯¢çš„é”®è¿˜å­˜åœ¨åŸèŠ‚ç‚¹æ—¶ï¼ŒåŸèŠ‚ç‚¹ä¼šå¤„ç†è¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿™ä¸ªæŸ¥è¯¢ä¼šé€šè¿‡ä¸€ä¸ª -ASK é‡å®šå‘ï¼ˆ-ASK redirectionï¼‰è½¬å‘åˆ°è¿ç§»çš„ç›®æ ‡èŠ‚ç‚¹ã€‚<br>å½“ä¸€ä¸ªæ§½è¢«è®¾ç½®ä¸º IMPORTINGï¼Œåªæœ‰åœ¨æ¥å—åˆ° ASKING å‘½ä»¤ä¹‹åèŠ‚ç‚¹æ‰ä¼šæ¥å—æ‰€æœ‰æŸ¥è¯¢è¿™ä¸ªå“ˆå¸Œæ§½çš„è¯·æ±‚ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸€ç›´æ²¡æœ‰å‘é€ ASKING å‘½ä»¤ï¼Œé‚£ä¹ˆæŸ¥è¯¢éƒ½ä¼šé€šè¿‡ -MOVED é‡å®šå‘é”™è¯¯è½¬å‘åˆ°çœŸæ­£å¤„ç†è¿™ä¸ªå“ˆå¸Œæ§½çš„èŠ‚ç‚¹é‚£é‡Œã€‚<br>è¿™ä¹ˆè®²å¯èƒ½æ˜¾å¾—æœ‰ç‚¹å¥‡æ€ªï¼Œç°åœ¨æˆ‘ä»¬ç”¨å®ä¾‹è®©å®ƒæ›´æ¸…æ™°äº›ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ª Redis èŠ‚ç‚¹ï¼Œç§°ä¸º A å’Œ Bã€‚æˆ‘ä»¬æƒ³è¦æŠŠå“ˆå¸Œæ§½ 8 ä» èŠ‚ç‚¹A ç§»åˆ° èŠ‚ç‚¹Bï¼Œæ‰€ä»¥æˆ‘ä»¬å‘é€äº†è¿™æ ·çš„å‘½ä»¤ï¼š</p>
<p>æˆ‘ä»¬å‘ èŠ‚ç‚¹B å‘é€ï¼šCLUSTER SETSLOT 8 IMPORTING A<br>æˆ‘ä»¬å‘ èŠ‚ç‚¹A å‘é€ï¼šCLUSTER SETSLOT 8 MIGRATING B<br>å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹åœ¨æ¯æ¬¡è¢«è¯¢é—®åˆ°çš„ä¸€ä¸ªé”®æ˜¯å±äºå“ˆå¸Œæ§½ 8 çš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠå®¢æˆ·ç«¯å¼•å‘èŠ‚ç‚¹â€Aâ€ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<p>æ‰€æœ‰å…³äºå·²å­˜åœ¨çš„é”®çš„æŸ¥è¯¢éƒ½ç”±èŠ‚ç‚¹â€Aâ€å¤„ç†ã€‚<br>æ‰€æœ‰å…³äºä¸å­˜åœ¨äºèŠ‚ç‚¹ A çš„é”®éƒ½ç”±èŠ‚ç‚¹â€Bâ€å¤„ç†ã€‚<br>è¿™ç§æ–¹å¼è®©æˆ‘ä»¬å¯ä»¥ä¸ç”¨åœ¨èŠ‚ç‚¹ A ä¸­åˆ›å»ºæ–°çš„é”®ã€‚åŒæ—¶ï¼Œä¸€ä¸ªå«åš redis-trib çš„ç‰¹æ®Šå®¢æˆ·ç«¯ï¼Œå®ƒä¹Ÿæ˜¯ Redis é›†ç¾¤çš„é…ç½®ç¨‹åºï¼ˆconfiguration utilityï¼‰ï¼Œä¼šç¡®ä¿æŠŠå·²å­˜åœ¨çš„é”®ä»èŠ‚ç‚¹ A ç§»åˆ°èŠ‚ç‚¹ Bã€‚è¿™é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®ç°ï¼š</p>
<p>CLUSTER GETKEYSINSLOT slot count<br>ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šè¿”å›æŒ‡å®šçš„å“ˆå¸Œæ§½ä¸­ count ä¸ªé”®ã€‚å¯¹äºæ¯ä¸ªè¿”å›çš„é”®ï¼Œredis-trib å‘èŠ‚ç‚¹ A å‘é€ä¸€ä¸ªÂ MIGRATEÂ å‘½ä»¤ï¼Œè¿™æ ·ä¼šä»¥åŸå­æ€§çš„æ–¹å¼ï¼ˆåœ¨ç§»åŠ¨é”®çš„è¿‡ç¨‹ä¸­ä¸¤ä¸ªèŠ‚ç‚¹éƒ½è¢«é”ä½ï¼Œä»¥å…å‡ºç°ç«äº‰çŠ¶å†µï¼‰æŠŠæŒ‡å®šçš„é”®ä»èŠ‚ç‚¹ A ç§»åˆ°èŠ‚ç‚¹ Bã€‚ä»¥ä¸‹æ˜¯Â MIGRATEÂ çš„å·¥ä½œåŸç†ï¼š</p>
<p>MIGRATE target_host target_port key target_database id timeout<br>æ‰§è¡Œ MIGRATE å‘½ä»¤çš„èŠ‚ç‚¹ä¼šè¿æ¥åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼ŒæŠŠåºåˆ—åŒ–åçš„ key å‘é€è¿‡å»ï¼Œä¸€æ—¦æ”¶åˆ° OK å›å¤å°±ä¼šä»å®ƒè‡ªå·±çš„æ•°æ®é›†ä¸­åˆ é™¤è€çš„ keyã€‚æ‰€ä»¥ä»ä¸€ä¸ªå¤–éƒ¨å®¢æˆ·ç«¯çœ‹æ¥ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä¸€ä¸ª key è¦ä¸å°±å­˜åœ¨äºèŠ‚ç‚¹ A ä¸­è¦ä¸å°±å­˜åœ¨äºèŠ‚ç‚¹ B ä¸­ã€‚</p>
<p>åœ¨ Redis é›†ç¾¤ä¸­ï¼Œä¸éœ€è¦æŒ‡å®šä¸€ä¸ªé™¤äº† 0 å·ä¹‹å¤–çš„æ•°æ®åº“ï¼Œä½†Â MIGRATEÂ å‘½ä»¤èƒ½ç”¨äºå…¶ä»–è·Ÿ Redis é›†ç¾¤æ— å…³çš„çš„ä»»åŠ¡ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªè¶³å¤Ÿé€šç”¨çš„å‘½ä»¤ã€‚MIGRATEÂ å‘½ä»¤è¢«ä¼˜åŒ–äº†ï¼Œä½¿å¾—å³ä½¿åœ¨ç§»åŠ¨åƒé•¿åˆ—è¡¨è¿™æ ·çš„å¤æ‚é”®ä»ç„¶èƒ½åšåˆ°å¿«é€Ÿã€‚ ä¸è¿‡å½“åœ¨é‡é…ç½®ä¸€ä¸ªæ‹¥æœ‰å¾ˆå¤šé”®ä¸”é”®çš„æ•°æ®é‡éƒ½å¾ˆå¤§çš„é›†ç¾¤çš„æ—¶å€™ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å¹¶ä¸é‚£ä¹ˆå¥½äº†ï¼Œå¯¹äºä½¿ç”¨æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥è¯´å°±ä¼šæœ‰å»¶æ—¶è¿™ä¸ªé™åˆ¶ã€‚</p>
<p>ï¼ˆ6ï¼‰Redisé›†ç¾¤å¤±æ•ˆæ£€æµ‹<br>Redis é›†ç¾¤å¤±æ•ˆæ£€æµ‹æ˜¯ç”¨æ¥è¯†åˆ«å‡ºå¤§å¤šæ•°èŠ‚ç‚¹ä½•æ—¶æ— æ³•è®¿é—®æŸä¸€ä¸ªä¸»èŠ‚ç‚¹æˆ–ä»èŠ‚ç‚¹ã€‚å½“è¿™ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±æå‡ä¸€ä¸ªä»èŠ‚ç‚¹æ¥åšä¸»èŠ‚ç‚¹ï¼›è‹¥å¦‚æœæ— æ³•æå‡ä»èŠ‚ç‚¹æ¥åšä¸»èŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ç½®ä¸ºé”™è¯¯çŠ¶æ€å¹¶åœæ­¢æ¥æ”¶å®¢æˆ·ç«¯çš„æŸ¥è¯¢ã€‚</p>
<p>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä»½è·Ÿå…¶ä»–å·²çŸ¥èŠ‚ç‚¹ç›¸å…³çš„æ ‡è¯†åˆ—è¡¨ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªæ ‡è¯†æ˜¯ç”¨äºå¤±æ•ˆæ£€æµ‹ï¼Œåˆ†åˆ«æ˜¯ PFAIL å’Œ FAILã€‚PFAIL è¡¨ç¤ºå¯èƒ½å¤±æ•ˆï¼ˆPossible failureï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªéå…¬è®¤çš„ï¼ˆnon acknowledgedï¼‰å¤±æ•ˆç±»å‹ã€‚FAIL è¡¨ç¤ºä¸€ä¸ªèŠ‚ç‚¹å·²ç»å¤±æ•ˆï¼Œè€Œä¸”è¿™ä¸ªæƒ…å†µå·²ç»è¢«å¤§å¤šæ•°ä¸»èŠ‚ç‚¹åœ¨æŸæ®µå›ºå®šæ—¶é—´å†…ç¡®è®¤è¿‡çš„äº†ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h2><p><a href="https://redis.io/topics/cluster-tutorial">https://redis.io/topics/cluster-tutorial</a></p>
<p><a href="https://juejin.cn/post/6850418118721077261">docker-composeå¿«é€Ÿæ­å»ºrediså“¨å…µæ¨¡å¼é«˜å¯ç”¨é›†ç¾¤</a></p>
<p><a href="https://juejin.cn/post/6844903663362637832">æ·±å…¥å‰–æRedisç³»åˆ—(äºŒ) - Rediså“¨å…µæ¨¡å¼ä¸é«˜å¯ç”¨é›†ç¾¤</a></p>
<p><a href="https://msd.misuland.com/pd/3255817928875971830">redis clusteré›†ç¾¤æ¨¡å¼æ€»ç»“</a></p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Redis</tag>
        <tag>å“¨å…µæ¨¡å¼</tag>
        <tag>é›†ç¾¤æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆRedisé›†ç¾¤ä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½</title>
    <url>/2020/12/30/redis/wei-shi-me-redis-ji-qun-shi-yong-16384-ge-ha-xi-cao/</url>
    <content><![CDATA[<h1 id="ä¸€ã€Redisé›†ç¾¤ç‰¹ç‚¹"><a href="#ä¸€ã€Redisé›†ç¾¤ç‰¹ç‚¹" class="headerlink" title="ä¸€ã€Redisé›†ç¾¤ç‰¹ç‚¹"></a>ä¸€ã€Redisé›†ç¾¤ç‰¹ç‚¹</h1><h2 id="1-1-Redisé›†ç¾¤æ‹“æ‰‘ç»“æ„"><a href="#1-1-Redisé›†ç¾¤æ‹“æ‰‘ç»“æ„" class="headerlink" title="1.1 Redisé›†ç¾¤æ‹“æ‰‘ç»“æ„"></a>1.1 Redisé›†ç¾¤æ‹“æ‰‘ç»“æ„</h2><p>Redisé›†ç¾¤æ˜¯ä¸€ä¸ªç½‘çŠ¶ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½é€šè¿‡TCPè¿æ¥è·Ÿå…¶å®ƒæ¯ä¸ªèŠ‚ç‚¹è¿æ¥ã€‚</p>
<p>åœ¨ä¸€ä¸ªæœ‰Nä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰N-1ä¸ªæµå‡ºçš„TCPè¿æ¥å’ŒN-1ä¸ªæµå…¥çš„TCPè¿æ¥ï¼Œè¿™äº›TCPè¿æ¥ä¼šæ°¸ä¹…ä¿æŒï¼Œå¹¶ä¸æ˜¯æŒ‰éœ€åˆ›å»ºçš„ã€‚</p>
<h2 id="1-2-Redisé›†ç¾¤æ•°æ®åˆ†ç‰‡"><a href="#1-2-Redisé›†ç¾¤æ•°æ®åˆ†ç‰‡" class="headerlink" title="1.2 Redisé›†ç¾¤æ•°æ®åˆ†ç‰‡"></a>1.2 Redisé›†ç¾¤æ•°æ®åˆ†ç‰‡</h2><h3 id="Redisé›†ç¾¤çš„å®ç°æ–¹æ¡ˆï¼š"><a href="#Redisé›†ç¾¤çš„å®ç°æ–¹æ¡ˆï¼š" class="headerlink" title="Redisé›†ç¾¤çš„å®ç°æ–¹æ¡ˆï¼š"></a>Redisé›†ç¾¤çš„å®ç°æ–¹æ¡ˆï¼š</h3><ul>
<li><p>å®¢æˆ·ç«¯åˆ†åŒºï¼Œä»£è¡¨ä¸º Redis Sharding</p>
</li>
<li><p>ä»£ç†åˆ†åŒºæ–¹æ¡ˆï¼Œä¸»æµå®ç°çš„æœ‰æ–¹æ¡ˆæœ‰ Twemproxy å’Œ Codis</p>
</li>
<li><p>æŸ¥è¯¢è·¯ç”±æ–¹æ¡ˆï¼ŒRedisé»˜è®¤å®ç°æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<h2 id="1-3-Redis-é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash-è€Œæ˜¯å¼•å…¥äº†-å“ˆå¸Œæ§½çš„æ¦‚å¿µ"><a href="#1-3-Redis-é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash-è€Œæ˜¯å¼•å…¥äº†-å“ˆå¸Œæ§½çš„æ¦‚å¿µ" class="headerlink" title="1.3 Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash, è€Œæ˜¯å¼•å…¥äº† å“ˆå¸Œæ§½çš„æ¦‚å¿µ."></a>1.3 Redis é›†ç¾¤æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hash, è€Œæ˜¯å¼•å…¥äº† å“ˆå¸Œæ§½çš„æ¦‚å¿µ.</h2><p>Redis é›†ç¾¤æœ‰16384ä¸ªå“ˆå¸Œæ§½,æ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16384å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½.é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½,ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚å½“å‰é›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹,é‚£ä¹ˆ:</p>
<p>èŠ‚ç‚¹ A åŒ…å« 0 åˆ° 5500å·å“ˆå¸Œæ§½.<br>èŠ‚ç‚¹ B åŒ…å«5501 åˆ° 11000 å·å“ˆå¸Œæ§½.<br>èŠ‚ç‚¹ C åŒ…å«11001 åˆ° 16384å·å“ˆå¸Œæ§½.<br>è¿™ç§ç»“æ„å¾ˆå®¹æ˜“æ·»åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹. æ¯”å¦‚å¦‚æœæˆ‘æƒ³æ–°æ·»åŠ ä¸ªèŠ‚ç‚¹D, æˆ‘éœ€è¦ä»èŠ‚ç‚¹ A, B, Cä¸­å¾—éƒ¨åˆ†æ§½åˆ°Dä¸Š. å¦‚æœæˆ‘æƒ³ç§»é™¤èŠ‚ç‚¹A,éœ€è¦å°†Aä¸­çš„æ§½ç§»åˆ°Bå’ŒCèŠ‚ç‚¹ä¸Š,ç„¶åå°†æ²¡æœ‰ä»»ä½•æ§½çš„AèŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤å³å¯. ç”±äºä»ä¸€ä¸ªèŠ‚ç‚¹å°†å“ˆå¸Œæ§½ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹å¹¶ä¸ä¼šåœæ­¢æœåŠ¡,æ‰€ä»¥æ— è®ºæ·»åŠ åˆ é™¤æˆ–è€…æ”¹å˜æŸä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œæ§½çš„æ•°é‡éƒ½ä¸ä¼šé€ æˆé›†ç¾¤ä¸å¯ç”¨çš„çŠ¶æ€ã€‚</p>
<h1 id="äºŒã€ä¸ºä»€ä¹ˆRedisçš„é›†ç¾¤ä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½ï¼Ÿ"><a href="#äºŒã€ä¸ºä»€ä¹ˆRedisçš„é›†ç¾¤ä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½ï¼Ÿ" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆRedisçš„é›†ç¾¤ä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½ï¼Ÿ"></a>äºŒã€ä¸ºä»€ä¹ˆRedisçš„é›†ç¾¤ä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½ï¼Ÿ</h1><p>è¿™ä¸ªé—®é¢˜Redisçš„ä½œè€…åˆåœ¨githubçš„issueä¸­è§£é‡Šè¿‡ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹åŸæ–‡ï¼š<a href="https://github.com/redis/redis/issues/2576">åŸæ–‡åœ°å€</a></p>
<blockquote>
<p>why redis-cluster use 16384 slots? crc16() can have 2^16 -1&#x3D;65535 different remaindersã€‚</p>
</blockquote>
<blockquote>
<p>The reason is:</p>
<ol>
<li>Normal heartbeat packets carry the full configuration of a node, that can be replaced in an idempotent way with the old in order to update an old config. This means they contain the slots configuration for a node, in raw form, that uses 2k of space with16k slots, but would use a prohibitive 8k of space using 65k slots.</li>
<li>At the same time it is unlikely that Redis Cluster would scale to more than 1000 mater nodes because of other design tradeoffs.<br>So 16k was in the right range to ensure enough slots per master with a max of 1000 maters, but a small enough number to propagate the slot configuration as a raw bitmap easily. Note that in small clusters the bitmap would be hard to compress because when N is small the bitmap would have slots&#x2F;N bits set that is a large percentage of bits set.</li>
</ol>
</blockquote>
<h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>ä»ä¸Šé¢Redisçš„é›†ç¾¤æ‹“æ‰‘æ¶æ„ä¸­æˆ‘ä»¬çŸ¥é“ï¼ŒRedisé›†ç¾¤èŠ‚ç‚¹æ˜¯é€šè¿‡gossipåè®®è¿›è¡Œç‚¹å¯¹ç‚¹é€šä¿¡çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šä¸é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹è¿›è¡Œé€šä¿¡ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Rediså¿ƒè·³åŒ…çš„æ•°æ®ç»“æ„ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">typedef struct &#123;
    char sig[4];        &#x2F;* Signature &quot;RCmb&quot; (Redis Cluster message bus). *&#x2F;
    uint32_t totlen;    &#x2F;* Total length of this message *&#x2F;
    uint16_t ver;       &#x2F;* Protocol version, currently set to 1. *&#x2F;
    uint16_t port;      &#x2F;* TCP base port number. *&#x2F;
    uint16_t type;      &#x2F;* Message type *&#x2F;
    uint16_t count;     &#x2F;* Only used for some kind of messages. *&#x2F;
    uint64_t currentEpoch;  &#x2F;* The epoch accordingly to the sending node. *&#x2F;
    uint64_t configEpoch;   &#x2F;* The config epoch if it&#39;s a master, or the last
                               epoch advertised by its master if it is a
                               slave. *&#x2F;
    uint64_t offset;    &#x2F;* Master replication offset if node is a master or
                           processed replication offset if node is a slave. *&#x2F;
    char sender[CLUSTER_NAMELEN]; &#x2F;* Name of the sender node *&#x2F;
    unsigned char myslots[CLUSTER_SLOTS&#x2F;8];
    char slaveof[CLUSTER_NAMELEN];
    char myip[NET_IP_STR_LEN];    &#x2F;* Sender IP, if not all zeroed. *&#x2F;
    char notused1[34];  &#x2F;* 34 bytes reserved for future usage. *&#x2F;
    uint16_t cport;      &#x2F;* Sender TCP cluster bus port *&#x2F;
    uint16_t flags;      &#x2F;* Sender node flags *&#x2F;
    unsigned char state; &#x2F;* Cluster state from the POV of the sender *&#x2F;
    unsigned char mflags[3]; &#x2F;* Message flags: CLUSTERMSG_FLAG[012]_... *&#x2F;
    union clusterMsgData data;
&#125; clusterMsg;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¶ˆæ¯å¤´é‡Œé¢æœ‰ä¸ªmyslotsçš„charæ•°ç»„ï¼Œé•¿åº¦ä¸º16383&#x2F;8ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªbitmap,æ¯ä¸€ä¸ªä½ä»£è¡¨ä¸€ä¸ªæ§½ï¼Œå¦‚æœè¯¥ä½ä¸º1ï¼Œè¡¨ç¤ºè¿™ä¸ªæ§½æ˜¯å±äºè¿™ä¸ªèŠ‚ç‚¹çš„ã€‚</p>
<p>åœ¨Redisçš„å¿ƒè·³åŒ…æºå¸¦äº†èŠ‚ç‚¹çš„å…¨éƒ¨é…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„å»æ›´æ–°ä¸€ä¸ªæ—§èŠ‚ç‚¹çš„å…¨éƒ¨ä¿¡æ¯ã€‚åœ¨å¿ƒè·³åŒ…ä¸­åŒ…å«äº†ä¸ºè¿™ä¸ªèŠ‚ç‚¹é…ç½®çš„å…¨éƒ¨å“ˆå¸Œæ§½ä¿¡æ¯ï¼Œä»–æ˜¯ä¸€ä¸ªä½å›¾æ•°æ®ç»“æ„ã€‚<br>ï¼ˆ1ï¼‰å¦‚æœä½¿ç”¨16384ä¸ªå“ˆå¸Œæ§½ï¼Œåˆ™è¿™ä¸ªå­—æ®µå¤§å°ä¸º2KBï¼Œå¦‚æœä½¿ç”¨65535ä¸ªå“ˆå¸Œæ§½ï¼Œåˆ™å°†å ç”¨8KBçš„ç©ºé—´ã€‚<br>è€Œä¸”ç”±äºå…¶å®ƒè®¾è®¡ä¸Šçš„æƒè¡¡ï¼Œä¸€ä¸ªRedisé›†ç¾¤çš„è§„æ¨¡ä¸å¯èƒ½è¶…è¿‡1000ä¸ªèŠ‚ç‚¹ã€‚<br>ï¼ˆ2ï¼‰å› æ­¤16384ä¸ªå“ˆå¸Œæ§½èƒ½ç¡®ä¿ä¸€ä¸ªRedisé›†ç¾¤ä¸Šçš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ†é…åˆ°è¶³å¤Ÿçš„å“ˆå¸Œæ§½ï¼›è€Œä¸”16384ä¸ªå“ˆå¸Œæ§½è¶³å¤Ÿå°ï¼Œå¯ä»¥å°†èŠ‚ç‚¹é…ç½®çš„å“ˆå¸Œæ§½ä½œä¸ºåŸå§‹ä½å›¾è¿›è¡Œä¼ è¾“ã€‚<br>è€Œä¸”ç”±äºåœ¨Redisé›†ç¾¤è§„æ¨¡è¾ƒå°æ—¶ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…çš„å“ˆå¸Œæ§½ä¼šæ¯”è¾ƒå¤šï¼Œä½å›¾å¾ˆéš¾è¢«å‹ç¼©ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>æ€ä¹ˆç”¨â€œç¦æ ¼è¡Œä¸ºæ¨¡å‹â€æˆ˜èƒœæ‹–å»¶ç—‡?</title>
    <url>/2021/09/23/reprint/zen-me-yong-fu-ge-xing-wei-mo-xing-zhan-sheng-tuo-yan-zheng/</url>
    <content><![CDATA[<blockquote>
<p>è¯´æ˜ï¼šæœ¬æ–‡è½¬è½½è‡ª <a href="https://www.ljsw.io/dedao/2021-01-11/AsH.html">æ€ä¹ˆç”¨â€œç¦æ ¼è¡Œä¸ºæ¨¡å‹â€æˆ˜èƒœæ‹–å»¶ç—‡ï¼Ÿ</a></p>
</blockquote>
<p>å»å¹´å¹´åº•ï¼Œæˆ‘ä»¬æœ‰ä¸€æœŸèŠ‚ç›®æ˜¯è®¨è®ºæ–°å¹´è¯¥ç«‹ä¸€ä¸ªä»€ä¹ˆæ ·çš„flagæ‰äººé—´å€¼å¾—ï¼Œå½“æ—¶æˆ‘ç»™ä½ çš„æè®®æ˜¯ï¼šç«‹ä¸€ä¸ªä¸å…‰è‡ªå·±å˜å¥½ï¼Œä¹Ÿè¦è®©åˆ«äººä»ä¸­å—ç›Šçš„flagã€‚</p>
<p>è€å®è¯´ï¼Œè®¾å®šè¿™æ ·ä¸€ä¸ªç›®æ ‡å¹¶ä¸éš¾ï¼Œéš¾çš„æ˜¯å¦‚ä½•å®Œæˆå®ƒã€‚æˆ‘çœ‹åˆ°ä¸€ä¸ªè¯´æ³•å¾ˆæœ‰æ„æ€ï¼Œè¯´å½“ä»£äººç«‹flagçš„ç°çŠ¶æ˜¯â€œä»Šå¹´ç«‹çš„flagï¼Œå°±æ˜¯å®Œæˆå»å¹´æ‰¿è¯ºçš„ã€å‰å¹´æ²¡åšåˆ°çš„ã€å¤§å‰å¹´ç«‹ä¸‹çš„flagâ€ï¼Œä½ è¯´è¯´ï¼Œè¿™è®©äººæƒ…ä½•ä»¥å ªå•Šã€‚äºæ˜¯ï¼Œæœ‰äººå¹²è„†å°±ä¸æ•¢å®šç›®æ ‡äº†ï¼Œæ€•æ‰“è„¸ã€‚</p>
<p>åˆ°åº•æ˜¯ä»€ä¹ˆé˜»ç¢æˆ‘ä»¬å®Œæˆè¿™äº›ç›®æ ‡å‘¢ï¼Ÿé™¤äº†å®¢è§‚åŸå› ä¹‹å¤–ï¼Œæˆ‘æƒ³æœ€å¤§çš„æ‹¦è·¯è™å°±æ˜¯æ‹–å»¶ç—‡äº†ã€‚æˆ‘èº«è¾¹å¾ˆå¤šæœ‹å‹éƒ½é¥±å—æ‹–å»¶ç—‡çš„å›°æ‰°ï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ã€‚æ˜æ˜æ˜¯é‡è¦çš„äº‹ï¼Œä¹Ÿåˆ¶å®šäº†è®¡åˆ’ï¼Œå´æ€»æ˜¯æ— æ³•æŒ‰æ—¶å®Œæˆã€‚æ›´å¯æ€•çš„æ˜¯ï¼Œæ‰“è„¸å¤šäº†ï¼Œè‡ªæˆ‘è¯„ä»·å˜ä½ï¼Œè¿˜å®¹æ˜“æ‰å…¥è´Ÿé¢æƒ…ç»ªçš„æ—‹æ¶¡ã€‚</p>
<p>è¦æ€ä¹ˆæ‰“è´¥æ‹–å»¶ç—‡å‘¢ï¼Ÿæˆ‘æœ€è¿‘åœ¨36æ°ªçš„ç¥è¯‘å±€æ ç›®é‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œå¾ˆå—å¯å‘ã€‚æ–‡ç« æ¥è‡ªä¸€ä¸ªå›½å¤–ä¸“é—¨ç ”ç©¶æ‹–å»¶ç—‡çš„ç½‘ç«™ï¼Œå«Deprocrastinationï¼Œæ ‡é¢˜æ˜¯ã€Šå¦‚ä½•ç”¨ç¦æ ¼è¡Œä¸ºæ¨¡å‹æ²»ç–—æ‹–å»¶ç—‡ã€‹ï¼ˆHow to stop procrastinating by using the Fogg Behavior Modelï¼‰ã€‚è¯»å®Œè¿™ç¯‡æ–‡ç« ä¹‹åï¼Œæˆ‘çªç„¶æ˜ç™½äº†æ‹–å»¶ç—‡çš„â€œåº•å±‚é€»è¾‘â€ï¼Œä¹Ÿå¯¹å¦‚ä½•åº”å¯¹å®ƒæœ‰äº†æ¸…æ™°çš„æ€è·¯ã€‚åœ¨ä»Šå¤©çš„ã€Šé‚µæ’å¤´æ¡ã€‹ä¸­ï¼Œæˆ‘å°±æŠŠæˆ‘ä»è¿™ç¯‡æ–‡ç« ä¸­å¾—åˆ°çš„æ”¶è·åˆ†äº«ç»™ä½ ã€‚</p>
<p>ä½ ä¸€å®šæ³¨æ„åˆ°äº†ï¼Œæ–‡ç« çš„æ ‡é¢˜å«â€œå¦‚ä½•ç”¨ç¦æ ¼è¡Œä¸ºæ¨¡å‹æ²»ç–—æ‹–å»¶ç—‡â€ã€‚é‚£ä»€ä¹ˆæ˜¯ç¦æ ¼è¡Œä¸ºæ¨¡å‹å‘¢ï¼Ÿè¿™ä¸ªè¡Œä¸ºæ¨¡å‹æ˜¯ç¾å›½æ–¯å¦ç¦å¤§å­¦çš„æ•™æˆå¸ƒè±æ©Â·ç¦æ ¼ï¼ˆBrian Foggï¼‰æå‡ºæ¥çš„ï¼Œæ‰€ä»¥æ˜¯ä»¥ä»–çš„åå­—å‘½åçš„ã€‚ç¦æ ¼è¡Œä¸ºæ¨¡å‹çš„ä¸»è¦ç”¨é€”ï¼Œæ˜¯ç”¨æ¥è§£é‡Šäººä»¬ä¸ºä»€ä¹ˆä¼šåšå‡ºæŸç§è¡Œä¸ºï¼Œæ¯”å¦‚â€œä¸ºä»€ä¹ˆä½ ä¼šæ—©èµ·è·‘æ­¥ï¼Ÿâ€å½“ç„¶ï¼Œå®ƒä¹Ÿèƒ½ç”¨æ¥è§£é‡Šäººä»¬ä¸ºä»€ä¹ˆæ²¡æœ‰åšå‡ºæŸç§è¡Œä¸ºï¼Œæ¯”å¦‚â€œä½ æœ¬æ¥è®¡åˆ’æ—©èµ·è·‘æ­¥ï¼Œä»Šå¤©å´æ²¡å»ï¼Œä¸ºä»€ä¹ˆï¼Ÿâ€å¯¹äºè¿™ä¸¤ç±»é—®é¢˜ï¼Œç¦æ ¼è¡Œä¸ºæ¨¡å‹éƒ½èƒ½ç»™å‡ºåˆç†çš„è§£é‡Šã€‚</p>
<p>åœ¨äº’è”ç½‘é¢†åŸŸï¼Œç¦æ ¼è¡Œä¸ºæ¨¡å‹å¸¸è¢«ç”¨æ¥è®¾è®¡å¼•å¯¼ç”¨æˆ·è¡Œä¸ºã€‚ä½ å¯èƒ½å¬è¯´è¿‡å°¼å°”Â·åŸƒäºšå°”çš„é‚£æœ¬è‘—åçš„ã€Šä¸Šç˜¾ï¼šè®©ç”¨æˆ·å…»æˆä½¿ç”¨ä¹ æƒ¯çš„å››å¤§äº§å“é€»è¾‘ã€‹ï¼Œè¿™æœ¬ä¹¦çš„ç†è®ºåŸºç¡€ï¼Œå°±æ˜¯ç¦æ ¼è¡Œä¸ºæ¨¡å‹ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œç¦æ ¼è¡Œä¸ºæ¨¡å‹å¯ä»¥ç”¨ä¸€ä¸ªå…¬å¼æ¥è¡¨ç¤ºï¼šè¡Œä¸º&#x3D;åŠ¨æœº+èƒ½åŠ›+è§¦å‘ï¼ˆBehavior&#x3D;Motivation+Ability+Triggerï¼‰ã€‚ </p>
<p>ä»è¿™ä¸ªå…¬å¼ä¸­ä½ å°±å¯ä»¥çœ‹å‡ºï¼Œäººçš„è¡Œä¸ºèƒŒåæœ‰ä¸‰å¤§è¦ç´ ï¼šä¸€ä¸ªæ˜¯åŠ¨æœºï¼Œä¹Ÿå°±æ˜¯åšè¿™ä»¶äº‹çš„ç†ç”±æˆ–ç›®çš„ï¼›ä¸€ä¸ªæ˜¯èƒ½åŠ›ï¼Œä½ å¾—æœ‰èƒ½åŠ›å®Œæˆè¿™ä¸ªè¡Œä¸ºæ‰è¡Œï¼›è¿˜æœ‰ä¸€ä¸ªæ˜¯è§¦å‘ï¼Œä¹Ÿå°±æ˜¯åœ¨æŸä¸ªæ—¶åˆ»ä¿ƒä½¿äººä»¬é‡‡å–è¡ŒåŠ¨çš„ä¿¡å·ã€‚è¦æƒ³ä½¿äººä»¬å®Œæˆç‰¹å®šçš„è¡Œä¸ºï¼Œâ€œåŠ¨æœºâ€ã€â€œèƒ½åŠ›â€ã€â€œè§¦å‘â€è¿™ä¸‰ä¸ªè¦ç´ ç¼ºä¸€ä¸å¯ã€‚</p>
<p>é‚£ä½ å¯èƒ½æƒ³é—®ï¼Œç¦æ ¼è¡Œä¸ºæ¨¡å‹å’Œæ‹–å»¶ç—‡åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå…¶å®ï¼Œç¦æ ¼è¡Œä¸ºæ¨¡å‹ç»™äº†æˆ‘ä»¬ç†è§£å’Œåˆ†ææ‹–å»¶ç—‡çš„ä¸€ä¸ªæŠ“æ‰‹ã€‚æ¯•ç«Ÿï¼Œæ‹–å»¶ä¹Ÿæ˜¯ä¸€ç§â€œè¡Œä¸ºâ€ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥è¢«æ‹†è§£æˆâ€œåŠ¨æœºâ€ã€â€œèƒ½åŠ›â€å’Œâ€œè§¦å‘â€ä¸‰ä¸ªç¯èŠ‚ã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬æƒ³è±¡æˆä¸‰æ ¹â€œé“¾æ¡â€ï¼Œä»»ä½•ä¸€æ ¹é“¾æ¡æ–­äº†ï¼Œéƒ½ä¼šå¯¼è‡´æ‹–å»¶å‘ç”Ÿã€‚</p>
<p>è¿™ä¹ˆè¯´æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä¸¾ä¸€äº›å…·ä½“çš„ä¾‹å­ã€‚å…ˆæ¥è¯´ç¬¬ä¸€æ ¹æ–­æ‰çš„é“¾æ¡ï¼šåŠ¨æœºã€‚</p>
<p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬æ‹–å»¶çš„äº‹å¹¶ä¸æ˜¯ä»€ä¹ˆå°äº‹ï¼Œå¾€å¾€è¿˜æŒºé‡è¦çš„ã€‚æ¯”å¦‚è¯´ï¼Œä½ è¦å†™æ¯•ä¸šè®ºæ–‡ï¼Œè¿™å…³ä¹åˆ°ä½ èƒ½ä¸èƒ½é¡ºåˆ©æ¯•ä¸šï¼›ä½ æƒ³è¦ç˜¦èº«ï¼Œå› ä¸ºä»¥å‰çš„è¡£æœå·²ç»ç©¿ä¸è¿›å»äº†ï¼›ä½ è®¡åˆ’æ–°çš„ä¸€å¹´åœ¨çŸ¥è¯†åŸé‚¦ä¸Šå¤šåšåˆ†äº«ï¼Œå°†æ¥èƒ½æˆä¸ºâ€œç²‰ä¸â€è¿‡ä¸‡çš„å¤§Vã€‚è¿™äº›éƒ½æ˜¯å¯¹ä½ æ¥è¯´é‡è¦çš„äº‹ï¼Œå¯é—®é¢˜æ˜¯ï¼Œå½“ä½ æŠŠè¿™äº›äº‹æ”¾è¿›å¾…åŠåˆ—è¡¨ä¹‹åï¼Œä½ çš„åŠ¨æœºå°±ä¸å†åƒæœ€å¼€å§‹é‚£ä¹ˆå¼ºçƒˆäº†ã€‚</p>
<p>ä¸ä¿¡ï¼Œä½ å›å¿†ä¸€ä¸‹ï¼Œæœ‰å¤šå°‘æ¬¡ä½ éº»æœ¨åœ°ç›¯ç€å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼Œå´å‘ç°æ‰¾ä¸åˆ°ä¸€ä»¶è®©è‡ªå·±æ„Ÿåˆ°å…´å¥‹ï¼Œæƒ³é©¬ä¸Šå°±åŠ¨æ‰‹å»åšçš„äº‹ï¼Ÿéšç€æ—¶é—´çš„æ¨ç§»ï¼Œä½ çš„åŠ¨æœºä¼šä¸æ–­åœ°è¢«ç¨€é‡Šæ·¡åŒ–ã€‚</p>
<p>é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæœ€ä½³çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯é‡æ–°å¸®è‡ªå·±å»ºç«‹åŠ¨æœºã€‚ä½ å¯ä»¥æ‰¾å‡ºä¸€ä»¶è‡ªå·±ä¸€ç›´åœ¨æ‹–å»¶çš„äº‹ï¼Œæƒ³æƒ³å½“åˆä¸ºä»€ä¹ˆè¦è®¡åˆ’åšè¿™ä»¶äº‹ï¼Œè®©è‡ªå·±å†ä¸€æ¬¡ç›´è§‚åœ°æ„Ÿå—åˆ°è¿™ä»¶äº‹çš„ä»·å€¼å’Œæ„ä¹‰ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå°çªé—¨ï¼šå°½é‡æŠŠè¿™ä»¶äº‹å’Œä¸ªäººæ”¶ç›Šå…³è”èµ·æ¥ã€‚æ¯”å¦‚è¯´ï¼Œåšå®Œå®ƒèƒ½è®©ä½ è·å¾—ä»€ä¹ˆå¥½å¤„ï¼Ÿä½ çš„ä¸ªäººèƒ½åŠ›ä¼šæå‡å—ï¼Ÿæœªæ¥ä¼šå› æ­¤å¾—åˆ°æ›´å¤šçš„æœºä¼šå—ï¼Ÿè¿™ä»¶äº‹æœ‰å¯èƒ½å¸®åŠ©åˆ°æ›´å¤šäººå—ï¼Ÿåˆ«äººçœ‹åˆ°ä½ ç©¿ç€å¥½çœ‹çš„è¡£æœï¼Œä¼šå‘ä½ æŠ•æ¥é’¦ä½©æˆ–ç¾¡æ…•çš„çœ¼å…‰å—ï¼Ÿæƒ³å¾—è¶Šç»†è‡´ï¼Œä½ çš„åŠ¨æœºå°±ä¼šè¶Šæ˜ç¡®ï¼Œä¹Ÿå°±ä¼šæ„Ÿåˆ°è¶Šå…´å¥‹ï¼ŒåŠ¨åŠ›è¶Šè¶³ã€‚</p>
<p>å¥½ï¼Œè¿™å°±æ˜¯ä»åŠ¨æœºä¸Šåº”å¯¹æ‹–å»¶çš„æ–¹æ³•ã€‚å†æ¥è¯´ç¬¬äºŒæ ¹æ–­æ‰çš„é“¾æ¡ï¼šèƒ½åŠ›ã€‚</p>
<p>å¦‚æœä¸€é¡¹ä»»åŠ¡çœ‹èµ·æ¥ç‰¹åˆ«éš¾ï¼Œä½ å°±ä¸æ„¿æ„åšäº†ï¼Œè‡³å°‘ä¸æ„¿æ„é©¬ä¸Šåšã€‚ä½ æœ‰æ²¡æœ‰è¿™ç§ä½“ä¼šï¼Œåšä¸€ä»¶å›°éš¾çš„äº‹æƒ…æ—¶ä¼šç‰¹åˆ«å®¹æ˜“åˆ†å¿ƒã€‚æ‰‹æœºä¸€æœ‰æ–°æ¶ˆæ¯æç¤ºå°±æ¨ä¸å¾—é©¬ä¸Šæ‹¿èµ·æ¥ï¼Œå¹²ä¸€ä¼šå„¿æ´»å°±ä¸è‡ªè§‰åœ°æ‰“å¼€è´­ç‰©ç½‘ç«™åˆ·ä¸€åˆ·ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åŸå› å°±å‡ºåœ¨èƒ½åŠ›ä¸Šã€‚ä»èƒ½åŠ›ä¸Šæ¥è¯´ï¼Œåˆ†å¿ƒæ¯”å·¥ä½œè¦ç®€å•å¤šäº†ã€‚å·¥ä½œä½ è¦è€—è´¹å¾ˆå¤šè„‘ç»†èƒï¼Œä½†å›å¾®ä¿¡ä½ åªéœ€è¦æ‹¿èµ·æ‰‹æœºå°±å¥½äº†ã€‚äººä¼šæœ¬èƒ½åœ°å›é¿å›°éš¾çš„äº‹æƒ…ï¼Œå»åšç®€å•çš„äº‹æƒ…ã€‚</p>
<p>æ›´å¯æ€•çš„æ˜¯ï¼Œç ”ç©¶å‘ç°ï¼Œä½ è¶Šä¸å¸¸åšæŸäº‹ï¼Œå°±ä¼šè¶Šè§‰å¾—å®ƒéš¾ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœæ—¥æ‹±ä¸€å’ï¼Œä½ ä¼šè§‰å¾—æ¯ä¸€æ­¥éƒ½æ¯”è¾ƒè½»æ¾ï¼Œä½†è¦æ˜¯å…¨æ†‹åˆ°æœ€åï¼Œé‚£ä½ å°±ä¼šè§‰å¾—è‡ªå·±å¿…é¡»è¦ä¸‹ä¸€ç›˜å¤§æ£‹ï¼Œæ— ä»ä¸‹æ‰‹äº†ã€‚</p>
<p>é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä½ å¾—å­¦ä¼šæŠŠå·¥ä½œå˜ç®€å•ã€‚æœ€å¥½çš„æ–¹å¼å°±æ˜¯æ‹†åˆ†ä»»åŠ¡ï¼šæŠŠå¤§ä»»åŠ¡æ‹†åˆ†æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼Œè¿™æ ·å°±èƒ½é™ä½æ•´ä½“ä»»åŠ¡çš„éš¾åº¦ã€‚</p>
<p>å¦‚æœä½ é¢å¯¹çš„åªæ˜¯ä¸€ä¸ªå°ä»»åŠ¡ï¼Œé‚£å°±ä¸ä¼šè§‰å¾—é‚£ä¹ˆéš¾äº†ã€‚æ¯”å¦‚çˆ¬å±±ï¼Œçˆ¬åˆ°å±±é¡¶å¾ˆéš¾ï¼Œä½†å…ˆçˆ¬åˆ°50çº§å°é˜¶å¹¶ä¸éš¾ï¼›å†™å®Œä¸€ç¯‡ä¸Šä¸‡å­—çš„è®ºæ–‡å¾ˆéš¾ï¼Œä½†å…ˆå†™å‡ºä¸‰ä¸ªæ®µè½å¹¶ä¸éš¾ï¼›ä¸€ä¸‹å­ç˜¦20æ–¤å¾ˆéš¾ï¼Œä½†ä¸Šä¸€æ¬¡è·‘æ­¥æœºï¼Œè·‘ä¸ªåŠå°æ—¶å¹¶ä¸éš¾ï¼›æˆä¸ºçŸ¥è¯†åŸé‚¦å¤§Vå¾ˆéš¾ï¼Œä½†å‘ä¸€ç¯‡è¯»ä¹¦ç¬”è®°å¹¶ä¸éš¾ã€‚è€Œæ¯å®Œæˆä¸€ä»¶è¿™æ ·çš„å°ä»»åŠ¡ï¼Œéƒ½ä¼šå¸¦ç»™ä½ ä¿¡å¿ƒå’Œèƒ½é‡ï¼Œè®©ä½ æ›´æ„¿æ„æŠŠå‰©ä¸‹çš„ä»»åŠ¡å®Œæˆã€‚</p>
<p>åŒæ—¶ï¼Œä½ è¿˜éœ€è¦åšä¸€ä¸ªæ—¶é—´è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„å°ä»»åŠ¡ä¸²è”èµ·æ¥ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§æ˜¯ï¼šå€’æ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆå†™å¥½æœ€åä¸€å¤©è¦å®Œæˆçš„ä»»åŠ¡ï¼Œç„¶åå¾€å›å€’æ¨ï¼Œä¾æ¬¡å†™ä¸‹æ¯ä¸€ä¸ªæ—¶é—´ç‚¹å®Œæˆçš„å°ä»»åŠ¡ï¼Œä¸€ç›´å†™åˆ°ä»Šå¤©ä¸ºæ­¢ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ è¦åšä¸€æ¬¡å…¬ä¼—æ¼”è®²ï¼Œä¸€å…±æœ‰10å¤©çš„å‡†å¤‡æ—¶é—´ï¼Œé‚£æ—¶é—´è¡¨å°±è¦ä»ç¬¬10å¤©å¼€å§‹åˆ—ï¼Œæ¯”å¦‚ï¼š</p>
<p>ç¬¬10å¤©ï¼šå®Œæ•´æ’ç»ƒä¸‰æ¬¡</p>
<p>ç¬¬9å¤©ï¼šç†Ÿç»ƒèƒŒè¯µæ•´ç¯‡æ¼”è®²ç¨¿</p>
<p>ç¬¬8å¤©ï¼šåšå®ŒPPTï¼Œå’Œæ–‡ç¨¿å¯¹ç…§ï¼Œç¡®å®šç¿»é¡µçš„æ—¶é—´ç‚¹</p>
<p>â€¦â€¦</p>
<p>ç¬¬3å¤©ï¼šå…ˆå†™å‡ºå¼€å¤´</p>
<p>ç¬¬2å¤©ï¼šæ”¶é›†å’Œæ•´ç†æ‰€æœ‰å¯ç”¨ç´ æ</p>
<p>ç¬¬1å¤©ï¼šç†æ¸…æ¼”è®²ç›®çš„ï¼Œæ„æ€ç»“æ„æ¡†æ¶</p>
<p>ç”¨â€œå€’æ¨â€çš„æ–¹å¼è®¾è®¡æ—¶é—´è¡¨ï¼Œä½ ä¼šæ›´åˆç†åœ°å®‰æ’å°ä»»åŠ¡ï¼Œä¸ä¼šå‡ºç°åˆ°æœ€åå‡ å¤©ä»»åŠ¡é‡ç§¯å‹çš„æƒ…å†µã€‚</p>
<p>è¿™æ˜¯ä»èƒ½åŠ›ä¸Šåº”å¯¹æ‹–å»¶çš„åŠæ³•ã€‚å†æ¥è¯´ç¬¬ä¸‰æ ¹æ–­æ‰çš„é“¾æ¡ï¼šè§¦å‘ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰å……åˆ†çš„åŠ¨æœºï¼Œä¹ŸæŠŠä»»åŠ¡æ‹†å¥½äº†ï¼Œå¯è¿˜æœ‰ä¼šæ‹–å»¶ï¼Œé‚£åŸå› å°±å¯èƒ½å‡ºåœ¨â€œè§¦å‘ä¸å¤Ÿâ€ä¸Šã€‚</p>
<p>è§¦å‘ï¼Œæ˜¯æé†’æˆ‘ä»¬å½“ä¸‹é©¬ä¸Šè¡ŒåŠ¨çš„ä¿¡å·ã€‚æ¯”å¦‚è¯´ï¼Œä½ è¿™å‡ å¤©è¦äº¤ä¸€ä»½æŠ¥å‘Šï¼Œç»“æœçªç„¶æ¥åˆ°è€æ¿ä¸€æ¡ä¿¡æ¯è¯´â€œæŠ¥å‘Šå†™å®Œäº†å—ï¼Ÿå†™å®Œèµ¶ç´§å‘ç»™æˆ‘ï¼Œæˆ‘ç­‰ç€ç”¨â€ã€‚æœ¬æ¥ä½ è¿˜æƒ³æ‹–ä¸€æ‹–ï¼Œç»“æœä¸€æ¥åˆ°è€æ¿çš„è¿™æ¡ä¿¡æ¯ï¼Œå±è‚¡ä¸€ä¸‹å°±ä»æ²™å‘ä¸Šå¼¹èµ·æ¥äº†ã€‚ä½ çœ‹ï¼Œè¿™æ¡ä¿¡æ¯å°±æ˜¯ä¸€ä¸ªè§¦å‘ï¼Œå®ƒä¼šè®©ä½ ç«‹å³è¡ŒåŠ¨èµ·æ¥ã€‚å¯æ˜¯ï¼Œè§¦å‘ä¹Ÿä¸èƒ½å…‰é è€æ¿å•Šï¼Œè¦æˆ˜èƒœæ‹–å»¶çš„æ¯›ç—…ï¼Œä½ è¦å­¦ä¼šä¸»åŠ¨è®¾ç½®è§¦å‘ä¿¡å·ã€‚</p>
<p>ä»€ä¹ˆæ ·çš„è§¦å‘æœ€æœ‰æ•ˆå‘¢ï¼Ÿæ–‡ç« é‡Œç»™äº†ä¸€ä¸ªå¦™æ‹›ï¼šè®¾ç½®è¿é”è§¦å‘ã€‚</p>
<p>ç¬¬ä¸€ä¸ªè§¦å‘ï¼Œæ˜¯ç”¨æ‰‹æœºè®¾ç½®ä¸€ä¸ªå®šæ—¶æé†’ï¼Œè®©è‡ªå·±åœ¨è®¾å®šå¥½çš„æ—¶åˆ»åœ¨åŠå…¬æ¡Œå‰åä¸‹æ¥ã€‚ä½ å¯èƒ½å¹¶æ²¡æƒ³å¥½åšä»€ä¹ˆï¼Œæ²¡å…³ç³»ï¼Œå…ˆåä¸‹æ¥ã€‚</p>
<p>ç¬¬äºŒä¸ªè§¦å‘ï¼Œå°±æ˜¯å€’è®¡æ—¶5åˆ†é’Ÿï¼Œåœ¨5åˆ†é’Ÿä¹‹å†…ç›¯ç€å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼ŒæŒ‘å‡ºä¸€é¡¹ä»»åŠ¡æ¥åšã€‚å¦‚æœ5åˆ†é’Ÿè®¡æ—¶ç»“æŸï¼Œä½ ä»ç„¶æ²¡å†³å®šåšå“ªé¡¹ä»»åŠ¡çš„è¯ï¼Œé‚£å°±éšæœºé€‰æ‹©ä¸€é¡¹ä»»åŠ¡ï¼Œç«‹å³å»åšã€‚</p>
<p>é€šè¿‡è¿é”è§¦å‘ï¼Œä½ èƒ½å¿«é€Ÿè®©è‡ªå·±æŠ•å…¥åˆ°å·¥ä½œçŠ¶æ€ä¸­ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§è§¦å‘ï¼Œæ˜¯å¢åŠ ä½ â€œçœ‹è§â€ä»»åŠ¡çš„æ¦‚ç‡ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ä½ è¦åˆ¶å®šæ˜¥èŠ‚å‡æœŸçš„æ—…è¡Œè®¡åˆ’ï¼Œé‚£å¾—æå‰è®¢æœºç¥¨å•Šï¼Œæ˜¯å§ã€‚ä¸ºäº†è®©è‡ªå·±ä¸æ‹–å»¶ï¼Œä½ å¯ä»¥ä¸‹è½½ä¸€å¼ é£æœºå›¾ç‰‡ï¼Œè®¾æˆæ‰‹æœºå£çº¸ã€‚è¿™æ ·æ¯æ¬¡ä½ æ‹¿èµ·æ‰‹æœºï¼Œå°±ä¼šçœ‹åˆ°é£æœºçš„å›¾ç‰‡ï¼Œç„¶åå°±ä¼šæƒ³èµ·è¦èµ¶ç´§è®¢æœºç¥¨â€”â€”è¿™å°±æ˜¯ä¸€ç§å¢åŠ çœ‹è§æ¦‚ç‡çš„è§¦å‘ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥åè¿‡æ¥ï¼Œç”¨å‡å°‘è§¦å‘çš„æ–¹å¼æ¥æå‡ä¸“æ³¨åŠ›ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨å·¥ä½œçš„æ—¶å€™ï¼ŒæŠŠæ‰‹æœºæ”¾åœ¨åˆ«çš„æˆ¿é—´æˆ–è€…æ‰“å¼€å‹¿æ‰°æ¨¡å¼ï¼›å…³é—­å¾®ä¿¡ç”µè„‘ç«¯çš„æ–°æ¶ˆæ¯é€šçŸ¥ï¼›æŠŠå·¥ä½œç”¨çš„è½¯ä»¶å…¨å±ï¼Œè¿™æ ·å°±çœ‹ä¸åˆ°å…¶ä»–è½¯ä»¶çš„å›¾æ ‡â€¦â€¦ä½ çœ‹ï¼Œè¿™äº›åšæ³•éƒ½æ˜¯å‡å°‘æˆ–æ¶ˆé™¤å¯¼è‡´åˆ†å¿ƒçš„è§¦å‘ã€‚ä½ è¶Šéš¾åˆ†å¿ƒï¼Œä¹Ÿå°±è¶Šä¸ä¼šåˆ†å¿ƒã€‚</p>
<p>å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œåœ¨ä»Šå¤©çš„ã€Šé‚µæ’å¤´æ¡ã€‹ä¸­ï¼Œæˆ‘è·Ÿä½ åˆ†äº«äº†å¦‚ä½•ç”¨ç¦æ ¼è¡Œä¸ºæ¨¡å‹æ¥åˆ†æå’Œæ²»ç–—æ‹–å»¶ç—‡ã€‚æŒ‰ç…§è¿™ä¸ªæ¨¡å‹ï¼Œæ‹–å»¶ç—‡å¯ä»¥è¢«æ‹†åˆ†ä¸ºä¸‰ä¸ªå› ç´ ï¼šåŠ¨æœºä¸è¶³ã€èƒ½åŠ›æ¬ ç¼ºä»¥åŠè§¦å‘ä¸å¤Ÿã€‚å¾ˆå¤šäººä¼šè®¤ä¸ºæ‹–å»¶ç—‡å°±æ˜¯è‡ªå¾‹æ€§ä¸å¼ºå¯¼è‡´çš„ï¼Œæ‰€ä»¥æ¯æ¬¡æ‹–å»¶éƒ½å¾ˆè‡ªè´£ã€‚è€Œè¿™ç¯‡æ–‡ç« çš„å¯å‘åœ¨äºï¼Œæ‹–å»¶ç—‡æ˜¯ä¸ªç³»ç»Ÿé—®é¢˜ï¼Œå®ƒå’Œäººå›ºæœ‰çš„è¡Œä¸ºæ¨¡å¼æœ‰ç€å¯†åˆ‡çš„å…³ç³»ï¼Œä½ æ²¡å¿…è¦è‹›è´£è‡ªå·±ã€‚ä½ éœ€è¦åšçš„ï¼Œæ˜¯èªæ˜åœ°è°ƒæ•´åšäº‹çš„æ–¹æ³•ã€‚</p>
<p>ä»Šåå½“ä½ æ‹–å»¶çš„æ—¶å€™ï¼Œä¸å¦¨æƒ³ä¸€æƒ³ï¼Œåˆ°åº•æ˜¯åŠ¨æœºã€èƒ½åŠ›å’Œè§¦å‘å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ï¼Ÿç„¶åå¯¹ç—‡ä¸‹è¯ï¼Œåˆ¶å®šåº”å¯¹ç­–ç•¥ã€‚æ¬¢è¿ä½ æŠŠä½ çš„æ€è€ƒåˆ†äº«åœ¨ç•™è¨€åŒºã€‚</p>
<p>å¥½äº†ï¼Œè¿™å°±æ˜¯ä»Šå¤©çš„ã€Šé‚µæ’å¤´æ¡ã€‹ã€‚æˆ‘æ˜¯é‚µæ’ï¼Œæˆ‘ä»¬æ˜å¤©è§ã€‚</p>
]]></content>
      <categories>
        <category>è½¬è½½</category>
      </categories>
      <tags>
        <tag>ç¦æ ¼è¡Œä¸ºæ¨¡å‹</tag>
        <tag>æ‹–å»¶ç—‡</tag>
      </tags>
  </entry>
  <entry>
    <title>EnvironmentChangeEventçš„Listeneræ‰§è¡Œé¡ºåº</title>
    <url>/2022/04/06/springcloud/environmentchangeevent-de-listener-zhi-xing-shun-xu/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><p>é¡¹ç›®ä¸­ä½¿ç”¨Nacosä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œå®ç°é…ç½®åŠ¨æ€æ›´æ–°ï¼Œåœ¨é…ç½®ç±»ä¸­ç›‘å¬<code>EnvironmentChangeEvent</code>äº‹ä»¶å¯¹æ›´æ–°åçš„é…ç½®åšä¸€äº›åˆå§‹åŒ–å¤„ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<h2 id="CallbackConfig"><a href="#CallbackConfig" class="headerlink" title="CallbackConfig"></a>CallbackConfig</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"transparent-delivery.callback"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallbackConfig</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnvironmentChangeEvent</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">"CONFIG_LOG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChatbotConfig</span><span class="token punctuation">></span></span> configs<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">ChatbotConfig</span><span class="token punctuation">></span></span> <span class="token constant">CHATBOT_MAP</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ChatbotConfig</span> <span class="token function">fetchByUserId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant">CHATBOT_MAP</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Config chatbot callback information:&#123;&#125;!"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initConfigs</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">EnvironmentChangeEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Nacos refresh config information the current information is:&#123;&#125;!"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initConfigs</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä½†æ˜¯æ¯æ¬¡åœ¨Nacosæ›´æ–°é…ç½®åï¼Œæ—¥å¿—æ‰“å°çš„å€¼ä»æ˜¯ä¿®æ”¹ä¹‹å‰çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªç°è±¡ï¼Ÿ</p>
<h1 id="äºŒã€EnvironmentChangeEventçš„Listeneræ‰§è¡Œé¡ºåº"><a href="#äºŒã€EnvironmentChangeEventçš„Listeneræ‰§è¡Œé¡ºåº" class="headerlink" title="äºŒã€EnvironmentChangeEventçš„Listeneræ‰§è¡Œé¡ºåº"></a>äºŒã€EnvironmentChangeEventçš„Listeneræ‰§è¡Œé¡ºåº</h1><p>åœ¨Nacosä¸Šæ›´æ–°é…ç½®åï¼ŒSpringä¼šå‘å¸ƒä¸€ä¸ª<code>RefreshEvent</code>äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶æœ€åä¼šè¢«å§”æ‰˜ç»™<code>ContextRefresh</code>å»å¤„ç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»“åˆæºç ï¼Œçœ‹ä¸€ä¸‹å¤„ç†æµç¨‹ã€‚</p>
<h2 id="RefreshEventListener"><a href="#RefreshEventListener" class="headerlink" title="RefreshEventListener"></a>RefreshEventListener</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>endpoint<span class="token punctuation">.</span>event</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RefreshEventListener</span> <span class="token keyword">implements</span> <span class="token class-name">SmartApplicationListener</span> <span class="token punctuation">&#123;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">ApplicationReadyEvent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ApplicationReadyEvent</span><span class="token punctuation">)</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">RefreshEvent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RefreshEvent</span><span class="token punctuation">)</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ApplicationReadyEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">RefreshEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ready<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// don't handle events before app is ready</span>
			<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refresh<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>å½“SpringCloudæ¥æ”¶åˆ°ä¸€ä¸ª<code>RefreshEvent</code>äº‹ä»¶åä¼šå§”æ‰˜ç»™<code>ContextRefresher</code>çš„<code>refresh()</code>æ–¹æ³•å»å¤„ç†ã€‚</p>
</blockquote>
<h2 id="ContextRefresher"><a href="#ContextRefresher" class="headerlink" title="ContextRefresher"></a>ContextRefresher</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>refresh</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Dave Syer
 * @author Venil Noronha
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContextRefresher</span> <span class="token punctuation">&#123;</span>

	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> <span class="token function">refreshEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">refreshAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> keys<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">refreshEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> before <span class="token operator">=</span> <span class="token function">extract</span><span class="token punctuation">(</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">addConfigFilesToEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> <span class="token function">changes</span><span class="token punctuation">(</span>before<span class="token punctuation">,</span>
				<span class="token function">extract</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EnvironmentChangeEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span> keys<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> keys<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>ContextRefresher</code>çš„<code>Refresh()</code>æ–¹æ³•å…ˆå°†é…ç½®æ–‡ä»¶æ·»åŠ åˆ°<code>Environment</code>ä¸­ï¼Œç„¶åå‘å¸ƒ<code>EnvironmentChangeEvent</code>äº‹ä»¶ã€‚</p>
</blockquote>
<h2 id="AbstractApplicationContext"><a href="#AbstractApplicationContext" class="headerlink" title="AbstractApplicationContext"></a>AbstractApplicationContext</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">   <span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">publishEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
   
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> event<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// æ­¤å¤„ç•¥å»éƒ¨åˆ†ä»£ç ......</span>

	<span class="token comment">// Multicast right now if possible - or lazily once the multicaster is initialized</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>earlyApplicationEvents <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>earlyApplicationEvents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>applicationEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
           <span class="token comment">// æ ¸å¿ƒå¤„ç†é€»è¾‘</span>
		<span class="token function">getApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multicastEvent</span><span class="token punctuation">(</span>applicationEvent<span class="token punctuation">,</span> eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// Publish event via parent context as well...</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token keyword">instanceof</span> <span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbstractApplicationContext</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>getApplicationEventMulticaster().multicastEvent(applicationEvent, eventType);</code>é€šè¿‡äº‹ä»¶å¹¿æ’­å™¨å°†äº‹ä»¶å¹¿æ’­å‡ºå»ã€‚</p>
</blockquote>
<h2 id="SimpleApplicationEventMulticaster"><a href="#SimpleApplicationEventMulticaster" class="headerlink" title="SimpleApplicationEventMulticaster"></a>SimpleApplicationEventMulticaster</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>event</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleApplicationEventMulticaster</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractApplicationEventMulticaster</span> <span class="token punctuation">&#123;</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">multicastEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token function">resolveDefaultEventType</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">multicastEvent</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">ResolvableType</span> type <span class="token operator">=</span> <span class="token punctuation">(</span>eventType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> eventType <span class="token operator">:</span> <span class="token function">resolveDefaultEventType</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Executor</span> executor <span class="token operator">=</span> <span class="token function">getTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> listener <span class="token operator">:</span> <span class="token function">getApplicationListeners</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">invokeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
			<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
				<span class="token function">invokeListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>multicastEvent</code>æ–¹æ³•ä¸­è·å–å½“å‰äº‹ä»¶çš„æ‰€æœ‰Listeneråï¼Œå¾ªç¯è°ƒç”¨Listenerçš„<code>onApplicationEvent</code>æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="AbstractApplicationEventMulticaster"><a href="#AbstractApplicationEventMulticaster" class="headerlink" title="AbstractApplicationEventMulticaster"></a>AbstractApplicationEventMulticaster</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">getApplicationListeners</span><span class="token punctuation">(</span>
		<span class="token class-name">ApplicationEvent</span> event<span class="token punctuation">,</span> <span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token comment">// æ­¤å¤„ç•¥å»éƒ¨åˆ†ä»£ç ......</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span>
			<span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isCacheSafe</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
					<span class="token punctuation">(</span>sourceType <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isCacheSafe</span><span class="token punctuation">(</span>sourceType<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// Fully synchronized building and caching of a ListenerRetriever</span>
		<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>retrievalMutex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			retriever <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>retrieverCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>retriever <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">return</span> retriever<span class="token punctuation">.</span><span class="token function">getApplicationListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
			retriever <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListenerRetriever</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> listeners <span class="token operator">=</span>
					<span class="token function">retrieveApplicationListeners</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> sourceType<span class="token punctuation">,</span> retriever<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>retrieverCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> retriever<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> listeners<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// No ListenerRetriever caching -> no synchronization necessary</span>
		<span class="token keyword">return</span> <span class="token function">retrieveApplicationListeners</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> sourceType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">retrieveApplicationListeners</span><span class="token punctuation">(</span>
		<span class="token class-name">ResolvableType</span> eventType<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> sourceType<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ListenerRetriever</span> retriever<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> allListeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ApplicationListener</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> listeners<span class="token punctuation">;</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> listenerBeans<span class="token punctuation">;</span>
	<span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>retrievalMutex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		listeners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultRetriever<span class="token punctuation">.</span>applicationListeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
		listenerBeans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultRetriever<span class="token punctuation">.</span>applicationListenerBeans<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// Add programmatically registered listeners, including ones coming</span>
	<span class="token comment">// from ApplicationListenerDetector (singleton beans and inner beans).</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> listener <span class="token operator">:</span> listeners<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">supportsEvent</span><span class="token punctuation">(</span>listener<span class="token punctuation">,</span> eventType<span class="token punctuation">,</span> sourceType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>retriever <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				retriever<span class="token punctuation">.</span>applicationListeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
			allListeners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>allListeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>retriever <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> retriever<span class="token punctuation">.</span>applicationListenerBeans<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		retriever<span class="token punctuation">.</span>applicationListeners<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		retriever<span class="token punctuation">.</span>applicationListeners<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>allListeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> allListeners<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ä¸Šè¿°ä»£ç ä¸­æ ¹æ®äº‹ä»¶ç±»å‹è·å–æ‰€æœ‰Listenerï¼Œç„¶åæ ¹æ®<code>AnnotationAwareOrderComparator.sort(allListeners)</code>å¯¹Listenerè¿›è¡Œæ’åºã€‚</p>
</blockquote>
<h1 id="ä¸‰ã€AnnotationAwareOrderComparatoræ’åºåŸç†"><a href="#ä¸‰ã€AnnotationAwareOrderComparatoræ’åºåŸç†" class="headerlink" title="ä¸‰ã€AnnotationAwareOrderComparatoræ’åºåŸç†"></a>ä¸‰ã€AnnotationAwareOrderComparatoræ’åºåŸç†</h1><h2 id="AnnotationAwareOrderComparator"><a href="#AnnotationAwareOrderComparator" class="headerlink" title="AnnotationAwareOrderComparator"></a>AnnotationAwareOrderComparator</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnnotationAwareOrderComparator</span> <span class="token keyword">extends</span> <span class="token class-name">OrderComparator</span> <span class="token punctuation">&#123;</span>

	<span class="token comment">/**
	 * This implementation checks for &#123;@link Order @Order&#125; or
	 * &#123;@link javax.annotation.Priority @Priority&#125; on various kinds of
	 * elements, in addition to the &#123;@link org.springframework.core.Ordered&#125;
	 * check in the superclass.
	 */</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">protected</span> <span class="token class-name">Integer</span> <span class="token function">findOrder</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Integer</span> order <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">findOrder</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> order<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> <span class="token function">findOrderFromAnnotation</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> <span class="token function">findOrderFromAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">AnnotatedElement</span> element <span class="token operator">=</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">AnnotatedElement</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">AnnotatedElement</span><span class="token punctuation">)</span> obj <span class="token operator">:</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">MergedAnnotations</span> annotations <span class="token operator">=</span> <span class="token class-name">MergedAnnotations</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token class-name">SearchStrategy</span><span class="token punctuation">.</span><span class="token constant">TYPE_HIERARCHY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Integer</span> order <span class="token operator">=</span> <span class="token class-name">OrderUtils</span><span class="token punctuation">.</span><span class="token function">getOrderFromAnnotations</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> annotations<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj <span class="token keyword">instanceof</span> <span class="token class-name">DecoratingProxy</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token function">findOrderFromAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">DecoratingProxy</span><span class="token punctuation">)</span> obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecoratedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> order<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="OrderComparator"><a href="#OrderComparator" class="headerlink" title="OrderComparator"></a>OrderComparator</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderComparator</span> <span class="token keyword">implements</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> o1<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> o2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token function">doCompare</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">doCompare</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> o1<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> o2<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">OrderSourceProvider</span> sourceProvider<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">boolean</span> p1 <span class="token operator">=</span> <span class="token punctuation">(</span>o1 <span class="token keyword">instanceof</span> <span class="token class-name">PriorityOrdered</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> p2 <span class="token operator">=</span> <span class="token punctuation">(</span>o2 <span class="token keyword">instanceof</span> <span class="token class-name">PriorityOrdered</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>p1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>p2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p2 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>p1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>

		<span class="token keyword">int</span> i1 <span class="token operator">=</span> <span class="token function">getOrder</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> sourceProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> i2 <span class="token operator">=</span> <span class="token function">getOrder</span><span class="token punctuation">(</span>o2<span class="token punctuation">,</span> sourceProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>i1<span class="token punctuation">,</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">OrderSourceProvider</span> sourceProvider<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">Integer</span> order <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token comment">// æ­¤å¤„ç•¥å»éƒ¨åˆ†ä»£ç </span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>order <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> order <span class="token operator">:</span> <span class="token function">getOrder</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">Integer</span> order <span class="token operator">=</span> <span class="token function">findOrder</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">return</span> order<span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">LOWEST_PRECEDENCE</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><code>AnnotationAwareOrderComparator</code> ç»§æ‰¿ <code>OrderComparator</code>ï¼Œè·å–å¯¹è±¡çš„Orderå€¼å¹¶è¿›è¡Œæ’åºï¼Œå¦‚æœOrderä¸ºç©ºï¼Œåˆ™ä¼šè¢«è®¾ç½®ä¸ºæœ€å°ä¼˜å…ˆçº§ã€‚</p>
</blockquote>
<h2 id="OrderUtilsè·å–å¯¹è±¡Orderå€¼"><a href="#OrderUtilsè·å–å¯¹è±¡Orderå€¼" class="headerlink" title="OrderUtilsè·å–å¯¹è±¡Orderå€¼"></a>OrderUtilsè·å–å¯¹è±¡Orderå€¼</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">OrderUtils</span> <span class="token punctuation">&#123;</span>

	<span class="token comment">/**
	 * Return the order from the specified annotations collection.
	 * &lt;p>Takes care of &#123;@link Order @Order&#125; and
	 * &#123;@code @javax.annotation.Priority&#125;.
	 * @param element the source element
	 * @param annotations the annotation to consider
	 * @return the order value, or &#123;@code null&#125; if none can be found
	 */</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">getOrderFromAnnotations</span><span class="token punctuation">(</span><span class="token class-name">AnnotatedElement</span> element<span class="token punctuation">,</span> <span class="token class-name">MergedAnnotations</span> annotations<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>element <span class="token keyword">instanceof</span> <span class="token class-name">Class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token function">findOrder</span><span class="token punctuation">(</span>annotations<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token class-name">Object</span> cached <span class="token operator">=</span> orderCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token punctuation">(</span>cached <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> cached <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token class-name">Integer</span> result <span class="token operator">=</span> <span class="token function">findOrder</span><span class="token punctuation">(</span>annotations<span class="token punctuation">)</span><span class="token punctuation">;</span>
		orderCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> result <span class="token operator">:</span> <span class="token constant">NOT_ANNOTATED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token annotation punctuation">@Nullable</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">findOrder</span><span class="token punctuation">(</span><span class="token class-name">MergedAnnotations</span> annotations<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">MergedAnnotation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">></span></span> orderAnnotation <span class="token operator">=</span> annotations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>orderAnnotation<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> orderAnnotation<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token class-name">MergedAnnotation</span><span class="token punctuation">.</span><span class="token constant">VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token class-name">MergedAnnotation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> priorityAnnotation <span class="token operator">=</span> annotations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">JAVAX_PRIORITY_ANNOTATION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>priorityAnnotation<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> priorityAnnotation<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token class-name">MergedAnnotation</span><span class="token punctuation">.</span><span class="token constant">VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ä»ä¸Šé¢æºç å¯ä»¥çœ‹å‡º,å¦‚æœæ²¡æœ‰è®¾ç½®<code>@Order</code>æˆ–æ˜¯<code>javax.annotation.Priority</code>, Orderå€¼è¿”å›ä¸º<code>null</code>ã€‚</p>
</blockquote>
<h1 id="å››ã€EnvironmentChangeEventçš„Listeneræœ‰å“ªäº›"><a href="#å››ã€EnvironmentChangeEventçš„Listeneræœ‰å“ªäº›" class="headerlink" title="å››ã€EnvironmentChangeEventçš„Listeneræœ‰å“ªäº›"></a>å››ã€EnvironmentChangeEventçš„Listeneræœ‰å“ªäº›</h1><p>EnvironmentChangeEventçš„Listenerï¼š</p>
<ul>
<li>é»˜è®¤çš„EnvironmentChangeEventçš„Listener <code>ConfigurationPropertiesRebinder</code></li>
<li>è‡ªå®šä¹‰çš„EnvironmentChangeEventçš„Listener <code>CallbackConfig</code></li>
</ul>
<p>å…¶å®ƒEnvironmentChangeEventçš„Listeneræš‚ä¸åšåˆ†æå¤„ç†ã€‚</p>
<h2 id="ConfigurationPropertiesRebinder"><a href="#ConfigurationPropertiesRebinder" class="headerlink" title="ConfigurationPropertiesRebinder"></a>ConfigurationPropertiesRebinder</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ManagedResource</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigurationPropertiesRebinder</span>
		<span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnvironmentChangeEvent</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    
    <span class="token annotation punctuation">@ManagedOperation</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rebind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beans<span class="token punctuation">.</span><span class="token function">getBeanNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token function">rebind</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token annotation punctuation">@ManagedOperation</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">rebind</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>beans<span class="token punctuation">.</span><span class="token function">getBeanNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
				<span class="token class-name">Object</span> bean <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AopUtils</span><span class="token punctuation">.</span><span class="token function">isAopProxy</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					bean <span class="token operator">=</span> <span class="token class-name">ProxyUtils</span><span class="token punctuation">.</span><span class="token function">getTargetObject</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					<span class="token comment">// æ­¤å¤„çœç•¥éƒ¨åˆ†ä»£ç ......</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">.</span><span class="token function">getAutowireCapableBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
							<span class="token punctuation">.</span><span class="token function">destroyBean</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>applicationContext<span class="token punctuation">.</span><span class="token function">getAutowireCapableBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
							<span class="token punctuation">.</span><span class="token function">initializeBean</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
			<span class="token comment">// æ­¤å¤„çœç•¥å¼‚å¸¸å¤„ç†ä»£ç ......</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>            <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>åœ¨ä¸Šè¿°Listenerä¸­å¯¹<code>@ConfigurationProperties</code>æ ‡æ³¨çš„ç±»è¿›è¡Œé”€æ¯å’Œé‡æ–°åˆ›å»ºï¼Œå®ç°äº†é…ç½®æ›´æ–°ã€‚</p>
</blockquote>
<h2 id="CallbackConfig-1"><a href="#CallbackConfig-1" class="headerlink" title="CallbackConfig"></a>CallbackConfig</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"config.callback"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallbackConfig</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EnvironmentChangeEvent</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">"CONFIG_LOG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChatbotConfig</span><span class="token punctuation">></span></span> configs<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">ChatbotConfig</span><span class="token punctuation">></span></span> <span class="token constant">CHATBOT_MAP</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ChatbotConfig</span> <span class="token function">fetchByUserId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token constant">CHATBOT_MAP</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Config chatbot callback information:&#123;&#125;!"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initConfigs</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">EnvironmentChangeEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Nacos refresh config information the current information is:&#123;&#125;!"</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initConfigs</span><span class="token punctuation">(</span>configs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="äº”ã€åŸå› åˆ†æ"><a href="#äº”ã€åŸå› åˆ†æ" class="headerlink" title="äº”ã€åŸå› åˆ†æ"></a>äº”ã€åŸå› åˆ†æ</h1><p>EnvironmentChangeEventçš„Listenerä¸­æœ‰ä¸ªé»˜è®¤çš„ <code>ConfigurationPropertiesRebinder</code>ï¼Œè¿™ä¸ªListenerå®ç°äº†é…ç½®çš„åŠ¨æ€æ›´æ–°ï¼Œä½†æ˜¯è¿™ä¸ªListeneræœªä½¿ç”¨<code>@Order</code> æ³¨è§£ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§æ˜¯æœ€å°çš„ã€‚<br>æˆ‘ä»¬è‡ªå®šä¹‰çš„EnvironmentChangeEventçš„Listener <code>CallbackConfig</code> ä¸­è™½ç„¶è®¾ç½®äº† <code>@Order</code> æ³¨è§£å¹¶ä¸”é»˜è®¤å€¼ä¸ºæœ€å°ä¼˜å…ˆçº§ï¼Œä½†æ˜¯å’Œ <code>ConfigurationPropertiesRebinder</code> çš„ä¼˜å…ˆçº§æ˜¯ç›¸åŒçš„ï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºå–å†³äºåŠ å…¥é›†åˆçš„é¡ºåºï¼Œæ‰€ä»¥æ‰§è¡Œé¡ºåºä¸å¯æ§ã€‚æ— æ³•é€šè¿‡è®¾ç½® <code>@Order</code> å°†è‡ªå®šçš„Listeneræ”¾åœ¨ <code>ConfigurationPropertiesRebinder</code> ä¹‹åæ‰§è¡Œã€‚</p>
<h1 id="å…­ã€è§£å†³æ–¹æ¡ˆ"><a href="#å…­ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…­ã€è§£å†³æ–¹æ¡ˆ"></a>å…­ã€è§£å†³æ–¹æ¡ˆ</h1><p>å¦‚æœæ˜¯å•ç‹¬ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£ï¼Œåˆ™å¯ä»¥å°†é…ç½®çš„åˆå§‹åŒ–éªŒè¯æ”¾åœ¨ <code>@PostConstruct</code> ä¸­å¤„ç†ã€‚</p>
<blockquote>
<p>There is one exception. Any @ConfigurationProperties bean that is also in @RefreshScope is not rebound when the event is consumed. They could be rebound, but in the light of what happens in @RefreshScope, it would be redundant. Instead, they follow the usual path of @RefreshScope beans.</p>
</blockquote>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://gist.github.com/dsyer/a43fe5f74427b371519af68c5c4904c7">Dynamic Configuration Properties in Spring Boot and Spring Cloud</a></p>
]]></content>
      <categories>
        <category>spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
        <tag>EnvironmentChangeEvent</tag>
        <tag>ApplicationListener</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQä¸­ConsumeFromWhereè¯¦è§£</title>
    <url>/2021/09/06/rockermq/rocketmq-zhong-consumefromwhere-xiang-jie/</url>
    <content><![CDATA[<h1 id="ä¸€ã€ConsumeFromWhere"><a href="#ä¸€ã€ConsumeFromWhere" class="headerlink" title="ä¸€ã€ConsumeFromWhere"></a>ä¸€ã€ConsumeFromWhere</h1><p>RocketMQçš„Consumeræœ‰ä¸€ä¸ª<code>consumeFromWhere</code>å±æ€§ï¼Œè¡¨ç¤ºConsumerå¯åŠ¨åå°†ä»å“ªä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¯¥å±æ€§å–å€¼æœ‰ä»¥ä¸‹æƒ…å†µï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Consuming point on consumer booting. There are three consuming points:
 * CONSUME_FROM_LAST_OFFSET: consumer clients pick up where it stopped previously. If it were a newly booting up consumer client, according aging of the consumer group, there are two cases:
 * if the consumer group is created so recently that the earliest message being subscribed has yet expired, which means the consumer group represents a lately launched business, consuming will start from the very beginning;
 * if the earliest message being subscribed has expired, consuming will start from the latest messages, meaning messages born prior to the booting timestamp would be ignored.
 * CONSUME_FROM_FIRST_OFFSET: Consumer client will start from earliest messages available.
 * CONSUME_FROM_TIMESTAMP: Consumer client will start from specified timestamp, which means messages born prior to consumeTimestamp will be ignored
 */</span>
<span class="token keyword">private</span> <span class="token class-name">ConsumeFromWhere</span> consumeFromWhere <span class="token operator">=</span> <span class="token class-name">ConsumeFromWhere</span><span class="token punctuation">.</span><span class="token constant">CONSUME_FROM_LAST_OFFSET</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="äºŒã€æºç åˆ†æ"><a href="#äºŒã€æºç åˆ†æ" class="headerlink" title="äºŒã€æºç åˆ†æ"></a>äºŒã€æºç åˆ†æ</h1><p>consumeFromWhereåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå‘ç°è®¾ç½®CONSUME_FROM_LAST_OFFSETåï¼Œæœ‰äº›æƒ…å†µä»ç„¶ä»å¤´å¼€å§‹æ¶ˆè´¹ï¼Œæ¥ä¸‹æ¥ç»“åˆæºç åˆ†æä¸€ä¸‹consumeFromWhereå¤„ç†é€»è¾‘ã€‚</p>
<h2 id="2-1-RocketMQå®¢æˆ·ç«¯consumeFromWhereå¤„ç†é€»è¾‘"><a href="#2-1-RocketMQå®¢æˆ·ç«¯consumeFromWhereå¤„ç†é€»è¾‘" class="headerlink" title="2.1 RocketMQå®¢æˆ·ç«¯consumeFromWhereå¤„ç†é€»è¾‘"></a>2.1 RocketMQå®¢æˆ·ç«¯consumeFromWhereå¤„ç†é€»è¾‘</h2><p>Consumerå¯åŠ¨æ˜¯è°ƒç”¨<code>computePullFromWhere(MessageQueue mq)</code>æ–¹æ³•è·å–offsetï¼Œä»¥ä¸‹ä¸ºè¯¥æ–¹æ³•çš„æºç å®ç°ï¼š<br><code>org.apache.rocketmq.client.impl.consumer.RebalancePushImpl.java</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">computePullFromWhere</span><span class="token punctuation">(</span><span class="token class-name">MessageQueue</span> mq<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">ConsumeFromWhere</span> consumeFromWhere <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultMQPushConsumerImpl<span class="token punctuation">.</span><span class="token function">getDefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConsumeFromWhere</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">OffsetStore</span> offsetStore <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultMQPushConsumerImpl<span class="token punctuation">.</span><span class="token function">getOffsetStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>consumeFromWhere<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSUME_FROM_LAST_OFFSET_AND_FROM_MIN_WHEN_BOOT_FIRST</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">CONSUME_FROM_MIN_OFFSET</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">CONSUME_FROM_MAX_OFFSET</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token constant">CONSUME_FROM_LAST_OFFSET</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            
            <span class="token comment">// ä»brokerè·å–æ¶ˆè´¹è€…ç»„çš„offsetï¼Œæ­¤æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µ</span>
            <span class="token comment">// 1. è¯¥æ¶ˆè´¹è€…ç»„ä¹‹å‰å·²ç»å­˜åœ¨ï¼Œåˆ™brokerè¿”å›è¯¥æ¶ˆè´¹è€…ç»„çš„æœ€åçš„offsetï¼Œæ­¤æ—¶offset > 0</span>
            <span class="token comment">// 2. å¦‚æœæ˜¯ä¸€ä¸ªæ–°çš„æ¶ˆè´¹è€…ç»„ï¼Œåˆ™åˆåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</span>
            <span class="token comment">// 2.1 å¦‚æœæ¶ˆè´¹è€…ç»„è®¢é˜…çš„æ¶ˆæ¯ä»åœ¨brokerçš„å†…å­˜ä¸­,åˆ™brokerè¿”å›offset=0</span>
            <span class="token comment">// 2.2 å¦‚æœæ¶ˆè´¹è€…ç»„è®¢é˜…çš„æ¶ˆæ¯ä¸åœ¨brokerçš„å†…å­˜ä¸­ï¼Œåˆ™brokerè¿”å›æœªæŸ¥æ‰¾åˆ°ï¼Œå®¢æˆ·ç«¯å°†offsetè®¾ç½®ä¸º-1</span>
            <span class="token keyword">long</span> lastOffset <span class="token operator">=</span> offsetStore<span class="token punctuation">.</span><span class="token function">readOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> <span class="token class-name">ReadOffsetType</span><span class="token punctuation">.</span><span class="token constant">READ_FROM_STORE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// æ¶ˆè´¹è€…ç»„ä¹‹å‰å·²ç»å­˜åœ¨ï¼ˆoffset>0),æˆ–æ–°æ¶ˆè´¹è€…ç»„ä¸”è®¢é˜…çš„å†å²æ¶ˆæ¯ä»å­˜åœ¨brokerå†…å­˜ä¸­ï¼ˆoffset=0)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastOffset <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> lastOffset<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// æ–°æ¶ˆè´¹è€…ç»„ä¸”å†å²æ¶ˆæ¯ä¸åœ¨brokerçš„å†…å­˜ä¸­</span>
            <span class="token comment">// First start,no offset</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> lastOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mq<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">MixAll</span><span class="token punctuation">.</span><span class="token constant">RETRY_GROUP_TOPIC_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    result <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// ä»æœ€æ–°çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mQClientFactory<span class="token punctuation">.</span><span class="token function">getMQAdminImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSUME_FROM_FIRST_OFFSET</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> lastOffset <span class="token operator">=</span> offsetStore<span class="token punctuation">.</span><span class="token function">readOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> <span class="token class-name">ReadOffsetType</span><span class="token punctuation">.</span><span class="token constant">READ_FROM_STORE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// æ¶ˆè´¹è€…ç»„ä¹‹å‰å·²ç»å­˜åœ¨ï¼ˆoffset>0),æˆ–æ–°æ¶ˆè´¹è€…ç»„ä¸”å†å²æ¶ˆæ¯ä»å­˜åœ¨brokerçš„å†…å­˜ä¸­ï¼ˆoffset=0)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastOffset <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> lastOffset<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> lastOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> <span class="token constant">CONSUME_FROM_TIMESTAMP</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> lastOffset <span class="token operator">=</span> offsetStore<span class="token punctuation">.</span><span class="token function">readOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> <span class="token class-name">ReadOffsetType</span><span class="token punctuation">.</span><span class="token constant">READ_FROM_STORE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
             <span class="token comment">// æ¶ˆè´¹è€…ç»„ä¹‹å‰å·²ç»å­˜åœ¨ï¼ˆoffset>0),æˆ–æ–°æ¶ˆè´¹è€…ç»„ä¸”å†å²æ¶ˆæ¯ä»å­˜åœ¨brokerçš„å†…å­˜ä¸­ï¼ˆoffset=0)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastOffset <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> lastOffset<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> lastOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mq<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">MixAll</span><span class="token punctuation">.</span><span class="token constant">RETRY_GROUP_TOPIC_PREFIX</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mQClientFactory<span class="token punctuation">.</span><span class="token function">getMQAdminImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// ä»æ—¶é—´æˆ³å¯¹åº”çš„offsetå¼€å§‹æ¶ˆè´¹</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">long</span> timestamp <span class="token operator">=</span> <span class="token class-name">UtilAll</span><span class="token punctuation">.</span><span class="token function">parseDate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultMQPushConsumerImpl<span class="token punctuation">.</span><span class="token function">getDefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConsumeTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token class-name">UtilAll</span><span class="token punctuation">.</span><span class="token constant">YYYYMMDDHHMMSS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mQClientFactory<span class="token punctuation">.</span><span class="token function">getMQAdminImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">searchOffset</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MQClientException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-brokerç«¯æŸ¥è¯¢æ¶ˆè´¹è€…ç»„offsetçš„å¤„ç†é€»è¾‘"><a href="#2-2-brokerç«¯æŸ¥è¯¢æ¶ˆè´¹è€…ç»„offsetçš„å¤„ç†é€»è¾‘" class="headerlink" title="2.2 brokerç«¯æŸ¥è¯¢æ¶ˆè´¹è€…ç»„offsetçš„å¤„ç†é€»è¾‘"></a>2.2 brokerç«¯æŸ¥è¯¢æ¶ˆè´¹è€…ç»„offsetçš„å¤„ç†é€»è¾‘</h2><h3 id="brokerå¤„ç†queryConsumerOffsetè¯·æ±‚æºç å®ç°"><a href="#brokerå¤„ç†queryConsumerOffsetè¯·æ±‚æºç å®ç°" class="headerlink" title="brokerå¤„ç†queryConsumerOffsetè¯·æ±‚æºç å®ç°"></a>brokerå¤„ç†queryConsumerOffsetè¯·æ±‚æºç å®ç°</h3><p><code>org.apache.rocketmq.broker.processor.ConsumerManageProcessor</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// brokerå¤„ç†å®¢æˆ·ç«¯æŸ¥æ‰¾Consumerçš„offsetçš„è¯·æ±‚</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">RemotingCommand</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RemotingCommand</span> request<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">RemotingCommandException</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token class-name">RequestCode</span><span class="token punctuation">.</span><span class="token constant">GET_CONSUMER_LIST_BY_GROUP</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getConsumerListByGroup</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">RequestCode</span><span class="token punctuation">.</span><span class="token constant">UPDATE_CONSUMER_OFFSET</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateConsumerOffset</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">RequestCode</span><span class="token punctuation">.</span><span class="token constant">QUERY_CONSUMER_OFFSET</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queryConsumerOffset</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token class-name">RemotingCommand</span> <span class="token function">queryConsumerOffset</span><span class="token punctuation">(</span><span class="token class-name">ChannelHandlerContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RemotingCommand</span> request<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">RemotingCommandException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">RemotingCommand</span> response <span class="token operator">=</span>
            <span class="token class-name">RemotingCommand</span><span class="token punctuation">.</span><span class="token function">createResponseCommand</span><span class="token punctuation">(</span><span class="token class-name">QueryConsumerOffsetResponseHeader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">QueryConsumerOffsetResponseHeader</span> responseHeader <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token class-name">QueryConsumerOffsetResponseHeader</span><span class="token punctuation">)</span> response<span class="token punctuation">.</span><span class="token function">readCustomHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">QueryConsumerOffsetRequestHeader</span> requestHeader <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token class-name">QueryConsumerOffsetRequestHeader</span><span class="token punctuation">)</span> request
                <span class="token punctuation">.</span><span class="token function">decodeCommandCustomHeader</span><span class="token punctuation">(</span><span class="token class-name">QueryConsumerOffsetRequestHeader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä»ConsumerOffsetManagerä¸­è·å–offset</span>
        <span class="token keyword">long</span> offset <span class="token operator">=</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getConsumerOffsetManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">queryOffset</span><span class="token punctuation">(</span>
                requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            responseHeader<span class="token punctuation">.</span><span class="token function">setOffset</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// offsetå°äº0ï¼Œå³brokerä¸­ä¸å­˜åœ¨è¯¥æ¶ˆè´¹è€…ç»„çš„offsetä¿¡æ¯ï¼ˆæ˜¯ä¸€ä¸ªæ–°å¯åŠ¨çš„æ¶ˆè´¹è€…ç»„ï¼‰</span>
            <span class="token comment">// è·å–æ¶ˆè´¹é˜Ÿåˆ—çš„æœ€å°çš„offsetï¼Œå¦‚æœè¯¥é˜Ÿåˆ—æ–‡ä»¶æœªè¿›è¡Œæ¸…é™¤ï¼Œåˆ™offset=0</span>
            <span class="token keyword">long</span> minOffset <span class="token operator">=</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getMessageStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMinOffsetInQueue</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å¦‚æœminOffsetå°äºç­‰äº0ï¼Œä¸”æœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯ä»åœ¨å†…å­˜ä¸­åˆ™è¿”å›offset=0</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>minOffset <span class="token operator">&lt;=</span> <span class="token number">0</span>
                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getMessageStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkInDiskByConsumeOffset</span><span class="token punctuation">(</span>
                requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                responseHeader<span class="token punctuation">.</span><span class="token function">setOffset</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ–°å¯åŠ¨çš„æ¶ˆè´¹è€…ç»„ï¼Œä¸”ç§¯å‹çš„æ¶ˆæ¯ä¸åœ¨å†…å­˜ä¸­ï¼Œåˆ™è¿”å›QUERY_NOT_FOUND</span>
                response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">QUERY_NOT_FOUND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"Not found, V3_0_6_SNAPSHOT maybe this group consumer boot first"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="brokeræŸ¥æ‰¾æ¶ˆè´¹è€…ç»„offsetæºç å®ç°"><a href="#brokeræŸ¥æ‰¾æ¶ˆè´¹è€…ç»„offsetæºç å®ç°" class="headerlink" title="brokeræŸ¥æ‰¾æ¶ˆè´¹è€…ç»„offsetæºç å®ç°"></a>brokeræŸ¥æ‰¾æ¶ˆè´¹è€…ç»„offsetæºç å®ç°</h3><p><code>org.apache.rocketmq.broker.offset.ConsumerOffsetManager.java</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// brokerå¯åŠ¨æ—¶åŠ è½½å¯åŠ¨ç”¨æˆ·ç›®å½•ä¸‹çš„store/config/consumerOffset.jsonæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¿å­˜äº†å¯¹åº”Topicä¸‹çš„æ¶ˆè´¹è€…ç»„åœ¨é˜Ÿåˆ—çš„offset</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">String</span> jsonString<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>jsonString <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ConsumerOffsetManager</span> obj <span class="token operator">=</span> <span class="token class-name">RemotingSerializable</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">,</span> <span class="token class-name">ConsumerOffsetManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>offsetTable <span class="token operator">=</span> obj<span class="token punctuation">.</span>offsetTable<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// æ ¹æ®Topicã€æ¶ˆè´¹è€…ç»„ã€é˜Ÿåˆ—Idä»brokerè·å–offsetï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›-1</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">queryOffset</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> group<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">int</span> queueId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// topic@group</span>
    <span class="token class-name">String</span> key <span class="token operator">=</span> topic <span class="token operator">+</span> <span class="token constant">TOPIC_GROUP_SEPARATOR</span> <span class="token operator">+</span> group<span class="token punctuation">;</span>
    <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetTable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Long</span> offset <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>queueId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> offset<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ul>
<li>å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¹‹å‰å·²ç»å¯åŠ¨è¿‡ï¼Œå†æ¬¡å¯åŠ¨åï¼Œæ— è®ºconsumeFromWhereè®¾ç½®ä½•å€¼ï¼Œéƒ½ä¼šæ ¹æ®åœ¨brokerè®°å½•çš„offsetè¿›è¡Œæ¶ˆè´¹</li>
<li>å¦‚æœæ˜¯ä¸€ä¸ªæ–°å¯åŠ¨çš„æ¶ˆè´¹è€…ç»„ï¼Œä¸”æ¶ˆè´¹è€…ç»„è®¢é˜…çš„æ¶ˆæ¯ä»åœ¨brokerçš„å†…å­˜ä¸­ï¼Œæ— è®ºconsumeFromWhereè®¾ç½®ä½•å€¼ï¼Œéƒ½å°†ä»0å¼€å§‹æ¶ˆè´¹</li>
<li>å¦‚æœæ˜¯ä¸€ä¸ªæ–°å¯åŠ¨çš„æ¶ˆè´¹è€…ç»„ï¼Œä¸”æ¶ˆè´¹è€…ç»„è®¢é˜…çš„æ¶ˆæ¯ä¸åœ¨brokerçš„å†…å­˜ä¸­ï¼Œæ ¹æ®consumeFromWhereè®¾ç½®çš„è·å–å¯¹åº”çš„offsetè¿›è¡Œæ¶ˆè´¹</li>
</ul>
<h2 id="å…‹éš†æˆ–é‡ç½®æ¶ˆè´¹è€…ç»„çš„offset"><a href="#å…‹éš†æˆ–é‡ç½®æ¶ˆè´¹è€…ç»„çš„offset" class="headerlink" title="å…‹éš†æˆ–é‡ç½®æ¶ˆè´¹è€…ç»„çš„offset"></a>å…‹éš†æˆ–é‡ç½®æ¶ˆè´¹è€…ç»„çš„offset</h2><p>æ ¹æ®åˆ†æç»“æœï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¶ˆè´¹è€…ç»„ï¼Œå¦‚æœæƒ³è¦è·³è¿‡ç§¯å‹çš„æ¶ˆæ¯ï¼Œè®¾ç½®consumeFromWhereæ˜¯æ— æ•ˆçš„ï¼Œä½†æ˜¯å¯ç”¨é€šè¿‡rocketmq-dashboardæˆ–mqadminé‡ç½®offsetã€‚<br>å¦‚æœæ˜¯æ–°å»ºæ¶ˆè´¹è€…ç»„ï¼Œä¸æƒ³è¦é‡å¤´å¼€å§‹æ¶ˆè´¹ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­åšæ—¶é—´æ ¡éªŒè·³è¿‡å†å²æ¶ˆæ¯ï¼Œæˆ–è€…é€šè¿‡rocketmq-dashboardæˆ–mqadminæ–°å»ºæ¶ˆè´¹è€…ç»„å¹¶é‡ç½®offsetã€‚</p>
]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
        <tag>ConsumeFromWhere</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQä¸­çš„ConsumeråŠConsumerGroupè¯¦è§£</title>
    <url>/2021/09/05/rockermq/rocketmq-zhong-de-consumer-ji-consumergroup-xiang-jie/</url>
    <content><![CDATA[<h1 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h1><h2 id="æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰"><a href="#æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰" class="headerlink" title="æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰"></a>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</h2><p>è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼Œä¸€èˆ¬æ˜¯åå°ç³»ç»Ÿè´Ÿè´£å¼‚æ­¥æ¶ˆè´¹ã€‚ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹è€…ä¼šä»BrokeræœåŠ¡å™¨æ‹‰å–æ¶ˆæ¯ã€å¹¶å°†å…¶æä¾›ç»™åº”ç”¨ç¨‹åºã€‚ä»ç”¨æˆ·åº”ç”¨çš„è§’åº¦è€Œè¨€æä¾›äº†ä¸¤ç§æ¶ˆè´¹å½¢å¼ï¼šæ‹‰å–å¼æ¶ˆè´¹ã€æ¨åŠ¨å¼æ¶ˆè´¹ã€‚</p>
<h2 id="æ¶ˆè´¹è€…ç»„ï¼ˆConsumer-Groupï¼‰"><a href="#æ¶ˆè´¹è€…ç»„ï¼ˆConsumer-Groupï¼‰" class="headerlink" title="æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰"></a>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</h2><p>åŒä¸€ç±»Consumerçš„é›†åˆï¼Œè¿™ç±»Consumeré€šå¸¸æ¶ˆè´¹åŒä¸€ç±»æ¶ˆæ¯ä¸”æ¶ˆè´¹é€»è¾‘ä¸€è‡´ã€‚æ¶ˆè´¹è€…ç»„ä½¿å¾—åœ¨æ¶ˆæ¯æ¶ˆè´¹æ–¹é¢ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œå®¹é”™çš„ç›®æ ‡å˜å¾—éå¸¸å®¹æ˜“ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å®ä¾‹å¿…é¡»è®¢é˜…å®Œå…¨ç›¸åŒçš„Topicã€‚RocketMQ æ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å¼ï¼šé›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰å’Œå¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰ã€‚</p>
<h2 id="é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰"><a href="#é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰" class="headerlink" title="é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰"></a>é›†ç¾¤æ¶ˆè´¹ï¼ˆClusteringï¼‰</h2><p>é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹,ç›¸åŒConsumer Groupçš„æ¯ä¸ªConsumerå®ä¾‹å¹³å‡åˆ†æ‘Šæ¶ˆæ¯ã€‚</p>
<h2 id="å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰"><a href="#å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰" class="headerlink" title="å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰"></a>å¹¿æ’­æ¶ˆè´¹ï¼ˆBroadcastingï¼‰</h2><p>å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œç›¸åŒConsumer Groupçš„æ¯ä¸ªConsumerå®ä¾‹éƒ½æ¥æ”¶å…¨é‡çš„æ¶ˆæ¯ã€‚</p>
<h1 id="äºŒã€è®¢é˜…å…³ç³»ä¸€è‡´"><a href="#äºŒã€è®¢é˜…å…³ç³»ä¸€è‡´" class="headerlink" title="äºŒã€è®¢é˜…å…³ç³»ä¸€è‡´"></a>äºŒã€è®¢é˜…å…³ç³»ä¸€è‡´</h1><p>è®¢é˜…å…³ç³»ä¸€è‡´æŒ‡çš„æ˜¯åŒä¸€ä¸ªæ¶ˆè´¹è€…Group IDä¸‹æ‰€æœ‰Consumerå®ä¾‹æ‰€è®¢é˜…çš„Topicã€Tagå¿…é¡»å®Œå…¨ä¸€è‡´ã€‚å¦‚æœè®¢é˜…å…³ç³»ä¸ä¸€è‡´ï¼Œæ¶ˆæ¯æ¶ˆè´¹çš„é€»è¾‘å°±ä¼šæ··ä¹±ï¼Œç”šè‡³å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚</p>
<h2 id="èƒŒæ™¯ä¿¡æ¯"><a href="#èƒŒæ™¯ä¿¡æ¯" class="headerlink" title="èƒŒæ™¯ä¿¡æ¯"></a>èƒŒæ™¯ä¿¡æ¯</h2><p>æ¶ˆæ¯é˜Ÿåˆ—RocketMQç‰ˆé‡Œçš„ä¸€ä¸ªæ¶ˆè´¹è€…Group IDä»£è¡¨ä¸€ä¸ªConsumerå®ä¾‹ç¾¤ç»„ã€‚å¯¹äºå¤§å¤šæ•°åˆ†å¸ƒå¼åº”ç”¨æ¥è¯´ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…Group IDä¸‹é€šå¸¸ä¼šæŒ‚è½½å¤šä¸ªConsumerå®ä¾‹ã€‚</p>
<p>ç”±äºæ¶ˆæ¯é˜Ÿåˆ—RocketMQç‰ˆçš„è®¢é˜…å…³ç³»ä¸»è¦ç”±Topic+Tagå…±åŒç»„æˆï¼Œå› æ­¤ï¼Œä¿æŒè®¢é˜…å…³ç³»ä¸€è‡´æ„å‘³ç€åŒä¸€ä¸ªæ¶ˆè´¹è€…Group IDä¸‹æ‰€æœ‰çš„Consumerå®ä¾‹éœ€åœ¨ä»¥ä¸‹æ–¹é¢å‡ä¿æŒä¸€è‡´ï¼š</p>
<ul>
<li>è®¢é˜…çš„Topicå¿…é¡»ä¸€è‡´ï¼Œä¾‹å¦‚ï¼šConsumer1è®¢é˜…TopicAå’ŒTopicBï¼ŒConsumer2ä¹Ÿå¿…é¡»è®¢é˜…TopicAå’ŒTopicBï¼Œä¸èƒ½åªè®¢é˜…TopicAã€åªè®¢é˜…TopicBæˆ–è®¢é˜…TopicAå’ŒTopicCã€‚</li>
<li>è®¢é˜…çš„åŒä¸€ä¸ªTopicä¸­çš„Tagå¿…é¡»ä¸€è‡´ï¼ŒåŒ…æ‹¬Tagçš„æ•°é‡å’ŒTagçš„é¡ºåºï¼Œä¾‹å¦‚ï¼šConsumer1è®¢é˜…TopicBä¸”Tagä¸ºTag1||Tag2ï¼ŒConsumer2è®¢é˜…TopicBçš„Tagä¹Ÿå¿…é¡»æ˜¯Tag1||Tag2ï¼Œä¸èƒ½åªè®¢é˜…Tag1ã€åªè®¢é˜…Tag2æˆ–è€…è®¢é˜…Tag2||Tag1ã€‚</li>
</ul>
<p>æ­£ç¡®çš„è®¢é˜…å…³ç³»å¦‚ä¸‹ï¼Œå¤šä¸ªGroup IDåˆ†åˆ«è®¢é˜…äº†ä¸åŒçš„Topicï¼Œä½†æ˜¯åŒä¸€ä¸ªGroup IDä¸‹çš„å¤šä¸ªConsumerå®ä¾‹C1ã€C2ã€C3è®¢é˜…çš„Topicå’ŒTagéƒ½ä¸€è‡´ã€‚<br><img src="/2021/09/05/rockermq/rocketmq-zhong-de-consumer-ji-consumergroup-xiang-jie/RocketMQ%E8%AE%A2%E9%98%85%E5%85%B3%E7%B3%BB.png" alt="RocketMQè®¢é˜…å…³ç³»"></p>
<h1 id="ä¸‰ã€è®¢é˜…å…³ç³»ä¸ä¸€è‡´"><a href="#ä¸‰ã€è®¢é˜…å…³ç³»ä¸ä¸€è‡´" class="headerlink" title="ä¸‰ã€è®¢é˜…å…³ç³»ä¸ä¸€è‡´"></a>ä¸‰ã€è®¢é˜…å…³ç³»ä¸ä¸€è‡´</h1><p>å½“RocketMQè®¢é˜…å…³ç³»ä¸ä¸€è‡´æ—¶ï¼Œæ¶ˆæ¯æ¶ˆè´¹çš„é€»è¾‘å°±ä¼šæ··ä¹±ï¼Œç”šè‡³å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»“åˆæ¡ˆä¾‹åŠæºç åšè¿›ä¸€æ­¥éªŒè¯åˆ†æã€‚</p>
<blockquote>
<p>RocketMQ Version : 4.8.0</p>
</blockquote>
<h2 id="æ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…è®¢é˜…ç›¸åŒçš„Topicä¸åŒçš„Tag"><a href="#æ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…è®¢é˜…ç›¸åŒçš„Topicä¸åŒçš„Tag" class="headerlink" title="æ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…è®¢é˜…ç›¸åŒçš„Topicä¸åŒçš„Tag"></a>æ¶ˆè´¹è€…ç»„å†…æ¶ˆè´¹è€…è®¢é˜…ç›¸åŒçš„Topicä¸åŒçš„Tag</h2><p>RocketMQç›¸åŒæ¶ˆè´¹è€…ç»„å†…è®¢é˜…ç›¸åŒTopicä¸åŒTagçš„æµ‹è¯•åŸºæœ¬ä¿¡æ¯ï¼š</p>
<ul>
<li>Topicåç§°ï¼š SUBSCRIBE_TEST</li>
<li>Topicè¯»é˜Ÿåˆ—æ•°é‡ï¼š4</li>
<li>Topicå†™é˜Ÿåˆ—æ•°é‡ï¼š4</li>
<li>Topicè¯»å†™æƒé™ï¼š6</li>
<li>æ¶ˆè´¹è€…ç»„åç§°ï¼š SUBSCRIBE_TEST_CONSUMER_GROUP</li>
<li>æ¶ˆæ¯TAGç±»å‹ï¼š TagAï¼ŒTagB</li>
<li>TagAæ¶ˆæ¯æ¶ˆè´¹è€…ï¼š ConsumerForTagA</li>
<li>TagBæ¶ˆæ¯æ¶ˆè´¹è€…ï¼š ConsumerForTagB</li>
</ul>
<h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><ul>
<li><code>ConsumerForTagA</code>è®¢é˜…ä¿¡æ¯ï¼š è®¢é˜…Topic<code>SUBSCRIBE_TEST</code> å’Œ<code>tagA</code></li>
<li><code>ConsumerForTagB</code>è®¢é˜…ä¿¡æ¯ï¼š è®¢é˜…Topic<code>SUBSCRIBE_TEST</code> å’Œ<code>tagB</code></li>
</ul>
<h3 id="æ¶ˆè´¹è€…ä»£ç ç¤ºä¾‹ï¼š"><a href="#æ¶ˆè´¹è€…ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="æ¶ˆè´¹è€…ä»£ç ç¤ºä¾‹ï¼š"></a>æ¶ˆè´¹è€…ä»£ç ç¤ºä¾‹ï¼š</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerForTagA</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">"SUBSCRIBE_TEST_CONSUMER_GROUP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">"172.16.1.15:9876"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"SUBSCRIBE_TEST"</span><span class="token punctuation">,</span> <span class="token string">"tagA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">></span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Receive New Messages: %s %n"</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ConsumerForTagA started!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumerForTagB</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">DefaultMQPushConsumer</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQPushConsumer</span><span class="token punctuation">(</span><span class="token string">"SUBSCRIBE_TEST_CONSUMER_GROUP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">"172.16.1.15:9876"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">"SUBSCRIBE_TEST"</span><span class="token punctuation">,</span> <span class="token string">"tagB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">registerMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerConcurrently</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">ConsumeConcurrentlyStatus</span> <span class="token function">consumeMessage</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MessageExt</span><span class="token punctuation">></span></span> msgs<span class="token punctuation">,</span> <span class="token class-name">ConsumeConcurrentlyContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Receive New Messages: %s %n"</span><span class="token punctuation">,</span> msgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">ConsumeConcurrentlyStatus</span><span class="token punctuation">.</span><span class="token constant">CONSUME_SUCCESS</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ConsumerForTagB started!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å…ˆå¯åŠ¨ConsumerForTagAå†å¯åŠ¨ConsumerForTagB"><a href="#å…ˆå¯åŠ¨ConsumerForTagAå†å¯åŠ¨ConsumerForTagB" class="headerlink" title="å…ˆå¯åŠ¨ConsumerForTagAå†å¯åŠ¨ConsumerForTagB"></a>å…ˆå¯åŠ¨ConsumerForTagAå†å¯åŠ¨ConsumerForTagB</h3><h2 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><p>ç”Ÿäº§è€…å‘<code>SUBSCRIBE_TEST</code>Topicä¸­å†™å…¥8æ¡æ¶ˆæ¯ï¼Œå‰4æ¡æ¶ˆæ¯çš„TAGä¸º<code>tagA</code>ï¼Œå4æ¡æ¶ˆæ¯çš„TAGä¸º<code>tagB</code>.</p>
<h3 id="ç”Ÿäº§è€…ä»£ç ç¤ºä¾‹"><a href="#ç”Ÿäº§è€…ä»£ç ç¤ºä¾‹" class="headerlink" title="ç”Ÿäº§è€…ä»£ç ç¤ºä¾‹"></a>ç”Ÿäº§è€…ä»£ç ç¤ºä¾‹</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncProducer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MQClientException</span><span class="token punctuation">,</span> <span class="token class-name">RemotingException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">MQBrokerException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">DefaultMQProducer</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultMQProducer</span><span class="token punctuation">(</span><span class="token string">"SUBSCRIBE_TEST_PRODUCER_GROUP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setNamesrvAddr</span><span class="token punctuation">(</span><span class="token string">"172.16.1.15:9876"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">setSendMsgTimeout</span><span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> tag <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"tagA"</span> <span class="token operator">:</span> <span class="token string">"tagB"</span><span class="token punctuation">;</span>
            <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token string">"SUBSCRIBE_TEST"</span><span class="token punctuation">,</span> tag<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"MsgStr"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHARSET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SendResult</span> sendResult <span class="token operator">=</span> producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s%n"</span><span class="token punctuation">,</span> sendResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        producer<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯"><a href="#å¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯" class="headerlink" title="å¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯"></a>å¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4B9C0000</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token constant">AC10010F00002A9F00000017038663BE</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4C040001</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token constant">AC10010F00002A9F0000001703866483</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4C760002</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token constant">AC10010F00002A9F0000001703866548</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4C890003</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token constant">AC10010F00002A9F000000170386660D</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4CBE0004</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">*</span><span class="token constant">AC10010F00002A9F00000017038666D2</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4D190005</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">*</span><span class="token constant">AC10010F00002A9F0000001703866797</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4D380006</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token constant">AC10010F00002A9F000000170386685C</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token class-name">SendResult</span> <span class="token punctuation">[</span>sendStatus<span class="token operator">=</span><span class="token constant">SEND_OK</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4DE50007</span><span class="token punctuation">,</span> offsetMsgId<span class="token operator">=</span><span class="token constant">AC10010F00002A9F0000001703866921</span><span class="token punctuation">,</span> messageQueue<span class="token operator">=</span><span class="token class-name">MessageQueue</span> <span class="token punctuation">[</span>topic<span class="token operator">=</span><span class="token constant">SUBSCRIBE_TEST</span><span class="token punctuation">,</span> brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æƒ…å†µ"><a href="#æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æƒ…å†µ" class="headerlink" title="æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æƒ…å†µ"></a>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æƒ…å†µ</h2><p>ConsumerForTagAæœªæ¶ˆè´¹åˆ°æ¶ˆæ¯ã€‚<br>ConsumerForTagBæ¶ˆè´¹åˆ°2æ¡æ¶ˆæ¯ï¼Œæ¶ˆæ¯å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Receive</span> <span class="token class-name">New</span> <span class="token class-name">Messages</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">MessageExt</span> <span class="token punctuation">[</span>brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> storeSize<span class="token operator">=</span><span class="token number">197</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sysFlag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> bornTimestamp<span class="token operator">=</span><span class="token number">1630810315966</span><span class="token punctuation">,</span> bornHost<span class="token operator">=</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.0</span><span class="token number">.103</span><span class="token operator">:</span><span class="token number">62659</span><span class="token punctuation">,</span> storeTimestamp<span class="token operator">=</span><span class="token number">1630810316147</span><span class="token punctuation">,</span> storeHost<span class="token operator">=</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">*</span><span class="token constant">AC10010F00002A9F00000017038666D2</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span> commitLogOffset<span class="token operator">=</span><span class="token number">98843387602</span><span class="token punctuation">,</span> bodyCRC<span class="token operator">=</span><span class="token number">686395636</span><span class="token punctuation">,</span> reconsumeTimes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> preparedTransactionOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token class-name">Message</span><span class="token punctuation">&#123;</span>topic<span class="token operator">=</span>'<span class="token constant">SUBSCRIBE_TEST</span>'<span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> properties<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token constant">MIN_OFFSET</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">MAX_OFFSET</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CONSUME_START_TIME</span><span class="token operator">=</span><span class="token number">1630810316068</span><span class="token punctuation">,</span> <span class="token constant">UNIQ_KEY</span><span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4CBE0004</span><span class="token punctuation">,</span> <span class="token constant">CLUSTER</span><span class="token operator">=</span><span class="token class-name">DefaultCluster</span><span class="token punctuation">,</span> <span class="token constant">WAIT</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token constant">TAGS</span><span class="token operator">=</span>tagB<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> body<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span> transactionId<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> 
<span class="token class-name">Receive</span> <span class="token class-name">New</span> <span class="token class-name">Messages</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">MessageExt</span> <span class="token punctuation">[</span>brokerName<span class="token operator">=</span>broker<span class="token operator">-</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> queueId<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> storeSize<span class="token operator">=</span><span class="token number">197</span><span class="token punctuation">,</span> queueOffset<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sysFlag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> bornTimestamp<span class="token operator">=</span><span class="token number">1630810316057</span><span class="token punctuation">,</span> bornHost<span class="token operator">=</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.0</span><span class="token number">.103</span><span class="token operator">:</span><span class="token number">62659</span><span class="token punctuation">,</span> storeTimestamp<span class="token operator">=</span><span class="token number">1630810316223</span><span class="token punctuation">,</span> storeHost<span class="token operator">=</span><span class="token operator">/</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span><span class="token operator">:</span><span class="token number">10911</span><span class="token punctuation">,</span> msgId<span class="token operator">=</span><span class="token operator">*</span><span class="token operator">*</span><span class="token constant">AC10010F00002A9F0000001703866797</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span> commitLogOffset<span class="token operator">=</span><span class="token number">98843387799</span><span class="token punctuation">,</span> bodyCRC<span class="token operator">=</span><span class="token number">1609474146</span><span class="token punctuation">,</span> reconsumeTimes<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> preparedTransactionOffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token class-name">Message</span><span class="token punctuation">&#123;</span>topic<span class="token operator">=</span>'<span class="token constant">SUBSCRIBE_TEST</span>'<span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> properties<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token constant">MIN_OFFSET</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">MAX_OFFSET</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token constant">CONSUME_START_TIME</span><span class="token operator">=</span><span class="token number">1630810316088</span><span class="token punctuation">,</span> <span class="token constant">UNIQ_KEY</span><span class="token operator">=</span><span class="token constant">AC10DFD6121618B4AAC216EE4D190005</span><span class="token punctuation">,</span> <span class="token constant">CLUSTER</span><span class="token operator">=</span><span class="token class-name">DefaultCluster</span><span class="token punctuation">,</span> <span class="token constant">WAIT</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token constant">TAGS</span><span class="token operator">=</span>tagB<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> body<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">]</span><span class="token punctuation">,</span> transactionId<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ ¹æ®ä¸Šè¿°æµ‹è¯•ç»“æœï¼Œå¯ä»¥åˆ†æå¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š</p>
<ul>
<li>æµ‹è¯•Topicçš„é˜Ÿåˆ—æ•°é‡ä¸º4ï¼Œç”Ÿäº§è€…åˆ†åˆ«å‘æ¯ä¸ªé˜Ÿåˆ—æ€»å…±å†™å…¥äº†2æ¡æ¶ˆæ¯ï¼ŒTAGåˆ†åˆ«ä¸º<code>tagA</code>å’Œ<code>tagB</code></li>
<li>æ¶ˆè´¹è€…ç»„<code>SUBSCRIBE_TEST_CONSUMER_GROUP</code>ä¸‹æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…<code>ConsumerForTagA</code>å…ˆå¯åŠ¨ï¼Œæ¶ˆè´¹è€…<code>ConsumerForTagB</code>åå¯åŠ¨</li>
<li>æ¶ˆè´¹è€…<code>ConsumerForTagA</code>æ¶ˆè´¹çš„é˜Ÿåˆ—IDä¸º<code>0</code>å’Œ<code>1</code>ï¼Œæ¶ˆè´¹è€…<code>ConsumerForTagB</code>æ¶ˆæ¯çš„é˜Ÿåˆ—IDä¸º<code>2</code>å’Œ<code>3</code></li>
<li>æ¶ˆè´¹è€…<code>ConsumerForTabA</code>å¯¹åˆ†é…ç»™è‡ªå·±çš„é˜Ÿåˆ—<code>0</code>å’Œ<code>1</code>ä¸­çš„TAGä¸º<code>tagA</code>å’Œ<code>tagB</code>çš„æ¶ˆæ¯ï¼Œéƒ½æœªè¿›è¡Œæ¶ˆè´¹</li>
<li>æ¶ˆè´¹è€…<code>ConsumerForTagB</code>æ¶ˆè´¹äº†åˆ†é…ç»™è‡ªå·±çš„é˜Ÿåˆ—<code>2</code>å’Œ<code>3</code>ä¸­çš„TAGä¸º<code>tagB</code>çš„æ¶ˆæ¯ï¼Œä½†æ²¡æœ‰æ¶ˆè´¹TAGä¸º<code>tagA</code>çš„æ¶ˆæ¯</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ¶ˆè´¹è€…<code>ConsumerForTagB</code>åœ¨æ¶ˆè´¹è€…<code>ConsumerForTabA</code>ä¹‹åå¯åŠ¨ï¼Œè¦†ç›–äº†RocketMQçš„Brokerä¸­çš„æ¶ˆè´¹è€…ç»„<code>SUBSCRIBE_TEST_CONSUMER_GROUP</code>è®¢é˜…å…³ç³»ï¼Œè¯¥æ¶ˆè´¹è€…ç»„åœ¨æ¶ˆè´¹è€…<code>ConsumerForTagB</code>å¯åŠ¨åï¼Œè®¢é˜…çš„æ¶ˆæ¯å˜ä¸º<code>tagB</code>ï¼Œæ¶ˆè´¹è€…<code>ConsumerForTagA</code>åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œç”±äºæ¶ˆè´¹è€…ç»„çš„è®¢é˜…TAGä¸º<code>tagB</code>ï¼Œæ‰€ä»¥è¿‡æ»¤æ‰äº†<code>tagA</code>çš„æ¶ˆæ¯ã€‚</p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><h4 id="Brokenè·å–æ¶ˆæ¯çš„æºç "><a href="#Brokenè·å–æ¶ˆæ¯çš„æºç " class="headerlink" title="Brokenè·å–æ¶ˆæ¯çš„æºç "></a>Brokenè·å–æ¶ˆæ¯çš„æºç </h4><p><code>DefaultMessageStore.java</code>ä¸­è·å–Messageçš„æºç , å…¶ä¸­å»é™¤äº†éƒ¨åˆ†è¾¹ç•Œæ£€æµ‹é€»è¾‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">GetMessageResult</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> group<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">int</span> queueId<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> maxMsgNums<span class="token punctuation">,</span>
        <span class="token keyword">final</span> <span class="token class-name">MessageFilter</span> messageFilter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">long</span> beginTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSystemClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">GetMessageStatus</span> status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">NO_MESSAGE_IN_QUEUE</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> nextBeginOffset <span class="token operator">=</span> offset<span class="token punctuation">;</span>
        <span class="token keyword">long</span> minOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> maxOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">GetMessageResult</span> getResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetMessageResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token keyword">long</span> maxOffsetPy <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commitLog<span class="token punctuation">.</span><span class="token function">getMaxOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ConsumeQueue</span> consumeQueue <span class="token operator">=</span> <span class="token function">findConsumeQueue</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> queueId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>consumeQueue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            minOffset <span class="token operator">=</span> consumeQueue<span class="token punctuation">.</span><span class="token function">getMinOffsetInQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            maxOffset <span class="token operator">=</span> consumeQueue<span class="token punctuation">.</span><span class="token function">getMaxOffsetInQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>maxOffset <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">NO_MESSAGE_IN_QUEUE</span><span class="token punctuation">;</span>
                nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> minOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">OFFSET_TOO_SMALL</span><span class="token punctuation">;</span>
                nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> minOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">==</span> maxOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">OFFSET_OVERFLOW_ONE</span><span class="token punctuation">;</span>
                nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">></span> maxOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">OFFSET_OVERFLOW_BADLY</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> minOffset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> minOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> maxOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">SelectMappedBufferResult</span> bufferConsumeQueue <span class="token operator">=</span> consumeQueue<span class="token punctuation">.</span><span class="token function">getIndexBuffer</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>bufferConsumeQueue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">NO_MATCHED_MESSAGE</span><span class="token punctuation">;</span>

                        <span class="token keyword">long</span> nextPhyFileStartOffset <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span><span class="token punctuation">;</span>
                        <span class="token keyword">long</span> maxPhyOffsetPulling <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">final</span> <span class="token keyword">int</span> maxFilterMessageCount <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">16000</span><span class="token punctuation">,</span> maxMsgNums <span class="token operator">*</span> <span class="token class-name">ConsumeQueue</span><span class="token punctuation">.</span><span class="token constant">CQ_STORE_UNIT_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">final</span> <span class="token keyword">boolean</span> diskFallRecorded <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageStoreConfig<span class="token punctuation">.</span><span class="token function">isDiskFallRecorded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">ConsumeQueueExt<span class="token punctuation">.</span>CqExtUnit</span> cqExtUnit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsumeQueueExt<span class="token punctuation">.</span>CqExtUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bufferConsumeQueue<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> maxFilterMessageCount<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token class-name">ConsumeQueue</span><span class="token punctuation">.</span><span class="token constant">CQ_STORE_UNIT_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">long</span> offsetPy <span class="token operator">=</span> bufferConsumeQueue<span class="token punctuation">.</span><span class="token function">getByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">int</span> sizePy <span class="token operator">=</span> bufferConsumeQueue<span class="token punctuation">.</span><span class="token function">getByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">long</span> tagsCode <span class="token operator">=</span> bufferConsumeQueue<span class="token punctuation">.</span><span class="token function">getByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            maxPhyOffsetPulling <span class="token operator">=</span> offsetPy<span class="token punctuation">;</span>

                            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextPhyFileStartOffset <span class="token operator">!=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>offsetPy <span class="token operator">&lt;</span> nextPhyFileStartOffset<span class="token punctuation">)</span>
                                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>

                            <span class="token keyword">boolean</span> isInDisk <span class="token operator">=</span> <span class="token function">checkInDiskByCommitOffset</span><span class="token punctuation">(</span>offsetPy<span class="token punctuation">,</span> maxOffsetPy<span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isTheBatchFull</span><span class="token punctuation">(</span>sizePy<span class="token punctuation">,</span> maxMsgNums<span class="token punctuation">,</span> getResult<span class="token punctuation">.</span><span class="token function">getBufferTotalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> getResult<span class="token punctuation">.</span><span class="token function">getMessageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                isInDisk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>

                            <span class="token keyword">boolean</span> extRet <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isTagsCodeLegal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>consumeQueue<span class="token punctuation">.</span><span class="token function">isExtAddr</span><span class="token punctuation">(</span>tagsCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                extRet <span class="token operator">=</span> consumeQueue<span class="token punctuation">.</span><span class="token function">getExt</span><span class="token punctuation">(</span>tagsCode<span class="token punctuation">,</span> cqExtUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>extRet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                    tagsCode <span class="token operator">=</span> cqExtUnit<span class="token punctuation">.</span><span class="token function">getTagsCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                    <span class="token comment">// can't find ext content.Client will filter messages by tag also.</span>
                                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[BUG] can't find consume queue extend file content!addr=&#123;&#125;, offsetPy=&#123;&#125;, sizePy=&#123;&#125;, topic=&#123;&#125;, group=&#123;&#125;"</span><span class="token punctuation">,</span>
                                        tagsCode<span class="token punctuation">,</span> offsetPy<span class="token punctuation">,</span> sizePy<span class="token punctuation">,</span> topic<span class="token punctuation">,</span> group<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    isTagsCodeLegal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span>
                            <span class="token punctuation">&#125;</span>
                            <span class="token comment">// è¿™é‡Œæ˜¯messageFilteræ ¹æ®æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„tagå€¼è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­çš„tagä¸messageFileterä¸­ä¸åŒ¹é…åˆ™è·³è¿‡è¯¥æ¶ˆæ¯</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>messageFilter <span class="token operator">!=</span> <span class="token keyword">null</span>
                                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>messageFilter<span class="token punctuation">.</span><span class="token function">isMatchedByConsumeQueue</span><span class="token punctuation">(</span>isTagsCodeLegal <span class="token operator">?</span> tagsCode <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> extRet <span class="token operator">?</span> cqExtUnit <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>getResult<span class="token punctuation">.</span><span class="token function">getBufferTotalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                    status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">NO_MATCHED_MESSAGE</span><span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span>

                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>

                            <span class="token class-name">SelectMappedBufferResult</span> selectResult <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commitLog<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>offsetPy<span class="token punctuation">,</span> sizePy<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> selectResult<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>getResult<span class="token punctuation">.</span><span class="token function">getBufferTotalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                    status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_WAS_REMOVING</span><span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span>

                                nextPhyFileStartOffset <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>commitLog<span class="token punctuation">.</span><span class="token function">rollNextFile</span><span class="token punctuation">(</span>offsetPy<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>

                            <span class="token keyword">if</span> <span class="token punctuation">(</span>messageFilter <span class="token operator">!=</span> <span class="token keyword">null</span>
                                <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>messageFilter<span class="token punctuation">.</span><span class="token function">isMatchedByCommitLog</span><span class="token punctuation">(</span>selectResult<span class="token punctuation">.</span><span class="token function">getByteBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>getResult<span class="token punctuation">.</span><span class="token function">getBufferTotalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                    status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">NO_MATCHED_MESSAGE</span><span class="token punctuation">;</span>
                                <span class="token punctuation">&#125;</span>
                                <span class="token comment">// release...</span>
                                selectResult<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>

                            <span class="token keyword">this</span><span class="token punctuation">.</span>storeStatsService<span class="token punctuation">.</span><span class="token function">getGetMessageTransferedMsgCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            getResult<span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>selectResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">FOUND</span><span class="token punctuation">;</span>
                            nextPhyFileStartOffset <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>diskFallRecorded<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">long</span> fallBehind <span class="token operator">=</span> maxOffsetPy <span class="token operator">-</span> maxPhyOffsetPulling<span class="token punctuation">;</span>
                            brokerStatsManager<span class="token punctuation">.</span><span class="token function">recordDiskFallBehindSize</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> topic<span class="token punctuation">,</span> queueId<span class="token punctuation">,</span> fallBehind<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>

                        nextBeginOffset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token class-name">ConsumeQueue</span><span class="token punctuation">.</span><span class="token constant">CQ_STORE_UNIT_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">long</span> diff <span class="token operator">=</span> maxOffsetPy <span class="token operator">-</span> maxPhyOffsetPulling<span class="token punctuation">;</span>
                        <span class="token keyword">long</span> memory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">StoreUtil</span><span class="token punctuation">.</span><span class="token constant">TOTAL_PHYSICAL_MEMORY_SIZE</span>
                            <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageStoreConfig<span class="token punctuation">.</span><span class="token function">getAccessMessageInMemoryMaxRatio</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        getResult<span class="token punctuation">.</span><span class="token function">setSuggestPullingFromSlave</span><span class="token punctuation">(</span>diff <span class="token operator">></span> memory<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>

                        bufferConsumeQueue<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">OFFSET_FOUND_NULL</span><span class="token punctuation">;</span>
                    nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> consumeQueue<span class="token punctuation">.</span><span class="token function">rollNextFile</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"consumer request topic: "</span> <span class="token operator">+</span> topic <span class="token operator">+</span> <span class="token string">"offset: "</span> <span class="token operator">+</span> offset <span class="token operator">+</span> <span class="token string">" minOffset: "</span> <span class="token operator">+</span> minOffset <span class="token operator">+</span> <span class="token string">" maxOffset: "</span>
                        <span class="token operator">+</span> maxOffset <span class="token operator">+</span> <span class="token string">", but access logic queue failed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            status <span class="token operator">=</span> <span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">NO_MATCHED_LOGIC_QUEUE</span><span class="token punctuation">;</span>
            nextBeginOffset <span class="token operator">=</span> <span class="token function">nextOffsetCorrection</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">GetMessageStatus</span><span class="token punctuation">.</span><span class="token constant">FOUND</span> <span class="token operator">==</span> status<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>storeStatsService<span class="token punctuation">.</span><span class="token function">getGetMessageTimesTotalFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>storeStatsService<span class="token punctuation">.</span><span class="token function">getGetMessageTimesTotalMiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">long</span> elapsedTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSystemClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginTime<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>storeStatsService<span class="token punctuation">.</span><span class="token function">setGetMessageEntireTimeMax</span><span class="token punctuation">(</span>elapsedTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

        getResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
        getResult<span class="token punctuation">.</span><span class="token function">setNextBeginOffset</span><span class="token punctuation">(</span>nextBeginOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        getResult<span class="token punctuation">.</span><span class="token function">setMaxOffset</span><span class="token punctuation">(</span>maxOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        getResult<span class="token punctuation">.</span><span class="token function">setMinOffset</span><span class="token punctuation">(</span>minOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> getResult<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ¶ˆæ¯è¿‡æ»¤å™¨TAGåŒ¹é…æºç "><a href="#æ¶ˆæ¯è¿‡æ»¤å™¨TAGåŒ¹é…æºç " class="headerlink" title="æ¶ˆæ¯è¿‡æ»¤å™¨TAGåŒ¹é…æºç "></a>æ¶ˆæ¯è¿‡æ»¤å™¨TAGåŒ¹é…æºç </h4><p><code>messageFilter.isMatchedByConsumeQueue</code>çš„ä»£ç å®ç°.<br>æ ¹æ®ä»£ç è¿™é‡Œæ˜¯æ ¹æ®messageFilterä¸­çš„subscriptionDataçš„è®¢é˜…TAGè¿›è¡ŒåŒ¹é…ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isMatchedByConsumeQueue</span><span class="token punctuation">(</span><span class="token class-name">Long</span> tagsCode<span class="token punctuation">,</span> <span class="token class-name">ConsumeQueueExt<span class="token punctuation">.</span>CqExtUnit</span> cqExtUnit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> subscriptionData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">isClassFilterMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// by tags code.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ExpressionType</span><span class="token punctuation">.</span><span class="token function">isTagType</span><span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>tagsCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">getSubString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">SubscriptionData</span><span class="token punctuation">.</span><span class="token constant">SUB_ALL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token comment">// æ ¹æ®subscriptionDataä¸­çš„è®¢é˜…tagåˆ¤æ–­æ˜¯å¦åŒ¹é…</span>
            <span class="token keyword">return</span> subscriptionData<span class="token punctuation">.</span><span class="token function">getCodeSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>tagsCode<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// no expression or no bloom</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>consumerFilterData <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> consumerFilterData<span class="token punctuation">.</span><span class="token function">getExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span>
                <span class="token operator">||</span> consumerFilterData<span class="token punctuation">.</span><span class="token function">getCompiledExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> consumerFilterData<span class="token punctuation">.</span><span class="token function">getBloomFilterData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token comment">// message is before consumer</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cqExtUnit <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>consumerFilterData<span class="token punctuation">.</span><span class="token function">isMsgInLive</span><span class="token punctuation">(</span>cqExtUnit<span class="token punctuation">.</span><span class="token function">getMsgStoreTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Pull matched because not in live: &#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> consumerFilterData<span class="token punctuation">,</span> cqExtUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> filterBitMap <span class="token operator">=</span> cqExtUnit<span class="token punctuation">.</span><span class="token function">getFilterBitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BloomFilter</span> bloomFilter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>consumerFilterManager<span class="token punctuation">.</span><span class="token function">getBloomFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>filterBitMap <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>bloomDataValid
                <span class="token operator">||</span> filterBitMap<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token class-name">Byte</span><span class="token punctuation">.</span><span class="token constant">SIZE</span> <span class="token operator">!=</span> consumerFilterData<span class="token punctuation">.</span><span class="token function">getBloomFilterData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBitNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token class-name">BitsArray</span> bitsArray <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                bitsArray <span class="token operator">=</span> <span class="token class-name">BitsArray</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>filterBitMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> ret <span class="token operator">=</span> bloomFilter<span class="token punctuation">.</span><span class="token function">isHit</span><span class="token punctuation">(</span>consumerFilterData<span class="token punctuation">.</span><span class="token function">getBloomFilterData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bitsArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Pull &#123;&#125; by bit map:&#123;&#125;, &#123;&#125;, &#123;&#125;"</span><span class="token punctuation">,</span> ret<span class="token punctuation">,</span> consumerFilterData<span class="token punctuation">,</span> bitsArray<span class="token punctuation">,</span> cqExtUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"bloom filter error, sub="</span> <span class="token operator">+</span> subscriptionData
                    <span class="token operator">+</span> <span class="token string">", filter="</span> <span class="token operator">+</span> consumerFilterData <span class="token operator">+</span> <span class="token string">", bitMap="</span> <span class="token operator">+</span> bitsArray<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="æ¶ˆæ¯è¿‡æ»¤å™¨ä¸­è®¢é˜…æ•°æ®æ¥æº"><a href="#æ¶ˆæ¯è¿‡æ»¤å™¨ä¸­è®¢é˜…æ•°æ®æ¥æº" class="headerlink" title="æ¶ˆæ¯è¿‡æ»¤å™¨ä¸­è®¢é˜…æ•°æ®æ¥æº"></a>æ¶ˆæ¯è¿‡æ»¤å™¨ä¸­è®¢é˜…æ•°æ®æ¥æº</h4><p><code>PullMessageProcessor.java</code>ä¸­çš„Consumerè®¢é˜…æ•°æ®</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">RemotingCommand</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token class-name">RemotingCommand</span> request<span class="token punctuation">,</span> <span class="token keyword">boolean</span> brokerAllowSuspend<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">RemotingCommandException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">RemotingCommand</span> response <span class="token operator">=</span> <span class="token class-name">RemotingCommand</span><span class="token punctuation">.</span><span class="token function">createResponseCommand</span><span class="token punctuation">(</span><span class="token class-name">PullMessageResponseHeader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">PullMessageResponseHeader</span> responseHeader <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PullMessageResponseHeader</span><span class="token punctuation">)</span> response<span class="token punctuation">.</span><span class="token function">readCustomHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">PullMessageRequestHeader</span> requestHeader <span class="token operator">=</span>
            <span class="token punctuation">(</span><span class="token class-name">PullMessageRequestHeader</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">decodeCommandCustomHeader</span><span class="token punctuation">(</span><span class="token class-name">PullMessageRequestHeader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        response<span class="token punctuation">.</span><span class="token function">setOpaque</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getOpaque</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"receive PullMessage request command, &#123;&#125;"</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ­¤å¤„ç•¥å»éƒ¨åˆ†ä»£ç </span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> hasSuspendFlag <span class="token operator">=</span> <span class="token class-name">PullSysFlag</span><span class="token punctuation">.</span><span class="token function">hasSuspendFlag</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getSysFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> hasCommitOffsetFlag <span class="token operator">=</span> <span class="token class-name">PullSysFlag</span><span class="token punctuation">.</span><span class="token function">hasCommitOffsetFlag</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getSysFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> hasSubscriptionFlag <span class="token operator">=</span> <span class="token class-name">PullSysFlag</span><span class="token punctuation">.</span><span class="token function">hasSubscriptionFlag</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getSysFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token keyword">long</span> suspendTimeoutMillisLong <span class="token operator">=</span> hasSuspendFlag <span class="token operator">?</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSuspendTimeoutMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token class-name">TopicConfig</span> topicConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getTopicConfigManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">selectTopicConfig</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> topicConfig<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"the topic &#123;&#125; not exist, consumer: &#123;&#125;"</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">RemotingHelper</span><span class="token punctuation">.</span><span class="token function">parseChannelRemoteAddr</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">TOPIC_NOT_EXIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"topic[%s] not exist, apply first please! %s"</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">FAQUrl</span><span class="token punctuation">.</span><span class="token function">suggestTodo</span><span class="token punctuation">(</span><span class="token class-name">FAQUrl</span><span class="token punctuation">.</span><span class="token constant">APPLY_TOPIC_URL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">PermName</span><span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span>topicConfig<span class="token punctuation">.</span><span class="token function">getPerm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">NO_PERMISSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"the topic["</span> <span class="token operator">+</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] pulling message is forbidden"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> topicConfig<span class="token punctuation">.</span><span class="token function">getReadQueueNums</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> errorInfo <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"queueId[%d] is illegal, topic:[%s] topicConfig.readQueueNums:[%d] consumer:[%s]"</span><span class="token punctuation">,</span>
                requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> topicConfig<span class="token punctuation">.</span><span class="token function">getReadQueueNums</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> channel<span class="token punctuation">.</span><span class="token function">remoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SYSTEM_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">SubscriptionData</span> subscriptionData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ConsumerFilterData</span> consumerFilterData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasSubscriptionFlag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                subscriptionData <span class="token operator">=</span> <span class="token class-name">FilterAPI</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>
                    requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ExpressionType</span><span class="token punctuation">.</span><span class="token function">isTagType</span><span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    consumerFilterData <span class="token operator">=</span> <span class="token class-name">ConsumerFilterManager</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>
                        requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        requestHeader<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">assert</span> consumerFilterData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Parse the consumer's subscription[&#123;&#125;] failed, group: &#123;&#125;"</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SUBSCRIPTION_PARSE_FAILED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"parse the consumer's subscription failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> response<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ConsumerGroupInfo</span> consumerGroupInfo <span class="token operator">=</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getConsumerManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConsumerGroupInfo</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ­¤å¤„ç•¥å»éƒ¨åˆ†å«è¯­å¥åˆ¤æ–­</span>
            
            <span class="token comment">// è¿™é‡Œä»subscriptionTableè·å–åˆ°äº†subscriptionData</span>
            subscriptionData <span class="token operator">=</span> consumerGroupInfo<span class="token punctuation">.</span><span class="token function">findSubscriptionData</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> subscriptionData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"the consumer's subscription not exist, group: &#123;&#125;, topic:&#123;&#125;"</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SUBSCRIPTION_NOT_EXIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"the consumer's subscription not exist"</span> <span class="token operator">+</span> <span class="token class-name">FAQUrl</span><span class="token punctuation">.</span><span class="token function">suggestTodo</span><span class="token punctuation">(</span><span class="token class-name">FAQUrl</span><span class="token punctuation">.</span><span class="token constant">SAME_GROUP_DIFFERENT_TOPIC</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> response<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"The broker's subscription is not latest, group: &#123;&#125; &#123;&#125;"</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    subscriptionData<span class="token punctuation">.</span><span class="token function">getSubString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SUBSCRIPTION_NOT_LATEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"the consumer's subscription not latest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> response<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ExpressionType</span><span class="token punctuation">.</span><span class="token function">isTagType</span><span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                consumerFilterData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getConsumerFilterManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>consumerFilterData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">FILTER_DATA_NOT_EXIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"The broker's consumer filter data is not exist!Your expression may be wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>consumerFilterData<span class="token punctuation">.</span><span class="token function">getClientVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"The broker's consumer filter data is not latest, group: &#123;&#125;, topic: &#123;&#125;, serverV: &#123;&#125;, clientV: &#123;&#125;"</span><span class="token punctuation">,</span>
                        requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> consumerFilterData<span class="token punctuation">.</span><span class="token function">getClientVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">FILTER_DATA_NOT_LATEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"the consumer's consumer filter data not latest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ExpressionType</span><span class="token punctuation">.</span><span class="token function">isTagType</span><span class="token punctuation">(</span>subscriptionData<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getBrokerConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEnablePropertyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            response<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ResponseCode</span><span class="token punctuation">.</span><span class="token constant">SYSTEM_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"The broker does not support consumer to filter message by "</span> <span class="token operator">+</span> subscriptionData<span class="token punctuation">.</span><span class="token function">getExpressionType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">MessageFilter</span> messageFilter<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getBrokerConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFilterSupportRetry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            messageFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExpressionForRetryMessageFilter</span><span class="token punctuation">(</span>subscriptionData<span class="token punctuation">,</span> consumerFilterData<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getConsumerFilterManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            messageFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExpressionMessageFilter</span><span class="token punctuation">(</span>subscriptionData<span class="token punctuation">,</span> consumerFilterData<span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getConsumerFilterManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">final</span> <span class="token class-name">GetMessageResult</span> getMessageResult <span class="token operator">=</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>brokerController<span class="token punctuation">.</span><span class="token function">getMessageStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>requestHeader<span class="token punctuation">.</span><span class="token function">getConsumerGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                requestHeader<span class="token punctuation">.</span><span class="token function">getQueueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getQueueOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestHeader<span class="token punctuation">.</span><span class="token function">getMaxMsgNums</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> messageFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ­¤å¤„ç•¥å»åç»­å¤„ç†çš„ç›¸å…³ä»£ç </span>
        <span class="token keyword">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Consumerè®¢é˜…æ•°æ®æ›´æ–°"><a href="#Consumerè®¢é˜…æ•°æ®æ›´æ–°" class="headerlink" title="Consumerè®¢é˜…æ•°æ®æ›´æ–°"></a>Consumerè®¢é˜…æ•°æ®æ›´æ–°</h4><p><code>ConsumerGroupInfo.java</code> </p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateSubscription</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SubscriptionData</span><span class="token punctuation">></span></span> subList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">boolean</span> updated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubscriptionData</span> sub <span class="token operator">:</span> subList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Consumerè®¢é˜…æ–°çš„Topicåï¼Œæ›´æ–°è®¢é˜…å…³ç³»</span>
            <span class="token class-name">SubscriptionData</span> old <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscriptionTable<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sub<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>old <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">SubscriptionData</span> prev <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscriptionTable<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>sub<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> prev<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    updated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"subscription changed, add new topic, group: &#123;&#125; &#123;&#125;"</span><span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>groupName<span class="token punctuation">,</span>
                        sub<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sub<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> old<span class="token punctuation">.</span><span class="token function">getSubVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>consumeType <span class="token operator">==</span> <span class="token class-name">ConsumeType</span><span class="token punctuation">.</span><span class="token constant">CONSUME_PASSIVELY</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"subscription changed, group: &#123;&#125; OLD: &#123;&#125; NEW: &#123;&#125;"</span><span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>groupName<span class="token punctuation">,</span>
                        old<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        sub<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">/**
                 * å½“Consumerçš„subVersionå¤§äºBrokerä¸­çš„subVersionæ—¶ï¼Œåˆ™æ›´æ–°è®¢é˜…ä¿¡æ¯
                 * è¿™é‡Œold.getSubVersion()å³ä¸ºæœ€åæ¶ˆè´¹è€…ç»„å†…æœ€åä¸€ä¸ªæ¶ˆè´¹è€…çš„å¯åŠ¨æ—¶é—´
                 * åªæœ‰å½“æœ‰æ–°çš„æ¶ˆè´¹è€…å¯åŠ¨ï¼Œæˆ–è€…æ¶ˆè´¹è€…è¿›è¡Œäº†é‡æ–°è´Ÿè½½ï¼Œè®¢é˜…å…³ç³»æ‰ä¼šè¢«æ›´æ–°
                 */</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>subscriptionTable<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>sub<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SubscriptionData</span><span class="token punctuation">></span><span class="token punctuation">></span></span> it <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subscriptionTable<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SubscriptionData</span><span class="token punctuation">></span></span> next <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> oldTopic <span class="token operator">=</span> next<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">boolean</span> exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SubscriptionData</span> sub <span class="token operator">:</span> subList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sub<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>oldTopic<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    exist <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>exist<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"subscription changed, group: &#123;&#125; remove topic &#123;&#125; &#123;&#125;"</span><span class="token punctuation">,</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>groupName<span class="token punctuation">,</span>
                    oldTopic<span class="token punctuation">,</span>
                    next<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                updated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>lastUpdateTimestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> updated<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Brokeråœ¨è·å–æ¶ˆæ¯æ—¶ä¼šæ ¹æ®subscriptionTableä¸­å¯¹åº”çš„æ¶ˆè´¹è€…ç»„çš„è®¢é˜…Tagè¿›è¡Œæ¶ˆæ¯è¿‡æ»¤ï¼ŒåŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…ï¼ŒBrokerä¸­ä¿å­˜äº†æœ€åå¯åŠ¨çš„Consumerçš„è®¢é˜…ä¿¡æ¯ï¼Œåç»­åªæœ‰å½“æ–°çš„æ¶ˆè´¹è€…æ·»åŠ è¿›æ¥æˆ–è€…æ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…è¿›è¡Œäº†é‡æ–°è´Ÿè½½å‡è¡¡ï¼ˆé‡æ–°è´Ÿè½½çš„å¯èƒ½åŸå› ï¼šæ¶ˆè´¹è€…æ–°å¢æˆ–ç§»é™¤ã€é˜Ÿåˆ—æ•°é‡å˜æ›´ï¼‰ï¼Œè®¢é˜…ä¿¡æ¯æ‰ä¼šè¢«æ›´æ–°ã€‚</p>
]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
        <tag>Consumer</tag>
        <tag>ConsumerGroup</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQä¸­MmapåŸç†åˆ†æåŠä½¿ç”¨</title>
    <url>/2020/10/29/rockermq/rocketmq-zhong-mmap-yuan-li-fen-xi-ji-shi-yong/</url>
    <content><![CDATA[<h1 id="ä¸€ã€MmapåŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€MmapåŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€MmapåŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€MmapåŸºç¡€æ¦‚å¿µ</h1><p>Mmapæ˜¯ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹æ³•ï¼Œå³å°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹æ˜ å…³ç³»ã€‚å®ç°è¿™æ ·çš„æ˜ å°„å…³ç³»åï¼Œè¿›ç¨‹å°±å¯ä»¥é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼è¯»å†™æ“ä½œè¿™ä¸€æ®µå†…å­˜ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”çš„æ–‡ä»¶ç£ç›˜ä¸Šï¼Œå³å®Œæˆäº†å¯¹æ–‡ä»¶çš„æ“ä½œè€Œä¸å¿…å†è°ƒç”¨read,writeç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ç›¸åï¼Œå†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿç›´æ¥åæ˜ ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œå¯ä»¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„æ–‡ä»¶å…±äº«ã€‚</p>
<h1 id="äºŒã€Mmapå†…å­˜æ˜ å°„åŸç†"><a href="#äºŒã€Mmapå†…å­˜æ˜ å°„åŸç†" class="headerlink" title="äºŒã€Mmapå†…å­˜æ˜ å°„åŸç†"></a>äºŒã€Mmapå†…å­˜æ˜ å°„åŸç†</h1><p><img src="/2020/10/29/rockermq/rocketmq-zhong-mmap-yuan-li-fen-xi-ji-shi-yong/Linux%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84mmap.png" alt="mmapå†…å­˜æ˜ å°„"></p>
<blockquote>
<p>mmapå†…å­˜æ˜ å°„çš„å®ç°è¿‡ç¨‹ï¼Œæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
</blockquote>
<h2 id="ï¼ˆä¸€ï¼‰è¿›ç¨‹å¯åŠ¨æ˜ å°„è¿‡ç¨‹ï¼Œå¹¶åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºæ˜ å°„åˆ›å»ºè™šæ‹Ÿæ˜ å°„åŒºåŸŸ"><a href="#ï¼ˆä¸€ï¼‰è¿›ç¨‹å¯åŠ¨æ˜ å°„è¿‡ç¨‹ï¼Œå¹¶åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºæ˜ å°„åˆ›å»ºè™šæ‹Ÿæ˜ å°„åŒºåŸŸ" class="headerlink" title="ï¼ˆä¸€ï¼‰è¿›ç¨‹å¯åŠ¨æ˜ å°„è¿‡ç¨‹ï¼Œå¹¶åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºæ˜ å°„åˆ›å»ºè™šæ‹Ÿæ˜ å°„åŒºåŸŸ"></a>ï¼ˆä¸€ï¼‰è¿›ç¨‹å¯åŠ¨æ˜ å°„è¿‡ç¨‹ï¼Œå¹¶åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸ºæ˜ å°„åˆ›å»ºè™šæ‹Ÿæ˜ å°„åŒºåŸŸ</h2><blockquote>
<p>1ã€è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è°ƒç”¨åº“å‡½æ•°mmapï¼ŒåŸå‹ï¼švoid *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset);</p>
<p>2ã€åœ¨å½“å‰è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¯»æ‰¾ä¸€æ®µç©ºé—²çš„æ»¡è¶³è¦æ±‚çš„è¿ç»­çš„è™šæ‹Ÿåœ°å€</p>
<p>3ã€ä¸ºæ­¤è™šæ‹ŸåŒºåˆ†é…ä¸€ä¸ªvm_area_structç»“æ„ï¼Œæ¥ç€å¯¹è¿™ä¸ªç»“æ„çš„å„ä¸ªåŸŸè¿›è¡Œäº†åˆå§‹åŒ–</p>
<p>4ã€å°†æ–°å»ºçš„è™šæ‹ŸåŒºç»“æ„ï¼ˆvm_area_structï¼‰æ’å…¥è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€åŒºåŸŸé“¾è¡¨æˆ–æ ‘ä¸­</p>
</blockquote>
<h2 id="ï¼ˆäºŒï¼‰è°ƒç”¨å†…æ ¸ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°mmapï¼ˆä¸åŒäºç”¨æˆ·ç©ºé—´å‡½æ•°ï¼‰ï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„å…³ç³»"><a href="#ï¼ˆäºŒï¼‰è°ƒç”¨å†…æ ¸ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°mmapï¼ˆä¸åŒäºç”¨æˆ·ç©ºé—´å‡½æ•°ï¼‰ï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„å…³ç³»" class="headerlink" title="ï¼ˆäºŒï¼‰è°ƒç”¨å†…æ ¸ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°mmapï¼ˆä¸åŒäºç”¨æˆ·ç©ºé—´å‡½æ•°ï¼‰ï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„å…³ç³»"></a>ï¼ˆäºŒï¼‰è°ƒç”¨å†…æ ¸ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°mmapï¼ˆä¸åŒäºç”¨æˆ·ç©ºé—´å‡½æ•°ï¼‰ï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„å…³ç³»</h2><blockquote>
<p>5ã€ä¸ºæ˜ å°„åˆ†é…äº†æ–°çš„è™šæ‹Ÿåœ°å€åŒºåŸŸåï¼Œé€šè¿‡å¾…æ˜ å°„çš„æ–‡ä»¶æŒ‡é’ˆï¼Œåœ¨æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ï¼Œé“¾æ¥åˆ°å†…æ ¸â€œå·²æ‰“å¼€æ–‡ä»¶é›†â€ä¸­è¯¥æ–‡ä»¶çš„æ–‡ä»¶ç»“æ„ä½“ï¼ˆstruct fileï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶ç»“æ„ä½“ç»´æŠ¤ç€å’Œè¿™ä¸ªå·²æ‰“å¼€æ–‡ä»¶ç›¸å…³å„é¡¹ä¿¡æ¯ã€‚</p>
<p>6ã€é€šè¿‡è¯¥æ–‡ä»¶çš„æ–‡ä»¶ç»“æ„ä½“ï¼Œé“¾æ¥åˆ°file_operationsæ¨¡å—ï¼Œè°ƒç”¨å†…æ ¸å‡½æ•°mmapï¼Œå…¶åŸå‹ä¸ºï¼šint mmap(struct file *filp, struct vm_area_struct *vma)ï¼Œä¸åŒäºç”¨æˆ·ç©ºé—´åº“å‡½æ•°ã€‚</p>
<p>7ã€å†…æ ¸mmapå‡½æ•°é€šè¿‡è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿinodeæ¨¡å—å®šä½åˆ°æ–‡ä»¶ç£ç›˜ç‰©ç†åœ°å€ã€‚</p>
<p>8ã€é€šè¿‡remap_pfn_rangeå‡½æ•°å»ºç«‹é¡µè¡¨ï¼Œå³å®ç°äº†æ–‡ä»¶åœ°å€å’Œè™šæ‹Ÿåœ°å€åŒºåŸŸçš„æ˜ å°„å…³ç³»ã€‚æ­¤æ—¶ï¼Œè¿™ç‰‡è™šæ‹Ÿåœ°å€å¹¶æ²¡æœ‰ä»»ä½•æ•°æ®å…³è”åˆ°ä¸»å­˜ä¸­ã€‚</p>
</blockquote>
<h2 id="ï¼ˆä¸‰ï¼‰è¿›ç¨‹å‘èµ·å¯¹è¿™ç‰‡æ˜ å°„ç©ºé—´çš„è®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ï¼ˆä¸»å­˜ï¼‰çš„æ‹·è´"><a href="#ï¼ˆä¸‰ï¼‰è¿›ç¨‹å‘èµ·å¯¹è¿™ç‰‡æ˜ å°„ç©ºé—´çš„è®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ï¼ˆä¸»å­˜ï¼‰çš„æ‹·è´" class="headerlink" title="ï¼ˆä¸‰ï¼‰è¿›ç¨‹å‘èµ·å¯¹è¿™ç‰‡æ˜ å°„ç©ºé—´çš„è®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ï¼ˆä¸»å­˜ï¼‰çš„æ‹·è´"></a>ï¼ˆä¸‰ï¼‰è¿›ç¨‹å‘èµ·å¯¹è¿™ç‰‡æ˜ å°„ç©ºé—´çš„è®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ï¼ˆä¸»å­˜ï¼‰çš„æ‹·è´</h2><blockquote>
<p>æ³¨ï¼šå‰ä¸¤ä¸ªé˜¶æ®µä»…åœ¨äºåˆ›å»ºè™šæ‹ŸåŒºé—´å¹¶å®Œæˆåœ°å€æ˜ å°„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å°†ä»»ä½•æ–‡ä»¶æ•°æ®çš„æ‹·è´è‡³ä¸»å­˜ã€‚çœŸæ­£çš„æ–‡ä»¶è¯»å–æ˜¯å½“è¿›ç¨‹å‘èµ·è¯»æˆ–å†™æ“ä½œæ—¶ã€‚</p>
<p>9ã€è¿›ç¨‹çš„è¯»æˆ–å†™æ“ä½œè®¿é—®è™šæ‹Ÿåœ°å€ç©ºé—´è¿™ä¸€æ®µæ˜ å°„åœ°å€ï¼Œé€šè¿‡æŸ¥è¯¢é¡µè¡¨ï¼Œå‘ç°è¿™ä¸€æ®µåœ°å€å¹¶ä¸åœ¨ç‰©ç†é¡µé¢ä¸Šã€‚å› ä¸ºç›®å‰åªå»ºç«‹äº†åœ°å€æ˜ å°„ï¼ŒçœŸæ­£çš„ç¡¬ç›˜æ•°æ®è¿˜æ²¡æœ‰æ‹·è´åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤å¼•å‘ç¼ºé¡µå¼‚å¸¸ã€‚</p>
<p>10ã€ç¼ºé¡µå¼‚å¸¸è¿›è¡Œä¸€ç³»åˆ—åˆ¤æ–­ï¼Œç¡®å®šæ— éæ³•æ“ä½œåï¼Œå†…æ ¸å‘èµ·è¯·æ±‚è°ƒé¡µè¿‡ç¨‹ã€‚</p>
<p>11ã€è°ƒé¡µè¿‡ç¨‹å…ˆåœ¨äº¤æ¢ç¼“å­˜ç©ºé—´ï¼ˆswap cacheï¼‰ä¸­å¯»æ‰¾éœ€è¦è®¿é—®çš„å†…å­˜é¡µï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨nopageå‡½æ•°æŠŠæ‰€ç¼ºçš„é¡µä»ç£ç›˜è£…å…¥åˆ°ä¸»å­˜ä¸­ã€‚</p>
<p>12ã€ä¹‹åè¿›ç¨‹å³å¯å¯¹è¿™ç‰‡ä¸»å­˜è¿›è¡Œè¯»æˆ–è€…å†™çš„æ“ä½œï¼Œå¦‚æœå†™æ“ä½œæ”¹å˜äº†å…¶å†…å®¹ï¼Œä¸€å®šæ—¶é—´åç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”ç£ç›˜åœ°å€ï¼Œä¹Ÿå³å®Œæˆäº†å†™å…¥åˆ°æ–‡ä»¶çš„è¿‡ç¨‹ã€‚</p>
<p>æ³¨ï¼šä¿®æ”¹è¿‡çš„è„é¡µé¢å¹¶ä¸ä¼šç«‹å³æ›´æ–°å›æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æœ‰ä¸€æ®µæ—¶é—´çš„å»¶è¿Ÿï¼Œå¯ä»¥è°ƒç”¨msync()æ¥å¼ºåˆ¶åŒæ­¥, è¿™æ ·æ‰€å†™çš„å†…å®¹å°±èƒ½ç«‹å³ä¿å­˜åˆ°æ–‡ä»¶é‡Œäº†ã€‚</p>
</blockquote>
<h1 id="ä¸‰ã€Mmapæ–¹å¼å’Œå¸¸è§„æ–‡ä»¶æ“ä½œåŒºåˆ«"><a href="#ä¸‰ã€Mmapæ–¹å¼å’Œå¸¸è§„æ–‡ä»¶æ“ä½œåŒºåˆ«" class="headerlink" title="ä¸‰ã€Mmapæ–¹å¼å’Œå¸¸è§„æ–‡ä»¶æ“ä½œåŒºåˆ«"></a>ä¸‰ã€Mmapæ–¹å¼å’Œå¸¸è§„æ–‡ä»¶æ“ä½œåŒºåˆ«</h1><p>å¸¸è§„æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆè°ƒç”¨read&#x2F;freadç­‰ç±»å‡½æ•°ï¼‰ä¸­ï¼Œå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼š</p>
<p>1ã€è¿›ç¨‹å‘èµ·è¯»æ–‡ä»¶è¯·æ±‚ã€‚</p>
<p>2ã€å†…æ ¸é€šè¿‡æŸ¥æ‰¾è¿›ç¨‹æ–‡ä»¶ç¬¦è¡¨ï¼Œå®šä½åˆ°å†…æ ¸å·²æ‰“å¼€æ–‡ä»¶é›†ä¸Šçš„æ–‡ä»¶ä¿¡æ¯ï¼Œä»è€Œæ‰¾åˆ°æ­¤æ–‡ä»¶çš„inodeã€‚</p>
<p>3ã€inodeåœ¨address_spaceä¸ŠæŸ¥æ‰¾è¦è¯·æ±‚çš„æ–‡ä»¶é¡µæ˜¯å¦å·²ç»ç¼“å­˜åœ¨é¡µç¼“å­˜ä¸­ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›è¿™ç‰‡æ–‡ä»¶é¡µçš„å†…å®¹ã€‚</p>
<p>4ã€å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡inodeå®šä½åˆ°æ–‡ä»¶ç£ç›˜åœ°å€ï¼Œå°†æ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°é¡µç¼“å­˜ã€‚ä¹‹åå†æ¬¡å‘èµ·è¯»é¡µé¢è¿‡ç¨‹ï¼Œè¿›è€Œå°†é¡µç¼“å­˜ä¸­çš„æ•°æ®å‘ç»™ç”¨æˆ·è¿›ç¨‹ã€‚</p>
<blockquote>
<p>æ€»ç»“æ¥è¯´ï¼Œå¸¸è§„æ–‡ä»¶æ“ä½œä¸ºäº†æé«˜è¯»å†™æ•ˆç‡å’Œä¿æŠ¤ç£ç›˜ï¼Œä½¿ç”¨äº†é¡µç¼“å­˜æœºåˆ¶ã€‚è¿™æ ·é€ æˆè¯»æ–‡ä»¶æ—¶éœ€è¦å…ˆå°†æ–‡ä»¶é¡µä»ç£ç›˜æ‹·è´åˆ°é¡µç¼“å­˜ä¸­ï¼Œç”±äºé¡µç¼“å­˜å¤„åœ¨å†…æ ¸ç©ºé—´ï¼Œä¸èƒ½è¢«ç”¨æˆ·è¿›ç¨‹ç›´æ¥å¯»å€ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†é¡µç¼“å­˜ä¸­æ•°æ®é¡µå†æ¬¡æ‹·è´åˆ°å†…å­˜å¯¹åº”çš„ç”¨æˆ·ç©ºé—´ä¸­ã€‚è¿™æ ·ï¼Œé€šè¿‡äº†ä¸¤æ¬¡æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œæ‰èƒ½å®Œæˆè¿›ç¨‹å¯¹æ–‡ä»¶å†…å®¹çš„è·å–ä»»åŠ¡ã€‚å†™æ“ä½œä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¾…å†™å…¥çš„bufferåœ¨å†…æ ¸ç©ºé—´ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œå¿…é¡»è¦å…ˆæ‹·è´è‡³å†…æ ¸ç©ºé—´å¯¹åº”çš„ä¸»å­˜ï¼Œå†å†™å›ç£ç›˜ä¸­ï¼ˆå»¶è¿Ÿå†™å›ï¼‰ï¼Œä¹Ÿæ˜¯éœ€è¦ä¸¤æ¬¡æ•°æ®æ‹·è´ã€‚</p>
<p>è€Œä½¿ç”¨mmapæ“ä½œæ–‡ä»¶ä¸­ï¼Œåˆ›å»ºæ–°çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸå’Œå»ºç«‹æ–‡ä»¶ç£ç›˜åœ°å€å’Œè™šæ‹Ÿå†…å­˜åŒºåŸŸæ˜ å°„è¿™ä¸¤æ­¥ï¼Œæ²¡æœ‰ä»»ä½•æ–‡ä»¶æ‹·è´æ“ä½œã€‚è€Œä¹‹åè®¿é—®æ•°æ®æ—¶å‘ç°å†…å­˜ä¸­å¹¶æ— æ•°æ®è€Œå‘èµ·çš„ç¼ºé¡µå¼‚å¸¸è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡å·²ç»å»ºç«‹å¥½çš„æ˜ å°„å…³ç³»ï¼Œåªä½¿ç”¨ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œå°±ä»ç£ç›˜ä¸­å°†æ•°æ®ä¼ å…¥å†…å­˜çš„ç”¨æˆ·ç©ºé—´ä¸­ï¼Œä¾›è¿›ç¨‹ä½¿ç”¨ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œå¸¸è§„æ–‡ä»¶æ“ä½œéœ€è¦ä»ç£ç›˜åˆ°é¡µç¼“å­˜å†åˆ°ç”¨æˆ·ä¸»å­˜çš„ä¸¤æ¬¡æ•°æ®æ‹·è´ã€‚è€Œmmapæ“æ§æ–‡ä»¶ï¼Œåªéœ€è¦ä»ç£ç›˜åˆ°ç”¨æˆ·ä¸»å­˜çš„ä¸€æ¬¡æ•°æ®æ‹·è´è¿‡ç¨‹ã€‚è¯´ç™½äº†ï¼Œmmapçš„å…³é”®ç‚¹æ˜¯å®ç°äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ•°æ®ç›´æ¥äº¤äº’è€Œçœå»äº†ç©ºé—´ä¸åŒæ•°æ®ä¸é€šçš„ç¹çè¿‡ç¨‹ã€‚å› æ­¤mmapæ•ˆç‡æ›´é«˜ã€‚</p>
</blockquote>
<h1 id="å››ã€Mmapçš„ä¼˜ç‚¹"><a href="#å››ã€Mmapçš„ä¼˜ç‚¹" class="headerlink" title="å››ã€Mmapçš„ä¼˜ç‚¹"></a>å››ã€Mmapçš„ä¼˜ç‚¹</h1><p>ç”±ä¸Šæ–‡è®¨è®ºå¯çŸ¥ï¼Œmmapä¼˜ç‚¹å…±æœ‰ä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<p>1ã€å¯¹æ–‡ä»¶çš„è¯»å–æ“ä½œè·¨è¿‡äº†é¡µç¼“å­˜ï¼Œå‡å°‘äº†æ•°æ®çš„æ‹·è´æ¬¡æ•°ï¼Œç”¨å†…å­˜è¯»å†™å–ä»£I&#x2F;Oè¯»å†™ï¼Œæé«˜äº†æ–‡ä»¶è¯»å–æ•ˆç‡ã€‚</p>
<p>2ã€å®ç°äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„é«˜æ•ˆäº¤äº’æ–¹å¼ã€‚ä¸¤ç©ºé—´çš„å„è‡ªä¿®æ”¹æ“ä½œå¯ä»¥ç›´æ¥åæ˜ åœ¨æ˜ å°„çš„åŒºåŸŸå†…ï¼Œä»è€Œè¢«å¯¹æ–¹ç©ºé—´åŠæ—¶æ•æ‰ã€‚</p>
<p>3ã€æä¾›è¿›ç¨‹é—´å…±äº«å†…å­˜åŠç›¸äº’é€šä¿¡çš„æ–¹å¼ã€‚ä¸ç®¡æ˜¯çˆ¶å­è¿›ç¨‹è¿˜æ˜¯æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œéƒ½å¯ä»¥å°†è‡ªèº«ç”¨æˆ·ç©ºé—´æ˜ å°„åˆ°åŒä¸€ä¸ªæ–‡ä»¶æˆ–åŒ¿åæ˜ å°„åˆ°åŒä¸€ç‰‡åŒºåŸŸã€‚ä»è€Œé€šè¿‡å„è‡ªå¯¹æ˜ å°„åŒºåŸŸçš„æ”¹åŠ¨ï¼Œè¾¾åˆ°è¿›ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´å…±äº«çš„ç›®çš„ã€‚</p>
<p>åŒæ—¶ï¼Œå¦‚æœè¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½æ˜ å°„äº†åŒºåŸŸCï¼Œå½“Aç¬¬ä¸€æ¬¡è¯»å–Cæ—¶é€šè¿‡ç¼ºé¡µä»ç£ç›˜å¤åˆ¶æ–‡ä»¶é¡µåˆ°å†…å­˜ä¸­ï¼›ä½†å½“Bå†è¯»Cçš„ç›¸åŒé¡µé¢æ—¶ï¼Œè™½ç„¶ä¹Ÿä¼šäº§ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œä½†æ˜¯ä¸å†éœ€è¦ä»ç£ç›˜ä¸­å¤åˆ¶æ–‡ä»¶è¿‡æ¥ï¼Œè€Œå¯ç›´æ¥ä½¿ç”¨å·²ç»ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ã€‚</p>
<p>4ã€å¯ç”¨äºå®ç°é«˜æ•ˆçš„å¤§è§„æ¨¡æ•°æ®ä¼ è¾“ã€‚å†…å­˜ç©ºé—´ä¸è¶³ï¼Œæ˜¯åˆ¶çº¦å¤§æ•°æ®æ“ä½œçš„ä¸€ä¸ªæ–¹é¢ï¼Œè§£å†³æ–¹æ¡ˆå¾€å¾€æ˜¯å€ŸåŠ©ç¡¬ç›˜ç©ºé—´ååŠ©æ“ä½œï¼Œè¡¥å……å†…å­˜çš„ä¸è¶³ã€‚ä½†æ˜¯è¿›ä¸€æ­¥ä¼šé€ æˆå¤§é‡çš„æ–‡ä»¶I&#x2F;Oæ“ä½œï¼Œæå¤§å½±å“æ•ˆç‡ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡mmapæ˜ å°„å¾ˆå¥½çš„è§£å†³ã€‚æ¢å¥è¯è¯´ï¼Œä½†å‡¡æ˜¯éœ€è¦ç”¨ç£ç›˜ç©ºé—´ä»£æ›¿å†…å­˜çš„æ—¶å€™ï¼Œmmapéƒ½å¯ä»¥å‘æŒ¥å…¶åŠŸæ•ˆã€‚</p>
<h1 id="äº”ã€Mmapåœ¨javaä¸­åº”ç”¨"><a href="#äº”ã€Mmapåœ¨javaä¸­åº”ç”¨" class="headerlink" title="äº”ã€Mmapåœ¨javaä¸­åº”ç”¨"></a>äº”ã€Mmapåœ¨javaä¸­åº”ç”¨</h1><h2 id="5-1-Javaä¸­Mmapçš„ä½¿ç”¨"><a href="#5-1-Javaä¸­Mmapçš„ä½¿ç”¨" class="headerlink" title="5.1 Javaä¸­Mmapçš„ä½¿ç”¨"></a>5.1 Javaä¸­Mmapçš„ä½¿ç”¨</h2><pre class="line-numbers language-none"><code class="language-none">RandomAccessFile  raf &#x3D; new RandomAccessFile(&quot;C:\\Users\\0959\\Desktop\\mmap-test.txt&quot;, &quot;rw&quot;);
MappedByteBuffer mappedByteBuffer &#x3D; raf.getChannel().map(FileChannel.MapMode.READ_WRITE, 0, FILE_SIZE);
raf.close();
mappedByteBuffer.put(content.getBytes());
mappedByteBuffer.force();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="5-2-FileChannel-map-è¯¦è§£"><a href="#5-2-FileChannel-map-è¯¦è§£" class="headerlink" title="5.2 FileChannel.map()è¯¦è§£"></a>5.2 FileChannel.map()è¯¦è§£</h2><pre class="line-numbers language-$java" data-language="$java"><code class="language-$java">&#x2F;**
 * Maps a region of this channel&#39;s file directly into memory.
 *
 * &lt;p&gt; A region of a file may be mapped into memory in one of three modes:
 * &lt;&#x2F;p&gt;
 *
 * &lt;ul&gt;
 *
 *   &lt;li&gt;&lt;p&gt; &lt;i&gt;Read-only:&lt;&#x2F;i&gt; Any attempt to modify the resulting buffer
 *   will cause a &#123;@link java.nio.ReadOnlyBufferException&#125; to be thrown.
 *   (&#123;@link MapMode#READ_ONLY MapMode.READ_ONLY&#125;) &lt;&#x2F;p&gt;&lt;&#x2F;li&gt;
 *
 *   &lt;li&gt;&lt;p&gt; &lt;i&gt;Read&#x2F;write:&lt;&#x2F;i&gt; Changes made to the resulting buffer will
 *   eventually be propagated to the file; they may or may not be made
 *   visible to other programs that have mapped the same file.  (&#123;@link
 *   MapMode#READ_WRITE MapMode.READ_WRITE&#125;) &lt;&#x2F;p&gt;&lt;&#x2F;li&gt;
 *
 *   &lt;li&gt;&lt;p&gt; &lt;i&gt;Private:&lt;&#x2F;i&gt; Changes made to the resulting buffer will not
 *   be propagated to the file and will not be visible to other programs
 *   that have mapped the same file; instead, they will cause private
 *   copies of the modified portions of the buffer to be created.  (&#123;@link
 *   MapMode#PRIVATE MapMode.PRIVATE&#125;) &lt;&#x2F;p&gt;&lt;&#x2F;li&gt;
 *
 * &lt;&#x2F;ul&gt;
 *
 * &lt;p&gt; For a read-only mapping, this channel must have been opened for
 * reading; for a read&#x2F;write or private mapping, this channel must have
 * been opened for both reading and writing.
 *
 * &lt;p&gt; The &#123;@link MappedByteBuffer &lt;i&gt;mapped byte buffer&lt;&#x2F;i&gt;&#125;
 * returned by this method will have a position of zero and a limit and
 * capacity of &lt;tt&gt;size&lt;&#x2F;tt&gt;; its mark will be undefined.  The buffer and
 * the mapping that it represents will remain valid until the buffer itself
 * is garbage-collected.
 *
 * &lt;p&gt; A mapping, once established, is not dependent upon the file channel
 * that was used to create it.  Closing the channel, in particular, has no
 * effect upon the validity of the mapping.
 *
 * &lt;p&gt; Many of the details of memory-mapped files are inherently dependent
 * upon the underlying operating system and are therefore unspecified.  The
 * behavior of this method when the requested region is not completely
 * contained within this channel&#39;s file is unspecified.  Whether changes
 * made to the content or size of the underlying file, by this program or
 * another, are propagated to the buffer is unspecified.  The rate at which
 * changes to the buffer are propagated to the file is unspecified.
 *
 * &lt;p&gt; For most operating systems, mapping a file into memory is more
 * expensive than reading or writing a few tens of kilobytes of data via
 * the usual &#123;@link #read read&#125; and &#123;@link #write write&#125; methods.  From the
 * standpoint of performance it is generally only worth mapping relatively
 * large files into memory.  &lt;&#x2F;p&gt;
 *
 * @param  mode
 *         One of the constants &#123;@link MapMode#READ_ONLY READ_ONLY&#125;, &#123;@link
 *         MapMode#READ_WRITE READ_WRITE&#125;, or &#123;@link MapMode#PRIVATE
 *         PRIVATE&#125; defined in the &#123;@link MapMode&#125; class, according to
 *         whether the file is to be mapped read-only, read&#x2F;write, or
 *         privately (copy-on-write), respectively
 *
 * @param  position
 *         The position within the file at which the mapped region
 *         is to start; must be non-negative
 *
 * @param  size
 *         The size of the region to be mapped; must be non-negative and
 *         no greater than &#123;@link java.lang.Integer#MAX_VALUE&#125;
 *
 * @return  The mapped byte buffer
 *
 * @throws NonReadableChannelException
 *         If the &lt;tt&gt;mode&lt;&#x2F;tt&gt; is &#123;@link MapMode#READ_ONLY READ_ONLY&#125; but
 *         this channel was not opened for reading
 *
 * @throws NonWritableChannelException
 *         If the &lt;tt&gt;mode&lt;&#x2F;tt&gt; is &#123;@link MapMode#READ_WRITE READ_WRITE&#125; or
 *         &#123;@link MapMode#PRIVATE PRIVATE&#125; but this channel was not opened
 *         for both reading and writing
 *
 * @throws IllegalArgumentException
 *         If the preconditions on the parameters do not hold
 *
 * @throws IOException
 *         If some other I&#x2F;O error occurs
 *
 * @see java.nio.channels.FileChannel.MapMode
 * @see java.nio.MappedByteBuffer
 *&#x2F;
public abstract MappedByteBuffer map(MapMode mode,
                                     long position, long size)
    throws IOException;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ï¼ˆ1ï¼‰å°†FileChannleå¯¹äºçš„æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ç›´æ¥æ˜ å°„åˆ°å†…å­˜ã€‚ï¼ˆè¿™é‡Œçš„å†…å­˜æ˜¯å †å¤–å†…å­˜ï¼‰<br>ï¼ˆ2ï¼‰æ˜ å°„æ¨¡å¼å¯ä»¥æ˜¯MapMode.READ_ONLY(åªè¯»)ï¼ŒMapMode.READ_WRITE(è¯»å†™)ï¼ŒMapMode.PRIVATEï¼ˆç§æœ‰ï¼Œå†™æ—¶å¤åˆ¶ï¼‰<br>ï¼ˆ3ï¼‰å¦‚æœæ˜¯åªè¯»æ¨¡å¼æ˜ å°„ï¼Œé‚£ä¹ˆæ–‡ä»¶é€šé“å¿…é¡»æ˜¯ä»¥åªè¯»æ¨¡å¼æ‰“å¼€ã€‚<br>ï¼ˆ4ï¼‰æ–¹æ³•è¿”å›çš„MappedByteBufferçš„positionæ˜¯0ï¼Œlimit å’Œ capacityçš„å€¼æ˜¯å‚æ•°sizeçš„å€¼ã€‚<br>ï¼ˆ5ï¼‰ä¸€æ—¦æ˜ å°„å®Œæˆï¼Œé‚£ä¹ˆè¯¥MappedByteBufferå°±å’Œåˆ›å»ºå®ƒçš„FileChannelæ— å…³ã€‚å…³é—­FileChannelä¸ä¼šå½±å“è¯¥MappedByteBufferã€‚<br>ï¼ˆ6ï¼‰è¯¥æ–¹æ³•çš„åº•å±‚å®ç°ä¾èµ–äºå…·ä½“æ“ä½œç³»ç»Ÿä¸­mmapç³»ç»Ÿè°ƒç”¨çš„å®ç°é€»è¾‘ã€‚ä¸åŒçš„æ“ä½œç³»ç»Ÿå¯èƒ½è¡¨ç°ä¸åŒã€‚ä¾‹å¦‚ï¼šç¨‹åºä¿®æ”¹äº†MappedByteBufferçš„å†…å®¹ï¼Œæ“ä½œç³»ç»Ÿä½•æ—¶å°†å˜æ›´å†™å…¥åˆ°ç£ç›˜ï¼Œè¿™ä¸ªæ˜¯ä¸ç¡®å®šçš„ã€‚<br>ï¼ˆ7ï¼‰å¯¹å¤§å¤šæ•°æ“ä½œç³»ç»Ÿæ¥è¯´è¯¥æ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œï¼Œå¦‚æœä»…ä»…æ˜¯æ˜ å°„å¾ˆå°èŒƒå›´ï¼Œé‚£ä¹ˆä¸å»ºè®®ä½¿ç”¨ã€‚é’ˆå¯¹å¤§æ–‡ä»¶æ¨èä½¿ç”¨è¯¥æ“ä½œã€‚</p>
<h2 id="5-3-MappedByteBufferè¯¦è§£"><a href="#5-3-MappedByteBufferè¯¦è§£" class="headerlink" title="5.3 MappedByteBufferè¯¦è§£"></a>5.3 MappedByteBufferè¯¦è§£</h2><p>MappedByteBufferæœ¬è´¨ä¸Šæ˜¯ä¸€å—å †å¤–å†…å­˜ï¼Œä¹Ÿå°±æ˜¯DirectByteBufferã€‚é€šè¿‡FileChannel.mapæ¥åˆ›å»ºï¼Œç›´åˆ°è¢«GCæ‰ç»“æŸå®ƒçš„ç”Ÿå‘½ã€‚</p>
<blockquote>
<p>load()æ–¹æ³•</p>
</blockquote>
<p>åŠ è½½è¯¥ç¼“å­˜çš„å†…å®¹åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚è¿™æ˜¯å› ä¸ºmappå®Œæˆåï¼ŒOSå¹¶æ²¡æœ‰ç›´æ¥è¯»å–æ–‡ä»¶çš„å†…å®¹ï¼Œå½“çœŸæ­£è¦è®¿é—®çš„æ—¶å€™ï¼Œé€šè¿‡ç¼ºé¡µå¼‚å¸¸æ¥è¿›è¡Œè¯»ç£ç›˜æ“ä½œã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
    * Loads this buffer's content into physical memory.
    *
    * &lt;p> This method makes a best effort to ensure that, when it returns,
    * this buffer's content is resident in physical memory.  Invoking this
    * method may cause some number of page faults and I/O operations to
    * occur. &lt;/p>
    *
    * @return  This buffer
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">MappedByteBuffer</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token function">checkMapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
       <span class="token keyword">long</span> offset <span class="token operator">=</span> <span class="token function">mappingOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">long</span> length <span class="token operator">=</span> <span class="token function">mappingLength</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">load0</span><span class="token punctuation">(</span><span class="token function">mappingAddress</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// Read a byte from each page to bring it into memory. A checksum</span>
       <span class="token comment">// is computed as we go along to prevent the compiler from otherwise</span>
       <span class="token comment">// considering the loop as dead code.</span>
       <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">int</span> ps <span class="token operator">=</span> <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">pageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token class-name">Bits</span><span class="token punctuation">.</span><span class="token function">pageCount</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">long</span> a <span class="token operator">=</span> <span class="token function">mappingAddress</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">byte</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           x <span class="token operator">^=</span> unsafe<span class="token punctuation">.</span><span class="token function">getByte</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
           a <span class="token operator">+=</span> ps<span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>unused <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
           unused <span class="token operator">=</span> x<span class="token punctuation">;</span>

       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>force()æ–¹æ³•</p>
</blockquote>
<p>å¼ºåˆ¶å°†ä¿®æ”¹åçš„çš„å†…å®¹å†™å…¥åˆ°å­˜å‚¨è®¾å¤‡ä¸Šã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœæ˜¯æœ¬åœ°è®¾å¤‡ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•è¿”å›æ—¶ï¼Œç¡®ä¿è‡ªä»è¯¥ç¼“å­˜åŒºåˆ›å»ºåæˆ–è¯¥æ–¹æ³•æœ€åä¸€æ¬¡è°ƒç”¨åï¼Œå˜æ›´çš„å†…å®¹ä¸€å®šå†™å…¥äº†è®¾å¤‡ï¼Œå¦‚æœæ˜¯ç½‘ç»œæ–‡ä»¶åˆ™æ²¡æœ‰è¯¥ä¿è¯ã€‚<br>å¦‚æœä¸æ˜¯é€šè¿‡<code>MapMode.READ_WRITE</code>æ¨¡å¼æ˜ å°„çš„ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
     * Forces any changes made to this buffer's content to be written to the
     * storage device containing the mapped file.
     *
     * &lt;p> If the file mapped into this buffer resides on a local storage
     * device then when this method returns it is guaranteed that all changes
     * made to the buffer since it was created, or since this method was last
     * invoked, will have been written to that device.
     *
     * &lt;p> If the file does not reside on a local device then no such guarantee
     * is made.
     *
     * &lt;p> If this buffer was not mapped in read/write mode (&#123;@link
     * java.nio.channels.FileChannel.MapMode#READ_WRITE&#125;) then invoking this
     * method has no effect. &lt;/p>
     *
     * @return  This buffer
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">MappedByteBuffer</span> <span class="token function">force</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">checkMapped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>address <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> offset <span class="token operator">=</span> <span class="token function">mappingOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">force0</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token function">mappingAddress</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mappingLength</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…³äºforceæ–¹æ³•å¤šè¯´ä¸€ç‚¹ï¼šå³ä½¿æˆ‘ä»¬ä¸æ‰‹åŠ¨è°ƒåŠ¨è¯¥æ–¹æ³•å†™ç¼“å­˜åŒºçš„æ›´æ”¹å†™å…¥åº•å±‚è®¾å¤‡ï¼Œæ“ä½œç³»ç»Ÿåº•å±‚ä¹Ÿä¼šå®šæ—¶å°†å˜æ›´çš„è„é¡µåˆ·åˆ°è®¾å¤‡ä¸Šï¼Œä¸è¿‡æ—¶é—´ä¸ç¡®å®šã€‚</p>
<p>MappedByteBuffer åœ¨æˆ‘ä»¬å…³é—­FileChannelå’Œæ–‡ä»¶åå¦‚æœè¿˜æ²¡æœ‰è¢«GCï¼Œé‚£ä¹ˆå¯¹äºçš„æ–‡ä»¶ä¹Ÿæ˜¯æ— æ³•åˆ é™¤çš„ï¼Œå› ä¸ºåº•å±‚çš„æ–‡ä»¶å¥æŸ„è¿˜æ²¡æœ‰é‡Šæ”¾ã€‚åœ¨RocketMQä¸­æœ‰ä¸“é—¨é’ˆå¯¹è¯¥é—®é¢˜ç¼–å†™çš„ä»£ç ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">clean</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ByteBuffer</span> buffer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>buffer<span class="token punctuation">.</span><span class="token function">isDirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> buffer<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">viewed</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"cleaner"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"clean"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½œç”¨æ˜¯è·å–DirectByteBufferä¸­çš„Cleanerï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥å›æ”¶è¯¥DirectByteBufferï¼Œä¹Ÿå°±æ˜¯MappedByteBufferã€‚</p>
<p>Cleaneråº•å±‚æ˜¯é€šè¿‡unsafe.freeMemory(address);æ¥é‡Šæ”¾å†…å­˜çš„ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><blockquote>
<p><a href="https://www.cnblogs.com/huxiao-tee/p/4660352.html">è®¤çœŸåˆ†æmmapï¼šæ˜¯ä»€ä¹ˆ ä¸ºä»€ä¹ˆ æ€ä¹ˆç”¨</a></p>
<p><a href="https://www.cnblogs.com/huxiao-tee/p/4657851.html">ä»å†…æ ¸æ–‡ä»¶ç³»ç»Ÿçœ‹æ–‡ä»¶è¯»å†™è¿‡ç¨‹</a></p>
<p><a href="https://blog.csdn.net/yusiguyuan/article/details/23388771">linuxå†…å­˜æ˜ å°„mmapåŸç†åˆ†æ</a></p>
<p><a href="https://leokongwq.github.io/2019/09/12/java-mmap.html">java ä¸­çš„å†…å­˜æ˜ å°„</a></p>
</blockquote>
]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
        <tag>Mmap</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQæ¶ˆæ¯å­˜å‚¨</title>
    <url>/2020/09/10/rockermq/rocketmq-xiao-xi-cun-chu/</url>
    <content><![CDATA[<h1 id="ä¸€ã€æ¶ˆæ¯å­˜å‚¨æ¶æ„å›¾"><a href="#ä¸€ã€æ¶ˆæ¯å­˜å‚¨æ¶æ„å›¾" class="headerlink" title="ä¸€ã€æ¶ˆæ¯å­˜å‚¨æ¶æ„å›¾"></a>ä¸€ã€æ¶ˆæ¯å­˜å‚¨æ¶æ„å›¾</h1><p><img src="/2020/09/10/rockermq/rocketmq-xiao-xi-cun-chu/rocketmq_design_1.png" alt="æ¶ˆæ¯å­˜å‚¨æ¶æ„å›¾"></p>
<h1 id="äºŒã€æ¶ˆæ¯å­˜å‚¨"><a href="#äºŒã€æ¶ˆæ¯å­˜å‚¨" class="headerlink" title="äºŒã€æ¶ˆæ¯å­˜å‚¨"></a>äºŒã€æ¶ˆæ¯å­˜å‚¨</h1><h2 id="2-1-æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶"><a href="#2-1-æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶" class="headerlink" title="2.1 æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶"></a>2.1 æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶</h2><table>
<thead>
<tr>
<th>æ–‡ä»¶åç§°</th>
<th>ä½œç”¨</th>
<th>æ–‡ä»¶å¤§å°</th>
<th>æ–‡ä»¶æ ¼å¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>CommitLog</td>
<td>æ¶ˆæ¯ä¸»ä½“ä»¥åŠå…ƒæ•°æ®çš„å­˜å‚¨ä¸»ä½“</td>
<td>å•ä¸ªæ–‡ä»¶å¤§å°é»˜è®¤1G</td>
<td>æ¶ˆæ¯é¡ºåºå†™å…¥æ–‡ä»¶ï¼Œå½“æ–‡ä»¶æ»¡äº†ï¼Œå†™å…¥ä¸‹ä¸€ä¸ªæ–‡ä»¶</td>
<td>æ–‡ä»¶åä¸º20ä½ï¼Œå¦‚ä¸€ä¸ªæ–‡ä»¶åä¸º00000000000000000000ä»£è¡¨ä»¥ä¸€ä¸ªæ–‡ä»¶ï¼Œèµ·å§‹åç§»é‡ä¸º0ï¼Œæ–‡ä»¶å¤§å°ä¸º1G&#x3D;1073741824ï¼Œåé¢æ–°å¢æ–‡ä»¶çš„åç§°åŸºäºä¸Šä¸€ä¸ªæ–‡ä»¶åç´¯åŠ 1Gï¼Œèµ·å§‹åç§»é‡ä»ä¸Šä¸€ä¸ªæ–‡ä»¶ç»§ç»­ç´¯è®¡ã€‚</td>
</tr>
<tr>
<td>ConsumeQueue</td>
<td>æ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—</td>
<td>æ¯ä¸ªæ¡ç›®20ä¸ªå­—èŠ‚ï¼Œå•ä¸ªæ–‡ä»¶ç”±30Wä¸ªæ¡ç›®ç»„æˆ</td>
<td>æ¯ä¸€ä¸ªæ¡ç›®å…±20ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«ä¸º8å­—èŠ‚çš„commitlogç‰©ç†åç§»é‡ã€4å­—èŠ‚çš„æ¶ˆæ¯é•¿åº¦ã€8å­—èŠ‚tag hashcode</td>
<td>å•ä¸ªæ–‡ä»¶ç”±30Wä¸ªæ¡ç›®ç»„æˆï¼Œå¯ä»¥åƒæ•°ç»„ä¸€æ ·éšæœºè®¿é—®æ¯ä¸€ä¸ªæ¡ç›®ï¼Œæ¯ä¸ªConsumeQueueæ–‡ä»¶å¤§å°çº¦5.72M</td>
</tr>
<tr>
<td>IndexFile</td>
<td>ç´¢å¼•æ–‡ä»¶</td>
<td>å›ºå®šçš„å•ä¸ªIndexFileæ–‡ä»¶å¤§å°çº¦ä¸º400Mï¼Œä¸€ä¸ªIndexFileå¯ä»¥ä¿å­˜ 2000Wä¸ªç´¢å¼•</td>
<td>IndexFileçš„åº•å±‚å­˜å‚¨è®¾è®¡ä¸ºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å®ç°HashMapç»“æ„</td>
<td>rocketmqçš„ç´¢å¼•æ–‡ä»¶å…¶åº•å±‚å®ç°ä¸ºhashç´¢å¼•</td>
</tr>
</tbody></table>
<h2 id="2-2-å­˜å‚¨ç»“æ„åˆ†æ"><a href="#2-2-å­˜å‚¨ç»“æ„åˆ†æ" class="headerlink" title="2.2 å­˜å‚¨ç»“æ„åˆ†æ"></a>2.2 å­˜å‚¨ç»“æ„åˆ†æ</h2><ol>
<li>Brokerå•ä¸ªå®ä¾‹ä¸‹æ‰€æœ‰çš„é˜Ÿåˆ—å…±ç”¨ä¸€ä¸ªæ—¥å¿—æ•°æ®æ–‡ä»¶ï¼ˆå³ä¸ºCommitLogï¼‰æ¥å­˜å‚¨ã€‚</li>
<li>å¤šä¸ªTopicçš„æ¶ˆæ¯å®ä½“å†…å®¹éƒ½å­˜å‚¨äºä¸€ä¸ªCommitLogä¸­</li>
<li>RocketMQçš„æ··åˆå‹å­˜å‚¨ç»“æ„é’ˆå¯¹Producerå’ŒConsumeråˆ†åˆ«é‡‡ç”¨äº†æ•°æ®å’Œç´¢å¼•éƒ¨åˆ†ç›¸åˆ†ç¦»çš„å­˜å‚¨ç»“æ„</li>
</ol>
]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
        <tag>æ¶ˆæ¯å­˜å‚¨</tag>
      </tags>
  </entry>
  <entry>
    <title>RocketMQè®¾è®¡åŸç†åˆ†æ</title>
    <url>/2020/11/26/rockermq/rocketmq-she-ji-yuan-li-fen-xi/</url>
    <content><![CDATA[<h1 id="RocketMQè®¾è®¡åŸç†åˆ†æâ€”â€”æŠ€æœ¯åˆ†äº«PPT"><a href="#RocketMQè®¾è®¡åŸç†åˆ†æâ€”â€”æŠ€æœ¯åˆ†äº«PPT" class="headerlink" title="RocketMQè®¾è®¡åŸç†åˆ†æâ€”â€”æŠ€æœ¯åˆ†äº«PPT"></a>RocketMQè®¾è®¡åŸç†åˆ†æâ€”â€”æŠ€æœ¯åˆ†äº«PPT</h1><span id="more"></span>
<div class="pdf-container" style="width: 100%; height: 600px; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe src="./RocketMQè®¾è®¡åŸç†åˆ†æ.pdf" width="100%" height="100%" frameborder="0" style="border: none; border-radius: 8px;">
      <div style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 8px;">
        <p style="margin: 0; color: #666;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºPDFæ–‡ä»¶</p>
        <a href="./RocketMQè®¾è®¡åŸç†åˆ†æ.pdf" target="_blank" style="color: #409eff; text-decoration: none; font-weight: 500;">ğŸ“¥ ç‚¹å‡»è¿™é‡Œä¸‹è½½PDFæ–‡ä»¶</a>
      </div>
    </iframe>
  </div>]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
        <tag>Mmap</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±åº¦è§£è¯» RocketMQ å­˜å‚¨æœºåˆ¶</title>
    <url>/2022/06/19/rockermq/shen-du-jie-du-rocketmq-cun-chu-ji-zhi/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ã€Šé˜¿é‡Œå¼€å‘è€…ã€‹å…¬ä¼—å·çœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œæ·±åº¦è§£æäº†RocketMQçš„å­˜å‚¨æœºåˆ¶ï¼Œå¯¹ç†è§£RocketMQå­˜å‚¨åŸç†åŠè¿›è¡Œæ€§èƒ½ä¼˜åŒ–å¾ˆæœ‰å¸®åŠ©ã€‚<br>åŸæ–‡åœ°å€ï¼š<a href="https://mp.weixin.qq.com/s/PzDO-UCLzxqDbFoHbS47Sg">æ·±åº¦è§£è¯» RocketMQ å­˜å‚¨æœºåˆ¶</a></p>
</blockquote>
<p>RocketMQ å®ç°äº†çµæ´»çš„å¤šåˆ†åŒºå’Œå¤šå‰¯æœ¬æœºåˆ¶ï¼Œæœ‰æ•ˆçš„é¿å…äº†é›†ç¾¤å†…å•ç‚¹æ•…éšœå¯¹äºæ•´ä½“æœåŠ¡å¯ç”¨æ€§çš„å½±å“ã€‚å­˜å‚¨æœºåˆ¶å’Œé«˜å¯ç”¨ç­–ç•¥æ˜¯ RocketMQ ç¨³å®šæ€§çš„æ ¸å¿ƒï¼Œç¤¾åŒºä¸Šå…³äº RocketMQ ç›®å‰å­˜å‚¨å®ç°çš„åˆ†æä¸è®¨è®ºä¸€ç›´æ˜¯ä¸€ä¸ªçƒ­è®®çš„è¯é¢˜ã€‚æœ¬æ–‡æƒ³ä»ä¸€ä¸ªä¸ä¸€æ ·çš„è§†è§’ï¼Œç€é‡äºè°ˆè°ˆæˆ‘çœ¼ä¸­çš„è¿™ç§å­˜å‚¨å®ç°æ˜¯åœ¨è§£å†³å“ªäº›å¤æ‚çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»æœ¬æ–‡æœ€åˆçš„ç‰ˆæœ¬ä¸­åˆ å»äº†å†—æ‚çš„ä»£ç ç»†èŠ‚åˆ†æï¼Œç”±æµ…å…¥æ·±çš„åˆ†æå­˜å‚¨æœºåˆ¶çš„ç¼ºé™·ä¸ä¼˜åŒ–æ–¹å‘ã€‚</p>
<div class="btn-center">
<a class="btn-beautify outline blue larger" href="https://mp.weixin.qq.com/s/PzDO-UCLzxqDbFoHbS47Sg" title="æŸ¥çœ‹åŸæ–‡"><i class="far fa-hand-point-right"></i><span>æŸ¥çœ‹åŸæ–‡</span></a>
</div>]]></content>
      <categories>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>ç«™åœ¨31å²çš„äººç”Ÿåå­—è·¯å£ï¼Œæˆ‘é€‰æ‹©æ”¾ä¸‹ç„¦è™‘ï¼Œä¸è‡ªå·±å’Œè§£</title>
    <url>/2025/03/26/thought/31-sui-zhan-zai-ren-sheng-shi-zi-lu-kou-yi-ci-shen-du-jie-pou-gao-bie-jiao-lu-mi-mang/</url>
    <content><![CDATA[<div class="note primary no-icon flat"><p>ä¸‰åè€Œç«‹ï¼Œæ˜¯ä¸€ä¸ªè¢«èµ‹äºˆäº†å¤ªå¤šæœŸæœ›çš„è¯ã€‚æˆ‘ä»¬æ›¾ä»¥ä¸ºï¼Œåˆ°äº†è¿™ä¸ªå¹´çºªå°±è¯¥äº‹ä¸šæœ‰æˆã€å®¶åº­ç¾æ»¡ï¼Œæ´»æˆä¸€ä¸ªâ€æ ‡å‡†ç­”æ¡ˆâ€ã€‚ç„¶è€Œï¼Œå½“31å²çš„é‡Œç¨‹ç¢‘æ‚„ç„¶æ¥ä¸´ï¼Œæˆ‘ä»¬æ‰å‘ç°ï¼Œäººç”Ÿæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œåªæœ‰ä¸æ–­å©é—®è‡ªå·±ã€ä¸è‡ªå·±å’Œè§£çš„è¿‡ç¨‹ã€‚</p>
</div>

<span id="more"></span>
<p><img src="/2025/03/26/thought/31-sui-zhan-zai-ren-sheng-shi-zi-lu-kou-yi-ci-shen-du-jie-pou-gao-bie-jiao-lu-mi-mang/cover.jpg" alt="cover"></p>
<hr>
<h2 id="ä¸€ã€ç„¦è™‘ï¼Œæ˜¯æˆé•¿çš„å¿…ç»ä¹‹è·¯"><a href="#ä¸€ã€ç„¦è™‘ï¼Œæ˜¯æˆé•¿çš„å¿…ç»ä¹‹è·¯" class="headerlink" title="ä¸€ã€ç„¦è™‘ï¼Œæ˜¯æˆé•¿çš„å¿…ç»ä¹‹è·¯"></a>ä¸€ã€ç„¦è™‘ï¼Œæ˜¯æˆé•¿çš„å¿…ç»ä¹‹è·¯</h2><p>æœ€è¿‘ï¼Œæˆ‘å¸¸å¸¸æ„Ÿåˆ°ä¸€ç§è«åçš„ç„¦è™‘ã€‚å®ƒä¸åƒå¹´è½»æ—¶çš„è¿·èŒ«ï¼Œé‚£ç§å¯¹æœªæ¥çš„ä¸ç¡®å®šæ€§ã€‚ç°åœ¨çš„ç„¦è™‘æ›´åƒæ˜¯ç«™åœ¨ä¸€ä¸ªå±±é¡¶ï¼Œå›å¤´æœ›å»ï¼Œæœ‰èµ·æœ‰è½ï¼Œæœ‰æ¸…æ™°çš„è¶³è¿¹ï¼Œä½†å‰æ–¹å´åˆæ˜¯ä¸€ç‰‡è¿·é›¾ã€‚</p>
<p>æˆ‘å¼€å§‹æ„è¯†åˆ°ï¼Œ31å²ä¸å†æ˜¯é‚£ä¸ªå¯ä»¥è‚†æ„æŒ¥éœæ—¶é—´çš„å°‘å¹´ã€‚æˆ‘ä»¬å¼€å§‹ç®—è®¡æ²‰æ²¡æˆæœ¬ï¼Œæ¯ä¸€æ¬¡é€‰æ‹©éƒ½èƒŒè´Ÿç€æ›´é«˜çš„é£é™©ã€‚è‚©ä¸Šçš„è´£ä»»è¶Šæ¥è¶Šé‡ï¼Œå®ƒä¸åªæ˜¯å·¥ä½œçš„ KPIï¼Œæ›´æ˜¯å¯¹å®¶äººã€å¯¹æœªæ¥çš„æ‰¿è¯ºã€‚</p>
<div class="note info no-icon flat"><p>æ›¾å›½è—©è¯´ï¼šâ€<strong>ç‰©æ¥é¡ºåº”ï¼Œæœªæ¥ä¸è¿ï¼Œå½“æ—¶ä¸æ‚ï¼Œæ—¢è¿‡ä¸æ‹ã€‚</strong>â€œ è¿™å¥è¯æ›¾è¢«æˆ‘å¥‰ä¸ºåœ­è‡¬ã€‚ä½†çœŸæ­£çš„æ„Ÿæ‚Ÿï¼Œæ˜¯åœ¨è¿™31å¹´çš„äººç”Ÿè½¨è¿¹é‡Œï¼Œæˆ‘æ‰æ˜ç™½å®ƒä¸æ˜¯è®©æˆ‘ä»¬è¢«åŠ¨æ¥å—ï¼Œè€Œæ˜¯å‘Šè¯‰æˆ‘ä»¬ï¼Œé¢å¯¹ç„¦è™‘ï¼Œä¸å…¶è¢«åŠ¨é€ƒé¿ï¼Œä¸å¦‚ä¸»åŠ¨å‰–æï¼Œææ¸…æ¥šç„¦è™‘çš„æ ¹æºï¼Œæ‰èƒ½çœŸæ­£ä¸ä¹‹å’Œè§£ã€‚</p>
</div>

<hr>
<h2 id="äºŒã€æ’•å¼€è‡ªæˆ‘çš„â€ç†æƒ³ç”»åƒâ€ï¼Œçœ‹è§çœŸå®çš„è‡ªå·±"><a href="#äºŒã€æ’•å¼€è‡ªæˆ‘çš„â€ç†æƒ³ç”»åƒâ€ï¼Œçœ‹è§çœŸå®çš„è‡ªå·±" class="headerlink" title="äºŒã€æ’•å¼€è‡ªæˆ‘çš„â€ç†æƒ³ç”»åƒâ€ï¼Œçœ‹è§çœŸå®çš„è‡ªå·±"></a>äºŒã€æ’•å¼€è‡ªæˆ‘çš„â€ç†æƒ³ç”»åƒâ€ï¼Œçœ‹è§çœŸå®çš„è‡ªå·±</h2><p>ä¸ºäº†çœ‹æ¸…å‰è·¯ï¼Œæˆ‘å†³å®šåšä¸€æ¬¡æ·±åº¦è‡ªæˆ‘è§£å‰–ï¼Œå°†è‡ªå·±çš„äººç”Ÿåˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼šæ¯•ä¸šå‰å’Œå·¥ä½œåã€‚è¿™ä¸æ˜¯ç®€å•çš„å±¥å†ç½—åˆ—ï¼Œè€Œæ˜¯å»æ´å¯Ÿé‚£äº›å¡‘é€ äº†æˆ‘ã€ä¹Ÿæ›¾å›°ä½æˆ‘çš„ç‰¹è´¨ã€‚</p>
<p>æˆ‘æ›¾ä»¥ä¸ºï¼Œå·¥ä½œåçš„äººç”Ÿæ‰ç®—çœŸæ­£å¼€å§‹ã€‚ä½†å›çœ‹æ¯•ä¸šå‰çš„è‡ªå·±ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ä¸ª<strong>å†…å‘æ•æ„Ÿ</strong>ã€<strong>è´£ä»»æ„Ÿå¼º</strong>ã€<strong>ä¹ æƒ¯æ€§ç¼ºä¹è‡ªä¿¡</strong>çš„å°‘å¹´ã€‚ä»–å–œæ¬¢è¯»ä¹¦ï¼Œå´æ€»æ˜¯æµ…å°è¾„æ­¢ï¼›å¯¹æŠ€æœ¯æœ‰æœ¦èƒ§çš„å‘å¾€ï¼Œå´ç¼ºä¹æ˜ç¡®çš„æ–¹å‘ã€‚è¿™äº›ç‰¹è´¨æ›¾æ˜¯æˆ‘çš„æ¡æ¢ï¼Œè®©æˆ‘å®³æ€•å¤±è´¥ï¼Œä¸æ•¢å°è¯•ï¼Œæ€»åœ¨å¯»æ±‚å¤–ç•Œçš„è®¤å¯ã€‚</p>
<p>å·¥ä½œåï¼Œæˆ‘é€æ¸åœ¨æŠ€æœ¯é¢†åŸŸæ‰¾åˆ°äº†è‡ªå·±çš„ä½ç½®ï¼Œå»ºç«‹äº†ä¸€å®šçš„èŒåœºåœˆå­ã€‚æˆ‘ä»¥ä¸ºè‡ªå·±å·²ç»â€œé•¿å¤§â€ï¼Œä½†å½“æ–°çš„æŒ‘æˆ˜æ¥ä¸´æ—¶ï¼Œé‚£äº›æ·±è—çš„ç‰¹è´¨åˆä¼šå†’å‡ºæ¥ã€‚31å²ï¼Œæˆ‘ä¸å†æ˜¯é‚£ä¸ªåœ¨ä¹åˆ«äººçœ‹æ³•ã€å®³æ€•â€œè¢«å«èµ·è¡¨æ¼”èŠ‚ç›®â€çš„ç”·å­©ï¼Œä½†æˆ‘ä¾ç„¶ä¼šæ€€ç–‘è‡ªå·±çš„èƒ½åŠ›ï¼Œåœ¨åšé‡å¤§å†³å®šæ—¶ç»å‰é¡¾åã€‚</p>
<div class="note warning no-icon flat"><p>è¿™æ¬¡è‡ªæˆ‘å‰–æè®©æˆ‘æ˜ç™½ï¼Œ<strong>ç„¦è™‘çš„æœ¬è´¨ï¼Œæ˜¯å¯¹ä¸ç¡®å®šæ€§çš„ææƒ§ã€‚</strong> è€Œè¿™ç§ææƒ§ï¼Œæºäºæˆ‘ä»¬å¯¹è‡ªèº«å¼±ç‚¹çš„æŠ—æ‹’ã€‚çœŸæ­£çš„æˆé•¿ï¼Œä¸æ˜¯æŠ¹æ‰è¿™äº›ç‰¹è´¨ï¼Œè€Œæ˜¯å»æ¥çº³å®ƒä»¬ï¼Œä¸å®ƒä»¬å¹¶è‚©å‰è¡Œã€‚</p>
</div>

<hr>
<h2 id="ä¸‰ã€äººç”Ÿä¸æ˜¯å…¬å¼ï¼Œè€Œæ˜¯ä¸€åœºå‘å†…æ¢ç´¢çš„ä¿®è¡Œ"><a href="#ä¸‰ã€äººç”Ÿä¸æ˜¯å…¬å¼ï¼Œè€Œæ˜¯ä¸€åœºå‘å†…æ¢ç´¢çš„ä¿®è¡Œ" class="headerlink" title="ä¸‰ã€äººç”Ÿä¸æ˜¯å…¬å¼ï¼Œè€Œæ˜¯ä¸€åœºå‘å†…æ¢ç´¢çš„ä¿®è¡Œ"></a>ä¸‰ã€äººç”Ÿä¸æ˜¯å…¬å¼ï¼Œè€Œæ˜¯ä¸€åœºå‘å†…æ¢ç´¢çš„ä¿®è¡Œ</h2><p>æˆ‘æ›¾è¯•å›¾ç”¨å‡ ä¸ªâ€œå…¬å¼â€æ¥å®šä¹‰å¹¸ç¦ä¸ä»·å€¼ï¼Œæ¯”å¦‚ï¼š</p>
<p><strong>å¹¸ç¦ &#x3D; å¥åº· + è´¢å¯Œ + è‰¯å¥½çš„äººé™…å…³ç³»</strong></p>
<p>ä½†ç°å®æ˜¯ï¼Œäººç”Ÿä¸æ˜¯ä¸€é“å¯ä»¥ç²¾ç¡®è®¡ç®—çš„æ•°å­¦é¢˜ã€‚</p>
<p>å¥åº·ï¼Œä¸åªæ˜¯æ²¡æœ‰ç–¾ç—…ï¼Œæ›´æ˜¯ä¿æŒå¯¹ç”Ÿæ´»çš„çƒ­æƒ…ä¸æ´»åŠ›ï¼›è´¢å¯Œï¼Œä¸æ˜¯é“¶è¡Œè´¦æˆ·é‡Œçš„æ•°å­—ï¼Œè€Œæ˜¯å®ç°è‡ªæˆ‘ä»·å€¼ä¸è‡ªç”±é€‰æ‹©çš„åº•æ°”ï¼›äººé™…å…³ç³»ï¼Œä¸æ˜¯ç¤¾äº¤åœˆçš„å¤§å°ï¼Œè€Œæ˜¯ä¸é‡è¦çš„äººå»ºç«‹æ·±åº¦è¿æ¥çš„èƒ½åŠ›ã€‚</p>
<div class="note primary no-icon flat"><p>æˆ‘å¼€å§‹ç†è§£ï¼Œ<strong>äººç”Ÿçš„æ„ä¹‰ä¸åœ¨äºå®Œç¾åœ°å¥—ç”¨æŸä¸ªå…¬å¼ï¼Œè€Œåœ¨äºä¸æ–­åœ°å‘å†…æ¢ç´¢ï¼Œæ´»å‡ºç‹¬ä¸€æ— äºŒçš„ç”Ÿå‘½ä½“éªŒã€‚</strong></p>
</div>

<p>è¿™31å¹´ï¼Œæˆ‘é€æ¸å½¢æˆäº†è‡ªå·±çš„ä»·å€¼è§‚ï¼š<strong>è¯šä¿¡ã€æŒç»­æˆé•¿ã€ä»·å€¼åˆ›é€ ã€å¹³è¡¡ç”Ÿæ´»ä¸æ„Ÿæ©ã€‚</strong> å®ƒä»¬ä¸å†æ˜¯æŠ½è±¡çš„è¯æ±‡ï¼Œè€Œæ˜¯æ¯ä¸€æ¬¡é€‰æ‹©ã€æ¯ä¸€æ¬¡ä»˜å‡ºåï¼Œå†…å¿ƒæœ€çœŸå®çš„å›å“ã€‚</p>
<hr>
<h2 id="å››ã€å‘Šåˆ«ç„¦è™‘ï¼Œä»â€œæƒ³æ˜ç™½â€åˆ°â€œåšå¾—åˆ°â€"><a href="#å››ã€å‘Šåˆ«ç„¦è™‘ï¼Œä»â€œæƒ³æ˜ç™½â€åˆ°â€œåšå¾—åˆ°â€" class="headerlink" title="å››ã€å‘Šåˆ«ç„¦è™‘ï¼Œä»â€œæƒ³æ˜ç™½â€åˆ°â€œåšå¾—åˆ°â€"></a>å››ã€å‘Šåˆ«ç„¦è™‘ï¼Œä»â€œæƒ³æ˜ç™½â€åˆ°â€œåšå¾—åˆ°â€</h2><p>è®¤æ¸…è‡ªå·±ä¹‹åï¼Œå‘Šåˆ«ç„¦è™‘çš„å…³é”®å°±å˜æˆäº†è¡ŒåŠ¨ã€‚æˆ‘ä¸å†æ²‰æººäºç©ºæ´çš„æ€è€ƒï¼Œè€Œæ˜¯å°†é‚£äº›å®å¤§çš„æœªæ¥æ„¿æ™¯æ‹†è§£æˆä¸€ä¸ªä¸ªå…·ä½“çš„ã€å¯æ‰§è¡Œçš„è¡ŒåŠ¨æ–¹æ¡ˆã€‚</p>
<h3 id="ï¼ˆ1ï¼‰æ”¾ä¸‹â€œå®Œç¾â€ï¼Œæ‹¥æŠ±â€œå®Œæˆâ€"><a href="#ï¼ˆ1ï¼‰æ”¾ä¸‹â€œå®Œç¾â€ï¼Œæ‹¥æŠ±â€œå®Œæˆâ€" class="headerlink" title="ï¼ˆ1ï¼‰æ”¾ä¸‹â€œå®Œç¾â€ï¼Œæ‹¥æŠ±â€œå®Œæˆâ€"></a>ï¼ˆ1ï¼‰æ”¾ä¸‹â€œå®Œç¾â€ï¼Œæ‹¥æŠ±â€œå®Œæˆâ€</h3><div class="note success no-icon flat"><p>æˆ‘æ›¾æ˜¯å®Œç¾ä¸»ä¹‰çš„å—å®³è€…ï¼Œå®³æ€•å¤±è´¥ï¼Œä¸æ•¢å¼€å§‹ã€‚å¦‚ä»Šï¼Œæˆ‘å­¦ä¼šäº†â€<strong>done is better than perfect</strong>â€œã€‚ä¸å…¶ç­‰å¾…ä¸€ä¸ªå®Œç¾çš„æ—¶æœºï¼Œä¸å¦‚ç«‹å³è¡ŒåŠ¨ã€‚å“ªæ€•åªæ˜¯æ¯å¤©æ—©èµ·15åˆ†é’Ÿï¼Œå“ªæ€•åªæ˜¯å†™ä¸‹å‡ è¡Œå‡Œä¹±çš„æ€è€ƒï¼Œè¿™äº›å¾®å°çš„â€å®Œæˆâ€ä¼šé€æ¸ç´¯ç§¯æˆå·¨å¤§çš„èƒ½é‡ï¼Œé©±æ•£å†…å¿ƒçš„ææƒ§ã€‚</p>
</div>

<h3 id="ï¼ˆ2ï¼‰ä¸“æ³¨äºâ€œè¿‡ç¨‹â€ï¼Œè€Œéâ€œç»“æœâ€"><a href="#ï¼ˆ2ï¼‰ä¸“æ³¨äºâ€œè¿‡ç¨‹â€ï¼Œè€Œéâ€œç»“æœâ€" class="headerlink" title="ï¼ˆ2ï¼‰ä¸“æ³¨äºâ€œè¿‡ç¨‹â€ï¼Œè€Œéâ€œç»“æœâ€"></a>ï¼ˆ2ï¼‰ä¸“æ³¨äºâ€œè¿‡ç¨‹â€ï¼Œè€Œéâ€œç»“æœâ€</h3><div class="note info no-icon flat"><p>è¿‡åº¦çš„ç»“æœå¯¼å‘åªä¼šå¾’å¢ç„¦è™‘ã€‚æˆ‘å¼€å§‹ç»ƒä¹ æŠŠæ³¨æ„åŠ›æ”¾åœ¨å½“ä¸‹ï¼Œä¸“æ³¨äºæ¯ä¸€ä¸ªå…·ä½“è¡ŒåŠ¨ï¼š<strong>æ¯å‘¨å¤ç›˜å¾—å¤±ï¼Œæ¯æœˆè°ƒæ•´ç­–ç•¥ï¼Œæ¯æ—¥ç²¾è¿›ä¸€å°æ—¶ã€‚</strong> è¿™ç§â€è¿‡ç¨‹å¯¼å‘â€çš„æ€ç»´ï¼Œè®©æˆ‘ä¸å†è¢«æœªæ¥çš„ä¸ç¡®å®šæ€§æ‰€å›°æ‰°ï¼Œè€Œæ˜¯èƒ½åœ¨æ¯ä¸€æ¬¡åŠªåŠ›ä¸­è·å¾—å®å®åœ¨åœ¨çš„æˆå°±æ„Ÿã€‚</p>
</div>

<h3 id="ï¼ˆ3ï¼‰æ‰¾åˆ°ä½ çš„â€œæ”¯æŒç³»ç»Ÿâ€"><a href="#ï¼ˆ3ï¼‰æ‰¾åˆ°ä½ çš„â€œæ”¯æŒç³»ç»Ÿâ€" class="headerlink" title="ï¼ˆ3ï¼‰æ‰¾åˆ°ä½ çš„â€œæ”¯æŒç³»ç»Ÿâ€"></a>ï¼ˆ3ï¼‰æ‰¾åˆ°ä½ çš„â€œæ”¯æŒç³»ç»Ÿâ€</h3><div class="note primary no-icon flat"><p>å‘Šåˆ«ç„¦è™‘ä¸æ˜¯ä¸€ä¸ªäººåœ¨æˆ˜æ–—ã€‚æˆ‘å¼€å§‹æ›´åŠ é‡è§†ä¸å®¶äººã€æœ‹å‹çš„æ·±åº¦è¿æ¥ï¼Œä»–ä»¬æ˜¯æˆ‘æœ€åšå®çš„æ”¯æŒç³»ç»Ÿã€‚åŒæ—¶ï¼Œæˆ‘ä¹Ÿå¼€å§‹å¯»æ‰¾å¯¼å¸ˆï¼Œä¸åŒè¡Œäº¤æµï¼Œä¸å¿—åŒé“åˆçš„äººç»„æˆå­¦ä¹ å°ç»„ã€‚<strong>å½“ä½ å‘ç°æœ‰äººå’Œä½ èµ°åœ¨åŒä¸€æ¡è·¯ä¸Šï¼Œå†…å¿ƒçš„å­¤ç‹¬æ„Ÿä¼šå¤§å¤§é™ä½ã€‚</strong></p>
</div>

<hr>
<h2 id="äº”ã€31å²ï¼Œæˆ‘çš„â€œè€Œç«‹â€æ–°è§£"><a href="#äº”ã€31å²ï¼Œæˆ‘çš„â€œè€Œç«‹â€æ–°è§£" class="headerlink" title="äº”ã€31å²ï¼Œæˆ‘çš„â€œè€Œç«‹â€æ–°è§£"></a>äº”ã€31å²ï¼Œæˆ‘çš„â€œè€Œç«‹â€æ–°è§£</h2><p>åœ¨å¤ä»£ï¼Œâ€œä¸‰åè€Œç«‹â€æ„å‘³ç€ç«‹èº«ã€ç«‹ä¸šã€ç«‹å¾·ã€‚åœ¨ç°ä»£ï¼Œå®ƒå¯¹æˆ‘ä»¬è¿™ä»£äººæœ‰äº†æ–°çš„å«ä¹‰ï¼š</p>
<ul>
<li><strong>ç«‹å¿—</strong>ï¼šä¸æ˜¯è¢«åŠ¨åœ°é€‰æ‹©ä¸€æ¡è·¯ï¼Œè€Œæ˜¯ä¸»åŠ¨æ‰¾åˆ°è‡ªå·±çœŸæ­£æƒ³èµ°çš„æ–¹å‘ï¼›</li>
<li><strong>ç«‹èƒ½</strong>ï¼šä¸æ˜¯æ‹¥æœ‰æ‰€æœ‰æŠ€èƒ½ï¼Œè€Œæ˜¯å…·å¤‡åœ¨ä»»ä½•ä¸ç¡®å®šæ€§ä¸­ç”Ÿå­˜å’Œæˆé•¿çš„æ ¸å¿ƒèƒ½åŠ›ï¼›</li>
<li><strong>ç«‹å¿ƒ</strong>ï¼šä¸æ˜¯ä¸ä¸ºå¤–ç•Œæ‰€åŠ¨ï¼Œè€Œæ˜¯æ‹¥æœ‰ä¸€ä¸ªç¨³å®šçš„å†…å¿ƒä¸–ç•Œå’Œä»·å€¼ä½“ç³»ï¼›</li>
<li><strong>ç«‹è¡Œ</strong>ï¼šä¸æ˜¯ç©ºæƒ³æœªæ¥ï¼Œè€Œæ˜¯å°†æ‰€æœ‰æƒ³æ³•ä»˜è¯¸è¡ŒåŠ¨ï¼Œå»åˆ›é€ å±äºè‡ªå·±çš„æœªæ¥ã€‚</li>
</ul>
<div class="note success no-icon flat"><p>31å²çš„æˆ‘ï¼Œä¸å†å®³æ€•è¿·èŒ«ï¼Œå› ä¸ºå®ƒæ„å‘³ç€æˆ‘åœ¨æ€è€ƒã€‚ä¸å†å®³æ€•ç„¦è™‘ï¼Œå› ä¸ºå®ƒè¯´æ˜æˆ‘å†…å¿ƒè¿˜æœ‰è¿½æ±‚ã€‚<strong>çœŸæ­£çš„æ·¡å®šä¸ä»å®¹ï¼Œä¸æ˜¯å†…å¿ƒæ¯«æ— æ³¢æ¾œï¼Œè€Œæ˜¯åœ¨ç»å†é£æµªä¹‹åï¼Œä¾ç„¶èƒ½å¤Ÿå¦ç„¶å‰è¡Œã€‚</strong></p>
</div>

<p>å¸Œæœ›ä½ ä¹Ÿä¸€æ ·ã€‚æ„¿æˆ‘ä»¬éƒ½èƒ½åœ¨äººç”Ÿçš„ä¸ŠåŠåœºï¼Œæ‰¾åˆ°ä¸è‡ªå·±å’Œè§£çš„æ–¹å¼ï¼›åœ¨ä¸‹åŠåœºï¼Œæ´»å‡ºå†…å¿ƒçœŸæ­£çš„è‡ªç”±ä¸ç¬ƒå®šã€‚</p>
<hr>
<p><em>å†™äº2025å¹´æ˜¥æ—¥</em><br><em>ä¸€ä¸ª31å²çš„æ€è€ƒè€…</em></p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>äººç”Ÿ</tag>
        <tag>è€Œç«‹ä¹‹å¹´</tag>
        <tag>ç„¦è™‘</tag>
        <tag>è¿·èŒ«</tag>
        <tag>è‡ªæˆ‘å’Œè§£</tag>
      </tags>
  </entry>
  <entry>
    <title>Jack Welchå…³äºç»©æ•ˆã€æ´»åŠ›æ›²çº¿çš„è§‚ç‚¹</title>
    <url>/2022/04/04/thought/jackwelch-guan-yu-ji-xiao-huo-li-qu-xian-de-guan-dian/</url>
    <content><![CDATA[<blockquote>
<p>è§†é¢‘åœ°å€ï¼š<a href="https://www.bilibili.com/video/BV1BK4y1L7AU?p=1&share_medium=iphone&share_plat=ios&share_session_id=D3F36362-7E54-4577-9988-7E9E87ABBEBF&share_source=GENERIC&share_tag=s_i&timestamp=1648028847&unique_k=sXlj4Kj">Jack Welchå…³äºç»©æ•ˆã€æ´»åŠ›æ›²çº¿çš„è§‚ç‚¹</a></p>
</blockquote>
<h1 id="ä¸€ã€Jack-Welchç®€ä»‹"><a href="#ä¸€ã€Jack-Welchç®€ä»‹" class="headerlink" title="ä¸€ã€Jack Welchç®€ä»‹"></a>ä¸€ã€Jack Welchç®€ä»‹</h1><p>æ°å…‹Â·éŸ¦å°”å¥‡ï¼Œç¾å›½ä¼ä¸šå®¶ï¼Œäº1981å¹´è‡³2001å¹´æ‹…ä»»é€šç”¨ç”µæ°”ï¼ˆGE, General Electricï¼‰ç¬¬å…«ä»»é¦–å¸­æ‰§è¡Œå®˜æœŸé—´å°†è¯¥å…¬å¸è¥ä¸šé¢æå‡åˆ°4100äº¿ç¾é‡‘ï¼Œæœ‰â€œä¸­å­å¼¹æ°å…‹â€ï¼ˆNeutron Jackï¼‰ä¹‹ç§°ã€‚</p>
<h2 id="1-1-èŒä¸šå±¥å†"><a href="#1-1-èŒä¸šå±¥å†" class="headerlink" title="1.1 èŒä¸šå±¥å†"></a>1.1 èŒä¸šå±¥å†</h2><p>éŸ¦å°”å¥‡åœ¨1960å¹´è¿›å…¥é€šç”¨ç”µæ°”ä½äºéº»å·çš®èŒ¨è²å°”å¾·çš„å¡‘èƒ¶éƒ¨é—¨æ‹…ä»»å·¥ç¨‹å¸ˆï¼Œå½“æ—¶å¹´è–ª10,500ç¾å…ƒã€‚1972å¹´å‡ä¸ºè¯¥éƒ¨é—¨çš„å‰¯æ€»ï¼Œ1977å¹´å‡ä¸ºéƒ¨é—¨æ€»ç»ç†ï¼Œ1979å¹´å‡ä¸ºå‰¯è‘£äº‹é•¿ï¼Œ1981å¹´å‡ä¸ºç¬¬å…«ä»»æœ€é«˜é¦–å¸­æ‰§è¡Œå®˜ã€‚åœ¨20å¹´çš„ç”Ÿæ¶¯åäº2001å¹´é€€ä¼‘ã€‚</p>
<h2 id="1-2-ç»è¥æ‰‹æ³•"><a href="#1-2-ç»è¥æ‰‹æ³•" class="headerlink" title="1.2 ç»è¥æ‰‹æ³•"></a>1.2 ç»è¥æ‰‹æ³•</h2><p>éŸ¦å°”å¥‡æ‹…ä»»é€šç”¨ç”µæ°”é¦–å¸­æ‰§è¡Œå®˜èµ·ï¼Œå¼€å§‹é’ˆå¯¹å…¬å¸è¿›è¡Œç»„ç»‡å†é€ ï¼Œä»–ä»¥â€œä¸‰ä¸ªåœˆåœˆâ€åˆ—å‡ºé€šç”¨ç”µæ°”çš„ç•™å­˜äº‹ä¸šï¼Œå°†å…¶ä»–ç»©æ•ˆä¸å¥½çš„äº‹ä¸šéƒ¨å‡ºå”®æˆ–å…³é—­ï¼ŒåŒ…æ‹¬äº†æˆä¸ºé€šç”¨ç”µæ°”ä¼ ç»Ÿçš„å®¶ç”µäº‹ä¸šã€‚å› æ­¤ï¼Œé€šç”¨ç”µæ°”åŸæœ‰æ•°ç™¾ä¸ªäº‹ä¸šï¼Œè¢«ç¼©å‡åˆ°ä¸åˆ°20ä¸ªäº‹ä¸šã€‚</p>
<p>1996å¹´èµ·ï¼ŒéŸ¦å°”å¥‡æ¨åŠ¨â€œå…­æ ‡å‡†å·®â€ï¼ˆ6-Sigmaï¼‰ï¼Œä»¥å°†é€šç”¨ç”µæ°”äº§å“çš„ä¸è‰¯ç‡é™ä½åˆ°åƒä¸‡åˆ†ä¹‹34ã€‚</p>
<p>éŸ¦å°”å¥‡æœ€å—äº‰è®®çš„æ”¹é©ï¼Œå°±æ˜¯å¤§å¹…è£å‘˜ã€‚é€šç”¨ç”µæ°”å‘˜å·¥äººæ•°ç”±æœ€é«˜æ—¶çš„41ä¸‡äººè£å‡åˆ°23ä¸‡äººï¼Œè£å‘˜ç‡é«˜è¾¾40%ã€‚éŸ¦å°”å¥‡å¤–å·â€œä¸­å­å¼¹æ°å…‹â€çš„ç”±æ¥ï¼Œå³å› ä¸ºéŸ¦å°”å¥‡çš„å¤§å¹…è£å‘˜æœ‰å¦‚ä¸­å­å¼¹ä¸€æ ·çš„ç‰¹æ€§ï¼šæ€äººè€Œä¸ä¼¤ä¸€ç‰©ã€‚</p>
<p>éŸ¦å°”å¥‡å°†é€šç”¨ç”µæ°”è½¬å˜ä¸ºå­¦ä¹ å‹ç»„ç»‡ï¼Œå°†åŸæœ‰ä¼ä¸šå†…çš„æ•™è‚²ä¸­å¿ƒæŠ•å…¥ç»è´¹æ”¹é€ ä¸ºå…‹é¡¿ç»´å°”ï¼ˆCrotonvilleï¼‰ç®¡ç†å­¦é™¢ã€‚é€šç”¨ç”µæ°”è®¸å¤šä¸­é«˜é˜¶ä¸»ç®¡çš†åˆ°è¿‡æ­¤å­¦é™¢å­¦ä¹ ã€‚</p>
<p>å€Ÿç”±ä¸€è¿ä¸²çš„å…´é©ï¼Œåœ¨éŸ¦å°”å¥‡2001å¹´9æœˆåº•é€€ä¼‘æ—¶ï¼Œé€šç”¨ç”µæ°”çš„å¹´è¥ä¸šé¢ä»ä¸Šä»»å‰çš„250äº¿ç¾å…ƒæˆé•¿åˆ°1400äº¿ç¾å…ƒï¼Œè·åˆ©ç”±15äº¿ç¾å…ƒä¸Šå‡åˆ°127äº¿ç¾å…ƒã€‚</p>
<h1 id="äºŒã€ç»©æ•ˆåŠæ´»åŠ›æ›²çº¿"><a href="#äºŒã€ç»©æ•ˆåŠæ´»åŠ›æ›²çº¿" class="headerlink" title="äºŒã€ç»©æ•ˆåŠæ´»åŠ›æ›²çº¿"></a>äºŒã€ç»©æ•ˆåŠæ´»åŠ›æ›²çº¿</h1><p>Jack Welchä½œä¸ºç»ç†äººæœ€æ˜¾è‘—çš„4å¤§ç‰¹ç‚¹ï¼šçœŸå®ã€æ´»åŠ›ã€å¦ç‡ã€å·®å¼‚åŒ–ç®¡ç†ã€‚</p>
<h2 id="2-1-çœŸå®"><a href="#2-1-çœŸå®" class="headerlink" title="2.1 çœŸå®"></a>2.1 çœŸå®</h2><p>ä¸€ä¸ªé¢†å¯¼è€…å¿…é¡»çœŸå®ã€‚é¢†å¯¼è€…ä¸å¿…åˆ»æ„å»æ‰®æ¼”ä»€ä¹ˆæ ·çš„è§’è‰²ï¼Œå› ä¸ºäººä»¬è½»æ˜“å‘ç°â€œä¼ªå›å­â€ï¼Œäººä»¬å¸Œæœ›çœ‹åˆ°çš„æ˜¯è¡¨é‡Œå¦‚ä¸€ä½ ï¼Œä½ å¯ä»¥ä¿¡ä»»ã€å¯ä»¥ä¾èµ–ã€å¯ä»¥å’Œç¦ã€èæ´½ç›¸å¤„ã€‚</p>
<h2 id="2-2-æ´»åŠ›"><a href="#2-2-æ´»åŠ›" class="headerlink" title="2.2 æ´»åŠ›"></a>2.2 æ´»åŠ›</h2><p>æ´»åŠ›ä¸æ¿€åŠ±ç´§å¯†å…³è”ï¼Œé¢†å¯¼è€…åº”è¯¥å…·æœ‰å¼ºçƒˆçš„ä½¿å‘½æ„Ÿå’Œæ˜ç¡®çš„æ„¿æ™¯ï¼Œå¹¶ä¸”å¯¹æ­¤åšä¿¡ä¸ç–‘ã€‚åŒæ—¶æ¿€åŠ±æ„ŸæŸ“ä¸è¿™ä¸ªæ„¿æ™¯ç›¸å…³çš„äººä¸»åŠ¨è¿½éšä½ å»è¿½æ±‚å‹¾å‹’å‡ºçš„ä½¿å‘½å’Œæ„¿æ™¯ã€‚æ¿€åŠ±çš„å…³é”®åœ¨äºè®©å›¢é˜Ÿæˆå‘˜æ„Ÿå—åˆ°æ„¿æ™¯ï¼Œæ˜ç™½å‰è¿›çš„æ–¹å‘ã€‚</p>
<h3 id="2-2-1-å¦‚ä½•æ¿€å‘æ´»åŠ›ï¼Ÿ"><a href="#2-2-1-å¦‚ä½•æ¿€å‘æ´»åŠ›ï¼Ÿ" class="headerlink" title="2.2.1 å¦‚ä½•æ¿€å‘æ´»åŠ›ï¼Ÿ"></a>2.2.1 å¦‚ä½•æ¿€å‘æ´»åŠ›ï¼Ÿ</h3><p>æ¿€å‘å›¢é˜Ÿæˆå‘˜çš„æ´»åŠ›ï¼Œéœ€è¦æ¿€å‘å¤§å®¶çš„äº’åŠ¨ï¼Œåˆ†äº«æ¯ä¸ªäººçš„çŸ¥è¯†ä¸ç»éªŒï¼Œä»æˆå‘˜èº«ä¸Šäº’ç›¸å­¦ä¹ ï¼Œæ±²å–é›†ä½“çš„æ™ºæ…§ï¼Œæœ€åè¾¾æˆç»Ÿä¸€å…±è¯†ã€‚</p>
<h2 id="2-3-å¦ç‡"><a href="#2-3-å¦ç‡" class="headerlink" title="2.3 å¦ç‡"></a>2.3 å¦ç‡</h2><p>å¦ç‡å°±æ˜¯è¦è®²å®è¯ï¼Œé¼“åŠ±å‘˜å·¥è¯´å‡ºè‡ªå·±çš„çœŸå®æƒ³æ³•ã€‚åœ¨è¿›è¡Œå·®å¼‚åŒ–ç®¡ç†çš„æ—¶å€™ï¼Œå¦ç‡æ˜¯å·®å¼‚åŒ–ç®¡ç†çš„åŸºç¡€ï¼Œç»„ç»‡è¦å¯¹å‘˜å·¥è¿›è¡Œå®¢è§‚çœŸå®çš„è¯„ä¼°ã€‚</p>
<h2 id="2-4-å·®å¼‚åŒ–ç®¡ç†"><a href="#2-4-å·®å¼‚åŒ–ç®¡ç†" class="headerlink" title="2.4 å·®å¼‚åŒ–ç®¡ç†"></a>2.4 å·®å¼‚åŒ–ç®¡ç†</h2><p>æ¯ä¸ªäººéƒ½åº”è¯¥æ¸…æ¥šè‡ªå·±åœ¨å›¢é˜Ÿä¸­çš„ä½ç½®ï¼Œ271åŸåˆ™å¯ä»¥è®©æ¯ä¸ªäººèƒ½å¤Ÿæ˜ç¡®è‡ªå·±çš„ä½ç½®ã€‚è™½ç„¶è¿™ä¸ªæœºåˆ¶å­˜åœ¨ä¸å°‘åè§ã€ä¸å…¬ï¼Œç”šè‡³ä¼šé€ æˆç§¯æ€¨ï¼Œä½†æ˜¯å°±å®é™…æ¥è¯´å®ƒæ˜¯æœ€æœ‰æ•ˆçš„æ–¹å¼è®©æˆå‘˜æ¸…æ¥šè‡ªå·±åœ¨ç»„ç»‡ä¸­çš„å®šä½ã€‚</p>
<h3 id="é¡¶å°–çš„20"><a href="#é¡¶å°–çš„20" class="headerlink" title="é¡¶å°–çš„20%"></a>é¡¶å°–çš„20%</h3><p>è¿™ç±»äººæ´»åŠ›åè¶³ã€ä¼šé¼“èˆä»–äººã€è®¨äººå–œæ¬¢ï¼ŒåŒæ—¶å®ƒä»¬å–œæ¬¢çœ‹åˆ°åˆ«äººæˆé•¿ã€å–œæ¬¢é¼“åŠ±åˆ«äººï¼Œä¸è‡ªç§å°æ°”ï¼Œåœ¨ä»–ä»¬èº«ä¸Šæœ‰ä¸€ç§æ…·æ…¨çš„ç²¾ç¥ã€‚ä»–ä»¬çœŸå¿ƒçš„ä¸ºä»–äººçš„æˆåŠŸæ„Ÿåˆ°é«˜å…´ã€èƒ½å¤Ÿä¸»åŠ¨ææ‹”äººæ‰ï¼Œå½¢æˆä¸€ç§ç§¯æçš„æ°›å›´ï¼Œæå¤§å¤§å®¶çš„æ½œåŠ›ã€‚</p>
<h3 id="ä¸­åšåŠ›é‡70"><a href="#ä¸­åšåŠ›é‡70" class="headerlink" title="ä¸­åšåŠ›é‡70%"></a>ä¸­åšåŠ›é‡70%</h3><p>è¿™ä¸ªç¾¤é‡Œè™½ç„¶ä¸æ˜¯ä¸¾è¶³è½»é‡çš„ï¼Œä½†æ˜¯ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™ç±»äººèªæ˜ã€ä¼˜ç§€ã€æœ‰ä»·å€¼ã€åŠªåŠ›å·¥ä½œã€‚</p>
<blockquote>
<h4 id="å­˜åœ¨å¤±å»21-26-è¿™ä¸ªåŒºé—´æˆå‘˜çš„é£é™©"><a href="#å­˜åœ¨å¤±å»21-26-è¿™ä¸ªåŒºé—´æˆå‘˜çš„é£é™©" class="headerlink" title="å­˜åœ¨å¤±å»21% - 26%è¿™ä¸ªåŒºé—´æˆå‘˜çš„é£é™©"></a>å­˜åœ¨å¤±å»21% - 26%è¿™ä¸ªåŒºé—´æˆå‘˜çš„é£é™©</h4><p>å¿…é¡»è¦ä¸æ–­çš„å»è§£é‡Šå½“å‰çš„è¯„ä¼°æ˜¯å‘¨æœŸæ€§çš„è€Œéæ°¸ä¹…çš„ï¼Œä»–ä»¬è¿˜æœ‰æå‡çš„ç©ºé—´ï¼ŒåŒæ—¶åœ¨è¯„ä¼°ä¸­è®°å½•ä»–ä»¬åšçš„å¥½çš„åœ°æ–¹ä»¥åŠå­˜åœ¨çš„é—®é¢˜å’Œéœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œå®šæœŸæ²Ÿé€šåŒæ­¥ï¼Œè¾¾æˆä¸€è‡´ã€‚</p>
</blockquote>
<h3 id="æœ«å°¾çš„10"><a href="#æœ«å°¾çš„10" class="headerlink" title="æœ«å°¾çš„10%"></a>æœ«å°¾çš„10%</h3><p>è¿™ç±»ç¾¤é‡Œçš„ç‰¹ç‚¹æœ‰ï¼šä¸æ“…é•¿å›¢é˜Ÿåˆä½œã€æ— ç²¾æ‰“é‡‡ã€å†·å˜²çƒ­è®½ï¼Œè¿™äº›äººèº«ä¸Šå……æ»¡è´Ÿèƒ½é‡è€Œä¸”æ€»å–œæ¬¢æ³¼å†·æ°´ã€‚</p>
<blockquote>
<h4 id="æ…å±€è€…æˆ–è€…æ˜¯æ³¼å‡‰æ°´çš„äºº"><a href="#æ…å±€è€…æˆ–è€…æ˜¯æ³¼å‡‰æ°´çš„äºº" class="headerlink" title="æ…å±€è€…æˆ–è€…æ˜¯æ³¼å‡‰æ°´çš„äºº"></a>æ…å±€è€…æˆ–è€…æ˜¯æ³¼å‡‰æ°´çš„äºº</h4><p>è¿™äº›äººä¸­æœ‰ä¸€äº›èªæ˜çš„äººï¼Œä»–ä»¬å‹‡äºæŒ‘æˆ˜æƒå¨ï¼Œæ•¢äºè¯´çœŸè¯ï¼Œè¿™äº›äººå€¼å¾—å°Šæ•¬ï¼Œé¢†å¯¼ç€ä¹Ÿåº”è¯¥å¬å–ä»–ä»¬çš„å£°éŸ³ã€‚æ‰€ä»¥å¯¹äºè¿™äº›äººè¦ç»™äºˆé€‚å½“çš„å®¹å¿ ï¼Œä½†è¦åšå¥½çº¦æŸã€‚</p>
</blockquote>
<p><font color="#ff0000">æ˜ä»¤ç¦æ­¢ï¼šå¤§ä¼šä¹‹åå¼€å°ä¼š</font></p>
<h2 id="2-5-ç»éªŒå»ºè®®"><a href="#2-5-ç»éªŒå»ºè®®" class="headerlink" title="2.5 ç»éªŒå»ºè®®"></a>2.5 ç»éªŒå»ºè®®</h2><h3 id="å¿«é€Ÿè¡ŒåŠ¨"><a href="#å¿«é€Ÿè¡ŒåŠ¨" class="headerlink" title="å¿«é€Ÿè¡ŒåŠ¨"></a>å¿«é€Ÿè¡ŒåŠ¨</h3><p>å½“æˆ‘ä»¬åšå‡ºå†³å®šåï¼Œæˆ‘ä»¬åº”è¯¥ç«‹å³è¡ŒåŠ¨ã€‚å³ä½¿æˆ‘ä»¬çš„å†³å®šé¢ä¸´é‡å¤§çš„åæœï¼Œä½†æ˜¯çŠ¹è±«ä¸èƒ½è®©æˆ‘ä»¬æŠŠè¿™ç§åæœé™ä½æˆ–æ¶ˆé™¤ï¼Œè¯¥æ¥çš„ç»ˆç©¶ä¼šæ¥ï¼ŒçŠ¹è±«ä¸å†³ç•ç•ç¼©ç¼©åè€Œä¼šå¼•èµ·ä¸ºä¸¥é‡çš„åæœã€‚</p>
<h3 id="ç»§ä»»è®¡åˆ’ï¼Œå¦‚ä½•ä¼ é€’å¥½äº¤æ¥æ£’ï¼Ÿ"><a href="#ç»§ä»»è®¡åˆ’ï¼Œå¦‚ä½•ä¼ é€’å¥½äº¤æ¥æ£’ï¼Ÿ" class="headerlink" title="ç»§ä»»è®¡åˆ’ï¼Œå¦‚ä½•ä¼ é€’å¥½äº¤æ¥æ£’ï¼Ÿ"></a>ç»§ä»»è®¡åˆ’ï¼Œå¦‚ä½•ä¼ é€’å¥½äº¤æ¥æ£’ï¼Ÿ</h3><p>æå‰å¯åŠ¨é€‰æ‹©å€™é€‰äººçš„å‡ ä¹ï¼Œäººæ˜¯ä¼šå˜çš„ï¼Œç”Ÿæ´»åœ¨å˜åŒ–ã€å®¶åº­å…³ç³»åœ¨å˜åŒ–ï¼Œä½ æ— æ³•çŸ¥é“åœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µäººä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿå¤šæŒ‘é€‰ä¸€äº›å€™é€‰äººï¼Œæå‰è¿›è¡Œã€‚</p>
<h3 id="é¼“åŠ±åº†ç¥èƒœåˆ©"><a href="#é¼“åŠ±åº†ç¥èƒœåˆ©" class="headerlink" title="é¼“åŠ±åº†ç¥èƒœåˆ©"></a>é¼“åŠ±åº†ç¥èƒœåˆ©</h3><p>ä»»ä½•å°å°çš„èƒœåˆ©éƒ½éœ€è¦åº†ç¥ï¼Œè¿™èƒ½æ¿€åŠ±æ•´ä¸ªå›¢é˜Ÿï¼Œé¼“åŠ±ä»–ä»¬ç»§ç»­åŠ æ²¹ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Jack Welchç®¡ç†çš„4å¤§ç‰¹ç‚¹ï¼šçœŸå®ã€æ´»åŠ›ã€å¦ç‡ã€å·®å¼‚åŒ–ç®¡ç†ã€‚</p>
<ul>
<li>çœŸå®ï¼šä¸€ä¸ªçœŸå®çš„é¢†å¯¼è€…æ‰èƒ½å¤Ÿè¢«ä¿¡ä»»å’Œä¾èµ–ï¼Œæ‰èƒ½å’Œå›¢é˜Ÿæˆå‘˜å’Œç¦ã€èæ´½ç›¸å¤„ã€‚</li>
<li>æ´»åŠ›ï¼šé¢†å¯¼è€…å¿…é¡»è¦è¦æœ‰æ˜ç¡®çš„ä½¿å‘½å’Œæ„¿æ™¯ï¼ŒåŒæ—¶æ„ŸæŸ“æ¿€åŠ±å›¢é˜Ÿæˆå‘˜ä¸»åŠ¨è¿½éšä½ å»è¿½æ±‚å‹¾å‹’å‡ºçš„ä½¿å‘½å’Œæ„¿æ™¯ã€‚æ¿€åŠ±çš„å…³é”®åœ¨äºè®©å›¢é˜Ÿæˆå‘˜æ„Ÿå—åˆ°ä½¿å‘½å’Œæ„¿æ™¯ï¼Œæ˜ç™½å‰è¿›çš„æ–¹å‘ã€‚</li>
<li>å¦ç‡ï¼šå¦ç‡æ˜¯å·®å¼‚åŒ–ç®¡ç†çš„åŸºç¡€ï¼Œåœ¨è¿›è¡Œå·®å¼‚åŒ–ç®¡ç†çš„æ—¶å€™ï¼Œç»„ç»‡ä¸æˆå‘˜ä¹‹é—´æ²Ÿé€šåé¦ˆå¿…é¡»å»ºç«‹åœ¨å¦ç‡çš„åŸºç¡€ä¹‹ä¸Šã€‚</li>
<li>å·®å¼‚åŒ–ç®¡ç†çœ‹ï¼šç»„ç»‡å†…éƒ¨éœ€è¦å»ºç«‹271æœºåˆ¶ï¼Œè™½ç„¶è¿™ä¸ªæœºåˆ¶å­˜åœ¨ä¸å°‘åè§ã€ä¸å…¬ï¼Œç”šè‡³ä¼šé€ æˆç§¯æ€¨ï¼Œä½†æ˜¯å°±å®é™…æ¥è¯´å®ƒæ˜¯æœ€æœ‰æ•ˆçš„æ–¹å¼è®©æˆå‘˜æ¸…æ¥šè‡ªå·±åœ¨ç»„ç»‡ä¸­çš„å®šä½ï¼Œä»è€Œå½¢æˆæ­£å‘æ¿€åŠ±ï¼Œæ¿€å‘å›¢é˜Ÿçš„æ´»åŠ›ã€‚271æœºåˆ¶ä¸­ï¼šé¡¶å°–çš„20%ï¼Œè¿™äº›äººå±äºAç±»å‘˜å·¥ï¼Œä»–ä»¬æ´»åŠ›åè¶³ä¸”èƒ½åŠ›ä¼˜ç§€åŒæ—¶èƒ½å¤Ÿä¸»åŠ¨åŸ¹å…»ææ‹”äººæ‰ï¼Œè¿™ç±»ç¾¤ä½“éœ€è¦ç»™äºˆå¤§å¹…æ¿€åŠ±å€¾æ–œï¼›ä¸­åšåŠ›é‡70%ï¼šè¿™äº›äººå±äºBç±»å‘˜å·¥ï¼Œä»–ä»¬æ˜¯å›¢é˜Ÿçš„ä¸­åšåŠ›é‡ï¼Œéœ€è¦æ³¨æ„21%-26%åŒºé—´äººï¼Œè¦åšå¥½è¯„ä¼°ç»“æœçš„åé¦ˆå’Œæ²Ÿé€šå¹¶è¾¾æˆä¸€è‡´ï¼ŒåŒæ—¶æä¾›æ›´å¤šæœºä¼šä¿ƒè¿›å…¶å‘å±•ï¼›æœ«å°¾çš„10%ï¼šå­˜åœ¨é—®é¢˜çš„å‘˜å·¥ï¼Œå¯¹äºè¿™ç±»ç¾¤ä½“ï¼Œå¦‚æœè¿˜æœ‰æ”¹å˜çš„ç©ºé—´ï¼Œå¯ä»¥ä¸ºå…¶æä¾›å¿…è¦æ”¯æŒå’Œå¸®åŠ©ï¼Œå¸®åŠ©ä»–ä»¬å¿«é€Ÿæ”¹å˜ï¼Œå¦åˆ™åº”å°½å¿«ä¼˜åŒ–å¤„ç†ã€‚</li>
<li>å¿«é€Ÿè¡ŒåŠ¨ï¼š å½“æˆ‘ä»¬åšå‡ºå†³å®šåï¼Œæˆ‘ä»¬åº”è¯¥ç«‹å³è¡ŒåŠ¨ã€‚å³ä½¿æˆ‘ä»¬çš„å†³å®šé¢ä¸´é‡å¤§çš„åæœï¼Œä½†æ˜¯çŠ¹è±«ä¸èƒ½è®©æˆ‘ä»¬æŠŠè¿™ç§åæœé™ä½æˆ–æ¶ˆé™¤ï¼Œè¯¥æ¥çš„ç»ˆç©¶ä¼šæ¥ï¼ŒçŠ¹è±«ä¸å†³ç•ç•ç¼©ç¼©åè€Œä¼šå¼•èµ·ä¸ºä¸¥é‡çš„åæœã€‚</li>
</ul>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>Jack Welch</tag>
        <tag>ç»©æ•ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ°äº†ä¸€å®šå¹´é¾„ï¼Œä½é…ç”Ÿæ´»ï¼Œé«˜é…çµé­‚</title>
    <url>/2022/03/03/thought/dao-liao-yi-ding-nian-ling-di-pei-sheng-huo-gao-pei-ling-hun/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡æ‘˜å½•è‡ªæ–°åç¤¾å¤œè¯»æ–‡ç« : <a href="https://mp.weixin.qq.com/s/mij2iW2C0UTIhWtl4lzdCQ">åˆ°äº†ä¸€å®šå¹´é¾„ï¼Œä½é…ç”Ÿæ´»ï¼Œé«˜é…çµé­‚</a></p>
</blockquote>
<blockquote>
<h1 id="part-1"><a href="#part-1" class="headerlink" title="part 1"></a>part 1</h1></blockquote>
<p>æœ‰ä½ä½œå®¶è¯´ï¼š<font color="#FF0000">â€œç®€æœ´çš„ç”Ÿæ´»ã€é«˜è´µçš„çµé­‚ï¼Œæ˜¯äººç”Ÿçš„è‡³é«˜å¢ƒç•Œã€‚â€</font></p>
<p>å¹´è½»æ—¶ï¼Œæˆ‘ä»¬æ€»ä»¥ä¸ºäººç”Ÿå°±æ˜¯è¦è¿½æ±‚â€œé«˜é…ç½®â€çš„ç”Ÿæ´»ï¼Œè¿½æ±‚è±ªåçš„è½¦å­ã€é«˜æ¡£çš„æˆ¿å­ã€ä½“é¢çš„å·¥ä½œâ€¦â€¦</p>
<p>æ¸æ¸åœ°ï¼Œèªæ˜çš„äººæ‡‚å¾—ï¼šå¦‚æœè¿‡äºè¿½æ±‚ç‰©è´¨çš„â€œé«˜é…â€ï¼Œèº«ä½“ç´¯ï¼Œå¿ƒæ›´ç´¯ï¼›é€‚å½“å‡å‡é…ç½®ï¼Œäººç”Ÿæ‰èƒ½æ´»å¾—è‡ªåœ¨ä»å®¹ã€‚</p>
<p>çœ‹è¿‡ä¸€å¥è¯ï¼šâ€œæ‹¥æœ‰å°±æ˜¯è¢«æ‹¥æœ‰ã€‚â€æ„æ€æ˜¯è¯´ï¼Œä¸€æ—¦æˆ‘ä»¬æ‹¥æœ‰äº†æŸæ ·ä¸œè¥¿ï¼Œä»é‚£ä¸€åˆ»èµ·ï¼Œæˆ‘ä»¬ä¹Ÿè¢«è¿™ä¸ªä¸œè¥¿æ‰€æ‹¥æœ‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ æ‹¥æœ‰äº†ä¸€è¾†æ±½è½¦ï¼Œä½ åŒæ—¶è¢«è¿™è¾†æ±½è½¦æ‹¥æœ‰ï¼Œä½ å¸¸æ‹…å¿ƒå®ƒè¢«å‰è¹­ã€è¢«å·ï¼Œä½ è¦ç»™å®ƒä¹°ä¿é™©ã€åšä¿å…»ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½ æ‹¥æœ‰äº†ä¸€ä»¶å¥¢ä¾ˆå“è¡£æœï¼Œä½ åŒæ—¶ä¹Ÿè¢«è¿™ä»¶è¡£æœæ‹¥æœ‰ï¼Œè„äº†è¦æ´—ã€çš±äº†è¦çƒ«ã€ç ´äº†è¦ä¿®ã€‚</p>
<p>æˆ‘ä»¬æ‹¥æœ‰çš„ä¸œè¥¿è¶Šå¤šï¼Œéœ€è¦æ‹…å¿ƒå’Œå…³æ³¨çš„å¤–éƒ¨äº‹ç‰©å°±è¶Šå¤šã€‚</p>
<p>ç›¸åï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç‰©è´¨ä¸Šè¿½æ±‚ç®€å•ï¼Œæ³¨æ„åŠ›å°±ä¸ä¼šè¢«å¤ªå¤šçš„å¤–ç‰©åˆ†æ•£ï¼Œå°±èƒ½é›†ä¸­ç²¾åŠ›å»åšè‡ªå·±å–œæ¬¢çš„äº‹ã€‚</p>
<p>å¾ˆè®¤å¯ä¸€å¥è¯ï¼šâ€œç®€å•çš„ç”Ÿæ´»ï¼Œä¸æ˜¯è‹¦è¡Œåƒ§å¼çš„è‡ªè™ï¼Œè€Œæ˜¯ä¸€ç§æ›´ä¸ºäººæ€§åŒ–çš„ã€ç»æµçš„ã€ç¯ä¿çš„ã€è½»æ¾æ„‰æ‚¦çš„ç”Ÿæ´»ã€‚â€</p>
<p>æˆ‘ä»¬æ€»æ˜¯å°è¯•æ‹¥æœ‰æ›´å¤šï¼Œå´å¾ˆå°‘é—®é—®è‡ªå·±ï¼šæ‹¥æœ‰è¿™ä¹ˆå¤šä¹‹åï¼Œæˆ‘å°±ä¼šå¹¸ç¦å—ï¼Ÿ</p>
<p>æ‰€è°“ç‰©è´¨ä½é…ï¼Œä¸æ˜¯è®©ä½ é™ä½ç”Ÿæ´»è´¨é‡ï¼Œè€Œæ˜¯åœ¨è¿™ä¸ªå……æ»¡é€‰æ‹©ä¸æ¬²æœ›çš„ä¸–ç•Œé‡Œï¼Œå­¦ä¼šè¾¨åˆ«ä¸èˆå¼ƒã€‚</p>
<p>ä½é…ç‰©è´¨ç”Ÿæ´»ï¼Œæ›´èƒ½æœ‰åŠ›åœ°æŒæ§è‡ªå·±çš„äººç”Ÿã€‚</p>
<blockquote>
<h1 id="part-2"><a href="#part-2" class="headerlink" title="part 2"></a>part 2</h1></blockquote>
<p>æœ‰ä¸€å¥è¯å¾ˆç»å…¸ï¼š<font color="#FF0000">â€œå½“ä½ çš„èƒ½åŠ›ã€åœ°ä½ã€èµ„æºé…ä¸ä¸Šä½ çš„ç¤¾äº¤é‡å¿ƒï¼Œä½ æ‰€åšçš„ä¸è¿‡æ˜¯æ— æ•ˆç¤¾äº¤ã€‚â€</font></p>
<p>ç”Ÿæ´»ä¸­ï¼Œæœ‰äº›äººé€¢äººå°±æ·»åŠ å¥½å‹ï¼Œä»¥ä¸ºè¿™å°±ç®—æ‹¥æœ‰äº†äººè„‰ã€‚</p>
<p>ä½†å½“ä½ æœ‰æ±‚äºäººæ—¶ï¼Œå‘ç°è‡ªèº«ä¸å‰å®³ï¼Œè®¤è¯†å†å¤šå‰å®³çš„äººä¹Ÿæ˜¯å¾’åŠ³ã€‚</p>
<p>äººåˆ°äº†ä¸€å®šå¹´é¾„ï¼Œè¦æ‡‚å¾—ç»™è‡ªå·±çš„åœˆå­åšå‡æ³•ï¼Œå‡å°‘èƒ½è€—ï¼ŒæŠŠæ›´å¤šçš„æ—¶é—´ç•™ç»™è‡ªå·±ï¼Œç•™ç»™å®¶äººã€‚</p>
<p>äººçš„ç²¾åŠ›æ˜¯æœ‰é™çš„ã€‚æ—¶é—´åœ¨å“ªé‡Œï¼Œæˆå°±ä¹Ÿå°±åœ¨å“ªé‡Œã€‚</p>
<p>å¦‚æœæŠŠæ‰€æœ‰çš„æ—¶é—´éƒ½ç”¨æ¥å»æ”€é™„æ‰€è°“çš„â€œç‰›äººåœˆå­â€ï¼Œå“ªæœ‰æ—¶é—´å»æå‡è‡ªå·±å‘¢ï¼Ÿ</p>
<p>çœŸæ­£æœ‰è´¨é‡çš„äººç”Ÿï¼Œéƒ½ä¸æ˜¯é æ‹¼å‘½ç¤¾äº¤å»ºç«‹èµ·æ¥çš„ã€‚</p>
<p>ä¸å…¶è®¨å¥½æ”€é™„é«˜é…çš„åœˆå­ï¼Œä¸å¦‚è¿‡å¥½è‡ªå·±çš„äººç”Ÿã€‚</p>
<blockquote>
<h1 id="part-3"><a href="#part-3" class="headerlink" title="part 3"></a>part 3</h1></blockquote>
<p>æœ‰äººæ›¾è¯´ï¼š<font color="#FF0000">â€œä¸€ä¸ªäººå¯¹å¤–åœ¨çš„ç‰©è´¨è¦æ±‚è¶Šä½ï¼Œä»–å¯¹å†…åœ¨çš„è¦æ±‚è¶Šé«˜ã€‚â€</font></p>
<p>ä¸€ä¸ªäººåªæ´»åœ¨ç‰©è´¨ä¸–ç•Œé‡Œï¼Œä¼šä¸€ç”ŸåŠ³ç¢Œã€å¿ƒçµç©ºè™šã€‚</p>
<p>å½“æˆ‘ä»¬ä¸å†è¿½æ±‚ç‰©è´¨çš„é«˜é…ï¼Œè€Œæ˜¯ä¿æŒå®é™çš„å¿ƒæ€ï¼Œå°±å®¹æ˜“åšåˆ°çµé­‚çš„é«˜é…ã€‚</p>
<p>â€œéæ·¡æ³Šæ— ä»¥æ˜å¿—ï¼Œéå®é™æ— ä»¥è‡´è¿œã€‚â€</p>
<p>æ·¡æ³Šä¸å®é™ï¼Œæ˜¯ä¸€ç§å® è¾±ä¸æƒŠçš„æ·¡ç„¶ä¸è±è¾¾ï¼Œæ˜¯ä¸€ç§æˆç†Ÿä¸ä»å®¹ï¼Œä¹Ÿæ˜¯çµé­‚é«˜é…çš„ä¸€ç§å¢ƒç•Œã€‚</p>
<p>åˆ°äº†ä¸€å®šå¹´é¾„ï¼Œè¯·è¿‡â€œä½é…â€ç”Ÿæ´»ã€‚â€œä½é…â€ä¸æ˜¯ä¸æ€è¿›å–ï¼Œè€Œæ˜¯å¼ å¼›æœ‰åº¦ï¼Œä¸æ”€ä¸æ¯”ï¼Œä¸æƒ³å¤ªå¤šã€‚</p>
<p>è¡£æœä¸ä¸€å®šè¦ç©¿åç‰Œï¼Œèˆ’é€‚å°±å¥½ï¼›æˆ¿å­ä¸ä¸€å®šè¦è±ªåï¼Œå¹²å‡€å°±å¥½ï¼›è½¦å­ä¸ä¸€å®šè¦é«˜æ¡£ï¼Œèƒ½ä»£æ­¥å°±å¥½ï¼›åœˆå­ä¸ä¸€å®šé«˜ç«¯ï¼Œæœ‰ä¸‰äº”ä¸ªçŸ¥å¿ƒæœ‹å‹å°±å¥½ã€‚</p>
<h1 id="ä¸€ç‚¹ç‚¹æƒ³æ³•"><a href="#ä¸€ç‚¹ç‚¹æƒ³æ³•" class="headerlink" title="ä¸€ç‚¹ç‚¹æƒ³æ³•"></a>ä¸€ç‚¹ç‚¹æƒ³æ³•</h1><p>æ–°åç¤¾çš„å¤œè¯»æ–‡ç« æ€»æ˜¯å¼•äººæ·±æ€ï¼Œâ€œä½é…ç”Ÿæ´»ï¼Œé«˜é…çµé­‚â€è¿™ç§æ€æƒ³æ›´æ˜¯å¼•èµ·äº†æˆ‘çš„å…±é¸£ï¼Œåœ¨è¿™ä¸ä¹…ä¹‹å‰ï¼Œè‡ªå·±å–œæ¬¢ä¹°ä¸€äº›å°ç‰©ä»¶ä»¥åŠä¸€äº›æµè¡Œçš„ä¸œè¥¿ï¼Œå–œæ¬¢æŠŠæ¡Œå­æ‘†çš„æ»¡æ»¡å½“å½“çš„ã€‚é‡åˆ°ä¸€äº›å–œæ¬¢çš„å°ç‰©ä»¶ï¼Œæ€»æ˜¯æƒ³ä¹°æ¥æ‘†åœ¨å±‹é‡Œã€‚<br>æœ€è¿‘è¯»äº†ã€Šæ´»å‡ºç”Ÿå‘½çš„æ„ä¹‰ã€‹ã€ã€Šæç®€ä¸»ä¹‰ã€‹è¿™ä¸¤æœ¬ä¹¦ï¼Œå¿½ç„¶å†…å¿ƒç”Ÿå‡ºä¸€ä¸æ˜æ‚Ÿï¼Œåœ¨äººç”Ÿæœ‰é™çš„æ—¶é—´é‡Œï¼Œåˆ°åº•ä»€ä¹ˆæ‰æ˜¯å¯¹è‡ªå·±æ¥è¯´æ¯”è¾ƒé‡è¦çš„ä¸œè¥¿ï¼Ÿåœ¨å½“ä»£ç‰©æ¬²æ¨ªæµçš„ç¤¾ä¼šï¼Œå­˜åœ¨ç€å¤šå°‘ç‰©è´¨ä¸Šçš„å¯Œäººï¼Œç²¾ç¥ä¸Šçš„ç©·äººå‘¢ï¼Ÿ<br>éšç€ç»å†äººç”Ÿçš„ç§ç§äº‹æƒ…ï¼Œæˆ‘å¯¹ä¸€ä¸ªäººçš„å¼ºå¤§æœ‰äº†æ–°çš„å®šä¹‰ï¼šä¸€ä¸ªçœŸæ­£å¼ºå¤§çš„äººï¼Œä¸æ˜¯ä»–èº«å±…é«˜ä½ã€ä¹Ÿä¸æ˜¯ä»–æ‹¥æœ‰å¤šå°‘è´¢å¯Œï¼Œè€Œæ˜¯ä»–é¢å¯¹ä»»ä½•äº‹æƒ…çš„å® è¾±ä¸æƒŠçš„æ·¡ç„¶ä¸è±è¾¾ã€‚è€Œè¿™ç§æ·¡ç„¶ä¸è±è¾¾æ˜¯ç»å†äº†å¤šå°‘è‰°éš¾é™©é˜»ã€åˆ»éª¨é“­å¿ƒçš„ç»å†äº†ä¹‹åç»ƒå°±çš„ï¼Œ<br>äººç”Ÿæ˜¯ä¸€åœºä¿®ç‚¼ï¼Œè¶ç€å¹´è½»å¤šå»ç»å†ä¸€äº›å¥½çš„åçš„äº‹æƒ…ï¼Œè¿½æ±‚è‡ªå·±çœŸæ­£æƒ³è¦çš„å¹¸ç¦ï¼ŒåŠªåŠ›æˆé•¿ä¸ºä¸€ä¸ªæ·¡ç„¶ä¸è±è¾¾çš„äººã€‚</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>ä½é…ç”Ÿæ´»</tag>
        <tag>é«˜é…çµé­‚</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»å¹´åº•äººæ‰ç›˜ç‚¹è¯„å§”å¸­ï¼Œçœ‹æ‰“å·¥äººä¸ºä»€ä¹ˆè¦æŠŠè‡ªå·±&quot;äº§å“åŒ–&quot;</title>
    <url>/2025/12/29/thought/cong-nian-di-ren-cai-pan-dian-ping-wei-xi-kan-da-gong-ren-wei-shi-me-yao-ba-zi-ji-chan-pin-hua/</url>
    <content><![CDATA[<blockquote>
<p>ä¸€ä¸ªäººçš„ä¸€ç”Ÿï¼Œæœ€é‡è¦çš„äº‹ä¸šå°±æ˜¯ç»è¥å¥½è‡ªå·±ã€‚æŠŠâ€œè‡ªå·±â€å½“ä½œä¸€æ¬¾æŒç»­è¿­ä»£çš„äº§å“ï¼Œå»ºç«‹æ¸…æ™°çš„å®šä½ã€ç¨³å®šçš„ä»·å€¼äº¤ä»˜ã€å¯è§„æ¨¡åŒ–çš„å¢é•¿ä¸è¿è¥ä½“ç³»ï¼Œä½ ä¼šæ›´å¿«ã€æ›´ç¨³åœ°æŠµè¾¾æƒ³å»çš„åœ°æ–¹ã€‚</p>
</blockquote>
<p><img src="/2025/12/29/thought/cong-nian-di-ren-cai-pan-dian-ping-wei-xi-kan-da-gong-ren-wei-shi-me-yao-ba-zi-ji-chan-pin-hua/%E6%8A%8A%E8%87%AA%E5%B7%B1%E4%BA%A7%E5%93%81%E5%8C%96.png" alt="æŠŠè‡ªå·±äº§å“åŒ–"></p>
<p>ä½œä¸ºå…¬å¸å¹´åº•äººæ‰ç›˜ç‚¹çš„è¯„å§”ï¼Œè¿™å‡ å¹´æˆ‘åå¤çœ‹åˆ°åŒä¸€ä¸ªç”»é¢ï¼šæœ‰çš„äººåœ¨åŸåœ°è¸æ­¥ï¼Œæœ‰çš„äººå¿™å¾—æ˜å¤©é»‘åœ°å´éš¾æœ‰çªç ´ï¼Œè¿˜æœ‰çš„äººæ˜æ˜èªæ˜ã€è‚¯å¹²ï¼Œå´åœ¨å…³é”®èŠ‚ç‚¹ä¸€å†ä¸æœºä¼šæ“¦è‚©è€Œè¿‡ã€‚æ›´æ‰å¿ƒçš„æ˜¯ï¼Œä»–ä»¬ä¸­çš„ç»å¤§å¤šæ•°ï¼Œå¹¶ä¸æ˜¯â€œä¸å¤ŸåŠªåŠ›â€ï¼Œè€Œæ˜¯ä¸çŸ¥é“<strong>è¯¥å¾€å“ªé‡Œç”¨åŠ›</strong>ã€‚</p>
<span id="more"></span>

<p>å¦‚æœä½ æŠŠè‡ªå·±çœ‹æˆä¸€ä¸ªâ€œå²—ä½ä¸Šçš„èºä¸é’‰â€ï¼Œä½ è‡ªç„¶ä¼šä¹ æƒ¯æ€§åœ°ç­‰ä»»åŠ¡ã€åšæ‰§è¡Œã€ç›¯è€ƒæ ¸ï¼›ä½†å¦‚æœä½ å¼€å§‹æŠŠè‡ªå·±å½“æˆä¸€æ¬¾â€œäº§å“â€ï¼Œä½ å°±ä¼šå€’è¿‡æ¥æ€è€ƒï¼š</p>
<ul>
<li>æˆ‘åˆ°åº•<strong>è§£å†³ä»€ä¹ˆé—®é¢˜</strong>ï¼Ÿ</li>
<li>æˆ‘ç›¸å¯¹äºåŒé¾„äººã€åŒå²—ä½çš„<strong>ç‹¬ç‰¹ä»·å€¼</strong>æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>è¿™äº›ä»·å€¼ï¼Œèƒ½ä¸èƒ½è¢«<strong>å°è£…æˆèµ„äº§</strong>ï¼Œåœ¨æˆ‘ä¸äº²è‡ªç›¯ç€çš„æ—¶å€™ä¹Ÿèƒ½æŒç»­å‘æŒ¥ä½œç”¨ï¼Ÿ</li>
</ul>
<p>è¿™æ­£æ˜¯ã€Šçº³ç“¦å°”å®å…¸ã€‹é‡Œâ€œæŠŠè‡ªå·±äº§å“åŒ–â€çš„åº•å±‚é€»è¾‘ï¼Œè€Œåœ¨æˆ‘ä¸€æ¬¡æ¬¡çš„äººæ‰è¯„å®¡ä¸­ï¼Œä¹Ÿè¶Šæ¥è¶Šç¡®å®šï¼š<strong>èƒ½æŠŠè‡ªå·±äº§å“åŒ–çš„äººï¼Œå‡ ä¹éƒ½ä¸ä¼šè¢«æ—¶ä»£è½»æ˜“æ·˜æ±°ã€‚</strong></p>
<h2 id="ä¸€ã€ä»è¯„å§”å¸­çœ‹åˆ°çš„æ‰“å·¥äººå›°å¢ƒ"><a href="#ä¸€ã€ä»è¯„å§”å¸­çœ‹åˆ°çš„æ‰“å·¥äººå›°å¢ƒ" class="headerlink" title="ä¸€ã€ä»è¯„å§”å¸­çœ‹åˆ°çš„æ‰“å·¥äººå›°å¢ƒ"></a>ä¸€ã€ä»è¯„å§”å¸­çœ‹åˆ°çš„æ‰“å·¥äººå›°å¢ƒ</h2><p>äººæ‰ç›˜ç‚¹çš„æ—¶å€™ï¼Œè¯„å§”ä¸ä¼šåªçœ‹â€œä½ æœ‰å¤šè¾›è‹¦â€ï¼Œè€Œæ˜¯çœ‹â€œä½ è¿™ä¸¤ä¸‰å¹´åˆ°åº•é•¿æˆäº†ä¸€ä¸ªä»€ä¹ˆæ ·çš„â€˜äº§å“â€™â€ã€‚åœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼Œå¾ˆå¤šèŒåœºå›°å¢ƒè¢«æ”¾å¤§å¾—æ ¼å¤–æ¸…æ™°ã€‚</p>
<h3 id="1-å¾ˆåŠªåŠ›ï¼Œä½†é—®é¢˜é€‰é”™äº†"><a href="#1-å¾ˆåŠªåŠ›ï¼Œä½†é—®é¢˜é€‰é”™äº†" class="headerlink" title="1. å¾ˆåŠªåŠ›ï¼Œä½†é—®é¢˜é€‰é”™äº†"></a>1. å¾ˆåŠªåŠ›ï¼Œä½†é—®é¢˜é€‰é”™äº†</h3><p>æœ‰ä¸€ç±»äººï¼Œå…¨å¹´å·¥æ—¶ã€é¡¹ç›®æ•°é‡éƒ½å¾ˆå¥½çœ‹ï¼Œæ—¥æŠ¥ã€å‘¨æŠ¥å¯†å¯†éº»éº»ï¼Œä½†å½“æˆ‘ä»¬å»çœ‹â€œç»“æœâ€â€”â€”</p>
<ul>
<li>å¯å¤ç”¨çš„æ²‰æ·€å¾ˆå°‘ï¼šæ–‡æ¡£æ•£è½å„å¤„ï¼Œæ²¡æœ‰å½¢æˆæ–¹æ³•è®ºï¼›</li>
<li>å¯¹ä¸šåŠ¡çš„å…³é”®æŒ‡æ ‡å½±å“æœ‰é™ï¼šåšäº†å¾ˆå¤šâ€œå¿™äº‹â€ï¼ŒçœŸæ­£æ”¹å˜ä¸šåŠ¡ç›˜é¢çš„æˆæœä¸å¤šï¼›</li>
<li>æ›¿ä»£æˆæœ¬å¾ˆä½ï¼šç¦»å¼€è¿™ä¸ªäººï¼Œä¸€ä¸¤ä¸ªæœˆå°±å¯ä»¥æ‰¾åˆ°å·®ä¸å¤šçš„æ›¿è¡¥ã€‚</li>
</ul>
<p>ä»–ä»¬çš„é—®é¢˜ä¸æ˜¯ä¸åŠªåŠ›ï¼Œè€Œæ˜¯<strong>åªåœ¨â€œå–æ—¶é—´â€è€Œæ²¡æœ‰â€œé€ èµ„äº§â€</strong>ã€‚è¿™ç±»äººåœ¨è¯„å®¡ä¸­ï¼Œç»©æ•ˆä¹Ÿè®¸ä¸å·®ï¼Œä½†å¾ˆéš¾åœ¨å…³é”®æ™‹å‡èŠ‚ç‚¹è¯„ä¸ºâ€œå¼ºçƒˆæ¨èâ€ã€‚</p>
<h3 id="2-ä¸çŸ¥é“å¾€å“ªå„¿ç”¨åŠ›"><a href="#2-ä¸çŸ¥é“å¾€å“ªå„¿ç”¨åŠ›" class="headerlink" title="2. ä¸çŸ¥é“å¾€å“ªå„¿ç”¨åŠ›"></a>2. ä¸çŸ¥é“å¾€å“ªå„¿ç”¨åŠ›</h3><p>ç¬¬äºŒç±»äººï¼Œå…¸å‹è¡¨ç°æ˜¯ï¼š</p>
<ul>
<li>å¹³æ—¶ä¹Ÿåœ¨å­¦ä¹ ï¼Œä½†å†…å®¹éå¸¸ç¢ç‰‡åŒ–ï¼Œä»Šå¤©ç®—æ³•ï¼Œæ˜å¤©è‹±è¯­ï¼Œåå¤©æ–°æ¡†æ¶ï¼›</li>
<li>é‡åˆ°æ–°æœºä¼šï¼Œå¾ˆå®¹æ˜“è¢«â€œåˆ«äººéƒ½åœ¨åšâ€çš„å£°éŸ³å¸¦ç€èµ°ï¼›</li>
<li>ä¸€å¹´åˆ°å¤´å›å¤´çœ‹ï¼Œä¼¼ä¹ä»€ä¹ˆéƒ½å­¦äº†ä¸€ç‚¹ï¼Œåˆä¼¼ä¹ä»€ä¹ˆéƒ½æ²¡çœŸæ­£å»ºç«‹å£å’ã€‚</li>
</ul>
<p>ã€Šå¼‚ç±»ã€‹é‡Œæœ‰ä¸ªé‡è¦è§‚ç‚¹ï¼šçœŸæ­£çš„â€œå¼‚ç±»â€ï¼Œä¸æ˜¯å¶ç„¶çš„å¤©èµ‹å¼‚ç¦€ï¼Œè€Œæ˜¯åœ¨æŸä¸ªæ–¹å‘ä¸Š<strong>é•¿æœŸã€èšç„¦ã€å¸¦åé¦ˆçš„åˆ»æ„ç»ƒä¹ </strong>å åŠ äº†ç¯å¢ƒä¼˜åŠ¿ã€‚å¤§é‡å¹³åº¸çš„åŠªåŠ›ï¼Œæœ¬è´¨ä¸Šæ˜¯å› ä¸ºæ²¡æœ‰é€‰å®šä¸€ä¸ªè¶³å¤Ÿæ¸…æ™°çš„â€œèµ›é“â€ï¼Œä¹Ÿæ²¡æœ‰ä¸ºè‡ªå·±è®¾è®¡ä¸€ä¸ªå¯æŒç»­è¿­ä»£çš„â€œäº§å“è·¯çº¿å›¾â€ã€‚</p>
<h3 id="3-æŠŠè‡ªå·±å®Œå…¨äº¤ç»™å…¬å¸æµç¨‹"><a href="#3-æŠŠè‡ªå·±å®Œå…¨äº¤ç»™å…¬å¸æµç¨‹" class="headerlink" title="3. æŠŠè‡ªå·±å®Œå…¨äº¤ç»™å…¬å¸æµç¨‹"></a>3. æŠŠè‡ªå·±å®Œå…¨äº¤ç»™å…¬å¸æµç¨‹</h3><p>è¿˜æœ‰ä¸€ç±»äººï¼Œä»–ä»¬èƒ½åŠ›ä¸é”™ã€æ€åº¦ä¹Ÿä¸å·®ï¼Œä½†ä¹ æƒ¯äºï¼š</p>
<ul>
<li>ç­‰ leader åˆ†é…ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ä¸»åŠ¨æå‡ºé—®é¢˜ã€è®¾è®¡æ–¹æ¡ˆï¼›</li>
<li>ç­‰ç»„ç»‡å®‰æ’åŸ¹è®­ï¼Œè€Œä¸æ˜¯æ ¹æ®è‡ªå·±çš„äº§å“å®šä½å»â€œåå‘å®šåˆ¶â€å­¦ä¹ è·¯å¾„ï¼›</li>
<li>ç­‰é¡¹ç›®â€œè½®åˆ°è‡ªå·±â€ï¼Œè€Œä¸æ˜¯ä¸»åŠ¨äº‰å–å…³é”®æˆ˜å½¹çš„å‚æˆ˜æœºä¼šã€‚</li>
</ul>
<p>åœ¨å…¬å¸è§†è§’é‡Œ,è¿™æ ·çš„äººå¾€å¾€è¢«å®šä¹‰ä¸ºâ€ç¨³å®šã€å¯é ã€å¯ç”¨â€,ä½†å¾ˆéš¾è¢«è§†ä¸ºâ€æ ¸å¿ƒç§å­é€‰æ‰‹â€ã€‚ä¸æ˜¯å› ä¸ºä»–ä»¬ä¸èªæ˜,è€Œæ˜¯å› ä¸ºä»–ä»¬ä»æ²¡æŠŠè‡ªå·±å½“ä½œä¸€ä¸ªç‹¬ç«‹è¿è½¬çš„â€äº§å“â€,å»ä¸»åŠ¨æ€è€ƒ:<strong>æˆ‘è¦æˆä¸ºä»€ä¹ˆæ ·çš„äºº,é ä»€ä¹ˆä»·å€¼è¢«è®°ä½ã€è¢«éœ€è¦?</strong></p>
<p><img src="/2025/12/29/thought/cong-nian-di-ren-cai-pan-dian-ping-wei-xi-kan-da-gong-ren-wei-shi-me-yao-ba-zi-ji-chan-pin-hua/%E6%89%93%E5%B7%A5%E4%BA%BA%E5%9B%B0%E5%A2%83vs%E6%9D%A0%E6%9D%86%E6%95%88%E5%BA%94.png" alt="æ‰“å·¥äººå›°å¢ƒvsæ æ†æ•ˆåº”"></p>
<h2 id="äºŒã€ä¸ºä»€ä¹ˆè¦æŠŠè‡ªå·±äº§å“åŒ–"><a href="#äºŒã€ä¸ºä»€ä¹ˆè¦æŠŠè‡ªå·±äº§å“åŒ–" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆè¦æŠŠè‡ªå·±äº§å“åŒ–?"></a>äºŒã€ä¸ºä»€ä¹ˆè¦æŠŠè‡ªå·±äº§å“åŒ–?</h2><p>åœ¨ã€Šçº³ç“¦å°”å®å…¸ã€‹é‡Œï¼Œçº³ç“¦å°”åå¤å¼ºè°ƒï¼šçœŸæ­£çš„â€œè´¢å¯Œâ€ï¼Œä¸æ˜¯å·¥èµ„å•ï¼Œè€Œæ˜¯<strong>åœ¨ä½ ç¡è§‰æ—¶è¿˜èƒ½æ›¿ä½ èµšé’±çš„èµ„äº§</strong>ã€‚è¿™å¥—é€»è¾‘æ”¾åˆ°ä¸ªä½“èº«ä¸Šï¼Œå°±æ˜¯â€”â€”</p>
<ul>
<li><strong>æ—¶é—´æ— æ³•æ— é™å‡ºå”®</strong>ï¼šä½ æ¯å¤©åªæœ‰ 24 å°æ—¶ï¼Œé åŠ ç­å †å‡ºæ¥çš„æ”¶å…¥ï¼Œå¤©èŠ±æ¿æ³¨å®šå¾ˆä½ï¼›</li>
<li><strong>èµ„äº§æ‰èƒ½æ›¿ä½ å·¥ä½œ</strong>ï¼šå†™è¿‡çš„ä»£ç ã€æ­è¿‡çš„ç³»ç»Ÿã€æ²‰æ·€çš„æ–¹æ³•è®ºã€å¯¹è¡Œä¸šçš„ç†è§£ï¼Œå¦‚æœè¢«å°è£…æˆæ–‡æ¡£ã€è¯¾ç¨‹ã€å·¥å…·ã€å½±å“åŠ›ï¼Œå°±èƒ½åœ¨ä½ ä¸åœ¨åœºæ—¶æŒç»­å‘æŒ¥ä»·å€¼ï¼›</li>
<li><strong>æŠ€æœ¯ä¸äº’è”ç½‘æ”¾å¤§â€œå¤´éƒ¨ä¸ªä½“â€</strong>ï¼šæ—¶ä»£è¶Šæ¥è¶Šåçˆ±â€œèƒ½ç›´æ¥ä¸ºå¤§é‡äººç¾¤åˆ›é€ ä»·å€¼çš„äººâ€ã€‚å¦‚æœä½ åªåœ¨ç»„ç»‡å†…éƒ¨ã€åªä¸ºä¸Šçº§ä¸€ä¸ªäººåˆ›é€ ä»·å€¼ï¼Œä½ å¾ˆéš¾äº«å—åˆ°è¿™ç§æ”¾å¤§æ•ˆåº”ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œâ€œæŠŠè‡ªå·±äº§å“åŒ–â€å¹¶ä¸æ˜¯è¦ä½ ç«‹åˆ»è¾èŒåˆ›ä¸šï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p>ç”¨<strong>å•†ä¸šä¸–ç•Œçš„è§†è§’</strong>é‡æ–°å®¡è§†è‡ªå·±ï¼šæˆ‘ç©¶ç«Ÿæ˜¯ä¸€æ¬¾ä»€ä¹ˆäº§å“ï¼Ÿç°åœ¨å¤„åœ¨ä»€ä¹ˆç‰ˆæœ¬ï¼Ÿæœªæ¥è¦è¿­ä»£æˆä»€ä¹ˆæ ·ï¼Ÿ</p>
</blockquote>
<p>å½“ä½ è¿™æ ·æ€è€ƒæ—¶ï¼Œä½ ä¼šè‡ªç„¶ä»â€œæ‰“å·¥æ€ç»´â€åˆ‡æ¢åˆ°â€œç»è¥æ€ç»´â€ï¼š</p>
<ul>
<li>ä¸å†åªçœ‹ä»Šå¹´ç»©æ•ˆ,è€Œä¼šçœ‹ 3~5 å¹´åè‡ªå·±èƒ½å¦æˆä¸ºç¨€ç¼ºèµ„äº§;</li>
<li>ä¸å†åªç›¯æ‰‹ä¸Šçš„ä»»åŠ¡,è€Œä¼šä¸»åŠ¨è®¾è®¡è‡ªå·±çš„â€åŠŸèƒ½çŸ©é˜µâ€å’Œâ€æŠ¤åŸæ²³â€;</li>
<li>ä¸å†åªå…³å¿ƒé¢†å¯¼æ€ä¹ˆçœ‹ä½ ,è€Œä¼šå…³å¿ƒ:<strong>å¸‚åœºä¼šä¸ä¼šä¸ºä½ ä¹°å•</strong>ã€‚</li>
</ul>
<p><img src="/2025/12/29/thought/cong-nian-di-ren-cai-pan-dian-ping-wei-xi-kan-da-gong-ren-wei-shi-me-yao-ba-zi-ji-chan-pin-hua/%E5%BB%BA%E7%AB%8B%E4%BA%A7%E5%93%81%E6%80%9D%E7%BB%B4.png" alt="å»ºç«‹äº§å“æ€ç»´"></p>
<h2 id="ä¸‰ã€ç»™è‡ªå·±åšä¸€æ¬¡â€äº§å“ä½“æ£€â€-æ‰¾åˆ°å±äºä½ çš„ä¼˜åŠ¿ä½"><a href="#ä¸‰ã€ç»™è‡ªå·±åšä¸€æ¬¡â€äº§å“ä½“æ£€â€-æ‰¾åˆ°å±äºä½ çš„ä¼˜åŠ¿ä½" class="headerlink" title="ä¸‰ã€ç»™è‡ªå·±åšä¸€æ¬¡â€äº§å“ä½“æ£€â€:æ‰¾åˆ°å±äºä½ çš„ä¼˜åŠ¿ä½"></a>ä¸‰ã€ç»™è‡ªå·±åšä¸€æ¬¡â€äº§å“ä½“æ£€â€:æ‰¾åˆ°å±äºä½ çš„ä¼˜åŠ¿ä½</h2><p>ã€Šå¼‚ç±»ã€‹æé†’æˆ‘ä»¬ï¼šæ‰€è°“â€œå¤©èµ‹ + æœºä¼šâ€ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸æ˜¯å¤©ä¸Šæ‰ä¸‹æ¥çš„ï¼Œè€Œæ˜¯ä½ èƒ½ä¸èƒ½<strong>çœ‹è§è‡ªå·±é€‚åˆçš„èµ›é“ï¼Œå¹¶æ•¢äºåœ¨ä¸Šé¢é•¿æœŸä¸‹æ³¨</strong>ã€‚</p>
<p>æŠŠè‡ªå·±äº§å“åŒ–çš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯è¯šå®åœ°å®Œæˆä¸€æ¬¡â€œäº§å“ä½“æ£€â€ã€‚ä½ å¯ä»¥ä»ä¸‰ä¸ªç»´åº¦æ¥ç›˜ä¸€ç›˜ï¼š</p>
<h3 id="1-ä½ çš„â€œå“ç±»â€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-ä½ çš„â€œå“ç±»â€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. ä½ çš„â€œå“ç±»â€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1. ä½ çš„â€œå“ç±»â€æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å…ˆä¸è¦æ€¥ç€åˆ—æŠ€èƒ½è¡¨ï¼Œå…ˆé—®è‡ªå·±ï¼š</p>
<ul>
<li>å¦‚æœæŠŠä½ å½“æˆä¸€ä¸ªäº§å“ï¼Œä½ ç°åœ¨å±äºä»€ä¹ˆâ€œç±»åˆ«â€ï¼Ÿ<ul>
<li>æ˜¯â€œè§£å†³å¤æ‚æŠ€æœ¯é—®é¢˜çš„å·¥ç¨‹å¸ˆâ€ï¼Ÿ</li>
<li>æ˜¯â€œèƒ½æŠŠæŠ½è±¡é—®é¢˜ç¿»è¯‘æˆå¯æ‰§è¡Œæ–¹æ¡ˆçš„ PMâ€ï¼Ÿ</li>
<li>è¿˜æ˜¯â€œèƒ½æŠŠæ··ä¹±é¡¹ç›®æ‹‰å›æ­£è½¨çš„é¡¹ç›®ç»ç†â€ï¼Ÿ</li>
</ul>
</li>
</ul>
<p>ä¸€ä¸ªç²—ç³™ä½†å¥½ç”¨çš„åˆ¤æ–­æ˜¯ï¼š</p>
<blockquote>
<p><strong>å½“åˆ«äººå‘ä½ æ±‚åŠ©æ—¶ï¼Œæœ€å¸¸é—®çš„æ˜¯å“ªä¸€ç±»é—®é¢˜ï¼Ÿ</strong></p>
</blockquote>
<p>é‚£å¾ˆå¯èƒ½å°±æ˜¯ä½ åœ¨åˆ«äººçœ¼é‡Œâ€œå·²ç»æ¯”è¾ƒå¥½ç”¨â€çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯ä½ æœªæ¥å¯ä»¥ç»§ç»­å¼ºåŒ–çš„æ–¹å‘ã€‚</p>
<h3 id="2-ä½ çš„â€œæ ¸å¿ƒä¼˜åŠ¿â€åœ¨å“ªï¼Ÿ"><a href="#2-ä½ çš„â€œæ ¸å¿ƒä¼˜åŠ¿â€åœ¨å“ªï¼Ÿ" class="headerlink" title="2. ä½ çš„â€œæ ¸å¿ƒä¼˜åŠ¿â€åœ¨å“ªï¼Ÿ"></a>2. ä½ çš„â€œæ ¸å¿ƒä¼˜åŠ¿â€åœ¨å“ªï¼Ÿ</h3><p>ä¼˜åŠ¿ä¸åªæ˜¯â€œæˆ‘ä¼šä»€ä¹ˆâ€ï¼Œè€Œæ˜¯<strong>åœ¨çœŸå®åœºæ™¯ä¸‹ï¼Œä½ æ¯”åˆ«äººæ›´å®¹æ˜“åšå‡ºçš„å¥½ç»“æœ</strong>ã€‚å¯ä»¥ä»è¿™ä¸‰ä¸ªäº¤é›†å»æ‰¾ï¼š</p>
<ul>
<li>ä½ åšèµ·æ¥<strong>ä¸é‚£ä¹ˆè´¹åŠ²</strong>ï¼Œåˆ«äººå´è§‰å¾—å¾ˆéš¾çš„äº‹ï¼›</li>
<li>ä½ åå¤åšï¼Œç»“æœ<strong>ç¨³å®šåœ¨ä¸­ä¸Šæ°´å¹³ä»¥ä¸Š</strong>ï¼›</li>
<li>ä¸ºè¿™ä»¶äº‹<strong>åˆ«äººæ„¿æ„ä»˜è´¹</strong>ï¼Œæˆ–æ„¿æ„æŠŠå…³é”®ä»»åŠ¡äº¤ç»™ä½ ã€‚</li>
</ul>
<p>æŠŠè¿™äº›å…·ä½“åœºæ™¯å†™ä¸‹æ¥ï¼Œä¸è¦åªå†™â€œæ“…é•¿æ²Ÿé€šâ€ï¼Œè€Œæ˜¯å†™ï¼š</p>
<ul>
<li>åœ¨å¤šæ–¹åšå¼ˆçš„é¡¹ç›®ä¸­ï¼Œä½ å¦‚ä½•æ’®åˆå…±è¯†ï¼Ÿ</li>
<li>åœ¨ä¸€æ¬¡é‡è¦çº¿ä¸Šäº‹æ•…ä¸­ï¼Œä½ å¦‚ä½•ä¸»æŒå¤ç›˜ï¼Ÿ</li>
</ul>
<p>è¿™äº›åœºæ™¯ï¼Œå°±æ˜¯ä½ â€œäº§å“è¯´æ˜ä¹¦â€é‡Œæœ€é‡è¦çš„éƒ¨åˆ†ã€‚</p>
<h3 id="3-ä½ çš„â€œç¯å¢ƒä¼˜åŠ¿â€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-ä½ çš„â€œç¯å¢ƒä¼˜åŠ¿â€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3. ä½ çš„â€œç¯å¢ƒä¼˜åŠ¿â€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>3. ä½ çš„â€œç¯å¢ƒä¼˜åŠ¿â€æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ã€Šå¼‚ç±»ã€‹å¼ºè°ƒäº†â€œå‡ºç”Ÿæ—¶é—´ã€è¡Œä¸šå‘¨æœŸã€æ–‡åŒ–ç¯å¢ƒâ€å¯¹ä¸ªä½“çš„å·¨å¤§å½±å“ã€‚ä½ æ— æ³•é‡æ¥ä¸€éï¼Œä½†ä½ å¯ä»¥é—®ï¼š</p>
<ul>
<li>ä½ æ‰€åœ¨çš„è¡Œä¸šã€å…¬å¸ã€å²—ä½ï¼Œç°åœ¨æ­£å¤„åœ¨ä»€ä¹ˆå‘¨æœŸï¼Ÿæ˜¯ä¸Šå‡æœŸè¿˜æ˜¯å­˜é‡åšå¼ˆï¼Ÿ</li>
<li>ä½ çš„ä¸Šçº§ã€åŒäº‹ã€èµ„æºç½‘ç»œï¼Œæ›´åå‘å“ªç§ç±»å‹çš„æœºä¼šï¼Ÿ</li>
<li>ä½ çš„ä¸šä½™æ—¶é—´ã€å…´è¶£çˆ±å¥½ï¼Œæ˜¯å¦ç»™ä½ å¸¦æ¥äº†æŸç§â€œéšæ€§ä¼˜åŠ¿â€ï¼Ÿ</li>
</ul>
<p>æŠŠè¿™äº›å¤–éƒ¨æ¡ä»¶çœ‹æ¸…,æ˜¯ä¸ºäº†é¿å…ä¸€ç§å¸¸è§è¯¯åŒº:<strong>ç”¨é”™è¯¯çš„ç¯å¢ƒè§£é‡Šè‡ªå·±çš„èƒ½åŠ›é—®é¢˜,æˆ–è€…ç”¨é”™è¯¯çš„èƒ½åŠ›å»å¯¹æŠ—ç¯å¢ƒé—®é¢˜ã€‚</strong></p>
<p><img src="/2025/12/29/thought/cong-nian-di-ren-cai-pan-dian-ping-wei-xi-kan-da-gong-ren-wei-shi-me-yao-ba-zi-ji-chan-pin-hua/%E4%BC%98%E5%8A%BF%E5%AE%9A%E4%BD%8D%E9%9B%B7%E8%BE%BE.png" alt="ä¼˜åŠ¿å®šä½é›·è¾¾"></p>
<h2 id="å››ã€äº”æ­¥å®æ“-æŠŠè‡ªå·±ä»â€å‘˜å·¥â€å‡çº§ä¸ºâ€äº§å“â€"><a href="#å››ã€äº”æ­¥å®æ“-æŠŠè‡ªå·±ä»â€å‘˜å·¥â€å‡çº§ä¸ºâ€äº§å“â€" class="headerlink" title="å››ã€äº”æ­¥å®æ“:æŠŠè‡ªå·±ä»â€å‘˜å·¥â€å‡çº§ä¸ºâ€äº§å“â€"></a>å››ã€äº”æ­¥å®æ“:æŠŠè‡ªå·±ä»â€å‘˜å·¥â€å‡çº§ä¸ºâ€äº§å“â€</h2><p>åšå®Œâ€ä½“æ£€â€ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®æ“ç¯èŠ‚ã€‚ä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº”æ­¥ï¼ŒæŠŠè‡ªå·±å½“ä½œä¸€ä¸ªè¦ä¸Šå¸‚çš„äº§å“æ¥ç»è¥ã€‚</p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph LR
    A[æ­¥éª¤1&lt;br&#x2F;&gt;æ˜ç¡®ä»·å€¼ä¸»å¼ ] --&gt; B[æ­¥éª¤2&lt;br&#x2F;&gt;ç›˜ç‚¹åŠŸèƒ½ç»„ä»¶]
    B --&gt; C[æ­¥éª¤3&lt;br&#x2F;&gt;å…è´¹å†…å®¹æµ‹è¯•]
    C --&gt; D{åé¦ˆ&lt;br&#x2F;&gt;å¦‚ä½•?}
    D --&gt;|ç§¯æ| E[æ­¥éª¤4&lt;br&#x2F;&gt;å°è£…äº§å“]
    D --&gt;|ä¸€èˆ¬| F[è°ƒæ•´ä¼˜åŒ–]
    F --&gt; C
    E --&gt; G[æ­¥éª¤5&lt;br&#x2F;&gt;é€‰æ‹©æ æ†]
    G --&gt; H[æŒç»­è¿­ä»£]
    H --&gt; I{éœ€è¦&lt;br&#x2F;&gt;è°ƒæ•´?}
    I --&gt;|æ˜¯| A
    I --&gt;|å¦| J[æˆåŠŸ:å»ºç«‹æŠ¤åŸæ²³]
    
    style A fill:#e3f2fd
    style E fill:#e1f5e1
    style G fill:#fff9c4
    style J fill:#ffebee
    style D fill:#fff4e1
    style I fill:#fff4e1
  </pre></div>

<p><strong>æ æ†ç±»å‹è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>åˆæœŸ</strong>ï¼šäººåŠ›æ æ†ï¼ˆå¸¦äººã€åˆ†äº«ç»éªŒï¼‰</li>
<li><strong>ä¸­æœŸ</strong>ï¼šåª’ä½“æ æ†ï¼ˆæ–‡æ¡£ã€æ–‡ç« ã€å·¥å…·ï¼‰</li>
<li><strong>æˆç†ŸæœŸ</strong>ï¼šèµ„æœ¬æ æ†ï¼ˆå“ç‰Œã€é¡¹ç›®æŠ•èµ„ï¼‰</li>
</ul>
<h3 id="ç¬¬ä¸€æ­¥ï¼šå†™æ¸…ä½ çš„â€œä»·å€¼ä¸»å¼ â€"><a href="#ç¬¬ä¸€æ­¥ï¼šå†™æ¸…ä½ çš„â€œä»·å€¼ä¸»å¼ â€" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå†™æ¸…ä½ çš„â€œä»·å€¼ä¸»å¼ â€"></a>ç¬¬ä¸€æ­¥ï¼šå†™æ¸…ä½ çš„â€œä»·å€¼ä¸»å¼ â€</h3><p>æ‹¿å‡ºä¸€å¼ çº¸ï¼Œåªå›ç­”ä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>å¦‚æœç”¨ä¸€ä¸¤å¥è¯ä»‹ç»è‡ªå·±ï¼Œä½ å¸Œæœ›åˆ«äººè®°ä½ä½ â€œèƒ½å¸®ä»–ä»¬è§£å†³ä»€ä¹ˆé—®é¢˜â€ï¼Ÿ</p>
</blockquote>
<p>é¿å…å†™æˆâ€œç©ºå¿ƒåŒ–æ ‡ç­¾â€ï¼ˆå¦‚ï¼šè´Ÿè´£ XX æ¨¡å—å¼€å‘ã€å‚ä¸ YY é¡¹ç›®ï¼‰ï¼Œè€Œæ˜¯å†™æˆ<strong>å¯¹ä»–äººçš„å…·ä½“ä»·å€¼</strong>ï¼š</p>
<ul>
<li>â€œæˆ‘æ“…é•¿æŠŠæ··ä¹±çš„éœ€æ±‚æ‹†è§£æˆå¯è½åœ°æ–¹æ¡ˆï¼Œå¹¶æ¨åŠ¨å¤šæ–¹åä½œè½åœ°â€ï¼›</li>
<li>â€œæˆ‘ä¸“æ³¨åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç³»ç»Ÿç¨³å®šæ€§å»ºè®¾ï¼Œèƒ½è®¾è®¡å‡ºå¯æ‰©å±•çš„æ²»ç†æ–¹æ¡ˆâ€ï¼›</li>
<li>â€œæˆ‘èƒ½æŠŠæŠ½è±¡çš„æŠ€æœ¯æ¦‚å¿µè®²æ¸…æ¥šï¼Œè®©ä¸šåŠ¡æ–¹çœŸæ­£ç†è§£æŠ€æœ¯é€‰æ‹©èƒŒåçš„ trade-offâ€ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯ä½ çš„â€œäº§å“å®šä½æ–‡æ¡ˆâ€ã€‚å…ˆä¸è¿½æ±‚å®Œç¾ï¼Œå†™å‡ºæ¥ã€æŒ‚åœ¨æ¡Œå‰ï¼Œåé¢å¯ä»¥ä¸æ–­è¿­ä»£ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥ï¼šç›˜ç‚¹å¯äº§å“åŒ–çš„â€œåŠŸèƒ½ç»„ä»¶â€"><a href="#ç¬¬äºŒæ­¥ï¼šç›˜ç‚¹å¯äº§å“åŒ–çš„â€œåŠŸèƒ½ç»„ä»¶â€" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šç›˜ç‚¹å¯äº§å“åŒ–çš„â€œåŠŸèƒ½ç»„ä»¶â€"></a>ç¬¬äºŒæ­¥ï¼šç›˜ç‚¹å¯äº§å“åŒ–çš„â€œåŠŸèƒ½ç»„ä»¶â€</h3><p>å¯¹ç…§ä½ çš„è¿‡å¾€ç»å†ï¼ŒæŠŠé‚£äº›å·²ç»äº§ç”Ÿè¿‡å¥½ç»“æœçš„è¡Œä¸ºï¼Œæ‹†æˆå¯å¤ç”¨çš„â€œåŠŸèƒ½ç»„ä»¶â€ï¼š</p>
<ul>
<li>ä½ æ˜¯å¦æœ‰ä¸€å¥—<strong>å›ºå®šçš„åˆ†ææ¡†æ¶</strong>ï¼Ÿï¼ˆæ¯”å¦‚æ’æŸ¥çº¿ä¸Šæ•…éšœæ—¶çš„æ­¥éª¤ï¼‰</li>
<li>ä½ æ˜¯å¦æœ‰ä¸€äº›<strong>å¸¸ç”¨çš„æ¨¡æ¿</strong>ï¼Ÿï¼ˆå¤ç›˜æ¨¡æ¿ã€é¡¹ç›®è§„åˆ’æ¨¡æ¿ã€æ²Ÿé€šé‚®ä»¶æ¨¡æ¿ç­‰ï¼‰</li>
<li>ä½ æ˜¯å¦åœ¨æŸäº›åœºæ™¯é‡Œå½¢æˆäº†<strong>ä¸ªäºº playbook</strong>ï¼Ÿï¼ˆå¦‚ä½•å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®ã€å¦‚ä½•å¸¦æ–°äººä¸Šæ‰‹ç­‰ï¼‰</li>
</ul>
<p>è¿™äº›ä¸œè¥¿ï¼Œéƒ½æ˜¯å¯ä»¥è¢«â€œäº§å“åŒ–â€çš„é›å½¢ï¼š</p>
<ul>
<li>å…ˆæ•´ç†æˆç»“æ„åŒ–çš„æ–‡æ¡£ã€æµç¨‹å›¾ã€æ¸…å•ï¼›</li>
<li>å†åœ¨å›¢é˜Ÿå†…ã€å°èŒƒå›´åˆ†äº«ï¼›</li>
<li>å†æ…¢æ…¢å¯¹å¤–è¾“å‡ºï¼Œå˜æˆæ–‡ç« ã€åˆ†äº«ã€æˆ–å†…éƒ¨è¯¾ç¨‹ã€‚</li>
</ul>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šç”¨â€œå…è´¹å†…å®¹â€æµ‹è¯•å¸‚åœº"><a href="#ç¬¬ä¸‰æ­¥ï¼šç”¨â€œå…è´¹å†…å®¹â€æµ‹è¯•å¸‚åœº" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šç”¨â€œå…è´¹å†…å®¹â€æµ‹è¯•å¸‚åœº"></a>ç¬¬ä¸‰æ­¥ï¼šç”¨â€œå…è´¹å†…å®¹â€æµ‹è¯•å¸‚åœº</h3><p>ã€Šçº³ç“¦å°”å®å…¸ã€‹åå¤æåˆ°ï¼šåœ¨ä½ å°è¯•æ”¶è´¹ä¹‹å‰ï¼Œå…ˆç”¨å…è´¹å†…å®¹å»ºç«‹ä¿¡ä»»ã€‚å¯¹æ‰“å·¥äººæ¥è¯´ï¼Œâ€œå…è´¹å†…å®¹â€å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>åœ¨å…¬å¸å†…ç½‘å†™ç»“æ„åŒ–çš„å¤ç›˜å’Œç»éªŒåˆ†äº«ï¼›</li>
<li>åœ¨ç¤¾äº¤åª’ä½“ä¸Šè¾“å‡ºä½ åœ¨æŸä¸ªç»†åˆ†é¢†åŸŸçš„æ€è€ƒä¸æ¡ˆä¾‹ï¼›</li>
<li>ç»™æ–°äººå½•å±è®²è§£æŸä¸ªç³»ç»Ÿæˆ–å·¥å…·çš„ä½¿ç”¨ï¼Œå¹¶æ•´ç†æˆå…¬å¼€ææ–™ã€‚</li>
</ul>
<p>è¿™ä¸ªé˜¶æ®µï¼Œä¸è¦æ€¥äºç®—â€œæŠ•å…¥äº§å‡ºæ¯”â€ï¼Œæ›´é‡è¦çš„æ˜¯ï¼š</p>
<ul>
<li>çœ‹çœ‹å¤§å®¶<strong>ä¼šä¸ä¼šè½¬å‘ã€æ”¶è—ã€è¯„è®ºã€æ¥é—®ä½ é—®é¢˜</strong>ï¼›</li>
<li>çœ‹çœ‹ä½ çš„å“ªç±»å†…å®¹<strong>æœ€å®¹æ˜“å¼•å‘å…±é¸£</strong>ï¼Œå“ªç±»å†…å®¹å¤§å®¶â€œä¸å¤ªåœ¨æ„â€ï¼›</li>
<li>çœ‹çœ‹æ˜¯å¦æœ‰äººæ„¿æ„<strong>å› ä¸ºä½ ï¼Œè€Œé€‰æ‹©å‚ä¸æŸä¸ªé¡¹ç›®æˆ–å›¢é˜Ÿ</strong>ã€‚</li>
</ul>
<p>è¿™äº›åé¦ˆï¼Œå°±æ˜¯ä½ çš„â€œç”¨æˆ·æ•°æ®â€ã€‚</p>
<h3 id="ç¬¬å››æ­¥ï¼šè®¾è®¡ä¸€ä¸¤ä¸ªâ€œå¯å¤åˆ¶â€çš„æ­£å¼äº§å“"><a href="#ç¬¬å››æ­¥ï¼šè®¾è®¡ä¸€ä¸¤ä¸ªâ€œå¯å¤åˆ¶â€çš„æ­£å¼äº§å“" class="headerlink" title="ç¬¬å››æ­¥ï¼šè®¾è®¡ä¸€ä¸¤ä¸ªâ€œå¯å¤åˆ¶â€çš„æ­£å¼äº§å“"></a>ç¬¬å››æ­¥ï¼šè®¾è®¡ä¸€ä¸¤ä¸ªâ€œå¯å¤åˆ¶â€çš„æ­£å¼äº§å“</h3><p>å½“ä½ å‘ç°æŸäº›è¾“å‡ºå·²ç»ç¨³å®šå—åˆ°æ¬¢è¿ï¼Œå°±å¯ä»¥å¾€å‰è¿ˆä¸€æ­¥ï¼ŒæŠŠå®ƒä»¬å°è£…æˆæ›´â€œæ­£å¼â€çš„äº§å“å½¢æ€ï¼š</p>
<ul>
<li>é¢å‘å†…éƒ¨ï¼šå¯ä»¥æ˜¯ä¸€é—¨ç³»ç»ŸåŒ–çš„å°è¯¾ã€ä¸€å¥—å·¥å…·åº“ã€ä¸€å¥—æœ€ä½³å®è·µæ‰‹å†Œï¼›</li>
<li>é¢å‘å¤–éƒ¨ï¼šå¯ä»¥æ˜¯ç³»åˆ—æ–‡ç« ã€çº¿ä¸Šå¾®è¯¾ã€å¼€æºé¡¹ç›®ã€Newsletter ç­‰ã€‚</li>
</ul>
<p>å…³é”®æ˜¯ä¸¤ä¸ªå­—ï¼š</p>
<ul>
<li><strong>å¯å¤åˆ¶</strong>ï¼šä¸ä¾èµ–ä½ æ¯æ¬¡ä»å¤´åšï¼Œè€Œæ˜¯å¯ä»¥è¢«ä»–äººå¤ç”¨ï¼›</li>
<li><strong>å¯è§„æ¨¡åŒ–</strong>ï¼šä¸€ä»½æŠ•å…¥å¯ä»¥æœåŠ¡æ›´å¤šäººï¼Œè€Œä¸åªæ˜¯å•ç‚¹æœåŠ¡ã€‚</li>
</ul>
<p>ä»è¯„å§”è§†è§’çœ‹ï¼Œè¿™ä¸€æ­¥éå¸¸å…³é”®â€”â€”å½“ä¸€ä¸ªäººèƒ½å›´ç»•æŸä¸ªè®®é¢˜å»ºç«‹èµ·<strong>ç¨³å®šã€æŒç»­çš„ä»·å€¼è¾“å‡ºä½“ç³»</strong>æ—¶ï¼Œä»–åœ¨ç»„ç»‡é‡Œçš„æ ‡ç­¾å°±ä¼šä»â€œèƒ½å¹²æ´»â€å‡çº§ä¸ºâ€œè¿™å—é¢†åŸŸå¯ä»¥æ‰¾ä»–â€ã€‚</p>
<h3 id="ç¬¬äº”æ­¥ï¼šé€‰æ‹©åˆé€‚çš„æ æ†ï¼Œé€æ­¥æ”¾å¤§"><a href="#ç¬¬äº”æ­¥ï¼šé€‰æ‹©åˆé€‚çš„æ æ†ï¼Œé€æ­¥æ”¾å¤§" class="headerlink" title="ç¬¬äº”æ­¥ï¼šé€‰æ‹©åˆé€‚çš„æ æ†ï¼Œé€æ­¥æ”¾å¤§"></a>ç¬¬äº”æ­¥ï¼šé€‰æ‹©åˆé€‚çš„æ æ†ï¼Œé€æ­¥æ”¾å¤§</h3><p>çº³ç“¦å°”æŠŠæ æ†åˆ†ä¸ºä¸‰ç±»ï¼š<strong>äººåŠ›ã€èµ„æœ¬ã€ä»£ç  &#x2F; åª’ä½“</strong>ã€‚å¯¹å¤§å¤šæ•°èŒåœºäººæ¥è¯´ï¼Œå¯ä»¥å¾ªåºæ¸è¿›åœ°ç”¨ï¼š</p>
<ul>
<li><strong>äººåŠ›æ æ†</strong>ï¼šå¸¦æ–°äººã€ç»„å°å›¢é˜Ÿï¼Œé€šè¿‡æ•™ä¼šåˆ«äººæ¥æ”¾å¤§è‡ªå·±çš„æ–¹æ³•è®ºï¼›</li>
<li><strong>ä»£ç  &#x2F; åª’ä½“æ æ†</strong>ï¼šå†™å·¥å…·ã€å†™æ–‡æ¡£ã€å†™æ–‡ç« ã€åšåˆ†äº«ï¼Œè®©â€œä½ ä¸åœ¨åœºæ—¶ï¼Œä½ çš„ä»·å€¼è¿˜åœ¨åœºâ€ï¼›</li>
<li><strong>èµ„æœ¬æ æ†</strong>ï¼šéšç€ç§¯ç´¯ï¼Œé€‚åº¦æŠ•èµ„åœ¨è‡ªå·±çš„ç»§ç»­æ•™è‚²ã€ä¸ªäººå“ç‰Œå»ºè®¾æˆ–å°é¡¹ç›®ä¸Šã€‚</li>
</ul>
<p>ä¸å¿…ä¸€å¼€å§‹å°±â€œall inâ€ï¼Œè€Œæ˜¯æ¯å¹´ä¸ºè‡ªå·±è®¾è®¡ä¸€ä¸ªå°ç›®æ ‡ï¼š</p>
<ul>
<li>ä»Šå¹´,æˆ‘è‡³å°‘å®Œæˆä¸€é—¨ç³»ç»ŸåŒ–çš„å†…éƒ¨åˆ†äº«;</li>
<li>ä»Šå¹´,æˆ‘è‡³å°‘æŠŠä¸€ä¸ªé›¶æ•£çš„èƒ½åŠ›æ²‰æ·€æˆä¸€ä»½å¯å¤ç”¨çš„â€äº§å“â€;</li>
<li>ä»Šå¹´,æˆ‘è‡³å°‘é€šè¿‡è¾“å‡º,è®¤è¯† X ä¸ªé¢†åŸŸå†…çš„åŒè¡Œæˆ–å‰è¾ˆã€‚</li>
</ul>
<p><img src="/2025/12/29/thought/cong-nian-di-ren-cai-pan-dian-ping-wei-xi-kan-da-gong-ren-wei-shi-me-yao-ba-zi-ji-chan-pin-hua/%E4%B8%AA%E4%BA%BA%E4%BA%A7%E5%93%81%E5%8C%96%E8%BF%AD%E4%BB%A3%E8%B7%AF%E5%BE%84.png" alt="ä¸ªäººäº§å“åŒ–è¿­ä»£è·¯å¾„"></p>
<h2 id="äº”ã€å¸¸è§è¯¯åŒº-è¯„å§”è§†è§’ç»™ä½ çš„å‡ ç‚¹æé†’"><a href="#äº”ã€å¸¸è§è¯¯åŒº-è¯„å§”è§†è§’ç»™ä½ çš„å‡ ç‚¹æé†’" class="headerlink" title="äº”ã€å¸¸è§è¯¯åŒº:è¯„å§”è§†è§’ç»™ä½ çš„å‡ ç‚¹æé†’"></a>äº”ã€å¸¸è§è¯¯åŒº:è¯„å§”è§†è§’ç»™ä½ çš„å‡ ç‚¹æé†’</h2><p>åœ¨è¯„å§”å¸­ä¸Šï¼Œæˆ‘çœ‹åˆ°ä¸å°‘â€œè‡ªæˆ‘æå‡â€åšå¾—å¾ˆç”¨åŠ›ï¼Œä½†æ–¹å‘æ˜æ˜¾è·‘åçš„æ¡ˆä¾‹ï¼Œå¤§è‡´é›†ä¸­åœ¨å‡ ç±»è¯¯åŒºï¼š</p>
<ul>
<li><p><strong>æŠŠâ€œå‰¯ä¸šâ€å½“â€œäº§å“â€</strong>ï¼š</p>
<ul>
<li>åšå¾®å•†ã€è·‘ç½‘çº¦è½¦ã€åšçº¯ä½“åŠ›å‹å…¼èŒï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨â€œå–æ—¶é—´â€ï¼›</li>
<li>çœŸæ­£çš„äº§å“åŒ–ï¼Œæ˜¯è®©ä½ çš„ä¸“ä¸šèƒ½åŠ›ã€è®¤çŸ¥å’Œå½±å“åŠ›ï¼Œé€šè¿‡æŸç§å½¢å¼æ²‰æ·€ä¸‹æ¥ï¼ŒæŒç»­åˆ›é€ ä»·å€¼ã€‚</li>
</ul>
</li>
<li><p><strong>æ€¥äºå®šä»·æ”¶è´¹</strong>ï¼š</p>
<ul>
<li>åˆ†äº«äº†å‡ ç¯‡æ–‡ç« ã€å¸®å‡ ä¸ªäººç­”ç–‘ï¼Œå°±è¿«ä¸åŠå¾…åšä»˜è´¹è¯¾ã€å–å’¨è¯¢ï¼›</li>
<li>åœ¨ä¿¡ä»»å’Œå£ç¢‘è¿˜æ²¡å»ºç«‹ä¹‹å‰ï¼Œè¿™ç§è¡Œä¸ºå¾€å¾€ä¼šæŸå®³ä½ çš„é•¿æœŸå“ç‰Œã€‚</li>
</ul>
</li>
<li><p><strong>åªçœ‹çŸ­æœŸ ROIï¼Œå¿½è§†é•¿æœŸå“ç‰Œ</strong>ï¼š</p>
<ul>
<li>æœ‰çš„äººåªæ„¿æ„åšâ€œå½“å¤©æœ‰æ•°æ®â€çš„äº‹æƒ…ï¼Œä¸æ„¿æ„åšâ€œæ…¢çƒ­ä½†å¤åˆ©â€çš„ç§¯ç´¯ï¼›</li>
<li>ä½†åœ¨äººæ‰ç›˜ç‚¹æ—¶ï¼Œæˆ‘ä»¬çœ‹çš„å¾€å¾€æ˜¯<strong>è¿‡å»ä¸¤ä¸‰å¹´çš„æ•´ä½“æˆé•¿è½¨è¿¹</strong>å’Œåœ¨å…³é”®æˆ˜å½¹ä¸­çš„è¡¨ç°ï¼Œè€Œä¸æ˜¯ä½ æŸä¸€æ¬¡â€œçˆ†æ¬¾â€ã€‚</li>
</ul>
</li>
<li><p><strong>æŠŠäº§å“åŒ–ç†è§£æˆâ€œä¸ªäººåŒ…è£…â€ç”šè‡³â€œäººè®¾è¿è¥â€</strong>ï¼š</p>
<ul>
<li>è¿™ä¼šå¯¼è‡´ä½ ä¸æ•¢æš´éœ²é—®é¢˜ï¼Œä¸æ„¿æ„æ‰¿è®¤è‡ªå·±è¿˜åœ¨å­¦ä¹ ï¼›</li>
<li>ä½†å¯¹è¯„å§”æ¥è¯´ï¼ŒçœŸæ­£åŠ åˆ†çš„å¾€å¾€æ˜¯ï¼šä½ èƒ½å¦æ­£è§†è‡ªå·±çš„çŸ­æ¿ï¼Œå¹¶ä¸”æ‹¿å‡º<strong>æ¸…æ™°çš„è‡ªæˆ‘è¿­ä»£è®¡åˆ’</strong>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="ç»“è¯­ï¼šæŠŠè‡ªå·±å½“æˆä¸€ä¸ªé•¿æœŸé¡¹ç›®"><a href="#ç»“è¯­ï¼šæŠŠè‡ªå·±å½“æˆä¸€ä¸ªé•¿æœŸé¡¹ç›®" class="headerlink" title="ç»“è¯­ï¼šæŠŠè‡ªå·±å½“æˆä¸€ä¸ªé•¿æœŸé¡¹ç›®"></a>ç»“è¯­ï¼šæŠŠè‡ªå·±å½“æˆä¸€ä¸ªé•¿æœŸé¡¹ç›®</h2><p>çº³ç“¦å°”è¯´ï¼šâ€œè‡´å¯Œä¸æ˜¯é è¿æ°”ï¼Œè€Œæ˜¯ä¸€å¥—å¯ä»¥å­¦ä¹ çš„æŠ€èƒ½ã€‚â€åœ¨æˆ‘çœ‹æ¥ï¼Œâ€œå­¦ä¼šç»è¥è‡ªå·±ã€æŠŠè‡ªå·±äº§å“åŒ–â€æ­£æ˜¯è¿™å¥—æŠ€èƒ½åœ¨èŒåœºä¸­çš„å…·ä½“è½åœ°æ–¹å¼ã€‚</p>
<p>å›åˆ°æœ€å¼€å§‹çš„äººæ‰ç›˜ç‚¹ç°åœºï¼š</p>
<ul>
<li>æœ‰çš„äººï¼Œåœ¨ PPT ä¸Šå †æ»¡äº†â€œå‚ä¸äº†å“ªäº›é¡¹ç›®â€ï¼›</li>
<li>æœ‰çš„äººï¼Œåˆ™èƒ½æ¸…æ™°è®²å‡ºä¸‰ä»¶äº‹â€”â€”è‡ªå·±åœ¨è¿™å‡ å¹´é‡Œåˆ°åº•è§£å†³äº†ä»€ä¹ˆå…³é”®é—®é¢˜ã€æ²‰æ·€äº†ä»€ä¹ˆå¯å¤åˆ¶çš„èµ„äº§ã€å¦‚ä½•ç”¨è¿™äº›èµ„äº§å»æ‹¥æŠ±ä¸‹ä¸€è½®æœºä¼šã€‚</li>
</ul>
<p>è¯„å§”çš„é€‰æ‹©ï¼Œå¾€å¾€å°±è—åœ¨è¿™ä¸¤ç§å™äº‹çš„å·®å¼‚é‡Œã€‚</p>
<p><strong>ä½ å¯ä»¥ä»ä»Šå¤©å¼€å§‹ï¼Œç»™è‡ªå·±åšä¸‰ä»¶å°äº‹ï¼š</strong></p>
<ol>
<li>å†™ä¸‹ä½ çš„â€œä»·å€¼ä¸»å¼ â€ä¸€å¥è¯ç‰ˆæœ¬ï¼›</li>
<li>é€‰å‡ºä¸€æ®µæœ€èƒ½ä»£è¡¨ä½ ä¼˜åŠ¿çš„ç»å†ï¼ŒæŠŠè¿‡ç¨‹å’Œæ–¹æ³•å†™æˆä¸€ç¯‡æ–‡ç« æˆ–ä¸€ä»½åˆ†äº«æçº²ï¼›</li>
<li>çº¦ä¸€ä½åŒäº‹æˆ–æœ‹å‹ï¼Œè®¤çœŸèŠä¸€æ¬¡â€œä½ çœ¼ä¸­çš„æˆ‘å“ªé‡Œæœ€æœ‰ä»·å€¼â€ã€‚</li>
</ol>
<p>å½“ä½ æ„¿æ„ä»¥â€œäº§å“ç»ç†â€çš„è§†è§’æ¥ç»è¥è‡ªå·±ï¼Œæ„¿æ„ä¸ºè‡ªå·±çš„â€œç‰ˆæœ¬è¿­ä»£â€è´Ÿè´£æ—¶ï¼Œä½ å°±å·²ç»ä»å¤§å¤šæ•°è¢«åŠ¨ç­‰å¾…è¯„ä¼°çš„æ‰“å·¥äººä¸­èµ°äº†å‡ºæ¥ã€‚æ¥ä¸‹æ¥è¦åšçš„ï¼Œåªæ˜¯ç¨³æ­¥è¿­ä»£ï¼Œè€Œæ—¶é—´ï¼Œä¼šåœ¨ä¸çŸ¥ä¸è§‰é—´ï¼Œç«™åˆ°ä½ è¿™ä¸€è¾¹ã€‚</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>ä¸ªäººæˆé•¿</tag>
        <tag>äº§å“åŒ–</tag>
        <tag>è‡ªæˆ‘ç®¡ç†</tag>
        <tag>è®¤çŸ¥å‡çº§</tag>
        <tag>å¤ç›˜</tag>
      </tags>
  </entry>
  <entry>
    <title>åè¨€åå¥ &amp; æ€è€ƒæ„Ÿæ‚Ÿ</title>
    <url>/2024/04/06/thought/ming-yan-ming-ju-si-kao-gan-wu/</url>
    <content><![CDATA[<blockquote>
<p>æœ€è¿‘å‡ å¹´è¯»äº†ä¸€äº›ä¹¦ï¼Œç»å†äº†ä¸€äº›äº‹ï¼Œæƒ³æ¸…æ¥šäº†ä¸€äº›äº‹ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•æ—¥å¸¸ä¸­èƒ½å¤Ÿå¼•èµ·å…±é¸£çš„ä¸€äº›åè¨€åå¥ä»¥åŠè‡ªæˆ‘çš„ä¸€äº›æ€è€ƒã€è®¤çŸ¥å’Œæ„Ÿæ‚Ÿã€‚</p>
</blockquote>
<h1 id="ä¸€ã€åè¨€åå¥"><a href="#ä¸€ã€åè¨€åå¥" class="headerlink" title="ä¸€ã€åè¨€åå¥"></a>ä¸€ã€åè¨€åå¥</h1><p>å¹¸ç¦ä¸æ˜¯æ‹¥æœ‰ä½ æƒ³è¦çš„ï¼Œè€Œæ˜¯æƒ³è¦ä½ å·²ç»æ‹¥æœ‰çš„ã€‚</p>
<p>çµé­‚æ‰€éœ€çš„å¿…éœ€å“ï¼Œä¸€ä»¶ä¹Ÿä¸éœ€è¦ç”¨é’±å»ä¹°ã€‚æŠŠç›®å…‰æœå‘å†…å¿ƒï¼Œä½ å°±ä¼šçœ‹åˆ°ï¼Œä½ å¿ƒä¸­æœ‰åƒä¸ªåœ°åŒºå°šæœªè¢«å‘ç°ã€‚åˆ°è¿™äº›åœ°æ–¹å»æ—…è¡Œå§ï¼Œæˆä¸ºå†…å¿ƒå®‡å®™å¿—çš„ä¸“å®¶ã€‚</p>
<p>é«˜å±±ä»°æ­¢ï¼Œæ™¯è¡Œè¡Œæ­¢ï¼Œè™½ä¸èƒ½è‡³ï¼Œå¿ƒå‘å¾€ä¹‹ã€‚</p>
<p>è®©æ—¶å…‰åœ¨æŒ‡å°–è½¬åŠ¨ã€‚</p>
<p>è§†æ­¤è™½è¿‘ï¼Œé‚ˆè‹¥å±±æ²³ã€‚</p>
<p>æ›¾å›½è—©åº§å³é“­ï¼šç‰©æ¥é¡ºåº”ï¼Œæœªæ¥ä¸è¿ï¼Œå½“æ—¶ä¸æ‚ï¼Œæ—¢è¿‡ä¸æ‹ã€‚</p>
<p>ä¸–ä¸Šåªæœ‰ä¸€ç§è‹±é›„ä¸»ä¹‰ï¼Œå°±æ˜¯åœ¨è®¤æ¸…ç”Ÿæ´»çœŸç›¸ä¹‹åä¾ç„¶çƒ­çˆ±ç”Ÿæ´»ã€‚</p>
<p>å›å¤´çœ‹ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ï¼›<br>å‘å‰çœ‹ï¼Œé•¿è·¯æ¼«æ¼«äº¦ç¿ç¿ï¼›<br>æŠ¬å¤´çœ‹ï¼Œä¸‡é‡Œæ˜ç¯ç…§äººé—´ï¼›<br>ä½å¤´çœ‹ï¼Œè„šä¸‹é»„å£«åƒå¹´ç»µï¼›<br>äººå¿ƒçœ‹ï¼Œæ»¡è…”çƒ­è¡€ä¸ºå›½ç‡ƒï¼›</p>
<p>ä¸–äººæ…Œæ…Œå¼ å¼ ï¼Œä¸è¿‡æ˜¯å›¾ç¢é“¶å‡ ä¸¤ï¼›ååè¿™ç¢é“¶å‡ ä¸¤ï¼Œèƒ½è§£ä¸–é—´ä¸‡èˆ¬æƒ†æ€…ã€‚</p>
<p>ç‰¢éªšå¤ªç››é˜²è‚ æ–­ï¼Œé£ç‰©é•¿å®œæ”¾çœ¼é‡ã€‚â€”â€”æ¯›æ³½ä¸œ</p>
<p>çœŸæ­£ç¾ä¸½çš„ä¸œè¥¿ä»ä¸åˆ»æ„æ±‚å…³æ³¨ï¼Œç¾ä¸€æ—¦è‡ªçŸ¥ä¾¿å®¹æ˜“æ»‘å‘é€ ä½œã€‚</p>
<p>ä¸€ä¸ªäººæ‰€è¯´çš„å¿…é¡»çœŸå®ï¼Œä½†æ²¡æœ‰ä¹‰åŠ¡æŠŠæ‰€æœ‰çš„çœŸå®éƒ½è¯´å‡ºæ¥â€”â€”åº·å¾·</p>
<p>å‘é˜³è€Œç”Ÿï¼Œé€å…‰è€Œè¡Œï¼›å¿ƒæœ‰æš–é˜³ï¼Œæ»¡ç›®èŠ¬èŠ³ï¼Œä½•æƒ§äººç”Ÿæ²§æ¡‘ã€‚</p>
<p>çˆ¶çˆ±åˆ™æ¯é™ï¼Œæ¯é™åˆ™å­å®‰ï¼Œå­å®‰åˆ™å®¶å’Œï¼Œå®¶å’Œä¸‡äº‹å…´ï¼›<br>çˆ¶æ¶åˆ™æ¯è‹¦ï¼Œæ¯è‹¦åˆ™å­æƒ§ï¼Œå­æƒ§åˆ™å®¶è¡°ï¼Œå®¶è¡°è´¥ä¸‰ä»£ã€‚</p>
<p>ä¸€è¾ˆå­å¤ªé•¿ï¼Œåªäº‰æœå¤•ã€‚</p>
<h1 id="äºŒã€æ€è€ƒæ„Ÿæ‚Ÿ"><a href="#äºŒã€æ€è€ƒæ„Ÿæ‚Ÿ" class="headerlink" title="äºŒã€æ€è€ƒæ„Ÿæ‚Ÿ"></a>äºŒã€æ€è€ƒæ„Ÿæ‚Ÿ</h1><p>ä¸è¦ç”¨è¡ŒåŠ¨ä¸Šçš„å‹¤å¥‹æ©ç›–æ€æƒ³ä¸Šçš„æ‡’æƒ°ã€‚</p>
<p>ä¸è¦ä»¥æˆ˜æœ¯çš„å‹¤å¥‹æ¥æ©ç›–æˆ˜ç•¥çš„æ‡ˆæ€ â€”â€”é›·å†›</p>
<p>ä¸è¦æ²‰æ¹äºè§£å†³é—®é¢˜ï¼Œè€Œè¦èƒ½å¤ŸæŠ“ä½æˆ˜ç•¥æ€§çš„æœºä¼šã€‚</p>
<p>é‚£äº›åªçŸ¥å¿µä¹¦ï¼Œä¸è‚¯ç”Ÿäº§çš„äººï¼Œåäº«åˆ«äººçš„é‡‘è›‹ï¼Œè‡ªå·±æ°¸è¿œä¸æ•¢é¢å¯¹ç°å®ã€‚</p>
<p>ä¸€ä¸ªäººçš„ä¸Šé™ï¼Œå¹¶éç”±åŠªåŠ›ç¨‹åº¦å†³å®šçš„ï¼Œè€Œæ˜¯å–å†³äºå­¦ä¹ æ–¹æ³•å’Œç›®æ ‡å®šä½ã€‚</p>
<p>çœŸæ­£è´«ç©·çš„å®¶åº­ï¼Œå¾€å¾€ä¸æ˜¯é‡‘é’±ä¸Šçš„åŒ®ä¹ï¼Œè€Œæ˜¯è®¤çŸ¥ä¸Šçš„è´«ç˜ ã€‚</p>
<p>è€Œä¸”æ˜¯ç¯å¢ƒæ”¹å˜äººçš„æ€ç»´ï¼Œæ€ç»´ä¼šè¿›ä¸€æ­¥æ”¹å˜å¢ƒé‡ï¼Œåè¿‡æ¥å†æ”¹å˜æ€ç»´ã€‚</p>
<p>å‚…ç››è¯´ï¼Œâ€œäººè·Ÿäººä¹‹é—´æœ€å¤§çš„å·®åˆ«ï¼Œå°±æ˜¯è®¤çŸ¥ä¸Šçš„ä¸åŒã€‚â€äººå’Œäººæœ€ç»ˆæ¯”æ‹¼çš„ï¼Œæ˜¯å¯¹ä¸€ä»¶äº‹æƒ…çš„ç†è§£å’Œå¯¹è¡Œä¸šçš„æ´å¯Ÿã€‚</p>
<p>æˆ‘ä¸ä½†å……åˆ†åˆ©ç”¨è‡ªå·±çš„æ™ºæ…§ï¼Œè¿˜ç«­å°½æ‰€èƒ½å»å€Ÿç”¨ä»–äººçš„æ™ºæ…§ã€‚</p>
<p>é€†å¢ƒæ˜¯è€ƒéªŒäººçš„çœŸå®èƒ½åŠ›çš„æœºä¼šï¼Œåªæœ‰æŒºè¿‡é€†å¢ƒçš„äººæ‰èƒ½è¢«ç§°ä½œæ˜¯å¼ºè€…ã€‚</p>
<p>æ‰€è°“èƒ½åŠ›é—®é¢˜ï¼Œ80%éƒ½æ˜¯æ€åº¦é—®é¢˜ã€‚</p>
<p>å†å¥½çš„ä¸œè¥¿ï¼Œä»–ä¹Ÿå¾ˆå¿«å°±ä¹ æƒ¯äº†ï¼Œæ„Ÿå—ä¸åˆ°ä¸æ¯«çš„åˆºæ¿€ä¸æ„‰æ‚¦ã€‚ä»–æ¸æ¸æ˜ç™½ï¼ŒåŸæ¥å¹¸ç¦å¹¶ä¸æ¥è‡ªå¤–éƒ¨çš„ç‰©è´¨è´¢å¯Œï¼Œè€Œæ˜¯ä¸€ç§å†…å¿ƒçš„æ„Ÿå—ã€‚</p>
<p>ä¸–ç•Œçš„æœ¬è´¨æ˜¯ä¸€ä¸ªè¿·å®«ï¼Œä¸€æ¥¼çš„äººï¼Œä¸ç®¡æ€ä¹ˆåŠªåŠ›å¥”è·‘ï¼Œéƒ½èµ°ä¸å‡ºè¿·å®«ã€‚ä»–ä»¬æ—¢ä¸æå‡è®¤çŸ¥ï¼Œä¹Ÿä¸å¯»æ±‚å¤–åŠ›ï¼Œè¿˜æœ‰å¤ªå¤šçš„çˆ¶æ¯ï¼Œä¸€ç›´æ´»åœ¨åœ°åº•ä¸‹ï¼Œä½åœ¨åœ°ä¸‹å®¤ï¼Œä»æ¥æ²¡èµ°å‡ºå»è¿‡ã€‚</p>
<p>ç…§ç‰‡åªæ˜¯çƒ­çˆ±çš„å‰¯äº§å“ã€‚</p>
<p>done is better than perfect.</p>
<h1 id="ä¸‰ã€ç¢ç¢å¿µ"><a href="#ä¸‰ã€ç¢ç¢å¿µ" class="headerlink" title="ä¸‰ã€ç¢ç¢å¿µ"></a>ä¸‰ã€ç¢ç¢å¿µ</h1><h2 id="1-ä½ æ˜¯å¦‚ä½•è¢«æ‰“è´¥çš„ï¼Ÿ"><a href="#1-ä½ æ˜¯å¦‚ä½•è¢«æ‰“è´¥çš„ï¼Ÿ" class="headerlink" title="1.ä½ æ˜¯å¦‚ä½•è¢«æ‰“è´¥çš„ï¼Ÿ"></a>1.ä½ æ˜¯å¦‚ä½•è¢«æ‰“è´¥çš„ï¼Ÿ</h2><p>äººç”Ÿä¸å¯èƒ½100%æ­£ç¡®ï¼Œç”šè‡³è¿50%çš„æ­£ç¡®éƒ½æ— æ³•ä¿è¯ã€‚ä½†æ˜¯äººé—¨å´ä»å¿ƒåº•é‡Œå¸Œæœ›ç€èƒ½å¤Ÿ100%æ­£ç¡®çš„äººç”Ÿï¼Œäºæ˜¯ä¹æˆ‘ä»¬å°å¿ƒç¿¼ç¿¼çš„é€‰æ‹©ï¼Œå®³æ€•ä¸€ç‚¹ç‚¹çš„é”™è¯¯å’Œå¤±è´¥ï¼Œç”šè‡³å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸æ•¢åšå‡ºé€‰æ‹©ï¼Œç›´åˆ°æ—¶é—´æ‰€å‰©æ— å¤šçš„æ—¶å€™å‘ç°è‡ªå·±é”™è¿‡äº†å¤ªå¤šï¼Œå¿ƒæœ‰ä¸ç”˜å´æœ‰æ— å¯å¥ˆä½•ã€‚åœ¨é€‰æ‹©æ—¶é”™è¿‡æˆ–è€…æ˜¯è¿‡é”™æ—¶ï¼Œæˆ‘å¾€å¾€é€‰æ‹©äº†é”™è¿‡ã€‚æ˜¯å•Šï¼é€‰æ‹©â€œé”™è¿‡â€è‡³å°‘æ²¡æœ‰ä¼šå—åˆ°ä¼¤å®³ï¼Œä½†æ˜¯é€‰æ‹©â€œè¿‡é”™â€æˆ–å°†æ˜¯å¿ƒå¦‚åˆ€ç»äº¦æˆ–æ˜¯å¿ƒå¦‚æ­»ç°ã€‚è¿™ä¹ˆçœ‹æ¥åœ¨â€œé”™è¿‡â€ä¸â€œè¿‡é”™â€ä¹‹é—´ï¼Œé€‰æ‹©â€œé”™è¿‡â€æ— ç–‘æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯å½“ä½ é€‰æ‹©é”™è¿‡åï¼ŒåŒæ—¶ä¹Ÿå°†æ”¹å˜å’Œæˆé•¿çš„æœºä¼šæ‹’ä¹‹é—¨å¤–ï¼Œæˆé•¿æ€»æ˜¯è¢«éšç€é˜µç—›ï¼Œäººåªæœ‰ç»å†è¿‡æŒ«æŠ˜å’Œè‹¦éš¾æ–¹èƒ½æ”¹å˜å’Œæˆé•¿ã€‚æ¯ä¸ªæˆåŠŸçš„æ•…äº‹èƒŒåï¼Œéƒ½æœ‰ç€æ— æ•°çš„å¤±è´¥ï¼Œæ²¡æœ‰äººå¯ä»¥ä¸ç»å†å¤±è´¥å°±è·å¾—æˆåŠŸã€‚å› ä¸ºä¸ç»åŠªåŠ›è€Œè·å¾—çš„æˆåŠŸæ¯«æ— æˆå°±æ„Ÿï¼Œæ›´è°ˆä¸ä¸Šä»€ä¹ˆæˆåŠŸã€‚</p>
<h2 id="2-è¯»ä¹¦æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ"><a href="#2-è¯»ä¹¦æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ" class="headerlink" title="2.è¯»ä¹¦æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ"></a>2.è¯»ä¹¦æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</h2><p>ä¸€ä¸ªä¹¦å‹ä¸¾äº†ä¸€ä¸ªç”ŸåŠ¨çš„ä¾‹å­ã€‚å°±åƒå°æ—¶å€™åƒçš„é¥­ï¼Œæˆ‘å·²ç»ä¸è®°å¾—æ›¾åƒè¿‡ä»€ä¹ˆï¼Œä½†æ˜¯é‚£äº›åƒè¿›å»çš„ä¸œè¥¿å˜æˆæˆ‘çš„è¡€ä¸è‚‰ã€‚è¯»ä¹¦ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘å·²ç»æ— æ³•æ˜ç¡®è®°å¾—åˆ°åº•è¯»è¿‡å“ªäº›ä¹¦ï¼Œä½†æ˜¯è¿™äº›è¯»è¿‡çš„ä¹¦å˜æˆæˆ‘ä»Šå¤©æ€è€ƒã€è¡ŒåŠ¨çš„å‡†åˆ™ã€‚</p>
<h2 id="3-åœæ­¢æŠ±æ€¨"><a href="#3-åœæ­¢æŠ±æ€¨" class="headerlink" title="3.åœæ­¢æŠ±æ€¨"></a>3.åœæ­¢æŠ±æ€¨</h2><p>ä»Šå¤©ä¸Šç­çš„æ—¶å€™ï¼Œå‘ç°åŒäº‹æ€»æ˜¯åœ¨è¯´ï¼šçƒ¦æ­»äº†ã€‚é‚£ä¸€åˆ»æˆ‘å¿½ç„¶å‘ç°è‡ªå·±çš„å¿ƒæ€æœ‰äº†æ–°çš„å˜åŒ–ï¼Œé‚£å°±æ˜¯æˆ‘åœæ­¢äº†æŠ±æ€¨ï¼Œè€Œæ˜¯åœ¨éº»çƒ¦åˆ°æ¥çš„æ—¶å€™åšæˆ‘åŠ›æ‰€èƒ½åŠçš„äº‹ã€‚</p>
<p>æ”¹å˜ä½ èƒ½æ”¹å˜çš„ï¼Œå¯¹äºä¸èƒ½æ”¹å˜çš„æˆ‘ä»¬è®¤æ¸…å…¶æœ¬è´¨ï¼Œæ˜¯æˆ‘ä»¬çš„èƒ½åŠ›ä¸å¤Ÿï¼Œè¿˜æ˜¯å­˜åœ¨çš„å®¢è§‚äº‹å®æ— æ³•æ”¹å˜ï¼Œä»ä¸­å‘ç°è‡ªå·±çš„è–„å¼±ç‚¹ï¼Œå½¢æˆä¸€ä¸ªè§‚å¿µå¹¶åœ¨æ—¥åçš„ç”Ÿæ´»å·¥ä½œä¸­ä½¿ç”¨åˆ»æ„ç»ƒä¹ çš„ä¹ æƒ¯å¼ºåŒ–è‡ªå·±ã€‚</p>
<p>åæ€èƒ½ä¿ƒä½¿æˆ‘åšå‡ºä»¥ä¸Šæ”¹å˜çš„åº”è¯¥æ˜¯è¿™æ ·ä¸€å¥è¯ï¼šæ‚²è§‚è€…æ€»æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æ‚²è§‚è€…çš„è§‚ç‚¹å¹¶ä¸ä¼šå¯¹å±€åŠ¿åšå‡ºæœ‰åˆ©çš„æ”¹å˜ï¼Œè€Œæ˜¯æäººå¿§å¤©ï¼›åè€Œæ˜¯ä¹è§‚è€…æ€»æ˜¯å°è¯•é€šè¿‡å„ç§é€”å¾„å»è§£å†³é—®é¢˜ï¼Œä¸æ–­æ¢ç´¢çªç ´ï¼Œä½†ä¹è§‚ä¸æ˜¯ç›²ç›®ä¹è§‚è€Œæ˜¯è¦æœ‰æ‰€è¡ŒåŠ¨ã€‚æˆ‘æƒ³æˆ‘è¦åšçš„æ˜¯ä¸€ä¸ªå‹‡äºæ¢ç´¢çªç ´çš„ä¹è§‚è€…ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»æˆ‘æ¯äº²èº«ä¸Šçœ‹åˆ°çš„ï¼Œå¹¶æ·±å—å…¶å½±å“ã€‚</p>
<h2 id="4-ä¸ºå®˜ä¹‹é“"><a href="#4-ä¸ºå®˜ä¹‹é“" class="headerlink" title="4.ä¸ºå®˜ä¹‹é“"></a>4.ä¸ºå®˜ä¹‹é“</h2><p>å®˜åœºä¹‹ä¸­ï¼Œè¡Œäº‹è¿‡äºæ–¹åˆšè€…ï¼Œè¡¨é¢ä¸Šä¼¼ä¹æ˜¯å¼ºè€…ï¼Œå®é™…ä¸Šå´æ˜¯å¼±è€…ã€‚è¿™ç‰‡åœŸåœ°ä¸ŠçœŸæ­£çš„å¼ºè€…ï¼Œæ˜¯è¡¨é¢ä¸Šçœ‹èµ·æ¥æŸ”å¼±é€€è®©ã€å«è“„åŒ…å®¹ä¹‹äººã€‚</p>
<h2 id="5-äººç”Ÿæœ€ç¾çš„é£æ™¯"><a href="#5-äººç”Ÿæœ€ç¾çš„é£æ™¯" class="headerlink" title="5.äººç”Ÿæœ€ç¾çš„é£æ™¯"></a>5.äººç”Ÿæœ€ç¾çš„é£æ™¯</h2><p>æˆ‘ä»¬æ›¾å¦‚æ­¤æ¸´æœ›å‘½è¿çš„æ³¢æ¾œï¼Œåˆ°æœ€åæ‰å‘ç°ï¼Œäººç”Ÿæœ€æ›¼å¦™çš„é£æ™¯ï¼Œç«Ÿæ˜¯å†…å¿ƒçš„æ·¡å®šä¸ä»å®¹ã€‚æˆ‘ä»¬æ›¾å¦‚æ­¤æœŸç›¼å¤–ç•Œçš„è®¤å¯ï¼Œåˆ°æœ€åæ‰çŸ¥é“ï¼Œä¸–ç•Œæ˜¯è‡ªå·±çš„ï¼Œä¸ä»–äººæ¯«æ— å…³ç³»ã€‚</p>
<h1 id="å››ã€æ€ç»´ç†è®º"><a href="#å››ã€æ€ç»´ç†è®º" class="headerlink" title="å››ã€æ€ç»´ç†è®º"></a>å››ã€æ€ç»´ç†è®º</h1><p>é”šå®šæ•ˆåº”</p>
<p>æŠ˜ä¸­æ•ˆåº”</p>
<p>é€šäººæ€§</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>åè¨€åå¥</tag>
        <tag>æ€è€ƒæ„Ÿæ‚Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•é«˜æ•ˆæé—®</title>
    <url>/2022/10/31/thought/ru-he-gao-xiao-ti-wen/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•é«˜æ•ˆæé—®â€”â€”åˆ†äº«PPT"><a href="#å¦‚ä½•é«˜æ•ˆæé—®â€”â€”åˆ†äº«PPT" class="headerlink" title="å¦‚ä½•é«˜æ•ˆæé—®â€”â€”åˆ†äº«PPT"></a>å¦‚ä½•é«˜æ•ˆæé—®â€”â€”åˆ†äº«PPT</h1><span id="more"></span>
<div class="pdf-container" style="width: 100%; height: 600px; margin: 20px 0; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    <iframe src="./å¦‚ä½•é«˜æ•ˆæé—®.pdf" width="100%" height="100%" frameborder="0" style="border: none; border-radius: 8px;">
      <div style="padding: 20px; text-align: center; background-color: #f8f9fa; border-radius: 8px;">
        <p style="margin: 0; color: #666;">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ˜¾ç¤ºPDFæ–‡ä»¶</p>
        <a href="./å¦‚ä½•é«˜æ•ˆæé—®.pdf" target="_blank" style="color: #409eff; text-decoration: none; font-weight: 500;">ğŸ“¥ ç‚¹å‡»è¿™é‡Œä¸‹è½½PDFæ–‡ä»¶</a>
      </div>
    </iframe>
  </div>]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>æé—®</tag>
        <tag>å¦‚ä½•æé—®</tag>
        <tag>é«˜æ•ˆæé—®</tag>
      </tags>
  </entry>
  <entry>
    <title>ç›®æ ‡ä¸è®¡åˆ’ç®¡ç†</title>
    <url>/2024/07/13/thought/mu-biao-yu-ji-hua-guan-li/</url>
    <content><![CDATA[<p>ç®¡ç†è€…çš„å¿…ä¿®è¯¾â€”â€”ç›®æ ‡ä¸è®¡åˆ’ç®¡ç†ã€‚</p>
<p>ä¸€ã€å·¥ä½œç›®æ ‡æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ<br>1.è¯æ˜è‡ªå·±çš„åŠªåŠ›æ˜¯æœ‰ç»“æœçš„<br>2.ç»™è‡ªå·±çš„å¥”è·‘æ‰¾ä¸€ä¸ªåŠ æ²¹ç«™<br>3.äººä»¬æ€»æ˜¯åœ¨ä¸æ–­çš„è®¤å¯ä¸­å‰è¿›<br>4.ç”¨èŠ‚ç‚¹çš„ç›®æ ‡è¯„ä¼°è‡ªå·±èµ°è¿‡çš„è·¯<br>5.ç”¨æ¥è¯„å®šå·¥ä½œç»©æ•ˆæ ‡å‡†</p>
<p>1.1ç»™è‡ªå·±ä¸€ä¸ªåŠªåŠ›çš„ç†ç”±<br>1.å¼ºè¿«è‡ªå·±æœ‰è®¡åˆ’æœ‰æ–¹å‘çš„åŠªåŠ›<br>2.ç”¨ä»¥æ¿€åŠ±å’Œé¼“èˆè‡ªå·±å’Œå›¢é˜Ÿ</p>
<p>ç»Ÿä¸€ä¸€ç¾¤äººçš„èŠ‚å¥</p>
<p>äºŒã€ä¸ºä»€ä¹ˆç›®æ ‡å¹´å¹´é•¿ï¼Ÿ</p>
<p>ä¸‰ã€ç›®æ ‡å’Œä»»åŠ¡çš„åŒºåˆ«</p>
<p>å››ã€æ€æ ·åˆ¶å®šå·¥ä½œç›®æ ‡</p>
<p>äº”ã€æ€æ ·è¡¨è¿°å·¥ä½œç›®æ ‡</p>
<p>ç”Ÿæ°”æ˜¯ç”¨åˆ«äººçš„é”™è¯¯æ¥æƒ©ç½šè‡ªå·±ã€‚</p>
<p>äºŒã€å¦‚ä½•åˆ†è§£ä»»åŠ¡</p>
<p>2.1 ç›®æ ‡å’Œä»»åŠ¡ä¹‹é—´çš„å…³ç³»<br>1.ä¸€ä¸ªç›®æ ‡éœ€è¦åˆ†è§£æˆå¤šä¸ªä»»åŠ¡<br>2.ä¸€ä¸ªå¤§ä»»åŠ¡éœ€è¦åˆ†è§£æˆNä¸ªå°ä»»åŠ¡<br>3.æ¯ä¸ªä»»åŠ¡å¿…é¡»æœ‰ä¸€ä¸ªè´Ÿè´£äºº<br>4.å¦‚æœä»»åŠ¡æœ‰äº¤å‰ï¼Œä¸»çº¿è´Ÿè´£äººä¸ºä¸»</p>
<p>2.2 ä»»åŠ¡çš„äººæ¥é€»è¾‘<br>é€çº§å‘ä¸‹åˆ†è§£</p>
<p>2.3 éƒ¨é—¨ã€ä¸ªäººç›®æ ‡å¦‚ä½•è·å¾—<br>å…¬å¸æ„¿æ™¯-ã€‹å…¬å¸ç›®æ ‡-ã€‹éƒ¨é—¨ç›®æ ‡-ã€‹ä¸ªäººç›®æ ‡</p>
<p>2.4 åˆ†è§£åŸåˆ™<br>1.ä¸Šä¸€çº§è´Ÿè´£æœ¬çº§çš„ä»»åŠ¡åˆ†è§£<br>2.è´Ÿè´£è¾…å¯¼å’Œå®¡æ ¸ä¸‹ä¸€é›†çš„ä»»åŠ¡åˆ†è§£</p>
<p>2.5 åˆ†è§£çš„å±‚æ¬¡<br>1.ä¸šåŠ¡ç›®æ ‡é€å±‚åˆ†è§£<br>2.å…¶å®ƒä¸‰ä¸ªç»´åº¦çš„ç›®æ ‡åœ¨æœ¬å±‚å†…å…·ä½“ï¼ˆä»¥BSCä¸ºä¾‹ï¼‰</p>
<p>2.6 ä¸åŒç®¡ç†å±‚çº§çš„åˆ†è§£åŠ¨ä½œç•¥æœ‰ä¸åŒ<br>1.ç®¡ç†è€…ä¹Ÿåˆ†ä¸ºå¸¦å¸¦å¤šç¼–åˆ¶é˜Ÿä¼å’Œå¤šå²—ä½é˜Ÿä¼çš„å·®å¼‚<br>2.ç”Ÿäº§é”€å”®çš„åŸºå±‚ç®¡ç†è€…é˜Ÿä¼ä½å²—ä½å°‘ï¼Œç¼–ç»‡å¤šçš„ç‰¹ç‚¹ï¼ŒæŒ‰ç…§å²—ä½äººæ•°åˆ†è§£ä»»åŠ¡</p>
<p>ä½ çš„ä»»åŠ¡éƒ½æ¶‰åŠå“ªäº›ç»´åº¦</p>
<p>ç®¡ç†è€…çš„ä¸¤ä¸ªç»´åº¦<br>1.å›¢é˜Ÿä»»åŠ¡<br>2.éƒ¨é—¨ä»»åŠ¡</p>
<p>ä¸€èˆ¬ä»»åŠ¡çš„ç»´åº¦<br>1.è´¢åŠ¡&#x2F;ä¸šåŠ¡ç»´åº¦â€”â€”è¥æ”¶ã€æˆæœ¬ã€åˆ©æ¶¦ã€äº‹åŠ¡<br>2.å»ºç«‹&#x2F;ç»´æŠ¤å…³ç³»ç»´åº¦â€”â€”å»ºç«‹èµ·å…³ç³»ã€ç»´æŠ¤å¥½å…³ç³»ã€æ»¡æ„åº¦ã€è½¬ä»‹ç»ç­‰<br>3.å†…éƒ¨ç®¡ç†â€”â€”åˆ¶åº¦æµç¨‹å»ºè®¾ä¸å®Œå–„ï¼Œç»©æ•ˆè€ƒæ ¸å²—ä½æ“ä½œæ‰‹å†Œï¼Œè§„ç« åˆ¶åº¦ï¼Œå®‰å…¨ç®¡ç†ï¼Œè´¨é‡ç®¡ç†ç­‰<br>4.å²—ä½èƒœä»»åº¦â€”â€”å­¦ä¹ æå‡ï¼Œç»©æ•ˆæ”¹å–„ï¼Œå·¥å…·ä½¿ç”¨</p>
<p>å¦‚ä½•åˆ†è§£ä»»åŠ¡</p>
<p>ç¡®å®šå…³é”®ä»»åŠ¡<br>1.æ ¹æ®ä»»åŠ¡å’Œå²—ä½èŒèƒ½<br>2.ç½—åˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„ä»»åŠ¡<br>3.ä½ å’Œå²—ä½äººå‘˜å•ç‹¬ç½—åˆ—ï¼Œç„¶åæ±‡æ€»<br>4.å²—ä½äººå‘˜è‡ªå·±ç½—åˆ—ï¼ˆç†Ÿç»ƒå‘˜å·¥ï¼‰</p>
<p>è‘—åçš„äºŒå…«ç†è®º</p>
<p>ä»»åŠ¡å¦‚ä½•è¡¨è¿°<br>1.</p>
<p>å¦‚ä½•ç¡®å®šä»»åŠ¡</p>
<p>1.ä»»åŠ¡è¦å’Œå½“äº‹äººå•†å®šå—<br>ï¼ˆ1ï¼‰è®¤åŒçš„åˆ°ä½ï¼Œæ¯”ç»å¯¹çš„ç²¾ç¡®è€•ç§é˜¿çº¢<br>å…±è¯†</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>ç›®æ ‡</tag>
        <tag>è®¡åˆ’</tag>
        <tag>ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ ä¸€é¸£ï¼šç‰›é€¼çš„äººæ‰¾æ–¹æ³•ï¼Œå‚»é€¼çš„äººæ‰¾å€Ÿå£</title>
    <url>/2022/01/18/thought/zhang-yi-ming-niu-bi-de-ren-zhao-fang-fa-sha-bi-de-ren-zhao-jie-kou/</url>
    <content><![CDATA[<blockquote>
<h2 id="è½¬è½½è¯´æ˜"><a href="#è½¬è½½è¯´æ˜" class="headerlink" title="è½¬è½½è¯´æ˜"></a>è½¬è½½è¯´æ˜</h2><p>å†…å®¹æ¥æºï¼šæœ¬æ–‡ä¸ºå…¬ä¼—å·ä»Ÿè¯­ä»Ÿå¯»ï¼ˆIDï¼šhuoqian2014ï¼‰é¦–å‘ï¼Œè½¬è½½è‡ªç¬”è®°ä¾ ï¼ˆIDï¼šNotesmanï¼‰<br>åŸæ–‡åœ°å€ï¼š<a href="https://mp.weixin.qq.com/s/HJLStYr-UO1Y02lEA6EOGQ">å¼ ä¸€é¸£ï¼šç‰›é€¼çš„äººæ‰¾æ–¹æ³•ï¼Œå‚»é€¼çš„äººæ‰¾å€Ÿå£</a></p>
</blockquote>
<p>ä¼´éšæˆé•¿ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œåœ¨ä¸æ–­æ€è€ƒï¼Œä»Šå¤©è¯»åˆ°çš„è¿™ç¯‡æ–‡ç« ä¸­è®¸å¤šè§‚ç‚¹å¼•èµ·äº†æˆ‘çš„å…±é¸£ï¼Œæ›´ä»ä¸­çœ‹åˆ°äº†ä¸€äº›å€¼å¾—å»æ¢ç´¢çš„æ–¹æ³•ã€‚</p>
<blockquote>
<h2 id="å•†ä¸šæ€ç»´"><a href="#å•†ä¸šæ€ç»´" class="headerlink" title="å•†ä¸šæ€ç»´"></a>å•†ä¸šæ€ç»´</h2><p>ç¼–è€…æŒ‰ï¼š<br>è¿™å‡ å¤©æŠ½ç©ºæŠŠå¼ ä¸€é¸£æ‰€æœ‰çš„å¾®åšçœ‹äº†ä¸€éï¼Œ2010å¹´çš„å¾®åšæ˜¯ä»–30å²å·¦å³æ—¶å€™å‘çš„ï¼Œé‚£æ—¶å€™ä»–åˆšåˆ›ä¸šæ²¡å¤šä¹…ï¼Œåœ¨å¾®åšä¸Šè®¤çœŸåˆ†äº«è‡ªå·±çš„æ€è€ƒå’Œè§‚ç‚¹ã€‚åˆ°äº†2012å¹´é™„è¿‘ï¼Œå¼€å§‹åšä»Šæ—¥å¤´æ¡ã€‚ä»ä»–çš„å¾®åšä¸­ï¼Œæˆ‘è¯•å›¾æ‰¾åˆ°ä»–æˆåŠŸçš„é’¥åŒ™ï¼Œä»…ä»…æ˜¯è¿™äº›åªè¨€ç‰‡è¯­ï¼Œæˆ‘éƒ½è§‰å¾—å¯¹æˆ‘çš„å¯å‘å¾ˆå¤§ã€‚ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹æ˜¯ï¼Œæ—©å¹´å¼ ä¸€é¸£æ›¾æŠŠé©¬åŒ–è…¾çš„æ‰€æœ‰å¾®åšè¯»äº†ä¸€éï¼›è€Œä»Šå¤©ï¼Œå¼ ä¸€é¸£çš„å¾®åšä¹Ÿè¢«äººä»”ç»†ç ”è¯»ï¼Œè¯•å›¾æ‘¸ç´¢å‡ºä»–æˆå°±èƒŒåçš„æ€ç»´é€»è¾‘ã€‚<br>å›´è§‚ä»–çš„å¾®åšï¼Œç»“è®ºå°±æ˜¯å¼ ä¸€é¸£çœŸçš„å¤ªå‰å®³äº†ï¼Œå‘ç°ä»–è¯´å¾—æœ€å¤šçš„å…³é”®è¯ï¼šå»¶è¿Ÿæ»¡è¶³æ„Ÿï¼Œè‡ªæ§ï¼Œç†æ€§ï¼Œåçœï¼Œåˆ›æ–°ï¼Œå­¦ä¹ ã€‚<br>æœ¬æ–‡æ˜¯ä»ä»–å¾®åšä¸­æ‘˜å½•çš„231å¥è¯ï¼Œç»å¤§å¤šæ•°éƒ½æ˜¯ä»–åˆ›ä¸šåˆæœŸçš„æ€è€ƒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹10å¹´å‰çš„æƒ³åˆ›ä¸šçš„å¼ ä¸€é¸£åœ¨æƒ³ä»€ä¹ˆï¼Œåœ¨æ€è€ƒä»€ä¹ˆï¼Œæ˜¯æ€ä¹ˆé­ç­–è‡ªå·±çš„ã€‚æœ‰ç‚¹é•¿ï¼Œå¸Œæœ›å¤§å®¶è€å¿ƒçœ‹å®Œï¼Œä¸€å®šä¼šæœ‰æ‰€æ”¶è·çš„ã€‚</p>
</blockquote>
<h1 id="ä¸€ã€å…³äºæˆé•¿"><a href="#ä¸€ã€å…³äºæˆé•¿" class="headerlink" title="ä¸€ã€å…³äºæˆé•¿"></a>ä¸€ã€å…³äºæˆé•¿</h1><p>1.äººå¸¸ä¼šä¸è‡ªè§‰åœ°è®°ä¸‹å¯¹è‡ªå·±æœ‰åˆ©çš„éƒ¨åˆ†ï¼Œè¿™æ˜¯å½¢æˆå§”å±ˆçš„é‡è¦åŸå› ã€‚</p>
<p>2.å»¶è¿Ÿæ»¡è¶³æ„Ÿç¨‹åº¦åœ¨ä¸åŒé‡çº§çš„äººæ˜¯æ²¡æ³•æœ‰æ•ˆè®¨è®ºé—®é¢˜çš„ï¼Œå› ä¸ºä»–ä»¬æ„¿æ„è§¦æ¢åœç•™çš„æ·±åº¦ä¸ä¸€æ ·ã€‚</p>
<p>3.åšä¸å¥½çš„å°±åˆ«åšäº†ï¼Œè¦åšå°±å¿…é¡»åšåˆ°éå¸¸å¥½ã€‚</p>
<p>4.å½“æ„Ÿåˆ°æ²Ÿé€šå›°éš¾çš„æ—¶å€™ï¼Œæœ€å¥½çš„æ²Ÿé€šæ–¹æ³•ä¸æ˜¯æƒ³å¤ªå¤šæŠ€å·§å’Œè¯´æ³•ï¼Œè€Œæ˜¯ï¼šæ›´å¦è¯šçš„æ²Ÿé€š</p>
<p>5.æœ‰æ„Ÿï¼šäººç”Ÿçš„å·®è·å°±æ˜¯åœ¨è‡ªæˆ‘æ„Ÿè§‰è‰¯å¥½ä¸­æ‹‰å¼€çš„ã€‚â€”â€”ä¸æœ‹å‹å…±è¯«å‹‰</p>
<p>6.ç»éªŒï¼šå½“æ— æ³•é€‰æ‹©æˆ–åˆ¤æ–­çš„æ—¶å€™ï¼Œç¦»è¿œä¸€æ­¥ï¼Œè¿œåˆ°ç”¨æ›´é‡è¦çš„åŸåˆ™å’Œæ›´é•¿çš„æ—¶é—´å°ºåº¦æ¥è¡¡é‡å°±æ¸…æ¥šäº†ã€‚</p>
<p>7.æ²Ÿé€šä¸­æ²¡å¬æ˜ç™½çš„è¯ï¼Œå¸¸å› ä¸ºè¿™äº›è¯ç”¨äº†â€œè¿™ä¸ªâ€ï¼Œâ€œé‚£æ ·â€ç­‰ä»£è¯ï¼Œæˆ–ç¬¼ç»Ÿçš„åè¯ï¼Œå«ç³Šçš„å½¢å®¹è¯ã€å‰¯è¯ã€é‡è¯æ›¿æ¢æ‰å¾€å¾€â€œæœ¬èº«è¿˜æ¨¡ç³Šæˆ–æœ‰åˆ†æ­§çš„å†…å®¹â€ã€‚è™½ç„¶å¥å­æ˜¯å®Œæ•´äº†ï¼Œä½†æ˜¯æ„æ€ä¸æ¸…æ¥šã€‚ç„¶è€Œå¦‚æœæ›¿æ¢çš„éƒ¨åˆ†æ˜¯æ¸…æ¥šçš„ï¼Œå¹¶ä¸ä¼šå¬ä¸æ˜ç™½ã€‚ä½ è¦åšçš„å°±æ˜¯æŠ“ä½è¿™ä¸ªè¯ï¼Œè¿˜ç»™ä»–ä»¬ã€‚</p>
<p>8.ç»ƒä¹ ä¿æŒè€å¿ƒï¼Œå³ä½¿æ˜¯å¿«èŠ‚å¥å’Œå‹åŠ›çš„æƒ…å†µä¸‹ã€‚</p>
<p>9.ä»Šå¤©å¬ç‹å…´æ¼”è®²çš„çš„æ¯”å–»ï¼šäººç”Ÿï¼Œå’Œè°ä¸€èµ·åœ¨è·¯ä¸Šï¼Œçœ‹ä»€ä¹ˆé£æ™¯ã€‚æˆ‘æœ€è¿‘ä¹Ÿæ˜¯åœ¨æƒ³ï¼Œä»¥åè¦è®©å°å­©å¤šçœ‹çœ‹ä¼ è®°ï¼ŒåŒ…æ‹¬ç”µè§†å‰§ã€Šé˜¿ä¿¡ã€‹é‚£æ ·çš„ä¹Ÿå¯ä»¥ï¼Œçœ‹çœ‹åˆ«äººçš„é£æ™¯å’Œæ—…ç¨‹ï¼Œæ›´å®¹æ˜“æƒ³æ¸…æ¥šè‡ªå·±çš„é€‰æ‹©ã€‚</p>
<p>10.åº”è¯¥è®©è‚¾ä¸Šè…ºç´ å’Œç†æ™ºä¸€èµ·å‘æŒ¥ä½œç”¨ã€‚</p>
<p>11.è°‹äº‹ä¸æ±‚æ˜“æˆï¼Œå…·å¤‡å¼ºçƒˆçš„æˆåŠŸåŠ¨æœºå’ŒéŸ§æ€§æ‰èƒ½æˆåŠŸã€‚</p>
<p>12.è·¯å¾„ä¾èµ–çš„å¼ºå¼±å¯è¡¨å¾å»¶è¿Ÿæ»¡è¶³æ„Ÿã€‚</p>
<p>13.å‚è€ƒåˆ«äººçš„æ„è§ï¼Œåªæ˜¯åˆ¤æ–­çº¿ç´¢ï¼Œä¸å¯ä½œä¸ºå†³å®šçš„å†³å¿ƒã€‚</p>
<p>14.è€å­è¯´ç¥¸å…®ç¦ä¹‹æ‰€å€šï¼Œç¦å…®ç¥¸ä¹‹æ‰€ä¼ã€‚å¹¸è¿çš„æ—¶å€™ä¸è¦å¿˜å½¢ï¼Œå¤±æ„çš„æ—¶å€™ä¹Ÿä¸è¦ç»æœ›ï¼Œç›¸ä¿¡äº‹æƒ…æ€»ä¼šæœ‰è½¬æœºã€‚é‚£è¿™å¥è¯æ˜¯å”¯å¿ƒçš„è¿˜æ˜¯å”¯ç‰©çš„å‘¢ï¼Ÿå½“ç„¶æ˜¯å”¯ç‰©çš„ï¼Œå‘Šè¯‰ä½ å¿˜å½¢å’Œå¤±æ„éƒ½æ— åŠ©äºäº‹ï¼Œåšæœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œå…³æ³¨äº‹æƒ…çš„å˜åŒ–ã€‚</p>
<p>15.ä¸æ™ºæ…§çš„å¸¸è§æ•Œäººï¼šæœªå»¶è¿Ÿçš„æ»¡è¶³æ„Ÿï¼Œç»éªŒå¸¦æ¥çš„éº»ç—¹æˆ–ææƒ§ã€‚</p>
<p>16.å¾ˆå¤šæ—¶å€™ä¸æ˜¯ä¸ç†è§£ï¼Œç”šè‡³ä¸æ˜¯è®¤è¯†ä¸åˆ°ï¼Œåªæ˜¯ä¸æ„¿æ„æ·±åˆ»è®¤è¯†åˆ°ã€‚è¿™å¾€å¾€è¿˜æ˜¯éšéšçš„ä¸»è§‚åœ¨ä½œæ€ªã€‚</p>
<p>17.æœ€è´µçš„æ˜¯â€œå­¦è´¹â€ã€‚</p>
<p>18.ä¸‰å¹´å‰å’Œæœ‹å‹èŠå¤©ï¼Œé—®ä»–å¯¹åˆä½œè€…å¯¹äººæ‰çœ‹é‡ä»€ä¹ˆï¼Œå…¶å®ƒç‚¹æˆ‘å·²ç»è®°ä¸ä½äº†ï¼Œå”¯è®°ä½ï¼šä¸è£…Bã€‚å½“æ—¶æ¥äº†ä¸€ä¸‹ï¼Œéšåè¶Šå‘è§‰å¾—æœ‰é“ç†ã€‚ç»å¸¸è¦æé†’è‡ªå·±ï¼Œè¿™ä¹Ÿæ˜¯å»¶è¿Ÿæ»¡è¶³æ„Ÿçš„ä¸€ç§é”»ç‚¼ã€‚</p>
<p>19.ä¸åœåœ°æƒ³åº”è¯¥å¦‚ä½•è®©æœªæ¥æ›´ç²¾å½©ã€‚</p>
<p>20.å¹´è½»äººä¸è¦è¯•å›¾è¿½æ±‚å®‰å…¨æ„Ÿï¼Œç‰¹åˆ«æ˜¯å¹´è½»çš„æ—¶å€™ï¼Œå‘¨é­ç¯å¢ƒä»æ¥éƒ½ä¸ä¼šæœ‰ç»å¯¹çš„å®‰å…¨æ„Ÿï¼Œå¦‚æœä½ è§‰å¾—å®‰å…¨äº†ï¼Œå¾ˆæœ‰å¯èƒ½å¼€å§‹æš—è—å±æœºã€‚çœŸæ­£çš„å®‰å…¨æ„Ÿï¼Œæ¥è‡ªä½ å¯¹è‡ªå·±çš„ä¿¡å¿ƒï¼Œæ˜¯ä½ æ¯ä¸ªé˜¶æ®µæ€§ç›®æ ‡çš„å®ç°ï¼Œè€ŒçœŸæ­£çš„å½’å±æ„Ÿï¼Œåœ¨äºä½ çš„å†…å¿ƒæ·±å¤„ï¼Œå¯¹è‡ªå·±å‘½è¿çš„æŠŠæ§ï¼Œå› ä¸ºä½ æœ€å¤§çš„å¯¹æ‰‹æ°¸è¿œæ˜¯è‡ªå·±ã€‚</p>
<p>21.å¦‚æœç»™è¿‡å»5å¹´çš„è‡ªå·±ä¸€ä¸ªå»ºè®®ï¼Œå°±æ˜¯æ¿€è¿›å†æ¿€è¿›ä¸€ç‚¹ã€‚</p>
<p>22.å¿«50å²ï¼Œæ€è·¯æ¸…æ™°æ·±å…¥ï¼Œç»†èŠ‚æ•æ„Ÿï¼Œæ‰§è¡Œåˆé«˜ä¸¾é«˜æ‰“ï¼Œå¾ˆå¥½åœ°æ§åˆ¶è‡ªå·±æƒ…ç»ªã€‚æ™šä¸Šå‚åŠ æ´»åŠ¨çœ‹åˆ°åˆ«äººçš„ä¼˜ç‚¹ã€‚</p>
<p>23.çŸ­æœŸäº¤å¾€è¯´è¯å¿½æ‚ ä¼šæœ‰æº¢ä»·ï¼Œé•¿æœŸäº¤å¾€è¯´è¯å®åœ¨ä¼šæœ‰æº¢ä»·ã€‚</p>
<p>24.ç”¨å¿ƒè®¤çœŸçš„æŠ˜è…¾æ˜¯æ²¡æœ‰é£é™©çš„ã€‚</p>
<p>25.çœ‹ç¼ºç‚¹æœ‰éš¾åº¦ï¼Œæƒè¡¡ç¼ºç‚¹çœ‹ä¼˜ç‚¹æ›´éš¾ï¼›é¿å…çŠ¯é”™æœ‰éš¾åº¦ï¼Œæ¥å—çŠ¯é”™ä»¥æˆåŠŸæ›´éš¾ã€‚</p>
<p>26.é€‰æ‹©æ¯”åŠªåŠ›æ›´é‡è¦ï¼Œè§‚å¿µæ¯”é€‰æ‹©æ›´é‡è¦ã€‚</p>
<p>27.é‡åˆ°ä¸€æœ¬å¥½ä¹¦ï¼Œå¾ˆæ„‰å¿«ï¼Œå’Œé‡åˆ°ä¸€ä¸ªéå¸¸å€¼å¾—äº¤å¾€çš„æœ‹å‹æ˜¯ç›¸ä¼¼çš„ã€‚</p>
<p>28.åœ¨åŒ—äº¬6å¹´ä½äº†6ä¸ªåœ°æ–¹ï¼šå›é¾™è§‚ï¼ŒåŒæ¦†æ ‘ï¼ŒçŸ¥æ˜¥é‡Œï¼Œå’Œå¹³é‡Œï¼Œæƒ æ–°è¥¿è¡—ï¼Œè¥¿åœŸåŸã€‚ä½ ä½è¿‡å“ªå„¿ï¼Ÿ</p>
<p>29.å¤šä¿®ç‚¼ï¼ŒæœŸæ—©è¾¾ï¼šè€³é¡ºã€çŸ¥å¤©å‘½ã€ä»å¿ƒæ‰€æ¬²ä¸é€¾çŸ©ã€‚æƒ³èµ·ä¸€ä¸ªæœ‹å‹çš„msnï¼ˆå›½å¤–çš„é€šè®¯è½¯ä»¶ï¼‰ç­¾åï¼šä¸‰åè€³é¡ºï¼Œå½“æ—¶æ²¡æ³¨æ„ï¼Œç°åœ¨æƒ³åˆ°å·²ç»äº†ä¸èµ·äº†ï¼Œæå‰äº†ä¸€åŠã€‚</p>
<p>30.åœ¨ä¸æ¥åŠ²çš„æ—¶å€™æ¥åŠ²ï¼Œåœ¨å¤ªæ¥åŠ²çš„æ—¶å€™æ·¡å®šã€‚</p>
<p>31.è°¦è™šçš„äººèƒ½çœ‹åˆ°è‡ªå·±çš„ä¸è¶³ï¼Œè‡ªä¿¡çš„äººèƒ½åœ¨çŸ¥é“ä¸è¶³çš„æƒ…å†µä¸‹ä¾ç„¶ç§¯æã€‚</p>
<p>32.ä½ æœ€ç»ˆä¼šæˆä¸ºä½ æƒ³è¦çš„æ ·å­â€”â€”å¦‚æœä½ çœŸçš„éå¸¸æƒ³ã€‚è™½ç„¶å¬èµ·æ¥æœ‰ç‚¹å”¯å¿ƒï¼Œä½†æ˜¯å¼ºå¤§çš„æ„¿æœ›ç¡®å®éå¸¸é‡è¦ã€‚</p>
<p>33.ç¨»ç››è¦è¾èŒç¦»å¼€å¿«å€’é—­çš„å…¬å¸ï¼Œé­å…„é•¿æ£’å–ï¼šâ€œåœ¨è¿™æ ·æ²¡äººå¹²æ´»çš„å…¬å¸ä½ éƒ½åšä¸å‡ºç‚¹æˆç»©æ¥ï¼Œä½ è¿˜èƒ½å¹²ä»€ä¹ˆï¼Ÿæ´›å…‹è²å‹’æ„Ÿè§‰å†ä¹Ÿæ— æ³•å¿å—æ—¥å¤ä¸€æ—¥æ¯ç‡¥çš„å·¥ä½œï¼Œæå‡ºæ¢å²—ï¼Œé­ä¸»ç®¡å†·è¨€â€œè¦ä¹ˆå¥½å¥½å¹²ã€è¦ä¹ˆå¦è°‹å‡ºè·¯â€ã€‚åŒæ ·çš„é“ç†ï¼Œä¸åŒçš„è¯´æ³•ï¼Œå´åƒé›·ä¸€æ ·å‡»ä¸­å¹¶æˆå°±äº†ä¸¤ä¸ªå•†ä¸šå·¨åŒ ã€‚è¿˜æ˜¯é‚£å¥ï¼Œä¸æŠ±æ€¨ã€æƒ³æ–¹æ³•ã€‚</p>
<p>34.å…³äºæ¶ˆè´¹ï¼šä¹°ä¹¦ã€å¥èº«ã€å­¦ä¹ éƒ½å±äºèµ„é‡‘æˆæœ¬è¾¹é™…æˆæœ¬å¾ˆä½ï¼Œå¯¹äºå¾ˆå¤šäººï¼Œåªè¦ä½ èƒ½çœŸæ­£å®Œæˆè¿™äº›æ¶ˆè´¹ï¼Œèµ„é‡‘éƒ½ä¸æ˜¯ä¸»è¦æˆæœ¬è€Œå€¼å¾—å¤§åŠ›æŠ•å…¥çš„æ¶ˆè´¹ã€‚ç»¼ä¸Šï¼Œæˆ‘éå¸¸å»ºè®®å¤§å®¶ä¹°ä¹¦ã€ä¹°ç”µå­ä¹¦ã€ipadã€æ™ºèƒ½æ‰‹æœºã€ä¹°å¥èº«å¡ã€æ¸¸æ³³å¡â€¦è¿˜æœ‰ç±»ä¼¼çš„æ¶ˆè´¹å—ï¼Ÿ</p>
<p>35.â€œç‹¬ç«‹æ€è€ƒå¿ å®äºè‡ªå·±çš„å†…å¿ƒâ€â€œè¶Šæœ´ç´ ä¸è™šè£ï¼Œæ‰€åšå‡ºçš„é€‰æ‹©ä¼šè¶Šå®é™…è€Œå¯è¡Œâ€ã€‚</p>
<p>36.å¬è¯´æœ‰äººæ¯å¤©èƒ½çœ‹ä¸€æœ¬ä¹¦ï¼Œé—®é¢˜è¿˜ä¸åœ¨çœ‹ä¹¦é€Ÿåº¦ï¼Œè€Œæ˜¯åœ¨çŸ¥æ˜“è¡Œéš¾ï¼Œå®è·µçš„é€Ÿåº¦èµ¶ä¸ä¸Šæ‰€çŸ¥çš„è¦æ±‚ï¼Œæ¬ è´¦å¾ˆå¤šã€‚</p>
<p>37.å“æœ‰æˆæ•ˆå¦‚æœæœ‰ä»€ä¹ˆç§˜è¯€çš„è¯ï¼Œé‚£å°±æ˜¯å–„äºé›†ä¸­ç²¾åŠ›ã€‚â€”ã€Šå“æœ‰æˆæ•ˆçš„ç®¡ç†ã€‹</p>
<p>38.ç ”ç©¶èªæ˜äººå¦‚ä½•çŠ¯é”™è¯¯ï¼Œå›æŠ¥ç‡å¾ˆé«˜ã€‚èªæ˜äººæ˜“çŠ¯é”™è¯¯åŒ…æ‹¬ï¼šç¬¬ä¸€ï¼Œå«‰å¦’ä»–äººæˆåŠŸï¼›ç¬¬äºŒï¼Œè‡ªå‘½ä¸å‡¡ï¼›ç¬¬ä¸‰ï¼Œè¿‡äºç›¸ä¿¡è‡ªå·±åˆ¤æ–­ï¼›ç¬¬å››ï¼Œåœæ­¢å­¦ä¹ ï¼›ç¬¬äº”ï¼Œè®¤ä¸ºä¸–ç•Œæ˜¯é™æ­¢çš„ï¼Œç”Ÿæ´»åœ¨è¿‡å»è£è€€ä¸­ï¼›ç¬¬å…­ï¼Œä»»ä½•äº‹æƒ…éƒ½æœ‰è‡ªå·±ä¸€å¥—è¨€ä¹‹æœ‰æ®ã€ä¸”æ·±ä¿¡ä¸ç–‘çš„è¯´æ³•å’Œç†è®ºï¼šå¿˜è®°äº†æ²¡æœ‰è°ƒæŸ¥ç ”ç©¶ï¼Œå°±æ²¡æœ‰å‘è¨€æƒã€‚ä½ ç¬¦åˆå—ï¼Ÿ</p>
<p>39.åšæŒåŸåˆ™å¾ˆå¤šæ—¶å€™æ˜¯ç»æµçš„ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ç§çŸ­æœŸæµ®äºçš„é•¿æœŸå—ç›Šçš„æŠ•èµ„ã€‚</p>
<p>40.çŸ¥è¡Œåˆä¸€çœŸéš¾ï¼Œä¸­é—´å·®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>41.æ—¢ä¼šåº†å¹¸åšäº†ä»€ä¹ˆï¼Œä¹Ÿä¼šåº†å¹¸æ²¡åšä»€ä¹ˆã€‚</p>
<p>42.åŠ å¼ºä¸“æ³¨åŠ›è®­ç»ƒï¼Œå®ƒæ˜¯ä¼˜å…ˆçº§ç®¡ç†çš„ä¿è¯ï¼ŒåŒæ—¶æŒç»­ä¸“æ³¨åŠ›çš„ä¸€ä¸ªåŸºç¡€æ˜¯ä½“åŠ›å’Œç²¾åŠ›ï¼Œé”»ç‚¼ä¿®ç‚¼ã€‚</p>
<p>43.æ™šä¸Šçœ‹ä¹¦ï¼Œçœ‹ä¹¦â€”å¸¦ç€æ‚”æ¨çš„å¿ƒæƒ…å’Œå…‹åˆ¶æ‚”æ¨çš„åŠªåŠ›ã€‚</p>
<p>44.å‘ç°ä¿æŒä½“åŠ›å……æ²›ç²¾åŠ›æ—ºç››æ˜¯ä¸€é¡¹åŸºç¡€å·¥ä½œï½</p>
<p>45.æ˜¨å¤©å’Œæœ‹å‹èŠå¤©ï¼Œæ€»ç»“åˆ°ï¼šåœ¨è¿™ä¸ªä¿¡æ¯æµåŠ¨è¶Šæ¥è¶Šå¿«è¶Šæ¥è¶Šé€æ˜çš„ç¤¾ä¼šï¼Œä»ç»æµçš„è§’åº¦æ¥çœ‹ï¼Œåšä¸€ä¸ªè¡¨é‡Œä¸ä¸€çš„äººæˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œé¾Œé¾Šçš„äººä¼šè¶Šæ¥è¶Šå€’éœ‰ï¼Œä¸è£…ä¸ä½†æ˜¯ä¸€ä¸ªé“å¾·å“æ€§ä¼˜é€‰ï¼Œè€Œä¸”ä¹Ÿæ˜¯æ›´ç»æµçš„ã€‚å¾ˆå¤šäººè¿˜æœªæ„è¯†åˆ°è¿™ç‚¹ã€‚</p>
<p>46.æŸé¡¹è¾ƒé•¿æ—¶é—´ä¸å¦‚äººæ„çš„å·¥ä½œï¼Œç»ˆäºæœ‰äº†èµ·è‰²ï¼Œè€å¿ƒå¾ˆé‡è¦ã€‚å‡¡äº‹éƒ½æœ‰åŸå› ï¼Œåªè¦è®¤çœŸæ‰¾åŸå› å¹¶åŠªåŠ›æ”¹è¿›ï¼Œå°±ä¼šæœ‰æ•ˆæœã€‚</p>
<p>47.ä»Šå¤©ä¼šè°ˆæåˆ°æ„Ÿæ€§ç†æ€§ï¼Œæˆ‘çš„è§‚ç‚¹ï¼šæ„Ÿæ€§æ·±åŒ–æ”¾åœ¨æ·±å¤„ï¼Œç†æ€§å®åŒ–æ”¾åœ¨å‰é”‹ã€‚</p>
<p>48.ä¸ŠåˆåŒ—äº¬å¤§å­¦å‘¨å…¶ä»æ•™æˆå‘è¨€éå¸¸ç²¾å½©ã€‚ä»–è®¤ä¸ºä¸€ä¸ªæŒä¹…å¾—åˆ°åˆ«äººä¿¡ä»»çš„äººï¼Œæ”¶å…¥å°±è¶Šé«˜ã€‚æœ‰æ¯”çŸ¥è¯†ã€æŠ€èƒ½æ›´åŠ é‡è¦çš„ä¸œè¥¿ï¼Œé‚£å°±æ˜¯ä¿¡ä»»ã€‚ä»–ä»¬çš„å›¢é˜Ÿåœ¨ç ”ç©¶äº†å†œæ°‘å·¥çš„æ”¶å…¥ä»¥åå‘ç°ï¼Œæ”¶å…¥æœ€é«˜çš„äººï¼Œå¾€å¾€å¹¶ä¸æ˜¯ä½“åŠ›æœ€å¥½ã€æŠ€èƒ½æœ€å¥½çš„æ—¶å€™ï¼Œè€Œæ˜¯æœ€å—ä¿¡ä»»çš„äººã€‚æ‰€ä»¥ï¼Œæˆä¸ºä¸€ä¸ªå—äººä¿¡ä»»çš„äººï¼Œéå¸¸é‡è¦ã€‚</p>
<p>49.æ”¹å˜ä½ ç›®å‰èƒ½æ”¹å˜çš„ï¼Œä¸“æ³¨åˆ°circle of influenceï¼ˆå½±å“åœˆï¼‰ï¼šç°åœ¨æœ€é‡è¦çš„æ˜¯æ”¾æ¾ï¼Œç¡è§‰å»ã€‚</p>
<p>50.æœ€è¿‘æ„Ÿæƒ³ï¼šå£ç¢‘å¾ˆé‡è¦ï¼Œäººå“å¾ˆé‡è¦ï¼Œä¿¡ç”¨å¾ˆé‡è¦ï¼Œè¶Šè€è¶Šé‡è¦ï¼ŒåŸåˆ™è¦åšå®šã€‚</p>
<p>51.ä¸Šå¸ä¸å¯èƒ½éª—å¾—äº†æˆ‘ï¼Œå› ä¸ºæ‰€æœ‰çš„æ¬ºéª—éƒ½æœ‰æ¼æ´ã€‚â€”â€”ç¬›å¡å°”</p>
<p>52.å°†äº‹æƒ…åšæ»¡ï¼Œè¿˜æ˜¯å°†äº‹æƒ…åšå¥½ï¼Œå…¶å®æ˜¯å¾ˆä¸ä¸€æ ·çš„ã€‚æˆ‘ä»¬å®¹æ˜“çœ‹åˆ°å°†äº‹æƒ…åšæ»¡ï¼Œä½†æ˜¯å®¹æ˜“å¿½ç•¥æŠŠäº‹æƒ…åšå¥½ã€‚</p>
<p>53.æŒ‡æ ‡ç³»ç»Ÿï¼šä¸ºä»€ä¹ˆåˆ·ç‰™ä¸èƒ½åšæŒè®¤çœŸåˆ·ï¼Œä¸ºä»€ä¹ˆåœ¨è·‘æ­¥æœºä¸Šèƒ½åšæŒè·‘æ­¥ã€‚æœ‰è®¸å¤šäº‹æƒ…ä¸å®¹æ˜“åšå¥½å’Œä¸è¢«é‡è§†çš„åŸå› å°±æ˜¯å› ä¸ºæ²¡æœ‰æŒ‡æ ‡ç³»ç»Ÿã€‚æ¯”å¦‚ï¼Œå¦‚æœå¥åº·æœ‰å‡†ç¡®æ–¹ä¾¿åº¦é‡çš„æŒ‡æ ‡ï¼Œé‚£ä¹ˆå¤§å®¶çš„èº«ä½“ç´ è´¨ä¸€å®šä¼šæé«˜ã€‚ä½†æ˜¯æŒ‡æ ‡ä¸è§å¾—å¥½æç‚¼ï¼Œæç‚¼æŒ‡æ ‡çš„è¿‡ç¨‹ï¼Œæœ¬èº«æ˜¯åˆ†è§£äº‹ç‰©ç‰¹å¾çš„è¿‡ç¨‹ã€‚è€Œä¸”æŒ‡æ ‡è¦å¸¸æµ‹é‡ã€‚æ¯”å¦‚è¯´ï¼šå½“æˆ‘ä»Šå¤©å‘ç°çœ¼ç›åº¦æ•°ä¸Šå‡100åº¦çš„æ—¶å€™ï¼Œæ‰å‘ç°çœ¼ç›è¿‡ç–²åŠ³äº†ï¼Œç”¨çœ¼ä¸æ³¨æ„äº†ï¼Œåœ¨æ‰‹æœºä¸Šçœ‹ä¹¦æ˜¯éå¸¸ä¸æ°å½“çš„è¡Œä¸ºã€‚å…³é”®æ˜¯ä»Šå¤©æ‰çŸ¥é“å“‡â€¦</p>
<p>54.å¤§å¤šæ•°äººï¼Œç¡®å®ä¸€å¼€å§‹å°±æƒ³ç»•è¿‡å›°éš¾ã€‚å¥½çš„é—®é¢˜å°±æ˜¯ä¸€åŠçš„ç­”æ¡ˆï¼Œå‰©ä¸‹ä¸€åŠç­”æ¡ˆå°±æ˜¯å¥‹æ–—ã€‚</p>
<p>55.ä½ ä»¬è¯»äº†å“ªäº›ä¼ è®°ï¼Ÿæƒ³èµ·2å¹´å‰æœ‹å‹è¯´ï¼šå¦‚æœä¸çŸ¥é“è®©å°å­©é˜…è¯»ä»€ä¹ˆï¼Œæœ€é€‚åˆçš„å°±æ˜¯ä¼ è®°ã€‚æœ€è¿‘åœ¨æ€è€ƒä¸å›å¿†ï¼šå…³äºå“æ ¼ã€ç†æƒ³ã€åŠ¨æœºçš„å½¢æˆï¼Œè§‰å¾—ç¡®å®å¦‚æ­¤ã€‚</p>
<p>56.æˆ‘å»å¹´è‡ªå·±æœ‰ä¸€ä¸ªæ„Ÿæƒ³ï¼šè§‰å¾—ä¹‹å‰çš„è€æ¿éƒ½å¯¹æˆ‘ä¸å¤ªè‹›åˆ»å•Šã€‚å¦åˆ™æˆ‘å½“æ—¶èƒ½åšçš„æ›´å¥½ã€‚å½“ç„¶å¾ˆå¯èƒ½æ˜¯ä»–ä»¬è®¤ä¸ºï¼Œå·²ç»åšçš„å¥½ï¼Œå¤ªè‹›åˆ»äººå°±è·‘äº†ï¼Œå…¶å®å¯¹äºä¼šè‡ªæˆ‘é©±åŠ¨çš„äººæ˜¯ä¸ä¼šçš„ã€‚</p>
<p>57.å…³äºæ„Ÿæ€§ï¼Œæˆ–å¿§æˆ–æ‚²ï¼Œä½†ä½ çœ‹åˆ°äººç”Ÿä¸å®¹æ˜“åä¹‹å…«ä¹ï¼Œå½“ä½ çœ‹åˆ°ç”Ÿæ´»çš„çœŸå®é¢ç›®æ—¶ï¼šä½ ä¼šæ‚²ï¼Œä½†å°±ä¸ä¼šå› è¡¨è±¡è€Œä¼¤æ„Ÿï¼›ä½ ä¼šå–œï¼Œä¹Ÿä¸ä¼šè€Œæµ®åè€Œæä¹ã€‚ç”Ÿæ´»ä¸­æœ‰æ—¶å€™çŒ›ç„¶å¬åˆ°æ®‹é…·è€ŒåˆçœŸå®æœ‰ç©¿é€åŠ›çš„è¯ï¼Œçœ‹åˆ°æœ¬æœ‰è¿ä¸–ç•Œè§‚è€Œåˆæœ‰ç†çš„ä¹¦ï¼Œç›´åˆ°ä½ è‡ªå·±ä¼šä¸‹æ„è¯†çš„å»çœ‹ç”Ÿæ´»æœ¬æ¥é¢ç›®ï¼Œä½ çš„æ„Ÿæ€§å°±å˜åŒ–äº†ã€‚</p>
<p>58.ç©å¾·å·æ‰‘å…‹çœ‹äººæ€§çš„å¼±ç‚¹ï¼šç¬¬ä¸€ï¼Œè´ªç©ï¼ˆä¸€å¼€å§‹æ‹¿çƒ‚ç‰Œä½†æ˜¯ä¸foldï¼Œfold:è®¤è¾“ï¼‰ï¼›ç¬¬äºŒï¼Œä¾¥å¹¸ï¼ˆå¸Œæœ›ç­‰ä½æ¦‚ç‡äº‹ä»¶ï¼‰ï¼›ç¬¬ä¸‰ï¼Œä¸èƒ½èˆï¼ˆå› è¿‡å»ä»˜å‡ºè€Œä¸æ”¾å¼ƒï¼‰ï¼›ç¬¬å››ï¼Œè¿‡åº¦æ¦‚æ‹¬ï¼ˆåªçœ‹ä¸€ä¸ªä¾‹å­å°±ä¸‹ç»“è®ºï¼‰ã€‚å…¶å®ï¼Œå¾·å·æ‰‘å…‹å’Œäººç”Ÿä¸€æ ·ï¼šåº”è¯¥ï¼šç¬¬ä¸€ï¼Œç†è§£ä¸ç¡®å®šæ€§ï¼›ç¬¬äºŒï¼Œä¸“æ³¨æœ‰å¯èƒ½çš„äº‹æƒ…ï¼›ç¬¬ä¸‰ï¼Œç†æ™ºè¯„ä¼°æ¦‚ç‡ï¼›ç¬¬å››ï¼Œèƒ½èˆæ‰èƒ½å¾—ï¼›ç¬¬äº”ï¼Œé¿å…æ„æ°”ç”¨äº‹ã€‚</p>
<p>59.åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°å¾ˆå¤šITè¡Œä¸šèªæ˜çˆ±æ€è€ƒçš„äººçš„æ€è€ƒï¼Œå¯†åº¦å¾ˆé«˜ã€‚æ„Ÿè§‰æ˜¯æ°›å›´å°šä¸æ˜¯æ¨¡å¼å¸¦æ¥çš„ï¼Œå–œæ¬¢å’Œèªæ˜æ€è€ƒçš„äººå…±å¤„ã€‚</p>
<p>60.ç»ˆäºæŠŠã€Šå¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦ã€‹é˜…è¯»å®Œäº†ã€‚ç¾å›½äººå°±æ˜¯è®¤çœŸï¼ŒæŠŠé˜…è¯»çš„é—®é¢˜æ–¹æ³•åˆ¨æ ¹ç©¶åº•ã€‚è¿™ä¸æ˜¯ä¸€æœ¬èµ„è®¯å¨±ä¹ç±»çš„ä¹¦ï¼Œæ˜¯éœ€è¦å’Œå¢è¿›ç†è§£çš„ä¹¦ã€‚</p>
<p>61.ä¸€ä»¶äº‹æƒ…ä¸Šï¼Œåœ¨å¿ƒé‡Œæƒ³å¯¹æ–¹è‡ªç§çš„æ—¶å€™ï¼Œæƒ³ä¸€æƒ³è‡ªå·±ï¼šå¤šæ•°å‘ç°è‡ªå·±ä¹Ÿè›®è‡ªç§çš„ã€‚åœ¨éª‚å¯¹æ–¹è´ªå©ªçš„æ—¶å€™ï¼Œæƒ³ä¸€æƒ³è‡ªå·±ï¼šå¤šæ•°å‘ç°è‡ªå·±ä¹ŸåŒæ ·è´ªå©ªã€‚</p>
<p>62.åšä¸ªç†æ€§äººï¼Œå¾ˆå¤šäº‹æƒ…å°±ä¸å¿…åšã€‚æ„Ÿæ€§åšäººï¼Œç†æ€§åšäº‹çš„æ€åº¦æœ‰å…¶æ„ä¹‰ã€‚</p>
<p>63.ä»Šå¤©æ‰‹æœºæŠ¥ä¸Šæœ‰ä¸€æ®µè¯:â€œç‹¬å¤„æ˜¯ä¸€æ¬¡å¿ƒçµæŒ‰æ‘©â€é™ååœ¨æ–—å®¤é‡Œï¼Œæ¼«æ­¥åœ¨å°é“ä¸Šï¼Œå¹³èººåœ¨æ²™æ»©ä¸Šâ€¦æœ‰æ„è¯†çš„é¢å¯¹è‡ªå·±ï¼Œå’Œå†…å¿ƒå¯¹è¯ã€‚å–œæ¬¢ç‹¬å¤„çš„äººï¼Œå’Œåˆ«äººåœ¨ä¸€èµ·æ—¶ï¼Œå¾€å¾€ä¹Ÿä¼šå¤„ç†çš„æ›´å¥½ã€‚äº¤æµå’Œç‹¬å¤„ç›¸è¾…ç›¸æˆï¼Œæ‰èƒ½è®©å†…å¿ƒæˆç†Ÿå’Œå¼ºå¤§ã€‚</p>
<p>64.å‡¡äº‹å°±æ€•ä¸è®¤çœŸï¼Œä¸æ€è€ƒã€‚å¥½å¤šé—®é¢˜æˆ‘åº”è¯¥èƒ½çŸ¥é“çš„ï¼Œåªæ˜¯ä¹‹å‰æ²¡æœ‰è®¤çœŸçœ‹ï¼Œè®¤çœŸæƒ³ï¼Œæƒ³å½“ç„¶ï¼ˆä¸æ˜¯æ²¡æ—¶é—´ï¼‰ã€‚å»¶è¿Ÿæ»¡è¶³æ„Ÿæ˜¯ä¸€é¡¹é•¿æœŸä¿®ç‚¼ã€‚</p>
<p>65.å°é£æ¥çš„æ—¶å€™ï¼ŒçŒªéƒ½ä¼šé£èµ·æ¥ã€‚æ‰€ä»¥ï¼ŒçœŸçš„é£èµ·æ¥æ—¶ä¸€å®šè¦æ¸…æ¥šçš„çŸ¥é“æ˜¯å› ä¸ºè‡ªå·²èƒ½é£ï¼Œè¿˜æ˜¯å¤–åŠ›ä½¿ç„¶ã€‚é å°é£é£èµ·æ¥çš„çŒªè¿Ÿæ—©æ˜¯ä¼šæ‰ä¸‹æ¥çš„ã€‚</p>
<p>66.æœ‰äººé—®æ¯”å°”Â·ç›–èŒ¨ï¼šä»€ä¹ˆæ˜¯ä½ æœ€å¤§çš„ææƒ§ï¼Ÿç›–èŒ¨å›ç­”ï¼šæˆ‘æœ€ææƒ§çš„æ˜¯é‚£äº›æ­£åœ¨ç ´è½¦åº“é‡Œæ²¡æ—¥æ²¡å¤œæ£é¼“æ–°åå ‚çš„å¹´è½»äººã€‚</p>
<p>67.å†™å®Œæ–‡æ¡£å‡†å¤‡ç¡è§‰ï¼Œæƒ³èµ·ä»Šå¤©çœ‹çš„ã€Šfacebook æ•ˆåº”ã€‹ï¼Œçªç„¶æƒ³èµ·ã€Šæ™®é€šç”Ÿç‰©å­¦ã€‹ä»‹ç»çš„ä¸€ä¸ªç‰©è´¨ï¼šå¤šå·´èƒºã€‚æœ€è¿‘æ„ˆå‘æƒ³èµ·äººä¸äººä¹‹é—´çš„çŠ¶æ€åŒºåˆ«ï¼Œæ˜¯å¦æœ‰æ¿€æƒ…ï¼Œæ˜¯å¦è‡ªæˆ‘æ¿€åŠ±ï¼Œæ˜¯å¦æ˜¯ç”±è¿™ç±»ç‰©è´¨çš„ä»£è°¢æ°´å¹³å†³å®šäº†åŸºæœ¬é¢ã€‚è‚–æ©Â·å¸•å…‹æ˜¯å¤šå·´èƒºæ°´å¹³å¾ˆé«˜çš„å…¸å‹ï¼Ÿ</p>
<p>68.æƒ³åšçš„äº‹æƒ…å¤ªå¤šï¼Œç»å¸¸è¦æŠ‘åˆ¶è‡ªå·±çš„æ¿€åŠ¨ã€‚</p>
<p>69.æ²Ÿé€šï¼Œå¬ä¸€ä¸ªäººè¯´è¯ï¼šä½ æ˜¯å¦çŸ¥é“ä»–åœ¨è¯´ä»€ä¹ˆï¼Œä½ æ˜¯å¦çŸ¥é“ä»–çŸ¥é“ä»–åœ¨è¯´ä»€ä¹ˆï¼Œä½ æ˜¯å¦çŸ¥é“ä»–ä»¬çŸ¥é“ä»–åœ¨è¯´ä»€ä¹ˆã€‚</p>
<p>70.ä»Šå¤©æ™šä¸Šçš„æ—¶å€™ï¼Œæ¯ä¸ªå‘¨äº”æ™šä¸Šä¸‹ç­çš„æ—¶å€™ï¼Œæˆ‘å¸¸ä¼šå’ŒåŒäº‹è¯´ï¼šæˆ‘æ˜å¤©å‡æœŸæˆ‘ä»¬å†æŠŠxxxåšå¥½ã€‚æ¯æ¬¡çªç„¶æƒ³è¿™å¥è¯çŸ›ç›¾å•Šï¼Œä¸èƒ½è¿™æ ·è¦æ±‚ã€‚å—¯ï¼Œç”Ÿæ´»å·¥ä½œè¦å¹³è¡¡ã€‚ä¸è¿‡ï¼Œåˆ«äººè…è´¥çš„æ—¶å€™æˆ‘ä»¬åœ¨åŠªåŠ›ï¼Œåˆ«äººæ¶ˆç£¨æ—¶å…‰çš„æ—¶å€™æˆ‘ä»¬åœ¨å­¦ä¹ ï¼Œé‚£ä¹ˆå»¶è¿Ÿçš„æ»¡è¶³ä¸€å®šä¼šåšç§¯è–„å‘æ¥åˆ°ã€‚</p>
<p>71.å»¶è¿Ÿæ»¡è¶³æ„Ÿç»éªŒï¼šæ¶µè“„æƒ…ç»ªï¼Œè®©è‡ªå·±é™æ­¢ï¼Œä¸è¦åœ¨æ²Ÿé€šäº¤æµçš„æ—¶å€™èµ°åŠ¨ã€æ™ƒåŠ¨ï¼Œæƒ…ç»ªè·³åŠ¨ï¼Œæ€ç»´å¤±å»ç²¾ç¡®æ§åˆ¶ã€‚</p>
<p>72.å¯»æ‰¾é”™è¯¯æˆ–è€…é—®é¢˜å¯ä»¥ä»å‘ç°è‡ªæˆ‘çŸ›ç›¾ç‚¹åšèµ·ï¼Œå¦‚æœèƒ½ç†æ€§åœ°ä½¿ç”¨é€»è¾‘ã€‚</p>
<p>73.æ³¨æ„åŠ›ä¹Ÿå¯ä»¥å¼€æºèŠ‚æµçš„ï¼Œæ¬²æœ›å’Œæ‚å¿µåˆ†æ•£æ³¨æ„åŠ›è¦èŠ‚æµï¼Œé”»ç‚¼èº«ä½“å’Œæ³¨æ„åŠ›è®­ç»ƒæ˜¯å¼€æºã€‚</p>
<p>74.äººä¸é€¼ä¸€ä¸‹è‡ªå·±ï¼Œæ°¸è¿œä¸çŸ¥é“è‡ªå·±æ½œåŠ›æœ‰å¤šå¤§ã€‚å¾ˆå¤šäº‹æƒ…éä¸èƒ½ä¹Ÿï¼Œæ˜¯ä¸ä¸ºä¹Ÿã€‚</p>
<p>75.æˆ‘æœ€è¿‘ç»å¸¸é—®è‡ªå·±ï¼šé©¬ä¸Šæœ‰ä»€ä¹ˆå¯è¡ŒåŠ¨ï¼Œä½ æ˜¯è¡ŒåŠ¨æ´¾å—ï¼Ÿå¾ˆå¤šé—®é¢˜å®ƒä¸ä¼šæ¶ˆå¤±ï¼Œä¸åŠ¨(çŠ¹è±«&#x2F;æŠ±æ€¨&#x2F;æ„Ÿå¹)è‚¯å®šæ˜¯é”™è¯¯ï¼Œè¡ŒåŠ¨å°±æœ‰åŠ›é‡ï¼Œå“ªæ€•æ˜¯è¡ŒåŠ¨çš„å‡†å¤‡è¡ŒåŠ¨ï¼Œå”¯æœ‰è¡ŒåŠ¨æ‰èƒ½æ”¹å˜äº‹æƒ…ã€‚</p>
<p>76.ã€Šå¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦ã€‹ä¸€ä¹¦åœ¨è°ˆæŠ€èƒ½ä¹‹å¤–ï¼Œæ›´å¤šçš„æ˜¯è®²å­¦ä¹ çš„æ€åº¦å’Œæ²Ÿé€šçš„æ–¹æ³•ã€‚æ¯”å¦‚èµåŒå’Œåå¯¹ä¸€ç« ï¼Œå…¶å®æ ‡é¢˜äº¦å¯å†™ä¸ºï¼Œå…³äºæ²Ÿé€šçš„èµåŒå’Œåå¯¹ã€‚</p>
<p>77.å¥½çš„é—®é¢˜å°±æ˜¯ä¸€åŠçš„çš„ç­”æ¡ˆã€‚</p>
<p>78.ä¹”å¸ƒæ–¯è¯´stay hungryï¼Œæˆ‘ä»¥ä¸ºé¥¥æ¸´æœ‰ä¸‰ä¸ªå±‚æ¬¡ï¼šè´ªå©ªã€æˆå°±åŠ¨æœºã€å¥½å¥‡å¿ƒ ã€‚ä¸‰è€…åˆ†åˆ«å…³æ³¨ï¼šç¬é—´çš„ç»“æœï¼ŒæŒç»­çš„è¿‡ç¨‹ï¼Œå’Œè¿œå¤§çš„æœªçŸ¥ã€‚ä¸‰è€…ä¹Ÿæ°å¥½å¯¹åº”äº†ä¸‰ç§äººï¼šå‘åŠ£çš„æŠ•æœºè€…ï¼Œè‰°è¾›çš„æ”€ç™»è€…ï¼Œä¸å¹¸ç¦çš„æ¢ç´¢è€…ã€‚</p>
<p>79.æœ‰ä¸å°‘ç•™è¨€è¯´ä¸ç†è§£è¿™æ®µè¯ã€‚ç ”ç©¶å¿«ä¹çš„ä¸“å®¶å‘Šè¯‰æˆ‘ä»¬ï¼Œå¿«ä¹æœ‰ä¸‰ç§ï¼špleasureï¼ˆæ¬¢ä¹ï¼‰,passionï¼ˆçƒ­æƒ…ï¼‰,higherpurposeï¼ˆç†æƒ³ã€æœ‰æ„ä¹‰ï¼‰ã€‚å…¶ä¸­æ¬¢ä¹æ˜¯æœ€çŸ­æš‚çš„ï¼Œçƒ­æƒ…å…¶æ¬¡ï¼Œè€Œæœ€é•¿ä¹…çš„æ˜¯ç†æƒ³ã€‚</p>
<p>80.æƒ³å­¦çš„ä¸œè¥¿å¾ˆå¤šï¼Œå¾ç”Ÿæœ‰æ¶¯çŸ¥æ— æ¶¯ï¼Œä»¥æœ‰æ¶¯è¿½æ— æ¶¯ï¼Œæ€ ä¹Ÿã€‚æœ‰ä¸¤ç§ç†è§£ï¼Œç§¯æçš„ç†è§£æ˜¯åº”è¯¥æœ‰ä¼˜å…ˆçº§çš„è§„åˆ’å­¦ä¹ ã€‚</p>
<p>81.åšå‡æ³•æœ€ä¸å®¹æ˜“ä¹Ÿæœ€å®¹æ˜“ã€‚</p>
<p>82.ç°åœ¨å¹´è½»äººéƒ¨åˆ†æµè¡ŒæŠŠä¸‰å››åå²é€€ä¼‘ä½œä¸ºç†æƒ³ï¼Œæˆ‘ä¸è®¤åŒï¼Œæˆ‘è§‰å¾—ç†æƒ³æ˜¯ä¸€ç›´æœ‰æœºä¼šåˆ›é€ ã€å®ç°æƒ³æ³•ï¼Œæœ‰æœºä¼šå­¦ä¹ ï¼Œä¿®ç‚¼ï¼Œåˆ›é€ åˆ°è€ã€‚ä¸ºä»€ä¹ˆä¼šæƒ³é€€ä¼‘ï¼Ÿæƒ³é€€ä¼‘è¯´æ˜ä½ è®¤ä¸ºç°åœ¨æ˜¯åœ¨â€œå¿â€ã€‚æˆ‘è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šæƒ³æ³•æƒ³åšï¼Œå¸Œæœ›ä¸‰å››åå²æ›´å¤šæ¡ä»¶å»å®ç°æƒ³æ³•ã€‚</p>
<p>83.äººç¾¤æ€»æœ‰ä¸€äº›äººxxç´ æ¯”æ™®é€šäººé«˜(å¾ˆå¥½)æœ‰ç²¾ç¥æœ‰æ–—å¿—ï¼Œçˆ±å­¦ä¹ ï¼Œçˆ±åˆ›é€ ï¼Œçˆ±æŠ˜è…¾ã€‚ä¸‹åˆå’Œä¸€ä¸ªåœ¨æŸé¡¶çº§äº’è”ç½‘å…¬å¸çš„è€æœ‹å‹èŠå¤©ï¼Œä»–åˆè¦å‡ºæ¥åˆ›ä¸šäº†ã€‚</p>
<p>84.å‘ç°æœ€è¿‘ï¼Œä¸è®ºæ˜¯ä¸€èµ·å…¬å¸çš„åŒäº‹ï¼Œæˆ–æ˜¯æŠ•èµ„äººï¼Œè¿˜æ˜¯è€åŒå­¦éƒ½ä¸çº¦è€ŒåŒæåˆ°ä¸€ç‚¹ï¼šè¿‡å»ä¸€å¹´ï¼Œæˆ‘å˜åŒ–å¾ˆå¤§ã€‚æˆ‘ç›¸ä¿¡ä»–ä»¬æ˜¯èƒ½æ„Ÿè§‰åˆ°æˆ–è€…è§‚å¯Ÿåˆ°ï¼Œä½†æ˜¯å˜åŒ–çš„å¿ƒè·¯åªæœ‰è‡ªå·±æ‰çŸ¥é“ï¼Œæ‰€ä»¥è‡ªå·±è§‰å¾—å¾ˆè‡ªç„¶ã€‚</p>
<p>85.ä¿è¯è¶³å¤Ÿç¡çœ æ˜¯ç§¯æé«˜æ•ˆçš„ç¬¬ä¸€æ­¥ã€‚</p>
<p>86.è‡ªæˆ‘å®ç°ï¼Œè‡ªæˆ‘ä¿®ç‚¼æ˜¯æœ€é«˜å±‚æ¬¡ã€‚</p>
<p>87.ç”Ÿæ´»ä¸­ä¸æ˜¯ç¼ºå°‘ç¾ï¼Œè€Œæ˜¯ç¼ºå°‘åˆ†äº«ã€‚</p>
<p>88.å¾ˆå¤šå¾ˆå¥½çš„æƒ³æ³•è‡ªå·±éƒ½éå¸¸è®¤çœŸï¼Œç°åœ¨éƒ½è¢«äººå®ç°æˆ–è€…é€šå¾€å®ç°çš„è·¯ä¸Šäº†ã€‚çœŸå¸Œæœ›è‡ªå·±èƒ½åˆ†èº«ä½“å‡ ä¸ªåŒæ—¶åŠªåŠ›ï¼Œè¿™æ ·äººç”Ÿå¤šç²¾ç¡®ã€‚ä½†æ˜¯åˆ†èº«æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥åªèƒ½â‘ æ ¹æ®æƒ…å†µæ’ä¼˜å…ˆçº§ï¼›â‘¡æ‰¾åˆ°å¿—åŒé“åˆçš„äººã€‚</p>
<p>89.ä»Šå¤©M.A.Dä¼šè®®ï¼Œå¬åˆ°ä¸€ä¸ªå…³äºSEOäººç‰©ä»‹ç»ï¼Œæåˆ°æŸäººéå¸¸æ´’è„±ã€‚æˆ‘å¯¹äººç‰©ä»‹ç»å€’æ²¡æœ‰æ„Ÿè§‰åˆ°ç‰¹åˆ«ã€‚ä½†æ˜¯å¯¹æ´’è„±è¿™ä¸ªè¯ï¼Œçªç„¶æœ‰ç‚¹æ„Ÿæƒ³ã€‚æ•ˆç‡å’Œç«äº‰å¾€å¾€æŠŠäººå˜å¾—å¾ˆç²¾ç¡®ã€ä¸¥è°¨ã€æ³¨é‡ç»†èŠ‚ã€å¼ºè°ƒè®¡åˆ’å’Œæ§åˆ¶ï¼Œè¿™äº›éƒ½æ²¡é”™ï¼Œä½†æ˜¯å¤§å®¶è¦æ³¨æ„ä¿ç•™ä¸€ä»½æ´’è„±ï¼Œæ€§æ ¼å’Œäººç”Ÿè§‚åˆ«èŒä¸šè¢«å¸¦å…¥å¦ä¸€ä¸ªèƒ¡åŒã€‚</p>
<p>90.æœ€è¿‘IPOï¼ˆé¦–æ¬¡å…¬å¼€å‹Ÿè‚¡ï¼‰çš„å…¬å¸ä¸€å †ä¸€å †çš„ï¼Œä½†æ˜¯å¤§å®¶ä¸€å®šè¦è€å¾—ä½å¯‚å¯ï¼Œä»–ä»¬ä»Šå¤©çš„æˆåŠŸæ˜¯ä»–ä»¬çš„è¿‡å»å·²ç»å†³å®šçš„ï¼Œå±äºä»–ä»¬ã€‚æˆ‘ä»¬çš„æˆåŠŸæ˜¯æˆ‘ä»¬çš„ç°åœ¨å’Œå°†æ¥å†³å®šçš„ã€‚æˆ‘å‘ç°å¾ˆå¤šäº‹æƒ…ç»å¸¸æ˜¯è¿™æ ·çš„ï¼šä»Šå¤©å’Œæ˜å¤©å·²ç»ç”±æ˜¨å¤©å†³å®šï¼Œä½ è¿˜å¯ä»¥å†³å®šåå¤©ã€‚</p>
<p>91.åº”å±Šç”Ÿåº”è¯¥æ¨å´‡è‡ªä¿¡ï¼Œè¯šå®ï¼ŒåŠªåŠ›ï¼Œç›¸ä¿¡æˆåŠŸå¯é€šè¿‡å­¦ä¹ å’ŒåŠªåŠ›è·å¾—ã€‚åˆ«å¤ªè®¨å·§ï¼Œèµ°æ·å¾„ã€‚äº‹å®ä¸Šé¢è¯•å¤§å¤šä¸æ˜¯å› ä¸ºæŠ€èƒ½ä¸è¡Œï¼Œè€Œæ˜¯äººå“å’Œæ€§æ ¼ä¸è¡Œã€‚</p>
<p>92.ä¸€è¿ä¸²æœ‰æƒ³è±¡åŠ›ä¸”æ°å½“çš„æ¯”å–»è¿ç»­ä½¿ç”¨æ˜¯è®²é“ç†çš„å¥½æ–¹æ³•ã€‚</p>
<p>93.é€šè´§è†¨èƒ€æ­£åœ¨æ´—åŠ«ä½ çš„é’±åŒ…ï¼ŒåŒå­¦é—®æ€ä¹ˆåŠï¼Ÿä¸‰ä¸ªåŠæ³•ï¼Œä¸€æ˜¯å°½å¯èƒ½åœ°æé«˜å®¶åº­è´Ÿå€ºç‡ï¼Œå½“ä»Šä¹‹ä¸–èƒ½å€Ÿåˆ°é’±çš„å°±æ˜¯è‹±é›„ï¼›äºŒæ˜¯é…ç½®èµ„æºæ€§è´¢äº§ï¼Œèƒ½å¤ŸæŠµæŠ—é€šæ¶¨çš„åªæœ‰ä¸‰ä¸ªä¸œè¥¿ï¼Œé»„é‡‘æˆ¿äº§å’Œå†œäº§å“ï¼›ä¸‰æ˜¯è±¡å‚»ç“œä¸€æ ·çš„é•¿æœŸæŒæœ‰ï¼Œçœ¼å‰çš„æ¶¨è·Œéƒ½æ˜¯å¯¹è€å¿ƒçš„è€ƒéªŒã€‚é™¤éå¤©ä¸‹å¤§ä¹±ï¼Œå¦åˆ™ä»¥ä¸Šä¸‰æ¡åº”æ˜¯è§„å¾‹ã€‚</p>
<p>94.æˆ‘ä»Šå¤©çš„å¤„å¢ƒéƒ½æ˜¯å› ä¸ºæˆ‘æœ‰äº›åº”è¯¥åšçš„äº‹æƒ…æˆ‘æ²¡æœ‰åšï¼Œä¸åº”è¯¥åšçš„äº‹æƒ…æˆ‘å°±å…¨åšï¼Œæ‰€ä»¥è¦æ”¹å˜ç°çŠ¶ï¼Œå°±è¦ä»è‡ªå·±å¼€å§‹ã€‚</p>
<p>95.æœ‰ç™¾åˆ†ä¹‹å¤šå°‘çš„æŠŠæ¡ä½ ä¼šå¼€å§‹åˆ›ä¸šï¼Œæœ‰å¤šæ·±çš„æ„Ÿè§‰ä½ ä¼šå¯¹å¦å¤–ä¸€ä¸ªäººè¯´æˆ‘çˆ±ä½ ï¼Œæœ‰å¤šä¹ˆçš„ç¡®ä¿¡ä¼šè®©ä½ æœ‰ç²¾ç¥ä¸Šçš„ä¿¡ä»°ã€‚ä½ ä¸å¿…ç­‰ä¸€åˆ‡éƒ½100%ç¡®å®šäº†æ‰å¼€å§‹åˆ›ä¸šï¼Œå»çˆ±ä¸€ä¸ªäººå’Œå»ºç«‹ä¿¡ä»°ã€‚å…¶å®æˆ‘ä»¬çš„ç¡®ä¿¡åº¦æ°¸è¿œè¾¾ä¸åˆ°100%ï¼Œé‚£ä¹ˆä½ ä¼šä¸€ç›´ç­‰å—ï¼Ÿä»Šå¤©ï¼Œä½ å¦‚æœä¸åšä¸€ä¸ªè‚¯å®šçš„å†³å®šå¯èƒ½ä¼šå¤±å»å¾—æ›´å¤šã€‚</p>
<p>96.ä¸€ä¸ªå›°æ‰°æˆ‘ä»¬å¾ˆé•¿çš„æ—¶é—´æŠ€æœ¯è¯¡å¼‚é—®é¢˜ï¼ŒåŒäº‹ä»¬è¿™ä¸¤å¤©é›†ä¸­æ—¶é—´é›†ä¸­ç²¾åŠ›åˆ†æã€æ±‚åŠ©ã€æ’æŸ¥ã€å°è¯•ç»ˆäºè§£å†³ã€‚æƒ³èµ·ç¨»ç››å’Œå¤«çš„è¯´çš„ï¼šç”¨å°½å…¨åŠ›ï¼Œå¼‚å¸¸è®¤çœŸï¼Œç¥æ˜å°±ä¼šæ¥ç›¸åŠ©ã€‚å…¶å®ç¥æ˜æœªå¿…ç›¸åŠ©ï¼Œä½†æ˜¯ä½ ä¼šæ›´æ¥è¿‘é—®é¢˜çš„æœ¬è´¨ï¼Œä»è€Œè§£å†³é—®é¢˜ã€‚</p>
<p>97.ç³»ç»Ÿåœ°è¿åŠ¨é”»ç‚¼éœ€è¦æŠ—èº«ä½“çš„æƒ°æ€§ï¼Œé”»ç‚¼ä¹…äº†ä¹‹åï¼Œä¸ä½†èº«ä½“å¥½ï¼Œè€Œä¸”é”»ç‚¼çš„ç§¯ææ€§ä¹Ÿå¥½ï¼Œå®¹æ˜“å¯åŠ¨ï¼Œå…»æˆä¹ æƒ¯ï¼Œæœ€è¿‘è§‰å¾—è¯»ä¹¦å­¦ä¹ ä¹Ÿå¾ˆç±»ä¼¼ã€‚</p>
<p>98.çœ‹å®Œã€Šå¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦ã€‹è¿™ä¸€ç« ï¼šå¦‚ä½•åšä¸€ä¸ªè‡ªæˆ‘è¦æ±‚çš„è¯»è€…ã€‚ä¹Ÿå³é˜…è¯»åº”è¯¥æ˜¯æœ‰è‡ªæˆ‘è¦æ±‚çš„å…·ä¸»åŠ¨çŠ¶æ€çš„ã€‚é˜…è¯»ä¸¤å­—æ¢æˆå…¶å®ƒå¾ˆå¤šè¯ä¹Ÿé€‚ç”¨ã€‚</p>
<p>99.æ‰§è¡ŒåŠ›åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘è®¤ä¸ºçš„æ‰§è¡ŒåŠ›æ˜¯ï¼šè¯´åˆ°åšåˆ°ï¼Œä¸æ‰¾å€Ÿå£ï¼Œå®Œæˆåˆ«äººéƒ½èƒ½å®Œæˆçš„äº‹ã€‚è€Œæ›´å¼ºçš„äººå¯ä»¥åšåˆ°ï¼šå®Œæˆåˆ«äººå®Œä¸æˆçš„äº‹ã€‚åŒæ ·çš„ä¸€ä»¶äº‹ï¼Œäº¤ç»™ä¸åŒçš„å‘˜å·¥ï¼Œä¼šæœ‰ä¸åŒçš„ç»“æœï¼Œå®Œä¸æˆçš„äººéƒ½ä¼šæœ‰å„ç§ç†ç”±æ¥è¯´æœè‡ªå·±è¯´æœé¢†å¯¼ï¼Œå°†ä¸€ä¸ªå°å›°éš¾ç”±ç‚¹åˆ°é¢æ‰©å¤§åŒ–çœ‹å¾…ã€‚åšä¸€ä¸ªNBçš„äººï¼Œä»æ­¤åˆ»å¼€å§‹ï¼Œä¸å†æ‰¾å€Ÿå£ã€‚</p>
<p>100.å‘æˆåŠŸæ‰¾æ–¹æ³•å’Œä¸ºå¤±è´¥æ‰¾ç†ç”±ï¼Œä¹Ÿæ˜¯äººçš„ä¸€ä¸ªæ–¹é¢çš„ä¸¤ç§ä¹ æƒ¯å’Œç´ è´¨ã€‚</p>
<p>101.ä»Šå¤©å’ŒåŒäº‹è®¨è®ºæ•ˆç‡ï¼Œè¯´åˆ°è¡¨è¾¾æ¨¡ç³Šå½±å“æ•ˆç‡å’Œæ²Ÿé€šçš„é—®é¢˜ã€‚å¾ˆæœ‰åŒæ„Ÿï¼Œæˆ‘ä¸€ç›´å°±è§‰å¾—ç±»ä¼¼ä»¥ä¸‹å«ç³Šè¯´æ³•åœ¨å·¥ä½œä¸­åº”é¿å…ï¼šâ€œåº”è¯¥å·®ä¸å¤šå§ï¼Œè¿‡ä¸¤ä¸‰å¤©å¤§æ¦‚å°±å¯ä»¥äº†ï¼Œä¼°è®¡å†è¦ä¸€ç‚¹æ—¶é—´å°±æ¥è¿‘å¥½äº†ï¼Œè¿™ä¸ªä¸œè¥¿ä¹Ÿè¿˜è¡Œå§ï¼Œæœ€å¥½èƒ½ xxxxå§ï¼Œå·®ä¸å¤šä¹Ÿéƒ½è¡Œï¼Œæˆ‘è¿‡ä¸€æ®µå¼„ä¸€ä¸‹ï¼Œè¿™æ ·ä¹Ÿè¿˜æ˜¯å¯ä»¥çš„â€ã€‚</p>
<p>102.æœ€è¿‘ä¸‰ä¸ªæœˆèº«ä½“é”»ç‚¼çš„è¿›å±•ï¼šè…°èƒŒå°‘ä¸¥é‡ç–¼äº†ï¼Œä¸€æ¬¡è·‘äº”å…¬é‡Œï¼Œä¸€æ¬¡æ¸¸ä¸€å…¬é‡Œéƒ½å¾ˆè½»æ¾äº†ã€‚è¿‘æœŸç›®æ ‡ï¼Œè‡ªç”±æ³³å­¦ä¹ ä¸­ï¼Œå¥èº«å­¦ä¹ ä¸­ï¼Œç¾½æ¯›çƒæé«˜ã€‚</p>
<p>103.ä¸€ä¸ªäººåœ¨ä»–çš„ä¿¡ä»°ä¸Šç«™å¾—è¶Šä¸ç‰¢å›ºï¼Œä»–å°±è¶Šè¦ç”¨åŒè‡‚ç´§ç´§æŠ±ä½é‚£äº›ä½¿ä¹‹åŒºåˆ†äºå…¶ä»–ä¿¡ä»°çš„æ•™æ¡ä¸æ”¾ï¼›ç›¸åï¼Œä¸€ä¸ªäººåœ¨ä»–çš„ä¿¡å¿µä¸Šç«™å¾—è¶Šç‰¢å›ºï¼Œä»–å°±è¶Šå¯ä»¥è‡ªç”±åœ°æŠŠåŒæ‰‹ä¼¸å‘é‚£äº›ä¸ä»–ä¿¡ä»°ä¸åŒçš„äººã€‚â€”â€”å¼—å…°å…‹ã€‚æ—©å®‰ï¼Œå„ä½ã€‚</p>
<p>104.è¯´åˆ°è‡ªæˆ‘ä¿®ç‚¼ï¼Œç”±äºæ‡’æƒ°(ä½“åŠ›çš„ã€æ€è€ƒçš„ã€æƒ…ç»ªçš„)æ˜¯ä¸‡æ¶ä¹‹æºï¼Œæ‰€ä»¥ä¿®ç‚¼å¾ˆå¤šæ—¶å€™å°±æ˜¯åœ¨å…‹æœæƒ°æ€§ã€‚</p>
<p>105.ä¸æ–­ç»™è‡ªå·±å°çš„æ‰¿è¯ºå¹¶åŠªåŠ›è¾¾åˆ°ã€‚Be Proactive ï¼ˆå˜å¾—ç§¯æï¼‰çš„ä¿®ç‚¼æ–¹æ³•ä¹‹ä¸€ã€‚</p>
<p>106.å–œæ¬¢æœ€è¿‘åœ°é“é‡Œçš„ä¸€å¥å¹¿å‘Šè¯ï¼šwe trust learningï¼ˆæˆ‘ä»¬è¦ç›¸ä¿¡å­¦ä¹ ï¼‰ã€‚</p>
<p>107.å¹³åº¸æœ‰é‡åŠ›ï¼Œéœ€è¦é€ƒé€¸é€Ÿåº¦ã€‚</p>
<p>108.ä¸æ€•çŠ¯é”™è¯¯ï¼Œä¸æ€•åæ–¹æ³•ï¼Œç”šè‡³ä¸æ€•åä¹ æƒ¯ã€‚åªè¦ä½ ä¼šä¼šè‡ªæˆ‘æ”¹æ­£ã€‚ä½ ä¹ æƒ¯æ”¹æ­£å—ï¼Ÿ</p>
<p>109.å•èº«çš„äººæ˜¯æœ‰ä¸€äº›å¥½å¤„çš„ï¼Œæ¯”å¦‚æ›´å¤šè‡ªç”±ç‹¬ç«‹æ€è€ƒçš„ç¯å¢ƒå’Œæ—¶é—´ï¼Œå­¤ç‹¬å¾€å¾€ä½¿äººæ›´åŠ æ·±é‚ƒå’Œå¹¿é˜”ï¼Œéå•èº«çš„äººæƒ³æƒ³å¦‚ä½•é¿å…éå•èº«çš„ç¼ºç‚¹ã€‚</p>
<p>110.å¿«åˆ°30å²äº†ï¼Œæ„Ÿè§‰è¿™å‡ å¹´åˆå†é‡æ–°å­¦ä¹ &#x2F;è¡¥ä¹ æœ¬åº”åœ¨é’å°‘å¹´æ—¶é—´å­¦ä¹ çš„ä¸œè¥¿ï¼šå¦‚ä½•é˜…è¯»ã€å¦‚ä½•äº†è§£è‡ªå·±ã€å¦‚ä½•ä¸äººæ²Ÿé€šã€å¦‚ä½•å®‰æ’æ—¶é—´ã€å¦‚ä½•æ­£ç¡®çš„çœ‹å¾…åˆ«äººæ„è§ã€å¦‚ä½•æ¿€åŠ±è‡ªå·±ã€å¦‚ä½•å†™ä½œã€å¦‚ä½•åšæŒé”»ç‚¼èº«ä½“ã€å¦‚ä½•è€å¿ƒã€‚</p>
<p>111.ä»Šå¤©è§äº†ä¸€ä¸ª5å¹´æœªè§çš„åŒå­¦å’ŒåŠå¹´æœªè§çš„åŒå­¦ã€‚æœŸé—´æœ‰ä½åŒå­¦è¯´å·¥ä½œç”Ÿæ´»æœ€è¿‘å¾ˆæ²¡æ„æ€ã€‚å…¶å®5å¹´å˜åŒ–å·²ç»å¾ˆå¤§ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿˜ä¸å¤Ÿå¤§ï¼Œç”Ÿæ´»çš„æ„æ€å®Œå…¨å¯ä»¥è‡ªå·±æ‰¾ï¼Œè‡ªå·±æ”¹å˜äººç”Ÿæ„æ€å°±å¾ˆå¤§ã€‚ä¸è¦ç­‰æ„æ€æ¥æ‰¾ä½ ã€‚å€Ÿç”¨å¥¥å·´é©¬çš„è¯è¯´ changeï¼Œyes we can.</p>
<p>112.æœªé›¨ç»¸ç¼ªå…¶å®å¾ˆéš¾çš„ï¼Œå¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯äº‹æƒ…æ¨äººèµ°ï¼Œè€Œä¸”å¾€å¾€èƒ½å®¹æ˜“è¢«æ¨åŠ¨çš„äººå·²ç»ä¸é”™äº†ã€‚</p>
<p>113.äº’è”ç½‘è®©ä¼šå­¦ä¹ çˆ±å­¦ä¹ çš„äººå’Œç›¸åçš„å·®è·æ‹‰çš„æ›´å¤§ï¼Œè¿™å¹¶ä¸ä»…é™äºäº’è”ç½‘è¡Œä¸šã€‚åªä¸è¿‡äº’è”ç½‘è¡Œä¸šè¿™ç§è¶‹åŠ¿å…ˆå¼€å§‹è€Œå·²ã€‚ç°åœ¨å¥½å¤šåˆä¸­ç”Ÿã€é«˜ä¸­ç”Ÿæ¯”å¤§å­¦ç”Ÿã€åšå£«ç”Ÿè¿˜åšå­¦ã€‚æˆ‘è§è¿‡2ä¸ªä¸­å­¦ç”Ÿï¼Œè‡ªå·±ç”¨wikiæ•´ç†æ‰€å­¦è¿‡çš„ã€è‡ªå­¦çš„å„ç§çŸ¥è¯†ã€‚æˆ‘æ€ä¹ˆç”Ÿçš„è¿™ä¹ˆæ—©â€¦</p>
<p>114.å»¶è¿Ÿæ»¡è¶³æ„Ÿå’Œåšå†³å‘Šåˆ«æƒ°æ€§ï¼Œæ˜¯â€œä¼˜ç§€â€çš„æœ€é‡è¦ä¸¤å—åŸºçŸ³ã€‚</p>
<p>115.å½“æŸäººå¼€å§‹æ·±å…¥è®¤è¯†è‡ªå·±ã€ç ”ç©¶è‡ªå·±çš„æ—¶å€™ï¼Œè¯´æ˜æ­¤äººå¼€å§‹æœ‰äº†å“²å­¦çš„æ€è€ƒï¼Œé¢„ç¤ºç€æ­¤äººå¼€å§‹è¿ˆå…¥ä¸€ä¸ªæ–°çš„äººç”Ÿé˜¶æ®µã€‚</p>
<p>116.éå¸¸åŒæ„è‡ªæ§åŠ›ï¼ˆä¹Ÿå°±æ˜¯åæƒ°æ€§ï¼‰æ˜¯ä¼˜ç§€çš„æ ‡å‡†ã€‚ç¡®å®é©¬æ‹‰æ¾ä¸æ˜¯é«˜æ ‡å‡†ï¼Œæ€ç»´æ„è¯†æƒ…ç»ªçš„è‡ªæ§æ›´éš¾ã€‚</p>
<p>117.ç‰›é€¼çš„äººæ‰¾æ–¹æ³•ï¼Œå‚»é€¼çš„äººæ‰¾å€Ÿå£ã€‚</p>
<p>118.æ˜¨å¤©å…¬å¸å†…éƒ¨åšæ—¶é—´ç®¡ç†çš„äº¤æµï¼Œæ˜¯æˆ‘æ¨åŠ¨å¤§å®¶çš„ã€‚ä¸è¿‡è¯´å®è¯æƒ­æ„§ï¼Œæœ€è¿‘2-3å‘¨æˆ‘è‡ªå·±çš„æ—¶é—´ç®¡ç†çš„ç›®æ ‡ä¸‹é™äº†ã€‚æƒ°æ€§æ˜¯ä¸‡æ¶ä¹‹æºã€‚ä»ä»Šå¤©å¼€å§‹åˆæœ‰æ„è¯†åœ°åŠ å¼ºäº†ã€‚</p>
<p>119.åªæœ‰å½“ä½ ç¦»å¼€è‡ªå·±çš„èˆ’é€‚åŒºæ—¶ï¼Œä½ æ‰ä¼šæŒ‘æˆ˜è‡ªå·±çš„æé™ã€‚</p>
<p>120.â€œç§¯æä¸»åŠ¨â€æ˜¯å¹¿æ³›ä¼˜ç§€çš„ç´ è´¨çš„åŸºç¡€ã€‚</p>
<p>121.çœ‹å¹´è½»äººçš„æ½œåŠ›ï¼Œçœ‹ä»–å‘¨æœ«å‡ ç‚¹èµ·ï¼Œå‘¨æœ«åœ¨å¹²å˜›ï¼Œä¸‹ç­åœ¨å¹²å˜›ã€‚ç”šè‡³ä¸ä¸€å®šè¦å¹²å˜›ï¼Œåªè¦çœ‹æƒ³äº›ä»€ä¹ˆã€‚</p>
<p>122.é«˜ä¸­åˆšå¼€å§‹å­¦ç‰©ç†çš„æ—¶å€™ï¼Œè€å¸ˆåå¤å¼ºè°ƒä¸è¦æƒ³å½“ç„¶ã€å‡­æ„Ÿè§‰ï¼Œåº”è¯¥è¦æ¨ç†ã€‚å…¶å®çº¿æ€§æ€ç»´æ˜¯å¸¸è§çš„ä¸€ç§æƒ³å½“ç„¶ï¼Œä¹Ÿè®¸è®¸å¤šäº‹ç‰©çš„å¸¸æ€æ˜¯ç±»çº¿æ€§çš„ï¼Œä½†æ˜¯å¸¸æ€æˆ–è€…æ™®é€šäº‹ç‰©å¾€å¾€ä¸æ˜¯å…³é”®ï¼Œéœ€è¦é¢å¯¹çš„æƒ…å†µå¾€å¾€æ˜¯éå¸¸æ€ï¼Œæ‰€ä»¥è¦æ³¨æ„é¿å…çº¿æ€§åœ°â€æƒ³å½“ç„¶ã€‚</p>
<p>123.ä½è½çš„çŠ¶æ€æ—¶æƒ…å†µå¾€å¾€æ²¡æœ‰æ„Ÿå—çš„éš¾ï¼Œæ¾æ‡ˆçš„æ—¶å€™å…¶å®ä¸å¦‚æƒ³è±¡çš„å®¹æ˜“ï¼Œäººå¾€å¾€éš¾ç†æ€§ã€‚</p>
<p>124.é¿å…çš„å¸¸ç”¨å«ç³Šè¯ï¼šâ€œéš¾å…ä¼šâ€ï¼Œâ€œå·®ä¸å¤šéƒ½è¿™æ ·â€ã€‚</p>
<p>125.å¯¹å¾ˆå¤šäº‹æƒ…æˆ‘æŒºæœ‰è‡ªå·±è§‚ç‚¹å’Œæƒ³æ³•ï¼Œç›®å‰ä¸èƒ½è§£å†³é—®é¢˜ï¼Œæ²¡æœ‰æ•ˆæœï¼Œæ‰€ä»¥ä¸åº”è¯¥å»å±•å¼€å’Œè¯„è®ºï¼Œè¦æƒ³æƒ³ç°åœ¨èƒ½æœ‰æ•ˆæœå’Œä»·å€¼çš„äº‹æƒ…ã€‚æˆ‘ç”šè‡³æ—¶å¸¸è¦æé†’è‡ªå·±ï¼šä½ è¿™æ ·æƒ³æ˜¯æ²¡æœ‰é”™çš„ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œèµ¶ç´§åšè®¸å¤šåˆå¾ˆæœ‰ç”¨åˆæ²¡æœ‰é”™çš„äº‹æƒ…ã€‚</p>
<p>126.æœ€è¿‘æ„Ÿè§‰å¿™ç¢Œå¤šï¼Œæ€è€ƒå­¦ä¹ åçœåˆå°‘äº†ï¼Œè§‚å¯Ÿé—®é¢˜ä¹Ÿä¸å¤Ÿæ·±å…¥å’Œè€å¿ƒï¼Œåœ¨ speed upï¼ˆåŠ é€Ÿï¼‰å’Œæ¿€åŠ¨å¹²åŠ²è¶³çš„æ—¶å€™ï¼Œä¿æŒä¸€ä»½ slow downï¼ˆæ…¢ä¸‹æ¥ï¼‰çš„å¿ƒæ€å¾ˆé‡è¦ã€‚</p>
<p>127.å¯¹ç°å®éšå¿ï¼Œå¯¹æœªæ¥æœ‰æœŸå¾…ï¼Œåœ¨å½“ä¸‹æœ‰ä½œä¸ºã€‚</p>
<p>128.å†…å‘ä½†ç²¾åŠ›å……æ²›æœ‰ä¼å›¾å¿ƒçš„äººã€‚æ€§æ ¼å†…å‘çš„äººæ›´æ˜“æˆåŠŸï¼šç¾å›½MSNBCç½‘ç«™æŠ¥é“ç§°ï¼Œä¸€é¡¹ç ”ç©¶å‘ç°ï¼Œå†…å‘å®³ç¾å¤§å¤šä¸ç”Ÿä¿±æ¥ï¼Œè€Œä¸”ï¼Œå†…å‘çš„äººåœ¨å·¥ä½œä¸­æ›´å®¹æ˜“æˆåŠŸã€‚åœ¨åšå†³ç­–æ—¶ï¼Œä»–ä»¬æ„¿æ„èŠ±å¤§é‡æ—¶é—´æ€è€ƒï¼Œä¸å–œæ¬¢é—²æ‰¯å…¶ä»–çš„è¯é¢˜ï¼Œæ›´èƒ½ä¸“å¿ƒè‡´å¿—åœ°å¥”ç€ä¸€ä¸ªç›®æ ‡åŠªåŠ›ï¼Œå› æ­¤ä»–ä»¬æˆåŠŸçš„å‡ ç‡ä¹Ÿç›¸åº”å¢å¤§ã€‚</p>
<p>129.å¾ˆå¤šå¤æ‚é—®é¢˜æ˜¯æ›´é«˜ç»´åº¦ç®€å•é—®é¢˜çš„æŠ•å½±ï¼Œæ¯”å¦‚è¯´æ‰“ç¯®çƒåŠ¨ä½œå˜å½¢ã€é€Ÿåº¦æ…¢ã€é…åˆå·®æ˜¯å¾ˆå¤šæ—¶å€™ä½“åŠ›ä¸è¡Œï¼›å†™ç¨‹åºçƒ‚ã€bugå¤šã€æ—¶é—´é•¿æ˜¯æŠ½è±¡åˆ†è§£é—®é¢˜åšçš„ä¸å¥½ï¼›è¿˜æœ‰æ¯”å¦‚æµ·å†›è¯´çš„â€œå¾ˆå¤šç®¡ç†é—®é¢˜éƒ½æ˜¯å‡è±¡ï¼Œæœ¬è´¨æ˜¯èƒ½åŠ›é—®é¢˜â€ã€‚è€Œè§£å†³è¿™äº›æœ¬è´¨é—®é¢˜ï¼Œéœ€è¦æ›´å¤§ä»£ä»·å’Œå†³å¿ƒçš„ã€‚</p>
<p>130.ä»Šå¤©æ—©ç‚¹ç¡ï¼Œæ˜å¤©æ—©ä¸Šèµ·æ¥çœ‹ä¹¦ã€‚æœ¬å‘¨çš„å­¦ä¹ è®¡åˆ’å¿«å®Œä¸æˆäº†ã€‚åˆ›ä¸šè¿‡ç¨‹ä¸­ä¸æ–­çš„å­¦ä¹ åˆèƒ½å°è¯•æ˜¯æ„Ÿè§‰å¾ˆå¥½çš„ä½“éªŒã€‚</p>
<p>131.äººæ¬²æœ›å¤ªå¼ºçš„æ—¶å€™å°±å®¹æ˜“çŸ­è§†ï¼Œå¤ªè‡ªæˆ‘ä¸­å¿ƒçš„æ—¶å€™å°±å®¹æ˜“ç›²ç›®ã€‚</p>
<p>132.ä»¥å‰ä¸€ç›´éƒ½æ²¡è§‰å¾—æ‰¾äººè‡ªä¿¡å¾ˆé‡è¦ï¼Œç°åœ¨å‘ç°è¶Šæ¥è¶Šé‡è¦ã€‚æƒ°æ€§ã€ä¾èµ–ã€æ‹–æ‹‰ã€ä¿å®ˆå¾ˆå¤šä¹Ÿéƒ½æ˜¯ä¸è‡ªä¿¡å¯¼è‡´çš„ã€‚è‡ªä¿¡çš„äººï¼Œè‡ªç„¶ä¼šå’Œè‡ªæˆ‘é«˜è¦æ±‚è”ç³»èµ·æ¥ã€‚</p>
<p>133.å¸¸è¯´æœºä¼šæ€»æ˜¯é’çæœ‰å‡†å¤‡çš„äººï¼Œå…¶å®æ›´å¤šæ—¶å€™æ˜¯æœºä¼šå·²ç»æ¥äº†åªæ˜¯è¿˜æ²¡å‡¸æ˜¾ï¼Œå¾€å¾€è‡ªå·±æ²¡çæƒœã€‚</p>
<p>134.ä¸æŠ¬æ ï¼Œè¦æŠ“ä½ä¸»è¦é—®é¢˜ï¼Œä»»ä½•åŠæ³•éƒ½æ˜¯åœ¨ä¸€å®šæ—¶ç©ºä¸‹å¯¹çœŸç†çš„è¿‘ä¼¼å®ç°ï¼Œæ—¶ç©ºæ¡ä»¶è¶Šå…·ä½“ï¼ŒåŠæ³•æ³•å°±è¶Šæœ‰æ•ˆã€‚å¦‚æœå»æŠ¬æ â€œè¿‘ä¼¼â€ï¼Œé‚£ä¹ˆå°±æ›´éš¾åœ¨è¿™ä¸ªæ—¶ç©ºæ¡ä»¶ä¸‹å®æ–½ã€‚</p>
<p>135.å¾ˆå¤šäº‹æƒ…éƒ½æ˜¯è¿™æ ·æ—¢æ²¡æœ‰ä½ è®¾æƒ³çš„å®¹æ˜“ï¼Œä¹Ÿæ²¡æœ‰ä½ æƒ³è±¡çš„éš¾ã€‚ç¡è§‰ï½ï½</p>
<p>136.æ‰€è°“é—¨æ§›ï¼Œè¿‡å»äº†æ˜¯é—¨ï¼Œè¿‡ä¸å»åˆ™æ˜¯æ§›ã€‚äººç”Ÿçš„æ‚²å“€å¾€å¾€æ˜¯ï¼Œä½ æƒ³ä¸¤è‚‹æ’åˆ€ï¼Œåˆ€å´åªæœ‰ä¸€æŠŠã€‚æ€€æ—§ï¼Œä¸æ˜¯é‚£ä¸ªæ—¶ä»£æœ‰å¤šå¥½ï¼Œè€Œæ˜¯é‚£æ—¶ä½ å¹´è½»ã€‚è§‰å¾—ä¸å¿«ä¹ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¿½æ±‚çš„ä¸æ˜¯â€œå¹¸ç¦â€ï¼Œè€Œæ˜¯â€œæ¯”åˆ«äººå¹¸ç¦â€ã€‚ä¸¤äººçš„æ„Ÿæƒ…å°±åƒç»‡æ¯›è¡£ï¼Œå»ºç«‹æ—¶ä¸€é’ˆä¸€çº¿ï¼Œæ‹†é™¤æ—¶åªéœ€è½»è½»ä¸€æ‹‰ã€‚</p>
<p>137.æˆç†Ÿæ„Ÿæ‚Ÿï¼šæˆç†Ÿå°±æ˜¯ä»inside-outï¼ˆç”±å†…å‘å¤–ï¼‰æ›´å¤šçš„å˜æˆoutside-inï¼ˆç”±å¤–å‘å†…ï¼‰ï¼Œå°±æ˜¯åœ¨éœ€è¦æ—¶å¸¸èƒ½å˜æˆå¿è€…ç¥é¾Ÿï¼Œåœ¨å¦ä¸€äº›æ—¶å€™åˆèƒ½å˜æˆåŠ¨æ„Ÿè¶…äººã€‚</p>
<p>138.æ˜¨å¤©çˆ¶äº²èŠ‚ï¼Œå’Œçˆ¸å¦ˆè§†é¢‘èŠå¤©ï¼Œä»–ä»¬åœ¨å¹¿ä¸œç»å•†ï¼Œè¿™å‡ å¹´ç«äº‰å‹åŠ›å†…éƒ¨æ„è§çº çº·ä¸å°ï¼Œæœ‰æ—¶æƒ³å»ºè®®ä»–ä»¬åˆ«ç»è¥äº†ï¼Œé€€ä¼‘å…»è€ï¼Œä½†åŠå…¬å¸å¾€å¾€æ¬²é€€ä¸èƒ½ã€‚æ˜¨å¤©çˆ¸çˆ¸è¯´è¿˜æƒ³æŠ•å…¥æ›´å¤šä¸€æï¼Œæˆ‘æƒ³æ—¢ç„¶åŠé€€ä¸è¡Œä¸å¦‚é¼“åŠ±ä»–æ”¾æ‰‹ä¸€æï¼Œä¿¡ä»»å°±æ˜¯é¼“åŠ±ã€‚æˆ‘ä¸èƒ½å›å»å¸®å¿™å°±è¦æŠŠè‡ªå·±çš„äº‹æƒ…åšå¥½ï¼Œè®©ä»–ä¸è¦æœ‰æ‹…å¿ƒã€‚</p>
<p>139.å…³äºå‹¤å¥‹ï¼Œå°±æˆ‘æ‰€çŸ¥ï¼Œç½•æœ‰æˆåŠŸè€…ä¸æ˜¯å·¥ä½œæ—¶é—´æé•¿çš„ï¼šé€šç”¨ç”µæ°”çš„CEO æ¯å‘¨å·¥ä½œä¸€ç™¾å°æ—¶ï¼ŒåšæŒäº†è‡³å°‘åå¹´ã€‚å·´è²ç‰¹ä¸ºäº†æœ€æ—©çœ‹åˆ°æ¬¡æ—¥çš„åå°”è¡—æ—¥æŠ¥ï¼Œç»å¸¸åœ¨å‡Œæ™¨å››ç‚¹å»å–æŠ¥çº¸ã€‚å‹¤å¥‹ä¸æ˜¯ä¸€ç§å½¢å¼ï¼Œè€Œæ˜¯ä¸€ç§å¿ƒç†çŠ¶æ€ï¼šäº«å—æŒ‘æˆ˜æé™çš„è¿‡ç¨‹ï¼Œä¿æŒçƒ­æƒ…å’Œå¥½å¥‡å¿ƒï¼ŒåšæŒä¸å±‘ã€‚</p>
<p>140.å“ˆä½›æœ‰ä¸€ä¸ªè‘—åçš„ç†è®ºï¼šäººçš„å·®åˆ«åœ¨äºä¸šä½™æ—¶é—´ï¼Œè€Œä¸€ä¸ªäººçš„å‘½è¿å†³å®šäºæ™šä¸Š8ç‚¹åˆ°10ç‚¹ä¹‹é—´ã€‚æ¯æ™šæŠ½å‡º2ä¸ªå°æ—¶çš„æ—¶é—´ç”¨æ¥é˜…è¯»ã€è¿›ä¿®ã€æ€è€ƒæˆ–å‚åŠ æœ‰æ„çš„æ¼”è®²ã€è®¨è®ºï¼Œä½ ä¼šå‘ç°ï¼Œä½ çš„äººç”Ÿæ­£åœ¨å‘ç”Ÿæ”¹å˜ï¼ŒåšæŒæ•°å¹´ä¹‹åï¼ŒæˆåŠŸä¼šå‘ä½ æ‹›æ‰‹ã€‚</p>
<p>141.ä»Šå¤©å…¬å¸è¿›è¡Œè¯»ä¹¦äº¤æµä¼šï¼Œå…¶ä¸­æåˆ°ã€Šåˆ«åšæ­£å¸¸çš„å‚»ç“œã€‹ä¸€ä¹¦ï¼Œå¤§å®¶å¯¹æ˜¯å¦ç†æ€§çš„æ€åº¦æœ‰åˆ†æ­§ã€‚</p>
<p>142.äººç”Ÿå§ï¼Œ0å²å‡ºåœºï¼Œ10å²å¿«ä¹æˆé•¿ï¼›20ä¸ºæƒ…å½·å¾¨ï¼›30åŸºæœ¬å®šå‘ï¼›40æ‹¼å‘½æ‰“é—¯ï¼›50å›å¤´æœ›æœ›ï¼›60å‘Šè€è¿˜ä¹¡ï¼›70æ“æ“éº»å°†ï¼›80æ™’æ™’å¤ªé˜³ï¼›90èººåœ¨åºŠä¸Šï¼›100 æŒ‚åœ¨å¢™ä¸Šã€‚</p>
<p>143.äººç”Ÿçš„æœ¬è´¨æ˜¯è¿½å¯»è‡ªæˆ‘çš„æå‡ã€‚åŒ…æ‹¬æ€æƒ³ã€èƒ½åŠ›ã€æ„å¿—ç­‰ç­‰ã€‚è¿™äº›å‘å±•å¥½äº†ï¼Œä¸€åˆ‡éšä¹‹è€Œæ¥ã€‚ååå¤§å¤šæ•°äººè¿½æ±‚çš„æ˜¯çŸ­æœŸçš„å…¬å¸ã€èŒä½ã€è–ªæ°´ï¼Œè¿æ°”å¥½çš„èƒ½æœ‰æ‰€å‘å±•ï¼Œè¿æ°”å·®çš„ä¼šè¿·å¤±æ–¹å‘æµäºå¹³åº¸ã€‚</p>
<p>144.å‘¨æœ«å‚åŠ ä¸€ä¸ªæœ‹å‹å©šç¤¼ï¼Œå‘ç°æ–°éƒæœ€è¿‘å»äº†ä¸­å¤®æŸç›‘ç®¡ç»“æ„çš„ä¿¡æ¯å¤„ï¼Œåšå£«æ–°å¨˜å›åˆ°æ–°éƒæ•…ä¹¡æ‹…å¹²éƒ¨ã€‚ä»–ä»¬å·²ç»ä¸¤åœ°åˆ†å±…5å¹´äº†ï¼Œä¸ºäº†çæƒœæœºä¼šè¿˜è¦ç»§ç»­åˆ†å¼€ã€‚è¿™æ ·æˆ‘æ˜¯åšä¸åˆ°çš„ï¼Œä¹Ÿä¸èµåŒï¼Œäººç”Ÿåœ¨ä¸–å°±åº”è¯¥å°½å¯èƒ½å®ç°ä»·å€¼ä½“éªŒç”Ÿæ´»ï¼Œä¸ºäº†é™æ€çš„æ”¶ç›Šè€Œå»â€œå¿â€æŸå¤±ç”Ÿæ´»ï¼ŒæŸå¤±å¾ˆå¤§ï¼Œä¸æ˜¯åˆ›é€ çš„äººç”Ÿã€‚</p>
<p>145.ä¸æ»¡è¶³ä¹‹åæœ‰å‡ ç§ååº”ã€‚ç¬¬ä¸€ï¼ŒåŠªåŠ›æé«˜è‡ªå·±ï¼›ç¬¬äºŒï¼Œå°è¯•å®‰æ…°è‡ªå·±ï¼›ç¬¬ä¸‰ï¼ŒæŠ±æ€¨ç‰¢éªšè®°åœ¨å…¶å®ƒäººäº‹èº«ä¸Šã€‚</p>
<p>146.å¼ºçƒˆçš„åŠ¨æœºæ¯”æ–¹æ³•æ›´æ ¹æœ¬ã€‚</p>
<p>147.ä¸çˆ±è¡¨è¾¾è§‚ç‚¹çš„äººï¼Œæ€»æ˜¯å®¹æ˜“è¢«äººè®¤ä¸ºæ²¡æƒ³æ³•ä¸èªæ˜ï¼Œè€Œéƒ¨åˆ†å¼ºåŠ¿ä¹‹äººæ›´çˆ±å‘è¡¨æ„è§ï¼Œæ‰€ä»¥çœ‹å…¶ä»–äººå¤§å¤šä¸å¦‚è‡ªå·±èªæ˜ï¼Œå…¶ä»¥æ€»çˆ±å‘è¡¨å…³äºä»–äººæ˜¯å¦èªæ˜çš„æ„è§ä¹‹äººä¸ºç”šã€‚</p>
<p>148.èªæ˜åˆè€å¿ƒæ˜¯æœ‰ä¸€äº›çŸ›ç›¾çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶å…·å¤‡ä¸¤ç‚¹çš„äººå´éå¸¸ä¼˜ç§€ã€‚</p>
<p>149.ä¸€ç‚¹ä¸è¦å«ç³Šï¼Œå«ç³Šä»£è¡¨ç€ä¾¥å¹¸ã€ä»£è¡¨ç€è‡ªæˆ‘æ¬ºéª—ã€ä»£è¡¨ç€è‡ªæˆ‘æ„Ÿè§‰é£˜ç„¶ã€‚</p>
<p>150.ä¸€æ¬¡åˆ«ä»¥çœ‹ä¸€æœ¬ä¸ºç›®æ ‡ï¼Œæ¯”å¦‚çœ‹5é¡µä¸ºç›®æ ‡ï¼Œå…³äºè‡ªå·±æ— æ³•è€å¿ƒçœ‹ä¹¦çš„é—®é¢˜ï¼šå¦‚æœè¯´å“ªé‡Œæ¥äº†ä¸€ä¸ªé«˜äººæ¯æ¬¡éƒ½ä¼šå¬å¾—å¾ˆä»”ç»†ï¼Œå¬å®Œä»¥åè§‰å¾—å¾ˆæœ‰æ”¶è·ï¼›è€Œçœ‹ä¹¦åˆ™æ˜¯å®Œå…¨ä¸åŒçš„å¿ƒæƒ…äº†ã€‚ç”µè„‘é‡Œçš„ç»å…¸ä¹¦ç±å †ç¿»å¤©äº†ï¼Œå´ä»æ¥æ²¡æœ‰ä»”ç»†ç¿»è¿‡ï¼ŒçœŸæ˜¯ä¹¦éå€Ÿä¸èƒ½è¯»å•Šã€‚çœŸæ˜¯åº”è¯¥ç»™è‡ªå·±ä¸€ä¸ªè§„åˆ’ï¼Œç”¨çœ‹å¾…çº¦ä¼šå’Œè®²åº§çš„å¿ƒæƒ…æ¥çœ‹å¾…æ¯ä¸€æ¬¡é˜…è¯»ã€‚</p>
<p>151.ä¸çŸ¥é“å…¶å®ƒäººçœ‹ã€Šæ´»æ³•ã€‹ä¸€ä¹¦æ˜¯æ€ä¹ˆæ ·ä¸€ä¸ªçœŸå®æ„Ÿå—ï¼Œæˆ‘æœ‰æ—¶è§‰å¾—ä¹¦ä¸­çš„è¦æ±‚å¤ªé«˜ä»¥è‡´ä¸æƒ³å»æƒ³ã€‚</p>
<p>152.â€œå¾ˆå¥‡æ€ªâ€â€œå¾ˆè¯¡å¼‚â€â€œå¤ªå¥‡æ€ªâ€ï¼Œæœ‰è¿™äº›æƒ³æ³•è¯´æ˜è‡ªå·±è¿˜ä¸æ‡‚ï¼Œè€Œä¸”å¸¸å¸¸è¿˜æƒ³æŠŠåŸå› å½’å’äºâ€œå¥‡æ€ªâ€ä»¥releaseï¼ˆå…è´£ï¼‰ã€‚æ²¡æœ‰ä»€ä¹ˆå¤ªå¥‡æ€ªçš„ä¸œè¥¿ï¼Œä»”ç»†å»æ‰¾å­¦ä¹ çš„é€”å¾„ï¼Œä½ å¸¸å¸¸èƒ½æ‰¾åˆ°ã€‚</p>
<p>153.æœ€è¿‘é‡è¯»åˆ°ç¨»ç››å’Œå¤«çš„ã€Šæ´»æ³•ã€‹ï¼Œå…¶ä¸­æåˆ°ä¸“æ³¨æŠ•å…¥ï¼Œå…¶ä¸­ä¸¾çš„é™¶ç“·å·¥è‰ºæ”¹è¿›çš„ä¾‹å­å°¤å…¶å¦æˆ‘å°è±¡æ·±åˆ»ã€‚æˆ‘ä»¬åšæ¯ä¸€ä»¶äº‹ï¼ˆå†™ä¸€æ®µç¨‹åºï¼Œå†™ä¸€å°é‚®ä»¶ï¼Œå†™ä¸€ä¸ªç­–åˆ’ï¼‰çš„æ—¶å€™æ˜¯å¦åœ¨æƒ³è‡ªå·±æ˜¯å¦æŠ•å…¥å…¨åŠ›ä»¥èµ´çš„è®¤çœŸåšäº†ï¼Œç»“æœçœŸçš„ä¸ä¸€æ ·ï¼Ÿè¯·è¯•è¯•ï¼šä½ èƒ½æœ‰å¤šä¸“æ³¨ï¼Ÿ</p>
<p>154.æˆ‘ç»™è‡ªå·±è´´äº†åˆ›ä¸šã€æŠ€æœ¯ã€ç®¡ç†ã€åˆ›æ–°ã€è‡ªçœæ ‡ç­¾ã€‚</p>
<p>155.æ‰§è¡ŒåŠ›è¿™ä¸ªè¯ä¸€åº¦å¾ˆæµè¡Œï¼Œåœ¨æˆ‘ç†è§£æ¥çœ‹å°±æ˜¯æ€åº¦å’Œèƒ½åŠ›ã€‚ä¸æ–­ç­›é€‰å’Œæé«˜å¤§å®¶çš„æ€åº¦ã€èƒ½åŠ›å°±æ˜¯æé«˜æ‰§è¡ŒåŠ›ã€‚</p>
<p>156.ä¹ æƒ¯ï¼šæŠŠè¦åšçš„äº‹æƒ…è¿…é€Ÿåˆ†é…åœ¨calendarï¼ˆæ—¥å†ï¼‰ä¸Šï¼Œä¼šå˜åŒ–æ²¡å…³ç³»ï¼Œå¤šè°ƒæ•´ã€‚</p>
<p>157.ä½ æ˜¯åœ¨æ¾æ‡ˆçŠ¶æ€è¿˜æ˜¯åœ¨æŒ‘æˆ˜çŠ¶æ€ï¼Ÿï¼ˆè¿™æ˜¯ç¬¬ä¸€æ¡å¾®åšï¼‰</p>
<h1 id="äºŒã€å…³äºç®¡ç†"><a href="#äºŒã€å…³äºç®¡ç†" class="headerlink" title="äºŒã€å…³äºç®¡ç†"></a>äºŒã€å…³äºç®¡ç†</h1><p>1.ä¸‰é¡¾èŒ…åºå·²ç»ä¸é€‚ç”¨äº†ï¼Œå¿…é¡»å¾—å››é¡¾ã€‚</p>
<p>2.æˆ‘è‡ªå·±çš„æ–¹æ³•ï¼šå¿˜æ‰èµ„å†ï¼Œé›†ä¸­ç²¾åŠ›ç”¨èƒ½åŠ›å’Œæ½œåŠ›æ¥è¯„ä¼°ã€‚èµ„å†æ˜¯ä¸ªé”šç‚¹ï¼Œä½†æœªå¿…å‡†ç¡®ã€‚</p>
<p>3.æœ‰ä¸ªåŒäº‹æåˆ°å¤šæ‹›å¥³ç”Ÿæ¥æ´»è·ƒæ°”æ°›ï¼Œæˆ‘æ™•ï¼Œæœç„¶å°å¹´è½»çš„æƒ³æ³•ï¼Œè¿™æ˜¯åˆ†å¿ƒä¸æ˜¯æ´»è·ƒï¼Œéš¾é“å­¦æ”¯ä»˜å®ç¾è…¿æ‹›è˜ä¹ˆã€‚å‘¨æœ«æƒ³äº†æƒ³ï¼Œåº”è¯¥æ˜¯å…¶å®èƒ½çœ‹åˆ°äº§å“åœ¨è¿›æ­¥ã€ç”¨æˆ·ä½“éªŒåœ¨æé«˜ï¼Œè‡ªå·±åœ¨ä¿®ç‚¼è¿›æ­¥ï¼Œäº¤æµæ²Ÿé€šä¸­æœ‰æ™ºæ…§æœ‰ç«èŠ±ï¼Œä¸ªäººå›æŠ¥æ»¡æ„æœ‰æé«˜ï¼Œå°±æ˜¯highçš„å…³é”®ã€‚</p>
<p>4.åˆ«è£…ï¼Œåšä¸ªå¦è¯šçœŸå®çš„äººã€‚å›¢é˜Ÿä¸­éƒ½æ˜¯å¦è¯šçœŸå®çš„äººï¼Œæ²Ÿé€šæˆæœ¬å°†å°å¾ˆå¤šã€‚</p>
<p>5.èƒ½å¦å¦è¯šæ²Ÿé€šæ˜¯å…¬å¸å›¢é˜Ÿç®¡ç†çš„ä¸»è¦é—®é¢˜ã€‚</p>
<p>6.å¯¹äºåˆ›ä¸šè€…æ¥è¯´ï¼Œæ‰¾åˆé€‚çš„äººå¸¸å¸¸æ˜¯ä¸ªä¸ä½œä¸ºçš„å€Ÿå£ï¼Œäº‹å®æ˜¯åˆé€‚çš„äººæ˜¯æ°¸è¿œä¸å­˜åœ¨çš„ï¼Œè¦è®©è‡ªå·±å˜æˆæœ€åˆé€‚çš„äººã€‚åˆ›ä¸šè€…æ°¸è¿œè¦ä½œä¸ºåŠä¸ªHRå­˜åœ¨ã€‚</p>
<p>7.æ®å¤šå®¶å…¬å¸ç»Ÿè®¡ï¼Œå›¢é˜Ÿæ·˜æ±°ä¸ªäººçš„é¡ºåºå¾€å¾€å¦‚ä¸‹ï¼šç¬¬ä¸€æ‰¹ï¼Œæ˜æ˜¾ç¼ºé™·è€…ã€ä¼—äººåŒæ¶çš„è¯´è°è€…ï¼›ç¬¬äºŒæ‰¹ï¼Œä¸æ„¿äº¤æµè€…ã€ä¸åˆç¾¤è€…ï¼›ç¬¬ä¸‰æ‰¹ï¼Œæœ‰èƒ½åŠ›ä½†æ…µæ‡’è€…ã€å¦„å›¾åäº«å…¶æˆè€…ï¼›ç¬¬å››æ‰¹ï¼Œå±…åŠŸè‡ªå‚²è€…ï¼Œè”‘è§†åŒåƒšè€…ã€‚</p>
<p>8.ä»–è§£ç­”å›¢é˜Ÿä¸­éƒ¨åˆ†äººä¸èƒ½è·Ÿä¸Šå…¬å¸å‘å±•çš„å¤„ç†è¦ç‚¹ï¼Œä¸‰ç‚¹åŸåˆ™ï¼šç¬¬ä¸€ï¼Œä»¥å¾·ä¸ºä¸»ï¼Œå¾·æœ‰å¤§é—®é¢˜åˆ™éœ€ç¦»å¼€ï¼Œè¯è¯´æ¸…æ¥šä¸å«ç³Šã€å¥½å¥½è¯´ï¼Œå…ˆé¼“åŠ±ç»™æœºä¼šã€ä¸è¦è®©å›¢é˜Ÿæ„å¤–ã€çŒœæµ‹æ‹…å¿ƒã€‚ç¬¬ä¸‰ï¼Œå¾·å…·å¤‡ã€æ‰è½åæˆ–è€…ä¸åŒ¹é…çš„æƒ…å†µï¼Œè¦ç»™é™ä¸‹çš„äººé™è½ä¼ï¼Œé™è½ä¼è¦æœ‰å«é‡‘é‡ï¼Œè¦æ›¿äººè€ƒè™‘å¥½ã€‚</p>
<p>9.å½“ä½ ç»™ä¸€ä¸ªäººè¶³å¤Ÿçš„ä¿¡ä»»å’Œå‹åŠ›çš„æ—¶å€™ï¼Œä»–æ€»èƒ½æ¯”åŸæ¥åšçš„æ›´å¥½ã€‚</p>
<p>10.å¼€ä¼šçš„æ—¶å€™æ€»æœ‰äº›å¤§å¿™äººåœ¨é‚£é‡Œé—·å¤´å›é‚®ä»¶ç©çŸ­ä¿¡ï¼Œè®¤ä¸ºè®¨è®ºçš„é‚£äº›åˆ«äººçš„äº‹å’Œè‡ªå·±æ— å…³ï¼Œè¿™æ˜¯æç«¯é”™è¯¯çš„ã€‚è®©ä½ å‚ä¼šè¯´æ˜é¢†å¯¼è®¤ä¸ºä¼šè®®çš„å†…å®¹ä½ éœ€è¦çŸ¥é“å¹¶å¸Œæœ›å¬åˆ°ä½ çš„æ„è§ï¼Œå¦‚æœå‘ç°ä½ ä¸ä¼šå€¾å¬åˆå¯¹ä¼šè®®æ— æ‰€è´¡çŒ®ï¼Œæ…¢æ…¢ä½ å°±ä¸ä¼šå†è¢«è¦æ±‚å‚ä¼šï¼Œä¹…è€Œä¹…ä¹‹åœ¨ç»„ç»‡ä¸­ä¹Ÿå°±è¢«è¾¹ç¼˜åŒ–äº†ã€‚</p>
<p>11.å…¬å¹³çš„æ–‡åŒ–å’Œå…¬å¹³çš„ä¿¡ä»»æ˜¯éå¸¸é‡è¦çš„ï¼Œå¥–ç½šåˆ†æ˜ï¼Œè¿™æ ·å¤§å®¶æ‰ç›¸ä¿¡æ¸¸æˆè§„åˆ™å­˜åœ¨ï¼Œæ‰ä¼šæŒ‘æˆ˜è‡ªå·±æ›´å¤§å›æŠ¥ï¼Œæ‰ä¸ä¼šæœ‰ä¾¥å¹¸å¿ƒç†ã€‚ç±»ä¼¼è¿™æ ·çš„åŸåˆ™CEOè¦è°¨è®°ä¸å¿˜ã€‚</p>
<p>12.å¯¹ç»„ç»‡è€Œè¨€éœ€è¦æŠŠä¼˜ç§€çš„æ ‡å‡†æ¸…æ™°æ— è¯¯çš„ä¼ é€’ä¸”ä¸æ–­ç²¾è¿›ã€‚å«ç³Šå’Œæ··æ·†å…¶å®æ˜¯ç‰ºç‰²ã€‚</p>
<p>13.åŠ å…¥æˆ‘ä»¬å¹¶ä¸ä»£è¡¨çœ¼ä¸‹çš„è¿™ä¸€ä»½å·¥ä½œã€‚ä¸‡ä¸€æˆ‘è¯´ä¸‡ä¸€ï¼Œè¿™ä¸€ç¥¨ä¸æˆåŠŸï¼ŒåŠ å…¥äº†æˆ‘ä»¬ï¼Œä½ ä¼šå‘ç°ï¼Œä¸–ç•Œä¸Šè¿˜æœ‰å¾ˆå¤šäº‹å€¼å¾—æˆ‘ä»¬å»åšã€‚åªæ˜¯çœ‹ä½ æœ‰æ²¡æœ‰è¶³å¤Ÿçš„è§†é‡å’Œæ¿€æƒ…ã€‚</p>
<p>14.å¯¹äºä¸€åCEOè€Œè¨€ï¼Œæœ€è‰°éš¾çš„äº‹å¯èƒ½å°±æ˜¯æŠµåˆ¶ä½æƒ³è‡ªå·±è§£å†³é—®é¢˜çš„æ¬²æœ›ã€‚ä½ æ›¾èº«ç»ç™¾æˆ˜ï¼Œä½ ä¹Ÿè®¸æ˜¯æœ€æœ‰ç»éªŒï¼Œæœ€æœ‰èµ„æ ¼å»è§£å†³é—®é¢˜çš„äººã€‚ä½†æ˜¯è¿™æ ·ä¸€æ¥å´æ— æ³•å»ºç«‹ä¸€ä¸ªä¼˜ç§€çš„ç®¡ç†å›¢é˜Ÿã€‚å°†æœºä¼šç•™ç»™åˆ«äººæœŸå¾…ä»–ä»¬èƒ½è§£å†³é—®é¢˜ååˆ†è‰°éš¾ï¼Œä½†ä¹Ÿååˆ†å€¼å¾—ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ•´ä¸ªå›¢é˜Ÿçš„èƒ½åŠ›éƒ½å¯ä»¥æœ‰æ‰€æå‡ã€‚</p>
<p>15.ç»å¸¸çœ‹åˆ°èŒä½è›®æ¼‚äº®çš„äººï¼Œä½†ç»†çœ‹å‘ç°ä»–æ¯æ¬¡å‡èŒéƒ½æ˜¯æ¢å·¥ä½œçš„æ—¶å€™å‘ç”Ÿçš„ã€‚è¿™ä¼šè®©æˆ‘è­¦æƒ•ï¼Œå› ä¸ºå¥½çš„äººï¼Œè€æ¿ä¼šåŠ è–ªå‡èŒæ¥æŒ½ç•™ã€‚å¦‚æœä¸€ä¸ªäººåœ¨åŒä¸€å…¬å¸å¤šæ¬¡å‡èŒï¼Œè®©æˆ‘ä¼šæ”¾å¿ƒå¾ˆå¤šï¼Œå› ä¸ºæ¯”æˆ‘äº†è§£ä»–å¤šå¾—å¤šçš„äººçœ‹å¥½ä»–ç»™ä»–æ›´å¤šçš„è´£ä»»ï¼Œè€Œä¸”ä»–ä¸€æ¬¡æ¬¡èƒœä»»ã€‚æ¢å·¥ä½œæ‰å‡èŒï¼Œæœ‰å¯èƒ½æ˜¯å¤–å¼ºä¸­å¹²ï¼Œå¿½æ‚ äº†æ–°è€æ¿ã€‚</p>
<p>16.äºšé©¬é€Šå–ä¹¦èµ·å®¶ï¼Œç°åœ¨ä»–ä¸å–ä¹¦ä¹Ÿå¾ˆèµšé’±ï¼Œ360åšæœç´¢èµ·å®¶ï¼Œç°åœ¨ä¸æœç´¢ä¹Ÿå¾ˆå¼ºå¤§ï¼Œè€Œä¸€äº›å…¬å¸ï¼Œæ¯”å¦‚è¿…é›·ä»p2spã€å®¢æˆ·ç«¯èµ·å®¶å´æ²¡åœ¨è¿™ä¸ªé¢†åŸŸæŒç»­æ‹“å±•åˆ›æ–°ã€‚è¿™å°±æ˜¯æ˜¯å›¢é˜Ÿçš„å·®å¼‚ã€‚</p>
<p>17.ä¸€ä¸ªèº«ä»·ä¸¤ç™¾å¤šäº¿çš„è€æ¿ä¸ä½œç§€ã€ä¸çˆ¬å±±ã€ä¸å¹ç‰›ã€ä¸æ‰“å£æ°´ä»—ã€ä¸æ¥å—é‡‡è®¿ã€ä¸ä¸Šç”µè§†æ‚å¿—ï¼Œä»¥èº«ä½œåˆ™åƒä¸€ä¸ªåŸºå±‚å‘˜å·¥ä¸€æ ·æ¯å¤©è„šè¸å®åœ°æµ‹è¯•äº§å“ï¼Œ æ— æ­¢å¢ƒåœ°æ”¹è¿›äº§å“çš„ä½“éªŒã€‚è¿™æ‰æ˜¯è…¾è®¯æˆåŠŸçš„æœ€å¤§åŸå› ã€‚è€Œè¢«è…¾è®¯æ‰“è´¥çš„ Loserä»¬å§‹ç»ˆæ²¡æœ‰è®¤è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œè¦ä¹ˆéª‚å®ƒé æŠ„è¢­ï¼Œè¦ä¹ˆè¯´å®ƒé QQæ‰èƒ½æˆåŠŸã€‚</p>
<p>18.åˆ›ä¸šä¼ä¸šåœ¨ä¸­å›½è¶Šæ¥è¶Šæ™®åŠï¼Œä¼˜ç§€çš„äººæ‰ä¹Ÿä¼šåœ¨ä¹‹é—´æœæ¯”ã€‚å†µä¸”å¥½çš„æœºåˆ¶ä¹Ÿæ˜¯é‡è¦ç«äº‰åŠ›ï¼Œæˆ‘å»ºè®®æ‰€æœ‰åˆ›ä¸šè€…éƒ½ä»¥å¥½çš„å¿ƒæ€å’Œæœºåˆ¶å’Œå›¢é˜Ÿåˆ†äº«åˆ›ä¸šè¿‡ç¨‹å’Œç»“æœè€Œä¸è¦â€œå¿½æ‚ â€ï¼Œè¿™æ ·åˆ›ä¸šå…¬å¸æ‰ä¼šæ›´å®¹æ˜“å¸å¼•äººæ‰ã€‚</p>
<p>19.ä»Šå¤©å®ŒæˆæœŸæƒå‘æ”¾å‡†å¤‡ï¼Œä¸‹å‘¨ç»™ç¬¬ä¸€æ‰¹åŠ å…¥çš„ä¼˜ç§€æˆå‘˜å‘æ”¾ã€‚å¼€å§‹åˆ¶å®šå‘æ”¾è®¡åˆ’æ—¶ï¼Œæˆ‘å’Œå…¶å®ƒè‘£äº‹æœ‰ä¸€äº›åˆ†æ­§ï¼šæˆ‘å¼ºè°ƒå¸Œæœ›ä»¥æä½çš„è¡Œæƒä»·å‘æ”¾æœŸæƒï¼Œå…¶å®ƒè‘£äº‹åˆ™å¼ºè°ƒä¼šè®¡è¯„ä¼°é—®é¢˜ã€‚æœ€ç»ˆé‡‡ç”¨æˆ‘çš„æ–¹æ¡ˆï¼Œå› ä¸ºæˆ‘éå¸¸äº†è§£åˆ›ä¸šå›¢é˜Ÿæˆå‘˜çš„å¿ƒæ€ã€‚ä¸€ä¸ªæ—©æœŸå…¬å¸æˆå‘˜çš„å¿ƒæ€å’ŒçŠ¶æ€æ˜¯æœ€æ ¹æœ¬çš„ï¼Œå…¶å®ƒé—®é¢˜åªæ˜¯â€œæŠ€æœ¯é—®é¢˜â€ã€‚</p>
<p>20.é€‰æ‹©è¶Šé«˜çº§å½±å“è¶Šå¤§çš„äººæ‰è¶Šè¦çœ‹ä¸€äº›åŸºæœ¬ç´ è´¨ï¼šç†æ€§ã€é€»è¾‘ã€ä¿®å…»ã€ä¼å›¾å¿ƒã€è‡ªæˆ‘æ§åˆ¶åŠ›ã€‚</p>
<p>21.å…¶å®æˆ‘æŒºæƒ³çŸ¥é“å›¢é˜Ÿæˆå‘˜å‘¨æœ«éƒ½åœ¨å¹²å˜›ã€‚ã€‚ã€‚æ€»å¸Œæœ›å¤§å®¶æŠŠæ—¶é—´å……åˆ†æœ‰æ•ˆåˆ©ç”¨äº†ã€‚ã€‚å½“ç„¶æˆ‘è¯´çš„ä¸æ˜¯åªå·¥ä½œï¼Œæ˜¯æŒ‡ä¼˜å…ˆåˆ©ç”¨å­¦ä¹ ã€ä¼‘æ¯ã€å¨±ä¹ã€é”»ç‚¼ã€äº¤æµï¼Œæ€è€ƒä¸Šã€‚å¹¶ä¸”å¯ä»¥ä¸€èµ·æ´»åŠ¨ã€‚</p>
<p>22.èŒåœºæ€»ç»“ï¼šå·¥ä½œåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªç§¯ç´¯ä¿¡èª‰çš„è¿‡ç¨‹ã€‚è‡ªå·±ä»Šå¤©çš„å·¥ä½œä¸€ç›´åœ¨ä¸ºè‡ªå·±çš„æ˜å¤©ç§¯ç´¯ä¿¡èª‰ã€‚å·¥ä½œä¸­æ€»æ˜¯æ‰é“¾å­ã€éœ€è¦äººæé†’å°±æ˜¯ä¸æ–­çš„ä¸¢æ‰è‡ªå·±çš„ä¿¡èª‰ã€‚We are what we repeatedly doï¼Œnot we repeatedly think or want or sayï¼ˆæˆ‘ä»¬æ˜¯æˆ‘ä»¬åå¤åšçš„ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬åå¤æƒ³æˆ–æƒ³æˆ–è¯´çš„ï¼‰ã€‚</p>
<p>23.æ²¡æœ‰å…è´¹çš„åˆé¤ã€‚åˆ›ä¸šå…¬å¸è¦å‡ºäººå¤´åœ°å°±è¦æ±‚éå¸¸ä¼˜ç§€é«˜çš„è‡ªæˆ‘è¦æ±‚ã€‚å‘Šåˆ«â€œå·®ä¸å¤šâ€ã€â€œè¿˜è¡Œâ€ã€â€œå…ˆè¿™æ ·å§â€ã€å‘Šåˆ«å·¥ä½œæ‰é“¾å­ã€æ‹–æ‹‰ã€80åˆ†ã€‚å¾ˆå¤šåˆ›ä¸šå…¬å¸è¿˜ä¸å¦‚å¤§å…¬å¸åŠªåŠ›è¦æ±‚é«˜å°±æ²‰æµ¸â€œåˆ›ä¸šâ€çš„çŠ¶æ€ï¼Œæˆ–è€…æ˜¯åªæ²‰æµ¸åœ¨å·¥ä½œæ—¶é—´é•¿çš„ä¼ªâ€œåˆ›ä¸šâ€çŠ¶æ€ã€‚</p>
<p>24.å§œå­ç‰™81å²æ‰å½“ä¸Šä¸‰å†›æ€»å¸ä»¤ï¼Œäººå®¶å‰80å¹´å°±åšä¸¤ä»¶äº‹ï¼šå¥½å¥½å­¦ä¹ å’Œé”»ç‚¼èº«ä½“ã€‚</p>
<p>25.ä¸€ä¸ªå…¬å¸æœ€å¼ºçš„æ•Œäººæ˜¯ä»€ä¹ˆï¼ŸéŸ¦å°”å¥‡è¯´ï¼Œæ˜¯â€œå¦ç‡â€ã€‚æ·±è¡¨è®¤åŒã€‚å¹¸å¥½ï¼Œå¦ç‡æ˜¯å¯ä»¥åŸ¹è‚²çš„ã€‚</p>
<p>26.æˆ‘è§‰å¾—ä»¥åå›¢é˜Ÿçš„å·¥ä½œï¼Œä¸è®ºå¤§å°ï¼Œåº”æŠŠå·¥ä½œçš„ç›®æ ‡å®šä¹‰å¹¶åˆ†è§£åï¼Œé‚®ä»¶å‘å‡ºæ¥ã€‚ç¬¬ä¸€ï¼Œè¿™æ ·å¯ä»¥åˆ«äººææ„è§ï¼›ç¬¬äºŒï¼Œå¯ä»¥é¿å…é‡å¤çš„å·¥ä½œï¼›ç¬¬ä¸‰ï¼Œé¿å…å®šä¹‰æ¸…æ¥šç†è§£æœ‰è¯¯å·®ï¼›ç¬¬å››ï¼ŒåŒæ—¶èƒ½ä¼°è®¡å·¥ä½œé‡ã€è¯„ä¼°æ•ˆç‡æ–¹æ³•ã€‚æ¸…æ¥šä¸å«ç³Šè¦æˆä¸ºå…¬å¸çš„æ–‡åŒ–ã€‚</p>
<p>27.ã€èŒåœºã€‘æ˜¨æ™šè¯·å¤šç©ä¼˜ç§€å‘˜å·¥åƒé¥­ï¼ŒèŠäº†å‡ ç‚¹èŒåœºä½“ä¼šã€‚ç¬¬ä¸€ï¼ŒæŠŠè‡ªå·±å½“è€æ¿çœ‹ï¼Œ è±¡è€æ¿ä¸€æ ·æ‹¼å‘½å¹²æ´»ï¼Œèƒ½åŠ›è‡ªç„¶å°±æé«˜äº†ã€‚æœ‰äº†èƒ½åŠ›ï¼Œå‡å¦‚å¤šç©ä¸èƒ½ç»™ä½ å¥½çš„å› æŠ¥ï¼Œå…¶ä»–å…¬å¸ä¸€å®šä¼šç»™ã€‚ç¬¬äºŒï¼Œä¸æ˜¯æ¯æ¬¡ä»˜å‡ºå°±ä¸€å®šæœ‰å›æŠ¥ï¼Œä½†æ˜¯ä¸æ–­ä»˜å‡ºå°±ä¸€å®šä¼šæœ‰å›æŠ¥ã€‚æå­¦å‡Œè¡¥å……äº†ä¸€ç‚¹ï¼šåƒä½ çš„è€æ¿ä¸€æ ·æ€è€ƒï¼Œèƒ½åŠ›ä¼šæé«˜å¾—æ›´å¿«ã€‚</p>
<p>28.æœ‰äººé—®æˆ‘å¦‚ä½•çªç ´è‡ªå·±çš„èŒä¸šç“¶é¢ˆï¼Œæˆ‘è¯´ï¼šä½ çš„ç“¶é¢ˆå°±åœ¨äºä½ çš„å¿ƒã€‚ä½ çš„å¿ƒæ›´å®½ï¼Œå¿ƒæ€æ›´å¥½ï¼Œé‡åˆ°é—®é¢˜å°†è‡ªå·±æ‹¨é«˜ä¸€å±‚å»çœ‹é—®é¢˜ï¼ŒæŠŠä½ å¿ƒé‡Œçš„é‚£äº›å°çº ç»“å°ç–‘æƒ‘å°ç®—ç›˜å°ç§å¿ƒï¼Œç»Ÿç»Ÿæ‰“ç ´ï¼Œä½ å°±æ²¡æœ‰ç“¶é¢ˆã€‚</p>
<p>29.æœ€è¿‘å¤§å®¶ review äº†ä¹ä¹æˆ¿åŠå¹´çš„è¿›å±•å¹¶è®¨è®ºæ¯ä¸ªäººçš„æ€»ç»“å’Œè®¾æƒ³ï¼Œå¯¹æˆ‘ä»¬çš„ä¿¡å¿ƒæ›´åŠ å¢å¼ºã€‚å’ŒåŒäº‹æ›¾è®¨è®ºï¼šåˆ›ä¸šè¦ç»å¸¸è‡ªçœï¼Œé¿å…è‡ªæˆ‘å¼ºåŒ–å’Œå‚¬çœ ã€‚æ‰€ä»¥è¦åŒºåˆ«ä¿¡å¿ƒå’Œâ€œYYâ€ï¼ŒçœŸæ­£ä¿¡å¿ƒæºäºçœ‹åˆ°è‡ªå·±çš„è¿›æ­¥å’Œæ½œåŠ›ï¼Œå¯ä»¥åˆ†æˆä¸¤ä¸ªæ–¹é¢ï¼šç¬¬ä¸€ï¼Œå¯¹äº‹æƒ…æœ¬èº«åˆ¤æ–­çš„ä¿¡å¿ƒï¼›ç¬¬äºŒï¼Œå¯¹è‡ªå·±å’Œå›¢é˜Ÿçš„ä¿¡å¿ƒã€‚</p>
<p>30.å‘¨å…­å‡Œæ™¨ä¸€ç‚¹ï¼Œæ”¶åˆ°ä¸€ä½åˆ›ä¸šè€…çŸ­ä¿¡ï¼šå¤§å®¶è®¨è®ºçš„ç»“è®ºï¼Œæè‡´å°±æ˜¯æŠŠè‡ªå·±é€¼ç–¯ã€æŠŠåˆ«äººé€¼æ­»ï¼é‚£æ—¶ï¼Œä»–ä»¬æ­£åœ¨ä¸ºè‡ªå·±çš„æ¢¦æƒ³é€šå®µè¾¾æ—¦çš„æ‰“æ‹¼ã€‚æˆ‘ç†è§£çš„æè‡´å°±æ˜¯åšå‡ºè¶…è¶Šè‡ªå·±èƒ½åŠ›çš„ä¸œè¥¿ï¼Œåªæœ‰æè‡´çš„ä¸œè¥¿æ‰èƒ½è¶…è¶Šç”¨æˆ·çš„æƒ³è±¡ï¼Œæ‰ä¼šæœ‰è‰¯å¥½çš„å£ç¢‘ã€‚</p>
<p>31.èƒ½åœ¨ç»†å¾®å…³é”®ä¹‹å¤„è‡ªæˆ‘è¦æ±‚å’Œäº’ç›¸challengeï¼ˆæŒ‘æˆ˜ï¼‰æ˜¯å¥½å›¢é˜Ÿçš„ç‰¹è´¨ä¹‹ä¸€ã€‚æ¯”å¦‚å¹³æ—¶æ—¶é—´åˆ†é…ã€å·¥ä½œçŠ¶æ€ã€æ€ç»´è®­ç»ƒã€æ²Ÿé€šè¡¨è¾¾ã€å°ä¹ æƒ¯ã€‚</p>
<p>32.æ‹›äººæœ€ç®€å•è«è¿‡äºæ‹›å¹²è¿‡è¿™ä¸ªäº‹çš„äººã€‚ä¸è¿‡èƒ½æ‰¾åˆ°ç‰¹è´¨æœ€å…·åˆé€‚ç‰¹è´¨çš„äººæ›´é‡è¦ã€‚ç‰¹åˆ«æ˜¯åˆ›æ–°ä¼ä¸šï¼Œå¾ˆå¤šå²—ä½æœªå¿…æœ‰æˆç†Ÿçš„äººå¯¹åº”ï¼Œæˆ–è€…ä¸šç•Œçš„æ™®é€šæ ‡å‡†å¹¶ä¸ç‰¹åˆ«é€‚åˆï¼Œæˆ–è€…å…·ä½“çš„å²—ä½æœ‰ä¸€äº›ç‰¹åˆ«çš„è¦æ±‚ã€‚è¿™æ—¶å€™é€šè¿‡å¯¹å²—ä½çš„ç†è§£è€Œå»æ‹›å…·å¤‡æ€§æ ¼æŠ€èƒ½çˆ±å¥½ç‰¹è´¨çš„äººå°±ç‰¹åˆ«é‡è¦ã€‚</p>
<p>33.å…¶å®åŠ å…¥ä¸€ä¸ªä¼˜ç§€çš„æ—©æœŸå…¬å¸æœ‰ä¸€ä¸ªæ˜æ˜¾çš„å¥½å¤„ï¼šå…¬å¸ä¼šæƒ³å°½åŠæ³•å¸®ä½ æé«˜ï¼Œå› ä¸ºå…¬å¸æœ‰å¾ˆå¤šäº‹æƒ…è¦åšï¼Œè€Œäººå‘˜åˆæœ‰é™ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šå¯¹æœ‰æ½œè´¨çš„äººæå‡ºå„ç§é«˜çš„è¦æ±‚ï¼Œå¸®åŠ©æé«˜ã€‚åœ¨å¤§å…¬å¸ä½ çš„è€æ¿å³ä½¿æ„¿æ„(ä¸ä¸€å®š)èŠ±æ—¶é—´å’Œç²¾åŠ›coachï¼ˆæ•™ç»ƒï¼‰ä½ ï¼Œè‚¯å®šæ²¡æœ‰åˆ›ä¸šå…¬å¸å¤šã€‚</p>
<p>34.è¿™å‘¨é¢äº†åå‡ ä¸ªäººç»ˆäºç¡®å®šä¸€ä¸ªå®ä¹ ç”Ÿã€‚æœ€è¿‘ä¸€ä¸ªå¤šæœˆå¯èƒ½é¢è¯•äº†50å¤šäººï¼Œæ€»å…±åªæœ‰2ä¸ªéå¸¸æœ‰æ„å‘çš„äººé€‰ï¼Œå…¶ä¸­å¤±è´¥ä¸€ä¸ªï¼Œä¸€ä¸ªè¿˜åœ¨è°ˆã€‚æ¯å½“æƒ³æ”¾ä½è¦æ±‚çš„æ—¶å€™ï¼Œæˆ‘å°±æé†’è‡ªå·±ä¸€å®šä¸èƒ½å¾€ä½èµ°è€Œè¦å¾€é«˜èµ°ï¼Œæˆ‘ä»¬è¦åšçš„å‡ºå½©ï¼Œè€Œä¸æ˜¯å®Œæˆçš„äº‹æƒ…ã€‚è€Œå°¤å…¶åœ¨æ—©æœŸï¼Œæ ¸å¿ƒå‡ ä¸ªäººçš„èƒ½åŠ›ã€ç´ è´¨ã€æ€åº¦æ˜¯æœ€å…³é”®çš„ã€‚</p>
<p>35.ä¸€ä¸ªå¥½çš„å›¢é˜Ÿï¼Œæ˜¯åº”è¯¥èƒ½å¤Ÿä¸æ–­åˆ›æ–°çªç ´çš„å›¢é˜Ÿã€‚</p>
<p>36.æœ‰2ä¸ªæœ‹å‹2å¹´å‰10ä¸‡å…ƒèµ·æ­¥åˆ›ä¸šä»¤æˆ‘ä½©æœï¼Œä»Šå¤©è§åˆ°ä¸€ä¸ªåˆ›ä¸šè€…3å¹´å‰0å…ƒèµ·æ­¥åˆ›ä¸šä»¤æˆ‘æƒŠè®¶ã€‚</p>
<p>37.å…¬å¸çš„æ¿€åŠ±åˆ¶åº¦å’Œè€ƒæ ¸åˆ¶åº¦éå¸¸é‡è¦ï¼Œæˆ‘ä¸çŸ¥é“æˆ‘çœ‹çš„æ˜¯å¦æ˜¯ç‰¹ä¾‹ï¼Œäº†è§£åˆ°å¥½äº›å…¬å¸çš„é‡è¦å²—ä½ç®¡ç†è€…é•¿æœŸä¸€è¾¹æ‹¿ç€ä¸é”™çš„å›æŠ¥ï¼Œä¸€è¾¹æŠŠç²¾åŠ›é‡æ”¾åœ¨æŠ˜è…¾è‡ªå·±æƒ³çš„äº‹æƒ…ã€‚ä¸€å®šè¦é¿å…è¿™ç§æƒ…å†µã€‚ï¼ˆä¸ä¼šæœ‰äººè§‰å¾—è¿™ç§æƒ…å†µå­˜åœ¨ä¹Ÿåˆç†å§ï¼‰</p>
<p>38.ä»¥å‰é¢è¯•é€‰æ‹”äººçš„æ—¶å€™ä¸€ç›´æ²¡æœ‰è§‰å¾—è‡ªä¿¡è¿™ä¸ªç‰¹è´¨å¾ˆé‡è¦ï¼Œç°åœ¨å‘ç°åœ¨ä¸€èˆ¬çš„ç®€å•çš„äº‹æƒ…å’Œå·¥ä½œè‡ªä¿¡ä¸æ˜¯ä¸€ä¸ªé‡è¦ç‰¹è´¨ï¼Œä½†æ˜¯å¯¹äºä¸€äº›å…³é”®äº‹æƒ…å’ŒèŒè´£è‡ªä¿¡å°±æ˜¯é‡è¦åŒºåˆ«çš„ç‰¹è´¨ï¼ŒçœŸæ­£å›°éš¾æˆ–æœ‰æŒ‘æˆ˜çš„äº‹å¾€å¾€æ˜¯åå‘æ“ä½œçš„æˆ–è€…æ˜¯ç›¸å¯¹å­¤ç‹¬çš„ã€‚</p>
<p>39.ä¸­åˆäº®å“¥è¯´åˆ›ä¸šå…¬å¸æ—©æœŸåªèƒ½è¾›è‹¦å¤šé¢è¯•äººæ¥æ·˜äººæ‰ã€‚è€ç‹è¯´è‡ªå·±çš„ç¬¬ä¸€èŒä½æ˜¯hrï¼ˆäººåŠ›èµ„æºç®¡ç†ï¼‰ã€‚æˆ‘è§‰å¾—ä»–ä»¬è¯´çš„å¾ˆå¯¹ã€‚</p>
<p>40.ä¸Šçº¿å¤§æ¦‚åŠå¹´ï¼Œç»å¸¸è§‰å¾—è¿›åº¦å¤ªæ…¢ã€‚é€Ÿåº¦ã€è´¨é‡ã€æˆæœ¬ä¸‰è€…æ˜¯ä¸èƒ½éƒ½åŒæ—¶è¾¾åˆ°çš„ï¼Œå½“ç„¶å›¢é˜Ÿæˆé•¿é€Ÿåº¦ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚</p>
<p>41.ä»Šå¤©ï¼ŒæŠŠåŠå¹´æ¥æ¯æ¬¡ä¸ä¸åŒå›¢é˜Ÿæˆå‘˜1:1æ²Ÿé€šä¸­å¾—åˆ°çš„å¯¹æˆ‘å’Œå¯¹å…¬å¸çš„æ„è§å»ºè®®ä½œäº†ä¸ªå›é¡¾ï¼Œå¹¶ä½œåˆ’åˆ†åˆ†ä¸ºå·²è§£å†³ã€éƒ¨åˆ†è§£å†³ã€é—®é¢˜ä¾æ—§ã€‚æ©ï¼Œæ”¹è¿›çš„è¿˜ä¸å¤Ÿå¥½ã€‚</p>
<p>42.ç»“å©šæœ‰ä¸€ä¸ªä¸çŸ­è°ˆæ‹çˆ±çš„è¿‡ç¨‹æ‰é¢†è¯ï¼Œè€Œæ‰¾åˆ›ä¸šä¼™ä¼´çš„æ—¶é—´ç¼ºçŸ­éå¸¸å¤šã€‚å¦‚æœç»“å©šæ˜¯åˆä½œ60å¹´ï¼Œåˆ›ä¸šæ˜¯åˆä½œå…­ä¸ƒå¹´ï¼Œé‚£ä¹ˆæ˜¯å¦åº”è¯¥ç”¨ 1&#x2F;10 çš„æ—¶é—´è°ˆè°ˆâ€œæ‹çˆ±â€ï¼Ÿ</p>
<p>43.é•¿æœŸå›æŠ¥é‡ç‚¹æ˜¯è‚¡ä»½æœŸæƒã€‚ä½†è¿™æ–¹é¢å›½å†…çš„è¿˜ä¸è§„èŒƒï¼šå³ä½¿æ˜¯æ—©æœŸæ ¸å¿ƒæˆå‘˜ä¹Ÿä¸è¢«å‘ŠçŸ¥è‡ªå·±çš„æœŸæƒå å…¬å¸æ€»è‚¡æœ¬çš„æ¯”ä¾‹ï¼Œæ›´æ˜¯æ²¡æœ‰æ™®åŠä¼˜å…ˆå¿è¿˜ï¼Œè¡Œæƒä»·ã€è¡Œæƒæ¡ä»¶é™ç­‰æ¦‚å¿µï¼Œæ‰€ä»¥å¾ˆå¤šå…¬å¸è‘£äº‹ä¼šæŠŠæ€»è‚¡æ•°åšå¾ˆå¤§ï¼Œè®©å‘˜å·¥å¬èµ·æ¥å¥½å¬ã€‚æˆ‘æƒ³è¿™ä¸ªæƒ…å†µä¸ä¼šæŒä¹…ï¼Œæˆ‘ä»¬ä¸ä¼šè¿™ä¹ˆåšã€‚</p>
<p>44.å¦‚ä½•å¸å¼•äººæ‰ï¼šæˆ‘æ€»ç»“ï¼ˆæ€»ç»“ä¸è¡¨ç¤ºæˆ‘åšå¥½äº†ï¼Œè€Œæ˜¯è®¤è¯†åˆ°è¦åšå¥½ï¼‰å››ä¸ªè¦ç´ ï¼šã€çŸ­æœŸå›æŠ¥ã€‘ã€ã€é•¿æœŸå›æŠ¥ã€‘ã€ã€ä¸ªäººæˆé•¿ã€‘ã€ã€ç²¾ç¥ç”Ÿæ´»ã€‘ã€‚ä»å·¦åˆ°å³ï¼Œä»æ˜“åˆ°éš¾ï¼Œå…¶ä¸­ä¸°å¯Œä¸ä¸€èˆ¬çš„äººç”Ÿä½“éªŒå’Œç²¾ç¥ç”Ÿæ´»æ˜¯æœ€ç»¼åˆè¦æ±‚æœ€é«˜çš„ï¼Œè¦ä¸æ–­åæ€è¿½æ±‚ï¼Œä¹ä¹æˆ¿ä¼šåŠªåŠ›åšå¥½ï¼æ¬¢è¿ä¼˜ç§€çš„æŠ€æœ¯äººæ‰ã€äº§å“äººæ‰åŠ å…¥ä¸€èµ·å…±äº‹ã€‚</p>
<p>45.æœ‰ä¸€äº›äººå¯ç”¨è¿½æ±‚å“è¶Šæ¥é¼“èˆï¼Œå¦ä¸€äº›äººåº”ä»¥ç°å®å›æŠ¥ä½œæ¿€åŠ±ï¼Œä½†æ˜¯å…¶å®ä¸¤ç§æ–¹æ³•å¯ä»¥å…³è”èµ·æ¥ã€‚æˆ‘æ˜¯è¿™æ ·å…³è”çš„ï¼Œå¦‚ï¼šâ€œåªè¦æˆ‘èƒ½æ”¹è¿›è€å¿ƒä¸è¶³çš„ç¼ºç‚¹å°±ç›¸å½“äºä¸ªäººå°†å¢å€¼30%äº†â€ã€‚</p>
<h1 id="ä¸‰ã€å…³äºå•†ä¸š"><a href="#ä¸‰ã€å…³äºå•†ä¸š" class="headerlink" title="ä¸‰ã€å…³äºå•†ä¸š"></a>ä¸‰ã€å…³äºå•†ä¸š</h1><p>1.å †ç Œçš„äº§å“æ²¡æœ‰å®‰å…¨æ„Ÿï¼Œå‡†ç¡®çš„æŠ‰æ‹©æ‰æœ‰ã€‚</p>
<p>2.ç»„ç»‡çš„æˆæœéƒ½åœ¨ç»„ç»‡ä¹‹å¤–ï¼Œæ‰€ä»¥ä¸è¦æŠŠåšå®Œäº†æŸæŸé¡¹ç›®è¯´æˆæˆæœï¼Œè€Œåº”è¯¥å§‹ç»ˆå…³æ³¨å¯¹å¤–ä½“ç°çš„æˆæœï¼Œå¦‚ï¼šç”¨æˆ·åœ¨ä»€ä¹ˆæ–¹é¢ä½“éªŒå¾—åˆ°äº†æå‡ï¼Œå…¬å¸åœ¨ä¸šç•Œå¾—åˆ°äº†ä»€ä¹ˆç›Šå¤„ã€‚</p>
<p>3.å¾®åšçš„éªŒè¯ç æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œæ€ä¹ˆéƒ½ç­”ä¸å¯¹ï¼Œè¿™ä¹ˆé‡è¦çš„ä¸œè¥¿å°±è¿™æ ·è´¨é‡å°±ä¸Šçº¿äº†ã€‚å¼•ä»¥ä¸ºæˆ’ã€‚</p>
<p>4.åˆ›ä¸šå°±è¦åƒç”Ÿå°å­©ä¸€æ ·ï¼šå‡†å¤‡å¥½ä½“åŠ›ï¼Œç”¨é•¿åŠ²ï¼Œå¿«é€Ÿæ¢æ°”ï¼›å–Šç–¼å’ŒæŠ±æ€¨æ²¡ç”¨ï¼Œä¸“æ³¨åœ¨åŠªåŠ›ï¼Œå…³é”®æ—¶å€™åšæŒå†åšæŒä¸€æŠŠï¼</p>
<p>5.é‡è§†æœåŠ¡ï¼Œé‡è§†æ„Ÿå—ï¼Œæ˜¯é‡è¦çš„æœºä¼šï¼Œéšç€æ”¶å…¥æ°´å¹³æé«˜ï¼Œæ€•éº»çƒ¦ï¼Œå¸Œæœ›é«˜è´¨é‡æœåŠ¡å°†æˆä¸ºä»˜è´¹åŠ¨åŠ›ã€‚å¸®ç”¨æˆ·çœé’±ä¸å†æ˜¯å”¯ä¸€æ€è·¯ï¼Œç”šè‡³ä¸æ˜¯æœ€ä½³æ€è·¯ã€‚</p>
<p>éå¸¸å¼ºçš„æ”¹å–„ä½“éªŒçš„æŠ€æœ¯åº”ç”¨ï¼Œé æŠ€æœ¯çš„å¼ºåŠ²æ¨åŠ¨åŠ›ï¼Œè®©ä¸å¯èƒ½å˜æˆå¯èƒ½ã€‚</p>
<p>6.å¯¹äº§å“ç»ç†çš„å¸¸ç”¨é—®é¢˜ï¼šæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œé‡è¦å—ï¼Œæ€ä¹ˆçŸ¥é“çš„ï¼Œè¾¾åˆ°è¿™ä¸ªå¥½å¤„æœ‰å¥½çš„åšæ³•å—ï¼Ÿ</p>
<p>7.å¦‚æœä½ å¾ˆæœ‰æ‰åï¼Œåœ¨æŸäº›æ–¹é¢åˆæœ‰ä¸€æŠ€ä¹‹é•¿ï¼Œè¯·å…ˆä¸è¦æ€¥äºéœ²å‡ºé”‹èŠ’ï¼Œå¦‚æœä½ åªæ˜¯ä»¥æ™®é€šèº«ä»½è€Œä¸æ˜¯ä»¥é¢†å¯¼èº«ä»½åˆ°æ–°å•ä½å»çš„ï¼Œé‚£å°±æ›´ä¸èƒ½é”‹èŠ’å¤ªéœ²ã€‚ä¸€ä¸ªäººæ–°åˆ°ä¸€ä¸ªå•ä½ï¼Œå°±åƒä¸€ç²’çŸ³å­æŠ•å…¥ä¸€æ½­å¹³é™çš„æ± æ°´ï¼Œå¾€å¾€ä¼šå¼•å…¥æ³¨ç›®ï¼Œä¸€ä¸¾ä¸€åŠ¨ï¼Œä¸€è¨€ä¸€è¡Œï¼Œéƒ½åœ¨åˆ«äººçš„è§†é‡ä¹‹ä¸­ã€‚</p>
<p>8.å‘ç°é—®é¢˜æ€»æ˜¯åˆé«˜å…´åˆéƒé—·ï¼Œé«˜å…´ï¼šè§£å†³é—®é¢˜ï¼›éƒé—·ï¼šä¸ºä»€ä¹ˆæ˜¯æˆ‘å‘ç°ï¼Œä¸ºè®¡ä¹ˆç°åœ¨æ‰å‘ç°</p>
<p>9.åšäº§å“ä¸€å®šè¦åšæŒé¢å¯¹äº‹å®ä»”ç»†è¾¨æå°å¿ƒæ±‚è¯ï¼Œä¸ç»•å¼¯ä¸ä¾¥å¹¸ä¸é¸µé¸Ÿï¼Œå»¶è¿Ÿæ»¡è¶³æ„Ÿã€‚</p>
<p>10.åˆ›ä¸šå¿Œï¼šæœªæ€è¿›ï¼Œå…ˆæ€é€€ã€‚</p>
<p>11.æˆ‘ä¹Ÿå¿«çœ‹å®Œäº†ï¼Œæ¨èã€‚æˆ‘çš„åˆ†äº«å†…éƒ¨äº¤æµã€‚ä¹‹å‰è¿˜çœ‹äº†ä¸€æœ¬ã€Šä»é›¶åˆ°ç™¾äº¿ã€‹ï¼Œè™½ç„¶ä¸­ç¾ç¯å¢ƒå·®åˆ«æŒºå¤§ï¼Œä½†æ˜¯å…³äºåˆ›ä¸šå’Œäººç”Ÿçš„å·®åˆ«ä¸å¤§ã€‚</p>
<p>12.å¤§åŠå¤œæ¥ç‚¹ç»™åŠ›çš„ï¼Œåˆ›ä¸šå››åŸåˆ™ï¼šåˆšæ‰åˆä¸€ä½å‡ºæ¥åˆ›ä¸šçš„å…„å¼Ÿ msn ä¸Šè·Ÿæˆ‘èŠã€‚å†æ¬¡è¯šæ³åˆ†äº«ç»™ä»–ï¼šä¸€ï¼Œå‡¡äº‹åªèƒ½é è‡ªå·±ï¼›äºŒï¼Œä¸‡äº‹çš†æœ‰è§£ï¼Œä¸”åªæœ‰å”¯ä¸€æ­£è§£ï¼›ä¸‰ï¼Œå‡¡æ˜¯æ‹…å¿ƒçš„äº‹ä¸€å®šä¼šå‘ç”Ÿï¼›å››ï¼Œä»åˆ›ä¸šçš„ç¬¬ä¸€å¤©å¼€å§‹ï¼Œäº«å—ï¼</p>
<p>13.æœªæ¥ä¼šæœ‰æ›´å¤šçš„è¾“å…¥è¾“å‡ºçš„åˆ›æ–°è®©ä¿¡æ¯å¯æµåŠ¨ï¼Œæ›´å¤šåˆ†å‘æ¨èçš„æœºåˆ¶è½¬åŠ¨èµ·æ¥ã€‚</p>
<p>14.æˆ‘ä»å°åˆ°å¤§é‡åˆ°è¿‡2ä¸ªå¤§å¿½æ‚ (ä¸æ˜¯æŸä»¶äº‹å¿½æ‚ ï¼Œå¿½æ‚ æˆæ€§çš„é‚£ç§äºº)ï¼Œä¸€ä¸ªä¸­å­¦åŒå­¦ï¼Œä¸€ä¸ªæ˜¯ä»Šå¹´ï¼Œæˆ‘çš„æ€»ç»“æ˜¯ä¸€å®šä¸è¦å’Œå¤§å¿½æ‚ äº¤å¾€åˆä½œï¼Œå¦åˆ™å³ä½¿åˆ©ç›Šä¸å—æŸï¼Œå£ç¢‘ä¹Ÿä¼šå—æŸã€‚ç”šè‡³è¿æ•·è¡éƒ½ä¸è¦å»æ•·è¡ï¼Œé‚£ä¹Ÿä¼šæµªè´¹ä½ æ—¶é—´ã€‚</p>
<p>15.æ—å½ªç ”ç©¶æˆ˜ç•¥æ›´ç ”ç©¶æˆ˜æœ¯ã€‚46å¹´å…±å†›åˆåˆ°ä¸œåŒ—ï¼Œä¸€ä¸ªå¸ˆæ‰“ä¸è¿‡å›½å†›ä¸€ä¸ªå›¢ã€‚ä»–å†’æ­»äº²èµ´æˆ˜åœºè§‚æˆ˜ï¼Œç ”ç©¶å‡ºç­çš„ä¸‰ä¸‰åˆ¶æˆ˜æ–—é˜Ÿå½¢ã€ä¸€ç‚¹ä¸¤é¢ç­‰æˆ˜æœ¯æ–¹æ³•ã€‚å¹¶äº² è‡ªè®²è¯¾æ¨å¹¿ï¼Œç¼©å°äº†ä¸å›½å†›æˆ˜æ–—åŠ›å·®è·ã€‚æ²¡æœ‰æ—å½ªï¼Œå…±å…šå¾ˆå¯èƒ½å¤±æ‰ä¸œåŒ—ï¼Œæ”¹å˜æˆ˜äº‰è¿›ç¨‹ã€‚ä¸€ä¸ªä¼ä¸šï¼Œå¦‚æœæˆ˜ç•¥å®¶å¤ªå¤šä¸æ˜¯å¥½äº‹ï¼ŒæŠ“ç»†èŠ‚çš„äººè¶Šå¤šè¶Šå¥½ã€‚</p>
<p>16.åˆ›ä¸šå…¬å¸å‘¨æœ«ä¸Šç­æ˜¯ä¾é ä¸­ç­–ï¼Œå¸Œæœ›èƒ½åšåˆ°ä¾é ä¸Šç­–ï¼šéå¸¸ä¸»åŠ¨ï¼Œé«˜å³°çŠ¶æ€ï¼Œæ—¶é—´ç®¡ç†ï¼›Procativeï¼ŒMindfullï¼ŒSensitiveï¼ˆç»ƒä¹ ã€æ­£å¿µã€æ•æ·ï¼‰ã€‚</p>
<p>17.çœ‹é©¬åŒ–è…¾çš„è…¾è®¯å¾®åšï¼ŒçœŸæ˜¯è¶…çº§æ³¨é‡ç”¨æˆ·ä½“éªŒçš„äº§å“ç»ç†é¡¹ç›®ç»ç†ã€‚</p>
<p>18.æ˜å¤©æ˜¯9æœˆçš„ç¬¬1å¤©ã€‚å»å¹´çš„ä»Šå¤©ï¼Œæˆ‘ç¦»å¼€äº†ä¸Šä¸€ä¸ªå›¢é˜Ÿå¼€å§‹ç­¹å¤‡ 99fang.comã€‚è¿‡å»çš„ä¸€å¹´è¡¨ç°æœ‰ä¼˜ç§€æœ‰ä¸è¶³ï¼Œä½†æ˜¯æ‰“ä¸‹äº†å¾ˆå¥½çš„äº§å“&#x2F;ç”¨æˆ·&#x2F;å¸‚åœº&#x2F;&#x2F;æŠ€æœ¯&#x2F;å›¢é˜ŸåŸºç¡€ï¼Œå°¤å…¶æ˜¯æˆ‘èƒ½æ˜æ˜¾æ„Ÿè§‰åˆ°å›¢é˜Ÿçš„è¿›æ­¥ã€‚ä»æ˜å¤©å¼€å§‹ï¼Œæˆ‘ä»¬è¦å¯¹è‡ªå·±æœ‰æ›´é«˜çš„æŒ‘æˆ˜å’Œè¦æ±‚ã€‚</p>
<p>19.ä»Šå¤©å…¬å¸ä¸€ä½åŒäº‹ç”¨äº†G2ä¸€å‘¨åæ„Ÿè¨€ï¼šè™½ç„¶æˆ‘è¿˜å¾ˆå¤šåŠŸèƒ½ä¸ä¼šç”¨ï¼Œä½†æ˜¯æˆ‘è§‰å¾—5å¹´åè‚¯å®šå…¨éƒ¨äººéƒ½ç”¨æ™ºèƒ½æ‰‹æœºï¼Œå¾ˆé«˜å…´ç°åœ¨ç”¨ä¸Šäº†ã€‚ç±»ä¼¼çš„è¯åœ¨å…¬å¸å†ä¸€æ¬¡å¬åˆ°ï¼Œè¿™æ¬¡æ˜¯ä¸€ä¸ªéitèƒŒæ™¯çš„åŒäº‹é¢„æµ‹ã€‚ä½¿ç”¨æ™ºèƒ½æ‰‹æœºæ˜¯ä¸€ä¸ªçš„ç”Ÿæ´»æ€åº¦å’Œæ–¹å¼çš„å˜åŒ–ï¼Œè€Œå°è¯•æ–°ç”Ÿæ´»æœ¬èº«æ˜¯ç§¯æçš„æ€åº¦ï¼Œè€Œç§¯æçš„æ€åº¦æ˜¯å¯ä»¥äº’ç›¸æ„ŸæŸ“çš„ã€‚</p>
<p>20.åå¤åå¤åå¤ä½“ä¼šéœ€æ±‚ä½“éªŒäº§å“ï¼Œé«˜å¼ºåº¦çš„ä½¿ç”¨äº§å“ã€‚</p>
<p>21.éç†æ€§è®©ç¤¾ä¼šå­˜åœ¨å„ç§å•†ä¸šæœºä¼šï¼Œéç†æ€§è®©åˆ›ä¸šå…¬å¸é”™è¿‡è¿™äº›æœºä¼šã€‚ä¸è¦éç†æ€§ï¼Œè¦éå¸¸ç†æ€§ã€‚</p>
<p>22.äº’è”ç½‘è¡Œä¸šå¾€å¾€æ˜¯ Winner Takes Allï¼ˆèµ¢å®¶é€šåƒï¼‰ï¼Œå³ä½¿æ˜¯ä¼ ç»Ÿè¡Œä¸šä¹Ÿå¾€å¾€æ˜¯120%çš„åŠªåŠ›çš„äººè·å¾—200%çš„å›æŠ¥ã€‚è¿™ä¸ªæ˜¯å¯ä»¥ç¤¾ä¼šæœ‰åˆ©çš„ï¼Œç¤¾ä¼šéœ€è¦æ¿€åŠ±é¡¶å°–ã€æè‡´ã€åˆ›æ–°æ¥å¸¦åŠ¨ç¤¾ä¼šå‘å±•ã€‚æ‰€ä»¥æ¯å¤©å‡ºé—¨å‰é—®é—®è‡ªå·±å¦‚ä½•æ‰èƒ½å…¨åŠ›ä»¥èµ´äº†åšåˆ°æ°å‡ºã€‚</p>
<p>23.æˆ˜ç•¥å¾ˆé‡è¦ï¼Œä½†æ˜¯å›¢é˜Ÿä¹Ÿç›¸å½“é‡è¦ï¼Œæˆ‘è‡ªå·±æœ‰åˆ‡èº«ä½“ä¼šçš„ã€‚é…·è®¯å’Œå»å“ªå„¿ç«äº‰ï¼Œæ–¹å‘å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯å·®è·è¶Šæ¥è¶Šå¤§ã€‚å½“å¹´æµ·å†…å’Œå¼€å¿ƒç«äº‰ï¼Œå¯¹å¼€å¿ƒçš„æ•°æ®äº§å“ä¹Ÿå¾ˆäº†è§£ï¼Œå¯æƒœå°±æ˜¯çœ¼çççœ‹ç€å¯¹æ‰‹ä»äº§å“åˆ°æ¨å¹¿ä¸Šçš„èŠ‚èŠ‚èƒœåˆ©ã€‚å›åˆ°ç°åœ¨å›¢è´­ç½‘ç«™ï¼Œæ¨¡å¼éå¸¸ç®€å•ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—¨æ§›ï¼Œä½†æ˜¯ä¹Ÿèƒ½æ‹‰å¼€è¿™ä¹ˆå¤§çš„å·®è·ã€‚</p>
<p>24.ä¸­åˆè§åˆ°äº†ä¸€ä¸ªåœ¨åšéŸ³é¢‘ä¿¡æ¯å¤„ç†çš„å¾ˆæœ‰æ„æ€çš„å›¢é˜Ÿï¼Œæˆ‘ç›¸ä¿¡ä¿¡æ¯çš„èšåˆã€æ£€ç´¢ã€å…³è”ã€æ¨èæœ‰å¾ˆå¤§çš„ç©ºé—´ã€‚</p>
<p>25.æ¨¡å¼ã€æ–¹å‘ã€æˆ˜ç•¥æçš„å¾ˆå¤šï¼Œä½†æ˜¯è®¸å¤šå…¬å¸å…¶å®æ­»åœ¨éå¸¸é‡è¦ä½†æ˜¯å®¹æ˜“è¢«å¿½ç•¥çš„åŸºç¡€ç‚¹æˆ–ç»†èŠ‚ä¸Šã€‚</p>
<p>26.æ¯å¤©åšæŒæŠ½çœ‹å¹¶è·Ÿè¸ª10æ¡ç”¨æˆ·åé¦ˆï¼Œé¿å…é—®é¢˜ç–å¿½ã€‚</p>
<p>27.äº¬ä¸œå•†åŸâ€œä¸ä¸Šæ¥¼â€çš„åšæ³•å…¶å®åœ¨å¾ˆå¤šè¡Œä¸šéƒ½ç”¨è¿‡ï¼Œæ¯”å¦‚ä¸è®¾å¯¼è´­ï¼Œä¸æ”¶æ¡Œå­ï¼Œä¸è´Ÿè´£å®‰è£…ï¼Œè¿™ç§åšå‡æ³•éå¸¸æ­£ç¡®å’Œè‡ªä¿¡ã€‚å­¦ä¹ ã€‚</p>
<p>28.åˆšåˆšåšå®Œç”¨æˆ·å¯ç”¨æ€§æµ‹è¯•ï¼Œå‘ç°å¾ˆå¤šé—®é¢˜ã€‚å¯ç”¨æ€§æµ‹è¯•æ˜¯è®©å›¢é˜Ÿè¿‘è·ç¦»å®¢è§‚ç»†è‡´è§‚å¯Ÿç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œå‘ç°å›¢é˜Ÿåœ¨å·¥ä½œæœŸé—´æƒ³å½“ç„¶æˆ–è€…å› ä¸ºç†Ÿæ‚‰è€Œå¿½ç•¥çš„é—®é¢˜ã€‚åˆ›ä¸šè¿‡ç¨‹ä¸­å‡ºç°æ„¿æœ›å¼æ€è€ƒå¹¶è‡ªæˆ‘å¼ºåŒ–ï¼Œæ˜¯æˆ‘æ—¶æ—¶æé†’è‡ªå·±é¿å…çš„ã€‚</p>
<p>29.åˆ›ä¸šå…¬å¸çš„å¸¸è§é—®é¢˜ï¼šæŠ€æœ¯æ€¨äº§å“ã€äº§å“æ€¨æˆ˜ç•¥ã€æˆ˜ç•¥æ€¨å¸‚åœºã€‚ä½†æ˜¯å¾€å¾€è¿™ç§æƒ…å†µçš„å…¬å¸æŠ€æœ¯äº§å“ã€äº§å“ã€äº§å“éƒ½åšçš„ä¸æ€ä¹ˆæ ·ã€‚</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>å¼ ä¸€é¸£</tag>
      </tags>
  </entry>
  <entry>
    <title>éäººåŠ›èµ„æºç»ç†çš„äººåŠ›èµ„æºç®¡ç†</title>
    <url>/2022/03/24/thought/fei-ren-li-zi-yuan-jing-li-de-ren-li-zi-yuan-guan-li/</url>
    <content><![CDATA[<h1 id="ä¸€ã€äººåŠ›èµ„æºç®¡ç†çš„æŠ€å·§"><a href="#ä¸€ã€äººåŠ›èµ„æºç®¡ç†çš„æŠ€å·§" class="headerlink" title="ä¸€ã€äººåŠ›èµ„æºç®¡ç†çš„æŠ€å·§"></a>ä¸€ã€äººåŠ›èµ„æºç®¡ç†çš„æŠ€å·§</h1><p>äººåŠ›èµ„æºç®¡ç†çš„æ ¸å¿ƒï¼šé€‰ã€è‚²ã€ç”¨ã€ç•™</p>
<h2 id="1-1-äººåŠ›æ—¥å¸¸èµ„æºç®¡ç†ï¼ˆHRMï¼‰"><a href="#1-1-äººåŠ›æ—¥å¸¸èµ„æºç®¡ç†ï¼ˆHRMï¼‰" class="headerlink" title="1.1 äººåŠ›æ—¥å¸¸èµ„æºç®¡ç†ï¼ˆHRMï¼‰"></a>1.1 äººåŠ›æ—¥å¸¸èµ„æºç®¡ç†ï¼ˆHRMï¼‰</h2><ul>
<li>æ‹›è˜ä¸é€‰æï¼ˆStaffingï¼‰</li>
<li>è–ªé…¬ä¸ç¦åˆ©ï¼ˆC&amp;Bï¼‰</li>
<li>å‘˜å·¥å…³ç³»ç®¡ç†ï¼ˆEmployee Relationsï¼‰</li>
<li>ç»©æ•ˆç®¡ç†ï¼ˆPerformance Managementï¼‰</li>
<li>äººåŠ›èµ„æºç”µå­åŒ–ç®¡ç†ï¼ˆE-HRï¼‰</li>
</ul>
<h2 id="1-2-äººåŠ›èµ„æºç®¡ç†è°æ¥åšï¼Ÿ"><a href="#1-2-äººåŠ›èµ„æºç®¡ç†è°æ¥åšï¼Ÿ" class="headerlink" title="1.2 äººåŠ›èµ„æºç®¡ç†è°æ¥åšï¼Ÿ"></a>1.2 äººåŠ›èµ„æºç®¡ç†è°æ¥åšï¼Ÿ</h2><ol>
<li>æ‰€æœ‰æœ‰ä¸‹è¿°çš„äººéƒ½æ˜¯å…¬å¸çš„äººåŠ›èµ„æºç®¡ç†è€…</li>
<li>äººåŠ›èµ„æºéƒ¨é—¨è´Ÿè´£æä¾›æœ‰åŠ›å·¥å…·ååŠ©ç®¡ç†äººåŠ›èµ„æº</li>
<li>å…¬å¸è€å¤§å°±æ˜¯é¦–å¸­äººåŠ›èµ„æºç®¡ç†è€…</li>
<li>äººåŠ›èµ„æºç®¡ç†æˆè´¥å…³é”®<strong>ä¸­å±‚ç®¡ç†è€…</strong></li>
</ol>
<h1 id="äºŒã€é€‰æå®æ“ç¯‡"><a href="#äºŒã€é€‰æå®æ“ç¯‡" class="headerlink" title="äºŒã€é€‰æå®æ“ç¯‡"></a>äºŒã€é€‰æå®æ“ç¯‡</h1><ul>
<li>ä¸€æ…¢ï¼šæ¸…ç†æˆå¹´äººåœ¨é€‰ææ–¹é¢çš„å®šå¼&#x2F;åè§</li>
<li>äºŒæ…¢ï¼šçœ‹çœ‹æ‰€æ‹›å²—ä½éœ€è¦ä»€ä¹ˆç´ è´¨</li>
<li>ä¸‰é€šè¿‡: é€šè¿‡è¡Œä¸ºé¢è¯•æ³•çœ‹äººä¸èµ°çœ¼</li>
<li>æˆ‘æ€æ ·ç»¼åˆè¯„ä¼°å€™é€‰äººï¼Ÿ</li>
</ul>
<h2 id="2-1-ä¸€æ…¢ï¼šæ¸…ç†æˆå¹´äººåœ¨é€‰ææ–¹é¢çš„å®šå¼-åè§"><a href="#2-1-ä¸€æ…¢ï¼šæ¸…ç†æˆå¹´äººåœ¨é€‰ææ–¹é¢çš„å®šå¼-åè§" class="headerlink" title="2.1 ä¸€æ…¢ï¼šæ¸…ç†æˆå¹´äººåœ¨é€‰ææ–¹é¢çš„å®šå¼&#x2F;åè§"></a>2.1 ä¸€æ…¢ï¼šæ¸…ç†æˆå¹´äººåœ¨é€‰ææ–¹é¢çš„å®šå¼&#x2F;åè§</h2><ul>
<li>å¯¹ä¸€äº›äºº&#x2F;äº‹çš„åˆ»æ¿å°è±¡<br>1ã€å¹´é¾„<br>2ã€æ€§åˆ«<br>3ã€å­¦ç”Ÿä¼šå¹²éƒ¨</li>
<li>è¯•å›¾å¯»æ‰¾â€œè¶…äººâ€</li>
<li>æ ¡å›­æ‹›è˜å¿½ç•¥åº”å±Šç”Ÿæƒ…å•†å’Œé€†å•†</li>
</ul>
<h2 id="2-2-äºŒæ…¢ï¼šçœ‹çœ‹æ‰€æ‹›å²—ä½éœ€è¦ä»€ä¹ˆç´ è´¨"><a href="#2-2-äºŒæ…¢ï¼šçœ‹çœ‹æ‰€æ‹›å²—ä½éœ€è¦ä»€ä¹ˆç´ è´¨" class="headerlink" title="2.2 äºŒæ…¢ï¼šçœ‹çœ‹æ‰€æ‹›å²—ä½éœ€è¦ä»€ä¹ˆç´ è´¨"></a>2.2 äºŒæ…¢ï¼šçœ‹çœ‹æ‰€æ‹›å²—ä½éœ€è¦ä»€ä¹ˆç´ è´¨</h2><ul>
<li>ç®€å•å·¥ä½œåˆ†æâ€”â€”ä»–ä¸Šç­åè¦åšä»€ä¹ˆ</li>
<li>æç‚¼å…³é”®äº‹ä»¶â€”â€”è¦åšçš„å·¥ä½œä¸­æœ€å›°éš¾çš„æ˜¯ä»€ä¹ˆ</li>
<li>ç¡®å®šèƒœä»»æ ¸å¿ƒç´ è´¨â€”â€”è¦å…‹æœæœ€å›°éš¾çš„äº‹éœ€è¦ä»€ä¹ˆç´ è´¨</li>
</ul>
<h2 id="2-3-ä¸‰é€šè¿‡-é€šè¿‡è¡Œä¸ºé¢è¯•æ³•çœ‹äººä¸èµ°çœ¼"><a href="#2-3-ä¸‰é€šè¿‡-é€šè¿‡è¡Œä¸ºé¢è¯•æ³•çœ‹äººä¸èµ°çœ¼" class="headerlink" title="2.3 ä¸‰é€šè¿‡: é€šè¿‡è¡Œä¸ºé¢è¯•æ³•çœ‹äººä¸èµ°çœ¼"></a>2.3 ä¸‰é€šè¿‡: é€šè¿‡è¡Œä¸ºé¢è¯•æ³•çœ‹äººä¸èµ°çœ¼</h2><p>STARè¡Œä¸ºé¢è¯•æ³•ï¼šå¤šé—®è¿‡å»ï¼Œå°‘é—®å°†æ¥</p>
<ul>
<li>æƒ…æ™¯ï¼šSituation</li>
<li>ç›®æ ‡&#x2F;ä»»åŠ¡: Target&#x2F;Task</li>
<li>è¡ŒåŠ¨ï¼šAction</li>
<li>ç»“æœï¼šResult</li>
</ul>
<h1 id="ä¸‰ã€è‚²æ‰å®æ“ç¯‡"><a href="#ä¸‰ã€è‚²æ‰å®æ“ç¯‡" class="headerlink" title="ä¸‰ã€è‚²æ‰å®æ“ç¯‡"></a>ä¸‰ã€è‚²æ‰å®æ“ç¯‡</h1><ul>
<li>åŸ¹è®­ç¯‡ï¼šä¸€ä¸ªä¸­å¿ƒä¸ä¸¤ä¸ªåŸºæœ¬ç‚¹</li>
<li>è¾…å¯¼ç¯‡ï¼šåšå‘˜å·¥çš„æœ€ä½³æ•™ç»ƒ</li>
<li>åŸ¹è®­ç¯‡ï¼šä¸å…¬å¸åŒæˆé•¿çš„4ç§è§„åˆ’æ–¹å¼</li>
</ul>
<h2 id="3-1-åŸ¹è®­ç¯‡ï¼šä¸€ä¸ªä¸­å¿ƒä¸ä¸¤ä¸ªåŸºæœ¬ç‚¹"><a href="#3-1-åŸ¹è®­ç¯‡ï¼šä¸€ä¸ªä¸­å¿ƒä¸ä¸¤ä¸ªåŸºæœ¬ç‚¹" class="headerlink" title="3.1 åŸ¹è®­ç¯‡ï¼šä¸€ä¸ªä¸­å¿ƒä¸ä¸¤ä¸ªåŸºæœ¬ç‚¹"></a>3.1 åŸ¹è®­ç¯‡ï¼šä¸€ä¸ªä¸­å¿ƒä¸ä¸¤ä¸ªåŸºæœ¬ç‚¹</h2><p>ä¸€ä¸ªä¸­å¿ƒï¼šå‘˜å·¥<br>ç¬¬ä¸€ä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­éœ€æ±‚åˆ†æ<br>ç¬¬äºŒä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­æ•ˆæœè¿½è¸ª</p>
<h3 id="ç¬¬ä¸€ä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­éœ€æ±‚åˆ†æ"><a href="#ç¬¬ä¸€ä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­éœ€æ±‚åˆ†æ" class="headerlink" title="ç¬¬ä¸€ä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­éœ€æ±‚åˆ†æ"></a>ç¬¬ä¸€ä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­éœ€æ±‚åˆ†æ</h3><table>
<thead>
<tr>
<th>åˆ†æ</th>
<th>ç›®çš„</th>
</tr>
</thead>
<tbody><tr>
<td>ç»„ç»‡åˆ†æ</td>
<td>å†³å®šç»„ç»‡ç§å“ªé‡Œè¦åŸ¹è®­</td>
</tr>
<tr>
<td>ä»»åŠ¡åˆ†æ</td>
<td>å†³å®šåŸ¹è®­ä»€ä¹ˆå†…å®¹</td>
</tr>
<tr>
<td>äººå‘˜åˆ†æ</td>
<td>å†³å®šè°è¯¥æ¥å—åŸ¹è®­</td>
</tr>
</tbody></table>
<h3 id="ç¬¬äºŒä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­æ•ˆæœè¯„ä¼°"><a href="#ç¬¬äºŒä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­æ•ˆæœè¯„ä¼°" class="headerlink" title="ç¬¬äºŒä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­æ•ˆæœè¯„ä¼°"></a>ç¬¬äºŒä¸ªåŸºæœ¬ç‚¹ï¼šåŸ¹è®­æ•ˆæœè¯„ä¼°</h3><p>ååº”ï¼šé’ˆå¯¹å­¦å‘˜å¯¹è¯¾ç¨‹åŠå­¦ä¹ è¿‡ç¨‹çš„æ»¡æ„åº¦è¿›è¡Œè¯„ä¼°ã€‚<br>å­¦ä¹ ï¼šé’ˆå¯¹å­¦å‘˜å®Œæˆè¯¾ç¨‹åï¼Œæ‰€ä¿ç•™çš„å­¦ä¹ æˆæ•ˆè¿›è¡Œè¯„ä¼°ã€‚<br>è¡Œä¸ºï¼šé’ˆå¯¹å­¦å‘˜å›å²—ä½åï¼Œå…¶è¡Œä¸ºæˆ–ç»©æ•ˆæ˜¯å¦å› åŸ¹è®­è€Œæœ‰æ”¹å˜è¿›è¡Œè¯„ä¼°ã€‚<br>ç»“æœï¼šé’ˆå¯¹åŸ¹è®­çš„æ•´ä½“æŠ•èµ„æŠ¥é…¬ç‡è¿›è¡Œè¯„ä¼°ã€‚</p>
<h2 id="3-2-è¾…å¯¼ç¯‡ï¼šåšå‘˜å·¥çš„æœ€ä½³æ•™ç»ƒ"><a href="#3-2-è¾…å¯¼ç¯‡ï¼šåšå‘˜å·¥çš„æœ€ä½³æ•™ç»ƒ" class="headerlink" title="3.2 è¾…å¯¼ç¯‡ï¼šåšå‘˜å·¥çš„æœ€ä½³æ•™ç»ƒ"></a>3.2 è¾…å¯¼ç¯‡ï¼šåšå‘˜å·¥çš„æœ€ä½³æ•™ç»ƒ</h2><p>æ¥å—ï¼šè®¤è¯†åˆ°åŸ¹è®­é‡è¦ï¼Œå…è®¸å‘˜å·¥å»åŸ¹è®­<br>é¼“åŠ±ï¼šè°ƒæ•´å·¥ä½œå®‰æ’é¼“åŠ±å‘˜å·¥å‚åŠ åŸ¹è®­<br>å¼ºåŒ–ï¼šåŸ¹è®­å®Œä¸å…¶æ¢è®¨å¦‚ä½•æ”¯æŒå…¶æ–°æŠ€èƒ½<br>ç»™æœºä¼šï¼šå‘˜å·¥å­¦åˆ°æ–°æŠ€èƒ½åæœ‰å®è·µæœºä¼š<br>æ•™ç»ƒï¼šä½œä¸ºæ•™ç»ƒå…¨ç¨‹è¾…å¯¼</p>
<h2 id="3-3-åŸ¹è®­ç¯‡ï¼šä¸å…¬å¸åŒæˆé•¿çš„4ç§è§„åˆ’æ–¹å¼"><a href="#3-3-åŸ¹è®­ç¯‡ï¼šä¸å…¬å¸åŒæˆé•¿çš„4ç§è§„åˆ’æ–¹å¼" class="headerlink" title="3.3 åŸ¹è®­ç¯‡ï¼šä¸å…¬å¸åŒæˆé•¿çš„4ç§è§„åˆ’æ–¹å¼"></a>3.3 åŸ¹è®­ç¯‡ï¼šä¸å…¬å¸åŒæˆé•¿çš„4ç§è§„åˆ’æ–¹å¼</h2><p>ä¸ªäººèŒä¸šè§„åˆ’ï¼Œç¡®ä¿ä¸ªäººåœ¨ç»„ç»‡ç§çš„è¿›æ­¥ï¼Œå…¶è¡¨ç°å’Œæ½œåŠ›ç¬¦åˆç»„ç»‡çš„éœ€è¦ï¼š<br>1ã€å‡èŒ<br>2ã€è½®å²—<br>3ã€å·¥ä½œæ‰©å¤§åŒ–<br>4ã€å·¥ä½œä¸°å¯ŒåŒ–</p>
<h1 id="å››ã€ç”¨æ‰ç¯‡â€”â€”ç»©æ•ˆç®¡ç†"><a href="#å››ã€ç”¨æ‰ç¯‡â€”â€”ç»©æ•ˆç®¡ç†" class="headerlink" title="å››ã€ç”¨æ‰ç¯‡â€”â€”ç»©æ•ˆç®¡ç†"></a>å››ã€ç”¨æ‰ç¯‡â€”â€”ç»©æ•ˆç®¡ç†</h1><h2 id="4-1-å‘˜å·¥ç»©æ•ˆä¸ºä»€ä¹ˆä¸é«˜ï¼Ÿ"><a href="#4-1-å‘˜å·¥ç»©æ•ˆä¸ºä»€ä¹ˆä¸é«˜ï¼Ÿ" class="headerlink" title="4.1 å‘˜å·¥ç»©æ•ˆä¸ºä»€ä¹ˆä¸é«˜ï¼Ÿ"></a>4.1 å‘˜å·¥ç»©æ•ˆä¸ºä»€ä¹ˆä¸é«˜ï¼Ÿ</h2><h3 id="ç»©æ•ˆåé¦ˆåé¢"><a href="#ç»©æ•ˆåé¦ˆåé¢" class="headerlink" title="ç»©æ•ˆåé¦ˆåé¢"></a>ç»©æ•ˆåé¦ˆåé¢</h3><ul>
<li>æ— åé¦ˆæˆ–æ— æ•ˆåé¦ˆ</li>
</ul>
<h3 id="å¹³æ—¶çš„é˜»ç¢"><a href="#å¹³æ—¶çš„é˜»ç¢" class="headerlink" title="å¹³æ—¶çš„é˜»ç¢"></a>å¹³æ—¶çš„é˜»ç¢</h3><ul>
<li>èº«ä½“ç”Ÿç—…</li>
<li>ç²¾ç¥å‹åŠ›å¤§</li>
<li>æ„Ÿæƒ…å—æŒ«</li>
<li>è¢«è¦æ±‚åœ¨åŒä¸€æ—¶é—´å®Œæˆç›¸çŸ›ç›¾çš„å·¥ä½œ</li>
<li>ç¼ºä¹è¶³å¤Ÿçš„èµ„æºæ¥åšäº‹</li>
</ul>
<h3 id="ç»©æ•ˆæ ‡å‡†æ–¹é¢"><a href="#ç»©æ•ˆæ ‡å‡†æ–¹é¢" class="headerlink" title="ç»©æ•ˆæ ‡å‡†æ–¹é¢"></a>ç»©æ•ˆæ ‡å‡†æ–¹é¢</h3><ul>
<li>ç»©æ•ˆæ ‡å‡†ä¸é‡åŒ–</li>
<li>æ²¡è·Ÿå‘˜å·¥æ²Ÿé€šè€Œç›´æ¥æ´¾æ´»</li>
<li>ç»©æ•ˆæ ‡å‡†å¤ªé«˜</li>
</ul>
<h3 id="ç»©æ•ˆåæœæ–¹é¢"><a href="#ç»©æ•ˆåæœæ–¹é¢" class="headerlink" title="ç»©æ•ˆåæœæ–¹é¢"></a>ç»©æ•ˆåæœæ–¹é¢</h3><ul>
<li>è€ƒå®Œåæ²¡æœ‰é‡å¥–é‡ç½š</li>
<li>ç»©æ•ˆåæœä¸åˆºæ¿€å‘˜å·¥è¡Œä¸º</li>
</ul>
<h3 id="å‘˜å·¥æœ¬èº«çš„æŠ€èƒ½æ–¹é¢"><a href="#å‘˜å·¥æœ¬èº«çš„æŠ€èƒ½æ–¹é¢" class="headerlink" title="å‘˜å·¥æœ¬èº«çš„æŠ€èƒ½æ–¹é¢"></a>å‘˜å·¥æœ¬èº«çš„æŠ€èƒ½æ–¹é¢</h3><ul>
<li>å‘˜å·¥ä¸çŸ¥é“æ€æ ·åš</li>
</ul>
<h2 id="4-2-å¦‚ä½•è®¾å®šé‡åŒ–æŒ‡æ ‡ï¼Œå¹¶åˆ†è§£ç»™éƒ¨é—¨"><a href="#4-2-å¦‚ä½•è®¾å®šé‡åŒ–æŒ‡æ ‡ï¼Œå¹¶åˆ†è§£ç»™éƒ¨é—¨" class="headerlink" title="4.2 å¦‚ä½•è®¾å®šé‡åŒ–æŒ‡æ ‡ï¼Œå¹¶åˆ†è§£ç»™éƒ¨é—¨?"></a>4.2 å¦‚ä½•è®¾å®šé‡åŒ–æŒ‡æ ‡ï¼Œå¹¶åˆ†è§£ç»™éƒ¨é—¨?</h2><ul>
<li>Specific: ç‰¹å®šçš„</li>
<li>Measurableï¼šå¯è¡¡é‡çš„</li>
<li>Agreedï¼šåŒæ–¹åŒæ„çš„</li>
<li>Realisticï¼šç°å®çš„</li>
<li>Time-bondï¼šæœ‰æ—¶é—´é™åˆ¶çš„</li>
</ul>
<blockquote>
<h3 id="ç»©æ•ˆç›®æ ‡"><a href="#ç»©æ•ˆç›®æ ‡" class="headerlink" title="ç»©æ•ˆç›®æ ‡"></a>ç»©æ•ˆç›®æ ‡</h3></blockquote>
<ul>
<li>å¯¹è¦è¾¾æˆçš„ç»“æœçš„ä¸€ä¸ªè¡¨è¿°</li>
<li>æ›´é€‚äºç»ç†ä»¬å’Œä¸“ä¸šå‘˜å·¥ç­‰æ¶‰åŠä¸ªäººé¡¹ç›®çš„å·¥ä½œ</li>
</ul>
<blockquote>
<h3 id="ç»©æ•ˆæ ‡å‡†"><a href="#ç»©æ•ˆæ ‡å‡†" class="headerlink" title="ç»©æ•ˆæ ‡å‡†"></a>ç»©æ•ˆæ ‡å‡†</h3></blockquote>
<ul>
<li>æ˜¯ä¸€ç§å»¶ç»­çš„ï¼Œé¡»ä¸€æ¬¡åˆä¸€æ¬¡éµå®ˆçš„å‡†åˆ™</li>
<li>æ›´é€‚ç”¨äºä»äº‹æ—¥å¸¸éœ€è¦åŠé‡å¤æ€§ä½œä¸šçš„å·¥ä½œ</li>
</ul>
<h2 id="4-3-å»ºè®¾æ€§åé¦ˆæ–¹æ³•"><a href="#4-3-å»ºè®¾æ€§åé¦ˆæ–¹æ³•" class="headerlink" title="4.3 å»ºè®¾æ€§åé¦ˆæ–¹æ³•"></a>4.3 å»ºè®¾æ€§åé¦ˆæ–¹æ³•</h2><p>â€œæ±‰å ¡â€åŸåˆ™</p>
<ul>
<li>å…ˆè¡¨æ‰¬ç‰¹å®šçš„æˆå°±ï¼Œç»™äºˆçœŸå¿ƒçš„è‚¯å®š</li>
<li>ç„¶åæå‡ºéœ€è¦æ”¹è¿›çš„â€œç‰¹å®šâ€çš„è¡Œä¸ºè¡¨ç°</li>
<li>æœ€åè‚¯å®šå’Œæ”¯æŒç»“æœ</li>
</ul>
<h2 id="4-4-å¦‚ä½•å‹å¥½åœ°ç»“æŸé¢è°ˆ"><a href="#4-4-å¦‚ä½•å‹å¥½åœ°ç»“æŸé¢è°ˆ" class="headerlink" title="4.4 å¦‚ä½•å‹å¥½åœ°ç»“æŸé¢è°ˆ"></a>4.4 å¦‚ä½•å‹å¥½åœ°ç»“æŸé¢è°ˆ</h2><ol>
<li>ç¡®è®¤å‘˜å·¥ç†è§£ä½ çš„æ¯ä¸€ä¸ªè¯„ä¼°</li>
<li>å¯ä»¥è¯·å‘˜å·¥åœ¨é¢è°ˆè®°å½•ä¸Šç­¾å­—ç¡®è®¤</li>
<li>æ°¸è¿œä»¥ç§¯æçš„è¨€è°ˆç»“æŸè°ˆè¯</li>
</ol>
<p><font clolor="#ff0000">ï¼ï¼ï¼ä¸è¦è½»æ˜“è®¸è¯ºä½ ä¸ç¡®è®¤çš„äº‹</font></p>
<h1 id="äº”ã€ç•™æ‰ç¯‡â€”â€”å¤šç”¨â€œè–ªâ€ä¸å¦‚å¤šç”¨â€œå¿ƒâ€"><a href="#äº”ã€ç•™æ‰ç¯‡â€”â€”å¤šç”¨â€œè–ªâ€ä¸å¦‚å¤šç”¨â€œå¿ƒâ€" class="headerlink" title="äº”ã€ç•™æ‰ç¯‡â€”â€”å¤šç”¨â€œè–ªâ€ä¸å¦‚å¤šç”¨â€œå¿ƒâ€"></a>äº”ã€ç•™æ‰ç¯‡â€”â€”å¤šç”¨â€œè–ªâ€ä¸å¦‚å¤šç”¨â€œå¿ƒâ€</h1><h2 id="5-1-æ¿€åŠ±æ˜¯ç®¡ç†ä¸­çš„æ ¸å¿ƒé—®é¢˜"><a href="#5-1-æ¿€åŠ±æ˜¯ç®¡ç†ä¸­çš„æ ¸å¿ƒé—®é¢˜" class="headerlink" title="5.1 æ¿€åŠ±æ˜¯ç®¡ç†ä¸­çš„æ ¸å¿ƒé—®é¢˜"></a>5.1 æ¿€åŠ±æ˜¯ç®¡ç†ä¸­çš„æ ¸å¿ƒé—®é¢˜</h2><blockquote>
<p><font color="#ff0000">å±æœºæ¿€åŠ±</font>: è´Ÿå¼ºåŒ–ï¼Œä¼ä¸šå¿…é¡»è¦åšçš„äº‹    </p>
</blockquote>
<ol>
<li>ç‰©è´¨æ¿€åŠ±</li>
<li>ç²¾ç¥æ¿€åŠ±</li>
<li>åŸ¹è®­æ¿€åŠ±</li>
<li>ç›®æ ‡æ¿€åŠ±</li>
<li>å‚ä¸æ¿€åŠ±</li>
<li>æƒ…æ„Ÿæ¿€åŠ±</li>
<li>ä¿¡ä»»æ¿€åŠ±</li>
<li>æ™‹å‡æ¿€åŠ±</li>
<li>è£èª‰æ¿€åŠ±</li>
<li>æ¦œæ ·æ¿€åŠ±</li>
</ol>
<h2 id="5-2-Maslow-é©¬æ–¯æ´›â€”â€”éœ€æ±‚å±‚æ¬¡ç†è®º"><a href="#5-2-Maslow-é©¬æ–¯æ´›â€”â€”éœ€æ±‚å±‚æ¬¡ç†è®º" class="headerlink" title="5.2 Maslow é©¬æ–¯æ´›â€”â€”éœ€æ±‚å±‚æ¬¡ç†è®º"></a>5.2 Maslow é©¬æ–¯æ´›â€”â€”éœ€æ±‚å±‚æ¬¡ç†è®º</h2><h3 id="æ›´é€‚åˆæ¿€åŠ±æ ¸å¿ƒå‘˜å·¥-20"><a href="#æ›´é€‚åˆæ¿€åŠ±æ ¸å¿ƒå‘˜å·¥-20" class="headerlink" title="æ›´é€‚åˆæ¿€åŠ±æ ¸å¿ƒå‘˜å·¥(20%)"></a><font color="#ff000">æ›´é€‚åˆæ¿€åŠ±æ ¸å¿ƒå‘˜å·¥</font>(20%)</h3><ol>
<li>ç”Ÿç†éœ€æ±‚</li>
<li>å®‰å…¨éœ€æ±‚</li>
<li>å½’å±éœ€æ±‚</li>
<li>å°Šé‡éœ€æ±‚</li>
<li>è‡ªæˆ‘å®ç°éœ€æ±‚</li>
</ol>
<h2 id="5-3-ä¸‰ç§é«˜ç®¡é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•"><a href="#5-3-ä¸‰ç§é«˜ç®¡é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•" class="headerlink" title="5.3 ä¸‰ç§é«˜ç®¡é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•"></a>5.3 ä¸‰ç§é«˜ç®¡é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•</h2><ol>
<li>åˆ¶åº¦æ¿€åŠ±â€”â€”è®©ä¼˜ç§€å‘˜å·¥ä¸ä¼—ä¸åŒ</li>
<li>èŒä¸šç”Ÿæ¶¯è§„åˆ’æ¿€åŠ±ï¼ˆå‡èŒï¼›è½®å²—ï¼›å·¥ä½œæ‰©å¤§åŒ–ï¼›å·¥ä½œä¸°å¯ŒåŒ–ï¼‰</li>
<li>ä¼ä¸šæ–‡åŒ–ç•™äºº</li>
</ol>
<h2 id="5-4-å››ç§ä¸­å±‚ç®¡ç†è€…é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•"><a href="#5-4-å››ç§ä¸­å±‚ç®¡ç†è€…é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•" class="headerlink" title="5.4 å››ç§ä¸­å±‚ç®¡ç†è€…é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•"></a>5.4 å››ç§ä¸­å±‚ç®¡ç†è€…é€‚ç”¨çš„ä¸ªäººæ¿€åŠ±æ–¹æ³•</h2><ol>
<li>æœŸæœ›ç•™äºº-ç½—æ£®å¡”å°”æ•ˆåº”â€”â€”æˆ‘çŸ¥é“ä½ å¯ä»¥çš„</li>
<li>å·¥ä½œæ‰©å¤§åŒ–ä¸ä¸°å¯ŒåŒ–â€”â€”è®©å‘˜å·¥æœ‰æœºä¼šè¿›æ­¥ï¼ˆå·¥ä½œè½®æ¢ï¼Œå·¥ä½œæ‰©å¤§åŒ–ï¼Œå·¥ä½œä¸°å¯ŒåŒ–ï¼‰</li>
<li>å¾—äººå¿ƒè€…å¾—å¤©ä¸‹â€”â€”æ„Ÿæƒ…æ¿€åŠ±</li>
<li>å·§ç”¨å›¢ä½“å‹åŠ›â€”â€”å›¢é˜Ÿæ¿€åŠ±ï¼ˆç¾¤ä½“åŠ¨åŠ›å­¦ï¼‰</li>
</ol>
<h1 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h1><p>äººåŠ›èµ„æºç®¡ç†å¾—æ ¸å¿ƒäº‹ï¼šé€‰ã€è‚²ã€ç”¨ã€ç•™ã€‚</p>
<ul>
<li>é€‰ï¼šè¡Œä¸ºé¢è¯•æ³•ç»“åˆSTARæ³•åˆ™</li>
<li>è‚²ï¼šå›´ç»•å‘˜å·¥è¿™ä¸ªæ ¸å¿ƒï¼Œåˆ†æè¦åŸ¹è®­ä»€ä¹ˆï¼Œè¿½è¸ªåŸ¹è®­æ•ˆæœï¼Œåšå¥½å‘˜å·¥çš„å¸®ã€æ‰¶ã€å¸¦</li>
<li>ç”¨ï¼šåŸºäºSMARTæ³•åˆ™è®¾å®šé‡åŒ–ç›®æ ‡ï¼Œåšå¥½ç»©æ•ˆé¢è°ˆåŠåé¦ˆ</li>
<li>ç•™ï¼šè§‚å¯Ÿå‘˜å·¥å¾—éœ€æ±‚ï¼Œé‡‡ç”¨é€‚å½“å¾—æ¿€åŠ±æ–¹å¼</li>
</ul>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>äººåŠ›èµ„æºç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜æ•ˆæ‰§è¡Œä¸æŒç»­ä¼˜åŒ–</title>
    <url>/2024/05/16/thought/gao-xiao-zhi-xing-yu-chi-xu-you-hua/</url>
    <content><![CDATA[<h1 id="ä¸€ã€é«˜æ•ˆæ‰§è¡Œä¸æŒç»­ä¼˜åŒ–"><a href="#ä¸€ã€é«˜æ•ˆæ‰§è¡Œä¸æŒç»­ä¼˜åŒ–" class="headerlink" title="ä¸€ã€é«˜æ•ˆæ‰§è¡Œä¸æŒç»­ä¼˜åŒ–"></a>ä¸€ã€é«˜æ•ˆæ‰§è¡Œä¸æŒç»­ä¼˜åŒ–</h1><h2 id="1-1-ç‹¬ç«‹äººæ ¼"><a href="#1-1-ç‹¬ç«‹äººæ ¼" class="headerlink" title="1.1 ç‹¬ç«‹äººæ ¼"></a>1.1 ç‹¬ç«‹äººæ ¼</h2><ol>
<li>ç‹¬ç«‹æ‰¿æ‹…è´£ä»»</li>
<li>ç‹¬ç«‹åšå®ˆåŸåˆ™</li>
</ol>
<h2 id="1-2-ä»€ä¹ˆæ˜¯æ‰§è¡ŒåŠ›"><a href="#1-2-ä»€ä¹ˆæ˜¯æ‰§è¡ŒåŠ›" class="headerlink" title="1.2 ä»€ä¹ˆæ˜¯æ‰§è¡ŒåŠ›"></a>1.2 ä»€ä¹ˆæ˜¯æ‰§è¡ŒåŠ›</h2><p>ä»¥è§„åˆ™ä¸ºæ ‡æ³¨ï¼Œç¬¬ä¸€æ—¶é—´æŠŠç›®æ ‡å˜æˆç»“æœçš„è¡ŒåŠ¨ã€‚ </p>
<h2 id="1-3-é¢„è§ç»“æœçš„4Aå·¥å…·"><a href="#1-3-é¢„è§ç»“æœçš„4Aå·¥å…·" class="headerlink" title="1.3 é¢„è§ç»“æœçš„4Aå·¥å…·"></a>1.3 é¢„è§ç»“æœçš„4Aå·¥å…·</h2><p>1.ç›®æ ‡ï¼ˆAimï¼‰<br>2.æŒ‡æ ‡ï¼ˆAdvocacyï¼‰<br>3.è¡ŒåŠ¨æªæ–½ï¼ˆActionï¼‰<br>4.æ‰¿è¯ºï¼ˆAcceptanceï¼‰</p>
<h2 id="1-4-æ‰§è¡Œçš„æ˜¯ä¸‰ç§çŠ¶æ€"><a href="#1-4-æ‰§è¡Œçš„æ˜¯ä¸‰ç§çŠ¶æ€" class="headerlink" title="1.4 æ‰§è¡Œçš„æ˜¯ä¸‰ç§çŠ¶æ€"></a>1.4 æ‰§è¡Œçš„æ˜¯ä¸‰ç§çŠ¶æ€</h2><ul>
<li>æœºæ¢°æ‰§è¡Œï¼šåªçœ‹è¡Œä¸ºæ˜¯å¦å‘ç”Ÿ</li>
<li>çƒ­æƒ…æ‰§è¡Œï¼šçœ‹è¡Œä¸ºè´¨é‡å¦‚ä½•å»åš</li>
<li>åŒç†æ‰§è¡Œï¼šæŒ‰ç…§éœ€æ±‚å€’é€€å®æ–½</li>
</ul>
<h2 id="1-5-ä»»åŠ¡ä¸ç»“æœçš„ä¸‰å¤§åŒºåˆ«"><a href="#1-5-ä»»åŠ¡ä¸ç»“æœçš„ä¸‰å¤§åŒºåˆ«" class="headerlink" title="1.5 ä»»åŠ¡ä¸ç»“æœçš„ä¸‰å¤§åŒºåˆ«"></a>1.5 ä»»åŠ¡ä¸ç»“æœçš„ä¸‰å¤§åŒºåˆ«</h2><h3 id="ä»»åŠ¡æ˜¯ä¸‰äº‹"><a href="#ä»»åŠ¡æ˜¯ä¸‰äº‹" class="headerlink" title="ä»»åŠ¡æ˜¯ä¸‰äº‹"></a>ä»»åŠ¡æ˜¯ä¸‰äº‹</h3><ul>
<li>ä¾‹è¡Œå…¬äº‹ï¼šè¯¥èµ°çš„ç¨‹åºéƒ½èµ°äº†</li>
<li>å®Œæˆå·®äº‹ï¼šè¯¥åšçš„è¡ŒåŠ¨éƒ½åšäº†</li>
<li>æ•·è¡äº†äº‹ï¼šè¯¥å¹²çš„ä»»åŠ¡éƒ½å¹²äº†</li>
</ul>
<h3 id="ç»“æœæ˜¯ä¸‰æœ‰"><a href="#ç»“æœæ˜¯ä¸‰æœ‰" class="headerlink" title="ç»“æœæ˜¯ä¸‰æœ‰"></a>ç»“æœæ˜¯ä¸‰æœ‰</h3><ul>
<li>æœ‰æ—¶é—´ï¼šå‡¡äº‹æœ‰æœŸé™</li>
<li>æœ‰ä»·å€¼ï¼šå‡¡äº‹è¢«éœ€è¦</li>
<li>æœ‰è¯æ®ï¼šå‡¡äº‹èƒ½æ£€æŸ¥</li>
</ul>
<h1 id="äºŒã€å¦‚ä½•åšæ‰§è¡Œäººæ‰"><a href="#äºŒã€å¦‚ä½•åšæ‰§è¡Œäººæ‰" class="headerlink" title="äºŒã€å¦‚ä½•åšæ‰§è¡Œäººæ‰"></a>äºŒã€å¦‚ä½•åšæ‰§è¡Œäººæ‰</h1><h2 id="2-1-æ‰§è¡Œäººæ‰çš„ç‰¹ç‚¹"><a href="#2-1-æ‰§è¡Œäººæ‰çš„ç‰¹ç‚¹" class="headerlink" title="2.1 æ‰§è¡Œäººæ‰çš„ç‰¹ç‚¹"></a>2.1 æ‰§è¡Œäººæ‰çš„ç‰¹ç‚¹</h2><p>ç™¾åˆ†ç™¾è´£ä»»<br>1.å®¢æˆ·ã€é¢†å¯¼ã€åŒäº‹ã€å²—ä½</p>
<h2 id="2-2-æ‰§è¡Œå›¢é˜Ÿæ˜¯é‚£ä¸ªç»Ÿä¸€"><a href="#2-2-æ‰§è¡Œå›¢é˜Ÿæ˜¯é‚£ä¸ªç»Ÿä¸€" class="headerlink" title="2.2 æ‰§è¡Œå›¢é˜Ÿæ˜¯é‚£ä¸ªç»Ÿä¸€"></a>2.2 æ‰§è¡Œå›¢é˜Ÿæ˜¯é‚£ä¸ªç»Ÿä¸€</h2><ol>
<li>ç»Ÿä¸€æ€æƒ³ï¼šæŠŠéœ€æ±‚å’Œç›®æ ‡è¿›è¡Œç»“åˆ</li>
<li>ç»Ÿä¸€å£°éŸ³ï¼šå£°éŸ³ä¸€è‡´ï¼Œé¿å…æ‚éŸ³</li>
<li>ç»Ÿä¸€åŠ¨ä½œï¼šä»¥æ€æƒ³å’Œå£°éŸ³ç»Ÿä¸€ä¸ºå‰æ</li>
</ol>
<h2 id="2-3-ä¸»åŠ¨åé¦ˆçš„å…­å¤§æ—¶æœº"><a href="#2-3-ä¸»åŠ¨åé¦ˆçš„å…­å¤§æ—¶æœº" class="headerlink" title="2.3 ä¸»åŠ¨åé¦ˆçš„å…­å¤§æ—¶æœº"></a>2.3 ä¸»åŠ¨åé¦ˆçš„å…­å¤§æ—¶æœº</h2><ol>
<li>ä»»åŠ¡æ‰§è¡Œå®Œå</li>
<li>é˜¶æ®µæ€§ç»“æœå®Œæˆå</li>
<li>æ‰§è¡Œä¸­é‡åˆ°å›°éš¾éœ€è¦é¢†å¯¼æ”¯æŒ</li>
<li>æ‰§è¡Œä¸­é‡åˆ°æ›´å¥½çš„èµ„æºã€æœºä¼šã€ä¿¡æ¯</li>
<li>é¢†å¯¼æ ¼å¤–å…³æ³¨çš„ç¯èŠ‚å®Œæˆå</li>
<li>ä¾‹è¡Œåé¦ˆ</li>
</ol>
<h2 id="2-4-æ‰§è¡Œäººæ‰çš„ä¸‰å¤§ç´ å…»"><a href="#2-4-æ‰§è¡Œäººæ‰çš„ä¸‰å¤§ç´ å…»" class="headerlink" title="2.4 æ‰§è¡Œäººæ‰çš„ä¸‰å¤§ç´ å…»"></a>2.4 æ‰§è¡Œäººæ‰çš„ä¸‰å¤§ç´ å…»</h2><ol>
<li>æœä»</li>
<li>ä¸»åŠ¨</li>
<li>è‡ªå¾‹</li>
</ol>
<h2 id="2-5-å¦‚ä½•åŒºåˆ†ç´§æ€¥"><a href="#2-5-å¦‚ä½•åŒºåˆ†ç´§æ€¥" class="headerlink" title="2.5 å¦‚ä½•åŒºåˆ†ç´§æ€¥"></a>2.5 å¦‚ä½•åŒºåˆ†ç´§æ€¥</h2><ol>
<li>å¦‚æœç°åœ¨ä¸åšå°±ä¼šé”™è¿‡åšè¿™ä»¶äº‹çš„æœºä¼š</li>
</ol>
<h2 id="2-6-æ‰§è¡Œäººæ‰çš„è¡¨ç°"><a href="#2-6-æ‰§è¡Œäººæ‰çš„è¡¨ç°" class="headerlink" title="2.6 æ‰§è¡Œäººæ‰çš„è¡¨ç°"></a>2.6 æ‰§è¡Œäººæ‰çš„è¡¨ç°</h2><ul>
<li>è¯´åˆ°åšåˆ°ä¸å¹ç‰›</li>
<li>å†…çœåæ€ä¸å¤–æ±‚</li>
<li>ä¸»åŠ¨åé¦ˆä¸ä¾èµ–</li>
<li>å‡†æ—¶å‡†ç¡®ä¸ç­‰å¾…</li>
<li>éµå®ˆè§„çŸ©ä¸çŠ¹è±«</li>
<li>æ‰¿æ‹…è´£ä»»ä¸é€ƒé¿</li>
</ul>
<h1 id="ä¸‰ã€æ‰§è¡Œæµç¨‹ä¸‰æ®µè®º"><a href="#ä¸‰ã€æ‰§è¡Œæµç¨‹ä¸‰æ®µè®º" class="headerlink" title="ä¸‰ã€æ‰§è¡Œæµç¨‹ä¸‰æ®µè®º"></a>ä¸‰ã€æ‰§è¡Œæµç¨‹ä¸‰æ®µè®º</h1><ol>
<li>æ‰§è¡Œå‰ï¼šå¯¹</li>
<li>æ‰§è¡Œä¸­ï¼šå¿«</li>
<li>æ‰§è¡Œåï¼šå¥½</li>
</ol>
<h2 id="3-1-æ‰§è¡Œå‰çš„â€œä¸‰ç¡®â€"><a href="#3-1-æ‰§è¡Œå‰çš„â€œä¸‰ç¡®â€" class="headerlink" title="3.1 æ‰§è¡Œå‰çš„â€œä¸‰ç¡®â€"></a>3.1 æ‰§è¡Œå‰çš„â€œä¸‰ç¡®â€</h2><ul>
<li>ç¡®è®¤ï¼š4Wæ¨¡å‹ï¼ˆwhenã€whereã€whatã€whoï¼‰</li>
<li>ç¡®ä¿¡ï¼šå†³å¿ƒç¬¬ä¸€æˆè´¥ç¬¬äºŒ</li>
<li>ç¡®ä¿ï¼šæ€è€ƒå¦‚ä½•è¾¾æˆç›®æ ‡å’Œåº”å¯¹çªå‘æƒ…å†µ</li>
</ul>
<h2 id="3-2-æ‰§è¡Œä¸­çš„â€œä¸‰æ—¶â€"><a href="#3-2-æ‰§è¡Œä¸­çš„â€œä¸‰æ—¶â€" class="headerlink" title="3.2 æ‰§è¡Œä¸­çš„â€œä¸‰æ—¶â€"></a>3.2 æ‰§è¡Œä¸­çš„â€œä¸‰æ—¶â€</h2><ul>
<li>å³æ—¶ï¼šç«‹å³è¡ŒåŠ¨</li>
<li>åŠæ—¶ï¼šåŠæ—¶çº æ­£</li>
<li>é€‚æ—¶ï¼šé€‚æ—¶æ±‡æŠ¥</li>
</ul>
<h3 id="3-2-1-æ±‡æŠ¥äº”ä¸ªæµç¨‹"><a href="#3-2-1-æ±‡æŠ¥äº”ä¸ªæµç¨‹" class="headerlink" title="3.2.1 æ±‡æŠ¥äº”ä¸ªæµç¨‹"></a>3.2.1 æ±‡æŠ¥äº”ä¸ªæµç¨‹</h3><ol>
<li>è¯´ç»“æœ</li>
<li>æ‰¾åŸå› </li>
<li>æ‹¿ç­–ç•¥</li>
<li>è¦èµ„æº</li>
<li>åšæ‰¿è¯º</li>
</ol>
<h2 id="3-3-æ‰§è¡Œåçš„â€œä¸‰äº¤â€"><a href="#3-3-æ‰§è¡Œåçš„â€œä¸‰äº¤â€" class="headerlink" title="3.3 æ‰§è¡Œåçš„â€œä¸‰äº¤â€"></a>3.3 æ‰§è¡Œåçš„â€œä¸‰äº¤â€</h2><ul>
<li>äº¤ç»“æœ</li>
<li>äº¤æ€»ç»“</li>
<li>äº¤æƒ³æ³•</li>
</ul>
<h1 id="å››ã€æå‡æ‰§è¡ŒåŠ›çš„ä¸‰å¤§æ–¹æ³•"><a href="#å››ã€æå‡æ‰§è¡ŒåŠ›çš„ä¸‰å¤§æ–¹æ³•" class="headerlink" title="å››ã€æå‡æ‰§è¡ŒåŠ›çš„ä¸‰å¤§æ–¹æ³•"></a>å››ã€æå‡æ‰§è¡ŒåŠ›çš„ä¸‰å¤§æ–¹æ³•</h1><h2 id="æ–¹æ³•ä¸€ï¼šå¤è¿°æ‰¿è¯ºæ³•"><a href="#æ–¹æ³•ä¸€ï¼šå¤è¿°æ‰¿è¯ºæ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå¤è¿°æ‰¿è¯ºæ³•"></a>æ–¹æ³•ä¸€ï¼šå¤è¿°æ‰¿è¯ºæ³•</h2><p>å…ˆå¤è¿°ï¼Œå†æ‰¿è¯ºï¼Œè®©é¢†å¯¼æ”¾å¿ƒã€‚</p>
<h2 id="æ–¹æ³•äºŒï¼šåˆ†è§£æ³•"><a href="#æ–¹æ³•äºŒï¼šåˆ†è§£æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šåˆ†è§£æ³•"></a>æ–¹æ³•äºŒï¼šåˆ†è§£æ³•</h2><ul>
<li>å¤æ‚é—®é¢˜ç®€å•åŒ–</li>
<li>ç®€å•é—®é¢˜å¼±æ™ºåŒ–</li>
</ul>
<h3 id="ä¸ªäººæˆ˜ç•¥è§„åˆ’å·¥å…·"><a href="#ä¸ªäººæˆ˜ç•¥è§„åˆ’å·¥å…·" class="headerlink" title="ä¸ªäººæˆ˜ç•¥è§„åˆ’å·¥å…·"></a>ä¸ªäººæˆ˜ç•¥è§„åˆ’å·¥å…·</h3><ol>
<li>æœªæ¥äº”å¹´è¿œæ™¯</li>
<li>ä¸ªäººå‘å±•æˆ˜ç•¥æ‰€éœ€è¦è§£å†³çš„æ ¹æœ¬çŸ›ç›¾</li>
<li>ä¸ªäººæ ¸å¿ƒä»·å€¼è§‚</li>
<li>æœªæ¥ä¸¤å¹´ç›®æ ‡</li>
<li>2024å¹´ä¸»é¢˜ï¼ˆåŒ…å«å®¶åº­ä¸»é¢˜ï¼‰</li>
<li>2024è¡ŒåŠ¨è®¡åˆ’ï¼ˆåŒ…å«å®¶åº­ç›®æ ‡è¾¾æˆè®¡åˆ’ï¼‰</li>
<li>éœ€è¦æ”¾å¼ƒçš„èµ„æº</li>
</ol>
<h2 id="æ–¹æ³•ä¸‰ï¼šå¯»æ±‚ååŠ©æ³•"><a href="#æ–¹æ³•ä¸‰ï¼šå¯»æ±‚ååŠ©æ³•" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šå¯»æ±‚ååŠ©æ³•"></a>æ–¹æ³•ä¸‰ï¼šå¯»æ±‚ååŠ©æ³•</h2><ol>
<li>æ˜ç¡®ç›®æ ‡ï¼šæƒ³è·å¾—ä»€ä¹ˆå¸®åŠ©</li>
<li>æ‰“å¥½åŸºç¡€ï¼š ç§¯ç´¯æƒ…æ„Ÿè´¦æˆ·</li>
<li>å…³é”®æ—¶åˆ»ï¼š æå‡ºå¤šä¸ªé€‰æ‹©æ–¹æ¡ˆ</li>
</ol>
<blockquote>
<p>å¯»æ±‚ååŠ©æ—¶ï¼Œå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ç¼ºä¹æƒ…æ„Ÿè´¦æˆ·çš„ç§¯ç´¯ï¼Œæ‰€ä»¥æ˜ç¡®ç›®æ ‡å’Œæå‡ºå¤šä¸ªé€‰æ‹©æ–¹æ¡ˆæ˜¯æˆ‘ä»¬å¯»æ±‚ååŠ©æˆåŠŸçš„å…³é”®æ¡ä»¶ã€‚</p>
</blockquote>
<h1 id="äº”ã€æ‰§è¡Œçš„æ–¹å‘â€”â€”å®¢æˆ·ä»·å€¼"><a href="#äº”ã€æ‰§è¡Œçš„æ–¹å‘â€”â€”å®¢æˆ·ä»·å€¼" class="headerlink" title="äº”ã€æ‰§è¡Œçš„æ–¹å‘â€”â€”å®¢æˆ·ä»·å€¼"></a>äº”ã€æ‰§è¡Œçš„æ–¹å‘â€”â€”å®¢æˆ·ä»·å€¼</h1><p>å®¢æˆ·ä»·å€¼ï¼šç«™åœ¨å®¢æˆ·çš„è§’åº¦ï¼Œä¸ºå®¢æˆ·æä¾›æ»¡æ„å’Œè¶…å€¼çš„ç»“æœï¼Œæ˜¯æ‰§è¡Œçš„æ–¹å‘ï¼</p>
<ul>
<li>æ»¡æ„çš„ç»“æœäº§ç”Ÿæ»¡æ„çš„ç”¨æˆ·</li>
<li>è¶…å€¼çš„ç»“æœäº§ç”Ÿå¿ è¯šçš„ç”¨æˆ·</li>
</ul>
<h2 id="å†…éƒ¨å®¢æˆ·ä»·å€¼"><a href="#å†…éƒ¨å®¢æˆ·ä»·å€¼" class="headerlink" title="å†…éƒ¨å®¢æˆ·ä»·å€¼"></a>å†…éƒ¨å®¢æˆ·ä»·å€¼</h2><p>ä¼ä¸šå†…éƒ¨å®¢æˆ·å…³ç³»</p>
<ul>
<li>ä»ç”Ÿäº§æµç¨‹çœ‹ï¼š ä¸‹é“å·¥åºæ˜¯ä¸Šé“å·¥åºçš„å®¢æˆ·</li>
<li>ä»å·¥ä½œç»“æœçœ‹ï¼š ä¸Šçº§æ˜¯ä¸‹çº§çš„å®¢æˆ·</li>
<li>ä»æˆé•¿æœºä¼šçœ‹ï¼š ä¸‹çº§æ˜¯ä¸Šçº§çš„å®¢æˆ·</li>
</ul>
<h2 id="é”€å”®éƒ¨ä¸å¸‚åœºéƒ¨å…³äºæ”¿ç­–çš„çŸ›ç›¾è§£å†³"><a href="#é”€å”®éƒ¨ä¸å¸‚åœºéƒ¨å…³äºæ”¿ç­–çš„çŸ›ç›¾è§£å†³" class="headerlink" title="é”€å”®éƒ¨ä¸å¸‚åœºéƒ¨å…³äºæ”¿ç­–çš„çŸ›ç›¾è§£å†³"></a>é”€å”®éƒ¨ä¸å¸‚åœºéƒ¨å…³äºæ”¿ç­–çš„çŸ›ç›¾è§£å†³</h2><h3 id="å¸‚åœºéƒ¨"><a href="#å¸‚åœºéƒ¨" class="headerlink" title="å¸‚åœºéƒ¨"></a>å¸‚åœºéƒ¨</h3><ul>
<li>é‚€è¯·å‚ä¸</li>
<li>è¯¦ç»†è®²è§£</li>
<li>åˆ¶å®šæœºåˆ¶</li>
<li>ä¸“äººè´Ÿè´£</li>
<li>æŒç»­æ›´æ–°</li>
</ul>
<h3 id="é”€å”®éƒ¨"><a href="#é”€å”®éƒ¨" class="headerlink" title="é”€å”®éƒ¨"></a>é”€å”®éƒ¨</h3><ul>
<li>å†…éƒ¨åˆ†äº«</li>
<li>ä¿¡ä»»åŸ¹è®­</li>
<li>ç®¡ç†æµç¨‹</li>
<li>ä¸“äººå¯¹æ¥</li>
<li>æŒç»­æ›´æ–°</li>
</ul>
<h1 id="å…­ã€æ‰§è¡ŒåŠ›æ®µä½"><a href="#å…­ã€æ‰§è¡ŒåŠ›æ®µä½" class="headerlink" title="å…­ã€æ‰§è¡ŒåŠ›æ®µä½"></a>å…­ã€æ‰§è¡ŒåŠ›æ®µä½</h1><p>ä¹æ®µç§˜ä¹¦æµ‹è¯•</p>
<ul>
<li>ä¸€æ®µå‘é€šçŸ¥</li>
<li>äºŒæ®µæŠ“è½å®</li>
<li>ä¸‰æ®µé‡æ£€æŸ¥</li>
<li>å››æ®µå‹¤å‡†å¤‡</li>
<li>äº”æ®µæå‰é‡</li>
<li>å…­æ®µæ€»è®°å½•</li>
<li>ä¸ƒæ®µå‘çºªè¦</li>
<li>å…«æ®µå®šè´£ä»»</li>
<li>ä¹æ®µåšæµç¨‹</li>
</ul>
<h1 id="æ€è€ƒä¸æ”¶è·"><a href="#æ€è€ƒä¸æ”¶è·" class="headerlink" title="æ€è€ƒä¸æ”¶è·"></a>æ€è€ƒä¸æ”¶è·</h1><ol>
<li>æ‰¿è®¤é—®é¢˜æ˜¯è§£å†³é—®é¢˜çš„å¼€å§‹</li>
<li>å°å­©è®²å¯¹ä¸é”™ï¼Œæˆå¹´äººè®²å¾—ä¸å¤±</li>
<li>äººæ‰å’Œäººæ‰‹çš„åŒºåˆ«ï¼šä¸å¯æ›¿ä»£æ€§</li>
<li>å‘å†…çœ‹ï¼Œå°‘è¯„åˆ¤</li>
</ol>
<blockquote>
<p>å¦‚æœå®Œå…¨æŒ‰ç…§è¿™ä¸ªè¯¾ç¨‹æ‰§è¡Œï¼Œæ˜¯å¦æ˜¯å˜æˆä¸€ä¸ªå®Œç¾çš„å·¥å…·äººï¼›é«˜æ•ˆæ‰§è¡ŒèƒŒåçš„æ ¸å¿ƒä»·å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘è®¤ä¸ºæ˜¯é«˜æ•ˆå®Œæˆå·¥ä½œ,è®¤çœŸäº«å—ç”Ÿæ´»ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>ç®¡ç†</tag>
        <tag>æ‰§è¡Œ</tag>
        <tag>é¢†å¯¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡ç”Ÿäº§æµé‡æ”»å‡»é˜²å¾¡ä¸è§£å†³æ–¹æ¡ˆ</title>
    <url>/2025/11/11/operations/yi-ci-sheng-chan-liu-liang-gong-ji-fang-yu-yu-jie-jue-fang-an/</url>
    <content><![CDATA[<p><img src="/2025/11/11/operations/yi-ci-sheng-chan-liu-liang-gong-ji-fang-yu-yu-jie-jue-fang-an/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB.png" alt="æµé‡æ”»å‡»"></p>
<h1 id="ä¸€ã€é—®é¢˜èƒŒæ™¯"><a href="#ä¸€ã€é—®é¢˜èƒŒæ™¯" class="headerlink" title="ä¸€ã€é—®é¢˜èƒŒæ™¯"></a>ä¸€ã€é—®é¢˜èƒŒæ™¯</h1><h2 id="1-1-é—®é¢˜å‘ç°"><a href="#1-1-é—®é¢˜å‘ç°" class="headerlink" title="1.1 é—®é¢˜å‘ç°"></a>1.1 é—®é¢˜å‘ç°</h2><p>æŸå¤©ä¸Šç­åï¼Œè¿ç»´åé¦ˆç›‘æ§ç³»ç»Ÿçªç„¶å‘Šè­¦ï¼Œç½‘ç«™å¸¦å®½ä½¿ç”¨ç‡æŒç»­é£™å‡è‡³80%ä»¥ä¸Šï¼ŒæœåŠ¡å™¨CPUè´Ÿè½½å¼‚å¸¸ã€‚é€šè¿‡æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—å‘ç°ï¼ŒæŸä¸ªé™æ€èµ„æºæ–‡ä»¶é­å—äº†å¤§è§„æ¨¡çš„å¼‚å¸¸è®¿é—®ã€‚</p>
<h2 id="1-2-æ—¥å¿—åˆ†æ"><a href="#1-2-æ—¥å¿—åˆ†æ" class="headerlink" title="1.2 æ—¥å¿—åˆ†æ"></a>1.2 æ—¥å¿—åˆ†æ</h2><h3 id="æ­£å¸¸è®¿é—®æ—¥å¿—ç¤ºä¾‹"><a href="#æ­£å¸¸è®¿é—®æ—¥å¿—ç¤ºä¾‹" class="headerlink" title="æ­£å¸¸è®¿é—®æ—¥å¿—ç¤ºä¾‹"></a>æ­£å¸¸è®¿é—®æ—¥å¿—ç¤ºä¾‹</h3><p>é¦–å…ˆæŸ¥çœ‹æ­£å¸¸æ—¶æ®µçš„è®¿é—®æ—¥å¿—ï¼Œæµé‡åˆ†å¸ƒè¾ƒä¸ºå‡åŒ€ï¼š</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"@timestamp"</span><span class="token operator">:</span><span class="token string">"2025-11-11T09:00:00+08:00"</span><span class="token punctuation">,</span><span class="token property">"host"</span><span class="token operator">:</span><span class="token string">"172.25.192.5"</span><span class="token punctuation">,</span><span class="token property">"client"</span><span class="token operator">:</span><span class="token string">"183.44.115.70"</span><span class="token punctuation">,</span><span class="token property">"size"</span><span class="token operator">:</span><span class="token number">792</span><span class="token punctuation">,</span><span class="token property">"responsetime"</span><span class="token operator">:</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span><span class="token string">"/uploadfiles/nav/nav3_img3.png"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token string">"200"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"@timestamp"</span><span class="token operator">:</span><span class="token string">"2025-11-11T09:00:00+08:00"</span><span class="token punctuation">,</span><span class="token property">"host"</span><span class="token operator">:</span><span class="token string">"172.25.192.5"</span><span class="token punctuation">,</span><span class="token property">"client"</span><span class="token operator">:</span><span class="token string">"119.134.146.224"</span><span class="token punctuation">,</span><span class="token property">"size"</span><span class="token operator">:</span><span class="token number">1222</span><span class="token punctuation">,</span><span class="token property">"responsetime"</span><span class="token operator">:</span><span class="token number">0.002</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span><span class="token string">"/uploadfiles/2024/05/20240506180621580.png"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token string">"200"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"@timestamp"</span><span class="token operator">:</span><span class="token string">"2025-11-11T09:00:00+08:00"</span><span class="token punctuation">,</span><span class="token property">"host"</span><span class="token operator">:</span><span class="token string">"172.25.192.5"</span><span class="token punctuation">,</span><span class="token property">"client"</span><span class="token operator">:</span><span class="token string">"223.104.87.191"</span><span class="token punctuation">,</span><span class="token property">"size"</span><span class="token operator">:</span><span class="token number">367</span><span class="token punctuation">,</span><span class="token property">"responsetime"</span><span class="token operator">:</span><span class="token number">0.003</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span><span class="token string">"/ytx-api/v1.0.0/loginToken/getApp"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token string">"200"</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token property">"@timestamp"</span><span class="token operator">:</span><span class="token string">"2025-11-11T09:00:00+08:00"</span><span class="token punctuation">,</span><span class="token property">"host"</span><span class="token operator">:</span><span class="token string">"172.25.192.5"</span><span class="token punctuation">,</span><span class="token property">"client"</span><span class="token operator">:</span><span class="token string">"183.44.115.70"</span><span class="token punctuation">,</span><span class="token property">"size"</span><span class="token operator">:</span><span class="token number">4692</span><span class="token punctuation">,</span><span class="token property">"responsetime"</span><span class="token operator">:</span><span class="token number">0.003</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span><span class="token string">"/cn/js/liMarquee/jquery.liMarquee.js"</span><span class="token punctuation">,</span><span class="token property">"status"</span><span class="token operator">:</span><span class="token string">"200"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å¼‚å¸¸æµé‡ç‰¹å¾"><a href="#å¼‚å¸¸æµé‡ç‰¹å¾" class="headerlink" title="å¼‚å¸¸æµé‡ç‰¹å¾"></a>å¼‚å¸¸æµé‡ç‰¹å¾</h3><p>é€šè¿‡æ—¥å¿—åˆ†æå·¥å…·ç»Ÿè®¡å‘ç°ï¼ŒæŸä¸ªBannerå›¾ç‰‡çš„è®¿é—®é‡å¼‚å¸¸æ¿€å¢ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç»Ÿè®¡è®¿é—®æœ€é¢‘ç¹çš„URL</span>
<span class="token function">cat</span> access.log <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.url'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-rn</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span>

<span class="token comment"># è¾“å‡ºç»“æœï¼ˆç¤ºä¾‹ï¼‰</span>
  <span class="token number">6897</span> /uploadfiles/banner/banner_img.png
   <span class="token number">342</span> /uploadfiles/nav/nav3_img3.png
   <span class="token number">256</span> /uploadfiles/2024/05/20240506180621580.png
   <span class="token number">189</span> /ytx-api/v1.0.0/loginToken/getApp
   <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒæŸä¸ªBannerå›¾ç‰‡çš„è®¿é—®é‡è¿œè¶…å…¶ä»–èµ„æºï¼Œå æ®äº†ç»å¯¹ä¼˜åŠ¿ã€‚</p>
<h3 id="IPæ¥æºåˆ†æ"><a href="#IPæ¥æºåˆ†æ" class="headerlink" title="IPæ¥æºåˆ†æ"></a>IPæ¥æºåˆ†æ</h3><p>è¿›ä¸€æ­¥åˆ†æè®¿é—®è¯¥èµ„æºçš„IPåˆ†å¸ƒï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç»Ÿè®¡è®¿é—®Bannerå›¾ç‰‡çš„ç‹¬ç«‹IPæ•°</span>
<span class="token function">cat</span> access.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"banner_img.png"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.client'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-u</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
<span class="token comment"># è¾“å‡º: 6857</span>

<span class="token comment"># ç»Ÿè®¡æ¯ä¸ªIPçš„è®¿é—®æ¬¡æ•°</span>
<span class="token function">cat</span> access.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"banner_img.png"</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.client'</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-rn</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-10</span>
<span class="token comment"># è¾“å‡ºç»“æœï¼ˆç¤ºä¾‹ï¼‰</span>
   <span class="token number">5</span> <span class="token number">183.44</span>.115.70
   <span class="token number">4</span> <span class="token number">119.134</span>.146.224
   <span class="token number">3</span> <span class="token number">223.104</span>.87.191
   <span class="token number">2</span> <span class="token number">113.117</span>.88.203
   <span class="token number">1</span> <span class="token number">211.90</span>.250.205
   <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å…³é”®å‘ç°</strong>ï¼šè¿‘7000ä¸ªIPï¼Œæ¯ä¸ªIPä»…è®¿é—®1-5æ¬¡ï¼Œè¿™æ˜¯å…¸å‹çš„åˆ†å¸ƒå¼ä½é¢‘æ”»å‡»ç‰¹å¾ã€‚</p>
<h2 id="1-3-æ”»å‡»ç‰¹å¾æ€»ç»“"><a href="#1-3-æ”»å‡»ç‰¹å¾æ€»ç»“" class="headerlink" title="1.3 æ”»å‡»ç‰¹å¾æ€»ç»“"></a>1.3 æ”»å‡»ç‰¹å¾æ€»ç»“</h2><p>é€šè¿‡å¯¹æ—¥å¿—è¿›è¡Œæ·±å…¥åˆ†æï¼Œç¡®è®¤äº†ä»¥ä¸‹æ”»å‡»ç‰¹å¾ï¼š</p>
<p><strong>æ”»å‡»ç‰¹å¾ï¼š</strong></p>
<ul>
<li><strong>ç›®æ ‡èµ„æº</strong>: ç½‘ç«™Bannerå›¾ç‰‡ï¼ˆçº¦900KBï¼‰</li>
<li><strong>æ”»å‡»è§„æ¨¡</strong>: çº¦7000æ¬¡&#x2F;å°æ—¶ï¼Œæµé‡è¾¾6GB&#x2F;å°æ—¶</li>
<li><strong>å®¢æˆ·ç«¯æ•°</strong>: è¿‘7000ä¸ªç‹¬ç«‹IPï¼ˆé«˜åº¦åˆ†æ•£ï¼‰</li>
<li><strong>æ”»å‡»æ¨¡å¼</strong>: åˆ†å¸ƒå¼ä½é¢‘æ”»å‡»ï¼ˆæ¯ä¸ªIPä»…è®¿é—®1-5æ¬¡ï¼‰</li>
<li><strong>æ”»å‡»ç±»å‹</strong>: <strong>DDoSï¼ˆåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ï¼‰</strong></li>
<li><strong>å“åº”æ—¶é—´</strong>: å¹³å‡å“åº”æ—¶é—´ä»0.002så¢é•¿åˆ°0.5sä»¥ä¸Š</li>
</ul>
<h2 id="1-4-æ”»å‡»å±å®³åˆ†æ"><a href="#1-4-æ”»å‡»å±å®³åˆ†æ" class="headerlink" title="1.4 æ”»å‡»å±å®³åˆ†æ"></a>1.4 æ”»å‡»å±å®³åˆ†æ</h2><p>ç»è¿‡åˆæ­¥è¯„ä¼°ï¼Œæ­¤æ¬¡æ”»å‡»é€ æˆäº†ä»¥ä¸‹å½±å“ï¼š</p>
<ul>
<li><strong>å¸¦å®½è€—å°½</strong>: å•ä¸ªæ–‡ä»¶å ç”¨è¶…è¿‡60%å¸¦å®½èµ„æº</li>
<li><strong>æœåŠ¡å™¨è´Ÿè½½</strong>: å¤§é‡å¹¶å‘è¯·æ±‚å¯¼è‡´CPUä½¿ç”¨ç‡æŒç»­åœ¨80%ä»¥ä¸Š</li>
<li><strong>æˆæœ¬å¢åŠ </strong>: å¸¦å®½è´¹ç”¨è¾ƒå¹³æ—¶å¢é•¿3å€ä»¥ä¸Š</li>
<li><strong>æœåŠ¡é™çº§</strong>: æ­£å¸¸ç”¨æˆ·è®¿é—®å»¶è¿Ÿå¢åŠ ï¼Œéƒ¨åˆ†è¯·æ±‚è¶…æ—¶</li>
</ul>
<h1 id="äºŒã€ç´§æ€¥é˜²å¾¡æªæ–½ï¼ˆç«‹å³éƒ¨ç½²ï¼‰"><a href="#äºŒã€ç´§æ€¥é˜²å¾¡æªæ–½ï¼ˆç«‹å³éƒ¨ç½²ï¼‰" class="headerlink" title="äºŒã€ç´§æ€¥é˜²å¾¡æªæ–½ï¼ˆç«‹å³éƒ¨ç½²ï¼‰"></a>äºŒã€ç´§æ€¥é˜²å¾¡æªæ–½ï¼ˆç«‹å³éƒ¨ç½²ï¼‰</h1><h2 id="2-1-Nginxé™æµé…ç½®ï¼ˆ5åˆ†é’Ÿå†…å®Œæˆï¼‰"><a href="#2-1-Nginxé™æµé…ç½®ï¼ˆ5åˆ†é’Ÿå†…å®Œæˆï¼‰" class="headerlink" title="2.1 Nginxé™æµé…ç½®ï¼ˆ5åˆ†é’Ÿå†…å®Œæˆï¼‰"></a>2.1 Nginxé™æµé…ç½®ï¼ˆ5åˆ†é’Ÿå†…å®Œæˆï¼‰</h2><h3 id="é…ç½®é™æµè§„åˆ™"><a href="#é…ç½®é™æµè§„åˆ™" class="headerlink" title="é…ç½®é™æµè§„åˆ™"></a>é…ç½®é™æµè§„åˆ™</h3><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># åœ¨ http å—ä¸­å®šä¹‰é™æµåŒºåŸŸ</span>
<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># é™åˆ¶å•IPè¯·æ±‚é¢‘ç‡</span>
    <span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=static_limit:10m rate=10r/s</span><span class="token punctuation">;</span>
    
    <span class="token comment"># é™åˆ¶å•IPå¹¶å‘è¿æ¥æ•°</span>
    <span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=conn_limit:10m</span><span class="token punctuation">;</span>
    
    <span class="token comment"># é™åˆ¶æ€»å¸¦å®½</span>
    <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">500k</span></span><span class="token punctuation">;</span>  <span class="token comment"># å•è¿æ¥é™é€Ÿ500KB/s</span>
    
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> www.example.com</span><span class="token punctuation">;</span>
        
        <span class="token comment"># é’ˆå¯¹é™æ€èµ„æºçš„é™æµ</span>
        <span class="token directive"><span class="token keyword">location</span> ~* /uploadfiles/.*\.(png|jpg|jpeg|gif)$</span> <span class="token punctuation">&#123;</span>
            <span class="token comment"># è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼šæ¯ç§’10ä¸ªè¯·æ±‚ï¼Œçªå‘20ä¸ª</span>
            <span class="token directive"><span class="token keyword">limit_req</span> zone=static_limit burst=20 nodelay</span><span class="token punctuation">;</span>
            
            <span class="token comment"># å¹¶å‘è¿æ¥é™åˆ¶ï¼šæ¯IPæœ€å¤š5ä¸ªè¿æ¥</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> conn_limit <span class="token number">5</span></span><span class="token punctuation">;</span>
            
            <span class="token comment"># å•è¿æ¥é™é€Ÿ</span>
            <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">300k</span></span><span class="token punctuation">;</span>
            
            <span class="token comment"># è¿”å›é™æ€æ–‡ä»¶</span>
            <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
            
            <span class="token comment"># å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œè¿”å›503</span>
            <span class="token directive"><span class="token keyword">limit_req_status</span> <span class="token number">503</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">limit_conn_status</span> <span class="token number">503</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment"># ç‰¹åˆ«ä¿æŠ¤Bannerå›¾ç‰‡</span>
        <span class="token directive"><span class="token keyword">location</span> = /uploadfiles/banner/banner_img.png</span> <span class="token punctuation">&#123;</span>
            <span class="token comment"># æ›´ä¸¥æ ¼çš„é™åˆ¶</span>
            <span class="token directive"><span class="token keyword">limit_req</span> zone=static_limit burst=5 nodelay</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> conn_limit <span class="token number">2</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">200k</span></span><span class="token punctuation">;</span>
            
            <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é…ç½®è¯´æ˜"><a href="#é…ç½®è¯´æ˜" class="headerlink" title="é…ç½®è¯´æ˜"></a>é…ç½®è¯´æ˜</h3><ul>
<li><code>limit_req_zone</code>: å®šä¹‰ä¸€ä¸ªé™æµåŒºåŸŸï¼Œä½¿ç”¨ <code>$binary_remote_addr</code> ä½œä¸ºé”®ï¼Œå­˜å‚¨åœ¨ <code>static_limit</code> åŒºåŸŸï¼Œè®¾ç½®ä¸º10åˆ†é’Ÿï¼Œé™é€Ÿä¸ºæ¯ç§’10ä¸ªè¯·æ±‚ã€‚</li>
<li><code>limit_conn_zone</code>: å®šä¹‰ä¸€ä¸ªè¿æ¥æ•°é™åˆ¶åŒºåŸŸï¼Œä½¿ç”¨ <code>$binary_remote_addr</code> ä½œä¸ºé”®ï¼Œå­˜å‚¨åœ¨ <code>conn_limit</code> åŒºåŸŸï¼Œè®¾ç½®ä¸º10åˆ†é’Ÿã€‚</li>
<li><code>limit_rate</code>: è®¾ç½®å•è¿æ¥é™é€Ÿä¸º500KB&#x2F;sã€‚</li>
<li><code>limit_req</code>: å¯¹é™æ€èµ„æºè¯·æ±‚è¿›è¡Œé™æµï¼Œè®¾ç½®ä¸ºæ¯ç§’10ä¸ªè¯·æ±‚ï¼Œçªå‘20ä¸ªï¼Œä¸å»¶è¿Ÿå¤„ç†ã€‚</li>
<li><code>limit_conn</code>: å¯¹å•IPçš„å¹¶å‘è¿æ¥æ•°è¿›è¡Œé™åˆ¶ï¼Œè®¾ç½®ä¸ºæ¯IPæœ€å¤š5ä¸ªè¿æ¥ã€‚</li>
<li><code>limit_rate</code>: å¯¹å•è¿æ¥é™é€Ÿä¸º300KB&#x2F;sã€‚</li>
<li><code>limit_req_status</code>: å½“è¶…è¿‡é™æµé˜ˆå€¼æ—¶ï¼Œè¿”å›503çŠ¶æ€ç ã€‚</li>
<li><code>limit_conn_status</code>: å½“è¶…è¿‡è¿æ¥æ•°é™åˆ¶æ—¶ï¼Œè¿”å›503çŠ¶æ€ç ã€‚</li>
</ul>
<h3 id="åº”ç”¨é…ç½®å¹¶é‡å¯"><a href="#åº”ç”¨é…ç½®å¹¶é‡å¯" class="headerlink" title="åº”ç”¨é…ç½®å¹¶é‡å¯"></a>åº”ç”¨é…ç½®å¹¶é‡å¯</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•</span>
nginx <span class="token parameter variable">-t</span>

<span class="token comment"># é…ç½®æ— è¯¯åé‡è½½Nginx</span>
nginx <span class="token parameter variable">-s</span> reload

<span class="token comment"># æˆ–ä½¿ç”¨systemctlæ–¹å¼</span>
systemctl reload nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-2-å¯ç”¨é˜²ç›—é“¾ä¿æŠ¤ï¼ˆ15åˆ†é’Ÿå†…å®Œæˆï¼‰"><a href="#2-2-å¯ç”¨é˜²ç›—é“¾ä¿æŠ¤ï¼ˆ15åˆ†é’Ÿå†…å®Œæˆï¼‰" class="headerlink" title="2.2 å¯ç”¨é˜²ç›—é“¾ä¿æŠ¤ï¼ˆ15åˆ†é’Ÿå†…å®Œæˆï¼‰"></a>2.2 å¯ç”¨é˜²ç›—é“¾ä¿æŠ¤ï¼ˆ15åˆ†é’Ÿå†…å®Œæˆï¼‰</h2><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> ~* /uploadfiles/.*\.(png|jpg|jpeg|gif)$</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># é˜²ç›—é“¾é…ç½®</span>
    <span class="token directive"><span class="token keyword">valid_referers</span> none blocked server_names
                   *.example.com
                   example.com
                   localhost</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment"># å…¶ä»–é…ç½®...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é…ç½®è¯´æ˜-1"><a href="#é…ç½®è¯´æ˜-1" class="headerlink" title="é…ç½®è¯´æ˜"></a>é…ç½®è¯´æ˜</h3><ul>
<li><code>valid_referers</code>: å®šä¹‰å…è®¸çš„Refereråˆ—è¡¨ï¼ŒåŒ…æ‹¬ç›´æ¥è®¿é—®ã€CDNå›æºIPã€CDNåŸŸåã€æœ¬åœ°è®¿é—®ç­‰ã€‚</li>
<li><code>if ($invalid_referer)</code>: å¦‚æœRefererä¸åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œåˆ™è¿”å›403çŠ¶æ€ç ã€‚</li>
</ul>
<h1 id="ä¸‰ã€ä¸­æœŸé˜²å¾¡æ–¹æ¡ˆï¼ˆ24å°æ—¶å†…éƒ¨ç½²ï¼‰"><a href="#ä¸‰ã€ä¸­æœŸé˜²å¾¡æ–¹æ¡ˆï¼ˆ24å°æ—¶å†…éƒ¨ç½²ï¼‰" class="headerlink" title="ä¸‰ã€ä¸­æœŸé˜²å¾¡æ–¹æ¡ˆï¼ˆ24å°æ—¶å†…éƒ¨ç½²ï¼‰"></a>ä¸‰ã€ä¸­æœŸé˜²å¾¡æ–¹æ¡ˆï¼ˆ24å°æ—¶å†…éƒ¨ç½²ï¼‰</h1><p>ä¸­æœŸé˜²å¾¡æ–¹æ¡ˆï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²CDN + DDoSé˜²æŠ¤è®¾å¤‡ï¼Œä»¥æä¾›æ›´å…¨é¢çš„é˜²å¾¡èƒ½åŠ›ã€‚</p>
<h2 id="3-1-æ¥å…¥CDN-DDoSé˜²æŠ¤"><a href="#3-1-æ¥å…¥CDN-DDoSé˜²æŠ¤" class="headerlink" title="3.1 æ¥å…¥CDN + DDoSé˜²æŠ¤"></a>3.1 æ¥å…¥CDN + DDoSé˜²æŠ¤</h2><h3 id="æ–¹æ¡ˆé€‰æ‹©"><a href="#æ–¹æ¡ˆé€‰æ‹©" class="headerlink" title="æ–¹æ¡ˆé€‰æ‹©"></a>æ–¹æ¡ˆé€‰æ‹©</h3><p><strong>é˜¿é‡Œäº‘CDN + DDoSé«˜é˜²</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®æ­¥éª¤</span>
<span class="token number">1</span>. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
<span class="token number">2</span>. å¼€é€šCDNæœåŠ¡
<span class="token number">3</span>. æ·»åŠ åŠ é€ŸåŸŸåï¼šwww.example.com
<span class="token number">4</span>. é…ç½®æºç«™ï¼šå½“å‰æœåŠ¡å™¨IP
<span class="token number">5</span>. å¼€é€šDDoSé«˜é˜²IP
<span class="token number">6</span>. å°†åŸŸåè§£æåˆ°é«˜é˜²IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>éœ€è¦ç¡®ä¿CDNå’ŒDDoSé«˜é˜²IPçš„é…ç½®æ­£ç¡®æ— è¯¯ï¼Œå¦åˆ™ä¼šå½±å“æ­£å¸¸è®¿é—®ã€‚</li>
</ul>
<h3 id="æºç«™Nginxé…ç½®"><a href="#æºç«™Nginxé…ç½®" class="headerlink" title="æºç«™Nginxé…ç½®"></a>æºç«™Nginxé…ç½®</h3><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># æºç«™Nginxé…ç½®ç¤ºä¾‹</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.example.com</span><span class="token punctuation">;</span>
    
    <span class="token comment"># åªå…è®¸CDNå›æºIPè®¿é—®</span>
    <span class="token directive"><span class="token keyword">allow</span> 47.88.0.0/16</span><span class="token punctuation">;</span>      <span class="token comment"># é˜¿é‡Œäº‘CDN IPæ®µ</span>
    <span class="token directive"><span class="token keyword">allow</span> 47.246.0.0/16</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">allow</span> 118.178.0.0/16</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
    
    <span class="token comment"># éªŒè¯CDNå›æºè¯·æ±‚</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_x_forwarded_for</span> = <span class="token string">""</span>)</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/html</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>allow</code>: å…è®¸è®¿é—®çš„IPæ®µï¼Œè¿™é‡Œé…ç½®äº†é˜¿é‡Œäº‘CDNçš„IPæ®µã€‚</li>
<li><code>deny all</code>: æ‹’ç»æ‰€æœ‰å…¶ä»–IPçš„è®¿é—®ã€‚</li>
<li><code>if ($http_x_forwarded_for = &quot;&quot;)</code>: å¦‚æœè¯·æ±‚å¤´ä¸­æ²¡æœ‰X-Forwarded-Forå­—æ®µï¼Œè¯´æ˜ä¸æ˜¯CDNå›æºè¯·æ±‚ï¼Œè¿”å›403çŠ¶æ€ç ã€‚</li>
</ul>
<h3 id="å…¶ä»–CDNæ–¹æ¡ˆå¯¹æ¯”"><a href="#å…¶ä»–CDNæ–¹æ¡ˆå¯¹æ¯”" class="headerlink" title="å…¶ä»–CDNæ–¹æ¡ˆå¯¹æ¯”"></a>å…¶ä»–CDNæ–¹æ¡ˆå¯¹æ¯”</h3><table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>ä¼˜åŠ¿</th>
<th>æˆæœ¬</th>
</tr>
</thead>
<tbody><tr>
<td>è…¾è®¯äº‘CDN + DDoSé˜²æŠ¤</td>
<td>æˆæœ¬ç›¸å¯¹è¾ƒä½ï¼Œå›½å†…èŠ‚ç‚¹ä¸°å¯Œ</td>
<td>400-1500å…ƒ&#x2F;æœˆ</td>
</tr>
<tr>
<td>Cloudflareï¼ˆå›½é™…æ–¹æ¡ˆï¼‰</td>
<td>å…è´¹DDoSé˜²æŠ¤ï¼Œå…¨çƒCDNåŠ é€Ÿ</td>
<td>å…è´¹-200ç¾å…ƒ&#x2F;æœˆ</td>
</tr>
</tbody></table>
<h3 id="é¢„æœŸæ•ˆæœ"><a href="#é¢„æœŸæ•ˆæœ" class="headerlink" title="é¢„æœŸæ•ˆæœ"></a>é¢„æœŸæ•ˆæœ</h3><ul>
<li><strong>é˜²å¾¡èƒ½åŠ›</strong>: 100-300 Gbps</li>
<li><strong>æºç«™æµé‡å‡å°‘</strong>: 80-95%</li>
<li><strong>å“åº”æ—¶é—´</strong>: é™ä½30-50%</li>
<li><strong>æˆæœ¬</strong>: çº¦500-2000å…ƒ&#x2F;æœˆ</li>
</ul>
<h1 id="å››ã€é•¿æœŸé˜²æŠ¤ç­–ç•¥"><a href="#å››ã€é•¿æœŸé˜²æŠ¤ç­–ç•¥" class="headerlink" title="å››ã€é•¿æœŸé˜²æŠ¤ç­–ç•¥"></a>å››ã€é•¿æœŸé˜²æŠ¤ç­–ç•¥</h1><h2 id="4-1-æ¶æ„ä¼˜åŒ–"><a href="#4-1-æ¶æ„ä¼˜åŒ–" class="headerlink" title="4.1 æ¶æ„ä¼˜åŒ–"></a>4.1 æ¶æ„ä¼˜åŒ–</h2><h3 id="é™æ€èµ„æºåˆ†ç¦»"><a href="#é™æ€èµ„æºåˆ†ç¦»" class="headerlink" title="é™æ€èµ„æºåˆ†ç¦»"></a>é™æ€èµ„æºåˆ†ç¦»</h3><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token comment"># ä¸»ç«™æœåŠ¡å™¨ï¼ˆåŠ¨æ€å†…å®¹ï¼‰</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.example.com</span><span class="token punctuation">;</span>
    
    <span class="token comment"># é™æ€èµ„æºé‡å®šå‘åˆ°CDN</span>
    <span class="token directive"><span class="token keyword">location</span> ~* /uploadfiles/</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://cdn.example.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment"># åŠ¨æ€å†…å®¹</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># CDN/é™æ€èµ„æºæœåŠ¡å™¨</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> cdn.example.com</span><span class="token punctuation">;</span>
    
    <span class="token comment"># ä¸¥æ ¼é™æµ</span>
    <span class="token directive"><span class="token keyword">limit_req</span> zone=cdn_limit burst=10</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">location</span> /uploadfiles/</span> <span class="token punctuation">&#123;</span>
        <span class="token directive"><span class="token keyword">root</span> /var/www/static</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">"public, immutable"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>limit_req</code>: å¯¹CDNè¯·æ±‚è¿›è¡Œé™æµï¼Œè®¾ç½®ä¸ºæ¯ç§’10ä¸ªè¯·æ±‚ï¼Œçªå‘10ä¸ªã€‚</li>
<li><code>expires</code>: è®¾ç½®é™æ€èµ„æºç¼“å­˜æ—¶é—´ä¸º30å¤©ã€‚</li>
<li><code>add_header</code>: æ·»åŠ Cache-Controlå¤´ï¼Œè®¾ç½®ä¸ºpublicå’Œimmutableï¼Œç¡®ä¿æµè§ˆå™¨ç¼“å­˜ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰"><a href="#ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰" class="headerlink" title="ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰"></a>ä½¿ç”¨å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å°†é™æ€èµ„æºè¿ç§»åˆ°é˜¿é‡Œäº‘OSS</span>

<span class="token comment"># 1. å®‰è£…ossutilå·¥å…·</span>
<span class="token function">wget</span> http://gosspublic.alicdn.com/ossutil/1.7.15/ossutil64
<span class="token function">chmod</span> +x ossutil64
<span class="token function">mv</span> ossutil64 /usr/local/bin/ossutil

<span class="token comment"># 2. é…ç½®OSSè®¿é—®å‡­è¯</span>
ossutil config

<span class="token comment"># 3. æ‰¹é‡ä¸Šä¼ æ–‡ä»¶åˆ°OSS</span>
ossutil <span class="token function">cp</span> <span class="token parameter variable">-r</span> /var/www/html/uploadfiles/ oss://your-bucket/uploadfiles/

<span class="token comment"># 4. é…ç½®CDNåŠ é€ŸOSS</span>
<span class="token comment"># åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®CDNæŒ‡å‘OSS bucket</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="å›¾ç‰‡å‹ç¼©ä¸ä¼˜åŒ–"><a href="#å›¾ç‰‡å‹ç¼©ä¸ä¼˜åŒ–" class="headerlink" title="å›¾ç‰‡å‹ç¼©ä¸ä¼˜åŒ–"></a>å›¾ç‰‡å‹ç¼©ä¸ä¼˜åŒ–</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰¹é‡å‹ç¼©æ‰€æœ‰å›¾ç‰‡</span>
<span class="token function">cat</span> <span class="token operator">></span> /usr/local/bin/optimize_all_images.sh <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
#!/bin/bash

UPLOAD_DIR="/var/www/html/uploadfiles"
BACKUP_DIR="/var/www/backup/uploadfiles_$(date +%Y%m%d)"

# å¤‡ä»½åŸæ–‡ä»¶
echo "å¤‡ä»½åŸæ–‡ä»¶åˆ° $BACKUP_DIR"
mkdir -p "$BACKUP_DIR"
cp -r "$UPLOAD_DIR" "$BACKUP_DIR"

# ä¼˜åŒ–PNG
echo "ä¼˜åŒ–PNGå›¾ç‰‡..."
find "$UPLOAD_DIR" -name "*.png" -type f | while read img; do
    size_before=$(stat -f%z "$img" 2>/dev/null || stat -c%s "$img")
    pngquant --quality=65-80 --ext .png --force "$img" 2>/dev/null
    size_after=$(stat -f%z "$img" 2>/dev/null || stat -c%s "$img")
    saved=$((size_before - size_after))
    echo "  $img: $(numfmt --to=iec $size_before) -> $(numfmt --to=iec $size_after) (èŠ‚çœ $(numfmt --to=iec $saved))"
done

# ä¼˜åŒ–JPG
echo "ä¼˜åŒ–JPGå›¾ç‰‡..."
find "$UPLOAD_DIR" -name "*.jpg" -o -name "*.jpeg" -type f | while read img; do
    size_before=$(stat -f%z "$img" 2>/dev/null || stat -c%s "$img")
    jpegoptim --max=85 --strip-all "$img" 2>/dev/null
    size_after=$(stat -f%z "$img" 2>/dev/null || stat -c%s "$img")
    saved=$((size_before - size_after))
    echo "  $img: $(numfmt --to=iec $size_before) -> $(numfmt --to=iec $size_after) (èŠ‚çœ $(numfmt --to=iec $saved))"
done

echo "ä¼˜åŒ–å®Œæˆï¼"
EOF</span>

<span class="token function">chmod</span> +x /usr/local/bin/optimize_all_images.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é…ç½®è¯´æ˜ï¼š</p>
<ul>
<li><code>UPLOAD_DIR</code>: é™æ€èµ„æºç›®å½•ã€‚</li>
<li><code>BACKUP_DIR</code>: å¤‡ä»½ç›®å½•ï¼Œä½¿ç”¨å½“å‰æ—¥æœŸä½œä¸ºå­ç›®å½•ã€‚</li>
<li><code>pngquant</code>: ä¼˜åŒ–PNGå›¾ç‰‡ï¼Œè®¾ç½®è´¨é‡ä¸º65-80ï¼Œä¸ä¿ç•™å…ƒæ•°æ®ã€‚</li>
<li><code>jpegoptim</code>: ä¼˜åŒ–JPGå›¾ç‰‡ï¼Œè®¾ç½®æœ€å¤§è´¨é‡ä¸º85ï¼Œä¸ä¿ç•™å…ƒæ•°æ®ã€‚</li>
</ul>
<h1 id="äº”ã€å®æ–½æ—¶é—´è¡¨"><a href="#äº”ã€å®æ–½æ—¶é—´è¡¨" class="headerlink" title="äº”ã€å®æ–½æ—¶é—´è¡¨"></a>äº”ã€å®æ–½æ—¶é—´è¡¨</h1><h2 id="5-1-åˆ†é˜¶æ®µå®æ–½è®¡åˆ’"><a href="#5-1-åˆ†é˜¶æ®µå®æ–½è®¡åˆ’" class="headerlink" title="5.1 åˆ†é˜¶æ®µå®æ–½è®¡åˆ’"></a>5.1 åˆ†é˜¶æ®µå®æ–½è®¡åˆ’</h2><h3 id="ç¬¬ä¸€é˜¶æ®µï¼šç´§æ€¥å“åº”ï¼ˆç«‹å³-2å°æ—¶ï¼‰"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šç´§æ€¥å“åº”ï¼ˆç«‹å³-2å°æ—¶ï¼‰" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šç´§æ€¥å“åº”ï¼ˆç«‹å³-2å°æ—¶ï¼‰"></a>ç¬¬ä¸€é˜¶æ®µï¼šç´§æ€¥å“åº”ï¼ˆç«‹å³-2å°æ—¶ï¼‰</h3><ul>
<li>éƒ¨ç½²Nginxé™æµé…ç½®</li>
<li>å¯ç”¨IPé»‘åå•</li>
<li>é…ç½®é˜²ç›—é“¾</li>
<li>å‹ç¼©å…³é”®å›¾ç‰‡</li>
</ul>
<h3 id="ç¬¬äºŒé˜¶æ®µï¼šä¸­æœŸé˜²æŠ¤ï¼ˆ24å°æ—¶å†…ï¼‰"><a href="#ç¬¬äºŒé˜¶æ®µï¼šä¸­æœŸé˜²æŠ¤ï¼ˆ24å°æ—¶å†…ï¼‰" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šä¸­æœŸé˜²æŠ¤ï¼ˆ24å°æ—¶å†…ï¼‰"></a>ç¬¬äºŒé˜¶æ®µï¼šä¸­æœŸé˜²æŠ¤ï¼ˆ24å°æ—¶å†…ï¼‰</h3><ul>
<li>æ¥å…¥CDNæœåŠ¡</li>
<li>éƒ¨ç½²WAFè§„åˆ™</li>
<li>å¯åŠ¨å®æ—¶ç›‘æ§</li>
<li>é…ç½®å‘Šè­¦ç³»ç»Ÿ</li>
</ul>
<h3 id="ç¬¬ä¸‰é˜¶æ®µï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ1å‘¨å†…ï¼‰"><a href="#ç¬¬ä¸‰é˜¶æ®µï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ1å‘¨å†…ï¼‰" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ1å‘¨å†…ï¼‰"></a>ç¬¬ä¸‰é˜¶æ®µï¼šé•¿æœŸä¼˜åŒ–ï¼ˆ1å‘¨å†…ï¼‰</h3><ul>
<li>é™æ€èµ„æºè¿ç§»OSS</li>
<li>æ‰¹é‡ä¼˜åŒ–æ‰€æœ‰å›¾ç‰‡</li>
<li>éƒ¨ç½²ç›‘æ§é¢æ¿</li>
<li>åˆ¶å®šåº”æ€¥é¢„æ¡ˆ</li>
</ul>
<h1 id="å…­ã€éªŒè¯ä¸æµ‹è¯•"><a href="#å…­ã€éªŒè¯ä¸æµ‹è¯•" class="headerlink" title="å…­ã€éªŒè¯ä¸æµ‹è¯•"></a>å…­ã€éªŒè¯ä¸æµ‹è¯•</h1><h2 id="6-1-é™æµåŠŸèƒ½æµ‹è¯•"><a href="#6-1-é™æµåŠŸèƒ½æµ‹è¯•" class="headerlink" title="6.1 é™æµåŠŸèƒ½æµ‹è¯•"></a>6.1 é™æµåŠŸèƒ½æµ‹è¯•</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨abè¿›è¡Œå‹åŠ›æµ‹è¯•</span>
ab <span class="token parameter variable">-n</span> <span class="token number">1000</span> <span class="token parameter variable">-c</span> <span class="token number">50</span> https://www.example.com/uploadfiles/banner/banner_img.png

<span class="token comment"># é¢„æœŸç»“æœï¼šå¤§éƒ¨åˆ†è¯·æ±‚è¿”å›503æˆ–429</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h1><h2 id="7-1-æ ¸å¿ƒè¦ç‚¹"><a href="#7-1-æ ¸å¿ƒè¦ç‚¹" class="headerlink" title="7.1 æ ¸å¿ƒè¦ç‚¹"></a>7.1 æ ¸å¿ƒè¦ç‚¹</h2><ol>
<li><strong>ç«‹å³è¡ŒåŠ¨</strong>: éƒ¨ç½²Nginxé™æµå’ŒIPå°ç¦ï¼ˆ30åˆ†é’Ÿå†…å®Œæˆï¼‰</li>
<li><strong>æ¥å…¥CDN</strong>: æœ€æœ‰æ•ˆçš„é˜²æŠ¤æ‰‹æ®µï¼Œ24å°æ—¶å†…å®Œæˆæ¥å…¥</li>
<li><strong>æŒç»­ç›‘æ§</strong>: å»ºç«‹å®æ—¶ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶</li>
<li><strong>ä¼˜åŒ–èµ„æº</strong>: å‹ç¼©å›¾ç‰‡ã€ä½¿ç”¨OSSå‡å°‘æ”»å‡»é¢</li>
</ol>
<h2 id="7-2-é¢„æœŸæ•ˆæœ"><a href="#7-2-é¢„æœŸæ•ˆæœ" class="headerlink" title="7.2 é¢„æœŸæ•ˆæœ"></a>7.2 é¢„æœŸæ•ˆæœ</h2><ul>
<li><strong>é˜²æŠ¤èƒ½åŠ›</strong>: ä»0æå‡åˆ°100+ Gbps</li>
<li><strong>å¸¦å®½èŠ‚çœ</strong>: 70-90%</li>
<li><strong>å“åº”æ—¶é—´</strong>: é™ä½30-50%</li>
<li><strong>æˆæœ¬æ§åˆ¶</strong>: 2000-5000å…ƒ&#x2F;æœˆ</li>
<li><strong>æœåŠ¡ç¨³å®šæ€§</strong>: 99.9%å¯ç”¨æ€§</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>: å¯æ ¹æ®å®é™…æƒ…å†µç«‹å³éƒ¨ç½²ã€‚å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯åå†åº”ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
</blockquote>
<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul>
<li><a href="http://nginx.org/en/docs/http/ngx_http_limit_req_module.html">Nginxå®˜æ–¹æ–‡æ¡£ - é™æµé…ç½®</a></li>
<li><a href="https://www.aliyun.com/sswb/1700108_1.html">é˜¿é‡Œäº‘DDoSé˜²æŠ¤æœ€ä½³å®è·µ</a></li>
</ul>
]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>DDoSé˜²å¾¡</tag>
        <tag>Nginxé™æµ</tag>
        <tag>CDN</tag>
        <tag>WAF</tag>
        <tag>æµé‡æ”»å‡»</tag>
      </tags>
  </entry>
</search>
